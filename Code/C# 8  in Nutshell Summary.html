
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
        <link rel="canonical" href="https://vivekkpatel.github.io/Books/Code/C%23%208%20%20in%20Nutshell%20Summary.html">
      
      
        <link rel="prev" href="AutoHotkey%20Applications.html">
      
      
        <link rel="next" href="C%23%20in%20Depth.html">
      
      
        
      
      
      <link rel="icon" href="../assets/favicon.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.7.1">
    
    
      
        <title>C# 8  in Nutshell Summary - Books</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/main.484c7ddc.min.css">
      
        
        <link rel="stylesheet" href="../assets/stylesheets/palette.ab4e12ef.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
    <script>__md_scope=new URL("..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="slate" data-md-color-primary="black" data-md-color-accent="indigo">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#c-80-in-a-nutshell-the-definitive-reference-by-joseph-albahari" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../index.html" title="Books" class="md-header__button md-logo" aria-label="Books" data-md-component="logo">
      
  <img src="../assets/favicon.png" alt="logo">

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Books
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              C# 8  in Nutshell Summary
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
  
    
    
    
    <input class="md-option" data-md-color-media="" data-md-color-scheme="slate" data-md-color-primary="black" data-md-color-accent="indigo"  aria-label="Switch to light mode"  type="radio" name="__palette" id="__palette_0">
    
      <label class="md-header__button md-icon" title="Switch to light mode" for="__palette_1" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 18c-.89 0-1.74-.2-2.5-.55C11.56 16.5 13 14.42 13 12s-1.44-4.5-3.5-5.45C10.26 6.2 11.11 6 12 6a6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12z"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="indigo"  aria-label="Switch to dark mode"  type="radio" name="__palette" id="__palette_1">
    
      <label class="md-header__button md-icon" title="Switch to dark mode" for="__palette_0" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a4 4 0 0 0-4 4 4 4 0 0 0 4 4 4 4 0 0 0 4-4 4 4 0 0 0-4-4m0 10a6 6 0 0 1-6-6 6 6 0 0 1 6-6 6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12z"/></svg>
      </label>
    
  
</form>
      
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      
      
        <label class="md-header__button md-icon" for="__search">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        </label>
        <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
      
    
    
      <div class="md-header__source">
        <a href="https://github.com/vivekkpatel/Books" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M439.6 236.1 244 40.5c-5.4-5.5-12.8-8.5-20.4-8.5s-15 3-20.4 8.4L162.5 81l51.5 51.5c27.1-9.1 52.7 16.8 43.4 43.7l49.7 49.7c34.2-11.8 61.2 31 35.5 56.7-26.5 26.5-70.2-2.9-56-37.3L240.3 199v121.9c25.3 12.5 22.3 41.8 9.1 55-6.4 6.4-15.2 10.1-24.3 10.1s-17.8-3.6-24.3-10.1c-17.6-17.6-11.1-46.9 11.2-56v-123c-20.8-8.5-24.6-30.7-18.6-45L142.6 101 8.5 235.1C3 240.6 0 247.9 0 255.5s3 15 8.5 20.4l195.6 195.7c5.4 5.4 12.7 8.4 20.4 8.4s15-3 20.4-8.4l194.7-194.7c5.4-5.4 8.4-12.8 8.4-20.4s-3-15-8.4-20.4"/></svg>
  </div>
  <div class="md-source__repository">
    Books
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
            
<nav class="md-tabs" aria-label="Tabs" data-md-component="tabs">
  <div class="md-grid">
    <ul class="md-tabs__list">
      
        
  
  
  
  
    <li class="md-tabs__item">
      <a href="../index.html" class="md-tabs__link">
        
  
  
    
  
  Home

      </a>
    </li>
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../Self%20Help/Atomic%20Habits.html" class="md-tabs__link">
          
  
  
    
  
  Self Help

        </a>
      </li>
    
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../Biography/Adventures%20of%20a%20Curious%20Character.html" class="md-tabs__link">
          
  
  
    
  
  Biography

        </a>
      </li>
    
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../Business/Anything%20You%20Want.html" class="md-tabs__link">
          
  
  
    
  
  Business

        </a>
      </li>
    
  

      
        
  
  
  
    
  
  
    
    
      <li class="md-tabs__item md-tabs__item--active">
        <a href="A%20Beginner%27s%20Guide%20to%20AutoHotkey.html" class="md-tabs__link">
          
  
  
    
  
  Code

        </a>
      </li>
    
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../Trade/Best%20Losers%20Wins.html" class="md-tabs__link">
          
  
  
    
  
  Trade

        </a>
      </li>
    
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../Fantasy/1984.html" class="md-tabs__link">
          
  
  
    
  
  Fantasy

        </a>
      </li>
    
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../Science/A%20Short%20History%20of%20Nearly%20Everything.html" class="md-tabs__link">
          
  
  
    
  
  Science

        </a>
      </li>
    
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../Science%20Fiction/Bobiverse.html" class="md-tabs__link">
          
  
  
    
  
  Science Fiction

        </a>
      </li>
    
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../Fiction/A%20Count%20of%20Monte%20Cristo.html" class="md-tabs__link">
          
  
  
    
  
  Fiction

        </a>
      </li>
    
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../Philosophy/Ikigai.html" class="md-tabs__link">
          
  
  
    
  
  Philosophy

        </a>
      </li>
    
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../Romance/Attachments.html" class="md-tabs__link">
          
  
  
    
  
  Romance

        </a>
      </li>
    
  

      
    </ul>
  </div>
</nav>
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


  


<nav class="md-nav md-nav--primary md-nav--lifted" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../index.html" title="Books" class="md-nav__button md-logo" aria-label="Books" data-md-component="logo">
      
  <img src="../assets/favicon.png" alt="logo">

    </a>
    Books
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/vivekkpatel/Books" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M439.6 236.1 244 40.5c-5.4-5.5-12.8-8.5-20.4-8.5s-15 3-20.4 8.4L162.5 81l51.5 51.5c27.1-9.1 52.7 16.8 43.4 43.7l49.7 49.7c34.2-11.8 61.2 31 35.5 56.7-26.5 26.5-70.2-2.9-56-37.3L240.3 199v121.9c25.3 12.5 22.3 41.8 9.1 55-6.4 6.4-15.2 10.1-24.3 10.1s-17.8-3.6-24.3-10.1c-17.6-17.6-11.1-46.9 11.2-56v-123c-20.8-8.5-24.6-30.7-18.6-45L142.6 101 8.5 235.1C3 240.6 0 247.9 0 255.5s3 15 8.5 20.4l195.6 195.7c5.4 5.4 12.7 8.4 20.4 8.4s15-3 20.4-8.4l194.7-194.7c5.4-5.4 8.4-12.8 8.4-20.4s-3-15-8.4-20.4"/></svg>
  </div>
  <div class="md-source__repository">
    Books
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../index.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Home
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2" >
        
          
          <label class="md-nav__link" for="__nav_2" id="__nav_2_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Self Help
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2">
            <span class="md-nav__icon md-icon"></span>
            
  
    Self Help
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../Self%20Help/Atomic%20Habits.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Atomic Habits
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../Self%20Help/DON%E2%80%99T%20LOSE%20OUT%2C%20WORK%20OUT.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    DONâ€™T LOSE OUT, WORK OUT by Rujuta Diwekar
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../Self%20Help/Getting%20Things%20Done.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Getting Things Done
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../Self%20Help/How%20to%20Win%20Friends%20and%20Influence%20People.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    How to Win Friends and Influence People
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../Self%20Help/Make%20Time.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Make Time
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../Self%20Help/Quiet%20The%20Power%20of%20Introverts.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Quiet The Power of Introverts
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../Self%20Help/Show%20Your%20Work.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Show Your Work
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../Self%20Help/The%20Obstacle%20Is%20the%20Way.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    The Obstacle Is the Way
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../Self%20Help/The%20Power%20of%20Habit.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    The Power of Habit
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../Self%20Help/The%20Subtle%20Art%20of%20Not%20Giving%20a%20Fuck.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    The Subtle Art of Not Giving a Fuck
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../Self%20Help/Thinking%20Fast%20and%20Slow.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Thinking Fast and Slow
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3" >
        
          
          <label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Biography
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3">
            <span class="md-nav__icon md-icon"></span>
            
  
    Biography
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../Biography/Adventures%20of%20a%20Curious%20Character.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Adventures of a Curious Character
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../Biography/Alibaba.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Alibaba
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../Biography/Bad%20Blood.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Bad Blood
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../Biography/Bricklin%20on%20Technology.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Bricklin on Technology
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../Biography/Educated.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Educated
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../Biography/Hard%20Drive.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Hard Drive
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../Biography/Just%20for%20Fun.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Just for Fun
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../Biography/Know%20My%20Name%20A%20Memoir.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Know My Name A Memoir
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../Biography/Masters%20of%20Doom.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Masters of Doom
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../Biography/My%20Life.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    My Life
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../Biography/My%20Life%20An%20Illustrated%20Biography.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    My Life An Illustrated Biography
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../Biography/Nikola%20Tesla.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Nikola Tesla
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../Biography/Permanent%20Record.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Permanent Record
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../Biography/Sam%20Walton%20Made%20In%20America.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Sam Walton Made In America
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../Biography/Shoe%20Dog.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Shoe Dog
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../Biography/Steve%20Jobs.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Steve Jobs
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../Biography/The%20Everything%20Store.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    The Everything Store
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../Biography/The%20Glass%20Castle.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    The Glass Castle
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../Biography/The%20Upstarts.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    The Upstarts
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../Biography/When%20Breath%20Becomes%20Air.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    When Breath Becomes Air
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../Biography/Wild.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Wild
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4" >
        
          
          <label class="md-nav__link" for="__nav_4" id="__nav_4_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Business
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4">
            <span class="md-nav__icon md-icon"></span>
            
  
    Business
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../Business/Anything%20You%20Want.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Anything You Want
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../Business/Breaking%20the%20Time%20Barrier.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Breaking the Time Barrier
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../Business/Design%20Your%20Work.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Design Your Work
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../Business/Let%27s%20Talk%20Money.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Let's Talk Money
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../Business/Never%20Split%20the%20Difference.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Never Split the Difference
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../Business/Rich%20Dad%20Poor%20Dad.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Rich Dad Poor Dad
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../Business/The%20Compound%20Effect.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    The Compound Effect
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../Business/The%20Greatest%20Salesman%20in%20the%20world.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    The Greatest Salesman in the world
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../Business/The%20Richest%20Man%20in%20Babylon.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    The Richest Man in Babylon
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../Business/The%20Zurich%20Axioms.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    The Zurich Axioms
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../Business/Zero%20to%20One.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Zero to One
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
    
      
        
        
      
      
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5" checked>
        
          
          <label class="md-nav__link" for="__nav_5" id="__nav_5_label" tabindex="">
            
  
  
  <span class="md-ellipsis">
    
  
    Code
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_5_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_5">
            <span class="md-nav__icon md-icon"></span>
            
  
    Code
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="A%20Beginner%27s%20Guide%20to%20AutoHotkey.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    A Beginner's Guide to AutoHotkey
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="AutoCAD%202012%20DXF%20reference.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    AutoCAD 2012 DXF reference
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="AutoCAD%20Platform%20Customization%20VBA.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    AutoCAD Platform Customization VBA
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="AutoHotkey%20Applications.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    AutoHotkey Applications
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
      <a href="C%23%208%20%20in%20Nutshell%20Summary.html" class="md-nav__link md-nav__link--active">
        
  
  
  <span class="md-ellipsis">
    
  
    C# 8  in Nutshell Summary
  

    
  </span>
  
  

      </a>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="C%23%20in%20Depth.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    C# in Depth
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="C%23%20Player%27s%20Guide.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    The C# Player's Guide
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="Clean%20Code.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Clean Code
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="Computational%20Engineering.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Computational Engineering
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="Dependency%20Injection%20in%20NET.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Dependency Injection in NET
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="Digging%20Deeper%20into%20AutoHotkey.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Digging Deeper into AutoHotkey
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="Start%20Programming%20in%20NET%20for%20AutoCAD.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Start Programming in NET for AutoCAD
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="Test-Driven%20Development%20By%20Example.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Test-Driven Development By Example
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="The%20Art%20of%20Unit%20Testing%20With%20Examples%20in%20NET.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    The Art of Unit Testing With Examples in NET
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="The%20Markdown%20Guide.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    The Markdown Guide
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="The%20Pragamatic%20Programmer.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    The Pragamatic Programmer
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="Unit%20Testing%20Principles%2C%20Practices%2C%20and%20Patterns.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Unit Testing Principles, Practices, and Patterns
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_6" >
        
          
          <label class="md-nav__link" for="__nav_6" id="__nav_6_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Trade
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_6_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_6">
            <span class="md-nav__icon md-icon"></span>
            
  
    Trade
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../Trade/Best%20Losers%20Wins.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Best Losers Wins
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../Trade/How%20I%20made%202M%20in%20the%20Stock%20Market.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    How I made 2M in the Stock Market
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../Trade/How%20Legendary%20Traders%20Made%20Millions.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    How Legendary Traders Made Millions
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../Trade/How%20to%20Trade%20in%20Stocks.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    How to Trade in Stocks
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../Trade/Secrets%20For%20Profiting%20in%20Bull%20and%20Bear%20Markets.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Secrets For Profiting in Bull and Bear Markets
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../Trade/The%20Battle%20for%20Investment%20Survival.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    The Battle for Investment Survival
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../Trade/The%20Perfect%20Speculator.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    The Perfect Speculator
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../Trade/The%20Perfect%20Stock.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    The Perfect Stock
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../Trade/Think%20and%20Trade%20like%20a%20Champion.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Think and Trade like a Champion
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../Trade/Trade%20Like%20a%20Stock%20Market%20Wizard.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Trade Like a Stock Market Wizard
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../Trade/Trade%20Your%20Way%20to%20Financial%20Freedom.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Trade Your Way to Financial Freedom
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_7" >
        
          
          <label class="md-nav__link" for="__nav_7" id="__nav_7_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Fantasy
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_7_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_7">
            <span class="md-nav__icon md-icon"></span>
            
  
    Fantasy
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../Fantasy/1984.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    1984
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../Fantasy/AnimalFarm.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    AnimalFarm
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../Fantasy/Blood%20Over%20Bright%20Haven.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Blood Over Bright Haven
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../Fantasy/Coraline.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Coraline
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../Fantasy/Cradle.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Cradle
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../Fantasy/Dune.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Dune
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../Fantasy/Elantris.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Elantris
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../Fantasy/Gentleman%20Bastard.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Gentleman Bastard
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../Fantasy/Graceling%20Realm.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Graceling Realm
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../Fantasy/Harry%20Potter.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Harry Potter
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../Fantasy/Hierarchy.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Hierarchy by James Islington
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../Fantasy/Mistborn.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Mistborn
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../Fantasy/Shadow%20of%20the%20Leviathan.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Shadow of the Leviathan
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../Fantasy/Six%20of%20Crows.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Six of Crows
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../Fantasy/Spinning%20Silver.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Spinning Silver
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../Fantasy/The%20Aurelian%20Cycle.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    The Aurelian Cycle
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../Fantasy/The%20Burning.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    The Burning
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../Fantasy/The%20Cruel%20Prince.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    The Cruel Prince
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../Fantasy/The%20First%20Law.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    The First Law
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../Fantasy/The%20Folk%20of%20the%20Air.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    The Folk of the Air
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../Fantasy/The%20Founders%20Trilogy.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    The Founders Trilogy
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../Fantasy/The%20Hunger%20Games.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    The Hunger Games
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../Fantasy/The%20Kingkiller%20Chronicle.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    The Kingkiller Chronicle
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../Fantasy/The%20Night%20Circus.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    The Night Circus
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../Fantasy/The%20Poppy%20War.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    The Poppy War
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../Fantasy/The%20Red%20Rising%20Saga.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    The Red Rising Saga
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../Fantasy/The%20Rithmatist.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    The Rithmatist
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../Fantasy/The%20Stormlight%20Archieve.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    The Stormlight Archieve
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../Fantasy/The%20Sword%20of%20Kaigen.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    The Sword of Kaigen
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../Fantasy/The%20Wheel%20of%20Time.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    The Wheel of Time
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../Fantasy/Throne%20of%20Glass.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Throne of Glass
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../Fantasy/Uprooted.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Uprooted
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../Fantasy/Warbreaker.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Warbreaker
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
      
        
      
        
      
        
      
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_8" >
        
          
          <label class="md-nav__link" for="__nav_8" id="__nav_8_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Science
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_8_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_8">
            <span class="md-nav__icon md-icon"></span>
            
  
    Science
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../Science/A%20Short%20History%20of%20Nearly%20Everything.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    A Short History of Nearly Everything
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../Science/Factfulness.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Factfulness
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../Science/Sapiens.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Sapiens
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../Science/Why%20We%20Sleep.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Why We Sleep
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_9" >
        
          
          <label class="md-nav__link" for="__nav_9" id="__nav_9_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Science Fiction
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_9_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_9">
            <span class="md-nav__icon md-icon"></span>
            
  
    Science Fiction
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../Science%20Fiction/Bobiverse.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Bobiverse
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../Science%20Fiction/Divergent.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Divergent
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../Science%20Fiction/Ender%27s%20Saga.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Ender's Saga
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../Science%20Fiction/Flowers%20for%20Algernon.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Flowers for Algernon
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../Science%20Fiction/Jurassic%20Park.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Jurassic Park
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../Science%20Fiction/Old%20Man%27s%20War.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Old Man's War
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../Science%20Fiction/Project%20Hail%20Mary.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Project Hail Mary
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../Science%20Fiction/Ready%20Player%20One.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Ready Player One
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../Science%20Fiction/Recursion.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Recursion
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../Science%20Fiction/Skyward.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Skyward
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../Science%20Fiction/Snow%20Crash.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Snow Crash
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../Science%20Fiction/The%20Giver.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    The Giver
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../Science%20Fiction/The%20Martian.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    The Martian
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_10" >
        
          
          <label class="md-nav__link" for="__nav_10" id="__nav_10_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Fiction
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_10_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_10">
            <span class="md-nav__icon md-icon"></span>
            
  
    Fiction
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../Fiction/A%20Count%20of%20Monte%20Cristo.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    A Count of Monte Cristo
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../Fiction/A%20Gentleman%20in%20Moscow.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    A Gentleman in Moscow
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../Fiction/A%20Little%20Princess.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    A Little Princess
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../Fiction/A%20Man%20Called%20Ove.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    A Man Called Ove
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../Fiction/A%20Thousand%20Splendid%20Suns.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    A Thousand Splendid Suns
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../Fiction/Anne%20of%20Green%20Gables.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Anne of Green Gables
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../Fiction/Anxious%20People.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Anxious People
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../Fiction/Beartown.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Beartown
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../Fiction/Eleanor%20Oliphant%20is%20completely%20Fine.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Eleanor Oliphant is completely Fine
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../Fiction/Every%20Morning%20the%20Way%20Home%20Gets%20Longer.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Every Morning the Way Home Gets Longer
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../Fiction/Finding%20Audrey.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Finding Audrey
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../Fiction/Little%20Fires%20Everywhere.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Little Fires Everywhere
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../Fiction/Normal%20People.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Normal People
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../Fiction/The%20Book%20Thief.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    The Book Thief
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../Fiction/The%20Boy%2C%20The%20Mole%2C%20The%20Fox%20and%20The%20Horse.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    The Boy, The Mole, The Fox and The Horse
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../Fiction/The%20Girl%20with%20the%20Dragon%20Tatto.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    The Girl with the Dragon Tatto
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../Fiction/The%20Kite%20Runner.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    The Kite Runner
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../Fiction/To%20Kill%20a%20Mockingbird.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    To Kill a Mockingbird
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
      
        
      
        
      
        
      
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_11" >
        
          
          <label class="md-nav__link" for="__nav_11" id="__nav_11_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Philosophy
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_11_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_11">
            <span class="md-nav__icon md-icon"></span>
            
  
    Philosophy
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../Philosophy/Ikigai.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Ikigai
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../Philosophy/Letters%20from%20a%20stoic.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Letters from a stoic
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../Philosophy/Man%27s%20Search%20for%20Meaning.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Man's Search for Meaning
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../Philosophy/The%20Art%20of%20War.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    The Art of War
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_12" >
        
          
          <label class="md-nav__link" for="__nav_12" id="__nav_12_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Romance
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_12_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_12">
            <span class="md-nav__icon md-icon"></span>
            
  
    Romance
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../Romance/Attachments.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Attachments
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../Romance/Beach%20Read.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Beach Read
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../Romance/Five%20Feet%20Apart.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Five Feet Apart
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../Romance/It%20Ends%20with%20Us.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    It Ends with Us
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../Romance/Me%20Before%20You.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Me Before You
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../Romance/The%20bookish%20life%20of%20Nina%20Hill.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    The bookish life of Nina Hill
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../Romance/The%20Fault%20in%20Our%20Stars.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    The Fault in Our Stars
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../Romance/The%20Flatshare.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    The Flatshare
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../Romance/The%20Hating%20Game.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    The Hating Game
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../Romance/The%20Invisible%20Life%20of%20Addie%20LaRue.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    The Invisible Life of Addie LaRue
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../Romance/The%20Kiss%20Quotient.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    The Kiss Quotient
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../Romance/The%20Kiss%20Thief.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    The Kiss Thief
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              
                



  


  <nav class="md-path" aria-label="Navigation" >
    <ol class="md-path__list">
      
        
  
  
    <li class="md-path__item">
      <a href="../index.html" class="md-path__link">
        
  <span class="md-ellipsis">
    Home
  </span>

      </a>
    </li>
  

      
      
        
  
  
    
    
      <li class="md-path__item">
        <a href="A%20Beginner%27s%20Guide%20to%20AutoHotkey.html" class="md-path__link">
          
  <span class="md-ellipsis">
    Code
  </span>

        </a>
      </li>
    
  

      
    </ol>
  </nav>

              
              <article class="md-content__inner md-typeset">
                
                  


  
    <a href="https://github.com/vivekkpatel/Books/edit/main/docs/Code/C# 8  in Nutshell Summary.md" title="Edit this page" class="md-content__button md-icon" rel="edit">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20.71 7.04c.39-.39.39-1.04 0-1.41l-2.34-2.34c-.37-.39-1.02-.39-1.41 0l-1.84 1.83 3.75 3.75M3 17.25V21h3.75L17.81 9.93l-3.75-3.75z"/></svg>
    </a>
  
  
    
      
    
    <a href="https://github.com/vivekkpatel/Books/raw/main/docs/Code/C# 8  in Nutshell Summary.md" title="View source of this page" class="md-content__button md-icon">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 9a3 3 0 0 0-3 3 3 3 0 0 0 3 3 3 3 0 0 0 3-3 3 3 0 0 0-3-3m0 8a5 5 0 0 1-5-5 5 5 0 0 1 5-5 5 5 0 0 1 5 5 5 5 0 0 1-5 5m0-12.5C7 4.5 2.73 7.61 1 12c1.73 4.39 6 7.5 11 7.5s9.27-3.11 11-7.5c-1.73-4.39-6-7.5-11-7.5"/></svg>
    </a>
  


<h1 id="c-80-in-a-nutshell-the-definitive-reference-by-joseph-albahari">C# 8.0 in a Nutshell: The Definitive Reference by Joseph Albahari</h1>
<h1 id="c-in-nutshell-summary">C# in Nutshell Summary</h1>
<p>Go Through All Chapter Again for Use Full Content</p>
<h3 id="new-things">New things</h3>
<ul>
<li>Linked List</li>
<li>Queue</li>
<li>Stack</li>
<li>Lamda Expression</li>
<li>Out Modifier</li>
<li>Collections</li>
<li>Progressive Linq quary with into keyword</li>
<li>Conditional Compilation</li>
<li>Catching Filesystem Events</li>
<li>Generating Key for Strong Naming</li>
<li>Regular Expression# Chapter 1 : Introduction</li>
</ul>
<hr />
<h1 id="whats-new-in-c-80"><strong>Whatâ€™s New in C# 8.0</strong></h1>
<h3 id="indices-and-ranges">Indices and ranges</h3>
<p>Indices let you refer to elements relative to the end of an array by using the ^ operaâ€
tor. ^1 refers to the last element, ^2 refers to the second-to-last element, and so on:</p>
<div class="language-csharp highlight"><pre><span></span><code><span id="__span-0-1"><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="kt">char</span><span class="p">[]</span><span class="w"> </span><span class="n">vowels</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="kt">char</span><span class="p">[]</span><span class="w"> </span><span class="p">{</span><span class="sc">&#39;a&#39;</span><span class="p">,</span><span class="sc">&#39;e&#39;</span><span class="p">,</span><span class="sc">&#39;i&#39;</span><span class="p">,</span><span class="sc">&#39;o&#39;</span><span class="p">,</span><span class="sc">&#39;u&#39;</span><span class="p">};</span>
</span><span id="__span-0-2"><a id="__codelineno-0-2" name="__codelineno-0-2" href="#__codelineno-0-2"></a><span class="kt">char</span><span class="w"> </span><span class="n">lastElement</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">vowels</span><span class="w"> </span><span class="p">[</span><span class="o">^</span><span class="mi">1</span><span class="p">];</span><span class="w"> </span><span class="c1">// &#39;u&#39;</span>
</span><span id="__span-0-3"><a id="__codelineno-0-3" name="__codelineno-0-3" href="#__codelineno-0-3"></a><span class="kt">char</span><span class="w"> </span><span class="n">secondToLast</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">vowels</span><span class="w"> </span><span class="p">[</span><span class="o">^</span><span class="mi">2</span><span class="p">];</span><span class="w"> </span><span class="c1">// &#39;o&#39;</span>
</span></code></pre></div>
<p>Ranges let you â€œsliceâ€ an array by using the .. operator:</p>
<div class="language-csharp highlight"><pre><span></span><code><span id="__span-1-1"><a id="__codelineno-1-1" name="__codelineno-1-1" href="#__codelineno-1-1"></a><span class="kt">char</span><span class="p">[]</span><span class="w"> </span><span class="n">firstTwo</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">vowels</span><span class="w"> </span><span class="p">[.</span><span class="mf">.2</span><span class="p">];</span><span class="w"> </span><span class="c1">// &#39;a&#39;, &#39;e&#39;</span>
</span><span id="__span-1-2"><a id="__codelineno-1-2" name="__codelineno-1-2" href="#__codelineno-1-2"></a><span class="kt">char</span><span class="p">[]</span><span class="w"> </span><span class="n">lastThree</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">vowels</span><span class="w"> </span><span class="p">[</span><span class="mi">2</span><span class="p">..];</span><span class="w"> </span><span class="c1">// &#39;i&#39;, &#39;o&#39;, &#39;u&#39;</span>
</span><span id="__span-1-3"><a id="__codelineno-1-3" name="__codelineno-1-3" href="#__codelineno-1-3"></a><span class="kt">char</span><span class="p">[]</span><span class="w"> </span><span class="n">middleOne</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">vowels</span><span class="w"> </span><span class="p">[</span><span class="mi">2</span><span class="p">.</span><span class="mf">.3</span><span class="p">]</span><span class="w"> </span><span class="c1">// &#39;i&#39;</span>
</span><span id="__span-1-4"><a id="__codelineno-1-4" name="__codelineno-1-4" href="#__codelineno-1-4"></a><span class="kt">char</span><span class="p">[]</span><span class="w"> </span><span class="n">lastTwo</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">vowels</span><span class="w"> </span><span class="p">[</span><span class="o">^</span><span class="mi">2</span><span class="p">..];</span><span class="w"> </span><span class="c1">// &#39;o&#39;, &#39;u&#39;</span>
</span></code></pre></div>
<p>C# implements indexes and ranges with the help of the Index and Range types</p>
<div class="language-csharp highlight"><pre><span></span><code><span id="__span-2-1"><a id="__codelineno-2-1" name="__codelineno-2-1" href="#__codelineno-2-1"></a><span class="n">Index</span><span class="w"> </span><span class="n">last</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">^</span><span class="mi">1</span><span class="p">;</span>
</span><span id="__span-2-2"><a id="__codelineno-2-2" name="__codelineno-2-2" href="#__codelineno-2-2"></a><span class="n">Range</span><span class="w"> </span><span class="n">firstTwoRange</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">.</span><span class="mf">.2</span><span class="p">;</span>
</span><span id="__span-2-3"><a id="__codelineno-2-3" name="__codelineno-2-3" href="#__codelineno-2-3"></a><span class="kt">char</span><span class="p">[]</span><span class="w"> </span><span class="n">firstTwo</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">vowels</span><span class="w"> </span><span class="p">[</span><span class="n">firstTwoRange</span><span class="p">];</span><span class="w"> </span><span class="c1">// &#39;a&#39;, &#39;e&#39;</span>
</span></code></pre></div>
<div class="language-csharp highlight"><pre><span></span><code><span id="__span-3-1"><a id="__codelineno-3-1" name="__codelineno-3-1" href="#__codelineno-3-1"></a><span class="c1">//Indexer Inside Class</span>
</span><span id="__span-3-2"><a id="__codelineno-3-2" name="__codelineno-3-2" href="#__codelineno-3-2"></a><span class="k">class</span><span class="w"> </span><span class="nc">Sentence</span>
</span><span id="__span-3-3"><a id="__codelineno-3-3" name="__codelineno-3-3" href="#__codelineno-3-3"></a><span class="p">{</span>
</span><span id="__span-3-4"><a id="__codelineno-3-4" name="__codelineno-3-4" href="#__codelineno-3-4"></a><span class="w"> </span><span class="kt">string</span><span class="p">[]</span><span class="w"> </span><span class="n">words</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;The quick brown fox&quot;</span><span class="p">.</span><span class="n">Split</span><span class="p">();</span>
</span><span id="__span-3-5"><a id="__codelineno-3-5" name="__codelineno-3-5" href="#__codelineno-3-5"></a><span class="w"> </span><span class="k">public</span><span class="w"> </span><span class="kt">string</span><span class="w"> </span><span class="k">this</span><span class="w"> </span><span class="p">[</span><span class="n">Index</span><span class="w"> </span><span class="n">index</span><span class="p">]</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="n">words</span><span class="w"> </span><span class="p">[</span><span class="n">index</span><span class="p">];</span>
</span><span id="__span-3-6"><a id="__codelineno-3-6" name="__codelineno-3-6" href="#__codelineno-3-6"></a><span class="w"> </span><span class="k">public</span><span class="w"> </span><span class="kt">string</span><span class="p">[]</span><span class="w"> </span><span class="k">this</span><span class="w"> </span><span class="p">[</span><span class="n">Range</span><span class="w"> </span><span class="n">range</span><span class="p">]</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="n">words</span><span class="w"> </span><span class="p">[</span><span class="n">range</span><span class="p">];</span>
</span><span id="__span-3-7"><a id="__codelineno-3-7" name="__codelineno-3-7" href="#__codelineno-3-7"></a><span class="p">}</span>
</span></code></pre></div>
<h3 id="null-coalescing-assignment">Null-coalescing assignment</h3>
<div class="language-csharp highlight"><pre><span></span><code><span id="__span-4-1"><a id="__codelineno-4-1" name="__codelineno-4-1" href="#__codelineno-4-1"></a><span class="c1">//The ??= operator assigns a variable only if itâ€™s null. Instead of this:</span>
</span><span id="__span-4-2"><a id="__codelineno-4-2" name="__codelineno-4-2" href="#__codelineno-4-2"></a><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">s</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="k">null</span><span class="p">)</span><span class="w"> </span><span class="n">s</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;Hello, world&quot;</span><span class="p">;</span>
</span><span id="__span-4-3"><a id="__codelineno-4-3" name="__codelineno-4-3" href="#__codelineno-4-3"></a>
</span><span id="__span-4-4"><a id="__codelineno-4-4" name="__codelineno-4-4" href="#__codelineno-4-4"></a><span class="c1">//you can now write this:</span>
</span><span id="__span-4-5"><a id="__codelineno-4-5" name="__codelineno-4-5" href="#__codelineno-4-5"></a><span class="n">s</span><span class="w"> </span><span class="o">??=</span><span class="w"> </span><span class="s">&quot;Hello, world&quot;</span><span class="p">;</span>
</span></code></pre></div>
<h3 id="using-declarations">Using declarations</h3>
<p>If you omit the brackets and statement block following a using statement, it
becomes a using declaration. The resource is then disposed when execution falls outâ€
side the enclosing statement block:</p>
<div class="language-csharp highlight"><pre><span></span><code><span id="__span-5-1"><a id="__codelineno-5-1" name="__codelineno-5-1" href="#__codelineno-5-1"></a><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">File</span><span class="p">.</span><span class="n">Exists</span><span class="w"> </span><span class="p">(</span><span class="s">&quot;file.txt&quot;</span><span class="p">))</span>
</span><span id="__span-5-2"><a id="__codelineno-5-2" name="__codelineno-5-2" href="#__codelineno-5-2"></a><span class="p">{</span>
</span><span id="__span-5-3"><a id="__codelineno-5-3" name="__codelineno-5-3" href="#__codelineno-5-3"></a><span class="w"> </span><span class="k">using</span><span class="w"> </span><span class="nn">var</span><span class="w"> </span><span class="n">reader</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">File</span><span class="p">.</span><span class="n">OpenText</span><span class="w"> </span><span class="p">(</span><span class="s">&quot;file.txt&quot;</span><span class="p">);</span>
</span><span id="__span-5-4"><a id="__codelineno-5-4" name="__codelineno-5-4" href="#__codelineno-5-4"></a><span class="w"> </span><span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="w"> </span><span class="p">(</span><span class="n">reader</span><span class="p">.</span><span class="n">ReadLine</span><span class="p">());</span>
</span><span id="__span-5-5"><a id="__codelineno-5-5" name="__codelineno-5-5" href="#__codelineno-5-5"></a><span class="w"> </span><span class="p">...</span>
</span><span id="__span-5-6"><a id="__codelineno-5-6" name="__codelineno-5-6" href="#__codelineno-5-6"></a><span class="p">}</span>
</span></code></pre></div>
<p>In this case, reader will be disposed when execution falls outside the if statement
block.</p>
<h3 id="readonly-members">Readonly members</h3>
<p>C# 8 lets you apply the readonly modifier to a structâ€™s functions, ensuring that if the
function attempts to modify any field, a compile-time error is generated:</p>
<div class="language-csharp highlight"><pre><span></span><code><span id="__span-6-1"><a id="__codelineno-6-1" name="__codelineno-6-1" href="#__codelineno-6-1"></a><span class="k">struct</span><span class="w"> </span><span class="nc">Point</span>
</span><span id="__span-6-2"><a id="__codelineno-6-2" name="__codelineno-6-2" href="#__codelineno-6-2"></a><span class="p">{</span>
</span><span id="__span-6-3"><a id="__codelineno-6-3" name="__codelineno-6-3" href="#__codelineno-6-3"></a><span class="w"> </span><span class="k">public</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">X</span><span class="p">,</span><span class="w"> </span><span class="n">Y</span><span class="p">;</span>
</span><span id="__span-6-4"><a id="__codelineno-6-4" name="__codelineno-6-4" href="#__codelineno-6-4"></a><span class="w"> </span><span class="k">public</span><span class="w"> </span><span class="k">readonly</span><span class="w"> </span><span class="k">void</span><span class="w"> </span><span class="nf">ResetX</span><span class="p">()</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="n">X</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="c1">// Error!</span>
</span><span id="__span-6-5"><a id="__codelineno-6-5" name="__codelineno-6-5" href="#__codelineno-6-5"></a><span class="p">}</span>
</span></code></pre></div>
<p>If a readonly function calls a non-readonly function, the compiler generates a
warning (and defensively copies the struct to avoid the possibility of a mutation).</p>
<h3 id="static-local-methods">Static local methods</h3>
<p>Adding the <code>static</code> modifier to a local method prevents it from seeing the local variables and parameters of the enclosing method. This helps to reduce coupling as well as enabling the local method to declare variables as it pleases, without risk of colliding with those in the containing method.</p>
<h3 id="default-interface-members">Default interface members</h3>
<p>C# 8 lets you add a default implementation to an interface member, making it optional to implement:</p>
<div class="language-csharp highlight"><pre><span></span><code><span id="__span-7-1"><a id="__codelineno-7-1" name="__codelineno-7-1" href="#__codelineno-7-1"></a><span class="k">interface</span><span class="w"> </span><span class="n">ILogger</span>
</span><span id="__span-7-2"><a id="__codelineno-7-2" name="__codelineno-7-2" href="#__codelineno-7-2"></a><span class="p">{</span>
</span><span id="__span-7-3"><a id="__codelineno-7-3" name="__codelineno-7-3" href="#__codelineno-7-3"></a><span class="w"> </span><span class="k">void</span><span class="w"> </span><span class="nf">Log</span><span class="w"> </span><span class="p">(</span><span class="kt">string</span><span class="w"> </span><span class="n">text</span><span class="p">)</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="w"> </span><span class="p">(</span><span class="n">text</span><span class="p">);</span>
</span><span id="__span-7-4"><a id="__codelineno-7-4" name="__codelineno-7-4" href="#__codelineno-7-4"></a><span class="p">}</span>
</span></code></pre></div>
<h3 id="switch-expressions">Switch expressions</h3>
<div class="language-csharp highlight"><pre><span></span><code><span id="__span-8-1"><a id="__codelineno-8-1" name="__codelineno-8-1" href="#__codelineno-8-1"></a><span class="kt">string</span><span class="w"> </span><span class="n">cardName</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">cardNumber</span><span class="w"> </span><span class="k">switch</span><span class="w"> </span><span class="c1">// assuming cardNumber is an int</span>
</span><span id="__span-8-2"><a id="__codelineno-8-2" name="__codelineno-8-2" href="#__codelineno-8-2"></a><span class="p">{</span>
</span><span id="__span-8-3"><a id="__codelineno-8-3" name="__codelineno-8-3" href="#__codelineno-8-3"></a><span class="w"> </span><span class="mi">13</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="s">&quot;King&quot;</span><span class="p">,</span>
</span><span id="__span-8-4"><a id="__codelineno-8-4" name="__codelineno-8-4" href="#__codelineno-8-4"></a><span class="w"> </span><span class="mi">12</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="s">&quot;Queen&quot;</span><span class="p">,</span>
</span><span id="__span-8-5"><a id="__codelineno-8-5" name="__codelineno-8-5" href="#__codelineno-8-5"></a><span class="w"> </span><span class="mi">11</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="s">&quot;Jack&quot;</span><span class="p">,</span>
</span><span id="__span-8-6"><a id="__codelineno-8-6" name="__codelineno-8-6" href="#__codelineno-8-6"></a><span class="w"> </span><span class="n">_</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="s">&quot;Pip card&quot;</span><span class="w"> </span><span class="c1">// equivalent to &#39;default&#39;</span>
</span><span id="__span-8-7"><a id="__codelineno-8-7" name="__codelineno-8-7" href="#__codelineno-8-7"></a><span class="p">};</span>
</span></code></pre></div>
<h3 id="tuple-positional-and-property-patterns">Tuple, positional, and property patterns</h3>
<div class="language-csharp highlight"><pre><span></span><code><span id="__span-9-1"><a id="__codelineno-9-1" name="__codelineno-9-1" href="#__codelineno-9-1"></a><span class="kt">int</span><span class="w"> </span><span class="n">cardNumber</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">12</span><span class="p">;</span><span class="w"> </span><span class="kt">string</span><span class="w"> </span><span class="n">suite</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;spades&quot;</span><span class="p">;</span>
</span><span id="__span-9-2"><a id="__codelineno-9-2" name="__codelineno-9-2" href="#__codelineno-9-2"></a><span class="kt">string</span><span class="w"> </span><span class="n">cardName</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">cardNumber</span><span class="p">,</span><span class="w"> </span><span class="n">suite</span><span class="p">)</span><span class="w"> </span><span class="k">switch</span>
</span><span id="__span-9-3"><a id="__codelineno-9-3" name="__codelineno-9-3" href="#__codelineno-9-3"></a><span class="p">{</span>
</span><span id="__span-9-4"><a id="__codelineno-9-4" name="__codelineno-9-4" href="#__codelineno-9-4"></a><span class="w"> </span><span class="p">(</span><span class="mi">13</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;spades&quot;</span><span class="p">)</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="s">&quot;King of spades&quot;</span><span class="p">,</span>
</span><span id="__span-9-5"><a id="__codelineno-9-5" name="__codelineno-9-5" href="#__codelineno-9-5"></a><span class="w"> </span><span class="p">(</span><span class="mi">13</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;clubs&quot;</span><span class="p">)</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="s">&quot;King of clubs&quot;</span><span class="p">,</span>
</span><span id="__span-9-6"><a id="__codelineno-9-6" name="__codelineno-9-6" href="#__codelineno-9-6"></a><span class="w"> </span><span class="p">...</span>
</span><span id="__span-9-7"><a id="__codelineno-9-7" name="__codelineno-9-7" href="#__codelineno-9-7"></a><span class="p">};</span>
</span></code></pre></div>
<h3 id="nullable-reference-types">Nullable reference types</h3>
<div class="language-csharp highlight"><pre><span></span><code><span id="__span-10-1"><a id="__codelineno-10-1" name="__codelineno-10-1" href="#__codelineno-10-1"></a><span class="err">#</span><span class="n">nullable</span><span class="w"> </span><span class="n">enable</span><span class="w"> </span><span class="c1">// Enable nullable reference types from this point on</span>
</span><span id="__span-10-2"><a id="__codelineno-10-2" name="__codelineno-10-2" href="#__codelineno-10-2"></a><span class="kt">string</span><span class="w"> </span><span class="n">s1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">null</span><span class="p">;</span><span class="w"> </span><span class="c1">// Generates a compiler warning! (s1 is non-nullable)</span>
</span><span id="__span-10-3"><a id="__codelineno-10-3" name="__codelineno-10-3" href="#__codelineno-10-3"></a><span class="kt">string?</span><span class="w"> </span><span class="n">s2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">null</span><span class="p">;</span><span class="w"> </span><span class="c1">// OK: s2 is nullable reference type</span>
</span></code></pre></div>
<h3 id="asynchronous-streams">Asynchronous streams</h3>
<div class="language-csharp highlight"><pre><span></span><code><span id="__span-11-1"><a id="__codelineno-11-1" name="__codelineno-11-1" href="#__codelineno-11-1"></a><span class="k">async</span><span class="w"> </span><span class="n">IAsyncEnumerable</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span><span class="w"> </span><span class="n">RangeAsync</span><span class="w"> </span><span class="p">(</span>
</span><span id="__span-11-2"><a id="__codelineno-11-2" name="__codelineno-11-2" href="#__codelineno-11-2"></a><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">start</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">count</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">delay</span><span class="p">)</span>
</span><span id="__span-11-3"><a id="__codelineno-11-3" name="__codelineno-11-3" href="#__codelineno-11-3"></a><span class="p">{</span>
</span><span id="__span-11-4"><a id="__codelineno-11-4" name="__codelineno-11-4" href="#__codelineno-11-4"></a><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">start</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">start</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">count</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="o">++</span><span class="p">)</span>
</span><span id="__span-11-5"><a id="__codelineno-11-5" name="__codelineno-11-5" href="#__codelineno-11-5"></a><span class="w"> </span><span class="p">{</span>
</span><span id="__span-11-6"><a id="__codelineno-11-6" name="__codelineno-11-6" href="#__codelineno-11-6"></a><span class="w"> </span><span class="k">await</span><span class="w"> </span><span class="n">Task</span><span class="p">.</span><span class="n">Delay</span><span class="w"> </span><span class="p">(</span><span class="n">delay</span><span class="p">);</span>
</span><span id="__span-11-7"><a id="__codelineno-11-7" name="__codelineno-11-7" href="#__codelineno-11-7"></a><span class="w"> </span><span class="k">yield</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="n">i</span><span class="p">;</span>
</span><span id="__span-11-8"><a id="__codelineno-11-8" name="__codelineno-11-8" href="#__codelineno-11-8"></a><span class="w"> </span><span class="p">}</span>
</span><span id="__span-11-9"><a id="__codelineno-11-9" name="__codelineno-11-9" href="#__codelineno-11-9"></a><span class="p">}</span>
</span></code></pre></div>
<hr />
<h1 id="whats-new-in-c-70"><strong>Whatâ€™s New in C# 7.0</strong></h1>
<h3 id="numeric-literal-improvements"><strong>Numeric literal improvements</strong></h3>
<p>Numeric literals in C# 7 can include underscores to improve readability. These are called digit separators and are ignored by the compiler:</p>
<p>int million = 1_000_000;</p>
<h3 id="patterns"><strong>Patterns</strong></h3>
<p>You can also introduce variables on the fly with the is operator. These are called pattern variables</p>
<div class="language-csharp highlight"><pre><span></span><code><span id="__span-12-1"><a id="__codelineno-12-1" name="__codelineno-12-1" href="#__codelineno-12-1"></a><span class="k">void</span><span class="w"> </span><span class="nf">Foo</span><span class="w"> </span><span class="p">(</span><span class="kt">object</span><span class="w"> </span><span class="n">x</span><span class="p">)</span><span class="w"> </span>
</span><span id="__span-12-2"><a id="__codelineno-12-2" name="__codelineno-12-2" href="#__codelineno-12-2"></a><span class="p">{</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">x</span><span class="w"> </span><span class="k">is</span><span class="w"> </span><span class="kt">string</span><span class="w"> </span><span class="n">s</span><span class="p">)</span><span class="w"> </span>
</span><span id="__span-12-3"><a id="__codelineno-12-3" name="__codelineno-12-3" href="#__codelineno-12-3"></a><span class="w">  </span><span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="w"> </span><span class="p">(</span><span class="n">s</span><span class="p">.</span><span class="n">Length</span><span class="p">);</span><span class="w"> </span><span class="p">}</span><span class="w"> </span>
</span><span id="__span-12-4"><a id="__codelineno-12-4" name="__codelineno-12-4" href="#__codelineno-12-4"></a><span class="n">The</span><span class="w"> </span><span class="k">switch</span><span class="w"> </span><span class="n">statement</span><span class="w"> </span><span class="n">also</span><span class="w"> </span><span class="n">supports</span><span class="w"> </span><span class="n">patterns</span><span class="p">,</span><span class="w"> </span><span class="n">so</span><span class="w"> </span><span class="n">you</span><span class="w"> </span><span class="n">can</span><span class="w"> </span><span class="k">switch</span><span class="w"> </span><span class="k">on</span><span class="w"> </span><span class="n">type</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">well</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">constants</span>
</span><span id="__span-12-5"><a id="__codelineno-12-5" name="__codelineno-12-5" href="#__codelineno-12-5"></a><span class="k">switch</span><span class="w"> </span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="w"> </span>
</span><span id="__span-12-6"><a id="__codelineno-12-6" name="__codelineno-12-6" href="#__codelineno-12-6"></a><span class="p">{</span><span class="w"> </span><span class="k">case</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">i</span><span class="p">:</span>
</span><span id="__span-12-7"><a id="__codelineno-12-7" name="__codelineno-12-7" href="#__codelineno-12-7"></a><span class="w"> </span><span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="w"> </span><span class="p">(</span><span class="s">&quot;It&#39;s an int!&quot;</span><span class="p">);</span>
</span><span id="__span-12-8"><a id="__codelineno-12-8" name="__codelineno-12-8" href="#__codelineno-12-8"></a><span class="w"> </span><span class="k">break</span><span class="p">;</span>
</span><span id="__span-12-9"><a id="__codelineno-12-9" name="__codelineno-12-9" href="#__codelineno-12-9"></a><span class="w"> </span><span class="k">case</span><span class="w"> </span><span class="kt">string</span><span class="w"> </span><span class="n">s</span><span class="p">:</span><span class="w">  </span>
</span><span id="__span-12-10"><a id="__codelineno-12-10" name="__codelineno-12-10" href="#__codelineno-12-10"></a><span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="w"> </span><span class="p">(</span><span class="n">s</span><span class="p">.</span><span class="n">Length</span><span class="p">);</span><span class="w">  </span><span class="c1">// We can use the s variable  </span>
</span><span id="__span-12-11"><a id="__codelineno-12-11" name="__codelineno-12-11" href="#__codelineno-12-11"></a><span class="k">break</span><span class="p">;</span><span class="w"> </span>
</span><span id="__span-12-12"><a id="__codelineno-12-12" name="__codelineno-12-12" href="#__codelineno-12-12"></a><span class="k">case</span><span class="w"> </span><span class="kt">bool</span><span class="w"> </span><span class="n">b</span><span class="w"> </span><span class="k">when</span><span class="w"> </span><span class="n">b</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="k">true</span><span class="p">:</span><span class="w">    </span><span class="c1">// Matches only when b is true  </span>
</span><span id="__span-12-13"><a id="__codelineno-12-13" name="__codelineno-12-13" href="#__codelineno-12-13"></a><span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="w"> </span><span class="p">(</span><span class="s">&quot;True&quot;</span><span class="p">);</span><span class="w">  </span>
</span><span id="__span-12-14"><a id="__codelineno-12-14" name="__codelineno-12-14" href="#__codelineno-12-14"></a><span class="w"> </span><span class="k">break</span><span class="p">;</span><span class="w"> </span>
</span><span id="__span-12-15"><a id="__codelineno-12-15" name="__codelineno-12-15" href="#__codelineno-12-15"></a><span class="k">case</span><span class="w"> </span><span class="k">null</span><span class="p">:</span><span class="w">  </span>
</span><span id="__span-12-16"><a id="__codelineno-12-16" name="__codelineno-12-16" href="#__codelineno-12-16"></a><span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="w"> </span><span class="p">(</span><span class="s">&quot;Nothing&quot;</span><span class="p">);</span><span class="w">  </span>
</span><span id="__span-12-17"><a id="__codelineno-12-17" name="__codelineno-12-17" href="#__codelineno-12-17"></a><span class="k">break</span><span class="p">;</span><span class="w"> </span><span class="p">}</span>
</span></code></pre></div>
<h3 id="local-methods"><strong>Local methods</strong></h3>
<p>A local method is a method declared inside another function</p>
<div class="language-csharp highlight"><pre><span></span><code><span id="__span-13-1"><a id="__codelineno-13-1" name="__codelineno-13-1" href="#__codelineno-13-1"></a><span class="k">void</span><span class="w"> </span><span class="nf">WriteCubes</span><span class="p">()</span>
</span><span id="__span-13-2"><a id="__codelineno-13-2" name="__codelineno-13-2" href="#__codelineno-13-2"></a><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="w"> </span><span class="p">(</span><span class="n">Cube</span><span class="w"> </span><span class="p">(</span><span class="mi">3</span><span class="p">));</span>
</span><span id="__span-13-3"><a id="__codelineno-13-3" name="__codelineno-13-3" href="#__codelineno-13-3"></a><span class="w">  </span><span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="w"> </span><span class="p">(</span><span class="n">Cube</span><span class="w"> </span><span class="p">(</span><span class="mi">4</span><span class="p">));</span><span class="w"> </span>
</span><span id="__span-13-4"><a id="__codelineno-13-4" name="__codelineno-13-4" href="#__codelineno-13-4"></a><span class="w">  </span><span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="w"> </span><span class="p">(</span><span class="n">Cube</span><span class="w"> </span><span class="p">(</span><span class="mi">5</span><span class="p">));</span>
</span><span id="__span-13-5"><a id="__codelineno-13-5" name="__codelineno-13-5" href="#__codelineno-13-5"></a><span class="w">  </span><span class="kt">int</span><span class="w"> </span><span class="nf">Cube</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="k">value</span><span class="p">)</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="k">value</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">value</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">value</span><span class="p">;</span><span class="w"> </span><span class="p">}</span>
</span></code></pre></div>
<h3 id="deconstructors">Deconstructors</h3>
<div class="language-csharp highlight"><pre><span></span><code><span id="__span-14-1"><a id="__codelineno-14-1" name="__codelineno-14-1" href="#__codelineno-14-1"></a><span class="k">public</span><span class="w"> </span><span class="k">void</span><span class="w"> </span><span class="nf">Deconstruct</span><span class="w"> </span><span class="p">(</span><span class="k">out</span><span class="w"> </span><span class="kt">string</span><span class="w"> </span><span class="n">firstName</span><span class="p">,</span><span class="w"> </span><span class="k">out</span><span class="w"> </span><span class="kt">string</span><span class="w"> </span><span class="n">lastName</span><span class="p">)</span>
</span><span id="__span-14-2"><a id="__codelineno-14-2" name="__codelineno-14-2" href="#__codelineno-14-2"></a><span class="p">{</span>
</span><span id="__span-14-3"><a id="__codelineno-14-3" name="__codelineno-14-3" href="#__codelineno-14-3"></a><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">spacePos</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">name</span><span class="p">.</span><span class="n">IndexOf</span><span class="w"> </span><span class="p">(</span><span class="sc">&#39; &#39;</span><span class="p">);</span>
</span><span id="__span-14-4"><a id="__codelineno-14-4" name="__codelineno-14-4" href="#__codelineno-14-4"></a><span class="w"> </span><span class="n">firstName</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">name</span><span class="p">.</span><span class="n">Substring</span><span class="w"> </span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="n">spacePos</span><span class="p">);</span>
</span><span id="__span-14-5"><a id="__codelineno-14-5" name="__codelineno-14-5" href="#__codelineno-14-5"></a><span class="w"> </span><span class="n">lastName</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">name</span><span class="p">.</span><span class="n">Substring</span><span class="w"> </span><span class="p">(</span><span class="n">spacePos</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="p">);</span>
</span><span id="__span-14-6"><a id="__codelineno-14-6" name="__codelineno-14-6" href="#__codelineno-14-6"></a><span class="p">}</span>
</span><span id="__span-14-7"><a id="__codelineno-14-7" name="__codelineno-14-7" href="#__codelineno-14-7"></a><span class="kt">var</span><span class="w"> </span><span class="n">joe</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">Person</span><span class="w"> </span><span class="p">(</span><span class="s">&quot;Joe Bloggs&quot;</span><span class="p">);</span>
</span><span id="__span-14-8"><a id="__codelineno-14-8" name="__codelineno-14-8" href="#__codelineno-14-8"></a><span class="kt">var</span><span class="w"> </span><span class="p">(</span><span class="n">first</span><span class="p">,</span><span class="w"> </span><span class="n">last</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">joe</span><span class="p">;</span><span class="w"> </span><span class="c1">// Deconstruction</span>
</span><span id="__span-14-9"><a id="__codelineno-14-9" name="__codelineno-14-9" href="#__codelineno-14-9"></a><span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="w"> </span><span class="p">(</span><span class="n">first</span><span class="p">);</span><span class="w"> </span><span class="c1">// Joe</span>
</span><span id="__span-14-10"><a id="__codelineno-14-10" name="__codelineno-14-10" href="#__codelineno-14-10"></a><span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="w"> </span><span class="p">(</span><span class="n">last</span><span class="p">);</span><span class="w"> </span><span class="c1">// Bloggs</span>
</span></code></pre></div>
<h3 id="tuples">Tuples</h3>
<div class="language-csharp highlight"><pre><span></span><code><span id="__span-15-1"><a id="__codelineno-15-1" name="__codelineno-15-1" href="#__codelineno-15-1"></a><span class="kt">var</span><span class="w"> </span><span class="n">bob</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="s">&quot;Bob&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">23</span><span class="p">);</span>
</span><span id="__span-15-2"><a id="__codelineno-15-2" name="__codelineno-15-2" href="#__codelineno-15-2"></a><span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="w"> </span><span class="p">(</span><span class="n">bob</span><span class="p">.</span><span class="n">Item1</span><span class="p">);</span><span class="w"> </span><span class="c1">// Bob</span>
</span><span id="__span-15-3"><a id="__codelineno-15-3" name="__codelineno-15-3" href="#__codelineno-15-3"></a><span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="w"> </span><span class="p">(</span><span class="n">bob</span><span class="p">.</span><span class="n">Item2</span><span class="p">);</span><span class="w"> </span><span class="c1">// 23</span>
</span></code></pre></div>
<hr />
<h1 id="whats-new-in-c-60"><strong>Whatâ€™s New in C# 6.0</strong></h1>
<p><strong>Property initializers</strong></p>
<p>Property initializers : let you assign an initial value to an automatic property:</p>
<div class="language-csharp highlight"><pre><span></span><code><span id="__span-16-1"><a id="__codelineno-16-1" name="__codelineno-16-1" href="#__codelineno-16-1"></a><span class="k">public</span><span class="w"> </span><span class="n">DateTime</span><span class="w"> </span><span class="n">TimeCreated</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">get</span><span class="p">;</span><span class="w"> </span><span class="k">set</span><span class="p">;</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="o">=</span><span class="n">DateTime</span><span class="p">.</span><span class="n">Now</span><span class="p">;</span>
</span></code></pre></div>
<p>Initialized properties can also be read-only:</p>
<div class="language-csharp highlight"><pre><span></span><code><span id="__span-17-1"><a id="__codelineno-17-1" name="__codelineno-17-1" href="#__codelineno-17-1"></a><span class="k">public</span><span class="w"> </span><span class="n">DateTime</span><span class="w"> </span><span class="n">TimeCreated</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">get</span><span class="p">;</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">DateTime</span><span class="p">.</span><span class="n">Now</span><span class="p">;</span>
</span></code></pre></div>
<p><strong>String interpolation</strong> </p>
<p>offers a succinct alternative to string.Format:</p>
<div class="language-csharp highlight"><pre><span></span><code><span id="__span-18-1"><a id="__codelineno-18-1" name="__codelineno-18-1" href="#__codelineno-18-1"></a><span class="kt">string</span><span class="w"> </span><span class="n">s</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">$&quot;It is {DateTime.Now.DayOfWeek} today&quot;</span>
</span></code></pre></div>
<p><strong>Namespaces</strong></p>
<p>A namespace is a domain for type names. Types are typically organized into hierarchical namespaces, making them easier to find and avoiding conflicts</p>
<ul>
<li>Namespaces are independent of assemblies, which are units of deployment such as an .exe or .dll</li>
<li>Namespaces also have no impact on member visibilityâ€”public, internal, private, and so on.</li>
</ul>
<p>The namepace keyword defines a namespace for types within that block.</p>
<p>For example:</p>
<div class="language-csharp highlight"><pre><span></span><code><span id="__span-19-1"><a id="__codelineno-19-1" name="__codelineno-19-1" href="#__codelineno-19-1"></a><span class="k">namespace</span><span class="w"> </span><span class="nn">Outer.Middle.Inner</span><span class="w"> </span>
</span><span id="__span-19-2"><a id="__codelineno-19-2" name="__codelineno-19-2" href="#__codelineno-19-2"></a><span class="p">{</span>
</span><span id="__span-19-3"><a id="__codelineno-19-3" name="__codelineno-19-3" href="#__codelineno-19-3"></a><span class="w"> </span><span class="k">class</span><span class="w"> </span><span class="nc">Class1</span><span class="w"> </span><span class="p">{}</span><span class="w">  </span>
</span><span id="__span-19-4"><a id="__codelineno-19-4" name="__codelineno-19-4" href="#__codelineno-19-4"></a><span class="k">class</span><span class="w"> </span><span class="nc">Class2</span><span class="w"> </span><span class="p">{}</span><span class="w"> </span>
</span><span id="__span-19-5"><a id="__codelineno-19-5" name="__codelineno-19-5" href="#__codelineno-19-5"></a><span class="p">}</span>
</span></code></pre></div>
<p>The dots in the namespace indicate a hierarchy of nested namespaces. The code that follows is semantically identical to the preceding example:</p>
<div class="language-csharp highlight"><pre><span></span><code><span id="__span-20-1"><a id="__codelineno-20-1" name="__codelineno-20-1" href="#__codelineno-20-1"></a><span class="k">namespace</span><span class="w"> </span><span class="nn">Outer</span><span class="w"> </span>
</span><span id="__span-20-2"><a id="__codelineno-20-2" name="__codelineno-20-2" href="#__codelineno-20-2"></a><span class="p">{</span><span class="w">  </span>
</span><span id="__span-20-3"><a id="__codelineno-20-3" name="__codelineno-20-3" href="#__codelineno-20-3"></a><span class="w">    </span><span class="k">namespace</span><span class="w"> </span><span class="nn">Middle</span><span class="w"> </span>
</span><span id="__span-20-4"><a id="__codelineno-20-4" name="__codelineno-20-4" href="#__codelineno-20-4"></a><span class="w">     </span><span class="p">{</span><span class="w">    </span>
</span><span id="__span-20-5"><a id="__codelineno-20-5" name="__codelineno-20-5" href="#__codelineno-20-5"></a><span class="w">        </span><span class="k">namespace</span><span class="w"> </span><span class="nn">Inner</span><span class="w">    </span>
</span><span id="__span-20-6"><a id="__codelineno-20-6" name="__codelineno-20-6" href="#__codelineno-20-6"></a><span class="w">        </span><span class="p">{</span><span class="w">     </span>
</span><span id="__span-20-7"><a id="__codelineno-20-7" name="__codelineno-20-7" href="#__codelineno-20-7"></a><span class="w">         </span><span class="k">class</span><span class="w"> </span><span class="nc">Class1</span><span class="w"> </span><span class="p">{}</span><span class="w">      </span>
</span><span id="__span-20-8"><a id="__codelineno-20-8" name="__codelineno-20-8" href="#__codelineno-20-8"></a><span class="w">        </span><span class="k">class</span><span class="w"> </span><span class="nc">Class2</span><span class="w"> </span><span class="p">{}</span><span class="w">    </span>
</span><span id="__span-20-9"><a id="__codelineno-20-9" name="__codelineno-20-9" href="#__codelineno-20-9"></a><span class="w">        </span><span class="p">}</span><span class="w"> </span>
</span><span id="__span-20-10"><a id="__codelineno-20-10" name="__codelineno-20-10" href="#__codelineno-20-10"></a><span class="w">     </span><span class="p">}</span>
</span><span id="__span-20-11"><a id="__codelineno-20-11" name="__codelineno-20-11" href="#__codelineno-20-11"></a><span class="w"> </span><span class="p">}</span>
</span></code></pre></div>
<hr />
<h2 id="writing-a-class-versus-an-interface">Writing a Class Versus an Interface</h2>
<p>As a guideline:</p>
<p>â€¢ Use classes and subclasses for types that naturally share an implementation.</p>
<p>â€¢ Use interfaces for types that have independent implementations.</p>
<h3 id="consider-the-following-classes">Consider the following classes</h3>
<div class="language-csharp highlight"><pre><span></span><code><span id="__span-21-1"><a id="__codelineno-21-1" name="__codelineno-21-1" href="#__codelineno-21-1"></a><span class="k">abstract</span><span class="w"> </span><span class="k">class</span><span class="w"> </span><span class="nc">Animal</span><span class="w"> </span><span class="p">{}</span><span class="w"> </span>
</span><span id="__span-21-2"><a id="__codelineno-21-2" name="__codelineno-21-2" href="#__codelineno-21-2"></a><span class="k">abstract</span><span class="w"> </span><span class="k">class</span><span class="w"> </span><span class="nc">Bird</span><span class="w">      </span><span class="p">:</span><span class="w"> </span><span class="n">Animal</span><span class="w"> </span><span class="p">{}</span>
</span><span id="__span-21-3"><a id="__codelineno-21-3" name="__codelineno-21-3" href="#__codelineno-21-3"></a><span class="k">abstract</span><span class="w"> </span><span class="k">class</span><span class="w"> </span><span class="nc">Insect</span><span class="w">     </span><span class="p">:</span><span class="w"> </span><span class="n">Animal</span><span class="w"> </span><span class="p">{}</span><span class="w"> </span>
</span><span id="__span-21-4"><a id="__codelineno-21-4" name="__codelineno-21-4" href="#__codelineno-21-4"></a><span class="k">abstract</span><span class="w"> </span><span class="k">class</span><span class="w"> </span><span class="nc">FlyingCreature</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="n">Animal</span><span class="w"> </span><span class="p">{}</span><span class="w"> </span>
</span><span id="__span-21-5"><a id="__codelineno-21-5" name="__codelineno-21-5" href="#__codelineno-21-5"></a><span class="k">abstract</span><span class="w"> </span><span class="k">class</span><span class="w"> </span><span class="nc">Carnivore</span><span class="w">   </span><span class="p">:</span><span class="w"> </span><span class="n">Animal</span><span class="w"> </span><span class="p">{}</span>
</span><span id="__span-21-6"><a id="__codelineno-21-6" name="__codelineno-21-6" href="#__codelineno-21-6"></a>
</span><span id="__span-21-7"><a id="__codelineno-21-7" name="__codelineno-21-7" href="#__codelineno-21-7"></a><span class="c1">// Concrete classes:</span>
</span><span id="__span-21-8"><a id="__codelineno-21-8" name="__codelineno-21-8" href="#__codelineno-21-8"></a><span class="k">class</span><span class="w"> </span><span class="nc">Ostrich</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="n">Bird</span><span class="w"> </span><span class="p">{}</span>
</span><span id="__span-21-9"><a id="__codelineno-21-9" name="__codelineno-21-9" href="#__codelineno-21-9"></a><span class="k">class</span><span class="w"> </span><span class="nc">Eagle</span><span class="w">  </span><span class="p">:</span><span class="w"> </span><span class="n">Bird</span><span class="p">,</span><span class="w"> </span><span class="n">FlyingCreature</span><span class="p">,</span><span class="w"> </span><span class="n">Carnivore</span><span class="w"> </span><span class="p">{}</span><span class="w"> </span><span class="c1">// Illegal </span>
</span><span id="__span-21-10"><a id="__codelineno-21-10" name="__codelineno-21-10" href="#__codelineno-21-10"></a><span class="k">class</span><span class="w"> </span><span class="nc">Bee</span><span class="w">   </span><span class="p">:</span><span class="w"> </span><span class="n">Insect</span><span class="p">,</span><span class="w"> </span><span class="n">FlyingCreature</span><span class="w"> </span><span class="p">{}</span><span class="w">      </span><span class="c1">// Illegal </span>
</span><span id="__span-21-11"><a id="__codelineno-21-11" name="__codelineno-21-11" href="#__codelineno-21-11"></a><span class="k">class</span><span class="w"> </span><span class="nc">Flea</span><span class="w">  </span><span class="p">:</span><span class="w"> </span><span class="n">Insect</span><span class="p">,</span><span class="w"> </span><span class="n">Carnivore</span><span class="w"> </span><span class="p">{}</span><span class="w">        </span><span class="c1">// Illegal</span>
</span><span id="__span-21-12"><a id="__codelineno-21-12" name="__codelineno-21-12" href="#__codelineno-21-12"></a>
</span><span id="__span-21-13"><a id="__codelineno-21-13" name="__codelineno-21-13" href="#__codelineno-21-13"></a><span class="c1">// The Eagle, Bee, and Flea classes do not compile because inheriting from multiple classes is prohibited. To resolve this, we must convert some of the types to interfaces. The question then arises, which types? Following our general rule, we could say that insects share an implementation, and birds share an implementation, so they remain classes. In contrast, flying creatures have independent mechanisms for flying, and carnivores have independent strategies for eating animals, so we would convert FlyingCreature and Carnivore to interfaces</span>
</span><span id="__span-21-14"><a id="__codelineno-21-14" name="__codelineno-21-14" href="#__codelineno-21-14"></a><span class="k">interface</span><span class="w"> </span><span class="n">IFlyingCreature</span><span class="w"> </span><span class="p">{}</span>
</span><span id="__span-21-15"><a id="__codelineno-21-15" name="__codelineno-21-15" href="#__codelineno-21-15"></a><span class="k">interface</span><span class="w"> </span><span class="n">ICarnivore</span><span class="w">   </span><span class="p">{}</span>
</span></code></pre></div>
<p>In a typical scenario, Bird and Insect might correspond to a Windows control and a web control; FlyingCreature and Carnivore might correspond to IPrintable and IUndoable.</p>
<hr />
<h2 id="enums">Enums</h2>
<p>An enum is a special value type that lets you specify a group of named numeric constants. For example :</p>
<div class="language-csharp highlight"><pre><span></span><code><span id="__span-22-1"><a id="__codelineno-22-1" name="__codelineno-22-1" href="#__codelineno-22-1"></a><span class="k">public</span><span class="w"> </span><span class="k">enum</span><span class="w"> </span><span class="n">BorderSide</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">Left</span><span class="p">,</span><span class="w"> </span><span class="n">Right</span><span class="p">,</span><span class="w"> </span><span class="n">Top</span><span class="p">,</span><span class="w"> </span><span class="n">Bottom</span><span class="w"> </span><span class="p">}</span>
</span></code></pre></div>
<ul>
<li>Each enum member has an underlying integral value. By default Underlying values are of type int.</li>
<li>The constants 0, 1, 2... are automatically assigned, in the declaration order of
the enum members.</li>
</ul>
<p>You can convert an enum instance to and from its underlying integral value with an
explicit cast:</p>
<div class="language-csharp highlight"><pre><span></span><code><span id="__span-23-1"><a id="__codelineno-23-1" name="__codelineno-23-1" href="#__codelineno-23-1"></a><span class="kt">int</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="p">)</span><span class="w"> </span><span class="n">BorderSide</span><span class="p">.</span><span class="n">Left</span><span class="p">;</span><span class="w"> </span>
</span><span id="__span-23-2"><a id="__codelineno-23-2" name="__codelineno-23-2" href="#__codelineno-23-2"></a><span class="n">BorderSide</span><span class="w"> </span><span class="n">side</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">BorderSide</span><span class="p">)</span><span class="w"> </span><span class="n">i</span><span class="p">;</span><span class="w"> </span>
</span><span id="__span-23-3"><a id="__codelineno-23-3" name="__codelineno-23-3" href="#__codelineno-23-3"></a><span class="kt">bool</span><span class="w"> </span><span class="n">leftOrRight</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="p">)</span><span class="w"> </span><span class="n">side</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="mi">2</span><span class="p">;</span>
</span></code></pre></div>
<p>The numeric literal 0 is treated specially by the compiler in an enum expression and does not require an explicit cast:</p>
<p><code>BorderSide b = 0; // No cast required if (b == 0) â€¦</code></p>
<p>There are two reasons for the special treatment of 0:</p>
<ul>
<li>The first member of an enum is often used as the â€œdefaultâ€ value.</li>
<li>For combined enum types, 0 means â€œno flags.â€# Chapter 10 : LINQ to XML</li>
</ul>
<h1 id="overview">Overview</h1>
<p>NET Core provides a number of APIs for working with XML data. The primary choice for general-purpose XML document processing is LINQ to XML. LINQ to XML comprises a lightweight, LINQ-friendly XML document object model, plus a set of supplementary query operators.</p>
<aside>
âœï¸ The LINQ to XML Document Object Model (DOM) is extremely well designed and highly performant. Even without LINQ, the LINQ to XML DOM is valuable as a lightweight
faÃ§ade over the low-level XmlReader and XmlWriter classes

</aside>

<p>All LINQ to XML types are defined in the <code>System.Xml.Linq</code> namespace.</p>
<h1 id="architectural-overview">Architectural Overview</h1>
<p>This section starts with a very brief introduction to the concept of a DOM, and then
explains the rationale behind LINQ to XMLâ€™s DOM.</p>
<h3 id="what-is-a-dom">What Is a DOM?</h3>
<div class="language-xml highlight"><pre><span></span><code><span id="__span-24-1"><a id="__codelineno-24-1" name="__codelineno-24-1" href="#__codelineno-24-1"></a><span class="cp">&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;</span>
</span><span id="__span-24-2"><a id="__codelineno-24-2" name="__codelineno-24-2" href="#__codelineno-24-2"></a><span class="nt">&lt;customer</span><span class="w"> </span><span class="na">id=</span><span class="s">&quot;123&quot;</span><span class="w"> </span><span class="na">status=</span><span class="s">&quot;archived&quot;</span><span class="nt">&gt;</span>
</span><span id="__span-24-3"><a id="__codelineno-24-3" name="__codelineno-24-3" href="#__codelineno-24-3"></a><span class="w"> </span><span class="nt">&lt;firstname&gt;</span>Joe<span class="nt">&lt;/firstname&gt;</span>
</span><span id="__span-24-4"><a id="__codelineno-24-4" name="__codelineno-24-4" href="#__codelineno-24-4"></a><span class="w"> </span><span class="nt">&lt;lastname&gt;</span>Bloggs<span class="nt">&lt;/lastname&gt;</span>
</span><span id="__span-24-5"><a id="__codelineno-24-5" name="__codelineno-24-5" href="#__codelineno-24-5"></a><span class="nt">&lt;/customer&gt;</span>
</span></code></pre></div>
<p>As with all XML files, we start with a declaration and then a root element, whose name is customer. The customer element has two attributes, each with a name (id and status) and value ("123" and "archived"). Within customer, there are two child elements, firstname and lastname, each having simple text content ("Joe" and "Bloggs").</p>
<h3 id="the-linq-to-xml-dom">The LINQ to XML DOM</h3>
<p>LINQ to XML comprises two things</p>
<ul>
<li>An XML DOM, which we call the X-DOM</li>
<li>A set of about 10 supplementary query operators</li>
</ul>
<p>As you might expect, the X-DOM consists of types such as XDocument, XElement, and XAttribute. Interestingly, the X-DOM types are not tied to LINQâ€”you can load, instantiate, update, and save an X-DOM without ever writing a LINQ query</p>
<p>The distinguishing feature of the X-DOM is that itâ€™s LINQ-friendly, meaning</p>
<ul>
<li>It has methods that emit useful IEnumerable sequences upon which you can query</li>
<li>Its constructors are designed such that you can build an X-DOM tree through a
LINQ projection.</li>
</ul>
<h1 id="x-dom-overview">X-DOM Overview</h1>
<p>The most frequently used of these types is XElement. XObject is the root of the inheritance hierarchy; XElement and XDocument are roots of the containership hierarchy.</p>
<p>X-DOM tree created from the following code:</p>
<div class="language-csharp highlight"><pre><span></span><code><span id="__span-25-1"><a id="__codelineno-25-1" name="__codelineno-25-1" href="#__codelineno-25-1"></a><span class="kt">string</span><span class="w"> </span><span class="n">xml</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">@&quot;&lt;customer id=&#39;123&#39; status=&#39;archived&#39;&gt;</span>
</span><span id="__span-25-2"><a id="__codelineno-25-2" name="__codelineno-25-2" href="#__codelineno-25-2"></a><span class="s"> &lt;firstname&gt;Joe&lt;/firstname&gt;</span>
</span><span id="__span-25-3"><a id="__codelineno-25-3" name="__codelineno-25-3" href="#__codelineno-25-3"></a><span class="s"> &lt;lastname&gt;Bloggs&lt;!--nice name--&gt;&lt;/lastname&gt;</span>
</span><span id="__span-25-4"><a id="__codelineno-25-4" name="__codelineno-25-4" href="#__codelineno-25-4"></a><span class="s"> &lt;/customer&gt;&quot;</span><span class="p">;</span>
</span><span id="__span-25-5"><a id="__codelineno-25-5" name="__codelineno-25-5" href="#__codelineno-25-5"></a><span class="n">XElement</span><span class="w"> </span><span class="n">customer</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">XElement</span><span class="p">.</span><span class="n">Parse</span><span class="w"> </span><span class="p">(</span><span class="n">xml</span><span class="p">);</span>
</span></code></pre></div>
<p>XObject is the abstract base class for all XML content. It defines a link to the Parent element in the containership tree as well as an optional XDocument.</p>
<p>XNode is the base class for most XML content excluding attributes. The distinguishing feature of XNode is that it can sit in an ordered collection of mixed-type XNodes.</p>
<div class="language-xml highlight"><pre><span></span><code><span id="__span-26-1"><a id="__codelineno-26-1" name="__codelineno-26-1" href="#__codelineno-26-1"></a><span class="nt">&lt;data&gt;</span>
</span><span id="__span-26-2"><a id="__codelineno-26-2" name="__codelineno-26-2" href="#__codelineno-26-2"></a><span class="w"> </span>Hello<span class="w"> </span>world
</span><span id="__span-26-3"><a id="__codelineno-26-3" name="__codelineno-26-3" href="#__codelineno-26-3"></a><span class="w"> </span><span class="nt">&lt;subelement1/&gt;</span>
</span><span id="__span-26-4"><a id="__codelineno-26-4" name="__codelineno-26-4" href="#__codelineno-26-4"></a><span class="w"> </span><span class="cm">&lt;!--comment--&gt;</span>
</span><span id="__span-26-5"><a id="__codelineno-26-5" name="__codelineno-26-5" href="#__codelineno-26-5"></a><span class="w"> </span><span class="nt">&lt;subelement2/&gt;</span>
</span><span id="__span-26-6"><a id="__codelineno-26-6" name="__codelineno-26-6" href="#__codelineno-26-6"></a><span class="nt">&lt;/data&gt;</span>
</span></code></pre></div>
<p>Within the parent element , thereâ€™s first an XText node (Hello world), then an XElement node, then an XComment node, and then a second XElement node. In contrast, an XAttribute will tolerate only other XAttributes as peers.</p>
<p>Although an XNode can access its parent XElement, it has no concept of child nodes : this is the job of its subclass XContainer. XContainer defines members for dealing with children and is the abstract base class for XElement and XDocument.</p>
<h3 id="loading-and-parsing">Loading and Parsing</h3>
<div class="language-csharp highlight"><pre><span></span><code><span id="__span-27-1"><a id="__codelineno-27-1" name="__codelineno-27-1" href="#__codelineno-27-1"></a><span class="n">XDocument</span><span class="w"> </span><span class="n">fromWeb</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">XDocument</span><span class="p">.</span><span class="n">Load</span><span class="w"> </span><span class="p">(</span><span class="s">&quot;http://albahari.com/sample.xml&quot;</span><span class="p">);</span>
</span><span id="__span-27-2"><a id="__codelineno-27-2" name="__codelineno-27-2" href="#__codelineno-27-2"></a><span class="n">XElement</span><span class="w"> </span><span class="n">fromFile</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">XElement</span><span class="p">.</span><span class="n">Load</span><span class="w"> </span><span class="p">(</span><span class="s">@&quot;e:\media\somefile.xml&quot;</span><span class="p">);</span>
</span><span id="__span-27-3"><a id="__codelineno-27-3" name="__codelineno-27-3" href="#__codelineno-27-3"></a><span class="n">XElement</span><span class="w"> </span><span class="n">config</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">XElement</span><span class="p">.</span><span class="n">Parse</span><span class="w"> </span><span class="p">(</span>
</span><span id="__span-27-4"><a id="__codelineno-27-4" name="__codelineno-27-4" href="#__codelineno-27-4"></a><span class="s">@&quot;&lt;configuration&gt;</span>
</span><span id="__span-27-5"><a id="__codelineno-27-5" name="__codelineno-27-5" href="#__codelineno-27-5"></a><span class="s">    &lt;client enabled=&#39;true&#39;&gt;</span>
</span><span id="__span-27-6"><a id="__codelineno-27-6" name="__codelineno-27-6" href="#__codelineno-27-6"></a><span class="s">        &lt;timeout&gt;30&lt;/timeout&gt;</span>
</span><span id="__span-27-7"><a id="__codelineno-27-7" name="__codelineno-27-7" href="#__codelineno-27-7"></a><span class="s">    &lt;/client&gt;</span>
</span><span id="__span-27-8"><a id="__codelineno-27-8" name="__codelineno-27-8" href="#__codelineno-27-8"></a><span class="s">&lt;/configuration&gt;&quot;</span><span class="p">);</span>
</span></code></pre></div>
<p>hereâ€™s how to manipulate the config element we just populated:</p>
<div class="language-csharp highlight"><pre><span></span><code><span id="__span-28-1"><a id="__codelineno-28-1" name="__codelineno-28-1" href="#__codelineno-28-1"></a><span class="k">foreach</span><span class="w"> </span><span class="p">(</span><span class="n">XElement</span><span class="w"> </span><span class="n">child</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">config</span><span class="p">.</span><span class="n">Elements</span><span class="p">())</span>
</span><span id="__span-28-2"><a id="__codelineno-28-2" name="__codelineno-28-2" href="#__codelineno-28-2"></a><span class="w"> </span><span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="w"> </span><span class="p">(</span><span class="n">child</span><span class="p">.</span><span class="n">Name</span><span class="p">);</span><span class="w"> </span><span class="c1">// client</span>
</span><span id="__span-28-3"><a id="__codelineno-28-3" name="__codelineno-28-3" href="#__codelineno-28-3"></a><span class="n">XElement</span><span class="w"> </span><span class="n">client</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">config</span><span class="p">.</span><span class="n">Element</span><span class="w"> </span><span class="p">(</span><span class="s">&quot;client&quot;</span><span class="p">);</span>
</span><span id="__span-28-4"><a id="__codelineno-28-4" name="__codelineno-28-4" href="#__codelineno-28-4"></a><span class="kt">bool</span><span class="w"> </span><span class="n">enabled</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="kt">bool</span><span class="p">)</span><span class="w"> </span><span class="n">client</span><span class="p">.</span><span class="n">Attribute</span><span class="w"> </span><span class="p">(</span><span class="s">&quot;enabled&quot;</span><span class="p">);</span><span class="w"> </span><span class="c1">// Read attribute</span>
</span><span id="__span-28-5"><a id="__codelineno-28-5" name="__codelineno-28-5" href="#__codelineno-28-5"></a><span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="w"> </span><span class="p">(</span><span class="n">enabled</span><span class="p">);</span><span class="w"> </span><span class="c1">// True</span>
</span><span id="__span-28-6"><a id="__codelineno-28-6" name="__codelineno-28-6" href="#__codelineno-28-6"></a><span class="n">client</span><span class="p">.</span><span class="n">Attribute</span><span class="w"> </span><span class="p">(</span><span class="s">&quot;enabled&quot;</span><span class="p">).</span><span class="n">SetValue</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="n">enabled</span><span class="p">);</span><span class="w"> </span><span class="c1">// Update attribute</span>
</span><span id="__span-28-7"><a id="__codelineno-28-7" name="__codelineno-28-7" href="#__codelineno-28-7"></a><span class="kt">int</span><span class="w"> </span><span class="n">timeout</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="p">)</span><span class="w"> </span><span class="n">client</span><span class="p">.</span><span class="n">Element</span><span class="w"> </span><span class="p">(</span><span class="s">&quot;timeout&quot;</span><span class="p">);</span><span class="w"> </span><span class="c1">// Read element</span>
</span><span id="__span-28-8"><a id="__codelineno-28-8" name="__codelineno-28-8" href="#__codelineno-28-8"></a><span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="w"> </span><span class="p">(</span><span class="n">timeout</span><span class="p">);</span><span class="w"> </span><span class="c1">// 30</span>
</span><span id="__span-28-9"><a id="__codelineno-28-9" name="__codelineno-28-9" href="#__codelineno-28-9"></a><span class="n">client</span><span class="p">.</span><span class="n">Element</span><span class="w"> </span><span class="p">(</span><span class="s">&quot;timeout&quot;</span><span class="p">).</span><span class="n">SetValue</span><span class="w"> </span><span class="p">(</span><span class="n">timeout</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mi">2</span><span class="p">);</span><span class="w"> </span><span class="c1">// Update element</span>
</span><span id="__span-28-10"><a id="__codelineno-28-10" name="__codelineno-28-10" href="#__codelineno-28-10"></a><span class="n">client</span><span class="p">.</span><span class="n">Add</span><span class="w"> </span><span class="p">(</span><span class="k">new</span><span class="w"> </span><span class="n">XElement</span><span class="w"> </span><span class="p">(</span><span class="s">&quot;retries&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">3</span><span class="p">));</span><span class="w"> </span><span class="c1">// Add new elememt</span>
</span><span id="__span-28-11"><a id="__codelineno-28-11" name="__codelineno-28-11" href="#__codelineno-28-11"></a><span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="w"> </span><span class="p">(</span><span class="n">config</span><span class="p">);</span><span class="w"> </span><span class="c1">// Implicitly call config.ToString()</span>
</span><span id="__span-28-12"><a id="__codelineno-28-12" name="__codelineno-28-12" href="#__codelineno-28-12"></a><span class="c1">//Hereâ€™s the result of that last Console.WriteLine:</span>
</span><span id="__span-28-13"><a id="__codelineno-28-13" name="__codelineno-28-13" href="#__codelineno-28-13"></a><span class="o">&lt;</span><span class="n">configuration</span><span class="o">&gt;</span>
</span><span id="__span-28-14"><a id="__codelineno-28-14" name="__codelineno-28-14" href="#__codelineno-28-14"></a><span class="w"> </span><span class="o">&lt;</span><span class="n">client</span><span class="w"> </span><span class="n">enabled</span><span class="o">=</span><span class="s">&quot;false&quot;</span><span class="o">&gt;</span>
</span><span id="__span-28-15"><a id="__codelineno-28-15" name="__codelineno-28-15" href="#__codelineno-28-15"></a><span class="w"> </span><span class="o">&lt;</span><span class="n">timeout</span><span class="o">&gt;</span><span class="mi">60</span><span class="o">&lt;/</span><span class="n">timeout</span><span class="o">&gt;</span>
</span><span id="__span-28-16"><a id="__codelineno-28-16" name="__codelineno-28-16" href="#__codelineno-28-16"></a><span class="w"> </span><span class="o">&lt;</span><span class="n">retries</span><span class="o">&gt;</span><span class="mi">3</span><span class="o">&lt;/</span><span class="n">retries</span><span class="o">&gt;</span>
</span><span id="__span-28-17"><a id="__codelineno-28-17" name="__codelineno-28-17" href="#__codelineno-28-17"></a><span class="w"> </span><span class="o">&lt;/</span><span class="n">client</span><span class="o">&gt;</span>
</span><span id="__span-28-18"><a id="__codelineno-28-18" name="__codelineno-28-18" href="#__codelineno-28-18"></a><span class="o">&lt;/</span><span class="n">configuration</span><span class="o">&gt;</span>
</span></code></pre></div>
<h3 id="saving-and-serializing">Saving and Serializing</h3>
<p>Calling <code>ToString</code> on any node converts its content to an XML stringâ€”formatted with line breaks and indentation as we just saw. (You can disable the line breaks and indentation by specifying <code>SaveOptions.DisableFormatting</code> when calling <code>ToString</code>.)</p>
<p>XElement and XDocument also provide a Save method that writes an X-DOM to a file, Stream, TextWriter, or XmlWriter. If you specify a file, an XML declaration is automatically written. There is also a WriteTo method defined in the XNode class, which accepts just an XmlWriter.</p>
<h1 id="instantiating-an-x-dom">Instantiating an X-DOM</h1>
<p>Rather than using the Load or Parse methods, you can build an X-DOM tree by manually instantiating objects and adding them to a parent via XContainerâ€™s Add method.</p>
<div class="language-csharp highlight"><pre><span></span><code><span id="__span-29-1"><a id="__codelineno-29-1" name="__codelineno-29-1" href="#__codelineno-29-1"></a><span class="c1">//To construct an XElement and XAttribute, simply provide a name and value:</span>
</span><span id="__span-29-2"><a id="__codelineno-29-2" name="__codelineno-29-2" href="#__codelineno-29-2"></a><span class="n">XElement</span><span class="w"> </span><span class="n">lastName</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">XElement</span><span class="w"> </span><span class="p">(</span><span class="s">&quot;lastname&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Bloggs&quot;</span><span class="p">);</span>
</span><span id="__span-29-3"><a id="__codelineno-29-3" name="__codelineno-29-3" href="#__codelineno-29-3"></a><span class="n">lastName</span><span class="p">.</span><span class="n">Add</span><span class="w"> </span><span class="p">(</span><span class="k">new</span><span class="w"> </span><span class="n">XComment</span><span class="w"> </span><span class="p">(</span><span class="s">&quot;nice name&quot;</span><span class="p">));</span>
</span><span id="__span-29-4"><a id="__codelineno-29-4" name="__codelineno-29-4" href="#__codelineno-29-4"></a><span class="n">XElement</span><span class="w"> </span><span class="n">customer</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">XElement</span><span class="w"> </span><span class="p">(</span><span class="s">&quot;customer&quot;</span><span class="p">);</span>
</span><span id="__span-29-5"><a id="__codelineno-29-5" name="__codelineno-29-5" href="#__codelineno-29-5"></a><span class="n">customer</span><span class="p">.</span><span class="n">Add</span><span class="w"> </span><span class="p">(</span><span class="k">new</span><span class="w"> </span><span class="n">XAttribute</span><span class="w"> </span><span class="p">(</span><span class="s">&quot;id&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">123</span><span class="p">));</span>
</span><span id="__span-29-6"><a id="__codelineno-29-6" name="__codelineno-29-6" href="#__codelineno-29-6"></a><span class="n">customer</span><span class="p">.</span><span class="n">Add</span><span class="w"> </span><span class="p">(</span><span class="k">new</span><span class="w"> </span><span class="n">XElement</span><span class="w"> </span><span class="p">(</span><span class="s">&quot;firstname&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Joe&quot;</span><span class="p">));</span>
</span><span id="__span-29-7"><a id="__codelineno-29-7" name="__codelineno-29-7" href="#__codelineno-29-7"></a><span class="n">customer</span><span class="p">.</span><span class="n">Add</span><span class="w"> </span><span class="p">(</span><span class="n">lastName</span><span class="p">);</span>
</span><span id="__span-29-8"><a id="__codelineno-29-8" name="__codelineno-29-8" href="#__codelineno-29-8"></a><span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="w"> </span><span class="p">(</span><span class="n">customer</span><span class="p">.</span><span class="n">ToString</span><span class="p">());</span>
</span><span id="__span-29-9"><a id="__codelineno-29-9" name="__codelineno-29-9" href="#__codelineno-29-9"></a><span class="c1">//Hereâ€™s the result:</span>
</span><span id="__span-29-10"><a id="__codelineno-29-10" name="__codelineno-29-10" href="#__codelineno-29-10"></a><span class="o">&lt;</span><span class="n">customer</span><span class="w"> </span><span class="n">id</span><span class="o">=</span><span class="s">&quot;123&quot;</span><span class="o">&gt;</span>
</span><span id="__span-29-11"><a id="__codelineno-29-11" name="__codelineno-29-11" href="#__codelineno-29-11"></a><span class="w"> </span><span class="o">&lt;</span><span class="n">firstname</span><span class="o">&gt;</span><span class="n">Joe</span><span class="o">&lt;/</span><span class="n">firstname</span><span class="o">&gt;</span>
</span><span id="__span-29-12"><a id="__codelineno-29-12" name="__codelineno-29-12" href="#__codelineno-29-12"></a><span class="w"> </span><span class="o">&lt;</span><span class="n">lastname</span><span class="o">&gt;</span><span class="n">Bloggs</span><span class="o">&lt;!--</span><span class="n">nice</span><span class="w"> </span><span class="n">name</span><span class="o">--&gt;&lt;/</span><span class="n">lastname</span><span class="o">&gt;</span>
</span><span id="__span-29-13"><a id="__codelineno-29-13" name="__codelineno-29-13" href="#__codelineno-29-13"></a><span class="o">&lt;/</span><span class="n">customer</span><span class="o">&gt;</span>
</span></code></pre></div>
<h3 id="functional-construction">Functional Construction</h3>
<p>In our preceding example, itâ€™s difficult to glean the XML structure from the code. XDOM supports another mode of instantiation, called functional construction</p>
<div class="language-csharp highlight"><pre><span></span><code><span id="__span-30-1"><a id="__codelineno-30-1" name="__codelineno-30-1" href="#__codelineno-30-1"></a><span class="n">XElement</span><span class="w"> </span><span class="n">customer</span><span class="w"> </span><span class="o">=</span>
</span><span id="__span-30-2"><a id="__codelineno-30-2" name="__codelineno-30-2" href="#__codelineno-30-2"></a><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="nf">XElement</span><span class="w"> </span><span class="p">(</span><span class="s">&quot;customer&quot;</span><span class="p">,</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">XAttribute</span><span class="w"> </span><span class="p">(</span><span class="s">&quot;id&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">123</span><span class="p">),</span>
</span><span id="__span-30-3"><a id="__codelineno-30-3" name="__codelineno-30-3" href="#__codelineno-30-3"></a><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="nf">XElement</span><span class="w"> </span><span class="p">(</span><span class="s">&quot;firstname&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;joe&quot;</span><span class="p">),</span>
</span><span id="__span-30-4"><a id="__codelineno-30-4" name="__codelineno-30-4" href="#__codelineno-30-4"></a><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="nf">XElement</span><span class="w"> </span><span class="p">(</span><span class="s">&quot;lastname&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;bloggs&quot;</span><span class="p">,</span>
</span><span id="__span-30-5"><a id="__codelineno-30-5" name="__codelineno-30-5" href="#__codelineno-30-5"></a><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="nf">XComment</span><span class="w"> </span><span class="p">(</span><span class="s">&quot;nice name&quot;</span><span class="p">)</span>
</span><span id="__span-30-6"><a id="__codelineno-30-6" name="__codelineno-30-6" href="#__codelineno-30-6"></a><span class="w"> </span><span class="p">)</span>
</span><span id="__span-30-7"><a id="__codelineno-30-7" name="__codelineno-30-7" href="#__codelineno-30-7"></a><span class="w"> </span><span class="p">);</span>
</span></code></pre></div>
<p>This has two benefits. First, the code resembles the shape of the XML. Second, it can be incorporated into the select clause of a LINQ query.</p>
<div class="language-csharp highlight"><pre><span></span><code><span id="__span-31-1"><a id="__codelineno-31-1" name="__codelineno-31-1" href="#__codelineno-31-1"></a><span class="n">XElement</span><span class="w"> </span><span class="n">query</span><span class="w"> </span><span class="o">=</span>
</span><span id="__span-31-2"><a id="__codelineno-31-2" name="__codelineno-31-2" href="#__codelineno-31-2"></a><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="nf">XElement</span><span class="w"> </span><span class="p">(</span><span class="s">&quot;customers&quot;</span><span class="p">,</span>
</span><span id="__span-31-3"><a id="__codelineno-31-3" name="__codelineno-31-3" href="#__codelineno-31-3"></a><span class="w"> </span><span class="k">from</span><span class="w"> </span><span class="n">c</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">dbContext</span><span class="p">.</span><span class="n">Customers</span><span class="p">.</span><span class="n">AsEnumerable</span><span class="p">()</span>
</span><span id="__span-31-4"><a id="__codelineno-31-4" name="__codelineno-31-4" href="#__codelineno-31-4"></a><span class="w"> </span><span class="k">select</span>
</span><span id="__span-31-5"><a id="__codelineno-31-5" name="__codelineno-31-5" href="#__codelineno-31-5"></a><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="nf">XElement</span><span class="w"> </span><span class="p">(</span><span class="s">&quot;customer&quot;</span><span class="p">,</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">XAttribute</span><span class="w"> </span><span class="p">(</span><span class="s">&quot;id&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">c</span><span class="p">.</span><span class="n">ID</span><span class="p">),</span>
</span><span id="__span-31-6"><a id="__codelineno-31-6" name="__codelineno-31-6" href="#__codelineno-31-6"></a><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="nf">XElement</span><span class="w"> </span><span class="p">(</span><span class="s">&quot;firstname&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">c</span><span class="p">.</span><span class="n">FirstName</span><span class="p">),</span>
</span><span id="__span-31-7"><a id="__codelineno-31-7" name="__codelineno-31-7" href="#__codelineno-31-7"></a><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="nf">XElement</span><span class="w"> </span><span class="p">(</span><span class="s">&quot;lastname&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">c</span><span class="p">.</span><span class="n">LastName</span><span class="p">,</span>
</span><span id="__span-31-8"><a id="__codelineno-31-8" name="__codelineno-31-8" href="#__codelineno-31-8"></a><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="nf">XComment</span><span class="w"> </span><span class="p">(</span><span class="s">&quot;nice name&quot;</span><span class="p">)</span>
</span><span id="__span-31-9"><a id="__codelineno-31-9" name="__codelineno-31-9" href="#__codelineno-31-9"></a><span class="w"> </span><span class="p">)</span>
</span><span id="__span-31-10"><a id="__codelineno-31-10" name="__codelineno-31-10" href="#__codelineno-31-10"></a><span class="w"> </span><span class="p">)</span>
</span><span id="__span-31-11"><a id="__codelineno-31-11" name="__codelineno-31-11" href="#__codelineno-31-11"></a><span class="w"> </span><span class="p">);</span>
</span></code></pre></div>
<h3 id="specifying-content">Specifying Content</h3>
<p>Functional construction is possible because the constructors for XElement (and XDocument) are overloaded to accept a params object array:</p>
<p>To see how, we need to examine how each content object is processed internally. Here are the decisions made by XContainer, in order:</p>
<ul>
<li>If the object is null, itâ€™s ignored.</li>
<li>If the object is based on XNode or XStreamingElement, itâ€™s added as is to the Nodes collection.</li>
<li>If the object is an XAttribute, itâ€™s added to the Attributes collection.</li>
<li>If the object is a string, itâ€™s wrapped in an XText node and added to Nodes.</li>
<li>If the object implements IEnumerable, itâ€™s enumerated, and the same rules are applied to each element.</li>
<li>Otherwise, the object is converted to a string, wrapped in an XText node, and then added to Nodes.</li>
</ul>
<p>Everything ends up in one of two buckets: Nodes or Attributes. Furthermore, any object is valid content because it can always ultimately call ToString on it and treat it as an XText node.</p>
<h3 id="automatic-deep-cloning">Automatic Deep Cloning</h3>
<p>When a node or attribute is added to an element (whether via functional construction or an Add method), the node or attributeâ€™s Parent property is set to that element. A node can have only one parent element: if you add an already parented node to a second parent, the node is automatically deep-cloned. I</p>
<div class="language-csharp highlight"><pre><span></span><code><span id="__span-32-1"><a id="__codelineno-32-1" name="__codelineno-32-1" href="#__codelineno-32-1"></a><span class="kt">var</span><span class="w"> </span><span class="n">address</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">XElement</span><span class="w"> </span><span class="p">(</span><span class="s">&quot;address&quot;</span><span class="p">,</span>
</span><span id="__span-32-2"><a id="__codelineno-32-2" name="__codelineno-32-2" href="#__codelineno-32-2"></a><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="nf">XElement</span><span class="w"> </span><span class="p">(</span><span class="s">&quot;street&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Lawley St&quot;</span><span class="p">),</span>
</span><span id="__span-32-3"><a id="__codelineno-32-3" name="__codelineno-32-3" href="#__codelineno-32-3"></a><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="nf">XElement</span><span class="w"> </span><span class="p">(</span><span class="s">&quot;town&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;North Beach&quot;</span><span class="p">)</span>
</span><span id="__span-32-4"><a id="__codelineno-32-4" name="__codelineno-32-4" href="#__codelineno-32-4"></a><span class="w"> </span><span class="p">);</span>
</span><span id="__span-32-5"><a id="__codelineno-32-5" name="__codelineno-32-5" href="#__codelineno-32-5"></a><span class="kt">var</span><span class="w"> </span><span class="n">customer1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">XElement</span><span class="w"> </span><span class="p">(</span><span class="s">&quot;customer1&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">address</span><span class="p">);</span>
</span><span id="__span-32-6"><a id="__codelineno-32-6" name="__codelineno-32-6" href="#__codelineno-32-6"></a><span class="kt">var</span><span class="w"> </span><span class="n">customer2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">XElement</span><span class="w"> </span><span class="p">(</span><span class="s">&quot;customer2&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">address</span><span class="p">);</span>
</span><span id="__span-32-7"><a id="__codelineno-32-7" name="__codelineno-32-7" href="#__codelineno-32-7"></a><span class="n">customer1</span><span class="p">.</span><span class="n">Element</span><span class="w"> </span><span class="p">(</span><span class="s">&quot;address&quot;</span><span class="p">).</span><span class="n">Element</span><span class="w"> </span><span class="p">(</span><span class="s">&quot;street&quot;</span><span class="p">).</span><span class="n">Value</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;Another St&quot;</span><span class="p">;</span>
</span><span id="__span-32-8"><a id="__codelineno-32-8" name="__codelineno-32-8" href="#__codelineno-32-8"></a><span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="w"> </span><span class="p">(</span>
</span><span id="__span-32-9"><a id="__codelineno-32-9" name="__codelineno-32-9" href="#__codelineno-32-9"></a><span class="w"> </span><span class="n">customer2</span><span class="p">.</span><span class="n">Element</span><span class="w"> </span><span class="p">(</span><span class="s">&quot;address&quot;</span><span class="p">).</span><span class="n">Element</span><span class="w"> </span><span class="p">(</span><span class="s">&quot;street&quot;</span><span class="p">).</span><span class="n">Value</span><span class="p">);</span><span class="w"> </span><span class="c1">// Lawley St</span>
</span></code></pre></div>
<h1 id="navigating-and-querying">Navigating and Querying</h1>
<h3 id="firstnode-lastnode-and-nodes">FirstNode, LastNode, and Nodes</h3>
<p>FirstNode and LastNode give you direct access to the first or last child node; Nodes returns all children as a sequence. All three functions consider only direct descendants:</p>
<div class="language-csharp highlight"><pre><span></span><code><span id="__span-33-1"><a id="__codelineno-33-1" name="__codelineno-33-1" href="#__codelineno-33-1"></a><span class="kt">var</span><span class="w"> </span><span class="n">bench</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">XElement</span><span class="w"> </span><span class="p">(</span><span class="s">&quot;bench&quot;</span><span class="p">,</span>
</span><span id="__span-33-2"><a id="__codelineno-33-2" name="__codelineno-33-2" href="#__codelineno-33-2"></a><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="nf">XElement</span><span class="w"> </span><span class="p">(</span><span class="s">&quot;toolbox&quot;</span><span class="p">,</span>
</span><span id="__span-33-3"><a id="__codelineno-33-3" name="__codelineno-33-3" href="#__codelineno-33-3"></a><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="nf">XElement</span><span class="w"> </span><span class="p">(</span><span class="s">&quot;handtool&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Hammer&quot;</span><span class="p">),</span>
</span><span id="__span-33-4"><a id="__codelineno-33-4" name="__codelineno-33-4" href="#__codelineno-33-4"></a><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="nf">XElement</span><span class="w"> </span><span class="p">(</span><span class="s">&quot;handtool&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Rasp&quot;</span><span class="p">)</span>
</span><span id="__span-33-5"><a id="__codelineno-33-5" name="__codelineno-33-5" href="#__codelineno-33-5"></a><span class="w"> </span><span class="p">),</span>
</span><span id="__span-33-6"><a id="__codelineno-33-6" name="__codelineno-33-6" href="#__codelineno-33-6"></a><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="nf">XElement</span><span class="w"> </span><span class="p">(</span><span class="s">&quot;toolbox&quot;</span><span class="p">,</span>
</span><span id="__span-33-7"><a id="__codelineno-33-7" name="__codelineno-33-7" href="#__codelineno-33-7"></a><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="nf">XElement</span><span class="w"> </span><span class="p">(</span><span class="s">&quot;handtool&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Saw&quot;</span><span class="p">),</span>
</span><span id="__span-33-8"><a id="__codelineno-33-8" name="__codelineno-33-8" href="#__codelineno-33-8"></a><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="nf">XElement</span><span class="w"> </span><span class="p">(</span><span class="s">&quot;powertool&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Nailgun&quot;</span><span class="p">)</span>
</span><span id="__span-33-9"><a id="__codelineno-33-9" name="__codelineno-33-9" href="#__codelineno-33-9"></a><span class="w"> </span><span class="p">),</span>
</span><span id="__span-33-10"><a id="__codelineno-33-10" name="__codelineno-33-10" href="#__codelineno-33-10"></a><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="nf">XComment</span><span class="w"> </span><span class="p">(</span><span class="s">&quot;Be careful with the nailgun&quot;</span><span class="p">)</span>
</span><span id="__span-33-11"><a id="__codelineno-33-11" name="__codelineno-33-11" href="#__codelineno-33-11"></a><span class="w"> </span><span class="p">);</span>
</span><span id="__span-33-12"><a id="__codelineno-33-12" name="__codelineno-33-12" href="#__codelineno-33-12"></a><span class="k">foreach</span><span class="w"> </span><span class="p">(</span><span class="n">XNode</span><span class="w"> </span><span class="n">node</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">bench</span><span class="p">.</span><span class="n">Nodes</span><span class="p">())</span>
</span><span id="__span-33-13"><a id="__codelineno-33-13" name="__codelineno-33-13" href="#__codelineno-33-13"></a><span class="w"> </span><span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="w"> </span><span class="p">(</span><span class="n">node</span><span class="p">.</span><span class="n">ToString</span><span class="w"> </span><span class="p">(</span><span class="n">SaveOptions</span><span class="p">.</span><span class="n">DisableFormatting</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s">&quot;.&quot;</span><span class="p">);</span>
</span><span id="__span-33-14"><a id="__codelineno-33-14" name="__codelineno-33-14" href="#__codelineno-33-14"></a>
</span><span id="__span-33-15"><a id="__codelineno-33-15" name="__codelineno-33-15" href="#__codelineno-33-15"></a><span class="c1">//This is the output:</span>
</span><span id="__span-33-16"><a id="__codelineno-33-16" name="__codelineno-33-16" href="#__codelineno-33-16"></a><span class="o">&lt;</span><span class="n">toolbox</span><span class="o">&gt;&lt;</span><span class="n">handtool</span><span class="o">&gt;</span><span class="n">Hammer</span><span class="o">&lt;/</span><span class="n">handtool</span><span class="o">&gt;&lt;</span><span class="n">handtool</span><span class="o">&gt;</span><span class="n">Rasp</span><span class="o">&lt;/</span><span class="n">handtool</span><span class="o">&gt;&lt;/</span><span class="n">toolbox</span><span class="o">&gt;</span><span class="p">.</span>
</span><span id="__span-33-17"><a id="__codelineno-33-17" name="__codelineno-33-17" href="#__codelineno-33-17"></a><span class="o">&lt;</span><span class="n">toolbox</span><span class="o">&gt;&lt;</span><span class="n">handtool</span><span class="o">&gt;</span><span class="n">Saw</span><span class="o">&lt;/</span><span class="n">handtool</span><span class="o">&gt;&lt;</span><span class="n">powertool</span><span class="o">&gt;</span><span class="n">Nailgun</span><span class="o">&lt;/</span><span class="n">powertool</span><span class="o">&gt;&lt;/</span><span class="n">toolbox</span><span class="o">&gt;</span><span class="p">.</span>
</span><span id="__span-33-18"><a id="__codelineno-33-18" name="__codelineno-33-18" href="#__codelineno-33-18"></a><span class="o">&lt;!--</span><span class="n">Be</span><span class="w"> </span><span class="n">careful</span><span class="w"> </span><span class="k">with</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">nailgun</span><span class="o">--&gt;</span><span class="p">.</span>
</span></code></pre></div>
<h3 id="retrieving-elements">Retrieving elements</h3>
<div class="language-csharp highlight"><pre><span></span><code><span id="__span-34-1"><a id="__codelineno-34-1" name="__codelineno-34-1" href="#__codelineno-34-1"></a><span class="k">foreach</span><span class="w"> </span><span class="p">(</span><span class="n">XElement</span><span class="w"> </span><span class="n">e</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">bench</span><span class="p">.</span><span class="n">Elements</span><span class="p">())</span>
</span><span id="__span-34-2"><a id="__codelineno-34-2" name="__codelineno-34-2" href="#__codelineno-34-2"></a><span class="w"> </span><span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="w"> </span><span class="p">(</span><span class="n">e</span><span class="p">.</span><span class="n">Name</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s">&quot;=&quot;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">e</span><span class="p">.</span><span class="n">Value</span><span class="p">);</span><span class="w"> </span>
</span><span id="__span-34-3"><a id="__codelineno-34-3" name="__codelineno-34-3" href="#__codelineno-34-3"></a><span class="c1">// toolbox=HammerRasp</span>
</span><span id="__span-34-4"><a id="__codelineno-34-4" name="__codelineno-34-4" href="#__codelineno-34-4"></a><span class="w"> </span><span class="c1">// toolbox=SawNailgun</span>
</span></code></pre></div>
<div class="language-csharp highlight"><pre><span></span><code><span id="__span-35-1"><a id="__codelineno-35-1" name="__codelineno-35-1" href="#__codelineno-35-1"></a><span class="n">IEnumerable</span><span class="o">&lt;</span><span class="kt">string</span><span class="o">&gt;</span><span class="w"> </span><span class="n">query</span><span class="w"> </span><span class="o">=</span>
</span><span id="__span-35-2"><a id="__codelineno-35-2" name="__codelineno-35-2" href="#__codelineno-35-2"></a><span class="w"> </span><span class="k">from</span><span class="w"> </span><span class="n">toolbox</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">bench</span><span class="p">.</span><span class="n">Elements</span><span class="p">()</span>
</span><span id="__span-35-3"><a id="__codelineno-35-3" name="__codelineno-35-3" href="#__codelineno-35-3"></a><span class="w"> </span><span class="k">where</span><span class="w"> </span><span class="n">toolbox</span><span class="p">.</span><span class="n">Elements</span><span class="p">().</span><span class="n">Any</span><span class="w"> </span><span class="p">(</span><span class="n">tool</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="n">tool</span><span class="p">.</span><span class="n">Value</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s">&quot;Nailgun&quot;</span><span class="p">)</span>
</span><span id="__span-35-4"><a id="__codelineno-35-4" name="__codelineno-35-4" href="#__codelineno-35-4"></a><span class="w"> </span><span class="k">select</span><span class="w"> </span><span class="n">toolbox</span><span class="p">.</span><span class="n">Value</span><span class="p">;</span>
</span><span id="__span-35-5"><a id="__codelineno-35-5" name="__codelineno-35-5" href="#__codelineno-35-5"></a><span class="n">RESULT</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="s">&quot;SawNailgun&quot;</span><span class="w"> </span><span class="p">}</span>
</span></code></pre></div>
<div class="language-csharp highlight"><pre><span></span><code><span id="__span-36-1"><a id="__codelineno-36-1" name="__codelineno-36-1" href="#__codelineno-36-1"></a><span class="n">IEnumerable</span><span class="o">&lt;</span><span class="kt">string</span><span class="o">&gt;</span><span class="w"> </span><span class="n">query</span><span class="w"> </span><span class="o">=</span>
</span><span id="__span-36-2"><a id="__codelineno-36-2" name="__codelineno-36-2" href="#__codelineno-36-2"></a><span class="w"> </span><span class="k">from</span><span class="w"> </span><span class="n">toolbox</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">bench</span><span class="p">.</span><span class="n">Elements</span><span class="p">()</span>
</span><span id="__span-36-3"><a id="__codelineno-36-3" name="__codelineno-36-3" href="#__codelineno-36-3"></a><span class="w"> </span><span class="k">from</span><span class="w"> </span><span class="n">tool</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">toolbox</span><span class="p">.</span><span class="n">Elements</span><span class="p">()</span>
</span><span id="__span-36-4"><a id="__codelineno-36-4" name="__codelineno-36-4" href="#__codelineno-36-4"></a><span class="w"> </span><span class="k">where</span><span class="w"> </span><span class="n">tool</span><span class="p">.</span><span class="n">Name</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s">&quot;handtool&quot;</span>
</span><span id="__span-36-5"><a id="__codelineno-36-5" name="__codelineno-36-5" href="#__codelineno-36-5"></a><span class="w"> </span><span class="k">select</span><span class="w"> </span><span class="n">tool</span><span class="p">.</span><span class="n">Value</span><span class="p">;</span>
</span><span id="__span-36-6"><a id="__codelineno-36-6" name="__codelineno-36-6" href="#__codelineno-36-6"></a><span class="n">RESULT</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="s">&quot;Hammer&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Rasp&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Saw&quot;</span><span class="w"> </span><span class="p">}</span>
</span></code></pre></div>
<h1 id="updating-an-x-dom">Updating an X-DOM</h1>
<h3 id="simple-value-updates">Simple Value Updates</h3>
<div class="language-csharp highlight"><pre><span></span><code><span id="__span-37-1"><a id="__codelineno-37-1" name="__codelineno-37-1" href="#__codelineno-37-1"></a><span class="n">XElement</span><span class="w"> </span><span class="n">settings</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">XElement</span><span class="w"> </span><span class="p">(</span><span class="s">&quot;settings&quot;</span><span class="p">,</span>
</span><span id="__span-37-2"><a id="__codelineno-37-2" name="__codelineno-37-2" href="#__codelineno-37-2"></a><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="nf">XElement</span><span class="w"> </span><span class="p">(</span><span class="s">&quot;timeout&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">30</span><span class="p">)</span>
</span><span id="__span-37-3"><a id="__codelineno-37-3" name="__codelineno-37-3" href="#__codelineno-37-3"></a><span class="w"> </span><span class="p">);</span>
</span><span id="__span-37-4"><a id="__codelineno-37-4" name="__codelineno-37-4" href="#__codelineno-37-4"></a><span class="n">settings</span><span class="p">.</span><span class="n">SetValue</span><span class="w"> </span><span class="p">(</span><span class="s">&quot;blah&quot;</span><span class="p">);</span>
</span><span id="__span-37-5"><a id="__codelineno-37-5" name="__codelineno-37-5" href="#__codelineno-37-5"></a><span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="w"> </span><span class="p">(</span><span class="n">settings</span><span class="p">.</span><span class="n">ToString</span><span class="p">());</span><span class="w"> </span><span class="c1">// &lt;settings&gt;blah&lt;/settings&gt;</span>
</span></code></pre></div>
<h3 id="updating-child-nodes-and-attributes">Updating Child Nodes and Attributes</h3>
<div class="language-csharp highlight"><pre><span></span><code><span id="__span-38-1"><a id="__codelineno-38-1" name="__codelineno-38-1" href="#__codelineno-38-1"></a><span class="n">XElement</span><span class="w"> </span><span class="n">settings</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">XElement</span><span class="w"> </span><span class="p">(</span><span class="s">&quot;settings&quot;</span><span class="p">);</span>
</span><span id="__span-38-2"><a id="__codelineno-38-2" name="__codelineno-38-2" href="#__codelineno-38-2"></a><span class="n">settings</span><span class="p">.</span><span class="n">SetElementValue</span><span class="w"> </span><span class="p">(</span><span class="s">&quot;timeout&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">30</span><span class="p">);</span><span class="w"> </span><span class="c1">// Adds child node</span>
</span><span id="__span-38-3"><a id="__codelineno-38-3" name="__codelineno-38-3" href="#__codelineno-38-3"></a><span class="n">settings</span><span class="p">.</span><span class="n">SetElementValue</span><span class="w"> </span><span class="p">(</span><span class="s">&quot;timeout&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">60</span><span class="p">);</span><span class="w"> </span><span class="c1">// Update it to 60</span>
</span></code></pre></div>
<h3 id="updating-through-the-parent">Updating Through the Parent</h3>
<div class="language-csharp highlight"><pre><span></span><code><span id="__span-39-1"><a id="__codelineno-39-1" name="__codelineno-39-1" href="#__codelineno-39-1"></a><span class="n">XElement</span><span class="w"> </span><span class="n">items</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">XElement</span><span class="w"> </span><span class="p">(</span><span class="s">&quot;items&quot;</span><span class="p">,</span>
</span><span id="__span-39-2"><a id="__codelineno-39-2" name="__codelineno-39-2" href="#__codelineno-39-2"></a><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="nf">XElement</span><span class="w"> </span><span class="p">(</span><span class="s">&quot;one&quot;</span><span class="p">),</span>
</span><span id="__span-39-3"><a id="__codelineno-39-3" name="__codelineno-39-3" href="#__codelineno-39-3"></a><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="nf">XElement</span><span class="w"> </span><span class="p">(</span><span class="s">&quot;three&quot;</span><span class="p">)</span>
</span><span id="__span-39-4"><a id="__codelineno-39-4" name="__codelineno-39-4" href="#__codelineno-39-4"></a><span class="w"> </span><span class="p">);</span>
</span><span id="__span-39-5"><a id="__codelineno-39-5" name="__codelineno-39-5" href="#__codelineno-39-5"></a><span class="n">items</span><span class="p">.</span><span class="n">FirstNode</span><span class="p">.</span><span class="n">AddAfterSelf</span><span class="w"> </span><span class="p">(</span><span class="k">new</span><span class="w"> </span><span class="n">XElement</span><span class="w"> </span><span class="p">(</span><span class="s">&quot;two&quot;</span><span class="p">));</span>
</span><span id="__span-39-6"><a id="__codelineno-39-6" name="__codelineno-39-6" href="#__codelineno-39-6"></a><span class="n">Here</span><span class="err">â€™</span><span class="n">s</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">result</span><span class="p">:</span>
</span><span id="__span-39-7"><a id="__codelineno-39-7" name="__codelineno-39-7" href="#__codelineno-39-7"></a><span class="o">&lt;</span><span class="n">items</span><span class="o">&gt;&lt;</span><span class="n">one</span><span class="w"> </span><span class="o">/&gt;&lt;</span><span class="n">two</span><span class="w"> </span><span class="o">/&gt;&lt;</span><span class="n">three</span><span class="w"> </span><span class="o">/&gt;&lt;/</span><span class="n">items</span><span class="o">&gt;</span>
</span></code></pre></div>
<div class="language-csharp highlight"><pre><span></span><code><span id="__span-40-1"><a id="__codelineno-40-1" name="__codelineno-40-1" href="#__codelineno-40-1"></a><span class="n">XElement</span><span class="w"> </span><span class="n">items</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">XElement</span><span class="p">.</span><span class="n">Parse</span><span class="w"> </span><span class="p">(</span><span class="s">&quot;&lt;items&gt;&lt;one/&gt;&lt;two/&gt;&lt;three/&gt;&lt;/items&gt;&quot;</span><span class="p">);</span>
</span><span id="__span-40-2"><a id="__codelineno-40-2" name="__codelineno-40-2" href="#__codelineno-40-2"></a><span class="n">items</span><span class="p">.</span><span class="n">FirstNode</span><span class="p">.</span><span class="n">ReplaceWith</span><span class="w"> </span><span class="p">(</span><span class="k">new</span><span class="w"> </span><span class="n">XComment</span><span class="w"> </span><span class="p">(</span><span class="s">&quot;One was here&quot;</span><span class="p">));</span>
</span><span id="__span-40-3"><a id="__codelineno-40-3" name="__codelineno-40-3" href="#__codelineno-40-3"></a><span class="n">Here</span><span class="err">â€™</span><span class="n">s</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">result</span><span class="p">:</span>
</span><span id="__span-40-4"><a id="__codelineno-40-4" name="__codelineno-40-4" href="#__codelineno-40-4"></a><span class="o">&lt;</span><span class="n">items</span><span class="o">&gt;&lt;!--</span><span class="n">one</span><span class="w"> </span><span class="n">was</span><span class="w"> </span><span class="n">here</span><span class="o">--&gt;&lt;</span><span class="n">two</span><span class="w"> </span><span class="o">/&gt;&lt;</span><span class="n">three</span><span class="w"> </span><span class="o">/&gt;&lt;/</span><span class="n">items</span><span class="o">&gt;</span>
</span></code></pre></div>
<h3 id="removing-a-sequence-of-nodes-or-attributes">Removing a sequence of nodes or attributes</h3>
<div class="language-csharp highlight"><pre><span></span><code><span id="__span-41-1"><a id="__codelineno-41-1" name="__codelineno-41-1" href="#__codelineno-41-1"></a><span class="n">XElement</span><span class="w"> </span><span class="n">contacts</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">XElement</span><span class="p">.</span><span class="n">Parse</span><span class="w"> </span><span class="p">(</span>
</span><span id="__span-41-2"><a id="__codelineno-41-2" name="__codelineno-41-2" href="#__codelineno-41-2"></a><span class="s">@&quot;&lt;contacts&gt;</span>
</span><span id="__span-41-3"><a id="__codelineno-41-3" name="__codelineno-41-3" href="#__codelineno-41-3"></a><span class="s"> &lt;customer name=&#39;Mary&#39;/&gt;</span>
</span><span id="__span-41-4"><a id="__codelineno-41-4" name="__codelineno-41-4" href="#__codelineno-41-4"></a><span class="s"> &lt;customer name=&#39;Chris&#39; archived=&#39;true&#39;/&gt;</span>
</span><span id="__span-41-5"><a id="__codelineno-41-5" name="__codelineno-41-5" href="#__codelineno-41-5"></a><span class="s"> &lt;supplier name=&#39;Susan&#39;&gt;</span>
</span><span id="__span-41-6"><a id="__codelineno-41-6" name="__codelineno-41-6" href="#__codelineno-41-6"></a><span class="s"> &lt;phone archived=&#39;true&#39;&gt;012345678&lt;!--confidential--&gt;&lt;/phone&gt;</span>
</span><span id="__span-41-7"><a id="__codelineno-41-7" name="__codelineno-41-7" href="#__codelineno-41-7"></a><span class="s"> &lt;/supplier&gt;</span>
</span><span id="__span-41-8"><a id="__codelineno-41-8" name="__codelineno-41-8" href="#__codelineno-41-8"></a><span class="s"> &lt;/contacts&gt;&quot;</span><span class="p">);</span>
</span><span id="__span-41-9"><a id="__codelineno-41-9" name="__codelineno-41-9" href="#__codelineno-41-9"></a><span class="c1">//The following removes all customers:</span>
</span><span id="__span-41-10"><a id="__codelineno-41-10" name="__codelineno-41-10" href="#__codelineno-41-10"></a><span class="n">contacts</span><span class="p">.</span><span class="n">Elements</span><span class="w"> </span><span class="p">(</span><span class="s">&quot;customer&quot;</span><span class="p">).</span><span class="n">Remove</span><span class="p">();</span>
</span><span id="__span-41-11"><a id="__codelineno-41-11" name="__codelineno-41-11" href="#__codelineno-41-11"></a><span class="c1">//The following removes all archived contacts (so Chris disappears):</span>
</span><span id="__span-41-12"><a id="__codelineno-41-12" name="__codelineno-41-12" href="#__codelineno-41-12"></a><span class="n">contacts</span><span class="p">.</span><span class="n">Elements</span><span class="p">().</span><span class="n">Where</span><span class="w"> </span><span class="p">(</span><span class="n">e</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="p">(</span><span class="kt">bool?</span><span class="p">)</span><span class="w"> </span><span class="n">e</span><span class="p">.</span><span class="n">Attribute</span><span class="w"> </span><span class="p">(</span><span class="s">&quot;archived&quot;</span><span class="p">)</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="k">true</span><span class="p">)</span>
</span><span id="__span-41-13"><a id="__codelineno-41-13" name="__codelineno-41-13" href="#__codelineno-41-13"></a><span class="w"> </span><span class="p">.</span><span class="n">Remove</span><span class="p">();</span>
</span></code></pre></div>
<h1 id="working-with-values">Working with Values</h1>
<h3 id="setting-values">Setting Values</h3>
<p>There are two ways to assign a value: call SetValue or assign the Value property.
SetValue is more flexible because it accepts not just strings, but other simple data
types, too</p>
<div class="language-csharp highlight"><pre><span></span><code><span id="__span-42-1"><a id="__codelineno-42-1" name="__codelineno-42-1" href="#__codelineno-42-1"></a><span class="kt">var</span><span class="w"> </span><span class="n">e</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">XElement</span><span class="w"> </span><span class="p">(</span><span class="s">&quot;date&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">DateTime</span><span class="p">.</span><span class="n">Now</span><span class="p">);</span>
</span><span id="__span-42-2"><a id="__codelineno-42-2" name="__codelineno-42-2" href="#__codelineno-42-2"></a><span class="n">e</span><span class="p">.</span><span class="n">SetValue</span><span class="w"> </span><span class="p">(</span><span class="n">DateTime</span><span class="p">.</span><span class="n">Now</span><span class="p">.</span><span class="n">AddDays</span><span class="p">(</span><span class="mi">1</span><span class="p">));</span>
</span><span id="__span-42-3"><a id="__codelineno-42-3" name="__codelineno-42-3" href="#__codelineno-42-3"></a><span class="n">Console</span><span class="p">.</span><span class="n">Write</span><span class="w"> </span><span class="p">(</span><span class="n">e</span><span class="p">.</span><span class="n">Value</span><span class="p">);</span><span class="w"> </span><span class="c1">// 2019-10-02T16:39:10.734375+09:00</span>
</span></code></pre></div>
<h3 id="getting-values">Getting Values</h3>
<div class="language-csharp highlight"><pre><span></span><code><span id="__span-43-1"><a id="__codelineno-43-1" name="__codelineno-43-1" href="#__codelineno-43-1"></a><span class="n">XElement</span><span class="w"> </span><span class="n">e</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">XElement</span><span class="w"> </span><span class="p">(</span><span class="s">&quot;now&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">DateTime</span><span class="p">.</span><span class="n">Now</span><span class="p">);</span>
</span><span id="__span-43-2"><a id="__codelineno-43-2" name="__codelineno-43-2" href="#__codelineno-43-2"></a><span class="n">DateTime</span><span class="w"> </span><span class="n">dt</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">DateTime</span><span class="p">)</span><span class="w"> </span><span class="n">e</span><span class="p">;</span>
</span><span id="__span-43-3"><a id="__codelineno-43-3" name="__codelineno-43-3" href="#__codelineno-43-3"></a><span class="n">XAttribute</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">XAttribute</span><span class="w"> </span><span class="p">(</span><span class="s">&quot;resolution&quot;</span><span class="p">,</span><span class="w"> </span><span class="mf">1.234</span><span class="p">);</span>
</span><span id="__span-43-4"><a id="__codelineno-43-4" name="__codelineno-43-4" href="#__codelineno-43-4"></a><span class="kt">double</span><span class="w"> </span><span class="n">res</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="kt">double</span><span class="p">)</span><span class="w"> </span><span class="n">a</span><span class="p">;</span>
</span></code></pre></div>
<h3 id="automatic-xtext-concatenation">Automatic XText Concatenation</h3>
<div class="language-csharp highlight"><pre><span></span><code><span id="__span-44-1"><a id="__codelineno-44-1" name="__codelineno-44-1" href="#__codelineno-44-1"></a><span class="kt">var</span><span class="w"> </span><span class="n">e1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">XElement</span><span class="w"> </span><span class="p">(</span><span class="s">&quot;test&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Hello&quot;</span><span class="p">);</span><span class="w"> </span><span class="n">e1</span><span class="p">.</span><span class="n">Add</span><span class="w"> </span><span class="p">(</span><span class="s">&quot;World&quot;</span><span class="p">);</span>
</span><span id="__span-44-2"><a id="__codelineno-44-2" name="__codelineno-44-2" href="#__codelineno-44-2"></a><span class="kt">var</span><span class="w"> </span><span class="n">e2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">XElement</span><span class="w"> </span><span class="p">(</span><span class="s">&quot;test&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Hello&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;World&quot;</span><span class="p">);</span>
</span><span id="__span-44-3"><a id="__codelineno-44-3" name="__codelineno-44-3" href="#__codelineno-44-3"></a><span class="c1">//If you specifically create XText nodes, however, you end up with multiple children:</span>
</span><span id="__span-44-4"><a id="__codelineno-44-4" name="__codelineno-44-4" href="#__codelineno-44-4"></a><span class="kt">var</span><span class="w"> </span><span class="n">e</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">XElement</span><span class="w"> </span><span class="p">(</span><span class="s">&quot;test&quot;</span><span class="p">,</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">XText</span><span class="w"> </span><span class="p">(</span><span class="s">&quot;Hello&quot;</span><span class="p">),</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">XText</span><span class="w"> </span><span class="p">(</span><span class="s">&quot;World&quot;</span><span class="p">));</span>
</span><span id="__span-44-5"><a id="__codelineno-44-5" name="__codelineno-44-5" href="#__codelineno-44-5"></a><span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="w"> </span><span class="p">(</span><span class="n">e</span><span class="p">.</span><span class="n">Value</span><span class="p">);</span><span class="w"> </span><span class="c1">// HelloWorld</span>
</span><span id="__span-44-6"><a id="__codelineno-44-6" name="__codelineno-44-6" href="#__codelineno-44-6"></a><span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="w"> </span><span class="p">(</span><span class="n">e</span><span class="p">.</span><span class="n">Nodes</span><span class="p">().</span><span class="n">Count</span><span class="p">());</span><span class="w"> </span><span class="c1">// 2</span>
</span></code></pre></div>
<h1 id="documents-and-declarations">Documents and Declarations</h1>
<h3 id="xdocument">XDocument</h3>
<p>The simplest valid XDocument has just a root element</p>
<div class="language-csharp highlight"><pre><span></span><code><span id="__span-45-1"><a id="__codelineno-45-1" name="__codelineno-45-1" href="#__codelineno-45-1"></a><span class="kt">var</span><span class="w"> </span><span class="n">doc</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">XDocument</span><span class="w"> </span><span class="p">(</span>
</span><span id="__span-45-2"><a id="__codelineno-45-2" name="__codelineno-45-2" href="#__codelineno-45-2"></a><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="nf">XElement</span><span class="w"> </span><span class="p">(</span><span class="s">&quot;test&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;data&quot;</span><span class="p">)</span>
</span><span id="__span-45-3"><a id="__codelineno-45-3" name="__codelineno-45-3" href="#__codelineno-45-3"></a><span class="w"> </span><span class="p">);</span>
</span></code></pre></div>
<p>The next example produces a simple but correct XHTML file, illustrating all the
constructs that an XDocument can accept:</p>
<div class="language-csharp highlight"><pre><span></span><code><span id="__span-46-1"><a id="__codelineno-46-1" name="__codelineno-46-1" href="#__codelineno-46-1"></a><span class="kt">var</span><span class="w"> </span><span class="n">styleInstruction</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">XProcessingInstruction</span><span class="w"> </span><span class="p">(</span>
</span><span id="__span-46-2"><a id="__codelineno-46-2" name="__codelineno-46-2" href="#__codelineno-46-2"></a><span class="w"> </span><span class="s">&quot;xml-stylesheet&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;href=&#39;styles.css&#39; type=&#39;text/css&#39;&quot;</span><span class="p">);</span>
</span><span id="__span-46-3"><a id="__codelineno-46-3" name="__codelineno-46-3" href="#__codelineno-46-3"></a><span class="kt">var</span><span class="w"> </span><span class="n">docType</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">XDocumentType</span><span class="w"> </span><span class="p">(</span><span class="s">&quot;html&quot;</span><span class="p">,</span>
</span><span id="__span-46-4"><a id="__codelineno-46-4" name="__codelineno-46-4" href="#__codelineno-46-4"></a><span class="w"> </span><span class="s">&quot;-//W3C//DTD XHTML 1.0 Strict//EN&quot;</span><span class="p">,</span>
</span><span id="__span-46-5"><a id="__codelineno-46-5" name="__codelineno-46-5" href="#__codelineno-46-5"></a><span class="w"> </span><span class="s">&quot;http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd&quot;</span><span class="p">,</span><span class="w"> </span><span class="k">null</span><span class="p">);</span>
</span><span id="__span-46-6"><a id="__codelineno-46-6" name="__codelineno-46-6" href="#__codelineno-46-6"></a><span class="n">XNamespace</span><span class="w"> </span><span class="n">ns</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;http://www.w3.org/1999/xhtml&quot;</span><span class="p">;</span>
</span><span id="__span-46-7"><a id="__codelineno-46-7" name="__codelineno-46-7" href="#__codelineno-46-7"></a><span class="kt">var</span><span class="w"> </span><span class="n">root</span><span class="w"> </span><span class="o">=</span>
</span><span id="__span-46-8"><a id="__codelineno-46-8" name="__codelineno-46-8" href="#__codelineno-46-8"></a><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="nf">XElement</span><span class="w"> </span><span class="p">(</span><span class="n">ns</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s">&quot;html&quot;</span><span class="p">,</span>
</span><span id="__span-46-9"><a id="__codelineno-46-9" name="__codelineno-46-9" href="#__codelineno-46-9"></a><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="nf">XElement</span><span class="w"> </span><span class="p">(</span><span class="n">ns</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s">&quot;head&quot;</span><span class="p">,</span>
</span><span id="__span-46-10"><a id="__codelineno-46-10" name="__codelineno-46-10" href="#__codelineno-46-10"></a><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="nf">XElement</span><span class="w"> </span><span class="p">(</span><span class="n">ns</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s">&quot;title&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;An XHTML page&quot;</span><span class="p">)),</span>
</span><span id="__span-46-11"><a id="__codelineno-46-11" name="__codelineno-46-11" href="#__codelineno-46-11"></a><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="nf">XElement</span><span class="w"> </span><span class="p">(</span><span class="n">ns</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s">&quot;body&quot;</span><span class="p">,</span>
</span><span id="__span-46-12"><a id="__codelineno-46-12" name="__codelineno-46-12" href="#__codelineno-46-12"></a><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="nf">XElement</span><span class="w"> </span><span class="p">(</span><span class="n">ns</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s">&quot;p&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;This is the content&quot;</span><span class="p">))</span>
</span><span id="__span-46-13"><a id="__codelineno-46-13" name="__codelineno-46-13" href="#__codelineno-46-13"></a><span class="w"> </span><span class="p">);</span>
</span><span id="__span-46-14"><a id="__codelineno-46-14" name="__codelineno-46-14" href="#__codelineno-46-14"></a><span class="kt">var</span><span class="w"> </span><span class="n">doc</span><span class="w"> </span><span class="o">=</span>
</span><span id="__span-46-15"><a id="__codelineno-46-15" name="__codelineno-46-15" href="#__codelineno-46-15"></a><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="nf">XDocument</span><span class="w"> </span><span class="p">(</span>
</span><span id="__span-46-16"><a id="__codelineno-46-16" name="__codelineno-46-16" href="#__codelineno-46-16"></a><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="nf">XDeclaration</span><span class="w"> </span><span class="p">(</span><span class="s">&quot;1.0&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;utf-8&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;no&quot;</span><span class="p">),</span>
</span><span id="__span-46-17"><a id="__codelineno-46-17" name="__codelineno-46-17" href="#__codelineno-46-17"></a><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="nf">XComment</span><span class="w"> </span><span class="p">(</span><span class="s">&quot;Reference a stylesheet&quot;</span><span class="p">),</span>
</span><span id="__span-46-18"><a id="__codelineno-46-18" name="__codelineno-46-18" href="#__codelineno-46-18"></a><span class="w"> </span><span class="n">styleInstruction</span><span class="p">,</span>
</span><span id="__span-46-19"><a id="__codelineno-46-19" name="__codelineno-46-19" href="#__codelineno-46-19"></a><span class="w"> </span><span class="n">docType</span><span class="p">,</span>
</span><span id="__span-46-20"><a id="__codelineno-46-20" name="__codelineno-46-20" href="#__codelineno-46-20"></a><span class="w"> </span><span class="n">root</span><span class="p">);</span>
</span><span id="__span-46-21"><a id="__codelineno-46-21" name="__codelineno-46-21" href="#__codelineno-46-21"></a><span class="n">doc</span><span class="p">.</span><span class="n">Save</span><span class="w"> </span><span class="p">(</span><span class="s">&quot;test.html&quot;</span><span class="p">);</span>
</span></code></pre></div>
<p>The resultant test.html reads as follows:</p>
<div class="language-csharp highlight"><pre><span></span><code><span id="__span-47-1"><a id="__codelineno-47-1" name="__codelineno-47-1" href="#__codelineno-47-1"></a><span class="o">&lt;?</span><span class="n">xml</span><span class="w"> </span><span class="n">version</span><span class="o">=</span><span class="s">&quot;1.0&quot;</span><span class="w"> </span><span class="n">encoding</span><span class="o">=</span><span class="s">&quot;utf-8&quot;</span><span class="w"> </span><span class="n">standalone</span><span class="o">=</span><span class="s">&quot;no&quot;</span><span class="o">?&gt;</span>
</span><span id="__span-47-2"><a id="__codelineno-47-2" name="__codelineno-47-2" href="#__codelineno-47-2"></a><span class="o">&lt;!--</span><span class="n">Reference</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">stylesheet</span><span class="o">--&gt;</span>
</span><span id="__span-47-3"><a id="__codelineno-47-3" name="__codelineno-47-3" href="#__codelineno-47-3"></a><span class="o">&lt;?</span><span class="n">xml</span><span class="o">-</span><span class="n">stylesheet</span><span class="w"> </span><span class="n">href</span><span class="o">=</span><span class="err">&#39;</span><span class="n">styles</span><span class="p">.</span><span class="n">css</span><span class="err">&#39;</span><span class="w"> </span><span class="n">type</span><span class="o">=</span><span class="err">&#39;</span><span class="n">text</span><span class="o">/</span><span class="n">css</span><span class="err">&#39;</span><span class="o">?&gt;</span>
</span><span id="__span-47-4"><a id="__codelineno-47-4" name="__codelineno-47-4" href="#__codelineno-47-4"></a><span class="o">&lt;!</span><span class="n">DOCTYPE</span><span class="w"> </span><span class="n">html</span><span class="w"> </span><span class="n">PUBLIC</span><span class="w"> </span><span class="s">&quot;-//W3C//DTD XHTML 1.0 Strict//EN&quot;</span>
</span><span id="__span-47-5"><a id="__codelineno-47-5" name="__codelineno-47-5" href="#__codelineno-47-5"></a><span class="w"> </span><span class="s">&quot;http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd&quot;</span><span class="o">&gt;</span>
</span><span id="__span-47-6"><a id="__codelineno-47-6" name="__codelineno-47-6" href="#__codelineno-47-6"></a><span class="o">&lt;</span><span class="n">html</span><span class="w"> </span><span class="n">xmlns</span><span class="o">=</span><span class="s">&quot;http://www.w3.org/1999/xhtml&quot;</span><span class="o">&gt;</span>
</span><span id="__span-47-7"><a id="__codelineno-47-7" name="__codelineno-47-7" href="#__codelineno-47-7"></a><span class="w"> </span><span class="o">&lt;</span><span class="n">head</span><span class="o">&gt;</span>
</span><span id="__span-47-8"><a id="__codelineno-47-8" name="__codelineno-47-8" href="#__codelineno-47-8"></a><span class="w"> </span><span class="o">&lt;</span><span class="n">title</span><span class="o">&gt;</span><span class="n">An</span><span class="w"> </span><span class="n">XHTML</span><span class="w"> </span><span class="n">page</span><span class="o">&lt;/</span><span class="n">title</span><span class="o">&gt;</span>
</span><span id="__span-47-9"><a id="__codelineno-47-9" name="__codelineno-47-9" href="#__codelineno-47-9"></a><span class="w"> </span><span class="o">&lt;/</span><span class="n">head</span><span class="o">&gt;</span>
</span><span id="__span-47-10"><a id="__codelineno-47-10" name="__codelineno-47-10" href="#__codelineno-47-10"></a><span class="w"> </span><span class="o">&lt;</span><span class="n">body</span><span class="o">&gt;</span>
</span><span id="__span-47-11"><a id="__codelineno-47-11" name="__codelineno-47-11" href="#__codelineno-47-11"></a><span class="w"> </span><span class="o">&lt;</span><span class="n">p</span><span class="o">&gt;</span><span class="n">This</span><span class="w"> </span><span class="k">is</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">content</span><span class="o">&lt;/</span><span class="n">p</span><span class="o">&gt;</span>
</span><span id="__span-47-12"><a id="__codelineno-47-12" name="__codelineno-47-12" href="#__codelineno-47-12"></a><span class="w"> </span><span class="o">&lt;/</span><span class="n">body</span><span class="o">&gt;</span>
</span><span id="__span-47-13"><a id="__codelineno-47-13" name="__codelineno-47-13" href="#__codelineno-47-13"></a><span class="o">&lt;/</span><span class="n">html</span><span class="o">&gt;</span>
</span></code></pre></div>
<h3 id="xml-declarations">XML Declarations</h3>
<div class="language-csharp highlight"><pre><span></span><code><span id="__span-48-1"><a id="__codelineno-48-1" name="__codelineno-48-1" href="#__codelineno-48-1"></a><span class="kt">var</span><span class="w"> </span><span class="n">doc</span><span class="w"> </span><span class="o">=</span>
</span><span id="__span-48-2"><a id="__codelineno-48-2" name="__codelineno-48-2" href="#__codelineno-48-2"></a><span class="w">    </span><span class="k">new</span><span class="w"> </span><span class="nf">XDocument</span><span class="w"> </span><span class="p">(</span>
</span><span id="__span-48-3"><a id="__codelineno-48-3" name="__codelineno-48-3" href="#__codelineno-48-3"></a><span class="w">        </span><span class="k">new</span><span class="w"> </span><span class="nf">XDeclaration</span><span class="w"> </span><span class="p">(</span><span class="s">&quot;1.0&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;utf-16&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;yes&quot;</span><span class="p">),</span>
</span><span id="__span-48-4"><a id="__codelineno-48-4" name="__codelineno-48-4" href="#__codelineno-48-4"></a><span class="w">        </span><span class="k">new</span><span class="w"> </span><span class="nf">XElement</span><span class="w"> </span><span class="p">(</span><span class="s">&quot;test&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;data&quot;</span><span class="p">)</span>
</span><span id="__span-48-5"><a id="__codelineno-48-5" name="__codelineno-48-5" href="#__codelineno-48-5"></a><span class="w">    </span><span class="p">);</span>
</span><span id="__span-48-6"><a id="__codelineno-48-6" name="__codelineno-48-6" href="#__codelineno-48-6"></a>
</span><span id="__span-48-7"><a id="__codelineno-48-7" name="__codelineno-48-7" href="#__codelineno-48-7"></a><span class="kt">string</span><span class="w"> </span><span class="n">tempPath</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Path</span><span class="p">.</span><span class="n">Combine</span><span class="w"> </span><span class="p">(</span><span class="n">Path</span><span class="p">.</span><span class="n">GetTempPath</span><span class="p">(),</span><span class="w"> </span><span class="s">&quot;test.xml&quot;</span><span class="p">);</span>
</span><span id="__span-48-8"><a id="__codelineno-48-8" name="__codelineno-48-8" href="#__codelineno-48-8"></a><span class="n">doc</span><span class="p">.</span><span class="n">Save</span><span class="w"> </span><span class="p">(</span><span class="n">tempPath</span><span class="p">);</span>
</span></code></pre></div>
<h3 id="writing-a-declaration-to-a-string">Writing a declaration to a string</h3>
<div class="language-csharp highlight"><pre><span></span><code><span id="__span-49-1"><a id="__codelineno-49-1" name="__codelineno-49-1" href="#__codelineno-49-1"></a><span class="kt">var</span><span class="w"> </span><span class="n">doc</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">XDocument</span><span class="w"> </span><span class="p">(</span>
</span><span id="__span-49-2"><a id="__codelineno-49-2" name="__codelineno-49-2" href="#__codelineno-49-2"></a><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="nf">XDeclaration</span><span class="w"> </span><span class="p">(</span><span class="s">&quot;1.0&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;utf-8&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;yes&quot;</span><span class="p">),</span>
</span><span id="__span-49-3"><a id="__codelineno-49-3" name="__codelineno-49-3" href="#__codelineno-49-3"></a><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="nf">XElement</span><span class="w"> </span><span class="p">(</span><span class="s">&quot;test&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;data&quot;</span><span class="p">)</span>
</span><span id="__span-49-4"><a id="__codelineno-49-4" name="__codelineno-49-4" href="#__codelineno-49-4"></a><span class="w"> </span><span class="p">);</span>
</span><span id="__span-49-5"><a id="__codelineno-49-5" name="__codelineno-49-5" href="#__codelineno-49-5"></a><span class="kt">var</span><span class="w"> </span><span class="n">output</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">StringBuilder</span><span class="p">();</span>
</span><span id="__span-49-6"><a id="__codelineno-49-6" name="__codelineno-49-6" href="#__codelineno-49-6"></a><span class="kt">var</span><span class="w"> </span><span class="n">settings</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">XmlWriterSettings</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">Indent</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">true</span><span class="w"> </span><span class="p">};</span>
</span><span id="__span-49-7"><a id="__codelineno-49-7" name="__codelineno-49-7" href="#__codelineno-49-7"></a><span class="k">using</span><span class="w"> </span><span class="p">(</span><span class="n">XmlWriter</span><span class="w"> </span><span class="n">xw</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">XmlWriter</span><span class="p">.</span><span class="n">Create</span><span class="w"> </span><span class="p">(</span><span class="n">output</span><span class="p">,</span><span class="w"> </span><span class="n">settings</span><span class="p">))</span>
</span><span id="__span-49-8"><a id="__codelineno-49-8" name="__codelineno-49-8" href="#__codelineno-49-8"></a><span class="w"> </span><span class="n">doc</span><span class="p">.</span><span class="n">Save</span><span class="w"> </span><span class="p">(</span><span class="n">xw</span><span class="p">);</span>
</span><span id="__span-49-9"><a id="__codelineno-49-9" name="__codelineno-49-9" href="#__codelineno-49-9"></a><span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="w"> </span><span class="p">(</span><span class="n">output</span><span class="p">.</span><span class="n">ToString</span><span class="p">());</span>
</span><span id="__span-49-10"><a id="__codelineno-49-10" name="__codelineno-49-10" href="#__codelineno-49-10"></a><span class="c1">//This is the result:</span>
</span><span id="__span-49-11"><a id="__codelineno-49-11" name="__codelineno-49-11" href="#__codelineno-49-11"></a><span class="o">&lt;?</span><span class="n">xml</span><span class="w"> </span><span class="n">version</span><span class="o">=</span><span class="s">&quot;1.0&quot;</span><span class="w"> </span><span class="n">encoding</span><span class="o">=</span><span class="s">&quot;utf-16&quot;</span><span class="w"> </span><span class="n">standalone</span><span class="o">=</span><span class="s">&quot;yes&quot;</span><span class="o">?&gt;</span>
</span><span id="__span-49-12"><a id="__codelineno-49-12" name="__codelineno-49-12" href="#__codelineno-49-12"></a><span class="o">&lt;</span><span class="n">test</span><span class="o">&gt;</span><span class="n">data</span><span class="o">&lt;/</span><span class="n">test</span><span class="o">&gt;</span>
</span></code></pre></div>
<h1 id="names-and-namespaces">Names and Namespaces</h1>
<h3 id="namespaces-in-xml">Namespaces in XML</h3>
<p>Suppose that we want to define a customer element in the namespace OReilly.Nutshell.CSharp. There are two ways to proceed. The first is to use the xmlns attribute:</p>
<p><code>&lt;customer xmlns="OReilly.Nutshell.CSharp"/&gt;</code></p>
<p>xmlns is a special reserved attribute. When used in this manner, it performs two functions</p>
<p>â€¢ It specifies a namespace for the element in question.
â€¢ It specifies a default namespace for all descendant elements.</p>
<p>This means that in the following example, address and postcode implicitly reside in the OReilly.Nutshell.CSharp namespace:</p>
<div class="language-xml highlight"><pre><span></span><code><span id="__span-50-1"><a id="__codelineno-50-1" name="__codelineno-50-1" href="#__codelineno-50-1"></a><span class="nt">&lt;customer</span><span class="w"> </span><span class="na">xmlns=</span><span class="s">&quot;OReilly.Nutshell.CSharp&quot;</span><span class="nt">&gt;</span>
</span><span id="__span-50-2"><a id="__codelineno-50-2" name="__codelineno-50-2" href="#__codelineno-50-2"></a><span class="w"> </span><span class="nt">&lt;address&gt;</span>
</span><span id="__span-50-3"><a id="__codelineno-50-3" name="__codelineno-50-3" href="#__codelineno-50-3"></a><span class="w"> </span><span class="nt">&lt;postcode&gt;</span>02138<span class="nt">&lt;/postcode&gt;</span>
</span><span id="__span-50-4"><a id="__codelineno-50-4" name="__codelineno-50-4" href="#__codelineno-50-4"></a><span class="w"> </span><span class="nt">&lt;/address&gt;</span>
</span><span id="__span-50-5"><a id="__codelineno-50-5" name="__codelineno-50-5" href="#__codelineno-50-5"></a><span class="nt">&lt;/customer&gt;</span>
</span><span id="__span-50-6"><a id="__codelineno-50-6" name="__codelineno-50-6" href="#__codelineno-50-6"></a>//If<span class="w"> </span>we<span class="w"> </span>want<span class="w"> </span>address<span class="w"> </span>and<span class="w"> </span>postcode<span class="w"> </span>to<span class="w"> </span>have<span class="w"> </span>no<span class="w"> </span>namespace,<span class="w"> </span>weâ€™d<span class="w"> </span>need<span class="w"> </span>to<span class="w"> </span>do<span class="w"> </span>this:
</span><span id="__span-50-7"><a id="__codelineno-50-7" name="__codelineno-50-7" href="#__codelineno-50-7"></a><span class="nt">&lt;customer</span><span class="w"> </span><span class="na">xmlns=</span><span class="s">&quot;OReilly.Nutshell.CSharp&quot;</span><span class="nt">&gt;</span>
</span><span id="__span-50-8"><a id="__codelineno-50-8" name="__codelineno-50-8" href="#__codelineno-50-8"></a><span class="w"> </span><span class="nt">&lt;address</span><span class="w"> </span><span class="na">xmlns=</span><span class="s">&quot;&quot;</span><span class="nt">&gt;</span>
</span><span id="__span-50-9"><a id="__codelineno-50-9" name="__codelineno-50-9" href="#__codelineno-50-9"></a><span class="w"> </span><span class="nt">&lt;postcode&gt;</span>02138<span class="nt">&lt;/postcode&gt;</span><span class="w"> </span><span class="cm">&lt;!-- postcode now inherits empty ns --&gt;</span>
</span><span id="__span-50-10"><a id="__codelineno-50-10" name="__codelineno-50-10" href="#__codelineno-50-10"></a><span class="w"> </span><span class="nt">&lt;/address&gt;</span>
</span><span id="__span-50-11"><a id="__codelineno-50-11" name="__codelineno-50-11" href="#__codelineno-50-11"></a><span class="nt">&lt;/customer&gt;</span>
</span></code></pre></div>
<h3 id="prefixes">Prefixes</h3>
<p>The other way to specify a namespace is with a prefix. A prefix is an alias that you assign to a namespace to save typing. There are two steps in using a prefixâ€”defining the prefix and using it. You can do both together:</p>
<p><code>&lt;nut:customer xmlns:nut="OReilly.Nutshell.CSharp"/&gt;</code></p>
<div class="language-xml highlight"><pre><span></span><code><span id="__span-51-1"><a id="__codelineno-51-1" name="__codelineno-51-1" href="#__codelineno-51-1"></a><span class="nt">&lt;nut:customer</span><span class="w"> </span><span class="na">xmlns:nut=</span><span class="s">&quot;OReilly.Nutshell.CSharp&quot;</span><span class="nt">&gt;</span>
</span><span id="__span-51-2"><a id="__codelineno-51-2" name="__codelineno-51-2" href="#__codelineno-51-2"></a><span class="w"> </span><span class="nt">&lt;nut:firstname&gt;</span>Joe<span class="nt">&lt;/firstname&gt;</span>
</span><span id="__span-51-3"><a id="__codelineno-51-3" name="__codelineno-51-3" href="#__codelineno-51-3"></a><span class="nt">&lt;/customer&gt;</span>
</span></code></pre></div>
<h3 id="attributes">Attributes</h3>
<p>You can assign namespaces to attributes, too. The main difference is that it always requires a prefix; for instance:</p>
<div class="language-xml highlight"><pre><span></span><code><span id="__span-52-1"><a id="__codelineno-52-1" name="__codelineno-52-1" href="#__codelineno-52-1"></a><span class="nt">&lt;customer</span><span class="w"> </span><span class="na">xmlns:nut=</span><span class="s">&quot;OReilly.Nutshell.CSharp&quot;</span><span class="w"> </span><span class="na">nut:id=</span><span class="s">&quot;123&quot;</span><span class="w"> </span><span class="nt">/&gt;</span>
</span></code></pre></div>
<h3 id="specifying-namespaces-in-the-x-dom">Specifying Namespaces in the X-DOM</h3>
<p>There are a couple of ways to specify an XML namespace. The first is to enclose it in braces, before the local name:</p>
<div class="language-csharp highlight"><pre><span></span><code><span id="__span-53-1"><a id="__codelineno-53-1" name="__codelineno-53-1" href="#__codelineno-53-1"></a><span class="kt">var</span><span class="w"> </span><span class="n">e</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">XElement</span><span class="w"> </span><span class="p">(</span><span class="s">&quot;{http://domain.com/xmlspace}customer&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Bloggs&quot;</span><span class="p">);</span>
</span><span id="__span-53-2"><a id="__codelineno-53-2" name="__codelineno-53-2" href="#__codelineno-53-2"></a><span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="w"> </span><span class="p">(</span><span class="n">e</span><span class="p">.</span><span class="n">ToString</span><span class="p">());</span>
</span><span id="__span-53-3"><a id="__codelineno-53-3" name="__codelineno-53-3" href="#__codelineno-53-3"></a><span class="c1">//This yields the resulting XML:</span>
</span><span id="__span-53-4"><a id="__codelineno-53-4" name="__codelineno-53-4" href="#__codelineno-53-4"></a><span class="o">&lt;</span><span class="n">customer</span><span class="w"> </span><span class="n">xmlns</span><span class="o">=</span><span class="s">&quot;http://domain.com/xmlspace&quot;</span><span class="o">&gt;</span><span class="n">Bloggs</span><span class="o">&lt;/</span><span class="n">customer</span><span class="o">&gt;</span>
</span></code></pre></div>
<p>The second (and more performant) approach is to use the XNamespace and XName types.</p>
<div class="language-csharp highlight"><pre><span></span><code><span id="__span-54-1"><a id="__codelineno-54-1" name="__codelineno-54-1" href="#__codelineno-54-1"></a><span class="k">public</span><span class="w"> </span><span class="k">sealed</span><span class="w"> </span><span class="k">class</span><span class="w"> </span><span class="nc">XNamespace</span>
</span><span id="__span-54-2"><a id="__codelineno-54-2" name="__codelineno-54-2" href="#__codelineno-54-2"></a><span class="p">{</span>
</span><span id="__span-54-3"><a id="__codelineno-54-3" name="__codelineno-54-3" href="#__codelineno-54-3"></a><span class="w"> </span><span class="k">public</span><span class="w"> </span><span class="kt">string</span><span class="w"> </span><span class="n">NamespaceName</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">get</span><span class="p">;</span><span class="w"> </span><span class="p">}</span>
</span><span id="__span-54-4"><a id="__codelineno-54-4" name="__codelineno-54-4" href="#__codelineno-54-4"></a><span class="p">}</span>
</span><span id="__span-54-5"><a id="__codelineno-54-5" name="__codelineno-54-5" href="#__codelineno-54-5"></a><span class="k">public</span><span class="w"> </span><span class="k">sealed</span><span class="w"> </span><span class="k">class</span><span class="w"> </span><span class="nc">XName</span><span class="w"> </span><span class="c1">// A local name with optional namespace</span>
</span><span id="__span-54-6"><a id="__codelineno-54-6" name="__codelineno-54-6" href="#__codelineno-54-6"></a><span class="p">{</span>
</span><span id="__span-54-7"><a id="__codelineno-54-7" name="__codelineno-54-7" href="#__codelineno-54-7"></a><span class="w"> </span><span class="k">public</span><span class="w"> </span><span class="kt">string</span><span class="w"> </span><span class="n">LocalName</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">get</span><span class="p">;</span><span class="w"> </span><span class="p">}</span>
</span><span id="__span-54-8"><a id="__codelineno-54-8" name="__codelineno-54-8" href="#__codelineno-54-8"></a><span class="w"> </span><span class="k">public</span><span class="w"> </span><span class="n">XNamespace</span><span class="w"> </span><span class="n">Namespace</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">get</span><span class="p">;</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="c1">// Optional</span>
</span><span id="__span-54-9"><a id="__codelineno-54-9" name="__codelineno-54-9" href="#__codelineno-54-9"></a><span class="p">}</span>
</span></code></pre></div>
<p>Both types define implicit casts from string, so the following is legal</p>
<div class="language-csharp highlight"><pre><span></span><code><span id="__span-55-1"><a id="__codelineno-55-1" name="__codelineno-55-1" href="#__codelineno-55-1"></a><span class="n">XNamespace</span><span class="w"> </span><span class="n">ns</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;http://domain.com/xmlspace&quot;</span><span class="p">;</span>
</span><span id="__span-55-2"><a id="__codelineno-55-2" name="__codelineno-55-2" href="#__codelineno-55-2"></a><span class="n">XName</span><span class="w"> </span><span class="n">localName</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;customer&quot;</span><span class="p">;</span>
</span><span id="__span-55-3"><a id="__codelineno-55-3" name="__codelineno-55-3" href="#__codelineno-55-3"></a><span class="n">XName</span><span class="w"> </span><span class="n">fullName</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;{http://domain.com/xmlspace}customer&quot;</span><span class="p">;</span>
</span><span id="__span-55-4"><a id="__codelineno-55-4" name="__codelineno-55-4" href="#__codelineno-55-4"></a>
</span><span id="__span-55-5"><a id="__codelineno-55-5" name="__codelineno-55-5" href="#__codelineno-55-5"></a><span class="n">XNamespace</span><span class="w"> </span><span class="n">ns</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;http://domain.com/xmlspace&quot;</span><span class="p">;</span>
</span><span id="__span-55-6"><a id="__codelineno-55-6" name="__codelineno-55-6" href="#__codelineno-55-6"></a><span class="n">XName</span><span class="w"> </span><span class="n">fullName</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ns</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s">&quot;customer&quot;</span><span class="p">;</span>
</span><span id="__span-55-7"><a id="__codelineno-55-7" name="__codelineno-55-7" href="#__codelineno-55-7"></a><span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="w"> </span><span class="p">(</span><span class="n">fullName</span><span class="p">);</span><span class="w"> </span><span class="c1">// {http://domain.com/xmlspace}customer</span>
</span><span id="__span-55-8"><a id="__codelineno-55-8" name="__codelineno-55-8" href="#__codelineno-55-8"></a>
</span><span id="__span-55-9"><a id="__codelineno-55-9" name="__codelineno-55-9" href="#__codelineno-55-9"></a><span class="c1">//Specifying a namespace is the same whether for an element or an attribute:</span>
</span><span id="__span-55-10"><a id="__codelineno-55-10" name="__codelineno-55-10" href="#__codelineno-55-10"></a><span class="n">XNamespace</span><span class="w"> </span><span class="n">ns</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;http://domain.com/xmlspace&quot;</span><span class="p">;</span>
</span><span id="__span-55-11"><a id="__codelineno-55-11" name="__codelineno-55-11" href="#__codelineno-55-11"></a><span class="kt">var</span><span class="w"> </span><span class="n">data</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">XElement</span><span class="w"> </span><span class="p">(</span><span class="n">ns</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s">&quot;data&quot;</span><span class="p">,</span>
</span><span id="__span-55-12"><a id="__codelineno-55-12" name="__codelineno-55-12" href="#__codelineno-55-12"></a><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="nf">XAttribute</span><span class="w"> </span><span class="p">(</span><span class="n">ns</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s">&quot;id&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">123</span><span class="p">)</span>
</span><span id="__span-55-13"><a id="__codelineno-55-13" name="__codelineno-55-13" href="#__codelineno-55-13"></a><span class="w"> </span><span class="p">);</span>
</span></code></pre></div>
<h3 id="the-x-dom-and-default-namespaces">The X-DOM and Default Namespaces</h3>
<p>The X-DOM ignores the concept of default namespaces until it comes time to actually output XML. This means that when you construct a child XElement, you must give it a namespace explicitly if needed: it will not inherit from the parent:</p>
<div class="language-csharp highlight"><pre><span></span><code><span id="__span-56-1"><a id="__codelineno-56-1" name="__codelineno-56-1" href="#__codelineno-56-1"></a><span class="n">XNamespace</span><span class="w"> </span><span class="n">ns</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;http://domain.com/xmlspace&quot;</span><span class="p">;</span>
</span><span id="__span-56-2"><a id="__codelineno-56-2" name="__codelineno-56-2" href="#__codelineno-56-2"></a><span class="kt">var</span><span class="w"> </span><span class="n">data</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">XElement</span><span class="w"> </span><span class="p">(</span><span class="n">ns</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s">&quot;data&quot;</span><span class="p">,</span>
</span><span id="__span-56-3"><a id="__codelineno-56-3" name="__codelineno-56-3" href="#__codelineno-56-3"></a><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="nf">XElement</span><span class="w"> </span><span class="p">(</span><span class="n">ns</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s">&quot;customer&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Bloggs&quot;</span><span class="p">),</span>
</span><span id="__span-56-4"><a id="__codelineno-56-4" name="__codelineno-56-4" href="#__codelineno-56-4"></a><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="nf">XElement</span><span class="w"> </span><span class="p">(</span><span class="n">ns</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s">&quot;purchase&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Bicycle&quot;</span><span class="p">)</span>
</span><span id="__span-56-5"><a id="__codelineno-56-5" name="__codelineno-56-5" href="#__codelineno-56-5"></a><span class="w"> </span><span class="p">);</span>
</span></code></pre></div>
<p>The X-DOM does, however, apply default namespaces when reading and outputting
XML:</p>
<div class="language-csharp highlight"><pre><span></span><code><span id="__span-57-1"><a id="__codelineno-57-1" name="__codelineno-57-1" href="#__codelineno-57-1"></a><span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="w"> </span><span class="p">(</span><span class="n">data</span><span class="p">.</span><span class="n">ToString</span><span class="p">());</span>
</span><span id="__span-57-2"><a id="__codelineno-57-2" name="__codelineno-57-2" href="#__codelineno-57-2"></a><span class="n">OUTPUT</span><span class="p">:</span>
</span><span id="__span-57-3"><a id="__codelineno-57-3" name="__codelineno-57-3" href="#__codelineno-57-3"></a><span class="w"> </span><span class="o">&lt;</span><span class="n">data</span><span class="w"> </span><span class="n">xmlns</span><span class="o">=</span><span class="s">&quot;http://domain.com/xmlspace&quot;</span><span class="o">&gt;</span>
</span><span id="__span-57-4"><a id="__codelineno-57-4" name="__codelineno-57-4" href="#__codelineno-57-4"></a><span class="w"> </span><span class="o">&lt;</span><span class="n">customer</span><span class="o">&gt;</span><span class="n">Bloggs</span><span class="o">&lt;/</span><span class="n">customer</span><span class="o">&gt;</span>
</span><span id="__span-57-5"><a id="__codelineno-57-5" name="__codelineno-57-5" href="#__codelineno-57-5"></a><span class="w"> </span><span class="o">&lt;</span><span class="n">purchase</span><span class="o">&gt;</span><span class="n">Bicycle</span><span class="o">&lt;/</span><span class="n">purchase</span><span class="o">&gt;</span>
</span><span id="__span-57-6"><a id="__codelineno-57-6" name="__codelineno-57-6" href="#__codelineno-57-6"></a><span class="w"> </span><span class="o">&lt;/</span><span class="n">data</span><span class="o">&gt;</span>
</span><span id="__span-57-7"><a id="__codelineno-57-7" name="__codelineno-57-7" href="#__codelineno-57-7"></a><span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="w"> </span><span class="p">(</span><span class="n">data</span><span class="p">.</span><span class="n">Element</span><span class="w"> </span><span class="p">(</span><span class="n">ns</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s">&quot;customer&quot;</span><span class="p">).</span><span class="n">ToString</span><span class="p">());</span>
</span><span id="__span-57-8"><a id="__codelineno-57-8" name="__codelineno-57-8" href="#__codelineno-57-8"></a><span class="n">OUTPUT</span><span class="p">:</span>
</span><span id="__span-57-9"><a id="__codelineno-57-9" name="__codelineno-57-9" href="#__codelineno-57-9"></a><span class="w"> </span><span class="o">&lt;</span><span class="n">customer</span><span class="w"> </span><span class="n">xmlns</span><span class="o">=</span><span class="s">&quot;http://domain.com/xmlspace&quot;</span><span class="o">&gt;</span><span class="n">Bloggs</span><span class="o">&lt;/</span><span class="n">customer</span><span class="o">&gt;</span>
</span></code></pre></div>
<p>If you construct XElement children without specifying namespaces; in other words:</p>
<div class="language-csharp highlight"><pre><span></span><code><span id="__span-58-1"><a id="__codelineno-58-1" name="__codelineno-58-1" href="#__codelineno-58-1"></a><span class="n">XNamespace</span><span class="w"> </span><span class="n">ns</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;http://domain.com/xmlspace&quot;</span><span class="p">;</span>
</span><span id="__span-58-2"><a id="__codelineno-58-2" name="__codelineno-58-2" href="#__codelineno-58-2"></a><span class="kt">var</span><span class="w"> </span><span class="n">data</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">XElement</span><span class="w"> </span><span class="p">(</span><span class="n">ns</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s">&quot;data&quot;</span><span class="p">,</span>
</span><span id="__span-58-3"><a id="__codelineno-58-3" name="__codelineno-58-3" href="#__codelineno-58-3"></a><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="nf">XElement</span><span class="w"> </span><span class="p">(</span><span class="s">&quot;customer&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Bloggs&quot;</span><span class="p">),</span>
</span><span id="__span-58-4"><a id="__codelineno-58-4" name="__codelineno-58-4" href="#__codelineno-58-4"></a><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="nf">XElement</span><span class="w"> </span><span class="p">(</span><span class="s">&quot;purchase&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Bicycle&quot;</span><span class="p">)</span>
</span><span id="__span-58-5"><a id="__codelineno-58-5" name="__codelineno-58-5" href="#__codelineno-58-5"></a><span class="w"> </span><span class="p">);</span>
</span><span id="__span-58-6"><a id="__codelineno-58-6" name="__codelineno-58-6" href="#__codelineno-58-6"></a><span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="w"> </span><span class="p">(</span><span class="n">data</span><span class="p">.</span><span class="n">ToString</span><span class="p">());</span>
</span><span id="__span-58-7"><a id="__codelineno-58-7" name="__codelineno-58-7" href="#__codelineno-58-7"></a><span class="n">you</span><span class="w"> </span><span class="k">get</span><span class="w"> </span><span class="k">this</span><span class="w"> </span><span class="n">result</span><span class="p">,</span><span class="w"> </span><span class="n">instead</span><span class="p">:</span>
</span><span id="__span-58-8"><a id="__codelineno-58-8" name="__codelineno-58-8" href="#__codelineno-58-8"></a><span class="o">&lt;</span><span class="n">data</span><span class="w"> </span><span class="n">xmlns</span><span class="o">=</span><span class="s">&quot;http://domain.com/xmlspace&quot;</span><span class="o">&gt;</span>
</span><span id="__span-58-9"><a id="__codelineno-58-9" name="__codelineno-58-9" href="#__codelineno-58-9"></a><span class="w"> </span><span class="o">&lt;</span><span class="n">customer</span><span class="w"> </span><span class="n">xmlns</span><span class="o">=</span><span class="s">&quot;&quot;</span><span class="o">&gt;</span><span class="n">Bloggs</span><span class="o">&lt;/</span><span class="n">customer</span><span class="o">&gt;</span>
</span><span id="__span-58-10"><a id="__codelineno-58-10" name="__codelineno-58-10" href="#__codelineno-58-10"></a><span class="o">&lt;</span><span class="n">purchase</span><span class="w"> </span><span class="n">xmlns</span><span class="o">=</span><span class="s">&quot;&quot;</span><span class="o">&gt;</span><span class="n">Bicycle</span><span class="o">&lt;/</span><span class="n">purchase</span><span class="o">&gt;</span>
</span><span id="__span-58-11"><a id="__codelineno-58-11" name="__codelineno-58-11" href="#__codelineno-58-11"></a><span class="o">&lt;/</span><span class="n">data</span><span class="o">&gt;</span>
</span></code></pre></div>
<p>Another trap is failing to include a namespace when navigating an X-DOM</p>
<div class="language-csharp highlight"><pre><span></span><code><span id="__span-59-1"><a id="__codelineno-59-1" name="__codelineno-59-1" href="#__codelineno-59-1"></a><span class="n">XNamespace</span><span class="w"> </span><span class="n">ns</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;http://domain.com/xmlspace&quot;</span><span class="p">;</span>
</span><span id="__span-59-2"><a id="__codelineno-59-2" name="__codelineno-59-2" href="#__codelineno-59-2"></a><span class="kt">var</span><span class="w"> </span><span class="n">data</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">XElement</span><span class="w"> </span><span class="p">(</span><span class="n">ns</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s">&quot;data&quot;</span><span class="p">,</span>
</span><span id="__span-59-3"><a id="__codelineno-59-3" name="__codelineno-59-3" href="#__codelineno-59-3"></a><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="nf">XElement</span><span class="w"> </span><span class="p">(</span><span class="n">ns</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s">&quot;customer&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Bloggs&quot;</span><span class="p">),</span>
</span><span id="__span-59-4"><a id="__codelineno-59-4" name="__codelineno-59-4" href="#__codelineno-59-4"></a><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="nf">XElement</span><span class="w"> </span><span class="p">(</span><span class="n">ns</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s">&quot;purchase&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Bicycle&quot;</span><span class="p">)</span>
</span><span id="__span-59-5"><a id="__codelineno-59-5" name="__codelineno-59-5" href="#__codelineno-59-5"></a><span class="w"> </span><span class="p">);</span>
</span><span id="__span-59-6"><a id="__codelineno-59-6" name="__codelineno-59-6" href="#__codelineno-59-6"></a><span class="n">XElement</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">data</span><span class="p">.</span><span class="n">Element</span><span class="w"> </span><span class="p">(</span><span class="n">ns</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s">&quot;customer&quot;</span><span class="p">);</span><span class="w"> </span><span class="c1">// ok</span>
</span><span id="__span-59-7"><a id="__codelineno-59-7" name="__codelineno-59-7" href="#__codelineno-59-7"></a><span class="n">XElement</span><span class="w"> </span><span class="n">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">data</span><span class="p">.</span><span class="n">Element</span><span class="w"> </span><span class="p">(</span><span class="s">&quot;customer&quot;</span><span class="p">);</span><span class="w"> </span><span class="c1">// null</span>
</span></code></pre></div>
<h3 id="prefixes_1">Prefixes</h3>
<p>The X-DOM treats prefixes just as it treats namespaces: purely as a serialization function. This means that you can choose to completely ignore the issue of prefixes â€”and get by! The only reason you might want to do otherwise is for efficiency when outputting to an XML file.</p>
<div class="language-csharp highlight"><pre><span></span><code><span id="__span-60-1"><a id="__codelineno-60-1" name="__codelineno-60-1" href="#__codelineno-60-1"></a><span class="n">XNamespace</span><span class="w"> </span><span class="n">ns1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;http://domain.com/space1&quot;</span><span class="p">;</span>
</span><span id="__span-60-2"><a id="__codelineno-60-2" name="__codelineno-60-2" href="#__codelineno-60-2"></a><span class="n">XNamespace</span><span class="w"> </span><span class="n">ns2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;http://domain.com/space2&quot;</span><span class="p">;</span>
</span><span id="__span-60-3"><a id="__codelineno-60-3" name="__codelineno-60-3" href="#__codelineno-60-3"></a><span class="kt">var</span><span class="w"> </span><span class="n">mix</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">XElement</span><span class="w"> </span><span class="p">(</span><span class="n">ns1</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s">&quot;data&quot;</span><span class="p">,</span>
</span><span id="__span-60-4"><a id="__codelineno-60-4" name="__codelineno-60-4" href="#__codelineno-60-4"></a><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="nf">XElement</span><span class="w"> </span><span class="p">(</span><span class="n">ns2</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s">&quot;element&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;value&quot;</span><span class="p">),</span>
</span><span id="__span-60-5"><a id="__codelineno-60-5" name="__codelineno-60-5" href="#__codelineno-60-5"></a><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="nf">XElement</span><span class="w"> </span><span class="p">(</span><span class="n">ns2</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s">&quot;element&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;value&quot;</span><span class="p">),</span>
</span><span id="__span-60-6"><a id="__codelineno-60-6" name="__codelineno-60-6" href="#__codelineno-60-6"></a><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="nf">XElement</span><span class="w"> </span><span class="p">(</span><span class="n">ns2</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s">&quot;element&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;value&quot;</span><span class="p">)</span>
</span><span id="__span-60-7"><a id="__codelineno-60-7" name="__codelineno-60-7" href="#__codelineno-60-7"></a><span class="w"> </span><span class="p">);</span>
</span><span id="__span-60-8"><a id="__codelineno-60-8" name="__codelineno-60-8" href="#__codelineno-60-8"></a><span class="c1">//By default, XElement will serialize this, as follows:</span>
</span><span id="__span-60-9"><a id="__codelineno-60-9" name="__codelineno-60-9" href="#__codelineno-60-9"></a><span class="o">&lt;</span><span class="n">data</span><span class="w"> </span><span class="n">xmlns</span><span class="o">=</span><span class="s">&quot;http://domain.com/space1&quot;</span><span class="o">&gt;</span>
</span><span id="__span-60-10"><a id="__codelineno-60-10" name="__codelineno-60-10" href="#__codelineno-60-10"></a><span class="w"> </span><span class="o">&lt;</span><span class="n">element</span><span class="w"> </span><span class="n">xmlns</span><span class="o">=</span><span class="s">&quot;http://domain.com/space2&quot;</span><span class="o">&gt;</span><span class="k">value</span><span class="o">&lt;/</span><span class="n">element</span><span class="o">&gt;</span>
</span><span id="__span-60-11"><a id="__codelineno-60-11" name="__codelineno-60-11" href="#__codelineno-60-11"></a><span class="w"> </span><span class="o">&lt;</span><span class="n">element</span><span class="w"> </span><span class="n">xmlns</span><span class="o">=</span><span class="s">&quot;http://domain.com/space2&quot;</span><span class="o">&gt;</span><span class="k">value</span><span class="o">&lt;/</span><span class="n">element</span><span class="o">&gt;</span>
</span><span id="__span-60-12"><a id="__codelineno-60-12" name="__codelineno-60-12" href="#__codelineno-60-12"></a><span class="w"> </span><span class="o">&lt;</span><span class="n">element</span><span class="w"> </span><span class="n">xmlns</span><span class="o">=</span><span class="s">&quot;http://domain.com/space2&quot;</span><span class="o">&gt;</span><span class="k">value</span><span class="o">&lt;/</span><span class="n">element</span><span class="o">&gt;</span>
</span><span id="__span-60-13"><a id="__codelineno-60-13" name="__codelineno-60-13" href="#__codelineno-60-13"></a><span class="o">&lt;/</span><span class="n">data</span><span class="o">&gt;</span>
</span></code></pre></div>
<div class="language-csharp highlight"><pre><span></span><code><span id="__span-61-1"><a id="__codelineno-61-1" name="__codelineno-61-1" href="#__codelineno-61-1"></a><span class="n">XNamespace</span><span class="w"> </span><span class="n">xsi</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span><span class="p">;</span>
</span><span id="__span-61-2"><a id="__codelineno-61-2" name="__codelineno-61-2" href="#__codelineno-61-2"></a><span class="kt">var</span><span class="w"> </span><span class="n">nil</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">XAttribute</span><span class="w"> </span><span class="p">(</span><span class="n">xsi</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s">&quot;nil&quot;</span><span class="p">,</span><span class="w"> </span><span class="k">true</span><span class="p">);</span>
</span><span id="__span-61-3"><a id="__codelineno-61-3" name="__codelineno-61-3" href="#__codelineno-61-3"></a><span class="kt">var</span><span class="w"> </span><span class="n">cust</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">XElement</span><span class="w"> </span><span class="p">(</span><span class="s">&quot;customers&quot;</span><span class="p">,</span>
</span><span id="__span-61-4"><a id="__codelineno-61-4" name="__codelineno-61-4" href="#__codelineno-61-4"></a><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="nf">XAttribute</span><span class="w"> </span><span class="p">(</span><span class="n">XNamespace</span><span class="p">.</span><span class="n">Xmlns</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s">&quot;xsi&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">xsi</span><span class="p">),</span>
</span><span id="__span-61-5"><a id="__codelineno-61-5" name="__codelineno-61-5" href="#__codelineno-61-5"></a><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="nf">XElement</span><span class="w"> </span><span class="p">(</span><span class="s">&quot;customer&quot;</span><span class="p">,</span>
</span><span id="__span-61-6"><a id="__codelineno-61-6" name="__codelineno-61-6" href="#__codelineno-61-6"></a><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="nf">XElement</span><span class="w"> </span><span class="p">(</span><span class="s">&quot;lastname&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Bloggs&quot;</span><span class="p">),</span>
</span><span id="__span-61-7"><a id="__codelineno-61-7" name="__codelineno-61-7" href="#__codelineno-61-7"></a><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="nf">XElement</span><span class="w"> </span><span class="p">(</span><span class="s">&quot;dob&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">nil</span><span class="p">),</span>
</span><span id="__span-61-8"><a id="__codelineno-61-8" name="__codelineno-61-8" href="#__codelineno-61-8"></a><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="nf">XElement</span><span class="w"> </span><span class="p">(</span><span class="s">&quot;credit&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">nil</span><span class="p">)</span>
</span><span id="__span-61-9"><a id="__codelineno-61-9" name="__codelineno-61-9" href="#__codelineno-61-9"></a><span class="w"> </span><span class="p">)</span>
</span><span id="__span-61-10"><a id="__codelineno-61-10" name="__codelineno-61-10" href="#__codelineno-61-10"></a><span class="w"> </span><span class="p">);</span>
</span><span id="__span-61-11"><a id="__codelineno-61-11" name="__codelineno-61-11" href="#__codelineno-61-11"></a><span class="n">This</span><span class="w"> </span><span class="k">is</span><span class="w"> </span><span class="n">its</span><span class="w"> </span><span class="n">XML</span><span class="p">:</span>
</span><span id="__span-61-12"><a id="__codelineno-61-12" name="__codelineno-61-12" href="#__codelineno-61-12"></a><span class="o">&lt;</span><span class="n">customers</span><span class="w"> </span><span class="n">xmlns</span><span class="p">:</span><span class="n">xsi</span><span class="o">=</span><span class="s">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span><span class="o">&gt;</span>
</span><span id="__span-61-13"><a id="__codelineno-61-13" name="__codelineno-61-13" href="#__codelineno-61-13"></a><span class="w"> </span><span class="o">&lt;</span><span class="n">customer</span><span class="o">&gt;</span>
</span><span id="__span-61-14"><a id="__codelineno-61-14" name="__codelineno-61-14" href="#__codelineno-61-14"></a><span class="w"> </span><span class="o">&lt;</span><span class="n">lastname</span><span class="o">&gt;</span><span class="n">Bloggs</span><span class="o">&lt;/</span><span class="n">lastname</span><span class="o">&gt;</span>
</span><span id="__span-61-15"><a id="__codelineno-61-15" name="__codelineno-61-15" href="#__codelineno-61-15"></a><span class="w"> </span><span class="o">&lt;</span><span class="n">dob</span><span class="w"> </span><span class="n">xsi</span><span class="p">:</span><span class="n">nil</span><span class="o">=</span><span class="s">&quot;true&quot;</span><span class="w"> </span><span class="o">/&gt;</span>
</span><span id="__span-61-16"><a id="__codelineno-61-16" name="__codelineno-61-16" href="#__codelineno-61-16"></a><span class="w"> </span><span class="o">&lt;</span><span class="n">credit</span><span class="w"> </span><span class="n">xsi</span><span class="p">:</span><span class="n">nil</span><span class="o">=</span><span class="s">&quot;true&quot;</span><span class="w"> </span><span class="o">/&gt;</span>
</span><span id="__span-61-17"><a id="__codelineno-61-17" name="__codelineno-61-17" href="#__codelineno-61-17"></a><span class="w"> </span><span class="o">&lt;/</span><span class="n">customer</span><span class="o">&gt;</span>
</span><span id="__span-61-18"><a id="__codelineno-61-18" name="__codelineno-61-18" href="#__codelineno-61-18"></a><span class="o">&lt;/</span><span class="n">customers</span><span class="o">&gt;</span>
</span></code></pre></div>
<h1 id="annotations">Annotations</h1>
<p>You can attach custom data to any XObject with an annotation. Annotations are intended for your own private use and are treated as black boxes by X-DOM. If youâ€™ve ever used the Tag property on a Windows Forms or WPF control, youâ€™ll be familiar with the conceptâ€”the difference is that you have multiple annotations, and your annotations can be privately scoped. You can create an annotation that other types cannot even seeâ€”let alone overwrite</p>
<div class="language-csharp highlight"><pre><span></span><code><span id="__span-62-1"><a id="__codelineno-62-1" name="__codelineno-62-1" href="#__codelineno-62-1"></a><span class="c1">//The following methods on XObject add and remove annotations:</span>
</span><span id="__span-62-2"><a id="__codelineno-62-2" name="__codelineno-62-2" href="#__codelineno-62-2"></a><span class="k">public</span><span class="w"> </span><span class="k">void</span><span class="w"> </span><span class="nf">AddAnnotation</span><span class="w"> </span><span class="p">(</span><span class="kt">object</span><span class="w"> </span><span class="n">annotation</span><span class="p">)</span>
</span><span id="__span-62-3"><a id="__codelineno-62-3" name="__codelineno-62-3" href="#__codelineno-62-3"></a><span class="k">public</span><span class="w"> </span><span class="k">void</span><span class="w"> </span><span class="n">RemoveAnnotations</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span><span class="p">()</span><span class="w"> </span><span class="k">where</span><span class="w"> </span><span class="n">T</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="k">class</span>
</span><span id="__span-62-4"><a id="__codelineno-62-4" name="__codelineno-62-4" href="#__codelineno-62-4"></a><span class="c1">//The following methods retrieve annotations:</span>
</span><span id="__span-62-5"><a id="__codelineno-62-5" name="__codelineno-62-5" href="#__codelineno-62-5"></a><span class="k">public</span><span class="w"> </span><span class="n">T</span><span class="w"> </span><span class="n">Annotation</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span><span class="p">()</span><span class="w"> </span><span class="k">where</span><span class="w"> </span><span class="n">T</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="k">class</span>
</span><span id="__span-62-6"><a id="__codelineno-62-6" name="__codelineno-62-6" href="#__codelineno-62-6"></a><span class="nc">public</span><span class="w"> </span><span class="n">IEnumerable</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span><span class="w"> </span><span class="n">Annotations</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span><span class="p">()</span><span class="w"> </span><span class="k">where</span><span class="w"> </span><span class="n">T</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="k">class</span>
</span></code></pre></div>
<div class="language-csharp highlight"><pre><span></span><code><span id="__span-63-1"><a id="__codelineno-63-1" name="__codelineno-63-1" href="#__codelineno-63-1"></a><span class="c1">//Annotation with Custom Type</span>
</span><span id="__span-63-2"><a id="__codelineno-63-2" name="__codelineno-63-2" href="#__codelineno-63-2"></a><span class="k">void</span><span class="w"> </span><span class="nf">Main</span><span class="p">()</span>
</span><span id="__span-63-3"><a id="__codelineno-63-3" name="__codelineno-63-3" href="#__codelineno-63-3"></a><span class="p">{</span>
</span><span id="__span-63-4"><a id="__codelineno-63-4" name="__codelineno-63-4" href="#__codelineno-63-4"></a><span class="w">    </span><span class="n">XElement</span><span class="w"> </span><span class="n">e</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">XElement</span><span class="w"> </span><span class="p">(</span><span class="s">&quot;test&quot;</span><span class="p">);</span>
</span><span id="__span-63-5"><a id="__codelineno-63-5" name="__codelineno-63-5" href="#__codelineno-63-5"></a>
</span><span id="__span-63-6"><a id="__codelineno-63-6" name="__codelineno-63-6" href="#__codelineno-63-6"></a><span class="w">    </span><span class="n">e</span><span class="p">.</span><span class="n">AddAnnotation</span><span class="w"> </span><span class="p">(</span><span class="k">new</span><span class="w"> </span><span class="n">CustomData</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">Message</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;Hello&quot;</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="p">);</span>
</span><span id="__span-63-7"><a id="__codelineno-63-7" name="__codelineno-63-7" href="#__codelineno-63-7"></a><span class="w">    </span><span class="n">e</span><span class="p">.</span><span class="n">Annotations</span><span class="o">&lt;</span><span class="n">CustomData</span><span class="o">&gt;</span><span class="p">().</span><span class="n">First</span><span class="p">().</span><span class="n">Message</span><span class="p">.</span><span class="n">Dump</span><span class="p">();</span>
</span><span id="__span-63-8"><a id="__codelineno-63-8" name="__codelineno-63-8" href="#__codelineno-63-8"></a>
</span><span id="__span-63-9"><a id="__codelineno-63-9" name="__codelineno-63-9" href="#__codelineno-63-9"></a><span class="w">    </span><span class="n">e</span><span class="p">.</span><span class="n">RemoveAnnotations</span><span class="o">&lt;</span><span class="n">CustomData</span><span class="o">&gt;</span><span class="p">();</span>
</span><span id="__span-63-10"><a id="__codelineno-63-10" name="__codelineno-63-10" href="#__codelineno-63-10"></a><span class="w">    </span><span class="n">e</span><span class="p">.</span><span class="n">Annotations</span><span class="o">&lt;</span><span class="n">CustomData</span><span class="o">&gt;</span><span class="p">().</span><span class="n">Count</span><span class="p">().</span><span class="n">Dump</span><span class="p">();</span><span class="w"> </span>
</span><span id="__span-63-11"><a id="__codelineno-63-11" name="__codelineno-63-11" href="#__codelineno-63-11"></a><span class="p">}</span>
</span><span id="__span-63-12"><a id="__codelineno-63-12" name="__codelineno-63-12" href="#__codelineno-63-12"></a>
</span><span id="__span-63-13"><a id="__codelineno-63-13" name="__codelineno-63-13" href="#__codelineno-63-13"></a><span class="k">class</span><span class="w"> </span><span class="nc">CustomData</span><span class="w">                </span><span class="c1">// Private nested type</span>
</span><span id="__span-63-14"><a id="__codelineno-63-14" name="__codelineno-63-14" href="#__codelineno-63-14"></a><span class="p">{</span>
</span><span id="__span-63-15"><a id="__codelineno-63-15" name="__codelineno-63-15" href="#__codelineno-63-15"></a><span class="w">     </span><span class="k">internal</span><span class="w"> </span><span class="kt">string</span><span class="w"> </span><span class="n">Message</span><span class="p">;</span>
</span><span id="__span-63-16"><a id="__codelineno-63-16" name="__codelineno-63-16" href="#__codelineno-63-16"></a><span class="p">}</span>
</span></code></pre></div>
<h1 id="projecting-into-an-x-dom">Projecting into an X-DOM</h1>
<div class="language-csharp highlight"><pre><span></span><code><span id="__span-64-1"><a id="__codelineno-64-1" name="__codelineno-64-1" href="#__codelineno-64-1"></a><span class="c1">//suppose that we want to retrieve customers from a database into the following XML</span>
</span><span id="__span-64-2"><a id="__codelineno-64-2" name="__codelineno-64-2" href="#__codelineno-64-2"></a><span class="o">&lt;</span><span class="n">customers</span><span class="o">&gt;</span>
</span><span id="__span-64-3"><a id="__codelineno-64-3" name="__codelineno-64-3" href="#__codelineno-64-3"></a><span class="w"> </span><span class="o">&lt;</span><span class="n">customer</span><span class="w"> </span><span class="n">id</span><span class="o">=</span><span class="s">&quot;1&quot;</span><span class="o">&gt;</span>
</span><span id="__span-64-4"><a id="__codelineno-64-4" name="__codelineno-64-4" href="#__codelineno-64-4"></a><span class="w"> </span><span class="o">&lt;</span><span class="n">name</span><span class="o">&gt;</span><span class="n">Sue</span><span class="o">&lt;/</span><span class="n">name</span><span class="o">&gt;</span>
</span><span id="__span-64-5"><a id="__codelineno-64-5" name="__codelineno-64-5" href="#__codelineno-64-5"></a><span class="w"> </span><span class="o">&lt;</span><span class="n">buys</span><span class="o">&gt;</span><span class="mi">3</span><span class="o">&lt;/</span><span class="n">buys</span><span class="o">&gt;</span>
</span><span id="__span-64-6"><a id="__codelineno-64-6" name="__codelineno-64-6" href="#__codelineno-64-6"></a><span class="w"> </span><span class="o">&lt;/</span><span class="n">customer</span><span class="o">&gt;</span>
</span><span id="__span-64-7"><a id="__codelineno-64-7" name="__codelineno-64-7" href="#__codelineno-64-7"></a><span class="w"> </span><span class="p">...</span>
</span><span id="__span-64-8"><a id="__codelineno-64-8" name="__codelineno-64-8" href="#__codelineno-64-8"></a><span class="o">&lt;/</span><span class="n">customers</span><span class="o">&gt;</span>
</span><span id="__span-64-9"><a id="__codelineno-64-9" name="__codelineno-64-9" href="#__codelineno-64-9"></a><span class="c1">//We start by writing a functional construction expression for the X-DOM using simple literals:</span>
</span><span id="__span-64-10"><a id="__codelineno-64-10" name="__codelineno-64-10" href="#__codelineno-64-10"></a><span class="kt">var</span><span class="w"> </span><span class="n">customers</span><span class="w"> </span><span class="o">=</span>
</span><span id="__span-64-11"><a id="__codelineno-64-11" name="__codelineno-64-11" href="#__codelineno-64-11"></a><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="nf">XElement</span><span class="w"> </span><span class="p">(</span><span class="s">&quot;customers&quot;</span><span class="p">,</span>
</span><span id="__span-64-12"><a id="__codelineno-64-12" name="__codelineno-64-12" href="#__codelineno-64-12"></a><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="nf">XElement</span><span class="w"> </span><span class="p">(</span><span class="s">&quot;customer&quot;</span><span class="p">,</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">XAttribute</span><span class="w"> </span><span class="p">(</span><span class="s">&quot;id&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">),</span>
</span><span id="__span-64-13"><a id="__codelineno-64-13" name="__codelineno-64-13" href="#__codelineno-64-13"></a><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="nf">XElement</span><span class="w"> </span><span class="p">(</span><span class="s">&quot;name&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Sue&quot;</span><span class="p">),</span>
</span><span id="__span-64-14"><a id="__codelineno-64-14" name="__codelineno-64-14" href="#__codelineno-64-14"></a><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="nf">XElement</span><span class="w"> </span><span class="p">(</span><span class="s">&quot;buys&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">3</span><span class="p">)</span>
</span><span id="__span-64-15"><a id="__codelineno-64-15" name="__codelineno-64-15" href="#__codelineno-64-15"></a><span class="w"> </span><span class="p">)</span>
</span><span id="__span-64-16"><a id="__codelineno-64-16" name="__codelineno-64-16" href="#__codelineno-64-16"></a><span class="w"> </span><span class="p">);</span>
</span><span id="__span-64-17"><a id="__codelineno-64-17" name="__codelineno-64-17" href="#__codelineno-64-17"></a><span class="c1">//We then turn this into a projection and build a LINQ query around it:</span>
</span><span id="__span-64-18"><a id="__codelineno-64-18" name="__codelineno-64-18" href="#__codelineno-64-18"></a><span class="kt">var</span><span class="w"> </span><span class="n">customers</span><span class="w"> </span><span class="o">=</span>
</span><span id="__span-64-19"><a id="__codelineno-64-19" name="__codelineno-64-19" href="#__codelineno-64-19"></a><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="nf">XElement</span><span class="w"> </span><span class="p">(</span><span class="s">&quot;customers&quot;</span><span class="p">,</span>
</span><span id="__span-64-20"><a id="__codelineno-64-20" name="__codelineno-64-20" href="#__codelineno-64-20"></a><span class="w"> </span><span class="c1">// We must call AsEnumerable() due to a bug in EF Core.</span>
</span><span id="__span-64-21"><a id="__codelineno-64-21" name="__codelineno-64-21" href="#__codelineno-64-21"></a><span class="w"> </span><span class="k">from</span><span class="w"> </span><span class="n">c</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">dbContext</span><span class="p">.</span><span class="n">Customers</span><span class="p">.</span><span class="n">AsEnumerable</span><span class="p">()</span>
</span><span id="__span-64-22"><a id="__codelineno-64-22" name="__codelineno-64-22" href="#__codelineno-64-22"></a><span class="w"> </span><span class="k">select</span>
</span><span id="__span-64-23"><a id="__codelineno-64-23" name="__codelineno-64-23" href="#__codelineno-64-23"></a><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="nf">XElement</span><span class="w"> </span><span class="p">(</span><span class="s">&quot;customer&quot;</span><span class="p">,</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">XAttribute</span><span class="w"> </span><span class="p">(</span><span class="s">&quot;id&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">c</span><span class="p">.</span><span class="n">ID</span><span class="p">),</span>
</span><span id="__span-64-24"><a id="__codelineno-64-24" name="__codelineno-64-24" href="#__codelineno-64-24"></a><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="nf">XElement</span><span class="w"> </span><span class="p">(</span><span class="s">&quot;name&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">c</span><span class="p">.</span><span class="n">Name</span><span class="p">),</span>
</span><span id="__span-64-25"><a id="__codelineno-64-25" name="__codelineno-64-25" href="#__codelineno-64-25"></a><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="nf">XElement</span><span class="w"> </span><span class="p">(</span><span class="s">&quot;buys&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">c</span><span class="p">.</span><span class="n">Purchases</span><span class="p">.</span><span class="n">Count</span><span class="p">)</span>
</span><span id="__span-64-26"><a id="__codelineno-64-26" name="__codelineno-64-26" href="#__codelineno-64-26"></a><span class="w"> </span><span class="p">)</span>
</span><span id="__span-64-27"><a id="__codelineno-64-27" name="__codelineno-64-27" href="#__codelineno-64-27"></a><span class="w"> </span><span class="p">);</span>
</span></code></pre></div>
<p>Hereâ€™s the result:</p>
<div class="language-csharp highlight"><pre><span></span><code><span id="__span-65-1"><a id="__codelineno-65-1" name="__codelineno-65-1" href="#__codelineno-65-1"></a><span class="o">&lt;</span><span class="n">customers</span><span class="o">&gt;</span>
</span><span id="__span-65-2"><a id="__codelineno-65-2" name="__codelineno-65-2" href="#__codelineno-65-2"></a><span class="w"> </span><span class="o">&lt;</span><span class="n">customer</span><span class="w"> </span><span class="n">id</span><span class="o">=</span><span class="s">&quot;1&quot;</span><span class="o">&gt;</span>
</span><span id="__span-65-3"><a id="__codelineno-65-3" name="__codelineno-65-3" href="#__codelineno-65-3"></a><span class="w"> </span><span class="o">&lt;</span><span class="n">name</span><span class="o">&gt;</span><span class="n">Tom</span><span class="o">&lt;/</span><span class="n">name</span><span class="o">&gt;</span>
</span><span id="__span-65-4"><a id="__codelineno-65-4" name="__codelineno-65-4" href="#__codelineno-65-4"></a><span class="w"> </span><span class="o">&lt;</span><span class="n">buys</span><span class="o">&gt;</span><span class="mi">3</span><span class="o">&lt;/</span><span class="n">buys</span><span class="o">&gt;</span>
</span><span id="__span-65-5"><a id="__codelineno-65-5" name="__codelineno-65-5" href="#__codelineno-65-5"></a><span class="w"> </span><span class="o">&lt;/</span><span class="n">customer</span><span class="o">&gt;</span>
</span><span id="__span-65-6"><a id="__codelineno-65-6" name="__codelineno-65-6" href="#__codelineno-65-6"></a><span class="w"> </span><span class="o">&lt;</span><span class="n">customer</span><span class="w"> </span><span class="n">id</span><span class="o">=</span><span class="s">&quot;2&quot;</span><span class="o">&gt;</span>
</span><span id="__span-65-7"><a id="__codelineno-65-7" name="__codelineno-65-7" href="#__codelineno-65-7"></a><span class="w"> </span><span class="o">&lt;</span><span class="n">name</span><span class="o">&gt;</span><span class="n">Harry</span><span class="o">&lt;/</span><span class="n">name</span><span class="o">&gt;</span>
</span><span id="__span-65-8"><a id="__codelineno-65-8" name="__codelineno-65-8" href="#__codelineno-65-8"></a><span class="w"> </span><span class="o">&lt;</span><span class="n">buys</span><span class="o">&gt;</span><span class="mi">2</span><span class="o">&lt;/</span><span class="n">buys</span><span class="o">&gt;</span>
</span><span id="__span-65-9"><a id="__codelineno-65-9" name="__codelineno-65-9" href="#__codelineno-65-9"></a><span class="w"> </span><span class="o">&lt;/</span><span class="n">customer</span><span class="o">&gt;</span>
</span><span id="__span-65-10"><a id="__codelineno-65-10" name="__codelineno-65-10" href="#__codelineno-65-10"></a><span class="w"> </span><span class="p">...</span>
</span><span id="__span-65-11"><a id="__codelineno-65-11" name="__codelineno-65-11" href="#__codelineno-65-11"></a><span class="o">&lt;/</span><span class="n">customers</span><span class="o">&gt;</span>
</span><span id="__span-65-12"><a id="__codelineno-65-12" name="__codelineno-65-12" href="#__codelineno-65-12"></a><span class="err">```#</span><span class="w"> </span><span class="n">Chapter</span><span class="w"> </span><span class="mi">11</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="n">Other</span><span class="w"> </span><span class="n">XML</span><span class="w"> </span><span class="k">and</span><span class="w"> </span><span class="n">JSON</span><span class="w"> </span><span class="n">Technologies</span>
</span><span id="__span-65-13"><a id="__codelineno-65-13" name="__codelineno-65-13" href="#__codelineno-65-13"></a>
</span><span id="__span-65-14"><a id="__codelineno-65-14" name="__codelineno-65-14" href="#__codelineno-65-14"></a><span class="err">#</span><span class="w"> </span><span class="n">XmlReader</span>
</span><span id="__span-65-15"><a id="__codelineno-65-15" name="__codelineno-65-15" href="#__codelineno-65-15"></a>
</span><span id="__span-65-16"><a id="__codelineno-65-16" name="__codelineno-65-16" href="#__codelineno-65-16"></a><span class="n">XmlReader</span><span class="w"> </span><span class="k">is</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">high</span><span class="o">-</span><span class="n">performance</span><span class="w"> </span><span class="k">class</span><span class="w"> </span><span class="nc">for</span><span class="w"> </span><span class="n">reading</span><span class="w"> </span><span class="n">an</span><span class="w"> </span><span class="n">XML</span><span class="w"> </span><span class="n">stream</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">low</span><span class="o">-</span><span class="n">level</span><span class="p">,</span><span class="w"> </span><span class="n">forward</span><span class="o">-</span><span class="n">only</span><span class="w"> </span><span class="n">manner</span><span class="p">.</span>
</span><span id="__span-65-17"><a id="__codelineno-65-17" name="__codelineno-65-17" href="#__codelineno-65-17"></a>
</span><span id="__span-65-18"><a id="__codelineno-65-18" name="__codelineno-65-18" href="#__codelineno-65-18"></a><span class="err">###</span><span class="w"> </span><span class="n">Read</span><span class="w"> </span><span class="n">Nodes</span>
</span><span id="__span-65-19"><a id="__codelineno-65-19" name="__codelineno-65-19" href="#__codelineno-65-19"></a>
</span><span id="__span-65-20"><a id="__codelineno-65-20" name="__codelineno-65-20" href="#__codelineno-65-20"></a><span class="err">```</span><span class="n">csharp</span>
</span><span id="__span-65-21"><a id="__codelineno-65-21" name="__codelineno-65-21" href="#__codelineno-65-21"></a><span class="o">&lt;?</span><span class="n">xml</span><span class="w"> </span><span class="n">version</span><span class="o">=</span><span class="s">&quot;1.0&quot;</span><span class="w"> </span><span class="n">encoding</span><span class="o">=</span><span class="s">&quot;utf-8&quot;</span><span class="w"> </span><span class="n">standalone</span><span class="o">=</span><span class="s">&quot;yes&quot;</span><span class="o">?&gt;</span>
</span><span id="__span-65-22"><a id="__codelineno-65-22" name="__codelineno-65-22" href="#__codelineno-65-22"></a><span class="o">&lt;</span><span class="n">customer</span><span class="w"> </span><span class="n">id</span><span class="o">=</span><span class="s">&quot;123&quot;</span><span class="w"> </span><span class="n">status</span><span class="o">=</span><span class="s">&quot;archived&quot;</span><span class="o">&gt;</span>
</span><span id="__span-65-23"><a id="__codelineno-65-23" name="__codelineno-65-23" href="#__codelineno-65-23"></a><span class="w"> </span><span class="o">&lt;</span><span class="n">firstname</span><span class="o">&gt;</span><span class="n">Jim</span><span class="o">&lt;/</span><span class="n">firstname</span><span class="o">&gt;</span>
</span><span id="__span-65-24"><a id="__codelineno-65-24" name="__codelineno-65-24" href="#__codelineno-65-24"></a><span class="w"> </span><span class="o">&lt;</span><span class="n">lastname</span><span class="o">&gt;</span><span class="n">Bo</span><span class="o">&lt;/</span><span class="n">lastname</span><span class="o">&gt;</span>
</span><span id="__span-65-25"><a id="__codelineno-65-25" name="__codelineno-65-25" href="#__codelineno-65-25"></a><span class="o">&lt;/</span><span class="n">customer</span><span class="o">&gt;</span>
</span></code></pre></div>
<div class="language-csharp highlight"><pre><span></span><code><span id="__span-66-1"><a id="__codelineno-66-1" name="__codelineno-66-1" href="#__codelineno-66-1"></a><span class="n">XmlReaderSettings</span><span class="w"> </span><span class="n">settings</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">XmlReaderSettings</span><span class="p">();</span>
</span><span id="__span-66-2"><a id="__codelineno-66-2" name="__codelineno-66-2" href="#__codelineno-66-2"></a><span class="n">settings</span><span class="p">.</span><span class="n">IgnoreWhitespace</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">true</span><span class="p">;</span>
</span><span id="__span-66-3"><a id="__codelineno-66-3" name="__codelineno-66-3" href="#__codelineno-66-3"></a><span class="k">using</span><span class="w"> </span><span class="nn">XmlReader</span><span class="w"> </span><span class="n">reader</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">XmlReader</span><span class="p">.</span><span class="n">Create</span><span class="w"> </span><span class="p">(</span><span class="s">&quot;customer.xml&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">settings</span><span class="p">);</span>
</span><span id="__span-66-4"><a id="__codelineno-66-4" name="__codelineno-66-4" href="#__codelineno-66-4"></a><span class="k">while</span><span class="w"> </span><span class="p">(</span><span class="n">reader</span><span class="p">.</span><span class="n">Read</span><span class="p">())</span>
</span><span id="__span-66-5"><a id="__codelineno-66-5" name="__codelineno-66-5" href="#__codelineno-66-5"></a><span class="p">{</span>
</span><span id="__span-66-6"><a id="__codelineno-66-6" name="__codelineno-66-6" href="#__codelineno-66-6"></a><span class="w"> </span><span class="n">Console</span><span class="p">.</span><span class="n">Write</span><span class="w"> </span><span class="p">(</span><span class="k">new</span><span class="w"> </span><span class="kt">string</span><span class="w"> </span><span class="p">(</span><span class="sc">&#39; &#39;</span><span class="p">,</span><span class="w"> </span><span class="n">reader</span><span class="p">.</span><span class="n">Depth</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mi">2</span><span class="p">));</span><span class="w"> </span><span class="c1">// Write indentation</span>
</span><span id="__span-66-7"><a id="__codelineno-66-7" name="__codelineno-66-7" href="#__codelineno-66-7"></a><span class="w"> </span><span class="n">Console</span><span class="p">.</span><span class="n">Write</span><span class="w"> </span><span class="p">(</span><span class="n">reader</span><span class="p">.</span><span class="n">NodeType</span><span class="p">.</span><span class="n">ToString</span><span class="p">());</span>
</span><span id="__span-66-8"><a id="__codelineno-66-8" name="__codelineno-66-8" href="#__codelineno-66-8"></a><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">reader</span><span class="p">.</span><span class="n">NodeType</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">XmlNodeType</span><span class="p">.</span><span class="n">Element</span><span class="w"> </span><span class="o">||</span>
</span><span id="__span-66-9"><a id="__codelineno-66-9" name="__codelineno-66-9" href="#__codelineno-66-9"></a><span class="w"> </span><span class="n">reader</span><span class="p">.</span><span class="n">NodeType</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">XmlNodeType</span><span class="p">.</span><span class="n">EndElement</span><span class="p">)</span>
</span><span id="__span-66-10"><a id="__codelineno-66-10" name="__codelineno-66-10" href="#__codelineno-66-10"></a><span class="w"> </span><span class="p">{</span>
</span><span id="__span-66-11"><a id="__codelineno-66-11" name="__codelineno-66-11" href="#__codelineno-66-11"></a><span class="w"> </span><span class="n">Console</span><span class="p">.</span><span class="n">Write</span><span class="w"> </span><span class="p">(</span><span class="s">&quot; Name=&quot;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">reader</span><span class="p">.</span><span class="n">Name</span><span class="p">);</span>
</span><span id="__span-66-12"><a id="__codelineno-66-12" name="__codelineno-66-12" href="#__codelineno-66-12"></a><span class="w"> </span><span class="p">}</span>
</span><span id="__span-66-13"><a id="__codelineno-66-13" name="__codelineno-66-13" href="#__codelineno-66-13"></a><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="nf">if</span><span class="w"> </span><span class="p">(</span><span class="n">reader</span><span class="p">.</span><span class="n">NodeType</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">XmlNodeType</span><span class="p">.</span><span class="n">Text</span><span class="p">)</span>
</span><span id="__span-66-14"><a id="__codelineno-66-14" name="__codelineno-66-14" href="#__codelineno-66-14"></a><span class="w"> </span><span class="p">{</span>
</span><span id="__span-66-15"><a id="__codelineno-66-15" name="__codelineno-66-15" href="#__codelineno-66-15"></a><span class="w"> </span><span class="n">Console</span><span class="p">.</span><span class="n">Write</span><span class="w"> </span><span class="p">(</span><span class="s">&quot; Value=&quot;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">reader</span><span class="p">.</span><span class="n">Value</span><span class="p">);</span>
</span><span id="__span-66-16"><a id="__codelineno-66-16" name="__codelineno-66-16" href="#__codelineno-66-16"></a><span class="w"> </span><span class="p">}</span>
</span><span id="__span-66-17"><a id="__codelineno-66-17" name="__codelineno-66-17" href="#__codelineno-66-17"></a><span class="w"> </span><span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="w"> </span><span class="p">();</span>
</span><span id="__span-66-18"><a id="__codelineno-66-18" name="__codelineno-66-18" href="#__codelineno-66-18"></a><span class="p">}</span>
</span></code></pre></div>
<p>The output is as follows:</p>
<div class="language-csharp highlight"><pre><span></span><code><span id="__span-67-1"><a id="__codelineno-67-1" name="__codelineno-67-1" href="#__codelineno-67-1"></a><span class="n">XmlDeclaration</span>
</span><span id="__span-67-2"><a id="__codelineno-67-2" name="__codelineno-67-2" href="#__codelineno-67-2"></a><span class="n">Element</span><span class="w"> </span><span class="n">Name</span><span class="o">=</span><span class="n">customer</span>
</span><span id="__span-67-3"><a id="__codelineno-67-3" name="__codelineno-67-3" href="#__codelineno-67-3"></a><span class="w"> </span><span class="n">Element</span><span class="w"> </span><span class="n">Name</span><span class="o">=</span><span class="n">firstname</span>
</span><span id="__span-67-4"><a id="__codelineno-67-4" name="__codelineno-67-4" href="#__codelineno-67-4"></a><span class="w"> </span><span class="n">Text</span><span class="w"> </span><span class="n">Value</span><span class="o">=</span><span class="n">Jim</span>
</span><span id="__span-67-5"><a id="__codelineno-67-5" name="__codelineno-67-5" href="#__codelineno-67-5"></a><span class="w"> </span><span class="n">EndElement</span><span class="w"> </span><span class="n">Name</span><span class="o">=</span><span class="n">firstname</span>
</span><span id="__span-67-6"><a id="__codelineno-67-6" name="__codelineno-67-6" href="#__codelineno-67-6"></a><span class="w"> </span><span class="n">Element</span><span class="w"> </span><span class="n">Name</span><span class="o">=</span><span class="n">lastname</span>
</span><span id="__span-67-7"><a id="__codelineno-67-7" name="__codelineno-67-7" href="#__codelineno-67-7"></a><span class="w"> </span><span class="n">Text</span><span class="w"> </span><span class="n">Value</span><span class="o">=</span><span class="n">Bo</span>
</span><span id="__span-67-8"><a id="__codelineno-67-8" name="__codelineno-67-8" href="#__codelineno-67-8"></a><span class="w"> </span><span class="n">EndElement</span><span class="w"> </span><span class="n">Name</span><span class="o">=</span><span class="n">lastname</span>
</span><span id="__span-67-9"><a id="__codelineno-67-9" name="__codelineno-67-9" href="#__codelineno-67-9"></a><span class="n">EndElement</span><span class="w"> </span><span class="n">Name</span><span class="o">=</span><span class="n">customer</span>
</span></code></pre></div>
<h3 id="read-elements">Read Elements</h3>
<div class="language-csharp highlight"><pre><span></span><code><span id="__span-68-1"><a id="__codelineno-68-1" name="__codelineno-68-1" href="#__codelineno-68-1"></a><span class="err">#</span><span class="n">load</span><span class="w"> </span><span class="s">&quot;.\Create sample files.linq&quot;</span>
</span><span id="__span-68-2"><a id="__codelineno-68-2" name="__codelineno-68-2" href="#__codelineno-68-2"></a>
</span><span id="__span-68-3"><a id="__codelineno-68-3" name="__codelineno-68-3" href="#__codelineno-68-3"></a><span class="n">XmlReaderSettings</span><span class="w"> </span><span class="n">settings</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">XmlReaderSettings</span><span class="p">();</span>
</span><span id="__span-68-4"><a id="__codelineno-68-4" name="__codelineno-68-4" href="#__codelineno-68-4"></a><span class="n">settings</span><span class="p">.</span><span class="n">IgnoreWhitespace</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">true</span><span class="p">;</span>
</span><span id="__span-68-5"><a id="__codelineno-68-5" name="__codelineno-68-5" href="#__codelineno-68-5"></a>
</span><span id="__span-68-6"><a id="__codelineno-68-6" name="__codelineno-68-6" href="#__codelineno-68-6"></a><span class="k">using</span><span class="w"> </span><span class="nn">XmlReader</span><span class="w"> </span><span class="n">r</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">XmlReader</span><span class="p">.</span><span class="n">Create</span><span class="w"> </span><span class="p">(</span><span class="s">&quot;customerCredit.xml&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">settings</span><span class="p">);</span>
</span><span id="__span-68-7"><a id="__codelineno-68-7" name="__codelineno-68-7" href="#__codelineno-68-7"></a>
</span><span id="__span-68-8"><a id="__codelineno-68-8" name="__codelineno-68-8" href="#__codelineno-68-8"></a><span class="n">r</span><span class="p">.</span><span class="n">MoveToContent</span><span class="p">();</span><span class="w">                </span><span class="c1">// Skip over the XML declaration</span>
</span><span id="__span-68-9"><a id="__codelineno-68-9" name="__codelineno-68-9" href="#__codelineno-68-9"></a><span class="n">r</span><span class="p">.</span><span class="n">ReadStartElement</span><span class="w"> </span><span class="p">(</span><span class="s">&quot;customer&quot;</span><span class="p">);</span>
</span><span id="__span-68-10"><a id="__codelineno-68-10" name="__codelineno-68-10" href="#__codelineno-68-10"></a><span class="kt">string</span><span class="w"> </span><span class="n">firstName</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">r</span><span class="p">.</span><span class="n">ReadElementContentAsString</span><span class="w"> </span><span class="p">(</span><span class="s">&quot;firstname&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;&quot;</span><span class="p">);</span>
</span><span id="__span-68-11"><a id="__codelineno-68-11" name="__codelineno-68-11" href="#__codelineno-68-11"></a><span class="kt">string</span><span class="w"> </span><span class="n">lastName</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">r</span><span class="p">.</span><span class="n">ReadElementContentAsString</span><span class="w"> </span><span class="p">(</span><span class="s">&quot;lastname&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;&quot;</span><span class="p">);</span>
</span><span id="__span-68-12"><a id="__codelineno-68-12" name="__codelineno-68-12" href="#__codelineno-68-12"></a><span class="kt">decimal</span><span class="w"> </span><span class="n">creditLimit</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">r</span><span class="p">.</span><span class="n">ReadElementContentAsDecimal</span><span class="w"> </span><span class="p">(</span><span class="s">&quot;creditlimit&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;&quot;</span><span class="p">);</span>
</span><span id="__span-68-13"><a id="__codelineno-68-13" name="__codelineno-68-13" href="#__codelineno-68-13"></a>
</span><span id="__span-68-14"><a id="__codelineno-68-14" name="__codelineno-68-14" href="#__codelineno-68-14"></a><span class="n">r</span><span class="p">.</span><span class="n">MoveToContent</span><span class="p">();</span><span class="w">      </span><span class="c1">// Skip over that pesky comment</span>
</span><span id="__span-68-15"><a id="__codelineno-68-15" name="__codelineno-68-15" href="#__codelineno-68-15"></a><span class="n">r</span><span class="p">.</span><span class="n">ReadEndElement</span><span class="p">();</span><span class="w">     </span><span class="c1">// Read the closing customer tag</span>
</span><span id="__span-68-16"><a id="__codelineno-68-16" name="__codelineno-68-16" href="#__codelineno-68-16"></a>
</span><span id="__span-68-17"><a id="__codelineno-68-17" name="__codelineno-68-17" href="#__codelineno-68-17"></a><span class="s">$&quot;{firstName} {lastName} credit limit: {creditLimit}&quot;</span><span class="p">.</span><span class="n">Dump</span><span class="p">();</span>
</span></code></pre></div>
<h3 id="reading-attributes">Reading Attributes</h3>
<div class="language-csharp highlight"><pre><span></span><code><span id="__span-69-1"><a id="__codelineno-69-1" name="__codelineno-69-1" href="#__codelineno-69-1"></a><span class="c1">//Given the XML fragment:</span>
</span><span id="__span-69-2"><a id="__codelineno-69-2" name="__codelineno-69-2" href="#__codelineno-69-2"></a><span class="o">&lt;</span><span class="n">customer</span><span class="w"> </span><span class="n">id</span><span class="o">=</span><span class="s">&quot;123&quot;</span><span class="w"> </span><span class="n">status</span><span class="o">=</span><span class="s">&quot;archived&quot;</span><span class="o">/&gt;</span>
</span><span id="__span-69-3"><a id="__codelineno-69-3" name="__codelineno-69-3" href="#__codelineno-69-3"></a><span class="c1">//we could read its attributes as follows:</span>
</span><span id="__span-69-4"><a id="__codelineno-69-4" name="__codelineno-69-4" href="#__codelineno-69-4"></a><span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="w"> </span><span class="p">(</span><span class="n">reader</span><span class="w"> </span><span class="p">[</span><span class="s">&quot;id&quot;</span><span class="p">]);</span><span class="w"> </span><span class="c1">// 123</span>
</span><span id="__span-69-5"><a id="__codelineno-69-5" name="__codelineno-69-5" href="#__codelineno-69-5"></a><span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="w"> </span><span class="p">(</span><span class="n">reader</span><span class="w"> </span><span class="p">[</span><span class="s">&quot;status&quot;</span><span class="p">]);</span><span class="w"> </span><span class="c1">// archived</span>
</span><span id="__span-69-6"><a id="__codelineno-69-6" name="__codelineno-69-6" href="#__codelineno-69-6"></a><span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="w"> </span><span class="p">(</span><span class="n">reader</span><span class="w"> </span><span class="p">[</span><span class="s">&quot;bogus&quot;</span><span class="p">]</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="k">null</span><span class="p">);</span><span class="w"> </span><span class="c1">// True</span>
</span></code></pre></div>
<h3 id="attribute-nodes">Attribute nodes</h3>
<div class="language-csharp highlight"><pre><span></span><code><span id="__span-70-1"><a id="__codelineno-70-1" name="__codelineno-70-1" href="#__codelineno-70-1"></a><span class="n">Returning</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">our</span><span class="w"> </span><span class="n">previous</span><span class="w"> </span><span class="n">example</span><span class="p">:</span>
</span><span id="__span-70-2"><a id="__codelineno-70-2" name="__codelineno-70-2" href="#__codelineno-70-2"></a><span class="o">&lt;</span><span class="n">customer</span><span class="w"> </span><span class="n">id</span><span class="o">=</span><span class="s">&quot;123&quot;</span><span class="w"> </span><span class="n">status</span><span class="o">=</span><span class="s">&quot;archived&quot;</span><span class="o">/&gt;</span>
</span><span id="__span-70-3"><a id="__codelineno-70-3" name="__codelineno-70-3" href="#__codelineno-70-3"></a><span class="n">we</span><span class="w"> </span><span class="n">can</span><span class="w"> </span><span class="k">do</span><span class="w"> </span><span class="k">this</span><span class="p">:</span>
</span><span id="__span-70-4"><a id="__codelineno-70-4" name="__codelineno-70-4" href="#__codelineno-70-4"></a><span class="n">reader</span><span class="p">.</span><span class="n">MoveToAttribute</span><span class="w"> </span><span class="p">(</span><span class="s">&quot;status&quot;</span><span class="p">);</span>
</span><span id="__span-70-5"><a id="__codelineno-70-5" name="__codelineno-70-5" href="#__codelineno-70-5"></a><span class="kt">string</span><span class="w"> </span><span class="n">status</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">reader</span><span class="p">.</span><span class="n">ReadContentAsString</span><span class="p">();</span>
</span><span id="__span-70-6"><a id="__codelineno-70-6" name="__codelineno-70-6" href="#__codelineno-70-6"></a><span class="n">reader</span><span class="p">.</span><span class="n">MoveToAttribute</span><span class="w"> </span><span class="p">(</span><span class="s">&quot;id&quot;</span><span class="p">);</span>
</span><span id="__span-70-7"><a id="__codelineno-70-7" name="__codelineno-70-7" href="#__codelineno-70-7"></a><span class="kt">int</span><span class="w"> </span><span class="n">id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">reader</span><span class="p">.</span><span class="n">ReadContentAsInt</span><span class="p">();</span>
</span></code></pre></div>
<h1 id="xmlwriter">XmlWriter</h1>
<p>XmlWriter is a forward-only writer of an XML stream. The design of XmlWriter is symmetrical to XmlReader.</p>
<div class="language-csharp highlight"><pre><span></span><code><span id="__span-71-1"><a id="__codelineno-71-1" name="__codelineno-71-1" href="#__codelineno-71-1"></a><span class="n">XmlWriterSettings</span><span class="w"> </span><span class="n">settings</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">XmlWriterSettings</span><span class="p">();</span>
</span><span id="__span-71-2"><a id="__codelineno-71-2" name="__codelineno-71-2" href="#__codelineno-71-2"></a><span class="n">settings</span><span class="p">.</span><span class="n">Indent</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">true</span><span class="p">;</span>
</span><span id="__span-71-3"><a id="__codelineno-71-3" name="__codelineno-71-3" href="#__codelineno-71-3"></a><span class="k">using</span><span class="w"> </span><span class="nn">XmlWriter</span><span class="w"> </span><span class="n">writer</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">XmlWriter</span><span class="p">.</span><span class="n">Create</span><span class="w"> </span><span class="p">(</span><span class="s">&quot;foo.xml&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">settings</span><span class="p">);</span>
</span><span id="__span-71-4"><a id="__codelineno-71-4" name="__codelineno-71-4" href="#__codelineno-71-4"></a><span class="n">writer</span><span class="p">.</span><span class="n">WriteStartElement</span><span class="w"> </span><span class="p">(</span><span class="s">&quot;customer&quot;</span><span class="p">);</span>
</span><span id="__span-71-5"><a id="__codelineno-71-5" name="__codelineno-71-5" href="#__codelineno-71-5"></a><span class="n">writer</span><span class="p">.</span><span class="n">WriteElementString</span><span class="w"> </span><span class="p">(</span><span class="s">&quot;firstname&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Jim&quot;</span><span class="p">);</span>
</span><span id="__span-71-6"><a id="__codelineno-71-6" name="__codelineno-71-6" href="#__codelineno-71-6"></a><span class="n">writer</span><span class="p">.</span><span class="n">WriteElementString</span><span class="w"> </span><span class="p">(</span><span class="s">&quot;lastname&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Bo&quot;</span><span class="p">);</span>
</span><span id="__span-71-7"><a id="__codelineno-71-7" name="__codelineno-71-7" href="#__codelineno-71-7"></a><span class="n">writer</span><span class="p">.</span><span class="n">WriteEndElement</span><span class="p">();</span>
</span></code></pre></div>
<div class="language-csharp highlight"><pre><span></span><code><span id="__span-72-1"><a id="__codelineno-72-1" name="__codelineno-72-1" href="#__codelineno-72-1"></a><span class="o">&lt;?</span><span class="n">xml</span><span class="w"> </span><span class="n">version</span><span class="o">=</span><span class="s">&quot;1.0&quot;</span><span class="w"> </span><span class="n">encoding</span><span class="o">=</span><span class="s">&quot;utf-8&quot;</span><span class="o">?&gt;</span>
</span><span id="__span-72-2"><a id="__codelineno-72-2" name="__codelineno-72-2" href="#__codelineno-72-2"></a><span class="o">&lt;</span><span class="n">customer</span><span class="o">&gt;</span>
</span><span id="__span-72-3"><a id="__codelineno-72-3" name="__codelineno-72-3" href="#__codelineno-72-3"></a><span class="w"> </span><span class="o">&lt;</span><span class="n">firstname</span><span class="o">&gt;</span><span class="n">Jim</span><span class="o">&lt;/</span><span class="n">firstname</span><span class="o">&gt;</span>
</span><span id="__span-72-4"><a id="__codelineno-72-4" name="__codelineno-72-4" href="#__codelineno-72-4"></a><span class="w"> </span><span class="o">&lt;</span><span class="n">lastname</span><span class="o">&gt;</span><span class="n">Bo</span><span class="o">&lt;/</span><span class="n">lastname</span><span class="o">&gt;</span>
</span><span id="__span-72-5"><a id="__codelineno-72-5" name="__codelineno-72-5" href="#__codelineno-72-5"></a><span class="o">&lt;/</span><span class="n">customer</span><span class="o">&gt;</span>
</span></code></pre></div>
<p>Writing Attributes</p>
<div class="language-csharp highlight"><pre><span></span><code><span id="__span-73-1"><a id="__codelineno-73-1" name="__codelineno-73-1" href="#__codelineno-73-1"></a><span class="n">writer</span><span class="p">.</span><span class="n">WriteStartElement</span><span class="w"> </span><span class="p">(</span><span class="s">&quot;customer&quot;</span><span class="p">);</span>
</span><span id="__span-73-2"><a id="__codelineno-73-2" name="__codelineno-73-2" href="#__codelineno-73-2"></a><span class="n">writer</span><span class="p">.</span><span class="n">WriteAttributeString</span><span class="w"> </span><span class="p">(</span><span class="s">&quot;id&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;1&quot;</span><span class="p">);</span>
</span><span id="__span-73-3"><a id="__codelineno-73-3" name="__codelineno-73-3" href="#__codelineno-73-3"></a><span class="n">writer</span><span class="p">.</span><span class="n">WriteAttributeString</span><span class="w"> </span><span class="p">(</span><span class="s">&quot;status&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;archived&quot;</span><span class="p">);</span>
</span></code></pre></div>
<p>Namespaces and Prefixes</p>
<div class="language-csharp highlight"><pre><span></span><code><span id="__span-74-1"><a id="__codelineno-74-1" name="__codelineno-74-1" href="#__codelineno-74-1"></a><span class="n">writer</span><span class="p">.</span><span class="n">WriteStartElement</span><span class="w"> </span><span class="p">(</span><span class="s">&quot;o&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;customer&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;http://oreilly.com&quot;</span><span class="p">);</span>
</span><span id="__span-74-2"><a id="__codelineno-74-2" name="__codelineno-74-2" href="#__codelineno-74-2"></a><span class="n">writer</span><span class="p">.</span><span class="n">WriteElementString</span><span class="w"> </span><span class="p">(</span><span class="s">&quot;o&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;firstname&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;http://oreilly.com&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Jim&quot;</span><span class="p">);</span>
</span><span id="__span-74-3"><a id="__codelineno-74-3" name="__codelineno-74-3" href="#__codelineno-74-3"></a><span class="n">writer</span><span class="p">.</span><span class="n">WriteElementString</span><span class="w"> </span><span class="p">(</span><span class="s">&quot;o&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;lastname&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;http://oreilly.com&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Bo&quot;</span><span class="p">);</span>
</span><span id="__span-74-4"><a id="__codelineno-74-4" name="__codelineno-74-4" href="#__codelineno-74-4"></a><span class="n">writer</span><span class="p">.</span><span class="n">WriteEndElement</span><span class="p">();</span>
</span><span id="__span-74-5"><a id="__codelineno-74-5" name="__codelineno-74-5" href="#__codelineno-74-5"></a><span class="c1">//The output is now as follows:</span>
</span><span id="__span-74-6"><a id="__codelineno-74-6" name="__codelineno-74-6" href="#__codelineno-74-6"></a><span class="o">&lt;?</span><span class="n">xml</span><span class="w"> </span><span class="n">version</span><span class="o">=</span><span class="s">&quot;1.0&quot;</span><span class="w"> </span><span class="n">encoding</span><span class="o">=</span><span class="s">&quot;utf-8&quot;</span><span class="o">?&gt;</span>
</span><span id="__span-74-7"><a id="__codelineno-74-7" name="__codelineno-74-7" href="#__codelineno-74-7"></a><span class="o">&lt;</span><span class="n">o</span><span class="p">:</span><span class="n">customer</span><span class="w"> </span><span class="n">xmlns</span><span class="p">:</span><span class="n">o</span><span class="o">=</span><span class="err">&#39;</span><span class="n">http</span><span class="p">:</span><span class="c1">//oreilly.com&#39;&gt;</span>
</span><span id="__span-74-8"><a id="__codelineno-74-8" name="__codelineno-74-8" href="#__codelineno-74-8"></a><span class="w"> </span><span class="o">&lt;</span><span class="n">o</span><span class="p">:</span><span class="n">firstname</span><span class="o">&gt;</span><span class="n">Jim</span><span class="o">&lt;/</span><span class="n">o</span><span class="p">:</span><span class="n">firstname</span><span class="o">&gt;</span>
</span><span id="__span-74-9"><a id="__codelineno-74-9" name="__codelineno-74-9" href="#__codelineno-74-9"></a><span class="w"> </span><span class="o">&lt;</span><span class="n">o</span><span class="p">:</span><span class="n">lastname</span><span class="o">&gt;</span><span class="n">Bo</span><span class="o">&lt;/</span><span class="n">o</span><span class="p">:</span><span class="n">lastname</span><span class="o">&gt;</span>
</span><span id="__span-74-10"><a id="__codelineno-74-10" name="__codelineno-74-10" href="#__codelineno-74-10"></a><span class="o">&lt;/</span><span class="n">o</span><span class="p">:</span><span class="n">customer</span><span class="o">&gt;</span>
</span></code></pre></div>
<h1 id="patterns-for-using-xmlreaderxmlwriter">Patterns for Using XmlReader/XmlWriter</h1>
<h3 id="working-with-hierarchical-data">Working with Hierarchical Data</h3>
<p>Consider the following classes:</p>
<div class="language-csharp highlight"><pre><span></span><code><span id="__span-75-1"><a id="__codelineno-75-1" name="__codelineno-75-1" href="#__codelineno-75-1"></a><span class="k">public</span><span class="w"> </span><span class="k">class</span><span class="w"> </span><span class="nc">Contacts</span>
</span><span id="__span-75-2"><a id="__codelineno-75-2" name="__codelineno-75-2" href="#__codelineno-75-2"></a><span class="p">{</span>
</span><span id="__span-75-3"><a id="__codelineno-75-3" name="__codelineno-75-3" href="#__codelineno-75-3"></a><span class="w"> </span><span class="k">public</span><span class="w"> </span><span class="n">IList</span><span class="o">&lt;</span><span class="n">Customer</span><span class="o">&gt;</span><span class="w"> </span><span class="n">Customers</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">List</span><span class="o">&lt;</span><span class="n">Customer</span><span class="o">&gt;</span><span class="p">();</span>
</span><span id="__span-75-4"><a id="__codelineno-75-4" name="__codelineno-75-4" href="#__codelineno-75-4"></a><span class="w"> </span><span class="k">public</span><span class="w"> </span><span class="n">IList</span><span class="o">&lt;</span><span class="n">Supplier</span><span class="o">&gt;</span><span class="w"> </span><span class="n">Suppliers</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">List</span><span class="o">&lt;</span><span class="n">Supplier</span><span class="o">&gt;</span><span class="p">();</span>
</span><span id="__span-75-5"><a id="__codelineno-75-5" name="__codelineno-75-5" href="#__codelineno-75-5"></a><span class="p">}</span>
</span><span id="__span-75-6"><a id="__codelineno-75-6" name="__codelineno-75-6" href="#__codelineno-75-6"></a><span class="k">public</span><span class="w"> </span><span class="k">class</span><span class="w"> </span><span class="nc">Customer</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">public</span><span class="w"> </span><span class="kt">string</span><span class="w"> </span><span class="n">FirstName</span><span class="p">,</span><span class="w"> </span><span class="n">LastName</span><span class="p">;</span><span class="w"> </span><span class="p">}</span>
</span><span id="__span-75-7"><a id="__codelineno-75-7" name="__codelineno-75-7" href="#__codelineno-75-7"></a><span class="k">public</span><span class="w"> </span><span class="k">class</span><span class="w"> </span><span class="nc">Supplier</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">public</span><span class="w"> </span><span class="kt">string</span><span class="w"> </span><span class="n">Name</span><span class="p">;</span><span class="w"> </span><span class="p">}</span>
</span></code></pre></div>
<p>Suppose that you want to use XmlReader and XmlWriter to serialize a Contacts object to XML, as in the following:</p>
<div class="language-csharp highlight"><pre><span></span><code><span id="__span-76-1"><a id="__codelineno-76-1" name="__codelineno-76-1" href="#__codelineno-76-1"></a><span class="o">&lt;?</span><span class="n">xml</span><span class="w"> </span><span class="n">version</span><span class="o">=</span><span class="s">&quot;1.0&quot;</span><span class="w"> </span><span class="n">encoding</span><span class="o">=</span><span class="s">&quot;utf-8&quot;</span><span class="o">?&gt;</span>
</span><span id="__span-76-2"><a id="__codelineno-76-2" name="__codelineno-76-2" href="#__codelineno-76-2"></a><span class="o">&lt;</span><span class="n">contacts</span><span class="o">&gt;</span>
</span><span id="__span-76-3"><a id="__codelineno-76-3" name="__codelineno-76-3" href="#__codelineno-76-3"></a><span class="w"> </span><span class="o">&lt;</span><span class="n">customer</span><span class="w"> </span><span class="n">id</span><span class="o">=</span><span class="s">&quot;1&quot;</span><span class="o">&gt;</span>
</span><span id="__span-76-4"><a id="__codelineno-76-4" name="__codelineno-76-4" href="#__codelineno-76-4"></a><span class="w"> </span><span class="o">&lt;</span><span class="n">firstname</span><span class="o">&gt;</span><span class="n">Jay</span><span class="o">&lt;/</span><span class="n">firstname</span><span class="o">&gt;</span>
</span><span id="__span-76-5"><a id="__codelineno-76-5" name="__codelineno-76-5" href="#__codelineno-76-5"></a><span class="w"> </span><span class="o">&lt;</span><span class="n">lastname</span><span class="o">&gt;</span><span class="n">Dee</span><span class="o">&lt;/</span><span class="n">lastname</span><span class="o">&gt;</span>
</span><span id="__span-76-6"><a id="__codelineno-76-6" name="__codelineno-76-6" href="#__codelineno-76-6"></a><span class="w"> </span><span class="o">&lt;/</span><span class="n">customer</span><span class="o">&gt;</span>
</span><span id="__span-76-7"><a id="__codelineno-76-7" name="__codelineno-76-7" href="#__codelineno-76-7"></a><span class="w"> </span><span class="o">&lt;</span><span class="n">customer</span><span class="o">&gt;</span><span class="w"> </span><span class="o">&lt;!--</span><span class="w"> </span><span class="n">we</span><span class="err">&#39;</span><span class="n">ll</span><span class="w"> </span><span class="n">assume</span><span class="w"> </span><span class="n">id</span><span class="w"> </span><span class="k">is</span><span class="w"> </span><span class="n">optional</span><span class="w"> </span><span class="o">--&gt;</span>
</span><span id="__span-76-8"><a id="__codelineno-76-8" name="__codelineno-76-8" href="#__codelineno-76-8"></a><span class="w"> </span><span class="o">&lt;</span><span class="n">firstname</span><span class="o">&gt;</span><span class="n">Kay</span><span class="o">&lt;/</span><span class="n">firstname</span><span class="o">&gt;</span>
</span><span id="__span-76-9"><a id="__codelineno-76-9" name="__codelineno-76-9" href="#__codelineno-76-9"></a><span class="w"> </span><span class="o">&lt;</span><span class="n">lastname</span><span class="o">&gt;</span><span class="n">Gee</span><span class="o">&lt;/</span><span class="n">lastname</span><span class="o">&gt;</span>
</span><span id="__span-76-10"><a id="__codelineno-76-10" name="__codelineno-76-10" href="#__codelineno-76-10"></a><span class="w"> </span><span class="o">&lt;/</span><span class="n">customer</span><span class="o">&gt;</span>
</span><span id="__span-76-11"><a id="__codelineno-76-11" name="__codelineno-76-11" href="#__codelineno-76-11"></a><span class="w"> </span><span class="o">&lt;</span><span class="n">supplier</span><span class="o">&gt;</span>
</span><span id="__span-76-12"><a id="__codelineno-76-12" name="__codelineno-76-12" href="#__codelineno-76-12"></a><span class="w"> </span><span class="o">&lt;</span><span class="n">name</span><span class="o">&gt;</span><span class="n">X</span><span class="w"> </span><span class="n">Technologies</span><span class="w"> </span><span class="n">Ltd</span><span class="o">&lt;/</span><span class="n">name</span><span class="o">&gt;</span>
</span><span id="__span-76-13"><a id="__codelineno-76-13" name="__codelineno-76-13" href="#__codelineno-76-13"></a><span class="w"> </span><span class="o">&lt;/</span><span class="n">supplier</span><span class="o">&gt;</span>
</span><span id="__span-76-14"><a id="__codelineno-76-14" name="__codelineno-76-14" href="#__codelineno-76-14"></a><span class="o">&lt;/</span><span class="n">contacts</span><span class="o">&gt;</span>
</span></code></pre></div>
<p>The best approach is not to write one big method, but to encapsulate XML funcâ€
tionality in the Customer and Supplier types themselves by writing ReadXml and
WriteXml methods on these types.</p>
<p>The pattern in doing so is straightforward:</p>
<ul>
<li>ReadXml and WriteXml leave the reader/writer at the same depth when they exit</li>
<li>ReadXml reads the outer element, whereas WriteXml writes only its inner content.</li>
</ul>
<p>Hereâ€™s how we would write the Customer type</p>
<div class="language-csharp highlight"><pre><span></span><code><span id="__span-77-1"><a id="__codelineno-77-1" name="__codelineno-77-1" href="#__codelineno-77-1"></a><span class="k">public</span><span class="w"> </span><span class="k">class</span><span class="w"> </span><span class="nc">Customer</span>
</span><span id="__span-77-2"><a id="__codelineno-77-2" name="__codelineno-77-2" href="#__codelineno-77-2"></a><span class="p">{</span>
</span><span id="__span-77-3"><a id="__codelineno-77-3" name="__codelineno-77-3" href="#__codelineno-77-3"></a><span class="w"> </span><span class="k">public</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="kt">string</span><span class="w"> </span><span class="n">XmlName</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;customer&quot;</span><span class="p">;</span>
</span><span id="__span-77-4"><a id="__codelineno-77-4" name="__codelineno-77-4" href="#__codelineno-77-4"></a><span class="w"> </span><span class="k">public</span><span class="w"> </span><span class="kt">int?</span><span class="w"> </span><span class="n">ID</span><span class="p">;</span>
</span><span id="__span-77-5"><a id="__codelineno-77-5" name="__codelineno-77-5" href="#__codelineno-77-5"></a><span class="w"> </span><span class="k">public</span><span class="w"> </span><span class="kt">string</span><span class="w"> </span><span class="n">FirstName</span><span class="p">,</span><span class="w"> </span><span class="n">LastName</span><span class="p">;</span>
</span><span id="__span-77-6"><a id="__codelineno-77-6" name="__codelineno-77-6" href="#__codelineno-77-6"></a><span class="w"> </span><span class="k">public</span><span class="w"> </span><span class="nf">Customer</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="p">}</span>
</span><span id="__span-77-7"><a id="__codelineno-77-7" name="__codelineno-77-7" href="#__codelineno-77-7"></a><span class="w"> </span><span class="k">public</span><span class="w"> </span><span class="nf">Customer</span><span class="w"> </span><span class="p">(</span><span class="n">XmlReader</span><span class="w"> </span><span class="n">r</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">ReadXml</span><span class="w"> </span><span class="p">(</span><span class="n">r</span><span class="p">);</span><span class="w"> </span><span class="p">}</span>
</span><span id="__span-77-8"><a id="__codelineno-77-8" name="__codelineno-77-8" href="#__codelineno-77-8"></a><span class="w"> </span><span class="k">public</span><span class="w"> </span><span class="k">void</span><span class="w"> </span><span class="nf">ReadXml</span><span class="w"> </span><span class="p">(</span><span class="n">XmlReader</span><span class="w"> </span><span class="n">r</span><span class="p">)</span>
</span><span id="__span-77-9"><a id="__codelineno-77-9" name="__codelineno-77-9" href="#__codelineno-77-9"></a><span class="w"> </span><span class="p">{</span>
</span><span id="__span-77-10"><a id="__codelineno-77-10" name="__codelineno-77-10" href="#__codelineno-77-10"></a><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">r</span><span class="p">.</span><span class="n">MoveToAttribute</span><span class="w"> </span><span class="p">(</span><span class="s">&quot;id&quot;</span><span class="p">))</span><span class="w"> </span><span class="n">ID</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">r</span><span class="p">.</span><span class="n">ReadContentAsInt</span><span class="p">();</span>
</span><span id="__span-77-11"><a id="__codelineno-77-11" name="__codelineno-77-11" href="#__codelineno-77-11"></a><span class="w"> </span><span class="n">r</span><span class="p">.</span><span class="n">ReadStartElement</span><span class="p">();</span>
</span><span id="__span-77-12"><a id="__codelineno-77-12" name="__codelineno-77-12" href="#__codelineno-77-12"></a><span class="w"> </span><span class="n">FirstName</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">r</span><span class="p">.</span><span class="n">ReadElementContentAsString</span><span class="w"> </span><span class="p">(</span><span class="s">&quot;firstname&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;&quot;</span><span class="p">);</span>
</span><span id="__span-77-13"><a id="__codelineno-77-13" name="__codelineno-77-13" href="#__codelineno-77-13"></a><span class="w"> </span><span class="n">LastName</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">r</span><span class="p">.</span><span class="n">ReadElementContentAsString</span><span class="w"> </span><span class="p">(</span><span class="s">&quot;lastname&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;&quot;</span><span class="p">);</span>
</span><span id="__span-77-14"><a id="__codelineno-77-14" name="__codelineno-77-14" href="#__codelineno-77-14"></a><span class="w"> </span><span class="n">r</span><span class="p">.</span><span class="n">ReadEndElement</span><span class="p">();</span>
</span><span id="__span-77-15"><a id="__codelineno-77-15" name="__codelineno-77-15" href="#__codelineno-77-15"></a><span class="w"> </span><span class="p">}</span>
</span><span id="__span-77-16"><a id="__codelineno-77-16" name="__codelineno-77-16" href="#__codelineno-77-16"></a><span class="w"> </span><span class="k">public</span><span class="w"> </span><span class="k">void</span><span class="w"> </span><span class="nf">WriteXml</span><span class="w"> </span><span class="p">(</span><span class="n">XmlWriter</span><span class="w"> </span><span class="n">w</span><span class="p">)</span>
</span><span id="__span-77-17"><a id="__codelineno-77-17" name="__codelineno-77-17" href="#__codelineno-77-17"></a><span class="w"> </span><span class="p">{</span>
</span><span id="__span-77-18"><a id="__codelineno-77-18" name="__codelineno-77-18" href="#__codelineno-77-18"></a><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">ID</span><span class="p">.</span><span class="n">HasValue</span><span class="p">)</span><span class="w"> </span><span class="n">w</span><span class="p">.</span><span class="n">WriteAttributeString</span><span class="w"> </span><span class="p">(</span><span class="s">&quot;id&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">ID</span><span class="p">.</span><span class="n">ToString</span><span class="p">());</span>
</span><span id="__span-77-19"><a id="__codelineno-77-19" name="__codelineno-77-19" href="#__codelineno-77-19"></a><span class="w"> </span><span class="n">w</span><span class="p">.</span><span class="n">WriteElementString</span><span class="w"> </span><span class="p">(</span><span class="s">&quot;firstname&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">FirstName</span><span class="p">);</span>
</span><span id="__span-77-20"><a id="__codelineno-77-20" name="__codelineno-77-20" href="#__codelineno-77-20"></a><span class="w"> </span><span class="n">w</span><span class="p">.</span><span class="n">WriteElementString</span><span class="w"> </span><span class="p">(</span><span class="s">&quot;lastname&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">LastName</span><span class="p">);</span>
</span><span id="__span-77-21"><a id="__codelineno-77-21" name="__codelineno-77-21" href="#__codelineno-77-21"></a><span class="w"> </span><span class="p">}</span>
</span><span id="__span-77-22"><a id="__codelineno-77-22" name="__codelineno-77-22" href="#__codelineno-77-22"></a><span class="p">}</span>
</span></code></pre></div>
<div class="language-csharp highlight"><pre><span></span><code><span id="__span-78-1"><a id="__codelineno-78-1" name="__codelineno-78-1" href="#__codelineno-78-1"></a><span class="n">The</span><span class="w"> </span><span class="n">Supplier</span><span class="w"> </span><span class="k">class</span><span class="w"> </span><span class="nc">is</span><span class="w"> </span><span class="n">analogous</span><span class="p">:</span>
</span><span id="__span-78-2"><a id="__codelineno-78-2" name="__codelineno-78-2" href="#__codelineno-78-2"></a><span class="k">public</span><span class="w"> </span><span class="k">class</span><span class="w"> </span><span class="nc">Supplier</span>
</span><span id="__span-78-3"><a id="__codelineno-78-3" name="__codelineno-78-3" href="#__codelineno-78-3"></a><span class="p">{</span>
</span><span id="__span-78-4"><a id="__codelineno-78-4" name="__codelineno-78-4" href="#__codelineno-78-4"></a><span class="w"> </span><span class="k">public</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="kt">string</span><span class="w"> </span><span class="n">XmlName</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;supplier&quot;</span><span class="p">;</span>
</span><span id="__span-78-5"><a id="__codelineno-78-5" name="__codelineno-78-5" href="#__codelineno-78-5"></a><span class="w"> </span><span class="k">public</span><span class="w"> </span><span class="kt">string</span><span class="w"> </span><span class="n">Name</span><span class="p">;</span>
</span><span id="__span-78-6"><a id="__codelineno-78-6" name="__codelineno-78-6" href="#__codelineno-78-6"></a><span class="k">public</span><span class="w"> </span><span class="nf">Supplier</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="p">}</span>
</span><span id="__span-78-7"><a id="__codelineno-78-7" name="__codelineno-78-7" href="#__codelineno-78-7"></a><span class="w"> </span><span class="k">public</span><span class="w"> </span><span class="nf">Supplier</span><span class="w"> </span><span class="p">(</span><span class="n">XmlReader</span><span class="w"> </span><span class="n">r</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">ReadXml</span><span class="w"> </span><span class="p">(</span><span class="n">r</span><span class="p">);</span><span class="w"> </span><span class="p">}</span>
</span><span id="__span-78-8"><a id="__codelineno-78-8" name="__codelineno-78-8" href="#__codelineno-78-8"></a><span class="w"> </span><span class="k">public</span><span class="w"> </span><span class="k">void</span><span class="w"> </span><span class="nf">ReadXml</span><span class="w"> </span><span class="p">(</span><span class="n">XmlReader</span><span class="w"> </span><span class="n">r</span><span class="p">)</span>
</span><span id="__span-78-9"><a id="__codelineno-78-9" name="__codelineno-78-9" href="#__codelineno-78-9"></a><span class="w"> </span><span class="p">{</span>
</span><span id="__span-78-10"><a id="__codelineno-78-10" name="__codelineno-78-10" href="#__codelineno-78-10"></a><span class="w"> </span><span class="n">r</span><span class="p">.</span><span class="n">ReadStartElement</span><span class="p">();</span>
</span><span id="__span-78-11"><a id="__codelineno-78-11" name="__codelineno-78-11" href="#__codelineno-78-11"></a><span class="w"> </span><span class="n">Name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">r</span><span class="p">.</span><span class="n">ReadElementContentAsString</span><span class="w"> </span><span class="p">(</span><span class="s">&quot;name&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;&quot;</span><span class="p">);</span>
</span><span id="__span-78-12"><a id="__codelineno-78-12" name="__codelineno-78-12" href="#__codelineno-78-12"></a><span class="w"> </span><span class="n">r</span><span class="p">.</span><span class="n">ReadEndElement</span><span class="p">();</span>
</span><span id="__span-78-13"><a id="__codelineno-78-13" name="__codelineno-78-13" href="#__codelineno-78-13"></a><span class="w"> </span><span class="p">}</span>
</span><span id="__span-78-14"><a id="__codelineno-78-14" name="__codelineno-78-14" href="#__codelineno-78-14"></a><span class="w"> </span><span class="k">public</span><span class="w"> </span><span class="k">void</span><span class="w"> </span><span class="nf">WriteXml</span><span class="w"> </span><span class="p">(</span><span class="n">XmlWriter</span><span class="w"> </span><span class="n">w</span><span class="p">)</span><span class="w"> </span><span class="o">=&gt;</span>
</span><span id="__span-78-15"><a id="__codelineno-78-15" name="__codelineno-78-15" href="#__codelineno-78-15"></a><span class="w"> </span><span class="n">w</span><span class="p">.</span><span class="n">WriteElementString</span><span class="w"> </span><span class="p">(</span><span class="s">&quot;name&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">Name</span><span class="p">);</span>
</span><span id="__span-78-16"><a id="__codelineno-78-16" name="__codelineno-78-16" href="#__codelineno-78-16"></a><span class="p">}</span>
</span></code></pre></div>
<p>the Contacts class, we must enumerate the customers element in ReadXml, checking whether each subelement is a customer or a supplier. We also need to code around the empty element trap:</p>
<div class="language-csharp highlight"><pre><span></span><code><span id="__span-79-1"><a id="__codelineno-79-1" name="__codelineno-79-1" href="#__codelineno-79-1"></a><span class="k">public</span><span class="w"> </span><span class="k">void</span><span class="w"> </span><span class="nf">ReadXml</span><span class="w"> </span><span class="p">(</span><span class="n">XmlReader</span><span class="w"> </span><span class="n">r</span><span class="p">)</span>
</span><span id="__span-79-2"><a id="__codelineno-79-2" name="__codelineno-79-2" href="#__codelineno-79-2"></a><span class="p">{</span>
</span><span id="__span-79-3"><a id="__codelineno-79-3" name="__codelineno-79-3" href="#__codelineno-79-3"></a><span class="w"> </span><span class="kt">bool</span><span class="w"> </span><span class="n">isEmpty</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">r</span><span class="p">.</span><span class="n">IsEmptyElement</span><span class="p">;</span><span class="w"> </span><span class="c1">// This ensures we don&#39;t get</span>
</span><span id="__span-79-4"><a id="__codelineno-79-4" name="__codelineno-79-4" href="#__codelineno-79-4"></a><span class="w"> </span><span class="n">r</span><span class="p">.</span><span class="n">ReadStartElement</span><span class="p">();</span><span class="w"> </span><span class="c1">// snookered by an empty</span>
</span><span id="__span-79-5"><a id="__codelineno-79-5" name="__codelineno-79-5" href="#__codelineno-79-5"></a><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">isEmpty</span><span class="p">)</span><span class="w"> </span><span class="k">return</span><span class="p">;</span><span class="w"> </span><span class="c1">// &lt;contacts/&gt; element!</span>
</span><span id="__span-79-6"><a id="__codelineno-79-6" name="__codelineno-79-6" href="#__codelineno-79-6"></a><span class="w"> </span><span class="k">while</span><span class="w"> </span><span class="p">(</span><span class="n">r</span><span class="p">.</span><span class="n">NodeType</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">XmlNodeType</span><span class="p">.</span><span class="n">Element</span><span class="p">)</span>
</span><span id="__span-79-7"><a id="__codelineno-79-7" name="__codelineno-79-7" href="#__codelineno-79-7"></a><span class="w"> </span><span class="p">{</span>
</span><span id="__span-79-8"><a id="__codelineno-79-8" name="__codelineno-79-8" href="#__codelineno-79-8"></a><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">r</span><span class="p">.</span><span class="n">Name</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">Customer</span><span class="p">.</span><span class="n">XmlName</span><span class="p">)</span><span class="w"> </span><span class="n">Customers</span><span class="p">.</span><span class="n">Add</span><span class="w"> </span><span class="p">(</span><span class="k">new</span><span class="w"> </span><span class="n">Customer</span><span class="w"> </span><span class="p">(</span><span class="n">r</span><span class="p">));</span>
</span><span id="__span-79-9"><a id="__codelineno-79-9" name="__codelineno-79-9" href="#__codelineno-79-9"></a><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="nf">if</span><span class="w"> </span><span class="p">(</span><span class="n">r</span><span class="p">.</span><span class="n">Name</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">Supplier</span><span class="p">.</span><span class="n">XmlName</span><span class="p">)</span><span class="w"> </span><span class="n">Suppliers</span><span class="p">.</span><span class="n">Add</span><span class="w"> </span><span class="p">(</span><span class="k">new</span><span class="w"> </span><span class="n">Supplier</span><span class="w"> </span><span class="p">(</span><span class="n">r</span><span class="p">));</span>
</span><span id="__span-79-10"><a id="__codelineno-79-10" name="__codelineno-79-10" href="#__codelineno-79-10"></a><span class="w"> </span><span class="k">else</span>
</span><span id="__span-79-11"><a id="__codelineno-79-11" name="__codelineno-79-11" href="#__codelineno-79-11"></a><span class="w"> </span><span class="k">throw</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="nf">XmlException</span><span class="w"> </span><span class="p">(</span><span class="s">&quot;Unexpected node: &quot;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">r</span><span class="p">.</span><span class="n">Name</span><span class="p">);</span>
</span><span id="__span-79-12"><a id="__codelineno-79-12" name="__codelineno-79-12" href="#__codelineno-79-12"></a><span class="w"> </span><span class="p">}</span>
</span><span id="__span-79-13"><a id="__codelineno-79-13" name="__codelineno-79-13" href="#__codelineno-79-13"></a><span class="w"> </span><span class="n">r</span><span class="p">.</span><span class="n">ReadEndElement</span><span class="p">();</span>
</span><span id="__span-79-14"><a id="__codelineno-79-14" name="__codelineno-79-14" href="#__codelineno-79-14"></a><span class="p">}</span>
</span><span id="__span-79-15"><a id="__codelineno-79-15" name="__codelineno-79-15" href="#__codelineno-79-15"></a><span class="k">public</span><span class="w"> </span><span class="k">void</span><span class="w"> </span><span class="nf">WriteXml</span><span class="w"> </span><span class="p">(</span><span class="n">XmlWriter</span><span class="w"> </span><span class="n">w</span><span class="p">)</span>
</span><span id="__span-79-16"><a id="__codelineno-79-16" name="__codelineno-79-16" href="#__codelineno-79-16"></a><span class="p">{</span>
</span><span id="__span-79-17"><a id="__codelineno-79-17" name="__codelineno-79-17" href="#__codelineno-79-17"></a><span class="w"> </span><span class="k">foreach</span><span class="w"> </span><span class="p">(</span><span class="n">Customer</span><span class="w"> </span><span class="n">c</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">Customers</span><span class="p">)</span>
</span><span id="__span-79-18"><a id="__codelineno-79-18" name="__codelineno-79-18" href="#__codelineno-79-18"></a><span class="w"> </span><span class="p">{</span>
</span><span id="__span-79-19"><a id="__codelineno-79-19" name="__codelineno-79-19" href="#__codelineno-79-19"></a><span class="w"> </span><span class="n">w</span><span class="p">.</span><span class="n">WriteStartElement</span><span class="w"> </span><span class="p">(</span><span class="n">Customer</span><span class="p">.</span><span class="n">XmlName</span><span class="p">);</span>
</span><span id="__span-79-20"><a id="__codelineno-79-20" name="__codelineno-79-20" href="#__codelineno-79-20"></a><span class="w"> </span><span class="n">c</span><span class="p">.</span><span class="n">WriteXml</span><span class="w"> </span><span class="p">(</span><span class="n">w</span><span class="p">);</span>
</span><span id="__span-79-21"><a id="__codelineno-79-21" name="__codelineno-79-21" href="#__codelineno-79-21"></a><span class="w"> </span><span class="n">w</span><span class="p">.</span><span class="n">WriteEndElement</span><span class="p">();</span>
</span><span id="__span-79-22"><a id="__codelineno-79-22" name="__codelineno-79-22" href="#__codelineno-79-22"></a><span class="w"> </span><span class="p">}</span>
</span><span id="__span-79-23"><a id="__codelineno-79-23" name="__codelineno-79-23" href="#__codelineno-79-23"></a><span class="w"> </span><span class="k">foreach</span><span class="w"> </span><span class="p">(</span><span class="n">Supplier</span><span class="w"> </span><span class="n">s</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">Suppliers</span><span class="p">)</span>
</span><span id="__span-79-24"><a id="__codelineno-79-24" name="__codelineno-79-24" href="#__codelineno-79-24"></a><span class="w"> </span><span class="p">{</span>
</span><span id="__span-79-25"><a id="__codelineno-79-25" name="__codelineno-79-25" href="#__codelineno-79-25"></a><span class="w"> </span><span class="n">w</span><span class="p">.</span><span class="n">WriteStartElement</span><span class="w"> </span><span class="p">(</span><span class="n">Supplier</span><span class="p">.</span><span class="n">XmlName</span><span class="p">);</span>
</span><span id="__span-79-26"><a id="__codelineno-79-26" name="__codelineno-79-26" href="#__codelineno-79-26"></a><span class="w"> </span><span class="n">s</span><span class="p">.</span><span class="n">WriteXml</span><span class="w"> </span><span class="p">(</span><span class="n">w</span><span class="p">);</span>
</span><span id="__span-79-27"><a id="__codelineno-79-27" name="__codelineno-79-27" href="#__codelineno-79-27"></a><span class="w"> </span><span class="n">w</span><span class="p">.</span><span class="n">WriteEndElement</span><span class="p">();</span>
</span><span id="__span-79-28"><a id="__codelineno-79-28" name="__codelineno-79-28" href="#__codelineno-79-28"></a><span class="w"> </span><span class="p">}</span>
</span><span id="__span-79-29"><a id="__codelineno-79-29" name="__codelineno-79-29" href="#__codelineno-79-29"></a><span class="p">}</span>
</span></code></pre></div>
<p>Hereâ€™s how to serialize a Contacts object populated with Customers and Suppliers to an XML file:</p>
<div class="language-csharp highlight"><pre><span></span><code><span id="__span-80-1"><a id="__codelineno-80-1" name="__codelineno-80-1" href="#__codelineno-80-1"></a><span class="kt">var</span><span class="w"> </span><span class="n">settings</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">XmlWriterSettings</span><span class="p">();</span>
</span><span id="__span-80-2"><a id="__codelineno-80-2" name="__codelineno-80-2" href="#__codelineno-80-2"></a><span class="n">settings</span><span class="p">.</span><span class="n">Indent</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">true</span><span class="p">;</span><span class="w"> </span><span class="c1">// To make visual inspection easier</span>
</span><span id="__span-80-3"><a id="__codelineno-80-3" name="__codelineno-80-3" href="#__codelineno-80-3"></a><span class="k">using</span><span class="w"> </span><span class="nn">XmlWriter</span><span class="w"> </span><span class="n">writer</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">XmlWriter</span><span class="p">.</span><span class="n">Create</span><span class="w"> </span><span class="p">(</span><span class="s">&quot;contacts.xml&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">settings</span><span class="p">);</span>
</span><span id="__span-80-4"><a id="__codelineno-80-4" name="__codelineno-80-4" href="#__codelineno-80-4"></a><span class="kt">var</span><span class="w"> </span><span class="n">cts</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">Contacts</span><span class="p">()</span>
</span><span id="__span-80-5"><a id="__codelineno-80-5" name="__codelineno-80-5" href="#__codelineno-80-5"></a><span class="c1">// Add Customers and Suppliers...</span>
</span><span id="__span-80-6"><a id="__codelineno-80-6" name="__codelineno-80-6" href="#__codelineno-80-6"></a><span class="n">writer</span><span class="p">.</span><span class="n">WriteStartElement</span><span class="w"> </span><span class="p">(</span><span class="s">&quot;contacts&quot;</span><span class="p">);</span>
</span><span id="__span-80-7"><a id="__codelineno-80-7" name="__codelineno-80-7" href="#__codelineno-80-7"></a><span class="n">cts</span><span class="p">.</span><span class="n">WriteXml</span><span class="w"> </span><span class="p">(</span><span class="n">writer</span><span class="p">);</span>
</span><span id="__span-80-8"><a id="__codelineno-80-8" name="__codelineno-80-8" href="#__codelineno-80-8"></a><span class="n">writer</span><span class="p">.</span><span class="n">WriteEndElement</span><span class="p">();</span>
</span></code></pre></div>
<p>Hereâ€™s how to deserialize from the same file:</p>
<div class="language-csharp highlight"><pre><span></span><code><span id="__span-81-1"><a id="__codelineno-81-1" name="__codelineno-81-1" href="#__codelineno-81-1"></a><span class="kt">var</span><span class="w"> </span><span class="n">settings</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">XmlReaderSettings</span><span class="p">();</span>
</span><span id="__span-81-2"><a id="__codelineno-81-2" name="__codelineno-81-2" href="#__codelineno-81-2"></a><span class="n">settings</span><span class="p">.</span><span class="n">IgnoreWhitespace</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">true</span><span class="p">;</span>
</span><span id="__span-81-3"><a id="__codelineno-81-3" name="__codelineno-81-3" href="#__codelineno-81-3"></a><span class="n">settings</span><span class="p">.</span><span class="n">IgnoreComments</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">true</span><span class="p">;</span>
</span><span id="__span-81-4"><a id="__codelineno-81-4" name="__codelineno-81-4" href="#__codelineno-81-4"></a><span class="n">settings</span><span class="p">.</span><span class="n">IgnoreProcessingInstructions</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">true</span><span class="p">;</span>
</span><span id="__span-81-5"><a id="__codelineno-81-5" name="__codelineno-81-5" href="#__codelineno-81-5"></a><span class="k">using</span><span class="w"> </span><span class="nn">XmlReader</span><span class="w"> </span><span class="n">reader</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">XmlReader</span><span class="p">.</span><span class="n">Create</span><span class="p">(</span><span class="s">&quot;contacts.xml&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">settings</span><span class="p">);</span>
</span><span id="__span-81-6"><a id="__codelineno-81-6" name="__codelineno-81-6" href="#__codelineno-81-6"></a><span class="n">reader</span><span class="p">.</span><span class="n">MoveToContent</span><span class="p">();</span>
</span><span id="__span-81-7"><a id="__codelineno-81-7" name="__codelineno-81-7" href="#__codelineno-81-7"></a><span class="kt">var</span><span class="w"> </span><span class="n">cts</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">Contacts</span><span class="p">();</span>
</span><span id="__span-81-8"><a id="__codelineno-81-8" name="__codelineno-81-8" href="#__codelineno-81-8"></a><span class="n">cts</span><span class="p">.</span><span class="n">ReadXml</span><span class="p">(</span><span class="n">reader</span><span class="p">);</span>
</span></code></pre></div>
<h3 id="mixing-xmlreaderxmlwriter-with-an-x-dom">Mixing XmlReader/XmlWriter with an X-DOM</h3>
<p>For instance, suppose that we have an XML logfile structured as follows:</p>
<div class="language-csharp highlight"><pre><span></span><code><span id="__span-82-1"><a id="__codelineno-82-1" name="__codelineno-82-1" href="#__codelineno-82-1"></a><span class="o">&lt;</span><span class="n">log</span><span class="o">&gt;</span>
</span><span id="__span-82-2"><a id="__codelineno-82-2" name="__codelineno-82-2" href="#__codelineno-82-2"></a><span class="w"> </span><span class="o">&lt;</span><span class="n">logentry</span><span class="w"> </span><span class="n">id</span><span class="o">=</span><span class="s">&quot;1&quot;</span><span class="o">&gt;</span>
</span><span id="__span-82-3"><a id="__codelineno-82-3" name="__codelineno-82-3" href="#__codelineno-82-3"></a><span class="w"> </span><span class="o">&lt;</span><span class="n">date</span><span class="o">&gt;</span><span class="p">...</span><span class="o">&lt;/</span><span class="n">date</span><span class="o">&gt;</span>
</span><span id="__span-82-4"><a id="__codelineno-82-4" name="__codelineno-82-4" href="#__codelineno-82-4"></a><span class="w"> </span><span class="o">&lt;</span><span class="n">source</span><span class="o">&gt;</span><span class="p">...</span><span class="o">&lt;/</span><span class="n">source</span><span class="o">&gt;</span>
</span><span id="__span-82-5"><a id="__codelineno-82-5" name="__codelineno-82-5" href="#__codelineno-82-5"></a><span class="w"> </span><span class="p">...</span>
</span><span id="__span-82-6"><a id="__codelineno-82-6" name="__codelineno-82-6" href="#__codelineno-82-6"></a><span class="w"> </span><span class="o">&lt;/</span><span class="n">logentry</span><span class="o">&gt;</span>
</span><span id="__span-82-7"><a id="__codelineno-82-7" name="__codelineno-82-7" href="#__codelineno-82-7"></a><span class="w"> </span><span class="p">...</span>
</span><span id="__span-82-8"><a id="__codelineno-82-8" name="__codelineno-82-8" href="#__codelineno-82-8"></a><span class="o">&lt;/</span><span class="n">log</span><span class="o">&gt;</span>
</span></code></pre></div>
<p>If there were a million logentry elements, reading the entire thing into an X-DOM would waste memory. A better solution is to traverse each logentry with an XmlReader and then use XElement to process the elements individually:</p>
<div class="language-csharp highlight"><pre><span></span><code><span id="__span-83-1"><a id="__codelineno-83-1" name="__codelineno-83-1" href="#__codelineno-83-1"></a><span class="n">XmlReaderSettings</span><span class="w"> </span><span class="n">settings</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">XmlReaderSettings</span><span class="p">();</span>
</span><span id="__span-83-2"><a id="__codelineno-83-2" name="__codelineno-83-2" href="#__codelineno-83-2"></a><span class="n">settings</span><span class="p">.</span><span class="n">IgnoreWhitespace</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">true</span><span class="p">;</span>
</span><span id="__span-83-3"><a id="__codelineno-83-3" name="__codelineno-83-3" href="#__codelineno-83-3"></a><span class="k">using</span><span class="w"> </span><span class="nn">XmlReader</span><span class="w"> </span><span class="n">r</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">XmlReader</span><span class="p">.</span><span class="n">Create</span><span class="w"> </span><span class="p">(</span><span class="s">&quot;logfile.xml&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">settings</span><span class="p">);</span>
</span><span id="__span-83-4"><a id="__codelineno-83-4" name="__codelineno-83-4" href="#__codelineno-83-4"></a><span class="n">r</span><span class="p">.</span><span class="n">ReadStartElement</span><span class="w"> </span><span class="p">(</span><span class="s">&quot;log&quot;</span><span class="p">);</span>
</span><span id="__span-83-5"><a id="__codelineno-83-5" name="__codelineno-83-5" href="#__codelineno-83-5"></a><span class="k">while</span><span class="w"> </span><span class="p">(</span><span class="n">r</span><span class="p">.</span><span class="n">Name</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s">&quot;logentry&quot;</span><span class="p">)</span>
</span><span id="__span-83-6"><a id="__codelineno-83-6" name="__codelineno-83-6" href="#__codelineno-83-6"></a><span class="p">{</span>
</span><span id="__span-83-7"><a id="__codelineno-83-7" name="__codelineno-83-7" href="#__codelineno-83-7"></a><span class="w"> </span><span class="n">XElement</span><span class="w"> </span><span class="n">logEntry</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">XElement</span><span class="p">)</span><span class="w"> </span><span class="n">XNode</span><span class="p">.</span><span class="n">ReadFrom</span><span class="w"> </span><span class="p">(</span><span class="n">r</span><span class="p">);</span>
</span><span id="__span-83-8"><a id="__codelineno-83-8" name="__codelineno-83-8" href="#__codelineno-83-8"></a><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="p">)</span><span class="w"> </span><span class="n">logEntry</span><span class="p">.</span><span class="n">Attribute</span><span class="w"> </span><span class="p">(</span><span class="s">&quot;id&quot;</span><span class="p">);</span>
</span><span id="__span-83-9"><a id="__codelineno-83-9" name="__codelineno-83-9" href="#__codelineno-83-9"></a><span class="w"> </span><span class="n">DateTime</span><span class="w"> </span><span class="n">date</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">DateTime</span><span class="p">)</span><span class="w"> </span><span class="n">logEntry</span><span class="p">.</span><span class="n">Element</span><span class="w"> </span><span class="p">(</span><span class="s">&quot;date&quot;</span><span class="p">);</span>
</span><span id="__span-83-10"><a id="__codelineno-83-10" name="__codelineno-83-10" href="#__codelineno-83-10"></a><span class="w"> </span><span class="kt">string</span><span class="w"> </span><span class="n">source</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="kt">string</span><span class="p">)</span><span class="w"> </span><span class="n">logEntry</span><span class="p">.</span><span class="n">Element</span><span class="w"> </span><span class="p">(</span><span class="s">&quot;source&quot;</span><span class="p">);</span>
</span><span id="__span-83-11"><a id="__codelineno-83-11" name="__codelineno-83-11" href="#__codelineno-83-11"></a><span class="w"> </span><span class="p">...</span>
</span><span id="__span-83-12"><a id="__codelineno-83-12" name="__codelineno-83-12" href="#__codelineno-83-12"></a><span class="p">}</span>
</span><span id="__span-83-13"><a id="__codelineno-83-13" name="__codelineno-83-13" href="#__codelineno-83-13"></a><span class="n">r</span><span class="p">.</span><span class="n">ReadEndElement</span><span class="p">();</span>
</span></code></pre></div>
<p>For instance, we could rewrite Customerâ€™s ReadXml method as follows:</p>
<div class="language-csharp highlight"><pre><span></span><code><span id="__span-84-1"><a id="__codelineno-84-1" name="__codelineno-84-1" href="#__codelineno-84-1"></a><span class="k">public</span><span class="w"> </span><span class="k">void</span><span class="w"> </span><span class="nf">ReadXml</span><span class="w"> </span><span class="p">(</span><span class="n">XmlReader</span><span class="w"> </span><span class="n">r</span><span class="p">)</span>
</span><span id="__span-84-2"><a id="__codelineno-84-2" name="__codelineno-84-2" href="#__codelineno-84-2"></a><span class="p">{</span>
</span><span id="__span-84-3"><a id="__codelineno-84-3" name="__codelineno-84-3" href="#__codelineno-84-3"></a><span class="w"> </span><span class="n">XElement</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">XElement</span><span class="p">)</span><span class="w"> </span><span class="n">XNode</span><span class="p">.</span><span class="n">ReadFrom</span><span class="w"> </span><span class="p">(</span><span class="n">r</span><span class="p">);</span>
</span><span id="__span-84-4"><a id="__codelineno-84-4" name="__codelineno-84-4" href="#__codelineno-84-4"></a><span class="w"> </span><span class="n">ID</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="p">)</span><span class="w"> </span><span class="n">x</span><span class="p">.</span><span class="n">Attribute</span><span class="w"> </span><span class="p">(</span><span class="s">&quot;id&quot;</span><span class="p">);</span>
</span><span id="__span-84-5"><a id="__codelineno-84-5" name="__codelineno-84-5" href="#__codelineno-84-5"></a><span class="w"> </span><span class="n">FirstName</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="kt">string</span><span class="p">)</span><span class="w"> </span><span class="n">x</span><span class="p">.</span><span class="n">Element</span><span class="w"> </span><span class="p">(</span><span class="s">&quot;firstname&quot;</span><span class="p">);</span>
</span><span id="__span-84-6"><a id="__codelineno-84-6" name="__codelineno-84-6" href="#__codelineno-84-6"></a><span class="w"> </span><span class="n">LastName</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="kt">string</span><span class="p">)</span><span class="w"> </span><span class="n">x</span><span class="p">.</span><span class="n">Element</span><span class="w"> </span><span class="p">(</span><span class="s">&quot;lastname&quot;</span><span class="p">);</span>
</span><span id="__span-84-7"><a id="__codelineno-84-7" name="__codelineno-84-7" href="#__codelineno-84-7"></a><span class="p">}</span>
</span></code></pre></div>
<h3 id="using-xmlwriter-with-xelement">Using XmlWriter with XElement</h3>
<div class="language-csharp highlight"><pre><span></span><code><span id="__span-85-1"><a id="__codelineno-85-1" name="__codelineno-85-1" href="#__codelineno-85-1"></a><span class="k">using</span><span class="w"> </span><span class="nn">XmlWriter</span><span class="w"> </span><span class="n">w</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">XmlWriter</span><span class="p">.</span><span class="n">Create</span><span class="w"> </span><span class="p">(</span><span class="s">&quot;logfile.xml&quot;</span><span class="p">);</span>
</span><span id="__span-85-2"><a id="__codelineno-85-2" name="__codelineno-85-2" href="#__codelineno-85-2"></a><span class="n">w</span><span class="p">.</span><span class="n">WriteStartElement</span><span class="w"> </span><span class="p">(</span><span class="s">&quot;log&quot;</span><span class="p">);</span>
</span><span id="__span-85-3"><a id="__codelineno-85-3" name="__codelineno-85-3" href="#__codelineno-85-3"></a><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mi">1000000</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="o">++</span><span class="p">)</span>
</span><span id="__span-85-4"><a id="__codelineno-85-4" name="__codelineno-85-4" href="#__codelineno-85-4"></a><span class="p">{</span>
</span><span id="__span-85-5"><a id="__codelineno-85-5" name="__codelineno-85-5" href="#__codelineno-85-5"></a><span class="w"> </span><span class="n">XElement</span><span class="w"> </span><span class="n">e</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">XElement</span><span class="w"> </span><span class="p">(</span><span class="s">&quot;logentry&quot;</span><span class="p">,</span>
</span><span id="__span-85-6"><a id="__codelineno-85-6" name="__codelineno-85-6" href="#__codelineno-85-6"></a><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="nf">XAttribute</span><span class="w"> </span><span class="p">(</span><span class="s">&quot;id&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">i</span><span class="p">),</span>
</span><span id="__span-85-7"><a id="__codelineno-85-7" name="__codelineno-85-7" href="#__codelineno-85-7"></a><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="nf">XElement</span><span class="w"> </span><span class="p">(</span><span class="s">&quot;date&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">DateTime</span><span class="p">.</span><span class="n">Today</span><span class="p">.</span><span class="n">AddDays</span><span class="w"> </span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)),</span>
</span><span id="__span-85-8"><a id="__codelineno-85-8" name="__codelineno-85-8" href="#__codelineno-85-8"></a><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="nf">XElement</span><span class="w"> </span><span class="p">(</span><span class="s">&quot;source&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;test&quot;</span><span class="p">));</span>
</span><span id="__span-85-9"><a id="__codelineno-85-9" name="__codelineno-85-9" href="#__codelineno-85-9"></a><span class="w"> </span><span class="n">e</span><span class="p">.</span><span class="n">WriteTo</span><span class="w"> </span><span class="p">(</span><span class="n">w</span><span class="p">);</span>
</span><span id="__span-85-10"><a id="__codelineno-85-10" name="__codelineno-85-10" href="#__codelineno-85-10"></a><span class="p">}</span>
</span><span id="__span-85-11"><a id="__codelineno-85-11" name="__codelineno-85-11" href="#__codelineno-85-11"></a><span class="n">w</span><span class="p">.</span><span class="n">WriteEndElement</span><span class="w"> </span><span class="p">();</span>
</span></code></pre></div>
<h1 id="working-with-json">Working with JSON</h1>
<p>JSON has become a popular alternative to XML. Although it lacks the advanced feaâ€ tures of XML (such as namespaces, prefixes, and schemas), it benefits from being simple and uncluttered, with a format similar to what you would get from convertâ€ ing a JavaScript object to a string.</p>
<p>In the past, you needed third-party libraries such as Json.NET to work with JSON in C#, but now you have the option of using .NET Coreâ€™s built-in classes. Compared to Json.NET, the built-in classes are less powerful, but simpler, faster, and more memory efficient.</p>
<h3 id="json-reader">Json Reader</h3>
<div class="language-csharp highlight"><pre><span></span><code><span id="__span-86-1"><a id="__codelineno-86-1" name="__codelineno-86-1" href="#__codelineno-86-1"></a><span class="p">{</span>
</span><span id="__span-86-2"><a id="__codelineno-86-2" name="__codelineno-86-2" href="#__codelineno-86-2"></a><span class="w"> </span><span class="s">&quot;FirstName&quot;</span><span class="p">:</span><span class="s">&quot;Sara&quot;</span><span class="p">,</span>
</span><span id="__span-86-3"><a id="__codelineno-86-3" name="__codelineno-86-3" href="#__codelineno-86-3"></a><span class="w"> </span><span class="s">&quot;LastName&quot;</span><span class="p">:</span><span class="s">&quot;Wells&quot;</span><span class="p">,</span>
</span><span id="__span-86-4"><a id="__codelineno-86-4" name="__codelineno-86-4" href="#__codelineno-86-4"></a><span class="w"> </span><span class="s">&quot;Age&quot;</span><span class="p">:</span><span class="mi">35</span><span class="p">,</span>
</span><span id="__span-86-5"><a id="__codelineno-86-5" name="__codelineno-86-5" href="#__codelineno-86-5"></a><span class="w"> </span><span class="s">&quot;Friends&quot;</span><span class="p">:[</span><span class="s">&quot;Dylan&quot;</span><span class="p">,</span><span class="s">&quot;Ian&quot;</span><span class="p">]</span>
</span><span id="__span-86-6"><a id="__codelineno-86-6" name="__codelineno-86-6" href="#__codelineno-86-6"></a><span class="p">}</span>
</span></code></pre></div>
<p>The following code parses the file by enumerating its JSON tokens. A token is the beginning or end of an object, the beginning or end of an array, the name of a property, or an array or property value (string, number, true, false, or null).</p>
<div class="language-csharp highlight"><pre><span></span><code><span id="__span-87-1"><a id="__codelineno-87-1" name="__codelineno-87-1" href="#__codelineno-87-1"></a><span class="kt">byte</span><span class="p">[]</span><span class="w"> </span><span class="n">data</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">File</span><span class="p">.</span><span class="n">ReadAllBytes</span><span class="w"> </span><span class="p">(</span><span class="s">&quot;people.json&quot;</span><span class="p">);</span>
</span><span id="__span-87-2"><a id="__codelineno-87-2" name="__codelineno-87-2" href="#__codelineno-87-2"></a><span class="n">Utf8JsonReader</span><span class="w"> </span><span class="n">reader</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">Utf8JsonReader</span><span class="w"> </span><span class="p">(</span><span class="n">data</span><span class="p">);</span>
</span><span id="__span-87-3"><a id="__codelineno-87-3" name="__codelineno-87-3" href="#__codelineno-87-3"></a><span class="k">while</span><span class="w"> </span><span class="p">(</span><span class="n">reader</span><span class="p">.</span><span class="n">Read</span><span class="p">())</span>
</span><span id="__span-87-4"><a id="__codelineno-87-4" name="__codelineno-87-4" href="#__codelineno-87-4"></a><span class="p">{</span>
</span><span id="__span-87-5"><a id="__codelineno-87-5" name="__codelineno-87-5" href="#__codelineno-87-5"></a><span class="k">switch</span><span class="w"> </span><span class="p">(</span><span class="n">reader</span><span class="p">.</span><span class="n">TokenType</span><span class="p">)</span>
</span><span id="__span-87-6"><a id="__codelineno-87-6" name="__codelineno-87-6" href="#__codelineno-87-6"></a><span class="w"> </span><span class="p">{</span>
</span><span id="__span-87-7"><a id="__codelineno-87-7" name="__codelineno-87-7" href="#__codelineno-87-7"></a><span class="w"> </span><span class="k">case</span><span class="w"> </span><span class="n">JsonTokenType</span><span class="p">.</span><span class="n">StartObject</span><span class="p">:</span>
</span><span id="__span-87-8"><a id="__codelineno-87-8" name="__codelineno-87-8" href="#__codelineno-87-8"></a><span class="w"> </span><span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="w"> </span><span class="p">(</span><span class="s">$&quot;Start of object&quot;</span><span class="p">);</span>
</span><span id="__span-87-9"><a id="__codelineno-87-9" name="__codelineno-87-9" href="#__codelineno-87-9"></a><span class="w"> </span><span class="k">break</span><span class="p">;</span>
</span><span id="__span-87-10"><a id="__codelineno-87-10" name="__codelineno-87-10" href="#__codelineno-87-10"></a><span class="w"> </span><span class="k">case</span><span class="w"> </span><span class="n">JsonTokenType</span><span class="p">.</span><span class="n">EndObject</span><span class="p">:</span>
</span><span id="__span-87-11"><a id="__codelineno-87-11" name="__codelineno-87-11" href="#__codelineno-87-11"></a><span class="w"> </span><span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="w"> </span><span class="p">(</span><span class="s">$&quot;End of object&quot;</span><span class="p">);</span>
</span><span id="__span-87-12"><a id="__codelineno-87-12" name="__codelineno-87-12" href="#__codelineno-87-12"></a><span class="w"> </span><span class="k">break</span><span class="p">;</span>
</span><span id="__span-87-13"><a id="__codelineno-87-13" name="__codelineno-87-13" href="#__codelineno-87-13"></a><span class="w"> </span><span class="k">case</span><span class="w"> </span><span class="n">JsonTokenType</span><span class="p">.</span><span class="n">StartArray</span><span class="p">:</span>
</span><span id="__span-87-14"><a id="__codelineno-87-14" name="__codelineno-87-14" href="#__codelineno-87-14"></a><span class="w"> </span><span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="p">();</span>
</span><span id="__span-87-15"><a id="__codelineno-87-15" name="__codelineno-87-15" href="#__codelineno-87-15"></a><span class="w"> </span><span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="w"> </span><span class="p">(</span><span class="s">$&quot;Start of array&quot;</span><span class="p">);</span>
</span><span id="__span-87-16"><a id="__codelineno-87-16" name="__codelineno-87-16" href="#__codelineno-87-16"></a><span class="w"> </span><span class="k">break</span><span class="p">;</span>
</span><span id="__span-87-17"><a id="__codelineno-87-17" name="__codelineno-87-17" href="#__codelineno-87-17"></a><span class="w"> </span><span class="k">case</span><span class="w"> </span><span class="n">JsonTokenType</span><span class="p">.</span><span class="n">EndArray</span><span class="p">:</span>
</span><span id="__span-87-18"><a id="__codelineno-87-18" name="__codelineno-87-18" href="#__codelineno-87-18"></a><span class="w"> </span><span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="w"> </span><span class="p">(</span><span class="s">$&quot;End of array&quot;</span><span class="p">);</span>
</span><span id="__span-87-19"><a id="__codelineno-87-19" name="__codelineno-87-19" href="#__codelineno-87-19"></a><span class="w"> </span><span class="k">break</span><span class="p">;</span>
</span><span id="__span-87-20"><a id="__codelineno-87-20" name="__codelineno-87-20" href="#__codelineno-87-20"></a><span class="w"> </span><span class="k">case</span><span class="w"> </span><span class="n">JsonTokenType</span><span class="p">.</span><span class="n">PropertyName</span><span class="p">:</span>
</span><span id="__span-87-21"><a id="__codelineno-87-21" name="__codelineno-87-21" href="#__codelineno-87-21"></a><span class="w"> </span><span class="n">Console</span><span class="p">.</span><span class="n">Write</span><span class="w"> </span><span class="p">(</span><span class="s">$&quot;Property: {reader.GetString()}&quot;</span><span class="p">);</span>
</span><span id="__span-87-22"><a id="__codelineno-87-22" name="__codelineno-87-22" href="#__codelineno-87-22"></a><span class="w"> </span><span class="k">break</span><span class="p">;</span>
</span><span id="__span-87-23"><a id="__codelineno-87-23" name="__codelineno-87-23" href="#__codelineno-87-23"></a><span class="w"> </span><span class="k">case</span><span class="w"> </span><span class="n">JsonTokenType</span><span class="p">.</span><span class="n">String</span><span class="p">:</span>
</span><span id="__span-87-24"><a id="__codelineno-87-24" name="__codelineno-87-24" href="#__codelineno-87-24"></a><span class="w"> </span><span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="w"> </span><span class="p">(</span><span class="s">$&quot; Value: {reader.GetString()}&quot;</span><span class="p">);</span>
</span><span id="__span-87-25"><a id="__codelineno-87-25" name="__codelineno-87-25" href="#__codelineno-87-25"></a><span class="w"> </span><span class="k">break</span><span class="p">;</span>
</span><span id="__span-87-26"><a id="__codelineno-87-26" name="__codelineno-87-26" href="#__codelineno-87-26"></a><span class="w"> </span><span class="k">case</span><span class="w"> </span><span class="n">JsonTokenType</span><span class="p">.</span><span class="n">Number</span><span class="p">:</span>
</span><span id="__span-87-27"><a id="__codelineno-87-27" name="__codelineno-87-27" href="#__codelineno-87-27"></a><span class="w"> </span><span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="w"> </span><span class="p">(</span><span class="s">$&quot; Value: {reader.GetInt32()}&quot;</span><span class="p">);</span>
</span><span id="__span-87-28"><a id="__codelineno-87-28" name="__codelineno-87-28" href="#__codelineno-87-28"></a><span class="w"> </span><span class="k">break</span><span class="p">;</span>
</span><span id="__span-87-29"><a id="__codelineno-87-29" name="__codelineno-87-29" href="#__codelineno-87-29"></a><span class="w"> </span><span class="k">default</span><span class="p">:</span>
</span><span id="__span-87-30"><a id="__codelineno-87-30" name="__codelineno-87-30" href="#__codelineno-87-30"></a><span class="w"> </span><span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="w"> </span><span class="p">(</span><span class="s">$&quot;No support for {reader.TokenType}&quot;</span><span class="p">);</span>
</span><span id="__span-87-31"><a id="__codelineno-87-31" name="__codelineno-87-31" href="#__codelineno-87-31"></a><span class="w"> </span><span class="k">break</span><span class="p">;</span>
</span><span id="__span-87-32"><a id="__codelineno-87-32" name="__codelineno-87-32" href="#__codelineno-87-32"></a><span class="w"> </span><span class="p">}</span>
</span><span id="__span-87-33"><a id="__codelineno-87-33" name="__codelineno-87-33" href="#__codelineno-87-33"></a><span class="p">}</span>
</span></code></pre></div>
<p>Hereâ€™s the output:</p>
<div class="language-csharp highlight"><pre><span></span><code><span id="__span-88-1"><a id="__codelineno-88-1" name="__codelineno-88-1" href="#__codelineno-88-1"></a><span class="n">Start</span><span class="w"> </span><span class="n">of</span><span class="w"> </span><span class="kt">object</span>
</span><span id="__span-88-2"><a id="__codelineno-88-2" name="__codelineno-88-2" href="#__codelineno-88-2"></a><span class="n">Property</span><span class="p">:</span><span class="w"> </span><span class="n">FirstName</span><span class="w"> </span><span class="n">Value</span><span class="p">:</span><span class="w"> </span><span class="n">Sara</span>
</span><span id="__span-88-3"><a id="__codelineno-88-3" name="__codelineno-88-3" href="#__codelineno-88-3"></a><span class="n">Property</span><span class="p">:</span><span class="w"> </span><span class="n">LastName</span><span class="w"> </span><span class="n">Value</span><span class="p">:</span><span class="w"> </span><span class="n">Wells</span>
</span><span id="__span-88-4"><a id="__codelineno-88-4" name="__codelineno-88-4" href="#__codelineno-88-4"></a><span class="n">Property</span><span class="p">:</span><span class="w"> </span><span class="n">Age</span><span class="w"> </span><span class="n">Value</span><span class="p">:</span><span class="w"> </span><span class="mi">35</span>
</span><span id="__span-88-5"><a id="__codelineno-88-5" name="__codelineno-88-5" href="#__codelineno-88-5"></a><span class="n">Property</span><span class="p">:</span><span class="w"> </span><span class="n">Friends</span>
</span><span id="__span-88-6"><a id="__codelineno-88-6" name="__codelineno-88-6" href="#__codelineno-88-6"></a><span class="n">Start</span><span class="w"> </span><span class="n">of</span><span class="w"> </span><span class="n">array</span>
</span><span id="__span-88-7"><a id="__codelineno-88-7" name="__codelineno-88-7" href="#__codelineno-88-7"></a><span class="w"> </span><span class="n">Value</span><span class="p">:</span><span class="w"> </span><span class="n">Dylan</span>
</span><span id="__span-88-8"><a id="__codelineno-88-8" name="__codelineno-88-8" href="#__codelineno-88-8"></a><span class="w"> </span><span class="n">Value</span><span class="p">:</span><span class="w"> </span><span class="n">Ian</span>
</span><span id="__span-88-9"><a id="__codelineno-88-9" name="__codelineno-88-9" href="#__codelineno-88-9"></a><span class="n">End</span><span class="w"> </span><span class="n">of</span><span class="w"> </span><span class="n">array</span>
</span><span id="__span-88-10"><a id="__codelineno-88-10" name="__codelineno-88-10" href="#__codelineno-88-10"></a><span class="n">End</span><span class="w"> </span><span class="n">of</span><span class="w"> </span><span class="kt">object</span>
</span></code></pre></div>
<h3 id="jsonwriter">JsonWriter</h3>
<div class="language-csharp highlight"><pre><span></span><code><span id="__span-89-1"><a id="__codelineno-89-1" name="__codelineno-89-1" href="#__codelineno-89-1"></a><span class="kt">var</span><span class="w"> </span><span class="n">options</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">JsonWriterOptions</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">Indented</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">true</span><span class="w"> </span><span class="p">};</span>
</span><span id="__span-89-2"><a id="__codelineno-89-2" name="__codelineno-89-2" href="#__codelineno-89-2"></a><span class="k">using</span><span class="w"> </span><span class="p">(</span><span class="kt">var</span><span class="w"> </span><span class="n">stream</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">File</span><span class="p">.</span><span class="n">Create</span><span class="w"> </span><span class="p">(</span><span class="s">&quot;MyFile.json&quot;</span><span class="p">))</span>
</span><span id="__span-89-3"><a id="__codelineno-89-3" name="__codelineno-89-3" href="#__codelineno-89-3"></a><span class="k">using</span><span class="w"> </span><span class="p">(</span><span class="kt">var</span><span class="w"> </span><span class="n">writer</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">Utf8JsonWriter</span><span class="w"> </span><span class="p">(</span><span class="n">stream</span><span class="p">,</span><span class="w"> </span><span class="n">options</span><span class="p">))</span>
</span><span id="__span-89-4"><a id="__codelineno-89-4" name="__codelineno-89-4" href="#__codelineno-89-4"></a><span class="p">{</span>
</span><span id="__span-89-5"><a id="__codelineno-89-5" name="__codelineno-89-5" href="#__codelineno-89-5"></a><span class="w"> </span><span class="n">writer</span><span class="p">.</span><span class="n">WriteStartObject</span><span class="p">();</span>
</span><span id="__span-89-6"><a id="__codelineno-89-6" name="__codelineno-89-6" href="#__codelineno-89-6"></a><span class="w"> </span><span class="c1">// Property name and value specified in one call</span>
</span><span id="__span-89-7"><a id="__codelineno-89-7" name="__codelineno-89-7" href="#__codelineno-89-7"></a><span class="w"> </span><span class="n">writer</span><span class="p">.</span><span class="n">WriteString</span><span class="w"> </span><span class="p">(</span><span class="s">&quot;FirstName&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Dylan&quot;</span><span class="p">);</span>
</span><span id="__span-89-8"><a id="__codelineno-89-8" name="__codelineno-89-8" href="#__codelineno-89-8"></a><span class="n">writer</span><span class="p">.</span><span class="n">WriteString</span><span class="w"> </span><span class="p">(</span><span class="s">&quot;LastName&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Lockwood&quot;</span><span class="p">);</span>
</span><span id="__span-89-9"><a id="__codelineno-89-9" name="__codelineno-89-9" href="#__codelineno-89-9"></a><span class="w"> </span><span class="c1">// Property name and value specified in separate calls</span>
</span><span id="__span-89-10"><a id="__codelineno-89-10" name="__codelineno-89-10" href="#__codelineno-89-10"></a><span class="w"> </span><span class="n">writer</span><span class="p">.</span><span class="n">WritePropertyName</span><span class="w"> </span><span class="p">(</span><span class="s">&quot;Age&quot;</span><span class="p">);</span>
</span><span id="__span-89-11"><a id="__codelineno-89-11" name="__codelineno-89-11" href="#__codelineno-89-11"></a><span class="w"> </span><span class="n">writer</span><span class="p">.</span><span class="n">WriteNumberValue</span><span class="w"> </span><span class="p">(</span><span class="mi">46</span><span class="p">);</span>
</span><span id="__span-89-12"><a id="__codelineno-89-12" name="__codelineno-89-12" href="#__codelineno-89-12"></a><span class="w"> </span><span class="n">writer</span><span class="p">.</span><span class="n">WriteCommentValue</span><span class="w"> </span><span class="p">(</span><span class="s">&quot;This is a (non-standard) comment&quot;</span><span class="p">);</span>
</span><span id="__span-89-13"><a id="__codelineno-89-13" name="__codelineno-89-13" href="#__codelineno-89-13"></a><span class="w"> </span><span class="n">writer</span><span class="p">.</span><span class="n">WriteEndObject</span><span class="p">();</span>
</span><span id="__span-89-14"><a id="__codelineno-89-14" name="__codelineno-89-14" href="#__codelineno-89-14"></a><span class="p">}</span>
</span></code></pre></div>
<div class="language-csharp highlight"><pre><span></span><code><span id="__span-90-1"><a id="__codelineno-90-1" name="__codelineno-90-1" href="#__codelineno-90-1"></a><span class="p">{</span>
</span><span id="__span-90-2"><a id="__codelineno-90-2" name="__codelineno-90-2" href="#__codelineno-90-2"></a><span class="w"> </span><span class="s">&quot;FirstName&quot;</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;Dylan&quot;</span><span class="p">,</span>
</span><span id="__span-90-3"><a id="__codelineno-90-3" name="__codelineno-90-3" href="#__codelineno-90-3"></a><span class="w"> </span><span class="s">&quot;LastName&quot;</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;Lockwood&quot;</span><span class="p">,</span>
</span><span id="__span-90-4"><a id="__codelineno-90-4" name="__codelineno-90-4" href="#__codelineno-90-4"></a><span class="w"> </span><span class="s">&quot;Age&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">46</span>
</span><span id="__span-90-5"><a id="__codelineno-90-5" name="__codelineno-90-5" href="#__codelineno-90-5"></a><span class="w"> </span><span class="cm">/*This is a (non-standard) comment*/</span>
</span><span id="__span-90-6"><a id="__codelineno-90-6" name="__codelineno-90-6" href="#__codelineno-90-6"></a><span class="p">}</span>
</span></code></pre></div>
<h3 id="jsondocument">JsonDocument</h3>
<p>System.Text.Json.JsonDocument parses JSON data into a read-only DOM comâ€ posed of lazily populated JsonElement instances that you can access randomly</p>
<aside>
ðŸ‘‰ðŸ¿ JsonDocument is fast and efficient, employing pooled memory to minimize garbage collection. This means that you must disâ€ pose the JsonDocument after use; otherwise, its memory will not be returned to the pool.

</aside>

<div class="language-csharp highlight"><pre><span></span><code><span id="__span-91-1"><a id="__codelineno-91-1" name="__codelineno-91-1" href="#__codelineno-91-1"></a><span class="k">using</span><span class="w"> </span><span class="nn">JsonDocument</span><span class="w"> </span><span class="n">document</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">JsonDocument</span><span class="p">.</span><span class="n">Parse</span><span class="w"> </span><span class="p">(</span><span class="s">&quot;123&quot;</span><span class="p">);</span>
</span><span id="__span-91-2"><a id="__codelineno-91-2" name="__codelineno-91-2" href="#__codelineno-91-2"></a><span class="n">JsonElement</span><span class="w"> </span><span class="n">root</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">document</span><span class="p">.</span><span class="n">RootElement</span><span class="p">;</span>
</span><span id="__span-91-3"><a id="__codelineno-91-3" name="__codelineno-91-3" href="#__codelineno-91-3"></a><span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="w"> </span><span class="p">(</span><span class="n">root</span><span class="p">.</span><span class="n">ValueKind</span><span class="p">);</span><span class="w"> </span><span class="c1">// Number</span>
</span></code></pre></div>
<p>Reading simple values</p>
<div class="language-csharp highlight"><pre><span></span><code><span id="__span-92-1"><a id="__codelineno-92-1" name="__codelineno-92-1" href="#__codelineno-92-1"></a><span class="k">using</span><span class="w"> </span><span class="nn">JsonDocument</span><span class="w"> </span><span class="n">document</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">JsonDocument</span><span class="p">.</span><span class="n">Parse</span><span class="w"> </span><span class="p">(</span><span class="s">&quot;123&quot;</span><span class="p">);</span>
</span><span id="__span-92-2"><a id="__codelineno-92-2" name="__codelineno-92-2" href="#__codelineno-92-2"></a><span class="kt">int</span><span class="w"> </span><span class="n">number</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">document</span><span class="p">.</span><span class="n">RootElement</span><span class="p">.</span><span class="n">GetInt32</span><span class="p">();</span>
</span></code></pre></div>
<p>Reading JSON arrays</p>
<div class="language-csharp highlight"><pre><span></span><code><span id="__span-93-1"><a id="__codelineno-93-1" name="__codelineno-93-1" href="#__codelineno-93-1"></a><span class="k">using</span><span class="w"> </span><span class="nn">JsonDocument</span><span class="w"> </span><span class="n">document</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">JsonDocument</span><span class="p">.</span><span class="n">Parse</span><span class="w"> </span><span class="p">(</span><span class="s">@&quot;[1, 2, 3, 4, 5]&quot;</span><span class="p">);</span>
</span><span id="__span-93-2"><a id="__codelineno-93-2" name="__codelineno-93-2" href="#__codelineno-93-2"></a><span class="kt">int</span><span class="w"> </span><span class="n">length</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">document</span><span class="p">.</span><span class="n">RootElement</span><span class="p">.</span><span class="n">GetArrayLength</span><span class="p">();</span><span class="w"> </span><span class="c1">// 5</span>
</span><span id="__span-93-3"><a id="__codelineno-93-3" name="__codelineno-93-3" href="#__codelineno-93-3"></a><span class="kt">int</span><span class="w"> </span><span class="k">value</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">document</span><span class="p">.</span><span class="n">RootElement</span><span class="p">[</span><span class="mi">3</span><span class="p">].</span><span class="n">GetInt32</span><span class="p">();</span><span class="w"> </span><span class="c1">// 4</span>
</span></code></pre></div>
<p>Reading JSON objects</p>
<div class="language-csharp highlight"><pre><span></span><code><span id="__span-94-1"><a id="__codelineno-94-1" name="__codelineno-94-1" href="#__codelineno-94-1"></a><span class="k">using</span><span class="w"> </span><span class="nn">JsonDocument</span><span class="w"> </span><span class="n">document</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">JsonDocument</span><span class="p">.</span><span class="n">Parse</span><span class="w"> </span><span class="p">(</span><span class="s">@&quot;{ &quot;&quot;Age&quot;&quot;: 32}&quot;</span><span class="p">);</span>
</span><span id="__span-94-2"><a id="__codelineno-94-2" name="__codelineno-94-2" href="#__codelineno-94-2"></a><span class="n">JsonElement</span><span class="w"> </span><span class="n">root</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">document</span><span class="p">.</span><span class="n">RootElement</span><span class="p">;</span>
</span><span id="__span-94-3"><a id="__codelineno-94-3" name="__codelineno-94-3" href="#__codelineno-94-3"></a><span class="kt">int</span><span class="w"> </span><span class="n">age</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">root</span><span class="p">.</span><span class="n">GetProperty</span><span class="w"> </span><span class="p">(</span><span class="s">&quot;Age&quot;</span><span class="p">).</span><span class="n">GetInt32</span><span class="p">();</span>
</span></code></pre></div>
<p>Hereâ€™s how we could â€œdiscoverâ€ the Age property</p>
<div class="language-csharp highlight"><pre><span></span><code><span id="__span-95-1"><a id="__codelineno-95-1" name="__codelineno-95-1" href="#__codelineno-95-1"></a><span class="n">JsonProperty</span><span class="w"> </span><span class="n">ageProp</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">root</span><span class="p">.</span><span class="n">EnumerateObject</span><span class="p">().</span><span class="n">First</span><span class="p">();</span>
</span><span id="__span-95-2"><a id="__codelineno-95-2" name="__codelineno-95-2" href="#__codelineno-95-2"></a><span class="kt">string</span><span class="w"> </span><span class="n">name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ageProp</span><span class="p">.</span><span class="n">Name</span><span class="p">;</span><span class="w"> </span><span class="c1">// Age</span>
</span><span id="__span-95-3"><a id="__codelineno-95-3" name="__codelineno-95-3" href="#__codelineno-95-3"></a><span class="n">JsonElement</span><span class="w"> </span><span class="k">value</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ageProp</span><span class="p">.</span><span class="n">Value</span><span class="p">;</span>
</span><span id="__span-95-4"><a id="__codelineno-95-4" name="__codelineno-95-4" href="#__codelineno-95-4"></a><span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="w"> </span><span class="p">(</span><span class="k">value</span><span class="p">.</span><span class="n">ValueKind</span><span class="p">);</span><span class="w"> </span><span class="c1">// Number</span>
</span><span id="__span-95-5"><a id="__codelineno-95-5" name="__codelineno-95-5" href="#__codelineno-95-5"></a><span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="w"> </span><span class="p">(</span><span class="k">value</span><span class="p">.</span><span class="n">GetInt32</span><span class="p">());</span><span class="w"> </span><span class="c1">// 32</span>
</span></code></pre></div>
<h3 id="jsondocument-and-linq">JsonDocument and LINQ</h3>
<p>JsonDocument lends itself well to LINQ. Given the following JSON file</p>
<div class="language-csharp highlight"><pre><span></span><code><span id="__span-96-1"><a id="__codelineno-96-1" name="__codelineno-96-1" href="#__codelineno-96-1"></a><span class="na">[</span>
</span><span id="__span-96-2"><a id="__codelineno-96-2" name="__codelineno-96-2" href="#__codelineno-96-2"></a><span class="na"> {</span>
</span><span id="__span-96-3"><a id="__codelineno-96-3" name="__codelineno-96-3" href="#__codelineno-96-3"></a><span class="na"> &quot;FirstName&quot;:&quot;Sara&quot;,</span>
</span><span id="__span-96-4"><a id="__codelineno-96-4" name="__codelineno-96-4" href="#__codelineno-96-4"></a><span class="na"> &quot;LastName&quot;:&quot;Wells&quot;,</span>
</span><span id="__span-96-5"><a id="__codelineno-96-5" name="__codelineno-96-5" href="#__codelineno-96-5"></a><span class="na"> &quot;Age&quot;:35,</span>
</span><span id="__span-96-6"><a id="__codelineno-96-6" name="__codelineno-96-6" href="#__codelineno-96-6"></a><span class="na"> &quot;Friends&quot;:[&quot;Ian&quot;]</span>
</span><span id="__span-96-7"><a id="__codelineno-96-7" name="__codelineno-96-7" href="#__codelineno-96-7"></a><span class="w"> </span><span class="p">},</span>
</span><span id="__span-96-8"><a id="__codelineno-96-8" name="__codelineno-96-8" href="#__codelineno-96-8"></a><span class="w"> </span><span class="p">{</span>
</span><span id="__span-96-9"><a id="__codelineno-96-9" name="__codelineno-96-9" href="#__codelineno-96-9"></a><span class="w"> </span><span class="s">&quot;FirstName&quot;</span><span class="p">:</span><span class="s">&quot;Ian&quot;</span><span class="p">,</span>
</span><span id="__span-96-10"><a id="__codelineno-96-10" name="__codelineno-96-10" href="#__codelineno-96-10"></a><span class="w"> </span><span class="s">&quot;LastName&quot;</span><span class="p">:</span><span class="s">&quot;Weems&quot;</span><span class="p">,</span>
</span><span id="__span-96-11"><a id="__codelineno-96-11" name="__codelineno-96-11" href="#__codelineno-96-11"></a><span class="w"> </span><span class="s">&quot;Age&quot;</span><span class="p">:</span><span class="mi">42</span><span class="p">,</span>
</span><span id="__span-96-12"><a id="__codelineno-96-12" name="__codelineno-96-12" href="#__codelineno-96-12"></a><span class="w"> </span><span class="s">&quot;Friends&quot;</span><span class="p">:[</span><span class="s">&quot;Joe&quot;</span><span class="p">,</span><span class="s">&quot;Eric&quot;</span><span class="p">,</span><span class="s">&quot;Li&quot;</span><span class="p">]</span>
</span><span id="__span-96-13"><a id="__codelineno-96-13" name="__codelineno-96-13" href="#__codelineno-96-13"></a><span class="w"> </span><span class="p">},</span>
</span><span id="__span-96-14"><a id="__codelineno-96-14" name="__codelineno-96-14" href="#__codelineno-96-14"></a><span class="w"> </span><span class="p">{</span>
</span><span id="__span-96-15"><a id="__codelineno-96-15" name="__codelineno-96-15" href="#__codelineno-96-15"></a><span class="w"> </span><span class="s">&quot;FirstName&quot;</span><span class="p">:</span><span class="s">&quot;Dylan&quot;</span><span class="p">,</span>
</span><span id="__span-96-16"><a id="__codelineno-96-16" name="__codelineno-96-16" href="#__codelineno-96-16"></a><span class="w"> </span><span class="s">&quot;LastName&quot;</span><span class="p">:</span><span class="s">&quot;Lockwood&quot;</span><span class="p">,</span>
</span><span id="__span-96-17"><a id="__codelineno-96-17" name="__codelineno-96-17" href="#__codelineno-96-17"></a><span class="w"> </span><span class="s">&quot;Age&quot;</span><span class="p">:</span><span class="mi">46</span><span class="p">,</span>
</span><span id="__span-96-18"><a id="__codelineno-96-18" name="__codelineno-96-18" href="#__codelineno-96-18"></a><span class="w"> </span><span class="s">&quot;Friends&quot;</span><span class="p">:[</span><span class="s">&quot;Sara&quot;</span><span class="p">,</span><span class="s">&quot;Ian&quot;</span><span class="p">]</span>
</span><span id="__span-96-19"><a id="__codelineno-96-19" name="__codelineno-96-19" href="#__codelineno-96-19"></a><span class="w"> </span><span class="p">}</span>
</span><span id="__span-96-20"><a id="__codelineno-96-20" name="__codelineno-96-20" href="#__codelineno-96-20"></a><span class="p">]</span>
</span></code></pre></div>
<p>we can use JsonDocument to query this with LINQ, as follows</p>
<div class="language-csharp highlight"><pre><span></span><code><span id="__span-97-1"><a id="__codelineno-97-1" name="__codelineno-97-1" href="#__codelineno-97-1"></a><span class="k">using</span><span class="w"> </span><span class="nn">var</span><span class="w"> </span><span class="n">stream</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">File</span><span class="p">.</span><span class="n">OpenRead</span><span class="w"> </span><span class="p">(</span><span class="n">jsonPath</span><span class="p">);</span>
</span><span id="__span-97-2"><a id="__codelineno-97-2" name="__codelineno-97-2" href="#__codelineno-97-2"></a><span class="k">using</span><span class="w"> </span><span class="nn">JsonDocument</span><span class="w"> </span><span class="n">document</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">JsonDocument</span><span class="p">.</span><span class="n">Parse</span><span class="w"> </span><span class="p">(</span><span class="n">json</span><span class="p">);</span>
</span><span id="__span-97-3"><a id="__codelineno-97-3" name="__codelineno-97-3" href="#__codelineno-97-3"></a><span class="kt">var</span><span class="w"> </span><span class="n">query</span><span class="w"> </span><span class="o">=</span>
</span><span id="__span-97-4"><a id="__codelineno-97-4" name="__codelineno-97-4" href="#__codelineno-97-4"></a><span class="w"> </span><span class="k">from</span><span class="w"> </span><span class="n">person</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">document</span><span class="p">.</span><span class="n">RootElement</span><span class="p">.</span><span class="n">EnumerateArray</span><span class="p">()</span>
</span><span id="__span-97-5"><a id="__codelineno-97-5" name="__codelineno-97-5" href="#__codelineno-97-5"></a><span class="w"> </span><span class="k">select</span><span class="w"> </span><span class="k">new</span>
</span><span id="__span-97-6"><a id="__codelineno-97-6" name="__codelineno-97-6" href="#__codelineno-97-6"></a><span class="w"> </span><span class="p">{</span>
</span><span id="__span-97-7"><a id="__codelineno-97-7" name="__codelineno-97-7" href="#__codelineno-97-7"></a><span class="w"> </span><span class="n">FirstName</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">person</span><span class="p">.</span><span class="n">GetProperty</span><span class="w"> </span><span class="p">(</span><span class="s">&quot;FirstName&quot;</span><span class="p">).</span><span class="n">GetString</span><span class="p">(),</span>
</span><span id="__span-97-8"><a id="__codelineno-97-8" name="__codelineno-97-8" href="#__codelineno-97-8"></a><span class="w"> </span><span class="n">Age</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">person</span><span class="p">.</span><span class="n">GetProperty</span><span class="w"> </span><span class="p">(</span><span class="s">&quot;Age&quot;</span><span class="p">).</span><span class="n">GetInt32</span><span class="p">(),</span>
</span><span id="__span-97-9"><a id="__codelineno-97-9" name="__codelineno-97-9" href="#__codelineno-97-9"></a><span class="w"> </span><span class="n">Friends</span><span class="w"> </span><span class="o">=</span>
</span><span id="__span-97-10"><a id="__codelineno-97-10" name="__codelineno-97-10" href="#__codelineno-97-10"></a><span class="w"> </span><span class="k">from</span><span class="w"> </span><span class="n">friend</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">person</span><span class="p">.</span><span class="n">GetProperty</span><span class="w"> </span><span class="p">(</span><span class="s">&quot;Friends&quot;</span><span class="p">).</span><span class="n">EnumerateArray</span><span class="p">()</span>
</span><span id="__span-97-11"><a id="__codelineno-97-11" name="__codelineno-97-11" href="#__codelineno-97-11"></a><span class="w"> </span><span class="k">select</span><span class="w"> </span><span class="n">friend</span><span class="p">.</span><span class="n">GetString</span><span class="p">()</span>
</span><span id="__span-97-12"><a id="__codelineno-97-12" name="__codelineno-97-12" href="#__codelineno-97-12"></a><span class="w"> </span><span class="p">};</span>
</span></code></pre></div>
<h3 id="making-updates-with-a-json-writer">Making updates with a JSON writer</h3>
<div class="language-csharp highlight"><pre><span></span><code><span id="__span-98-1"><a id="__codelineno-98-1" name="__codelineno-98-1" href="#__codelineno-98-1"></a><span class="k">using</span><span class="w"> </span><span class="nn">var</span><span class="w"> </span><span class="n">json</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">File</span><span class="p">.</span><span class="n">OpenRead</span><span class="w"> </span><span class="p">(</span><span class="n">jsonPath</span><span class="p">);</span>
</span><span id="__span-98-2"><a id="__codelineno-98-2" name="__codelineno-98-2" href="#__codelineno-98-2"></a><span class="k">using</span><span class="w"> </span><span class="nn">JsonDocument</span><span class="w"> </span><span class="n">document</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">JsonDocument</span><span class="p">.</span><span class="n">Parse</span><span class="w"> </span><span class="p">(</span><span class="n">json</span><span class="p">);</span>
</span><span id="__span-98-3"><a id="__codelineno-98-3" name="__codelineno-98-3" href="#__codelineno-98-3"></a><span class="kt">var</span><span class="w"> </span><span class="n">options</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">JsonWriterOptions</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">Indented</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">true</span><span class="w"> </span><span class="p">};</span>
</span><span id="__span-98-4"><a id="__codelineno-98-4" name="__codelineno-98-4" href="#__codelineno-98-4"></a><span class="k">using</span><span class="w"> </span><span class="p">(</span><span class="kt">var</span><span class="w"> </span><span class="n">outputStream</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">File</span><span class="p">.</span><span class="n">Create</span><span class="w"> </span><span class="p">(</span><span class="s">&quot;NewFile.json&quot;</span><span class="p">))</span>
</span><span id="__span-98-5"><a id="__codelineno-98-5" name="__codelineno-98-5" href="#__codelineno-98-5"></a><span class="k">using</span><span class="w"> </span><span class="p">(</span><span class="kt">var</span><span class="w"> </span><span class="n">writer</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">Utf8JsonWriter</span><span class="w"> </span><span class="p">(</span><span class="n">outputStream</span><span class="p">,</span><span class="w"> </span><span class="n">options</span><span class="p">))</span>
</span><span id="__span-98-6"><a id="__codelineno-98-6" name="__codelineno-98-6" href="#__codelineno-98-6"></a><span class="p">{</span>
</span><span id="__span-98-7"><a id="__codelineno-98-7" name="__codelineno-98-7" href="#__codelineno-98-7"></a><span class="w"> </span><span class="n">writer</span><span class="p">.</span><span class="n">WriteStartArray</span><span class="p">();</span>
</span><span id="__span-98-8"><a id="__codelineno-98-8" name="__codelineno-98-8" href="#__codelineno-98-8"></a><span class="w"> </span><span class="k">foreach</span><span class="w"> </span><span class="p">(</span><span class="kt">var</span><span class="w"> </span><span class="n">person</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">document</span><span class="p">.</span><span class="n">RootElement</span><span class="p">.</span><span class="n">EnumerateArray</span><span class="p">())</span>
</span><span id="__span-98-9"><a id="__codelineno-98-9" name="__codelineno-98-9" href="#__codelineno-98-9"></a><span class="w"> </span><span class="p">{</span>
</span><span id="__span-98-10"><a id="__codelineno-98-10" name="__codelineno-98-10" href="#__codelineno-98-10"></a><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">friendCount</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">person</span><span class="p">.</span><span class="n">GetProperty</span><span class="w"> </span><span class="p">(</span><span class="s">&quot;Friends&quot;</span><span class="p">).</span><span class="n">GetArrayLength</span><span class="p">();</span>
</span><span id="__span-98-11"><a id="__codelineno-98-11" name="__codelineno-98-11" href="#__codelineno-98-11"></a><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">friendCount</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="mi">2</span><span class="p">)</span>
</span><span id="__span-98-12"><a id="__codelineno-98-12" name="__codelineno-98-12" href="#__codelineno-98-12"></a><span class="w"> </span><span class="n">person</span><span class="p">.</span><span class="n">WriteTo</span><span class="w"> </span><span class="p">(</span><span class="n">writer</span><span class="p">);</span>
</span><span id="__span-98-13"><a id="__codelineno-98-13" name="__codelineno-98-13" href="#__codelineno-98-13"></a><span class="w"> </span><span class="p">}</span>
</span><span id="__span-98-14"><a id="__codelineno-98-14" name="__codelineno-98-14" href="#__codelineno-98-14"></a><span class="p">}</span>
</span><span id="__span-98-15"><a id="__codelineno-98-15" name="__codelineno-98-15" href="#__codelineno-98-15"></a><span class="err">```#</span><span class="w"> </span><span class="n">Chapter</span><span class="w"> </span><span class="mi">12</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="n">Disposal</span><span class="w"> </span><span class="k">and</span><span class="w"> </span><span class="n">Garbage</span><span class="w"> </span><span class="n">Collection</span>
</span><span id="__span-98-16"><a id="__codelineno-98-16" name="__codelineno-98-16" href="#__codelineno-98-16"></a>
</span><span id="__span-98-17"><a id="__codelineno-98-17" name="__codelineno-98-17" href="#__codelineno-98-17"></a><span class="err">#</span><span class="w"> </span><span class="n">Overview</span>
</span><span id="__span-98-18"><a id="__codelineno-98-18" name="__codelineno-98-18" href="#__codelineno-98-18"></a>
</span><span id="__span-98-19"><a id="__codelineno-98-19" name="__codelineno-98-19" href="#__codelineno-98-19"></a><span class="n">Some</span><span class="w"> </span><span class="n">objects</span><span class="w"> </span><span class="n">require</span><span class="w"> </span><span class="k">explicit</span><span class="w"> </span><span class="n">tear</span><span class="o">-</span><span class="n">down</span><span class="w"> </span><span class="n">code</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">release</span><span class="w"> </span><span class="n">resources</span><span class="w"> </span><span class="n">such</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">open</span><span class="w"> </span><span class="n">files</span><span class="p">,</span><span class="w"> </span><span class="n">locks</span><span class="p">,</span><span class="w"> </span><span class="n">operating</span><span class="w"> </span><span class="n">system</span><span class="w"> </span><span class="n">handles</span><span class="p">,</span><span class="w"> </span><span class="k">and</span><span class="w"> </span><span class="k">unmanaged</span><span class="w"> </span><span class="n">objects</span><span class="p">.</span><span class="w"> </span><span class="n">In</span><span class="w"> </span><span class="p">.</span><span class="n">NET</span><span class="w"> </span><span class="n">parlance</span><span class="p">,</span><span class="w"> </span><span class="k">this</span><span class="w"> </span><span class="k">is</span><span class="w"> </span><span class="n">called</span><span class="w"> </span><span class="n">disposal</span><span class="p">,</span><span class="w"> </span><span class="k">and</span><span class="w"> </span><span class="n">it</span><span class="w"> </span><span class="k">is</span><span class="w"> </span><span class="n">supported</span><span class="w"> </span><span class="n">through</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="err">`</span><span class="n">IDisposable</span><span class="err">`</span><span class="w"> </span><span class="k">interface</span><span class="p">.</span><span class="w"> </span><span class="n">The</span><span class="w"> </span><span class="k">managed</span><span class="w"> </span><span class="n">memory</span><span class="w"> </span><span class="n">occupied</span><span class="w"> </span><span class="k">by</span><span class="w"> </span><span class="n">unused</span><span class="w"> </span><span class="n">objects</span><span class="w"> </span><span class="n">must</span><span class="w"> </span><span class="n">also</span><span class="w"> </span><span class="n">be</span><span class="w"> </span><span class="n">reclaimed</span><span class="w"> </span><span class="n">at</span><span class="w"> </span><span class="n">some</span><span class="w"> </span><span class="n">point</span><span class="p">;</span><span class="w"> </span><span class="k">this</span><span class="w"> </span><span class="n">function</span><span class="w"> </span><span class="k">is</span><span class="w"> </span><span class="n">known</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">garbage</span><span class="w"> </span><span class="n">collection</span><span class="w"> </span><span class="k">and</span><span class="w"> </span><span class="k">is</span><span class="w"> </span><span class="n">performed</span><span class="w"> </span><span class="k">by</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">CLR</span><span class="p">.</span>
</span><span id="__span-98-20"><a id="__codelineno-98-20" name="__codelineno-98-20" href="#__codelineno-98-20"></a>
</span><span id="__span-98-21"><a id="__codelineno-98-21" name="__codelineno-98-21" href="#__codelineno-98-21"></a><span class="n">Disposal</span><span class="w"> </span><span class="n">differs</span><span class="w"> </span><span class="k">from</span><span class="w"> </span><span class="n">garbage</span><span class="w"> </span><span class="n">collection</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">that</span><span class="w"> </span><span class="n">disposal</span><span class="w"> </span><span class="k">is</span><span class="w"> </span><span class="n">usually</span><span class="w"> </span><span class="n">explicitly</span><span class="w"> </span><span class="n">instiga</span><span class="err">â€</span><span class="w"> </span><span class="n">ted</span><span class="p">;</span><span class="w"> </span><span class="n">garbage</span><span class="w"> </span><span class="n">collection</span><span class="w"> </span><span class="k">is</span><span class="w"> </span><span class="n">totally</span><span class="w"> </span><span class="n">automatic</span><span class="p">.</span><span class="w"> </span><span class="n">In</span><span class="w"> </span><span class="n">other</span><span class="w"> </span><span class="n">words</span><span class="p">,</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">programmer</span><span class="w"> </span><span class="n">takes</span><span class="w"> </span><span class="n">care</span><span class="w"> </span><span class="n">of</span><span class="w"> </span><span class="n">such</span><span class="w"> </span><span class="n">things</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">releasing</span><span class="w"> </span><span class="n">file</span><span class="w"> </span><span class="n">handles</span><span class="p">,</span><span class="w"> </span><span class="n">locks</span><span class="p">,</span><span class="w"> </span><span class="k">and</span><span class="w"> </span><span class="n">operating</span><span class="w"> </span><span class="n">system</span><span class="w"> </span><span class="n">resources</span><span class="w"> </span><span class="k">while</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">CLR</span><span class="w"> </span><span class="n">takes</span><span class="w"> </span><span class="n">care</span><span class="w"> </span><span class="n">of</span><span class="w"> </span><span class="n">releasing</span><span class="w"> </span><span class="n">memory</span><span class="p">.</span>
</span><span id="__span-98-22"><a id="__codelineno-98-22" name="__codelineno-98-22" href="#__codelineno-98-22"></a>
</span><span id="__span-98-23"><a id="__codelineno-98-23" name="__codelineno-98-23" href="#__codelineno-98-23"></a><span class="n">This</span><span class="w"> </span><span class="n">chapter</span><span class="w"> </span><span class="n">discusses</span><span class="w"> </span><span class="n">both</span><span class="w"> </span><span class="n">disposal</span><span class="w"> </span><span class="k">and</span><span class="w"> </span><span class="n">garbage</span><span class="w"> </span><span class="n">collection</span><span class="p">,</span><span class="w"> </span><span class="n">also</span><span class="w"> </span><span class="n">describing</span><span class="w"> </span><span class="n">C</span><span class="err">#</span><span class="w"> </span><span class="n">finalizers</span><span class="w"> </span><span class="k">and</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">pattern</span><span class="w"> </span><span class="k">by</span><span class="w"> </span><span class="n">which</span><span class="w"> </span><span class="n">they</span><span class="w"> </span><span class="n">can</span><span class="w"> </span><span class="n">provide</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">backup</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">disposal</span><span class="p">.</span>
</span><span id="__span-98-24"><a id="__codelineno-98-24" name="__codelineno-98-24" href="#__codelineno-98-24"></a>
</span><span id="__span-98-25"><a id="__codelineno-98-25" name="__codelineno-98-25" href="#__codelineno-98-25"></a><span class="err">#</span><span class="w"> </span><span class="n">IDisposable</span><span class="p">,</span><span class="w"> </span><span class="n">Dispose</span><span class="p">,</span><span class="w"> </span><span class="k">and</span><span class="w"> </span><span class="n">Close</span>
</span><span id="__span-98-26"><a id="__codelineno-98-26" name="__codelineno-98-26" href="#__codelineno-98-26"></a>
</span><span id="__span-98-27"><a id="__codelineno-98-27" name="__codelineno-98-27" href="#__codelineno-98-27"></a><span class="n">The</span><span class="w"> </span><span class="p">.</span><span class="n">NET</span><span class="w"> </span><span class="n">Core</span><span class="w"> </span><span class="n">defines</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">special</span><span class="w"> </span><span class="k">interface</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">types</span><span class="w"> </span><span class="n">requiring</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">tear</span><span class="o">-</span><span class="n">down</span><span class="w"> </span><span class="n">method</span>
</span><span id="__span-98-28"><a id="__codelineno-98-28" name="__codelineno-98-28" href="#__codelineno-98-28"></a>
</span><span id="__span-98-29"><a id="__codelineno-98-29" name="__codelineno-98-29" href="#__codelineno-98-29"></a><span class="err">```</span><span class="n">csharp</span>
</span><span id="__span-98-30"><a id="__codelineno-98-30" name="__codelineno-98-30" href="#__codelineno-98-30"></a><span class="k">public</span><span class="w"> </span><span class="k">interface</span><span class="w"> </span><span class="n">IDisposable</span>
</span><span id="__span-98-31"><a id="__codelineno-98-31" name="__codelineno-98-31" href="#__codelineno-98-31"></a><span class="p">{</span>
</span><span id="__span-98-32"><a id="__codelineno-98-32" name="__codelineno-98-32" href="#__codelineno-98-32"></a><span class="w"> </span><span class="k">void</span><span class="w"> </span><span class="nf">Dispose</span><span class="p">();</span>
</span><span id="__span-98-33"><a id="__codelineno-98-33" name="__codelineno-98-33" href="#__codelineno-98-33"></a><span class="p">}</span>
</span></code></pre></div>
<p>C#â€™s using statement provides a syntactic shortcut for calling Dispose on objects that implement IDisposable, using a try/finally block:</p>
<div class="language-csharp highlight"><pre><span></span><code><span id="__span-99-1"><a id="__codelineno-99-1" name="__codelineno-99-1" href="#__codelineno-99-1"></a><span class="k">using</span><span class="w"> </span><span class="p">(</span><span class="n">FileStream</span><span class="w"> </span><span class="n">fs</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">FileStream</span><span class="w"> </span><span class="p">(</span><span class="s">&quot;myFile.txt&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">FileMode</span><span class="p">.</span><span class="n">Open</span><span class="p">))</span>
</span><span id="__span-99-2"><a id="__codelineno-99-2" name="__codelineno-99-2" href="#__codelineno-99-2"></a><span class="p">{</span>
</span><span id="__span-99-3"><a id="__codelineno-99-3" name="__codelineno-99-3" href="#__codelineno-99-3"></a><span class="w"> </span><span class="c1">// ... Write to the file ...</span>
</span><span id="__span-99-4"><a id="__codelineno-99-4" name="__codelineno-99-4" href="#__codelineno-99-4"></a><span class="p">}</span>
</span></code></pre></div>
<p>The compiler converts this to the following</p>
<div class="language-csharp highlight"><pre><span></span><code><span id="__span-100-1"><a id="__codelineno-100-1" name="__codelineno-100-1" href="#__codelineno-100-1"></a><span class="n">FileStream</span><span class="w"> </span><span class="n">fs</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">FileStream</span><span class="w"> </span><span class="p">(</span><span class="s">&quot;myFile.txt&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">FileMode</span><span class="p">.</span><span class="n">Open</span><span class="p">);</span>
</span><span id="__span-100-2"><a id="__codelineno-100-2" name="__codelineno-100-2" href="#__codelineno-100-2"></a><span class="k">try</span>
</span><span id="__span-100-3"><a id="__codelineno-100-3" name="__codelineno-100-3" href="#__codelineno-100-3"></a><span class="p">{</span>
</span><span id="__span-100-4"><a id="__codelineno-100-4" name="__codelineno-100-4" href="#__codelineno-100-4"></a><span class="w"> </span><span class="c1">// ... Write to the file ...</span>
</span><span id="__span-100-5"><a id="__codelineno-100-5" name="__codelineno-100-5" href="#__codelineno-100-5"></a><span class="p">}</span>
</span><span id="__span-100-6"><a id="__codelineno-100-6" name="__codelineno-100-6" href="#__codelineno-100-6"></a><span class="k">finally</span>
</span><span id="__span-100-7"><a id="__codelineno-100-7" name="__codelineno-100-7" href="#__codelineno-100-7"></a><span class="p">{</span>
</span><span id="__span-100-8"><a id="__codelineno-100-8" name="__codelineno-100-8" href="#__codelineno-100-8"></a><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">fs</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="k">null</span><span class="p">)</span><span class="w"> </span><span class="p">((</span><span class="n">IDisposable</span><span class="p">)</span><span class="n">fs</span><span class="p">).</span><span class="n">Dispose</span><span class="p">();</span>
</span><span id="__span-100-9"><a id="__codelineno-100-9" name="__codelineno-100-9" href="#__codelineno-100-9"></a><span class="p">}</span>
</span></code></pre></div>
<p>In simple scenarios, writing your own disposable type is just a matter of implementing IDisposable and writing the Dispose method:</p>
<div class="language-csharp highlight"><pre><span></span><code><span id="__span-101-1"><a id="__codelineno-101-1" name="__codelineno-101-1" href="#__codelineno-101-1"></a><span class="k">sealed</span><span class="w"> </span><span class="k">class</span><span class="w"> </span><span class="nc">Demo</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="n">IDisposable</span>
</span><span id="__span-101-2"><a id="__codelineno-101-2" name="__codelineno-101-2" href="#__codelineno-101-2"></a><span class="p">{</span>
</span><span id="__span-101-3"><a id="__codelineno-101-3" name="__codelineno-101-3" href="#__codelineno-101-3"></a><span class="w"> </span><span class="k">public</span><span class="w"> </span><span class="k">void</span><span class="w"> </span><span class="nf">Dispose</span><span class="p">()</span>
</span><span id="__span-101-4"><a id="__codelineno-101-4" name="__codelineno-101-4" href="#__codelineno-101-4"></a><span class="w"> </span><span class="p">{</span>
</span><span id="__span-101-5"><a id="__codelineno-101-5" name="__codelineno-101-5" href="#__codelineno-101-5"></a><span class="w"> </span><span class="c1">// Perform cleanup / tear-down.</span>
</span><span id="__span-101-6"><a id="__codelineno-101-6" name="__codelineno-101-6" href="#__codelineno-101-6"></a><span class="w"> </span><span class="p">...</span>
</span><span id="__span-101-7"><a id="__codelineno-101-7" name="__codelineno-101-7" href="#__codelineno-101-7"></a><span class="w"> </span><span class="p">}</span>
</span><span id="__span-101-8"><a id="__codelineno-101-8" name="__codelineno-101-8" href="#__codelineno-101-8"></a><span class="p">}</span>
</span></code></pre></div>
<h3 id="standard-disposal-semantics">Standard Disposal Semantics</h3>
<p>.NET Core follows a de facto set of rules in its disposal logic. These rules are not hard-wired to .NET Core or the C# language in any way; their purpose is to define a consistent protocol to consumers. Here they are:</p>
<ol>
<li>.NET Core follows a de facto set of rules in its disposal logic. These rules are not hard-wired to .NET Core or the C# language in any way; their purpose is to define a consistent protocol to consumers. Here they are:</li>
<li>Calling an objectâ€™s Dispose method repeatedly causes no error.</li>
<li>If disposable object x â€œownsâ€ disposable object y, xâ€™s Dispose method automatiâ€ cally calls yâ€™s Dispose methodâ€”unless instructed otherwise.</li>
</ol>
<p>According to rule 3, a container object automatically disposes its child objects. A good example is a <strong>Windows Forms container control such as a Form or Panel. The container can host many child controls, yet you donâ€™t dispose every one of them explicitly;</strong> closing or disposing the parent control or form takes care of the whole lot.</p>
<h3 id="close-and-stop">Close and Stop</h3>
<p>Some types define a method called Close in addition to Dispose. The Framework is not completely consistent on the semantics of a Close method, although in nearly all cases itâ€™s either of the following:</p>
<ul>
<li>Functionally identical to Dispose</li>
<li>A functional subset of Dispose</li>
</ul>
<p>An example of the latter is IDbConnection: a Closed connection can be re-Opened; a Disposed connection cannot. Another example is a Windows Form activated with ShowDialog: Close hides it; Dispose releases its resources.</p>
<h3 id="when-to-dispose">When to Dispose</h3>
<p>A safe rule to follow (in nearly all cases) is â€œif in doubt, dispose.â€ Objects wrapping an unmanaged resource handle will nearly always require disposal in order to free the handle. Examples include file or network streams, network sockets, Windows Forms controls, GDI+ pens, brushes, and bitmaps.</p>
<p>There are, however, three scenarios for not disposing</p>
<ul>
<li>When you donâ€™t â€œownâ€ the object; for example, when obtaining a shared object via a static field or property</li>
<li>When an objectâ€™s Dispose method does something that you donâ€™t want</li>
<li>When an objectâ€™s Dispose method is unnecessary by design, and disposing that object would add complexity to your program</li>
</ul>
<aside>
âš ï¸ Ignoring disposal can sometimes incur a performance cost

</aside>

<h3 id="clearing-fields-in-disposal">Clearing Fields in Disposal</h3>
<p>In general, you donâ€™t need to clear an objectâ€™s fields in its Dispose method. However, it is good practice to unsubscribe from events that the object has subscribed to internally over its lifetime</p>
<p>Unsubscribing from such events avoids receiving unwanted event notificationsâ€”and avoids unintentionally keeping the object alive in the eyes of the garbage collector (GC).</p>
<aside>
ðŸ“¢ A Dispose method itself does not cause (managed) memory to be releasedâ€”this can happen only in garbage collection.

</aside>

<p>Itâ€™s also worth setting a field to indicate that the object is disposed so that you can throw an ObjectDisposedException if a consumer later tries to call members on the object. A good pattern is to use a publicly readable automatic property for this:</p>
<div class="language-csharp highlight"><pre><span></span><code><span id="__span-102-1"><a id="__codelineno-102-1" name="__codelineno-102-1" href="#__codelineno-102-1"></a><span class="k">public</span><span class="w"> </span><span class="kt">bool</span><span class="w"> </span><span class="n">IsDisposed</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">get</span><span class="p">;</span><span class="w"> </span><span class="k">private</span><span class="w"> </span><span class="k">set</span><span class="p">;</span><span class="w"> </span><span class="p">}</span>
</span></code></pre></div>
<p>Although technically unnecessary, it can also be good to clear an objectâ€™s own event handlers (by setting them to null) in the Dispose method. This eliminates the possibility of those events firing during or after disposal.</p>
<h3 id="anonymous-disposal">Anonymous Disposal</h3>
<p>Sometimes, itâ€™s useful to implement <code>IDisposable</code> without having to write a class. For instance, suppose that you want to expose methods on a class that suspend and resume event processing</p>
<div class="language-csharp highlight"><pre><span></span><code><span id="__span-103-1"><a id="__codelineno-103-1" name="__codelineno-103-1" href="#__codelineno-103-1"></a><span class="k">public</span><span class="w"> </span><span class="k">class</span><span class="w"> </span><span class="nc">Disposable</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="n">IDisposable</span>
</span><span id="__span-103-2"><a id="__codelineno-103-2" name="__codelineno-103-2" href="#__codelineno-103-2"></a><span class="p">{</span>
</span><span id="__span-103-3"><a id="__codelineno-103-3" name="__codelineno-103-3" href="#__codelineno-103-3"></a><span class="w"> </span><span class="k">public</span><span class="w"> </span><span class="k">static</span><span class="w"> </span><span class="n">Disposable</span><span class="w"> </span><span class="nf">Create</span><span class="w"> </span><span class="p">(</span><span class="n">Action</span><span class="w"> </span><span class="n">onDispose</span><span class="p">)</span>
</span><span id="__span-103-4"><a id="__codelineno-103-4" name="__codelineno-103-4" href="#__codelineno-103-4"></a><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">Disposable</span><span class="w"> </span><span class="p">(</span><span class="n">onDispose</span><span class="p">);</span>
</span><span id="__span-103-5"><a id="__codelineno-103-5" name="__codelineno-103-5" href="#__codelineno-103-5"></a><span class="w"> </span><span class="n">Action</span><span class="w"> </span><span class="n">_onDispose</span><span class="p">;</span>
</span><span id="__span-103-6"><a id="__codelineno-103-6" name="__codelineno-103-6" href="#__codelineno-103-6"></a><span class="w"> </span><span class="n">Disposable</span><span class="w"> </span><span class="p">(</span><span class="n">Action</span><span class="w"> </span><span class="n">onDispose</span><span class="p">)</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="n">_onDispose</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">onDispose</span><span class="p">;</span>
</span><span id="__span-103-7"><a id="__codelineno-103-7" name="__codelineno-103-7" href="#__codelineno-103-7"></a><span class="w"> </span><span class="k">public</span><span class="w"> </span><span class="k">void</span><span class="w"> </span><span class="nf">Dispose</span><span class="p">()</span>
</span><span id="__span-103-8"><a id="__codelineno-103-8" name="__codelineno-103-8" href="#__codelineno-103-8"></a><span class="w"> </span><span class="p">{</span>
</span><span id="__span-103-9"><a id="__codelineno-103-9" name="__codelineno-103-9" href="#__codelineno-103-9"></a><span class="w"> </span><span class="n">_onDispose</span><span class="o">?.</span><span class="n">Invoke</span><span class="p">();</span><span class="w"> </span><span class="c1">// Execute disposal action if non-null.</span>
</span><span id="__span-103-10"><a id="__codelineno-103-10" name="__codelineno-103-10" href="#__codelineno-103-10"></a><span class="w"> </span><span class="n">_onDispose</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">null</span><span class="p">;</span><span class="w"> </span><span class="c1">// Ensure it can&#39;t execute a second time.</span>
</span><span id="__span-103-11"><a id="__codelineno-103-11" name="__codelineno-103-11" href="#__codelineno-103-11"></a><span class="w"> </span><span class="p">}</span>
</span><span id="__span-103-12"><a id="__codelineno-103-12" name="__codelineno-103-12" href="#__codelineno-103-12"></a><span class="p">}</span>
</span></code></pre></div>
<div class="language-csharp highlight"><pre><span></span><code><span id="__span-104-1"><a id="__codelineno-104-1" name="__codelineno-104-1" href="#__codelineno-104-1"></a><span class="k">public</span><span class="w"> </span><span class="n">IDisposable</span><span class="w"> </span><span class="nf">SuspendEvents</span><span class="p">()</span>
</span><span id="__span-104-2"><a id="__codelineno-104-2" name="__codelineno-104-2" href="#__codelineno-104-2"></a><span class="p">{</span>
</span><span id="__span-104-3"><a id="__codelineno-104-3" name="__codelineno-104-3" href="#__codelineno-104-3"></a><span class="w"> </span><span class="n">_suspendCount</span><span class="o">++</span><span class="p">;</span>
</span><span id="__span-104-4"><a id="__codelineno-104-4" name="__codelineno-104-4" href="#__codelineno-104-4"></a><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="n">Disposable</span><span class="p">.</span><span class="n">Create</span><span class="w"> </span><span class="p">(()</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="n">_suspendCount</span><span class="o">--</span><span class="p">);</span>
</span><span id="__span-104-5"><a id="__codelineno-104-5" name="__codelineno-104-5" href="#__codelineno-104-5"></a><span class="p">}</span>
</span></code></pre></div>
<h1 id="automatic-garbage-collection">Automatic Garbage Collection</h1>
<p>Regardless of whether an object requires a Dispose method for custom tear-down logic, at some point the memory it occupies on the heap must be freed. The CLR handles this side of it entirely automatically via an automatic GC. You never dealloâ€ cate managed memory yourself. For example, consider the following method:</p>
<div class="language-csharp highlight"><pre><span></span><code><span id="__span-105-1"><a id="__codelineno-105-1" name="__codelineno-105-1" href="#__codelineno-105-1"></a><span class="k">public</span><span class="w"> </span><span class="k">void</span><span class="w"> </span><span class="nf">Test</span><span class="p">()</span>
</span><span id="__span-105-2"><a id="__codelineno-105-2" name="__codelineno-105-2" href="#__codelineno-105-2"></a><span class="p">{</span>
</span><span id="__span-105-3"><a id="__codelineno-105-3" name="__codelineno-105-3" href="#__codelineno-105-3"></a><span class="w"> </span><span class="kt">byte</span><span class="p">[]</span><span class="w"> </span><span class="n">myArray</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="kt">byte</span><span class="p">[</span><span class="mi">1000</span><span class="p">];</span>
</span><span id="__span-105-4"><a id="__codelineno-105-4" name="__codelineno-105-4" href="#__codelineno-105-4"></a><span class="w"> </span><span class="p">...</span>
</span><span id="__span-105-5"><a id="__codelineno-105-5" name="__codelineno-105-5" href="#__codelineno-105-5"></a><span class="p">}</span>
</span></code></pre></div>
<p>When Test executes, an array to hold 1,000 bytes is allocated on the memory heap. The array is referenced by the variable myArray, stored on the local variable stack. When the method exits, this local variable myArray pops out of scope, meaning that nothing is left to reference the array on the memory heap. The orphaned array then becomes eligible to be reclaimed in garbage collection.</p>
<aside>
ðŸ“¢ In debug mode with optimizations disabled, the lifetime of an object referenced by a local variable extends to the end of the code block to ease debugging. Otherwise, it becomes eligible for collection at the earliest point at which itâ€™s no longer used.

</aside>

<p>Garbage collection does not happen immediately after an object is orphaned. Rather like garbage collection on the street, it happens periodically, although (unlike garbage collection on the street) not to a fixed schedule. The CLR bases its decision on when to collect upon a number of factors, such as the available memory, the amount of memory allocation, and the time since the last collection (the GC selftunes to optimize for an applicationâ€™s specific memory access patterns). This means that <strong>thereâ€™s an indeterminate delay between an object being orphaned and being released from memory. This delay can range from nanoseconds to days</strong>.</p>
<h3 id="garbage-collection-and-memory-consumption">Garbage Collection and Memory Consumption</h3>
<p>The GC tries to strike a balance between the time it spends doing garbage collection and the applicationâ€™s memory consumption (working set). Consequently, applications can consume more memory than they need, particularly if large temporary arrays are constructed. You can monitor a processâ€™s memory consumption via the Windows Task Manager or Resource Monitor or programmatically by querying a performance counter:</p>
<div class="language-csharp highlight"><pre><span></span><code><span id="__span-106-1"><a id="__codelineno-106-1" name="__codelineno-106-1" href="#__codelineno-106-1"></a><span class="c1">// These types are in System.Diagnostics:</span>
</span><span id="__span-106-2"><a id="__codelineno-106-2" name="__codelineno-106-2" href="#__codelineno-106-2"></a><span class="kt">string</span><span class="w"> </span><span class="n">procName</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Process</span><span class="p">.</span><span class="n">GetCurrentProcess</span><span class="p">().</span><span class="n">ProcessName</span><span class="p">;</span>
</span><span id="__span-106-3"><a id="__codelineno-106-3" name="__codelineno-106-3" href="#__codelineno-106-3"></a><span class="k">using</span><span class="w"> </span><span class="nn">PerformanceCounter</span><span class="w"> </span><span class="n">pc</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">PerformanceCounter</span>
</span><span id="__span-106-4"><a id="__codelineno-106-4" name="__codelineno-106-4" href="#__codelineno-106-4"></a><span class="w"> </span><span class="p">(</span><span class="s">&quot;Process&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Private Bytes&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">procName</span><span class="p">);</span>
</span><span id="__span-106-5"><a id="__codelineno-106-5" name="__codelineno-106-5" href="#__codelineno-106-5"></a><span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="w"> </span><span class="p">(</span><span class="n">pc</span><span class="p">.</span><span class="n">NextValue</span><span class="p">());</span>
</span></code></pre></div>
<p>This queries the private working set, which gives the best overall indication of your programâ€™s memory consumption. Specifically, it excludes memory that the CLR has internally deallocated and is willing to rescind to the OS should another process need it.</p>
<h3 id="roots">Roots</h3>
<p>A root is something that keeps an object alive. If an object is not directly or indirectly referenced by a root, it will be eligible for garbage collection.</p>
<p>A root is one of the following</p>
<ul>
<li>A local variable or parameter in an executing method (or in any method in its call stack)</li>
<li>A static variable</li>
<li>An object on the queue that stores objects ready for finalization (see the next section)</li>
</ul>
<p>Itâ€™s impossible for code to execute in a deleted object, so if thereâ€™s any possibility of an (instance) method executing, its object must somehow be referenced in one of these ways.</p>
<p>Note that a group of objects that reference each other cyclically are considered dead without a root referee (see Figure 12-1). To put it in another way, objects that canâ€ not be accessed by following the arrows (references) from a root object are unreachâ€ ableâ€”and therefore subject to collection.</p>
<h1 id="finalizers">Finalizers</h1>
<p>Prior to an object being released from memory, its finalizer runs, if it has one. A finalizer is declared like a constructor, but it is prefixed by the <code>~</code> symbol:</p>
<div class="language-csharp highlight"><pre><span></span><code><span id="__span-107-1"><a id="__codelineno-107-1" name="__codelineno-107-1" href="#__codelineno-107-1"></a><span class="k">class</span><span class="w"> </span><span class="nc">Test</span>
</span><span id="__span-107-2"><a id="__codelineno-107-2" name="__codelineno-107-2" href="#__codelineno-107-2"></a><span class="p">{</span>
</span><span id="__span-107-3"><a id="__codelineno-107-3" name="__codelineno-107-3" href="#__codelineno-107-3"></a><span class="w"> </span><span class="o">~</span><span class="n">Test</span><span class="p">()</span>
</span><span id="__span-107-4"><a id="__codelineno-107-4" name="__codelineno-107-4" href="#__codelineno-107-4"></a><span class="w"> </span><span class="p">{</span>
</span><span id="__span-107-5"><a id="__codelineno-107-5" name="__codelineno-107-5" href="#__codelineno-107-5"></a><span class="w"> </span><span class="c1">// Finalizer logic...</span>
</span><span id="__span-107-6"><a id="__codelineno-107-6" name="__codelineno-107-6" href="#__codelineno-107-6"></a><span class="w"> </span><span class="p">}</span>
</span><span id="__span-107-7"><a id="__codelineno-107-7" name="__codelineno-107-7" href="#__codelineno-107-7"></a><span class="p">}</span>
</span></code></pre></div>
<p>Finalizers are possible because garbage collection works in distinct phases. First, the GC identifies the unused objects ripe for deletion. Those without finalizers are deleted immediately. Those with pending (unrun) finalizers are kept alive (for now) and are put onto a special queue.</p>
<p>At that point, garbage collection is complete, and your program continues executâ€ ing. The finalizer thread then kicks in and starts running in parallel to your proâ€ gram, picking objects off that special queue and running their finalization methods. Prior to each objectâ€™s finalizer running, itâ€™s still very much aliveâ€”that queue acts as a root object. After itâ€™s been dequeued and the finalizer executed, the object becomes orphaned and will be deleted in the next collection (for that objectâ€™s generation).</p>
<p>Finalizers can be useful, but they come with some provisos:</p>
<ul>
<li>Finalizers slow the allocation and collection of memory (the GC needs to keep track of which finalizers have run).</li>
<li>Finalizers prolong the life of the object and any referred objects (they must all await the next garbage truck for actual deletion).</li>
<li>Itâ€™s impossible to predict in what order the finalizers for a set of objects will be called.</li>
<li>You have limited control over when the finalizer for an object will be called.</li>
<li>If code in a finalizer blocks, other objects cannot be finalized.</li>
<li>Finalizers can be circumvented altogether if an application fails to unload cleanly.</li>
</ul>
<p>Here are some guidelines for implementing finalizers:</p>
<ul>
<li>Ensure that your finalizer executes quickly</li>
<li>Never block in your finalizer</li>
<li>Donâ€™t reference other finalizable objects.</li>
<li>Donâ€™t throw exceptions.</li>
</ul>
<h3 id="calling-dispose-from-a-finalizer">Calling Dispose from a Finalizer</h3>
<p>A popular pattern is to have the finalizer call Dispose. This makes sense when cleanup is not urgent and hastening it by calling Dispose is more of an optimization than a necessity</p>
<aside>
âš ï¸ Keep in mind that with this pattern you couple memory dealâ€ location to resource deallocationâ€”two things with potentially divergent interests (unless the resource is itself memory). You also increase the burden on the finalization thread.

</aside>

<div class="language-csharp highlight"><pre><span></span><code><span id="__span-108-1"><a id="__codelineno-108-1" name="__codelineno-108-1" href="#__codelineno-108-1"></a><span class="k">class</span><span class="w"> </span><span class="nc">Test</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="n">IDisposable</span>
</span><span id="__span-108-2"><a id="__codelineno-108-2" name="__codelineno-108-2" href="#__codelineno-108-2"></a><span class="p">{</span>
</span><span id="__span-108-3"><a id="__codelineno-108-3" name="__codelineno-108-3" href="#__codelineno-108-3"></a><span class="w"> </span><span class="k">public</span><span class="w"> </span><span class="k">void</span><span class="w"> </span><span class="nf">Dispose</span><span class="p">()</span><span class="w"> </span><span class="c1">// NOT virtual</span>
</span><span id="__span-108-4"><a id="__codelineno-108-4" name="__codelineno-108-4" href="#__codelineno-108-4"></a><span class="w"> </span><span class="p">{</span>
</span><span id="__span-108-5"><a id="__codelineno-108-5" name="__codelineno-108-5" href="#__codelineno-108-5"></a><span class="w"> </span><span class="n">Dispose</span><span class="w"> </span><span class="p">(</span><span class="k">true</span><span class="p">);</span>
</span><span id="__span-108-6"><a id="__codelineno-108-6" name="__codelineno-108-6" href="#__codelineno-108-6"></a><span class="w"> </span><span class="n">GC</span><span class="p">.</span><span class="n">SuppressFinalize</span><span class="w"> </span><span class="p">(</span><span class="k">this</span><span class="p">);</span><span class="w"> </span><span class="c1">// Prevent finalizer from running.</span>
</span><span id="__span-108-7"><a id="__codelineno-108-7" name="__codelineno-108-7" href="#__codelineno-108-7"></a><span class="w"> </span><span class="p">}</span>
</span><span id="__span-108-8"><a id="__codelineno-108-8" name="__codelineno-108-8" href="#__codelineno-108-8"></a><span class="w"> </span><span class="k">protected</span><span class="w"> </span><span class="k">virtual</span><span class="w"> </span><span class="k">void</span><span class="w"> </span><span class="nf">Dispose</span><span class="w"> </span><span class="p">(</span><span class="kt">bool</span><span class="w"> </span><span class="n">disposing</span><span class="p">)</span>
</span><span id="__span-108-9"><a id="__codelineno-108-9" name="__codelineno-108-9" href="#__codelineno-108-9"></a><span class="w"> </span><span class="p">{</span>
</span><span id="__span-108-10"><a id="__codelineno-108-10" name="__codelineno-108-10" href="#__codelineno-108-10"></a><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">disposing</span><span class="p">)</span>
</span><span id="__span-108-11"><a id="__codelineno-108-11" name="__codelineno-108-11" href="#__codelineno-108-11"></a><span class="w"> </span><span class="p">{</span>
</span><span id="__span-108-12"><a id="__codelineno-108-12" name="__codelineno-108-12" href="#__codelineno-108-12"></a><span class="w"> </span><span class="c1">// Call Dispose() on other objects owned by this instance.</span>
</span><span id="__span-108-13"><a id="__codelineno-108-13" name="__codelineno-108-13" href="#__codelineno-108-13"></a><span class="w"> </span><span class="c1">// You can reference other finalizable objects here.</span>
</span><span id="__span-108-14"><a id="__codelineno-108-14" name="__codelineno-108-14" href="#__codelineno-108-14"></a><span class="w"> </span><span class="c1">// ...</span>
</span><span id="__span-108-15"><a id="__codelineno-108-15" name="__codelineno-108-15" href="#__codelineno-108-15"></a><span class="w"> </span><span class="p">}</span>
</span><span id="__span-108-16"><a id="__codelineno-108-16" name="__codelineno-108-16" href="#__codelineno-108-16"></a><span class="w"> </span><span class="c1">// Release unmanaged resources owned by (just) this object.</span>
</span><span id="__span-108-17"><a id="__codelineno-108-17" name="__codelineno-108-17" href="#__codelineno-108-17"></a><span class="w"> </span><span class="c1">// ...</span>
</span><span id="__span-108-18"><a id="__codelineno-108-18" name="__codelineno-108-18" href="#__codelineno-108-18"></a><span class="w"> </span><span class="p">}</span>
</span><span id="__span-108-19"><a id="__codelineno-108-19" name="__codelineno-108-19" href="#__codelineno-108-19"></a><span class="w"> </span><span class="o">~</span><span class="n">Test</span><span class="p">()</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="n">Dispose</span><span class="w"> </span><span class="p">(</span><span class="k">false</span><span class="p">);</span>
</span><span id="__span-108-20"><a id="__codelineno-108-20" name="__codelineno-108-20" href="#__codelineno-108-20"></a><span class="p">}</span>
</span></code></pre></div>
<p>To make this robust, any code capable of throwing an exception should be wrapped in a try/catch block, and the exception, ideally, logged. Any logging should be as simple and robust as possible.</p>
<h3 id="resurrection">Resurrection</h3>
<p>Suppose a finalizer modifies a living object such that it refers back to the dying object. When the next garbage collection happens (for the objectâ€™s generation), the CLR will see the previously dying object as no longer orphanedâ€”and so it will evade garbage collection. This is an advanced scenario, and is called resurrection.</p>
<p>To illustrate, suppose that we want to write a class that manages a temporary file. When an instance of that class is garbage-collected, weâ€™d like the finalizer to delete the temporary file. It sounds easy:</p>
<div class="language-csharp highlight"><pre><span></span><code><span id="__span-109-1"><a id="__codelineno-109-1" name="__codelineno-109-1" href="#__codelineno-109-1"></a><span class="k">public</span><span class="w"> </span><span class="k">class</span><span class="w"> </span><span class="nc">TempFileRef</span>
</span><span id="__span-109-2"><a id="__codelineno-109-2" name="__codelineno-109-2" href="#__codelineno-109-2"></a><span class="p">{</span>
</span><span id="__span-109-3"><a id="__codelineno-109-3" name="__codelineno-109-3" href="#__codelineno-109-3"></a><span class="w"> </span><span class="k">public</span><span class="w"> </span><span class="k">readonly</span><span class="w"> </span><span class="kt">string</span><span class="w"> </span><span class="n">FilePath</span><span class="p">;</span>
</span><span id="__span-109-4"><a id="__codelineno-109-4" name="__codelineno-109-4" href="#__codelineno-109-4"></a><span class="w"> </span><span class="k">public</span><span class="w"> </span><span class="nf">TempFileRef</span><span class="w"> </span><span class="p">(</span><span class="kt">string</span><span class="w"> </span><span class="n">filePath</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">FilePath</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">filePath</span><span class="p">;</span><span class="w"> </span><span class="p">}</span>
</span><span id="__span-109-5"><a id="__codelineno-109-5" name="__codelineno-109-5" href="#__codelineno-109-5"></a><span class="w"> </span><span class="o">~</span><span class="n">TempFileRef</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">File</span><span class="p">.</span><span class="n">Delete</span><span class="w"> </span><span class="p">(</span><span class="n">FilePath</span><span class="p">);</span><span class="w"> </span><span class="p">}</span>
</span><span id="__span-109-6"><a id="__codelineno-109-6" name="__codelineno-109-6" href="#__codelineno-109-6"></a><span class="p">}</span>
</span></code></pre></div>
<p>Unfortunately, this has a bug: File.Delete might throw an exception (due to a lack of permissions, perhaps, or the file being in use, or having already been deleted). Such an exception would take down the entire application (as well as preventing other finalizers from running). We could simply â€œswallowâ€ the exception with an empty catch block, but then weâ€™d never know that anything went wrong. Calling some elaborate error-reporting API would also be undesirable because it would burâ€ den the finalizer thread, hindering garbage collection for other objects. We want to restrict finalization actions to those that are simple, reliable, and quick.</p>
<div class="language-csharp highlight"><pre><span></span><code><span id="__span-110-1"><a id="__codelineno-110-1" name="__codelineno-110-1" href="#__codelineno-110-1"></a><span class="k">public</span><span class="w"> </span><span class="k">class</span><span class="w"> </span><span class="nc">TempFileRef</span>
</span><span id="__span-110-2"><a id="__codelineno-110-2" name="__codelineno-110-2" href="#__codelineno-110-2"></a><span class="p">{</span>
</span><span id="__span-110-3"><a id="__codelineno-110-3" name="__codelineno-110-3" href="#__codelineno-110-3"></a><span class="w"> </span><span class="k">static</span><span class="w"> </span><span class="k">internal</span><span class="w"> </span><span class="k">readonly</span><span class="w"> </span><span class="n">ConcurrentQueue</span><span class="o">&lt;</span><span class="n">TempFileRef</span><span class="o">&gt;</span><span class="w"> </span><span class="n">FailedDeletions</span>
</span><span id="__span-110-4"><a id="__codelineno-110-4" name="__codelineno-110-4" href="#__codelineno-110-4"></a><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">ConcurrentQueue</span><span class="o">&lt;</span><span class="n">TempFileRef</span><span class="o">&gt;</span><span class="p">();</span>
</span><span id="__span-110-5"><a id="__codelineno-110-5" name="__codelineno-110-5" href="#__codelineno-110-5"></a><span class="w"> </span><span class="k">public</span><span class="w"> </span><span class="k">readonly</span><span class="w"> </span><span class="kt">string</span><span class="w"> </span><span class="n">FilePath</span><span class="p">;</span>
</span><span id="__span-110-6"><a id="__codelineno-110-6" name="__codelineno-110-6" href="#__codelineno-110-6"></a><span class="w"> </span><span class="k">public</span><span class="w"> </span><span class="n">Exception</span><span class="w"> </span><span class="n">DeletionError</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">get</span><span class="p">;</span><span class="w"> </span><span class="k">private</span><span class="w"> </span><span class="k">set</span><span class="p">;</span><span class="w"> </span><span class="p">}</span>
</span><span id="__span-110-7"><a id="__codelineno-110-7" name="__codelineno-110-7" href="#__codelineno-110-7"></a><span class="w"> </span><span class="k">public</span><span class="w"> </span><span class="nf">TempFileRef</span><span class="w"> </span><span class="p">(</span><span class="kt">string</span><span class="w"> </span><span class="n">filePath</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">FilePath</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">filePath</span><span class="p">;</span><span class="w"> </span><span class="p">}</span>
</span><span id="__span-110-8"><a id="__codelineno-110-8" name="__codelineno-110-8" href="#__codelineno-110-8"></a><span class="w"> </span><span class="o">~</span><span class="n">TempFileRef</span><span class="p">()</span>
</span><span id="__span-110-9"><a id="__codelineno-110-9" name="__codelineno-110-9" href="#__codelineno-110-9"></a><span class="w"> </span><span class="p">{</span>
</span><span id="__span-110-10"><a id="__codelineno-110-10" name="__codelineno-110-10" href="#__codelineno-110-10"></a><span class="k">try</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">File</span><span class="p">.</span><span class="n">Delete</span><span class="w"> </span><span class="p">(</span><span class="n">FilePath</span><span class="p">);</span><span class="w"> </span><span class="p">}</span>
</span><span id="__span-110-11"><a id="__codelineno-110-11" name="__codelineno-110-11" href="#__codelineno-110-11"></a><span class="w"> </span><span class="k">catch</span><span class="w"> </span><span class="p">(</span><span class="n">Exception</span><span class="w"> </span><span class="n">ex</span><span class="p">)</span>
</span><span id="__span-110-12"><a id="__codelineno-110-12" name="__codelineno-110-12" href="#__codelineno-110-12"></a><span class="w"> </span><span class="p">{</span>
</span><span id="__span-110-13"><a id="__codelineno-110-13" name="__codelineno-110-13" href="#__codelineno-110-13"></a><span class="w"> </span><span class="n">DeletionError</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ex</span><span class="p">;</span>
</span><span id="__span-110-14"><a id="__codelineno-110-14" name="__codelineno-110-14" href="#__codelineno-110-14"></a><span class="w"> </span><span class="n">FailedDeletions</span><span class="p">.</span><span class="n">Enqueue</span><span class="w"> </span><span class="p">(</span><span class="k">this</span><span class="p">);</span><span class="w"> </span><span class="c1">// Resurrection</span>
</span><span id="__span-110-15"><a id="__codelineno-110-15" name="__codelineno-110-15" href="#__codelineno-110-15"></a><span class="w"> </span><span class="p">}</span>
</span><span id="__span-110-16"><a id="__codelineno-110-16" name="__codelineno-110-16" href="#__codelineno-110-16"></a><span class="w"> </span><span class="p">}</span>
</span><span id="__span-110-17"><a id="__codelineno-110-17" name="__codelineno-110-17" href="#__codelineno-110-17"></a><span class="p">}</span>
</span></code></pre></div>
<p><strong>Enqueuing the object to the static FailedDeletions collection gives the object another referee, ensuring that it remains alive until the object is eventually dequeued.</strong></p>
<h3 id="how-the-gc-works">How the GC Works</h3>
<p>The standard CLR uses a generational mark-and-compact GC that performs automatic memory management for objects stored on the managed heap. The GC is considered to be a tracing GC in that it doesnâ€™t interfere with every access to an object, but rather wakes up intermittently and traces the graph of objects stored on the managed heap to determine which objects can be considered garbage and thereâ€ fore collected.</p>
<p>The GC initiates a garbage collection upon performing a memory allocation (via the new keyword), either after a certain threshold of memory has been allocated or at other times to reduce the applicationâ€™s memory footprint. This process can also be initiated manually by calling <code>System.GC.Collect</code>. During a garbage collection, all threads can be frozen (more on this in the next section).</p>
<p>The GC begins with its root object references and walks the object graph, marking all the objects it touches as reachable. When this process is complete, all objects that have not been marked are considered unused and are subject to garbage collection.</p>
<p>Unused objects without finalizers are immediately discarded; unused objects with finalizers are enqueued for processing on the finalizer thread after the GC is complete. These objects then become eligible for collection in the next GC for the objectâ€™s generation (unless resurrected).</p>
<p>The remaining â€œliveâ€ objects are then shifted to the start of the heap (compacted), freeing space for more objects. This compaction serves two purposes: it avoids memory fragmentation, and it allows the GC to employ a very simple strategy when allocating new objects, which is to always allocate memory at the end of the heap. This avoids the potentially time-consuming task of maintaining a list of free memory segments.</p>
<p>If there is insufficient space to allocate memory for a new object after garbage colâ€ lection and the OS is unable to grant further memory, an <code>OutOfMemoryException</code> is thrown.</p>
<h3 id="managed-memory-leaks">Managed Memory Leaks</h3>
<p>In unmanaged languages such as C++, you must remember to manually deallocate memory when an object is no longer required; otherwise, a memory leak will result. In the managed world, this kind of error is impossible due to the CLRâ€™s automatic garbage collection system.</p>
<p>Nonetheless, large and complex .NET applications can exhibit a milder form of the same syndrome with the same end result: the application consumes more and more memory over its lifetime, until it eventually must be restarted. The good news is that managed memory leaks are usually easier to diagnose and prevent.</p>
<p>Managed memory leaks are caused by unused objects remaining alive by virtue of unused or forgotten references. A common candidate is event handlersâ€”these hold a reference to the target object (unless the target is a static method).</p>
<div class="language-csharp highlight"><pre><span></span><code><span id="__span-111-1"><a id="__codelineno-111-1" name="__codelineno-111-1" href="#__codelineno-111-1"></a><span class="k">class</span><span class="w"> </span><span class="nc">Host</span>
</span><span id="__span-111-2"><a id="__codelineno-111-2" name="__codelineno-111-2" href="#__codelineno-111-2"></a><span class="p">{</span>
</span><span id="__span-111-3"><a id="__codelineno-111-3" name="__codelineno-111-3" href="#__codelineno-111-3"></a><span class="w"> </span><span class="k">public</span><span class="w"> </span><span class="k">event</span><span class="w"> </span><span class="n">EventHandler</span><span class="w"> </span><span class="n">Click</span><span class="p">;</span>
</span><span id="__span-111-4"><a id="__codelineno-111-4" name="__codelineno-111-4" href="#__codelineno-111-4"></a><span class="p">}</span>
</span><span id="__span-111-5"><a id="__codelineno-111-5" name="__codelineno-111-5" href="#__codelineno-111-5"></a><span class="k">class</span><span class="w"> </span><span class="nc">Client</span>
</span><span id="__span-111-6"><a id="__codelineno-111-6" name="__codelineno-111-6" href="#__codelineno-111-6"></a><span class="p">{</span>
</span><span id="__span-111-7"><a id="__codelineno-111-7" name="__codelineno-111-7" href="#__codelineno-111-7"></a><span class="w"> </span><span class="n">Host</span><span class="w"> </span><span class="n">_host</span><span class="p">;</span>
</span><span id="__span-111-8"><a id="__codelineno-111-8" name="__codelineno-111-8" href="#__codelineno-111-8"></a><span class="w"> </span><span class="k">public</span><span class="w"> </span><span class="nf">Client</span><span class="w"> </span><span class="p">(</span><span class="n">Host</span><span class="w"> </span><span class="n">host</span><span class="p">)</span>
</span><span id="__span-111-9"><a id="__codelineno-111-9" name="__codelineno-111-9" href="#__codelineno-111-9"></a><span class="p">{</span>
</span><span id="__span-111-10"><a id="__codelineno-111-10" name="__codelineno-111-10" href="#__codelineno-111-10"></a><span class="w"> </span><span class="n">_host</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">host</span><span class="p">;</span>
</span><span id="__span-111-11"><a id="__codelineno-111-11" name="__codelineno-111-11" href="#__codelineno-111-11"></a><span class="w"> </span><span class="n">_host</span><span class="p">.</span><span class="n">Click</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="n">HostClicked</span><span class="p">;</span>
</span><span id="__span-111-12"><a id="__codelineno-111-12" name="__codelineno-111-12" href="#__codelineno-111-12"></a><span class="w"> </span><span class="p">}</span>
</span><span id="__span-111-13"><a id="__codelineno-111-13" name="__codelineno-111-13" href="#__codelineno-111-13"></a><span class="w"> </span><span class="k">void</span><span class="w"> </span><span class="nf">HostClicked</span><span class="w"> </span><span class="p">(</span><span class="kt">object</span><span class="w"> </span><span class="n">sender</span><span class="p">,</span><span class="w"> </span><span class="n">EventArgs</span><span class="w"> </span><span class="n">e</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="p">...</span><span class="w"> </span><span class="p">}</span>
</span><span id="__span-111-14"><a id="__codelineno-111-14" name="__codelineno-111-14" href="#__codelineno-111-14"></a><span class="p">}</span>
</span></code></pre></div>
<p>The following test class contains a method that instantiates 1,000 clients</p>
<div class="language-csharp highlight"><pre><span></span><code><span id="__span-112-1"><a id="__codelineno-112-1" name="__codelineno-112-1" href="#__codelineno-112-1"></a><span class="k">class</span><span class="w"> </span><span class="nc">Test</span>
</span><span id="__span-112-2"><a id="__codelineno-112-2" name="__codelineno-112-2" href="#__codelineno-112-2"></a><span class="p">{</span>
</span><span id="__span-112-3"><a id="__codelineno-112-3" name="__codelineno-112-3" href="#__codelineno-112-3"></a><span class="w"> </span><span class="k">static</span><span class="w"> </span><span class="n">Host</span><span class="w"> </span><span class="n">_host</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">Host</span><span class="p">();</span>
</span><span id="__span-112-4"><a id="__codelineno-112-4" name="__codelineno-112-4" href="#__codelineno-112-4"></a><span class="w"> </span><span class="k">public</span><span class="w"> </span><span class="k">static</span><span class="w"> </span><span class="k">void</span><span class="w"> </span><span class="nf">CreateClients</span><span class="p">()</span>
</span><span id="__span-112-5"><a id="__codelineno-112-5" name="__codelineno-112-5" href="#__codelineno-112-5"></a><span class="w"> </span><span class="p">{</span>
</span><span id="__span-112-6"><a id="__codelineno-112-6" name="__codelineno-112-6" href="#__codelineno-112-6"></a><span class="w"> </span><span class="n">Client</span><span class="p">[]</span><span class="w"> </span><span class="n">clients</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Enumerable</span><span class="p">.</span><span class="n">Range</span><span class="w"> </span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">1000</span><span class="p">)</span>
</span><span id="__span-112-7"><a id="__codelineno-112-7" name="__codelineno-112-7" href="#__codelineno-112-7"></a><span class="w"> </span><span class="p">.</span><span class="n">Select</span><span class="w"> </span><span class="p">(</span><span class="n">i</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">Client</span><span class="w"> </span><span class="p">(</span><span class="n">_host</span><span class="p">))</span>
</span><span id="__span-112-8"><a id="__codelineno-112-8" name="__codelineno-112-8" href="#__codelineno-112-8"></a><span class="w"> </span><span class="p">.</span><span class="n">ToArray</span><span class="p">();</span>
</span><span id="__span-112-9"><a id="__codelineno-112-9" name="__codelineno-112-9" href="#__codelineno-112-9"></a><span class="w"> </span><span class="c1">// Do something with clients ...</span>
</span><span id="__span-112-10"><a id="__codelineno-112-10" name="__codelineno-112-10" href="#__codelineno-112-10"></a><span class="w"> </span><span class="p">}</span>
</span><span id="__span-112-11"><a id="__codelineno-112-11" name="__codelineno-112-11" href="#__codelineno-112-11"></a><span class="p">}</span>
</span></code></pre></div>
<p>You might expect that after CreateClients finishes executing, the 1,000 Client objects will become eligible for collection. Unfortunately, each client has another referee: the _host object whose Click event now references each Client instance. This can go unnoticed if the Click event doesnâ€™t fireâ€”or if the HostClicked method doesnâ€™t do anything to attract attention.</p>
<p>One way to solve this is to make Client implement IDisposable, and in the Dispose method, unhook the event handler:</p>
<div class="language-csharp highlight"><pre><span></span><code><span id="__span-113-1"><a id="__codelineno-113-1" name="__codelineno-113-1" href="#__codelineno-113-1"></a><span class="k">public</span><span class="w"> </span><span class="k">void</span><span class="w"> </span><span class="nf">Dispose</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">_host</span><span class="p">.</span><span class="n">Click</span><span class="w"> </span><span class="o">-=</span><span class="w"> </span><span class="n">HostClicked</span><span class="p">;</span><span class="w"> </span><span class="p">}</span>
</span></code></pre></div>
<p>Consumers of Client then dispose of the instances when theyâ€™re done with them:</p>
<div class="language-csharp highlight"><pre><span></span><code><span id="__span-114-1"><a id="__codelineno-114-1" name="__codelineno-114-1" href="#__codelineno-114-1"></a><span class="n">Array</span><span class="p">.</span><span class="n">ForEach</span><span class="w"> </span><span class="p">(</span><span class="n">clients</span><span class="p">,</span><span class="w"> </span><span class="n">c</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="n">c</span><span class="p">.</span><span class="n">Dispose</span><span class="p">());</span>
</span></code></pre></div>
<h3 id="diagnosing-memory-leaks">Diagnosing Memory Leaks</h3>
<p>The easiest way to avoid managed memory leaks is to proactively monitor memory consumption as an application is written. You can obtain the current memory consumption of a programâ€™s objects as follows (the true argument tells the GC to perform a collection first):</p>
<div class="language-csharp highlight"><pre><span></span><code><span id="__span-115-1"><a id="__codelineno-115-1" name="__codelineno-115-1" href="#__codelineno-115-1"></a><span class="kt">long</span><span class="w"> </span><span class="n">memoryUsed</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">GC</span><span class="p">.</span><span class="n">GetTotalMemory</span><span class="w"> </span><span class="p">(</span><span class="k">true</span><span class="p">);</span>
</span></code></pre></div>
<p><strong>If youâ€™re practicing test-driven development, one possibility is to use unit tests to assert that memory is reclaimed as expected. If such an assertion fails, you then need examine only the changes that youâ€™ve made recently</strong># Chapter 13 : Diagnostics</p>
<h1 id="overview_1">Overview</h1>
<p>When things go wrong, itâ€™s important that information is available to aid in diagnosâ€ ing the problem. An Integrated Development Environment (IDE) or debugger can assist greatly to this effectâ€”but it is usually available only during development. After an application ships, the application itself must gather and record diagnostic information. To meet this requirement, .NET Core provides a set of facilities to log diagnostic information, monitor application behavior, detect runtime errors, and integrate with debugging tools if available.</p>
<p>Some diagnostic tools and APIs are Windows specific because they rely on features of the Windows operating system. In an effort to prevent platform-specific APIs from cluttering .NET Core, Microsoft has shipped them in separate NuGet packages that you can optionally reference.</p>
<h1 id="conditional-compilation">Conditional Compilation</h1>
<p>You can conditionally compile any section of code in C# with preprocessor directives. Preprocessor directives are special instructions to the compiler that begin with the # symbol (and, unlike other C# constructs, must appear on a line of their own). Logically, they execute before the main compilation takes place (although in practice, the compiler processes them during the lexical parsing phase). The preprocessor directives for conditional compilation are <code>#if</code>, <code>#else</code>, <code>#endif</code>, and <code>#elif</code>.</p>
<p>The #if directive instructs the compiler to ignore a section of code unless a specified symbol has been defined. You can define a symbol in source code by using the <code>#define</code> directive (in which case the symbol applies to just that file), or in the .csproj file by using a <code>&lt;DefineConstants&gt;</code> element (in which case the symbol applies to whole assembly):</p>
<div class="language-csharp highlight"><pre><span></span><code><span id="__span-116-1"><a id="__codelineno-116-1" name="__codelineno-116-1" href="#__codelineno-116-1"></a><span class="cp">#define TESTMODE // #define directives must be at top of file</span>
</span><span id="__span-116-2"><a id="__codelineno-116-2" name="__codelineno-116-2" href="#__codelineno-116-2"></a><span class="w"> </span><span class="c1">// Symbol names are uppercase by convention.</span>
</span><span id="__span-116-3"><a id="__codelineno-116-3" name="__codelineno-116-3" href="#__codelineno-116-3"></a><span class="k">using</span><span class="w"> </span><span class="nn">System</span><span class="p">;</span>
</span><span id="__span-116-4"><a id="__codelineno-116-4" name="__codelineno-116-4" href="#__codelineno-116-4"></a><span class="k">class</span><span class="w"> </span><span class="nc">Program</span>
</span><span id="__span-116-5"><a id="__codelineno-116-5" name="__codelineno-116-5" href="#__codelineno-116-5"></a><span class="p">{</span>
</span><span id="__span-116-6"><a id="__codelineno-116-6" name="__codelineno-116-6" href="#__codelineno-116-6"></a><span class="w"> </span><span class="k">static</span><span class="w"> </span><span class="k">void</span><span class="w"> </span><span class="nf">Main</span><span class="p">()</span>
</span><span id="__span-116-7"><a id="__codelineno-116-7" name="__codelineno-116-7" href="#__codelineno-116-7"></a><span class="w"> </span><span class="p">{</span>
</span><span id="__span-116-8"><a id="__codelineno-116-8" name="__codelineno-116-8" href="#__codelineno-116-8"></a><span class="cp">#if TESTMODE</span>
</span><span id="__span-116-9"><a id="__codelineno-116-9" name="__codelineno-116-9" href="#__codelineno-116-9"></a><span class="w"> </span><span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="w"> </span><span class="p">(</span><span class="s">&quot;in test mode!&quot;</span><span class="p">);</span><span class="w"> </span><span class="c1">// OUTPUT: in test mode!</span>
</span><span id="__span-116-10"><a id="__codelineno-116-10" name="__codelineno-116-10" href="#__codelineno-116-10"></a><span class="cp">#endif</span>
</span><span id="__span-116-11"><a id="__codelineno-116-11" name="__codelineno-116-11" href="#__codelineno-116-11"></a><span class="w"> </span><span class="p">}</span>
</span><span id="__span-116-12"><a id="__codelineno-116-12" name="__codelineno-116-12" href="#__codelineno-116-12"></a><span class="p">}</span>
</span></code></pre></div>
<p>If we deleted the first line, the program would compile with the Console.WriteLine statement completely eliminated from the executable, as though it were commented out.</p>
<p>The <code>#else</code> statement is analogous to C#â€™s else statement, and <code>#elif</code> is equivalent to <code>#else</code> followed by <code>#if</code>. The <code>||</code>, <code>&amp;&amp;</code>, and <code>!</code> operators perform or, and, and not operations:</p>
<div class="language-csharp highlight"><pre><span></span><code><span id="__span-117-1"><a id="__codelineno-117-1" name="__codelineno-117-1" href="#__codelineno-117-1"></a><span class="cp">#if TESTMODE &amp;&amp; !PLAYMODE // if TESTMODE and not PLAYMODE</span>
</span><span id="__span-117-2"><a id="__codelineno-117-2" name="__codelineno-117-2" href="#__codelineno-117-2"></a><span class="w"> </span><span class="p">...</span>
</span></code></pre></div>
<p>You can define symbols that apply to every file in an assembly by editing the .csproj file (or in Visual Studio, by going to the Build tab in the Project Properties window). The following defines two constants, TESTMODE and PLAYMODE:</p>
<div class="language-csharp highlight"><pre><span></span><code><span id="__span-118-1"><a id="__codelineno-118-1" name="__codelineno-118-1" href="#__codelineno-118-1"></a><span class="o">&lt;</span><span class="n">PropertyGroup</span><span class="o">&gt;</span>
</span><span id="__span-118-2"><a id="__codelineno-118-2" name="__codelineno-118-2" href="#__codelineno-118-2"></a><span class="w"> </span><span class="o">&lt;</span><span class="n">DefineConstants</span><span class="o">&gt;</span><span class="n">TESTMODE</span><span class="p">;</span><span class="n">PLAYMODE</span><span class="o">&lt;/</span><span class="n">DefineConstants</span><span class="o">&gt;</span>
</span><span id="__span-118-3"><a id="__codelineno-118-3" name="__codelineno-118-3" href="#__codelineno-118-3"></a><span class="o">&lt;/</span><span class="n">PropertyGroup</span><span class="o">&gt;</span>
</span></code></pre></div>
<p>If youâ€™ve defined a symbol at the assembly level and then want to â€œundefineâ€ it for a particular file, you can do so by using the <code>#undef</code> directive.</p>
<h3 id="conditional-compilation-versus-static-variable-flags">Conditional Compilation Versus Static Variable Flags</h3>
<p>You could instead implement the preceding example with a simple static field</p>
<div class="language-csharp highlight"><pre><span></span><code><span id="__span-119-1"><a id="__codelineno-119-1" name="__codelineno-119-1" href="#__codelineno-119-1"></a><span class="k">static</span><span class="w"> </span><span class="k">internal</span><span class="w"> </span><span class="kt">bool</span><span class="w"> </span><span class="n">TestMode</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">true</span><span class="p">;</span>
</span><span id="__span-119-2"><a id="__codelineno-119-2" name="__codelineno-119-2" href="#__codelineno-119-2"></a><span class="k">static</span><span class="w"> </span><span class="k">void</span><span class="w"> </span><span class="nf">Main</span><span class="p">()</span>
</span><span id="__span-119-3"><a id="__codelineno-119-3" name="__codelineno-119-3" href="#__codelineno-119-3"></a><span class="p">{</span>
</span><span id="__span-119-4"><a id="__codelineno-119-4" name="__codelineno-119-4" href="#__codelineno-119-4"></a><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">TestMode</span><span class="p">)</span><span class="w"> </span><span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="w"> </span><span class="p">(</span><span class="s">&quot;in test mode!&quot;</span><span class="p">);</span>
</span><span id="__span-119-5"><a id="__codelineno-119-5" name="__codelineno-119-5" href="#__codelineno-119-5"></a><span class="p">}</span>
</span></code></pre></div>
<p>This has the advantage of allowing runtime configuration. So, why choose condiâ€ tional compilation? The reason is that conditional compilation can take you places variable flags cannot, such as the following:</p>
<ul>
<li>Conditionally including an attribute</li>
<li>Changing the declared type of variable</li>
<li>Switching between different namespaces or type aliases in a using directive</li>
</ul>
<div class="language-csharp highlight"><pre><span></span><code><span id="__span-120-1"><a id="__codelineno-120-1" name="__codelineno-120-1" href="#__codelineno-120-1"></a><span class="k">using</span><span class="w"> </span><span class="nn">TestType</span><span class="w"> </span><span class="o">=</span>
</span><span id="__span-120-2"><a id="__codelineno-120-2" name="__codelineno-120-2" href="#__codelineno-120-2"></a><span class="w"> </span><span class="cp">#if V2</span>
</span><span id="__span-120-3"><a id="__codelineno-120-3" name="__codelineno-120-3" href="#__codelineno-120-3"></a><span class="w"> </span><span class="n">MyCompany</span><span class="p">.</span><span class="n">Widgets</span><span class="p">.</span><span class="n">GadgetV2</span><span class="p">;</span>
</span><span id="__span-120-4"><a id="__codelineno-120-4" name="__codelineno-120-4" href="#__codelineno-120-4"></a><span class="w"> </span><span class="cp">#else</span>
</span><span id="__span-120-5"><a id="__codelineno-120-5" name="__codelineno-120-5" href="#__codelineno-120-5"></a><span class="w"> </span><span class="n">MyCompany</span><span class="p">.</span><span class="n">Widgets</span><span class="p">.</span><span class="n">Gadget</span><span class="p">;</span>
</span><span id="__span-120-6"><a id="__codelineno-120-6" name="__codelineno-120-6" href="#__codelineno-120-6"></a><span class="w"> </span><span class="cp">#endif</span>
</span></code></pre></div>
<p>You can even perform major refactoring under a conditional compilation directive,
so you can instantly switch between old and new versions, and write libraries that
can compile against multiple Framework versions, leveraging the latest Framework
features where available.</p>
<p>Another advantage of conditional compilation is that debugging code can refer to types in assemblies that are not included in deployment.</p>
<h3 id="the-conditional-attribute">The Conditional Attribute</h3>
<p>The Conditional attribute instructs the compiler to ignore any calls to a particular class or method, if the specified symbol has not been defined.</p>
<p>To see how this is useful, suppose that you write a method for logging status inforâ€ mation as follows:</p>
<div class="language-csharp highlight"><pre><span></span><code><span id="__span-121-1"><a id="__codelineno-121-1" name="__codelineno-121-1" href="#__codelineno-121-1"></a><span class="k">static</span><span class="w"> </span><span class="k">void</span><span class="w"> </span><span class="nf">LogStatus</span><span class="w"> </span><span class="p">(</span><span class="kt">string</span><span class="w"> </span><span class="n">msg</span><span class="p">)</span>
</span><span id="__span-121-2"><a id="__codelineno-121-2" name="__codelineno-121-2" href="#__codelineno-121-2"></a><span class="p">{</span>
</span><span id="__span-121-3"><a id="__codelineno-121-3" name="__codelineno-121-3" href="#__codelineno-121-3"></a><span class="w"> </span><span class="kt">string</span><span class="w"> </span><span class="n">logFilePath</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">...</span>
</span><span id="__span-121-4"><a id="__codelineno-121-4" name="__codelineno-121-4" href="#__codelineno-121-4"></a><span class="w"> </span><span class="n">System</span><span class="p">.</span><span class="n">IO</span><span class="p">.</span><span class="n">File</span><span class="p">.</span><span class="n">AppendAllText</span><span class="w"> </span><span class="p">(</span><span class="n">logFilePath</span><span class="p">,</span><span class="w"> </span><span class="n">msg</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s">&quot;\r\n&quot;</span><span class="p">);</span>
</span><span id="__span-121-5"><a id="__codelineno-121-5" name="__codelineno-121-5" href="#__codelineno-121-5"></a><span class="p">}</span>
</span></code></pre></div>
<p>Now imagine that you want this to execute only if the LOGGINGMODE symbol is defined. The first solution is to wrap all calls to LogStatus around an #if directive:</p>
<div class="language-csharp highlight"><pre><span></span><code><span id="__span-122-1"><a id="__codelineno-122-1" name="__codelineno-122-1" href="#__codelineno-122-1"></a><span class="cp">#if LOGGINGMODE</span>
</span><span id="__span-122-2"><a id="__codelineno-122-2" name="__codelineno-122-2" href="#__codelineno-122-2"></a><span class="n">LogStatus</span><span class="w"> </span><span class="p">(</span><span class="s">&quot;Message Headers: &quot;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">GetMsgHeaders</span><span class="p">());</span>
</span><span id="__span-122-3"><a id="__codelineno-122-3" name="__codelineno-122-3" href="#__codelineno-122-3"></a><span class="cp">#endif</span>
</span></code></pre></div>
<p>This gives an ideal result, but it is tedious. The second solution is to put the #if directive inside the LogStatus method. This, however, is problematic should Log Status be called as follows:</p>
<div class="language-csharp highlight"><pre><span></span><code><span id="__span-123-1"><a id="__codelineno-123-1" name="__codelineno-123-1" href="#__codelineno-123-1"></a><span class="n">LogStatus</span><span class="w"> </span><span class="p">(</span><span class="s">&quot;Message Headers: &quot;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">GetComplexMessageHeaders</span><span class="p">());</span>
</span></code></pre></div>
<p>GetComplexMessageHeaders would always be calledâ€”which might incur a performance hit.</p>
<p>We can combine the functionality of the first solution with the convenience of the second by attaching the Conditional attribute (defined in System.Diagnostics) to the LogStatus method:</p>
<div class="language-csharp highlight"><pre><span></span><code><span id="__span-124-1"><a id="__codelineno-124-1" name="__codelineno-124-1" href="#__codelineno-124-1"></a><span class="na">[Conditional (&quot;LOGGINGMODE&quot;)]</span>
</span><span id="__span-124-2"><a id="__codelineno-124-2" name="__codelineno-124-2" href="#__codelineno-124-2"></a><span class="k">static</span><span class="w"> </span><span class="k">void</span><span class="w"> </span><span class="nf">LogStatus</span><span class="w"> </span><span class="p">(</span><span class="kt">string</span><span class="w"> </span><span class="n">msg</span><span class="p">)</span>
</span><span id="__span-124-3"><a id="__codelineno-124-3" name="__codelineno-124-3" href="#__codelineno-124-3"></a><span class="p">{</span>
</span><span id="__span-124-4"><a id="__codelineno-124-4" name="__codelineno-124-4" href="#__codelineno-124-4"></a><span class="w"> </span><span class="p">...</span>
</span><span id="__span-124-5"><a id="__codelineno-124-5" name="__codelineno-124-5" href="#__codelineno-124-5"></a><span class="p">}</span>
</span></code></pre></div>
<div class="language-csharp highlight"><pre><span></span><code><span id="__span-125-1"><a id="__codelineno-125-1" name="__codelineno-125-1" href="#__codelineno-125-1"></a><span class="cp">#define TESTMODE            // #define directives must be at top of file</span>
</span><span id="__span-125-2"><a id="__codelineno-125-2" name="__codelineno-125-2" href="#__codelineno-125-2"></a><span class="cp">#define PLAYMODE</span>
</span><span id="__span-125-3"><a id="__codelineno-125-3" name="__codelineno-125-3" href="#__codelineno-125-3"></a><span class="c1">//#undef PLAYMODE  // Cancels our define above if not commented out. Also cancels a define from the compiler e.g. through Visual Studio settings.</span>
</span><span id="__span-125-4"><a id="__codelineno-125-4" name="__codelineno-125-4" href="#__codelineno-125-4"></a><span class="cp">#define LOGGINGMODE</span>
</span><span id="__span-125-5"><a id="__codelineno-125-5" name="__codelineno-125-5" href="#__codelineno-125-5"></a>
</span><span id="__span-125-6"><a id="__codelineno-125-6" name="__codelineno-125-6" href="#__codelineno-125-6"></a><span class="c1">// Symbol names are uppercase by convention.</span>
</span><span id="__span-125-7"><a id="__codelineno-125-7" name="__codelineno-125-7" href="#__codelineno-125-7"></a>
</span><span id="__span-125-8"><a id="__codelineno-125-8" name="__codelineno-125-8" href="#__codelineno-125-8"></a><span class="k">class</span><span class="w"> </span><span class="nc">Program</span>
</span><span id="__span-125-9"><a id="__codelineno-125-9" name="__codelineno-125-9" href="#__codelineno-125-9"></a><span class="p">{</span>
</span><span id="__span-125-10"><a id="__codelineno-125-10" name="__codelineno-125-10" href="#__codelineno-125-10"></a><span class="w">    </span><span class="k">static</span><span class="w"> </span><span class="k">void</span><span class="w"> </span><span class="nf">Main</span><span class="p">()</span>
</span><span id="__span-125-11"><a id="__codelineno-125-11" name="__codelineno-125-11" href="#__codelineno-125-11"></a><span class="w">    </span><span class="p">{</span>
</span><span id="__span-125-12"><a id="__codelineno-125-12" name="__codelineno-125-12" href="#__codelineno-125-12"></a><span class="cp">#if TESTMODE</span>
</span><span id="__span-125-13"><a id="__codelineno-125-13" name="__codelineno-125-13" href="#__codelineno-125-13"></a><span class="w">    </span><span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="w"> </span><span class="p">(</span><span class="s">&quot;in test mode!&quot;</span><span class="p">);</span><span class="w"> </span>
</span><span id="__span-125-14"><a id="__codelineno-125-14" name="__codelineno-125-14" href="#__codelineno-125-14"></a><span class="cp">#endif</span>
</span><span id="__span-125-15"><a id="__codelineno-125-15" name="__codelineno-125-15" href="#__codelineno-125-15"></a><span class="cp">#if TESTMODE &amp;&amp; !PLAYMODE      // if TESTMODE and not PLAYMODE</span>
</span><span id="__span-125-16"><a id="__codelineno-125-16" name="__codelineno-125-16" href="#__codelineno-125-16"></a><span class="w">    </span><span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="w"> </span><span class="p">(</span><span class="s">&quot;Test mode and NOT play mode&quot;</span><span class="p">);</span><span class="w"> </span>
</span><span id="__span-125-17"><a id="__codelineno-125-17" name="__codelineno-125-17" href="#__codelineno-125-17"></a><span class="cp">#endif</span>
</span><span id="__span-125-18"><a id="__codelineno-125-18" name="__codelineno-125-18" href="#__codelineno-125-18"></a><span class="cp">#if PLAYMODE</span>
</span><span id="__span-125-19"><a id="__codelineno-125-19" name="__codelineno-125-19" href="#__codelineno-125-19"></a><span class="w">    </span><span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="w"> </span><span class="p">(</span><span class="s">&quot;Play mode is defined.&quot;</span><span class="p">);</span>
</span><span id="__span-125-20"><a id="__codelineno-125-20" name="__codelineno-125-20" href="#__codelineno-125-20"></a><span class="cp">#endif</span>
</span><span id="__span-125-21"><a id="__codelineno-125-21" name="__codelineno-125-21" href="#__codelineno-125-21"></a><span class="w">    </span><span class="n">LogStatus</span><span class="p">(</span><span class="s">&quot;Only if LOGGINGMODE is defined.&quot;</span><span class="p">);</span>
</span><span id="__span-125-22"><a id="__codelineno-125-22" name="__codelineno-125-22" href="#__codelineno-125-22"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-125-23"><a id="__codelineno-125-23" name="__codelineno-125-23" href="#__codelineno-125-23"></a>
</span><span id="__span-125-24"><a id="__codelineno-125-24" name="__codelineno-125-24" href="#__codelineno-125-24"></a><span class="w">    </span><span class="na">[Conditional (&quot;LOGGINGMODE&quot;)]</span>
</span><span id="__span-125-25"><a id="__codelineno-125-25" name="__codelineno-125-25" href="#__codelineno-125-25"></a><span class="w">    </span><span class="k">static</span><span class="w"> </span><span class="k">void</span><span class="w"> </span><span class="nf">LogStatus</span><span class="w"> </span><span class="p">(</span><span class="kt">string</span><span class="w"> </span><span class="n">msg</span><span class="p">)</span>
</span><span id="__span-125-26"><a id="__codelineno-125-26" name="__codelineno-125-26" href="#__codelineno-125-26"></a><span class="w">    </span><span class="p">{</span>
</span><span id="__span-125-27"><a id="__codelineno-125-27" name="__codelineno-125-27" href="#__codelineno-125-27"></a><span class="w">        </span><span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="p">(</span><span class="s">$&quot;LOG: {msg}&quot;</span><span class="p">);</span>
</span><span id="__span-125-28"><a id="__codelineno-125-28" name="__codelineno-125-28" href="#__codelineno-125-28"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-125-29"><a id="__codelineno-125-29" name="__codelineno-125-29" href="#__codelineno-125-29"></a>
</span><span id="__span-125-30"><a id="__codelineno-125-30" name="__codelineno-125-30" href="#__codelineno-125-30"></a><span class="p">}</span>
</span></code></pre></div>
<h3 id="alternatives-to-the-conditional-attribute">Alternatives to the Conditional attribute</h3>
<p>The Conditional attribute is useless if you need to dynamically enable or disable functionality at runtime: instead, you must use a variable-based approach. This leaves the question of how to elegantly circumvent the evaluation of arguments when calling conditional logging methods. A functional approach solves this:</p>
<div class="language-csharp highlight"><pre><span></span><code><span id="__span-126-1"><a id="__codelineno-126-1" name="__codelineno-126-1" href="#__codelineno-126-1"></a><span class="k">using</span><span class="w"> </span><span class="nn">System</span><span class="p">;</span>
</span><span id="__span-126-2"><a id="__codelineno-126-2" name="__codelineno-126-2" href="#__codelineno-126-2"></a><span class="k">using</span><span class="w"> </span><span class="nn">System.Linq</span><span class="p">;</span>
</span><span id="__span-126-3"><a id="__codelineno-126-3" name="__codelineno-126-3" href="#__codelineno-126-3"></a><span class="k">class</span><span class="w"> </span><span class="nc">Program</span>
</span><span id="__span-126-4"><a id="__codelineno-126-4" name="__codelineno-126-4" href="#__codelineno-126-4"></a><span class="p">{</span>
</span><span id="__span-126-5"><a id="__codelineno-126-5" name="__codelineno-126-5" href="#__codelineno-126-5"></a><span class="w"> </span><span class="k">public</span><span class="w"> </span><span class="k">static</span><span class="w"> </span><span class="kt">bool</span><span class="w"> </span><span class="n">EnableLogging</span><span class="p">;</span>
</span><span id="__span-126-6"><a id="__codelineno-126-6" name="__codelineno-126-6" href="#__codelineno-126-6"></a><span class="w"> </span><span class="k">static</span><span class="w"> </span><span class="k">void</span><span class="w"> </span><span class="nf">LogStatus</span><span class="w"> </span><span class="p">(</span><span class="n">Func</span><span class="o">&lt;</span><span class="kt">string</span><span class="o">&gt;</span><span class="w"> </span><span class="n">message</span><span class="p">)</span>
</span><span id="__span-126-7"><a id="__codelineno-126-7" name="__codelineno-126-7" href="#__codelineno-126-7"></a><span class="w"> </span><span class="p">{</span>
</span><span id="__span-126-8"><a id="__codelineno-126-8" name="__codelineno-126-8" href="#__codelineno-126-8"></a><span class="w"> </span><span class="kt">string</span><span class="w"> </span><span class="n">logFilePath</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">...</span>
</span><span id="__span-126-9"><a id="__codelineno-126-9" name="__codelineno-126-9" href="#__codelineno-126-9"></a><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">EnableLogging</span><span class="p">)</span>
</span><span id="__span-126-10"><a id="__codelineno-126-10" name="__codelineno-126-10" href="#__codelineno-126-10"></a><span class="w"> </span><span class="n">System</span><span class="p">.</span><span class="n">IO</span><span class="p">.</span><span class="n">File</span><span class="p">.</span><span class="n">AppendAllText</span><span class="w"> </span><span class="p">(</span><span class="n">logFilePath</span><span class="p">,</span><span class="w"> </span><span class="n">message</span><span class="p">()</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s">&quot;\r\n&quot;</span><span class="p">);</span>
</span><span id="__span-126-11"><a id="__codelineno-126-11" name="__codelineno-126-11" href="#__codelineno-126-11"></a><span class="w"> </span><span class="p">}</span>
</span><span id="__span-126-12"><a id="__codelineno-126-12" name="__codelineno-126-12" href="#__codelineno-126-12"></a><span class="p">}</span>
</span><span id="__span-126-13"><a id="__codelineno-126-13" name="__codelineno-126-13" href="#__codelineno-126-13"></a><span class="c1">//A lambda expression lets you call this method without syntax bloat:</span>
</span><span id="__span-126-14"><a id="__codelineno-126-14" name="__codelineno-126-14" href="#__codelineno-126-14"></a><span class="n">LogStatus</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="s">&quot;Message Headers: &quot;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">GetComplexMessageHeaders</span><span class="p">()</span><span class="w"> </span><span class="p">);</span>
</span><span id="__span-126-15"><a id="__codelineno-126-15" name="__codelineno-126-15" href="#__codelineno-126-15"></a><span class="c1">//If EnableLogging is false, GetComplexMessageHeaders is never evaluated.</span>
</span></code></pre></div>
<h1 id="debug-and-trace-classes">Debug and Trace Classes</h1>
<p>Debug and Trace are static classes that provide basic logging and assertion capabilities. The two classes are very similar; the main differentiator is their intended use. The Debug class is intended for debug builds; the Trace class is intended for both debug and release builds. To this effect:</p>
<ul>
<li>All methods of the Debug class are defined with [Conditional("DEBUG")].</li>
<li>All methods of the Trace class are defined with [Conditional("TRACE")].</li>
</ul>
<p>This means that all calls that you make to Debug or Trace are eliminated by the compiler unless you define DEBUG or TRACE symbols. (Visual Studio provides checkâ€ boxes for defining these symbols in the Build tab of Project Properties and enables the TRACE symbol by default with new projects.)</p>
<p>Both the Debug and Trace classes provide Write, WriteLine, and WriteIf methods. By default, these send messages to the debuggerâ€™s output window:</p>
<div class="language-csharp highlight"><pre><span></span><code><span id="__span-127-1"><a id="__codelineno-127-1" name="__codelineno-127-1" href="#__codelineno-127-1"></a><span class="n">Debug</span><span class="p">.</span><span class="n">Write</span><span class="w"> </span><span class="p">(</span><span class="s">&quot;Data&quot;</span><span class="p">);</span>
</span><span id="__span-127-2"><a id="__codelineno-127-2" name="__codelineno-127-2" href="#__codelineno-127-2"></a><span class="n">Debug</span><span class="p">.</span><span class="n">WriteLine</span><span class="w"> </span><span class="p">(</span><span class="mi">23</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mi">34</span><span class="p">);</span>
</span><span id="__span-127-3"><a id="__codelineno-127-3" name="__codelineno-127-3" href="#__codelineno-127-3"></a><span class="kt">int</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">5</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">3</span><span class="p">;</span>
</span><span id="__span-127-4"><a id="__codelineno-127-4" name="__codelineno-127-4" href="#__codelineno-127-4"></a><span class="n">Debug</span><span class="p">.</span><span class="n">WriteIf</span><span class="w"> </span><span class="p">(</span><span class="n">x</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="n">y</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;x is greater than y&quot;</span><span class="p">);</span>
</span></code></pre></div>
<h3 id="fail-and-assert">Fail and Assert</h3>
<p>The Debug and Trace classes both provide Fail and Assert methods. Fail sends the message to each TraceListener in the Debug or Trace classâ€™s Listeners collecâ€ tion (see the following section), which by default writes the message to the debug output:</p>
<div class="language-csharp highlight"><pre><span></span><code><span id="__span-128-1"><a id="__codelineno-128-1" name="__codelineno-128-1" href="#__codelineno-128-1"></a><span class="n">Debug</span><span class="p">.</span><span class="n">Fail</span><span class="w"> </span><span class="p">(</span><span class="s">&quot;File data.txt does not exist!&quot;</span><span class="p">);</span>
</span></code></pre></div>
<p>Assert simply calls Fail if the bool argument is falseâ€”this is called making an assertion and indicates a bug in the code if violated. Specifying a failure message is optional:</p>
<div class="language-csharp highlight"><pre><span></span><code><span id="__span-129-1"><a id="__codelineno-129-1" name="__codelineno-129-1" href="#__codelineno-129-1"></a><span class="n">Debug</span><span class="p">.</span><span class="n">Assert</span><span class="w"> </span><span class="p">(</span><span class="n">File</span><span class="p">.</span><span class="n">Exists</span><span class="w"> </span><span class="p">(</span><span class="s">&quot;data.txt&quot;</span><span class="p">),</span><span class="w"> </span><span class="s">&quot;File data.txt does not exist!&quot;</span><span class="p">);</span>
</span><span id="__span-129-2"><a id="__codelineno-129-2" name="__codelineno-129-2" href="#__codelineno-129-2"></a><span class="kt">var</span><span class="w"> </span><span class="n">result</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">...</span>
</span><span id="__span-129-3"><a id="__codelineno-129-3" name="__codelineno-129-3" href="#__codelineno-129-3"></a><span class="n">Debug</span><span class="p">.</span><span class="n">Assert</span><span class="w"> </span><span class="p">(</span><span class="n">result</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="k">null</span><span class="p">);</span>
</span></code></pre></div>
<h3 id="tracelistener">TraceListener</h3>
<p>The Trace class has a static Listeners property that returns a collection of Trace Listener instances. These are responsible for processing the content emitted by the Write, Fail, and Trace methods.</p>
<p>By default, the Listeners collection of each includes a single listener (Default TraceListener). The default listener has two key features:</p>
<ul>
<li>When connected to a debugger such as Visual Studio, messages are written to the debug output window; otherwise, message content is ignored.</li>
<li>When the Fail method is called (or an assertion fails), the application is terminated.</li>
</ul>
<div class="language-csharp highlight"><pre><span></span><code><span id="__span-130-1"><a id="__codelineno-130-1" name="__codelineno-130-1" href="#__codelineno-130-1"></a><span class="c1">// Clear the default listener:</span>
</span><span id="__span-130-2"><a id="__codelineno-130-2" name="__codelineno-130-2" href="#__codelineno-130-2"></a><span class="n">Trace</span><span class="p">.</span><span class="n">Listeners</span><span class="p">.</span><span class="n">Clear</span><span class="p">();</span>
</span><span id="__span-130-3"><a id="__codelineno-130-3" name="__codelineno-130-3" href="#__codelineno-130-3"></a><span class="c1">// Add a writer that appends to the trace.txt file:</span>
</span><span id="__span-130-4"><a id="__codelineno-130-4" name="__codelineno-130-4" href="#__codelineno-130-4"></a><span class="n">Trace</span><span class="p">.</span><span class="n">Listeners</span><span class="p">.</span><span class="n">Add</span><span class="w"> </span><span class="p">(</span><span class="k">new</span><span class="w"> </span><span class="n">TextWriterTraceListener</span><span class="w"> </span><span class="p">(</span><span class="s">&quot;trace.txt&quot;</span><span class="p">));</span>
</span><span id="__span-130-5"><a id="__codelineno-130-5" name="__codelineno-130-5" href="#__codelineno-130-5"></a><span class="c1">// Obtain the Console&#39;s output stream, then add that as a listener:</span>
</span><span id="__span-130-6"><a id="__codelineno-130-6" name="__codelineno-130-6" href="#__codelineno-130-6"></a><span class="n">System</span><span class="p">.</span><span class="n">IO</span><span class="p">.</span><span class="n">TextWriter</span><span class="w"> </span><span class="n">tw</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Console</span><span class="p">.</span><span class="n">Out</span><span class="p">;</span>
</span><span id="__span-130-7"><a id="__codelineno-130-7" name="__codelineno-130-7" href="#__codelineno-130-7"></a><span class="n">Trace</span><span class="p">.</span><span class="n">Listeners</span><span class="p">.</span><span class="n">Add</span><span class="w"> </span><span class="p">(</span><span class="k">new</span><span class="w"> </span><span class="n">TextWriterTraceListener</span><span class="w"> </span><span class="p">(</span><span class="n">tw</span><span class="p">));</span>
</span><span id="__span-130-8"><a id="__codelineno-130-8" name="__codelineno-130-8" href="#__codelineno-130-8"></a><span class="c1">// Set up a Windows Event log source and then create/add listener.</span>
</span><span id="__span-130-9"><a id="__codelineno-130-9" name="__codelineno-130-9" href="#__codelineno-130-9"></a><span class="c1">// CreateEventSource requires administrative elevation, so this would</span>
</span><span id="__span-130-10"><a id="__codelineno-130-10" name="__codelineno-130-10" href="#__codelineno-130-10"></a><span class="c1">// typically be done in application setup.</span>
</span><span id="__span-130-11"><a id="__codelineno-130-11" name="__codelineno-130-11" href="#__codelineno-130-11"></a><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="n">EventLog</span><span class="p">.</span><span class="n">SourceExists</span><span class="w"> </span><span class="p">(</span><span class="s">&quot;DemoApp&quot;</span><span class="p">))</span>
</span><span id="__span-130-12"><a id="__codelineno-130-12" name="__codelineno-130-12" href="#__codelineno-130-12"></a><span class="w"> </span><span class="n">EventLog</span><span class="p">.</span><span class="n">CreateEventSource</span><span class="w"> </span><span class="p">(</span><span class="s">&quot;DemoApp&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Application&quot;</span><span class="p">);</span>
</span><span id="__span-130-13"><a id="__codelineno-130-13" name="__codelineno-130-13" href="#__codelineno-130-13"></a><span class="n">Trace</span><span class="p">.</span><span class="n">Listeners</span><span class="p">.</span><span class="n">Add</span><span class="w"> </span><span class="p">(</span><span class="k">new</span><span class="w"> </span><span class="n">EventLogTraceListener</span><span class="w"> </span><span class="p">(</span><span class="s">&quot;DemoApp&quot;</span><span class="p">));</span>
</span></code></pre></div>
<h1 id="debugger-integration">Debugger Integration</h1>
<p>Sometimes, itâ€™s useful for an application to interact with a debugger if one is availâ€ able. During development, the debugger is usually your IDE (e.g., Visual Studio); in deployment, the debugger is more likely to be one of the lower-level debugging tools, such as WinDbg, Cordbg, or Mdbg.</p>
<h3 id="attaching-and-breaking">Attaching and Breaking</h3>
<p>The static Debugger class in System.Diagnostics provides basic functions for interâ€ acting with a debuggerâ€”namely Break, Launch, Log, and IsAttached.</p>
<p>A debugger must first attach to an application in order to debug it. If you start an application from within an IDE, this happens automatically, unless you request otherwise (by choosing â€œStart without debuggingâ€). Sometimes, though, itâ€™s inconvenient or impossible to start an application in debug mode within the IDE. An example is a Windows Service application or (ironically) a Visual Studio designer. One solution is to start the application normally and then, in your IDE, choose Debug Process. This doesnâ€™t allow you to set breakpoints early in the programâ€™s execution, however.</p>
<h3 id="debugger-attributes">Debugger Attributes</h3>
<p>The DebuggerStepThrough and DebuggerHidden attributes provide suggestions to the debugger on how to handle single-stepping for a particular method, constructor, or class.</p>
<p>DebuggerStepThrough requests that the debugger step through a function without any user interaction. This attribute is useful in automatically generated methods and in proxy methods that forward the real work to a method somewhere else. In the latter case, the debugger will still show the proxy method in the call stack if a breakâ€ point is set within the â€œrealâ€ methodâ€”unless you also add the DebuggerHidden attribute.</p>
<div class="language-csharp highlight"><pre><span></span><code><span id="__span-131-1"><a id="__codelineno-131-1" name="__codelineno-131-1" href="#__codelineno-131-1"></a><span class="na">[DebuggerStepThrough, DebuggerHidden]</span>
</span><span id="__span-131-2"><a id="__codelineno-131-2" name="__codelineno-131-2" href="#__codelineno-131-2"></a><span class="k">void</span><span class="w"> </span><span class="nf">DoWorkProxy</span><span class="p">()</span>
</span><span id="__span-131-3"><a id="__codelineno-131-3" name="__codelineno-131-3" href="#__codelineno-131-3"></a><span class="p">{</span>
</span><span id="__span-131-4"><a id="__codelineno-131-4" name="__codelineno-131-4" href="#__codelineno-131-4"></a><span class="w"> </span><span class="c1">// setup...</span>
</span><span id="__span-131-5"><a id="__codelineno-131-5" name="__codelineno-131-5" href="#__codelineno-131-5"></a><span class="w"> </span><span class="n">DoWork</span><span class="p">();</span>
</span><span id="__span-131-6"><a id="__codelineno-131-6" name="__codelineno-131-6" href="#__codelineno-131-6"></a><span class="w"> </span><span class="c1">// teardown...</span>
</span><span id="__span-131-7"><a id="__codelineno-131-7" name="__codelineno-131-7" href="#__codelineno-131-7"></a><span class="p">}</span>
</span><span id="__span-131-8"><a id="__codelineno-131-8" name="__codelineno-131-8" href="#__codelineno-131-8"></a><span class="k">void</span><span class="w"> </span><span class="nf">DoWork</span><span class="p">()</span><span class="w"> </span><span class="p">{...}</span><span class="w"> </span><span class="c1">// Real method...</span>
</span></code></pre></div>
<h3 id="processes-and-process-threads">Processes and Process Threads</h3>
<h3 id="examining-running-processes">Examining Running Processes</h3>
<p>The Process.GetProcessXXX methods retrieve a specific process by name or proâ€ cess ID, or all processes running on the current or nominated computer. This includes both managed and unmanaged processes. Each Process instance has a wealth of properties mapping statistics such as name, ID, priority, memory and proâ€ cessor utilization, window handles, and so on. The following sample enumerates all the running processes on the current computer:</p>
<div class="language-csharp highlight"><pre><span></span><code><span id="__span-132-1"><a id="__codelineno-132-1" name="__codelineno-132-1" href="#__codelineno-132-1"></a><span class="k">foreach</span><span class="w"> </span><span class="p">(</span><span class="n">Process</span><span class="w"> </span><span class="n">p</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">Process</span><span class="p">.</span><span class="n">GetProcesses</span><span class="p">())</span>
</span><span id="__span-132-2"><a id="__codelineno-132-2" name="__codelineno-132-2" href="#__codelineno-132-2"></a><span class="k">using</span><span class="w"> </span><span class="p">(</span><span class="n">p</span><span class="p">)</span>
</span><span id="__span-132-3"><a id="__codelineno-132-3" name="__codelineno-132-3" href="#__codelineno-132-3"></a><span class="p">{</span>
</span><span id="__span-132-4"><a id="__codelineno-132-4" name="__codelineno-132-4" href="#__codelineno-132-4"></a><span class="w"> </span><span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="w"> </span><span class="p">(</span><span class="n">p</span><span class="p">.</span><span class="n">ProcessName</span><span class="p">);</span>
</span><span id="__span-132-5"><a id="__codelineno-132-5" name="__codelineno-132-5" href="#__codelineno-132-5"></a><span class="w"> </span><span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="w"> </span><span class="p">(</span><span class="s">&quot; PID: &quot;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">p</span><span class="p">.</span><span class="n">Id</span><span class="p">);</span>
</span><span id="__span-132-6"><a id="__codelineno-132-6" name="__codelineno-132-6" href="#__codelineno-132-6"></a><span class="w"> </span><span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="w"> </span><span class="p">(</span><span class="s">&quot; Memory: &quot;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">p</span><span class="p">.</span><span class="n">WorkingSet64</span><span class="p">);</span>
</span><span id="__span-132-7"><a id="__codelineno-132-7" name="__codelineno-132-7" href="#__codelineno-132-7"></a><span class="w"> </span><span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="w"> </span><span class="p">(</span><span class="s">&quot; Threads: &quot;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">p</span><span class="p">.</span><span class="n">Threads</span><span class="p">.</span><span class="n">Count</span><span class="p">);</span>
</span><span id="__span-132-8"><a id="__codelineno-132-8" name="__codelineno-132-8" href="#__codelineno-132-8"></a><span class="p">}</span>
</span></code></pre></div>
<h3 id="examining-threads-in-a-process">Examining Threads in a Process</h3>
<p>You can also enumerate over the threads of other processes, with the Process.Threads property. The objects that you get, however, are not System .Threading.Thread objects; theyâ€™re ProcessThread objects and are intended for administrative rather than synchronization tasks. A ProcessThread object provides diagnostic information about the underlying thread and allows you to control some aspects of it such as its priority and processor affinity:</p>
<div class="language-csharp highlight"><pre><span></span><code><span id="__span-133-1"><a id="__codelineno-133-1" name="__codelineno-133-1" href="#__codelineno-133-1"></a><span class="k">public</span><span class="w"> </span><span class="k">void</span><span class="w"> </span><span class="nf">EnumerateThreads</span><span class="w"> </span><span class="p">(</span><span class="n">Process</span><span class="w"> </span><span class="n">p</span><span class="p">)</span>
</span><span id="__span-133-2"><a id="__codelineno-133-2" name="__codelineno-133-2" href="#__codelineno-133-2"></a><span class="p">{</span>
</span><span id="__span-133-3"><a id="__codelineno-133-3" name="__codelineno-133-3" href="#__codelineno-133-3"></a><span class="w"> </span><span class="k">foreach</span><span class="w"> </span><span class="p">(</span><span class="n">ProcessThread</span><span class="w"> </span><span class="n">pt</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">p</span><span class="p">.</span><span class="n">Threads</span><span class="p">)</span>
</span><span id="__span-133-4"><a id="__codelineno-133-4" name="__codelineno-133-4" href="#__codelineno-133-4"></a><span class="w"> </span><span class="p">{</span>
</span><span id="__span-133-5"><a id="__codelineno-133-5" name="__codelineno-133-5" href="#__codelineno-133-5"></a><span class="w"> </span><span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="w"> </span><span class="p">(</span><span class="n">pt</span><span class="p">.</span><span class="n">Id</span><span class="p">);</span>
</span><span id="__span-133-6"><a id="__codelineno-133-6" name="__codelineno-133-6" href="#__codelineno-133-6"></a><span class="w"> </span><span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="w"> </span><span class="p">(</span><span class="s">&quot; State: &quot;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">pt</span><span class="p">.</span><span class="n">ThreadState</span><span class="p">);</span>
</span><span id="__span-133-7"><a id="__codelineno-133-7" name="__codelineno-133-7" href="#__codelineno-133-7"></a><span class="w"> </span><span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="w"> </span><span class="p">(</span><span class="s">&quot; Priority: &quot;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">pt</span><span class="p">.</span><span class="n">PriorityLevel</span><span class="p">);</span>
</span><span id="__span-133-8"><a id="__codelineno-133-8" name="__codelineno-133-8" href="#__codelineno-133-8"></a><span class="w"> </span><span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="w"> </span><span class="p">(</span><span class="s">&quot; Started: &quot;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">pt</span><span class="p">.</span><span class="n">StartTime</span><span class="p">);</span>
</span><span id="__span-133-9"><a id="__codelineno-133-9" name="__codelineno-133-9" href="#__codelineno-133-9"></a><span class="w"> </span><span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="w"> </span><span class="p">(</span><span class="s">&quot; CPU time: &quot;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">pt</span><span class="p">.</span><span class="n">TotalProcessorTime</span><span class="p">);</span>
</span><span id="__span-133-10"><a id="__codelineno-133-10" name="__codelineno-133-10" href="#__codelineno-133-10"></a><span class="w"> </span><span class="p">}</span>
</span><span id="__span-133-11"><a id="__codelineno-133-11" name="__codelineno-133-11" href="#__codelineno-133-11"></a><span class="p">}</span>
</span></code></pre></div>
<h1 id="stacktrace-and-stackframe">StackTrace and StackFrame</h1>
<p>The StackTrace and StackFrame classes provide a read-only view of an execution call stack. You can obtain stack traces for the current thread or an Exception object. Such information is useful mostly for diagnostic purposes, though you also can use it in programming (hacks). StackTrace represents a complete call stack; Stack Frame represents a single method call within that stack.</p>
<p>If you instantiate a StackTrace object with no argumentsâ€”or with a bool argumentâ€”you get a snapshot of the current threadâ€™s call stack. The bool argument, if true, instructs StackTrace to read the assembly .pdb (project debug) files if they are present, giving you access to filename, line number, and column offset data. Project debug files are generated when you compile with the /debug switch. (Visual Studio compiles with this switch unless you request otherwise via Advanced Build Settings.)</p>
<p>After youâ€™ve obtained a StackTrace, you can examine a particular frame by calling GetFrameâ€”or obtain the whole lot by using GetFrames:</p>
<div class="language-csharp highlight"><pre><span></span><code><span id="__span-134-1"><a id="__codelineno-134-1" name="__codelineno-134-1" href="#__codelineno-134-1"></a><span class="k">static</span><span class="w"> </span><span class="k">void</span><span class="w"> </span><span class="nf">Main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">A</span><span class="w"> </span><span class="p">();</span><span class="w"> </span><span class="p">}</span>
</span><span id="__span-134-2"><a id="__codelineno-134-2" name="__codelineno-134-2" href="#__codelineno-134-2"></a><span class="k">static</span><span class="w"> </span><span class="k">void</span><span class="w"> </span><span class="nf">A</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">B</span><span class="w"> </span><span class="p">();</span><span class="w"> </span><span class="p">}</span>
</span><span id="__span-134-3"><a id="__codelineno-134-3" name="__codelineno-134-3" href="#__codelineno-134-3"></a><span class="k">static</span><span class="w"> </span><span class="k">void</span><span class="w"> </span><span class="nf">B</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">C</span><span class="w"> </span><span class="p">();</span><span class="w"> </span><span class="p">}</span>
</span><span id="__span-134-4"><a id="__codelineno-134-4" name="__codelineno-134-4" href="#__codelineno-134-4"></a><span class="k">static</span><span class="w"> </span><span class="k">void</span><span class="w"> </span><span class="nf">C</span><span class="p">()</span>
</span><span id="__span-134-5"><a id="__codelineno-134-5" name="__codelineno-134-5" href="#__codelineno-134-5"></a><span class="p">{</span>
</span><span id="__span-134-6"><a id="__codelineno-134-6" name="__codelineno-134-6" href="#__codelineno-134-6"></a><span class="w"> </span><span class="n">StackTrace</span><span class="w"> </span><span class="n">s</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">StackTrace</span><span class="w"> </span><span class="p">(</span><span class="k">true</span><span class="p">);</span>
</span><span id="__span-134-7"><a id="__codelineno-134-7" name="__codelineno-134-7" href="#__codelineno-134-7"></a><span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="w"> </span><span class="p">(</span><span class="s">&quot;Total frames: &quot;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">s</span><span class="p">.</span><span class="n">FrameCount</span><span class="p">);</span>
</span><span id="__span-134-8"><a id="__codelineno-134-8" name="__codelineno-134-8" href="#__codelineno-134-8"></a><span class="w"> </span><span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="w"> </span><span class="p">(</span><span class="s">&quot;Current method: &quot;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">s</span><span class="p">.</span><span class="n">GetFrame</span><span class="p">(</span><span class="mi">0</span><span class="p">).</span><span class="n">GetMethod</span><span class="p">().</span><span class="n">Name</span><span class="p">);</span>
</span><span id="__span-134-9"><a id="__codelineno-134-9" name="__codelineno-134-9" href="#__codelineno-134-9"></a><span class="w"> </span><span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="w"> </span><span class="p">(</span><span class="s">&quot;Calling method: &quot;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">s</span><span class="p">.</span><span class="n">GetFrame</span><span class="p">(</span><span class="mi">1</span><span class="p">).</span><span class="n">GetMethod</span><span class="p">().</span><span class="n">Name</span><span class="p">);</span>
</span><span id="__span-134-10"><a id="__codelineno-134-10" name="__codelineno-134-10" href="#__codelineno-134-10"></a><span class="w"> </span><span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="w"> </span><span class="p">(</span><span class="s">&quot;Entry method: &quot;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">s</span><span class="p">.</span><span class="n">GetFrame</span>
</span><span id="__span-134-11"><a id="__codelineno-134-11" name="__codelineno-134-11" href="#__codelineno-134-11"></a><span class="w"> </span><span class="p">(</span><span class="n">s</span><span class="p">.</span><span class="n">FrameCount</span><span class="o">-</span><span class="mi">1</span><span class="p">).</span><span class="n">GetMethod</span><span class="p">().</span><span class="n">Name</span><span class="p">);</span>
</span><span id="__span-134-12"><a id="__codelineno-134-12" name="__codelineno-134-12" href="#__codelineno-134-12"></a><span class="w"> </span><span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="w"> </span><span class="p">(</span><span class="s">&quot;Call Stack:&quot;</span><span class="p">);</span>
</span><span id="__span-134-13"><a id="__codelineno-134-13" name="__codelineno-134-13" href="#__codelineno-134-13"></a><span class="w"> </span><span class="k">foreach</span><span class="w"> </span><span class="p">(</span><span class="n">StackFrame</span><span class="w"> </span><span class="n">f</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">s</span><span class="p">.</span><span class="n">GetFrames</span><span class="p">())</span>
</span><span id="__span-134-14"><a id="__codelineno-134-14" name="__codelineno-134-14" href="#__codelineno-134-14"></a><span class="w"> </span><span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="w"> </span><span class="p">(</span>
</span><span id="__span-134-15"><a id="__codelineno-134-15" name="__codelineno-134-15" href="#__codelineno-134-15"></a><span class="w"> </span><span class="s">&quot; File: &quot;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">f</span><span class="p">.</span><span class="n">GetFileName</span><span class="p">()</span><span class="w"> </span><span class="o">+</span>
</span><span id="__span-134-16"><a id="__codelineno-134-16" name="__codelineno-134-16" href="#__codelineno-134-16"></a><span class="w"> </span><span class="s">&quot; Line: &quot;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">f</span><span class="p">.</span><span class="n">GetFileLineNumber</span><span class="p">()</span><span class="w"> </span><span class="o">+</span>
</span><span id="__span-134-17"><a id="__codelineno-134-17" name="__codelineno-134-17" href="#__codelineno-134-17"></a><span class="w"> </span><span class="s">&quot; Col: &quot;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">f</span><span class="p">.</span><span class="n">GetFileColumnNumber</span><span class="p">()</span><span class="w"> </span><span class="o">+</span>
</span><span id="__span-134-18"><a id="__codelineno-134-18" name="__codelineno-134-18" href="#__codelineno-134-18"></a><span class="w"> </span><span class="s">&quot; Offset: &quot;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">f</span><span class="p">.</span><span class="n">GetILOffset</span><span class="p">()</span><span class="w"> </span><span class="o">+</span>
</span><span id="__span-134-19"><a id="__codelineno-134-19" name="__codelineno-134-19" href="#__codelineno-134-19"></a><span class="w"> </span><span class="s">&quot; Method: &quot;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">f</span><span class="p">.</span><span class="n">GetMethod</span><span class="p">().</span><span class="n">Name</span><span class="p">);</span>
</span><span id="__span-134-20"><a id="__codelineno-134-20" name="__codelineno-134-20" href="#__codelineno-134-20"></a><span class="p">}</span>
</span></code></pre></div>
<div class="language-csharp highlight"><pre><span></span><code><span id="__span-135-1"><a id="__codelineno-135-1" name="__codelineno-135-1" href="#__codelineno-135-1"></a><span class="n">Here</span><span class="err">â€™</span><span class="n">s</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">output</span><span class="p">:</span>
</span><span id="__span-135-2"><a id="__codelineno-135-2" name="__codelineno-135-2" href="#__codelineno-135-2"></a><span class="n">Total</span><span class="w"> </span><span class="n">frames</span><span class="p">:</span><span class="w"> </span><span class="mi">4</span>
</span><span id="__span-135-3"><a id="__codelineno-135-3" name="__codelineno-135-3" href="#__codelineno-135-3"></a><span class="n">Current</span><span class="w"> </span><span class="n">method</span><span class="p">:</span><span class="w"> </span><span class="n">C</span>
</span><span id="__span-135-4"><a id="__codelineno-135-4" name="__codelineno-135-4" href="#__codelineno-135-4"></a><span class="n">Calling</span><span class="w"> </span><span class="n">method</span><span class="p">:</span><span class="w"> </span><span class="n">B</span>
</span><span id="__span-135-5"><a id="__codelineno-135-5" name="__codelineno-135-5" href="#__codelineno-135-5"></a><span class="n">Entry</span><span class="w"> </span><span class="n">method</span><span class="p">:</span><span class="w"> </span><span class="n">Main</span>
</span><span id="__span-135-6"><a id="__codelineno-135-6" name="__codelineno-135-6" href="#__codelineno-135-6"></a><span class="n">Call</span><span class="w"> </span><span class="n">stack</span><span class="p">:</span>
</span><span id="__span-135-7"><a id="__codelineno-135-7" name="__codelineno-135-7" href="#__codelineno-135-7"></a><span class="w"> </span><span class="n">File</span><span class="p">:</span><span class="w"> </span><span class="n">C</span><span class="p">:</span><span class="err">\</span><span class="n">Test</span><span class="err">\</span><span class="n">Program</span><span class="p">.</span><span class="n">cs</span><span class="w"> </span><span class="n">Line</span><span class="p">:</span><span class="w"> </span><span class="mi">15</span><span class="w"> </span><span class="n">Col</span><span class="p">:</span><span class="w"> </span><span class="mi">4</span><span class="w"> </span><span class="n">Offset</span><span class="p">:</span><span class="w"> </span><span class="mi">7</span><span class="w"> </span><span class="n">Method</span><span class="p">:</span><span class="w"> </span><span class="n">C</span>
</span><span id="__span-135-8"><a id="__codelineno-135-8" name="__codelineno-135-8" href="#__codelineno-135-8"></a><span class="w"> </span><span class="n">File</span><span class="p">:</span><span class="w"> </span><span class="n">C</span><span class="p">:</span><span class="err">\</span><span class="n">Test</span><span class="err">\</span><span class="n">Program</span><span class="p">.</span><span class="n">cs</span><span class="w"> </span><span class="n">Line</span><span class="p">:</span><span class="w"> </span><span class="mi">12</span><span class="w"> </span><span class="n">Col</span><span class="p">:</span><span class="w"> </span><span class="mi">22</span><span class="w"> </span><span class="n">Offset</span><span class="p">:</span><span class="w"> </span><span class="mi">6</span><span class="w"> </span><span class="n">Method</span><span class="p">:</span><span class="w"> </span><span class="n">B</span>
</span><span id="__span-135-9"><a id="__codelineno-135-9" name="__codelineno-135-9" href="#__codelineno-135-9"></a><span class="w"> </span><span class="n">File</span><span class="p">:</span><span class="w"> </span><span class="n">C</span><span class="p">:</span><span class="err">\</span><span class="n">Test</span><span class="err">\</span><span class="n">Program</span><span class="p">.</span><span class="n">cs</span><span class="w"> </span><span class="n">Line</span><span class="p">:</span><span class="w"> </span><span class="mi">11</span><span class="w"> </span><span class="n">Col</span><span class="p">:</span><span class="w"> </span><span class="mi">22</span><span class="w"> </span><span class="n">Offset</span><span class="p">:</span><span class="w"> </span><span class="mi">6</span><span class="w"> </span><span class="n">Method</span><span class="p">:</span><span class="w"> </span><span class="n">A</span>
</span><span id="__span-135-10"><a id="__codelineno-135-10" name="__codelineno-135-10" href="#__codelineno-135-10"></a><span class="w"> </span><span class="n">File</span><span class="p">:</span><span class="w"> </span><span class="n">C</span><span class="p">:</span><span class="err">\</span><span class="n">Test</span><span class="err">\</span><span class="n">Program</span><span class="p">.</span><span class="n">cs</span><span class="w"> </span><span class="n">Line</span><span class="p">:</span><span class="w"> </span><span class="mi">10</span><span class="w"> </span><span class="n">Col</span><span class="p">:</span><span class="w"> </span><span class="mi">25</span><span class="w"> </span><span class="n">Offset</span><span class="p">:</span><span class="w"> </span><span class="mi">6</span><span class="w"> </span><span class="n">Method</span><span class="p">:</span><span class="w"> </span><span class="n">Main</span>
</span></code></pre></div>
<h1 id="windows-event-logs">Windows Event Logs</h1>
<p>The Win32 platform provides a centralized logging mechanism, in the form of the Windows event logs.</p>
<p>The Debug and Trace classes we used earlier write to a Windows event log if you register an EventLogTraceListener. With the EventLog class, however, you can write directly to a Windows event log without using Trace or Debug. You can also use this class to read and monitor event data.</p>
<aside>
âš ï¸ Writing to the Windows event log makes sense in a Windows Service application, because if something goes wrong, you canâ€™t pop up a user interface directing the user to some special file where diagnostic information has been written. Also, because itâ€™s common practice for services to write to the Windows event log, this is the first place an administrator is likely to look if your service falls over.

</aside>

<p>There are three standard Windows event logs, identified by these names:</p>
<ul>
<li>Application</li>
<li>System</li>
<li>Security</li>
</ul>
<h3 id="writing-to-the-event-log">Writing to the Event Log</h3>
<ul>
<li>Choose one of the three event logs (usually Application).</li>
<li>Decide on a source name and create it if necessary (create requires administrative permissions).</li>
<li>Call EventLog.WriteEntry with the log name, source name, and message data</li>
</ul>
<p>The source name is an easily identifiable name for your application. You must register a source name before you use it the CreateEventSource method performs this function. You can then call WriteEntry:</p>
<div class="language-csharp highlight"><pre><span></span><code><span id="__span-136-1"><a id="__codelineno-136-1" name="__codelineno-136-1" href="#__codelineno-136-1"></a><span class="k">const</span><span class="w"> </span><span class="kt">string</span><span class="w"> </span><span class="n">SourceName</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;MyCompany.WidgetServer&quot;</span><span class="p">;</span>
</span><span id="__span-136-2"><a id="__codelineno-136-2" name="__codelineno-136-2" href="#__codelineno-136-2"></a><span class="c1">// CreateEventSource requires administrative permissions, so this would</span>
</span><span id="__span-136-3"><a id="__codelineno-136-3" name="__codelineno-136-3" href="#__codelineno-136-3"></a><span class="c1">// typically be done in application setup.</span>
</span><span id="__span-136-4"><a id="__codelineno-136-4" name="__codelineno-136-4" href="#__codelineno-136-4"></a><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="n">EventLog</span><span class="p">.</span><span class="n">SourceExists</span><span class="w"> </span><span class="p">(</span><span class="n">SourceName</span><span class="p">))</span>
</span><span id="__span-136-5"><a id="__codelineno-136-5" name="__codelineno-136-5" href="#__codelineno-136-5"></a><span class="w"> </span><span class="n">EventLog</span><span class="p">.</span><span class="n">CreateEventSource</span><span class="w"> </span><span class="p">(</span><span class="n">SourceName</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Application&quot;</span><span class="p">);</span>
</span><span id="__span-136-6"><a id="__codelineno-136-6" name="__codelineno-136-6" href="#__codelineno-136-6"></a><span class="n">EventLog</span><span class="p">.</span><span class="n">WriteEntry</span><span class="w"> </span><span class="p">(</span><span class="n">SourceName</span><span class="p">,</span>
</span><span id="__span-136-7"><a id="__codelineno-136-7" name="__codelineno-136-7" href="#__codelineno-136-7"></a><span class="w"> </span><span class="s">&quot;Service started; using configuration file=...&quot;</span><span class="p">,</span>
</span><span id="__span-136-8"><a id="__codelineno-136-8" name="__codelineno-136-8" href="#__codelineno-136-8"></a><span class="w"> </span><span class="n">EventLogEntryType</span><span class="p">.</span><span class="n">Information</span><span class="p">);</span>
</span></code></pre></div>
<p>EventLogEntryType can be Information, Warning, Error, SuccessAudit, or FailureAudit. Each displays with a different icon in the Windows event viewer. You can also optionally specify a category and event ID (each is a number of your own choosing) and provide optional binary data.</p>
<h3 id="reading-the-event-log">Reading the Event Log</h3>
<p>To read an event log, instantiate the EventLog class with the name of the log that you want to access and optionally the name of another computer on which the log resides. Each log entry can then be read via the Entries collection property:</p>
<div class="language-csharp highlight"><pre><span></span><code><span id="__span-137-1"><a id="__codelineno-137-1" name="__codelineno-137-1" href="#__codelineno-137-1"></a><span class="n">EventLog</span><span class="w"> </span><span class="n">log</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">EventLog</span><span class="w"> </span><span class="p">(</span><span class="s">&quot;Application&quot;</span><span class="p">);</span>
</span><span id="__span-137-2"><a id="__codelineno-137-2" name="__codelineno-137-2" href="#__codelineno-137-2"></a><span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="w"> </span><span class="p">(</span><span class="s">&quot;Total entries: &quot;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">log</span><span class="p">.</span><span class="n">Entries</span><span class="p">.</span><span class="n">Count</span><span class="p">);</span>
</span><span id="__span-137-3"><a id="__codelineno-137-3" name="__codelineno-137-3" href="#__codelineno-137-3"></a><span class="n">EventLogEntry</span><span class="w"> </span><span class="n">last</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">log</span><span class="p">.</span><span class="n">Entries</span><span class="w"> </span><span class="p">[</span><span class="n">log</span><span class="p">.</span><span class="n">Entries</span><span class="p">.</span><span class="n">Count</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">1</span><span class="p">];</span>
</span><span id="__span-137-4"><a id="__codelineno-137-4" name="__codelineno-137-4" href="#__codelineno-137-4"></a><span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="w"> </span><span class="p">(</span><span class="s">&quot;Index: &quot;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">last</span><span class="p">.</span><span class="n">Index</span><span class="p">);</span>
</span><span id="__span-137-5"><a id="__codelineno-137-5" name="__codelineno-137-5" href="#__codelineno-137-5"></a><span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="w"> </span><span class="p">(</span><span class="s">&quot;Source: &quot;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">last</span><span class="p">.</span><span class="n">Source</span><span class="p">);</span>
</span><span id="__span-137-6"><a id="__codelineno-137-6" name="__codelineno-137-6" href="#__codelineno-137-6"></a><span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="w"> </span><span class="p">(</span><span class="s">&quot;Type: &quot;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">last</span><span class="p">.</span><span class="n">EntryType</span><span class="p">);</span>
</span><span id="__span-137-7"><a id="__codelineno-137-7" name="__codelineno-137-7" href="#__codelineno-137-7"></a><span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="w"> </span><span class="p">(</span><span class="s">&quot;Time: &quot;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">last</span><span class="p">.</span><span class="n">TimeWritten</span><span class="p">);</span>
</span><span id="__span-137-8"><a id="__codelineno-137-8" name="__codelineno-137-8" href="#__codelineno-137-8"></a><span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="w"> </span><span class="p">(</span><span class="s">&quot;Message: &quot;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">last</span><span class="p">.</span><span class="n">Message</span><span class="p">);</span>
</span></code></pre></div>
<p>You can enumerate over all logs for the current (or another) computer via the static method <code>EventLog.GetEventLogs()</code></p>
<div class="language-csharp highlight"><pre><span></span><code><span id="__span-138-1"><a id="__codelineno-138-1" name="__codelineno-138-1" href="#__codelineno-138-1"></a><span class="k">foreach</span><span class="w"> </span><span class="p">(</span><span class="n">EventLog</span><span class="w"> </span><span class="n">log</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">EventLog</span><span class="p">.</span><span class="n">GetEventLogs</span><span class="p">())</span>
</span><span id="__span-138-2"><a id="__codelineno-138-2" name="__codelineno-138-2" href="#__codelineno-138-2"></a><span class="w"> </span><span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="w"> </span><span class="p">(</span><span class="n">log</span><span class="p">.</span><span class="n">LogDisplayName</span><span class="p">);</span>
</span></code></pre></div>
<h3 id="monitoring-the-event-log">Monitoring the Event Log</h3>
<p>You can be alerted whenever an entry is written to a Windows event log, via the EntryWritten event. This works for event logs on the local computer, and it fires regardless of what application logged the event.</p>
<div class="language-csharp highlight"><pre><span></span><code><span id="__span-139-1"><a id="__codelineno-139-1" name="__codelineno-139-1" href="#__codelineno-139-1"></a><span class="k">static</span><span class="w"> </span><span class="k">void</span><span class="w"> </span><span class="nf">Main</span><span class="p">()</span>
</span><span id="__span-139-2"><a id="__codelineno-139-2" name="__codelineno-139-2" href="#__codelineno-139-2"></a><span class="p">{</span>
</span><span id="__span-139-3"><a id="__codelineno-139-3" name="__codelineno-139-3" href="#__codelineno-139-3"></a><span class="w"> </span><span class="k">using</span><span class="w"> </span><span class="p">(</span><span class="kt">var</span><span class="w"> </span><span class="n">log</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">EventLog</span><span class="w"> </span><span class="p">(</span><span class="s">&quot;Application&quot;</span><span class="p">))</span>
</span><span id="__span-139-4"><a id="__codelineno-139-4" name="__codelineno-139-4" href="#__codelineno-139-4"></a><span class="w"> </span><span class="p">{</span>
</span><span id="__span-139-5"><a id="__codelineno-139-5" name="__codelineno-139-5" href="#__codelineno-139-5"></a><span class="w"> </span><span class="n">log</span><span class="p">.</span><span class="n">EnableRaisingEvents</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">true</span><span class="p">;</span>
</span><span id="__span-139-6"><a id="__codelineno-139-6" name="__codelineno-139-6" href="#__codelineno-139-6"></a><span class="w"> </span><span class="n">log</span><span class="p">.</span><span class="n">EntryWritten</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="n">DisplayEntry</span><span class="p">;</span>
</span><span id="__span-139-7"><a id="__codelineno-139-7" name="__codelineno-139-7" href="#__codelineno-139-7"></a><span class="w"> </span><span class="n">Console</span><span class="p">.</span><span class="n">ReadLine</span><span class="p">();</span>
</span><span id="__span-139-8"><a id="__codelineno-139-8" name="__codelineno-139-8" href="#__codelineno-139-8"></a><span class="w"> </span><span class="p">}</span>
</span><span id="__span-139-9"><a id="__codelineno-139-9" name="__codelineno-139-9" href="#__codelineno-139-9"></a><span class="p">}</span>
</span><span id="__span-139-10"><a id="__codelineno-139-10" name="__codelineno-139-10" href="#__codelineno-139-10"></a><span class="k">static</span><span class="w"> </span><span class="k">void</span><span class="w"> </span><span class="nf">DisplayEntry</span><span class="w"> </span><span class="p">(</span><span class="kt">object</span><span class="w"> </span><span class="n">sender</span><span class="p">,</span><span class="w"> </span><span class="n">EntryWrittenEventArgs</span><span class="w"> </span><span class="n">e</span><span class="p">)</span>
</span><span id="__span-139-11"><a id="__codelineno-139-11" name="__codelineno-139-11" href="#__codelineno-139-11"></a><span class="p">{</span>
</span><span id="__span-139-12"><a id="__codelineno-139-12" name="__codelineno-139-12" href="#__codelineno-139-12"></a><span class="w"> </span><span class="n">EventLogEntry</span><span class="w"> </span><span class="n">entry</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">e</span><span class="p">.</span><span class="n">Entry</span><span class="p">;</span>
</span><span id="__span-139-13"><a id="__codelineno-139-13" name="__codelineno-139-13" href="#__codelineno-139-13"></a><span class="w"> </span><span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="w"> </span><span class="p">(</span><span class="n">entry</span><span class="p">.</span><span class="n">Message</span><span class="p">);</span>
</span><span id="__span-139-14"><a id="__codelineno-139-14" name="__codelineno-139-14" href="#__codelineno-139-14"></a><span class="p">}</span>
</span></code></pre></div>
<h1 id="performance-counters">Performance Counters</h1>
<p>The logging mechanisms weâ€™ve discussed to date are useful for capturing informaâ€ tion for future analysis. However, to gain insight into the current state of an applicaâ€ tion (or the system as a whole), a more real-time approach is needed. The Win32 solution to this need is the performance-monitoring infrastructure, which consists of a set of performance counters that the system and applications expose, and the Microsoft Management Console (MMC) snap-ins used to monitor these counters in real time.</p>
<p>Performance counters are grouped into categories such as System, Processor, .NET CLR Memory, and so on. These categories are sometimes also referred to as perforâ€ mance objects by the GUI tools. Each category groups a related set of performance counters that monitor one aspect of the system or application. Examples of perforâ€ mance counters in the .NET CLR Memory category include â€œ% Time in GC,â€ â€œ# Bytes in All Heaps,â€ and â€œAllocated bytes/sec.â€</p>
<p>Each category can optionally have one or more instances that can be monitored independently. For example, this is useful in the â€œ% Processor Timeâ€ performance counter in the Processor category, which allows one to monitor CPU utilization. On a multiprocessor machine, this counter supports an instance for each CPU, allowing you to monitor the utilization of each CPU independently</p>
<h3 id="enumerating-the-available-counters">Enumerating the Available Counters</h3>
<p>The following example enumerates over all of the available performance counters on the computer. For those that have instances, it enumerates the counters for each instance:</p>
<div class="language-csharp highlight"><pre><span></span><code><span id="__span-140-1"><a id="__codelineno-140-1" name="__codelineno-140-1" href="#__codelineno-140-1"></a><span class="n">PerformanceCounterCategory</span><span class="p">[]</span><span class="w"> </span><span class="n">cats</span><span class="w"> </span><span class="o">=</span>
</span><span id="__span-140-2"><a id="__codelineno-140-2" name="__codelineno-140-2" href="#__codelineno-140-2"></a><span class="w"> </span><span class="n">PerformanceCounterCategory</span><span class="p">.</span><span class="n">GetCategories</span><span class="p">();</span>
</span><span id="__span-140-3"><a id="__codelineno-140-3" name="__codelineno-140-3" href="#__codelineno-140-3"></a><span class="k">foreach</span><span class="w"> </span><span class="p">(</span><span class="n">PerformanceCounterCategory</span><span class="w"> </span><span class="n">cat</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">cats</span><span class="p">)</span>
</span><span id="__span-140-4"><a id="__codelineno-140-4" name="__codelineno-140-4" href="#__codelineno-140-4"></a><span class="p">{</span>
</span><span id="__span-140-5"><a id="__codelineno-140-5" name="__codelineno-140-5" href="#__codelineno-140-5"></a><span class="w"> </span><span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="w"> </span><span class="p">(</span><span class="s">&quot;Category: &quot;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">cat</span><span class="p">.</span><span class="n">CategoryName</span><span class="p">);</span>
</span><span id="__span-140-6"><a id="__codelineno-140-6" name="__codelineno-140-6" href="#__codelineno-140-6"></a><span class="w"> </span><span class="kt">string</span><span class="p">[]</span><span class="w"> </span><span class="n">instances</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">cat</span><span class="p">.</span><span class="n">GetInstanceNames</span><span class="p">();</span>
</span><span id="__span-140-7"><a id="__codelineno-140-7" name="__codelineno-140-7" href="#__codelineno-140-7"></a><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">instances</span><span class="p">.</span><span class="n">Length</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span>
</span><span id="__span-140-8"><a id="__codelineno-140-8" name="__codelineno-140-8" href="#__codelineno-140-8"></a><span class="w"> </span><span class="p">{</span>
</span><span id="__span-140-9"><a id="__codelineno-140-9" name="__codelineno-140-9" href="#__codelineno-140-9"></a><span class="w"> </span><span class="k">foreach</span><span class="w"> </span><span class="p">(</span><span class="n">PerformanceCounter</span><span class="w"> </span><span class="n">ctr</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">cat</span><span class="p">.</span><span class="n">GetCounters</span><span class="p">())</span>
</span><span id="__span-140-10"><a id="__codelineno-140-10" name="__codelineno-140-10" href="#__codelineno-140-10"></a><span class="w"> </span><span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="w"> </span><span class="p">(</span><span class="s">&quot; Counter: &quot;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">ctr</span><span class="p">.</span><span class="n">CounterName</span><span class="p">);</span>
</span><span id="__span-140-11"><a id="__codelineno-140-11" name="__codelineno-140-11" href="#__codelineno-140-11"></a><span class="w"> </span><span class="p">}</span>
</span><span id="__span-140-12"><a id="__codelineno-140-12" name="__codelineno-140-12" href="#__codelineno-140-12"></a><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="c1">// Dump counters with instances</span>
</span><span id="__span-140-13"><a id="__codelineno-140-13" name="__codelineno-140-13" href="#__codelineno-140-13"></a><span class="w"> </span><span class="p">{</span>
</span><span id="__span-140-14"><a id="__codelineno-140-14" name="__codelineno-140-14" href="#__codelineno-140-14"></a><span class="w"> </span><span class="k">foreach</span><span class="w"> </span><span class="p">(</span><span class="kt">string</span><span class="w"> </span><span class="n">instance</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">instances</span><span class="p">)</span>
</span><span id="__span-140-15"><a id="__codelineno-140-15" name="__codelineno-140-15" href="#__codelineno-140-15"></a><span class="w"> </span><span class="p">{</span>
</span><span id="__span-140-16"><a id="__codelineno-140-16" name="__codelineno-140-16" href="#__codelineno-140-16"></a><span class="w"> </span><span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="w"> </span><span class="p">(</span><span class="s">&quot; Instance: &quot;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">instance</span><span class="p">);</span>
</span><span id="__span-140-17"><a id="__codelineno-140-17" name="__codelineno-140-17" href="#__codelineno-140-17"></a><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">cat</span><span class="p">.</span><span class="n">InstanceExists</span><span class="w"> </span><span class="p">(</span><span class="n">instance</span><span class="p">))</span>
</span><span id="__span-140-18"><a id="__codelineno-140-18" name="__codelineno-140-18" href="#__codelineno-140-18"></a><span class="w"> </span><span class="k">foreach</span><span class="w"> </span><span class="p">(</span><span class="n">PerformanceCounter</span><span class="w"> </span><span class="n">ctr</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">cat</span><span class="p">.</span><span class="n">GetCounters</span><span class="w"> </span><span class="p">(</span><span class="n">instance</span><span class="p">))</span>
</span><span id="__span-140-19"><a id="__codelineno-140-19" name="__codelineno-140-19" href="#__codelineno-140-19"></a><span class="w"> </span><span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="w"> </span><span class="p">(</span><span class="s">&quot; Counter: &quot;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">ctr</span><span class="p">.</span><span class="n">CounterName</span><span class="p">);</span>
</span><span id="__span-140-20"><a id="__codelineno-140-20" name="__codelineno-140-20" href="#__codelineno-140-20"></a><span class="w"> </span><span class="p">}</span>
</span><span id="__span-140-21"><a id="__codelineno-140-21" name="__codelineno-140-21" href="#__codelineno-140-21"></a><span class="w"> </span><span class="p">}</span>
</span><span id="__span-140-22"><a id="__codelineno-140-22" name="__codelineno-140-22" href="#__codelineno-140-22"></a><span class="p">}</span>
</span></code></pre></div>
<h3 id="reading-performance-counter-data">Reading Performance Counter Data</h3>
<p>To retrieve the value of a performance counter, instantiate a PerformanceCounter object and then call the NextValue or NextSample method. NextValue returns a simple float value; NextSample returns a CounterSample object that exposes a more advanced set of properties, such as CounterFrequency, TimeStamp, BaseValue, and RawValue.</p>
<p>PerformanceCounterâ€™s constructor takes a category name, counter name, and optional instance. So, to display the current processor utilization for all CPUs, you would do the following:</p>
<div class="language-csharp highlight"><pre><span></span><code><span id="__span-141-1"><a id="__codelineno-141-1" name="__codelineno-141-1" href="#__codelineno-141-1"></a><span class="k">using</span><span class="w"> </span><span class="nn">PerformanceCounter</span><span class="w"> </span><span class="n">pc</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">PerformanceCounter</span><span class="w"> </span><span class="p">(</span><span class="s">&quot;Processor&quot;</span><span class="p">,</span>
</span><span id="__span-141-2"><a id="__codelineno-141-2" name="__codelineno-141-2" href="#__codelineno-141-2"></a><span class="w"> </span><span class="s">&quot;% Processor Time&quot;</span><span class="p">,</span>
</span><span id="__span-141-3"><a id="__codelineno-141-3" name="__codelineno-141-3" href="#__codelineno-141-3"></a><span class="w"> </span><span class="s">&quot;_Total&quot;</span><span class="p">);</span>
</span><span id="__span-141-4"><a id="__codelineno-141-4" name="__codelineno-141-4" href="#__codelineno-141-4"></a><span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="w"> </span><span class="p">(</span><span class="n">pc</span><span class="p">.</span><span class="n">NextValue</span><span class="p">());</span>
</span></code></pre></div>
<div class="language-csharp highlight"><pre><span></span><code><span id="__span-142-1"><a id="__codelineno-142-1" name="__codelineno-142-1" href="#__codelineno-142-1"></a><span class="kt">string</span><span class="w"> </span><span class="n">procName</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Process</span><span class="p">.</span><span class="n">GetCurrentProcess</span><span class="p">().</span><span class="n">ProcessName</span><span class="p">;</span>
</span><span id="__span-142-2"><a id="__codelineno-142-2" name="__codelineno-142-2" href="#__codelineno-142-2"></a><span class="k">using</span><span class="w"> </span><span class="nn">PerformanceCounter</span><span class="w"> </span><span class="n">pc</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">PerformanceCounter</span><span class="w"> </span><span class="p">(</span><span class="s">&quot;Process&quot;</span><span class="p">,</span>
</span><span id="__span-142-3"><a id="__codelineno-142-3" name="__codelineno-142-3" href="#__codelineno-142-3"></a><span class="w"> </span><span class="s">&quot;Private Bytes&quot;</span><span class="p">,</span>
</span><span id="__span-142-4"><a id="__codelineno-142-4" name="__codelineno-142-4" href="#__codelineno-142-4"></a><span class="w"> </span><span class="n">procName</span><span class="p">);</span>
</span><span id="__span-142-5"><a id="__codelineno-142-5" name="__codelineno-142-5" href="#__codelineno-142-5"></a><span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="w"> </span><span class="p">(</span><span class="n">pc</span><span class="p">.</span><span class="n">NextValue</span><span class="p">());</span>
</span></code></pre></div>
<p>PerformanceCounter doesnâ€™t expose a ValueChanged event, so if you want to moniâ€ tor for changes, you must poll. In the next example, we poll every 200 millisecondsâ€”until signaled to quit by an EventWaitHandle:</p>
<div class="language-csharp highlight"><pre><span></span><code><span id="__span-143-1"><a id="__codelineno-143-1" name="__codelineno-143-1" href="#__codelineno-143-1"></a><span class="c1">// need to import System.Threading as well as System.Diagnostics</span>
</span><span id="__span-143-2"><a id="__codelineno-143-2" name="__codelineno-143-2" href="#__codelineno-143-2"></a><span class="k">static</span><span class="w"> </span><span class="k">void</span><span class="w"> </span><span class="nf">Monitor</span><span class="w"> </span><span class="p">(</span><span class="kt">string</span><span class="w"> </span><span class="n">category</span><span class="p">,</span><span class="w"> </span><span class="kt">string</span><span class="w"> </span><span class="n">counter</span><span class="p">,</span><span class="w"> </span><span class="kt">string</span><span class="w"> </span><span class="n">instance</span><span class="p">,</span>
</span><span id="__span-143-3"><a id="__codelineno-143-3" name="__codelineno-143-3" href="#__codelineno-143-3"></a><span class="w"> </span><span class="n">EventWaitHandle</span><span class="w"> </span><span class="n">stopper</span><span class="p">)</span>
</span><span id="__span-143-4"><a id="__codelineno-143-4" name="__codelineno-143-4" href="#__codelineno-143-4"></a><span class="p">{</span>
</span><span id="__span-143-5"><a id="__codelineno-143-5" name="__codelineno-143-5" href="#__codelineno-143-5"></a><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="n">PerformanceCounterCategory</span><span class="p">.</span><span class="n">Exists</span><span class="w"> </span><span class="p">(</span><span class="n">category</span><span class="p">))</span>
</span><span id="__span-143-6"><a id="__codelineno-143-6" name="__codelineno-143-6" href="#__codelineno-143-6"></a><span class="w"> </span><span class="k">throw</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="nf">InvalidOperationException</span><span class="w"> </span><span class="p">(</span><span class="s">&quot;Category does not exist&quot;</span><span class="p">);</span>
</span><span id="__span-143-7"><a id="__codelineno-143-7" name="__codelineno-143-7" href="#__codelineno-143-7"></a><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="n">PerformanceCounterCategory</span><span class="p">.</span><span class="n">CounterExists</span><span class="w"> </span><span class="p">(</span><span class="n">counter</span><span class="p">,</span><span class="w"> </span><span class="n">category</span><span class="p">))</span>
</span><span id="__span-143-8"><a id="__codelineno-143-8" name="__codelineno-143-8" href="#__codelineno-143-8"></a><span class="w"> </span><span class="k">throw</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="nf">InvalidOperationException</span><span class="w"> </span><span class="p">(</span><span class="s">&quot;Counter does not exist&quot;</span><span class="p">);</span>
</span><span id="__span-143-9"><a id="__codelineno-143-9" name="__codelineno-143-9" href="#__codelineno-143-9"></a><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">instance</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="k">null</span><span class="p">)</span><span class="w"> </span><span class="n">instance</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;&quot;</span><span class="p">;</span><span class="w"> </span><span class="c1">// &quot;&quot; == no instance (not null!)</span>
</span><span id="__span-143-10"><a id="__codelineno-143-10" name="__codelineno-143-10" href="#__codelineno-143-10"></a><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">instance</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="s">&quot;&quot;</span><span class="w"> </span><span class="o">&amp;&amp;</span>
</span><span id="__span-143-11"><a id="__codelineno-143-11" name="__codelineno-143-11" href="#__codelineno-143-11"></a><span class="w"> </span><span class="o">!</span><span class="n">PerformanceCounterCategory</span><span class="p">.</span><span class="n">InstanceExists</span><span class="w"> </span><span class="p">(</span><span class="n">instance</span><span class="p">,</span><span class="w"> </span><span class="n">category</span><span class="p">))</span>
</span><span id="__span-143-12"><a id="__codelineno-143-12" name="__codelineno-143-12" href="#__codelineno-143-12"></a><span class="w"> </span><span class="k">throw</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="nf">InvalidOperationException</span><span class="w"> </span><span class="p">(</span><span class="s">&quot;Instance does not exist&quot;</span><span class="p">);</span>
</span><span id="__span-143-13"><a id="__codelineno-143-13" name="__codelineno-143-13" href="#__codelineno-143-13"></a><span class="w"> </span><span class="kt">float</span><span class="w"> </span><span class="n">lastValue</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0f</span><span class="p">;</span>
</span><span id="__span-143-14"><a id="__codelineno-143-14" name="__codelineno-143-14" href="#__codelineno-143-14"></a><span class="w"> </span><span class="k">using</span><span class="w"> </span><span class="p">(</span><span class="n">PerformanceCounter</span><span class="w"> </span><span class="n">pc</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">PerformanceCounter</span><span class="w"> </span><span class="p">(</span><span class="n">category</span><span class="p">,</span>
</span><span id="__span-143-15"><a id="__codelineno-143-15" name="__codelineno-143-15" href="#__codelineno-143-15"></a><span class="w"> </span><span class="n">counter</span><span class="p">,</span><span class="w"> </span><span class="n">instance</span><span class="p">))</span>
</span><span id="__span-143-16"><a id="__codelineno-143-16" name="__codelineno-143-16" href="#__codelineno-143-16"></a><span class="w"> </span><span class="k">while</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="n">stopper</span><span class="p">.</span><span class="n">WaitOne</span><span class="w"> </span><span class="p">(</span><span class="mi">200</span><span class="p">,</span><span class="w"> </span><span class="k">false</span><span class="p">))</span>
</span><span id="__span-143-17"><a id="__codelineno-143-17" name="__codelineno-143-17" href="#__codelineno-143-17"></a><span class="w"> </span><span class="p">{</span>
</span><span id="__span-143-18"><a id="__codelineno-143-18" name="__codelineno-143-18" href="#__codelineno-143-18"></a><span class="w"> </span><span class="kt">float</span><span class="w"> </span><span class="k">value</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">pc</span><span class="p">.</span><span class="n">NextValue</span><span class="p">();</span>
</span><span id="__span-143-19"><a id="__codelineno-143-19" name="__codelineno-143-19" href="#__codelineno-143-19"></a><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="k">value</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="n">lastValue</span><span class="p">)</span><span class="w"> </span><span class="c1">// Only write out the value</span>
</span><span id="__span-143-20"><a id="__codelineno-143-20" name="__codelineno-143-20" href="#__codelineno-143-20"></a><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="c1">// if it has changed.</span>
</span><span id="__span-143-21"><a id="__codelineno-143-21" name="__codelineno-143-21" href="#__codelineno-143-21"></a><span class="w"> </span><span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="w"> </span><span class="p">(</span><span class="k">value</span><span class="p">);</span>
</span><span id="__span-143-22"><a id="__codelineno-143-22" name="__codelineno-143-22" href="#__codelineno-143-22"></a><span class="w"> </span><span class="n">lastValue</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">value</span><span class="p">;</span>
</span><span id="__span-143-23"><a id="__codelineno-143-23" name="__codelineno-143-23" href="#__codelineno-143-23"></a><span class="w"> </span><span class="p">}</span>
</span><span id="__span-143-24"><a id="__codelineno-143-24" name="__codelineno-143-24" href="#__codelineno-143-24"></a><span class="w"> </span><span class="p">}</span>
</span><span id="__span-143-25"><a id="__codelineno-143-25" name="__codelineno-143-25" href="#__codelineno-143-25"></a><span class="p">}</span>
</span></code></pre></div>
<p>Hereâ€™s how we can use this method to simultaneously monitor processor and harddrive activity:</p>
<div class="language-csharp highlight"><pre><span></span><code><span id="__span-144-1"><a id="__codelineno-144-1" name="__codelineno-144-1" href="#__codelineno-144-1"></a><span class="k">static</span><span class="w"> </span><span class="k">void</span><span class="w"> </span><span class="nf">Main</span><span class="p">()</span>
</span><span id="__span-144-2"><a id="__codelineno-144-2" name="__codelineno-144-2" href="#__codelineno-144-2"></a><span class="p">{</span>
</span><span id="__span-144-3"><a id="__codelineno-144-3" name="__codelineno-144-3" href="#__codelineno-144-3"></a><span class="w"> </span><span class="n">EventWaitHandle</span><span class="w"> </span><span class="n">stopper</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">ManualResetEvent</span><span class="w"> </span><span class="p">(</span><span class="k">false</span><span class="p">);</span>
</span><span id="__span-144-4"><a id="__codelineno-144-4" name="__codelineno-144-4" href="#__codelineno-144-4"></a><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="nf">Thread</span><span class="w"> </span><span class="p">(()</span><span class="w"> </span><span class="o">=&gt;</span>
</span><span id="__span-144-5"><a id="__codelineno-144-5" name="__codelineno-144-5" href="#__codelineno-144-5"></a><span class="w"> </span><span class="n">Monitor</span><span class="w"> </span><span class="p">(</span><span class="s">&quot;Processor&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;% Processor Time&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;_Total&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">stopper</span><span class="p">)</span>
</span><span id="__span-144-6"><a id="__codelineno-144-6" name="__codelineno-144-6" href="#__codelineno-144-6"></a><span class="w"> </span><span class="p">).</span><span class="n">Start</span><span class="p">();</span>
</span><span id="__span-144-7"><a id="__codelineno-144-7" name="__codelineno-144-7" href="#__codelineno-144-7"></a><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="nf">Thread</span><span class="w"> </span><span class="p">(()</span><span class="w"> </span><span class="o">=&gt;</span>
</span><span id="__span-144-8"><a id="__codelineno-144-8" name="__codelineno-144-8" href="#__codelineno-144-8"></a><span class="w"> </span><span class="n">Monitor</span><span class="w"> </span><span class="p">(</span><span class="s">&quot;LogicalDisk&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;% Idle Time&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;C:&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">stopper</span><span class="p">)</span>
</span><span id="__span-144-9"><a id="__codelineno-144-9" name="__codelineno-144-9" href="#__codelineno-144-9"></a><span class="w"> </span><span class="p">).</span><span class="n">Start</span><span class="p">();</span>
</span><span id="__span-144-10"><a id="__codelineno-144-10" name="__codelineno-144-10" href="#__codelineno-144-10"></a><span class="w"> </span><span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="w"> </span><span class="p">(</span><span class="s">&quot;Monitoring - press any key to quit&quot;</span><span class="p">);</span>
</span><span id="__span-144-11"><a id="__codelineno-144-11" name="__codelineno-144-11" href="#__codelineno-144-11"></a><span class="w"> </span><span class="n">Console</span><span class="p">.</span><span class="n">ReadKey</span><span class="p">();</span>
</span><span id="__span-144-12"><a id="__codelineno-144-12" name="__codelineno-144-12" href="#__codelineno-144-12"></a><span class="w"> </span><span class="n">stopper</span><span class="p">.</span><span class="n">Set</span><span class="p">();</span>
</span><span id="__span-144-13"><a id="__codelineno-144-13" name="__codelineno-144-13" href="#__codelineno-144-13"></a><span class="p">}</span>
</span></code></pre></div>
<h1 id="the-stopwatch-class">The Stopwatch Class</h1>
<p>The Stopwatch class provides a convenient mechanism for measuring execution times. Stopwatch uses the highest-resolution mechanism that the OS and hardware provide, which is typically less than a microsecond. (In contrast, DateTime.Now and Environment.TickCount have a resolution of about 15 ms.)</p>
<p>To use Stopwatch, call StartNewâ€”this instantiates a Stopwatch and starts it ticking. (Alternatively, you can instantiate it manually and then call Start.) The Elapsed property returns the elapsed interval as a TimeSpan:</p>
<div class="language-csharp highlight"><pre><span></span><code><span id="__span-145-1"><a id="__codelineno-145-1" name="__codelineno-145-1" href="#__codelineno-145-1"></a><span class="n">Stopwatch</span><span class="w"> </span><span class="n">s</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Stopwatch</span><span class="p">.</span><span class="n">StartNew</span><span class="p">();</span>
</span><span id="__span-145-2"><a id="__codelineno-145-2" name="__codelineno-145-2" href="#__codelineno-145-2"></a><span class="n">System</span><span class="p">.</span><span class="n">IO</span><span class="p">.</span><span class="n">File</span><span class="p">.</span><span class="n">WriteAllText</span><span class="w"> </span><span class="p">(</span><span class="s">&quot;test.txt&quot;</span><span class="p">,</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="kt">string</span><span class="w"> </span><span class="p">(</span><span class="sc">&#39;*&#39;</span><span class="p">,</span><span class="w"> </span><span class="mi">30000000</span><span class="p">));</span>
</span><span id="__span-145-3"><a id="__codelineno-145-3" name="__codelineno-145-3" href="#__codelineno-145-3"></a><span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="w"> </span><span class="p">(</span><span class="n">s</span><span class="p">.</span><span class="n">Elapsed</span><span class="p">);</span><span class="w"> </span><span class="c1">// 00:00:01.4322661</span>
</span><span id="__span-145-4"><a id="__codelineno-145-4" name="__codelineno-145-4" href="#__codelineno-145-4"></a><span class="err">```#</span><span class="w"> </span><span class="n">Chapter</span><span class="w"> </span><span class="mi">14</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="n">Concurrency</span><span class="w"> </span><span class="k">and</span><span class="w"> </span><span class="n">Asynchrony</span>
</span><span id="__span-145-5"><a id="__codelineno-145-5" name="__codelineno-145-5" href="#__codelineno-145-5"></a>
</span><span id="__span-145-6"><a id="__codelineno-145-6" name="__codelineno-145-6" href="#__codelineno-145-6"></a><span class="err">#</span><span class="w"> </span><span class="n">Introduction</span>
</span><span id="__span-145-7"><a id="__codelineno-145-7" name="__codelineno-145-7" href="#__codelineno-145-7"></a>
</span><span id="__span-145-8"><a id="__codelineno-145-8" name="__codelineno-145-8" href="#__codelineno-145-8"></a><span class="n">Following</span><span class="w"> </span><span class="n">are</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">most</span><span class="w"> </span><span class="n">common</span><span class="w"> </span><span class="n">concurrency</span><span class="w"> </span><span class="n">scenarios</span>
</span><span id="__span-145-9"><a id="__codelineno-145-9" name="__codelineno-145-9" href="#__codelineno-145-9"></a>
</span><span id="__span-145-10"><a id="__codelineno-145-10" name="__codelineno-145-10" href="#__codelineno-145-10"></a><span class="o">-</span><span class="w"> </span><span class="n">Writing</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">responsive</span><span class="w"> </span><span class="n">user</span><span class="w"> </span><span class="k">interface</span>
</span><span id="__span-145-11"><a id="__codelineno-145-11" name="__codelineno-145-11" href="#__codelineno-145-11"></a>
</span><span id="__span-145-12"><a id="__codelineno-145-12" name="__codelineno-145-12" href="#__codelineno-145-12"></a><span class="w">    </span><span class="n">In</span><span class="w"> </span><span class="n">WPF</span><span class="p">,</span><span class="w"> </span><span class="n">mobile</span><span class="p">,</span><span class="w"> </span><span class="k">and</span><span class="w"> </span><span class="n">Windows</span><span class="w"> </span><span class="n">Forms</span><span class="w"> </span><span class="n">applications</span><span class="p">,</span><span class="w"> </span><span class="n">you</span><span class="w"> </span><span class="n">must</span><span class="w"> </span><span class="n">run</span><span class="w"> </span><span class="n">timeconsuming</span><span class="w"> </span><span class="n">tasks</span><span class="w"> </span><span class="n">concurrently</span><span class="w"> </span><span class="k">with</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">code</span><span class="w"> </span><span class="n">that</span><span class="w"> </span><span class="n">runs</span><span class="w"> </span><span class="n">your</span><span class="w"> </span><span class="n">user</span><span class="w"> </span><span class="k">interface</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">maintain</span><span class="w"> </span><span class="n">responsiveness</span><span class="p">.</span>
</span><span id="__span-145-13"><a id="__codelineno-145-13" name="__codelineno-145-13" href="#__codelineno-145-13"></a>
</span><span id="__span-145-14"><a id="__codelineno-145-14" name="__codelineno-145-14" href="#__codelineno-145-14"></a><span class="o">-</span><span class="w"> </span><span class="n">Allowing</span><span class="w"> </span><span class="n">requests</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">process</span><span class="w"> </span><span class="n">simultaneously</span>
</span><span id="__span-145-15"><a id="__codelineno-145-15" name="__codelineno-145-15" href="#__codelineno-145-15"></a>
</span><span id="__span-145-16"><a id="__codelineno-145-16" name="__codelineno-145-16" href="#__codelineno-145-16"></a><span class="w">    </span><span class="n">On</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">server</span><span class="p">,</span><span class="w"> </span><span class="n">client</span><span class="w"> </span><span class="n">requests</span><span class="w"> </span><span class="n">can</span><span class="w"> </span><span class="n">arrive</span><span class="w"> </span><span class="n">concurrently</span><span class="w"> </span><span class="k">and</span><span class="w"> </span><span class="n">so</span><span class="w"> </span><span class="n">must</span><span class="w"> </span><span class="n">be</span><span class="w"> </span><span class="n">handled</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">parallel</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">maintain</span><span class="w"> </span><span class="n">scalability</span><span class="p">.</span><span class="w"> </span><span class="n">If</span><span class="w"> </span><span class="n">you</span><span class="w"> </span><span class="n">use</span><span class="w"> </span><span class="p">[</span><span class="n">ASP</span><span class="p">.</span><span class="n">NET</span><span class="p">](</span><span class="n">http</span><span class="p">:</span><span class="c1">//asp.net/) Core or Web API, .NET Core does this for you automatically. However, you still need to be aware of shared state (for instance, the effect of using static variables for caching).</span>
</span><span id="__span-145-17"><a id="__codelineno-145-17" name="__codelineno-145-17" href="#__codelineno-145-17"></a>
</span><span id="__span-145-18"><a id="__codelineno-145-18" name="__codelineno-145-18" href="#__codelineno-145-18"></a><span class="o">-</span><span class="w"> </span><span class="n">Parallel</span><span class="w"> </span><span class="n">programming</span>
</span><span id="__span-145-19"><a id="__codelineno-145-19" name="__codelineno-145-19" href="#__codelineno-145-19"></a>
</span><span id="__span-145-20"><a id="__codelineno-145-20" name="__codelineno-145-20" href="#__codelineno-145-20"></a><span class="w">    </span><span class="n">Code</span><span class="w"> </span><span class="n">that</span><span class="w"> </span><span class="n">performs</span><span class="w"> </span><span class="n">intensive</span><span class="w"> </span><span class="n">calculations</span><span class="w"> </span><span class="n">can</span><span class="w"> </span><span class="n">execute</span><span class="w"> </span><span class="n">faster</span><span class="w"> </span><span class="k">on</span><span class="w"> </span><span class="n">multicore</span><span class="o">/</span><span class="w"> </span><span class="n">multiprocessor</span><span class="w"> </span><span class="n">computers</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">workload</span><span class="w"> </span><span class="k">is</span><span class="w"> </span><span class="n">divided</span><span class="w"> </span><span class="n">between</span><span class="w"> </span><span class="n">cores</span>
</span><span id="__span-145-21"><a id="__codelineno-145-21" name="__codelineno-145-21" href="#__codelineno-145-21"></a>
</span><span id="__span-145-22"><a id="__codelineno-145-22" name="__codelineno-145-22" href="#__codelineno-145-22"></a><span class="o">-</span><span class="w"> </span><span class="n">Speculative</span><span class="w"> </span><span class="n">execution</span>
</span><span id="__span-145-23"><a id="__codelineno-145-23" name="__codelineno-145-23" href="#__codelineno-145-23"></a>
</span><span id="__span-145-24"><a id="__codelineno-145-24" name="__codelineno-145-24" href="#__codelineno-145-24"></a><span class="w">    </span><span class="n">On</span><span class="w"> </span><span class="n">multicore</span><span class="w"> </span><span class="n">machines</span><span class="p">,</span><span class="w"> </span><span class="n">you</span><span class="w"> </span><span class="n">can</span><span class="w"> </span><span class="n">sometimes</span><span class="w"> </span><span class="n">improve</span><span class="w"> </span><span class="n">performance</span><span class="w"> </span><span class="k">by</span><span class="w"> </span><span class="n">predicting</span><span class="w"> </span><span class="n">something</span><span class="w"> </span><span class="n">that</span><span class="w"> </span><span class="n">might</span><span class="w"> </span><span class="n">need</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">be</span><span class="w"> </span><span class="n">done</span><span class="w"> </span><span class="k">and</span><span class="w"> </span><span class="n">then</span><span class="w"> </span><span class="n">doing</span><span class="w"> </span><span class="n">it</span><span class="w"> </span><span class="n">ahead</span><span class="w"> </span><span class="n">of</span><span class="w"> </span><span class="n">time</span><span class="p">.</span><span class="w"> </span><span class="n">LINQPad</span><span class="w"> </span><span class="n">uses</span><span class="w"> </span><span class="k">this</span><span class="w"> </span><span class="n">technique</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">speed</span><span class="w"> </span><span class="n">up</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">creation</span><span class="w"> </span><span class="n">of</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">queries</span><span class="p">.</span><span class="w"> </span><span class="n">A</span><span class="w"> </span><span class="n">variation</span><span class="w"> </span><span class="k">is</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">run</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">number</span><span class="w"> </span><span class="n">of</span><span class="w"> </span><span class="n">different</span><span class="w"> </span><span class="n">algorithms</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">parallel</span><span class="w"> </span><span class="n">that</span><span class="w"> </span><span class="n">all</span><span class="w"> </span><span class="n">solve</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">same</span><span class="w"> </span><span class="n">task</span><span class="p">.</span><span class="w"> </span><span class="n">Whichever</span><span class="w"> </span><span class="n">one</span><span class="w"> </span><span class="n">finishes</span><span class="w"> </span><span class="n">first</span><span class="w"> </span><span class="err">â€œ</span><span class="n">wins</span><span class="err">â€</span><span class="w"> </span><span class="k">this</span><span class="w"> </span><span class="k">is</span><span class="w"> </span><span class="n">effective</span><span class="w"> </span><span class="k">when</span><span class="w"> </span><span class="n">you</span><span class="w"> </span><span class="n">can</span><span class="err">â€™</span><span class="n">t</span><span class="w"> </span><span class="n">know</span><span class="w"> </span><span class="n">ahead</span><span class="w"> </span><span class="n">of</span><span class="w"> </span><span class="n">time</span><span class="w"> </span><span class="n">which</span><span class="w"> </span><span class="n">algorithm</span><span class="w"> </span><span class="n">will</span><span class="w"> </span><span class="n">execute</span><span class="w"> </span><span class="n">fastest</span><span class="p">.</span>
</span><span id="__span-145-25"><a id="__codelineno-145-25" name="__codelineno-145-25" href="#__codelineno-145-25"></a>
</span><span id="__span-145-26"><a id="__codelineno-145-26" name="__codelineno-145-26" href="#__codelineno-145-26"></a>
</span><span id="__span-145-27"><a id="__codelineno-145-27" name="__codelineno-145-27" href="#__codelineno-145-27"></a><span class="err">#</span><span class="w"> </span><span class="n">Threading</span>
</span><span id="__span-145-28"><a id="__codelineno-145-28" name="__codelineno-145-28" href="#__codelineno-145-28"></a>
</span><span id="__span-145-29"><a id="__codelineno-145-29" name="__codelineno-145-29" href="#__codelineno-145-29"></a><span class="n">A</span><span class="w"> </span><span class="n">thread</span><span class="w"> </span><span class="k">is</span><span class="w"> </span><span class="n">an</span><span class="w"> </span><span class="n">execution</span><span class="w"> </span><span class="n">path</span><span class="w"> </span><span class="n">that</span><span class="w"> </span><span class="n">can</span><span class="w"> </span><span class="o">**</span><span class="n">proceed</span><span class="w"> </span><span class="n">independently</span><span class="w"> </span><span class="n">of</span><span class="w"> </span><span class="n">others</span><span class="o">**</span><span class="p">.</span>
</span><span id="__span-145-30"><a id="__codelineno-145-30" name="__codelineno-145-30" href="#__codelineno-145-30"></a>
</span><span id="__span-145-31"><a id="__codelineno-145-31" name="__codelineno-145-31" href="#__codelineno-145-31"></a><span class="n">Each</span><span class="w"> </span><span class="n">thread</span><span class="w"> </span><span class="n">runs</span><span class="w"> </span><span class="n">within</span><span class="w"> </span><span class="n">an</span><span class="w"> </span><span class="n">operating</span><span class="w"> </span><span class="n">system</span><span class="w"> </span><span class="n">process</span><span class="p">,</span><span class="w"> </span><span class="n">which</span><span class="w"> </span><span class="n">provides</span><span class="w"> </span><span class="n">an</span><span class="w"> </span><span class="n">isolated</span><span class="w"> </span><span class="n">environment</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">which</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">program</span><span class="w"> </span><span class="n">runs</span><span class="p">.</span><span class="w"> </span><span class="n">With</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">single</span><span class="o">-</span><span class="n">threaded</span><span class="w"> </span><span class="n">program</span><span class="p">,</span><span class="w"> </span><span class="n">just</span><span class="w"> </span><span class="n">one</span><span class="w"> </span><span class="n">thread</span><span class="w"> </span><span class="n">runs</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">process</span><span class="err">â€™</span><span class="n">s</span><span class="w"> </span><span class="n">isolated</span><span class="w"> </span><span class="n">environment</span><span class="w"> </span><span class="k">and</span><span class="w"> </span><span class="n">so</span><span class="w"> </span><span class="n">that</span><span class="w"> </span><span class="n">thread</span><span class="w"> </span><span class="n">has</span><span class="w"> </span><span class="n">exclusive</span><span class="w"> </span><span class="n">access</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">it</span><span class="p">.</span><span class="w"> </span><span class="o">**</span><span class="n">With</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">multithreaded</span><span class="w"> </span><span class="n">program</span><span class="p">,</span><span class="w"> </span><span class="n">multiple</span><span class="w"> </span><span class="n">threads</span><span class="w"> </span><span class="n">run</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">single</span><span class="w"> </span><span class="n">process</span><span class="p">,</span><span class="w"> </span><span class="n">sharing</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">same</span><span class="w"> </span><span class="n">execution</span><span class="w"> </span><span class="n">environment</span><span class="o">**</span><span class="w"> </span><span class="p">(</span><span class="n">memory</span><span class="p">,</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">particular</span><span class="p">).</span><span class="w"> </span><span class="n">This</span><span class="p">,</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">part</span><span class="p">,</span><span class="w"> </span><span class="k">is</span><span class="w"> </span><span class="n">why</span><span class="w"> </span><span class="n">multithreading</span><span class="w"> </span><span class="k">is</span><span class="w"> </span><span class="n">useful</span><span class="p">:</span><span class="w"> </span><span class="n">one</span><span class="w"> </span><span class="n">thread</span><span class="w"> </span><span class="n">can</span><span class="w"> </span><span class="n">fetch</span><span class="w"> </span><span class="n">data</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">background</span><span class="p">,</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">instance</span><span class="p">,</span><span class="w"> </span><span class="k">while</span><span class="w"> </span><span class="n">another</span><span class="w"> </span><span class="n">thread</span><span class="w"> </span><span class="n">displays</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">data</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">it</span><span class="w"> </span><span class="n">arrives</span><span class="p">.</span><span class="w"> </span><span class="n">This</span><span class="w"> </span><span class="n">data</span><span class="w"> </span><span class="k">is</span><span class="w"> </span><span class="n">referred</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">shared</span><span class="w"> </span><span class="n">state</span><span class="p">.</span>
</span><span id="__span-145-32"><a id="__codelineno-145-32" name="__codelineno-145-32" href="#__codelineno-145-32"></a>
</span><span id="__span-145-33"><a id="__codelineno-145-33" name="__codelineno-145-33" href="#__codelineno-145-33"></a><span class="err">##</span><span class="w"> </span><span class="n">Creating</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">Thread</span>
</span><span id="__span-145-34"><a id="__codelineno-145-34" name="__codelineno-145-34" href="#__codelineno-145-34"></a>
</span><span id="__span-145-35"><a id="__codelineno-145-35" name="__codelineno-145-35" href="#__codelineno-145-35"></a><span class="n">A</span><span class="w"> </span><span class="n">client</span><span class="w"> </span><span class="nf">program</span><span class="w"> </span><span class="p">(</span><span class="n">Console</span><span class="p">,</span><span class="w"> </span><span class="n">WPF</span><span class="p">,</span><span class="w"> </span><span class="n">UWP</span><span class="p">,</span><span class="w"> </span><span class="k">or</span><span class="w"> </span><span class="n">Windows</span><span class="w"> </span><span class="n">Forms</span><span class="p">)</span><span class="w"> </span><span class="n">starts</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">single</span><span class="w"> </span><span class="n">thread</span><span class="w"> </span><span class="n">that</span><span class="err">â€™</span><span class="n">s</span><span class="w"> </span><span class="n">created</span><span class="w"> </span><span class="n">automatically</span><span class="w"> </span><span class="k">by</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">OS</span><span class="w"> </span><span class="p">(</span><span class="n">the</span><span class="w"> </span><span class="err">â€œ</span><span class="n">main</span><span class="err">â€</span><span class="w"> </span><span class="n">thread</span><span class="p">).</span><span class="w"> </span><span class="n">Here</span><span class="w"> </span><span class="n">it</span><span class="w"> </span><span class="n">lives</span><span class="w"> </span><span class="k">out</span><span class="w"> </span><span class="n">its</span><span class="w"> </span><span class="n">life</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">single</span><span class="o">-</span><span class="n">threaded</span><span class="w"> </span><span class="n">application</span><span class="p">,</span><span class="w"> </span><span class="n">unless</span><span class="w"> </span><span class="n">you</span><span class="w"> </span><span class="k">do</span><span class="w"> </span><span class="n">otherwise</span><span class="p">,</span><span class="w"> </span><span class="k">by</span><span class="w"> </span><span class="n">creating</span><span class="w"> </span><span class="n">more</span><span class="w"> </span><span class="n">threads</span>
</span><span id="__span-145-36"><a id="__codelineno-145-36" name="__codelineno-145-36" href="#__codelineno-145-36"></a>
</span><span id="__span-145-37"><a id="__codelineno-145-37" name="__codelineno-145-37" href="#__codelineno-145-37"></a><span class="n">You</span><span class="w"> </span><span class="n">can</span><span class="w"> </span><span class="n">create</span><span class="w"> </span><span class="k">and</span><span class="w"> </span><span class="n">start</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">thread</span><span class="w"> </span><span class="k">by</span><span class="w"> </span><span class="n">instantiating</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">Thread</span><span class="w"> </span><span class="kt">object</span><span class="w"> </span><span class="k">and</span><span class="w"> </span><span class="n">calling</span><span class="w"> </span><span class="n">its</span><span class="w"> </span><span class="n">Start</span><span class="w"> </span><span class="n">method</span><span class="p">.</span><span class="w"> </span><span class="n">The</span><span class="w"> </span><span class="n">simplest</span><span class="w"> </span><span class="n">constructor</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">Thread</span><span class="w"> </span><span class="n">takes</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">ThreadStart</span><span class="w"> </span><span class="k">delegate</span><span class="p">:</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">parameterless</span><span class="w"> </span><span class="n">method</span><span class="w"> </span><span class="n">indicating</span><span class="w"> </span><span class="k">where</span><span class="w"> </span><span class="n">execution</span><span class="w"> </span><span class="n">should</span><span class="w"> </span><span class="n">begin</span><span class="p">.</span>
</span><span id="__span-145-38"><a id="__codelineno-145-38" name="__codelineno-145-38" href="#__codelineno-145-38"></a>
</span><span id="__span-145-39"><a id="__codelineno-145-39" name="__codelineno-145-39" href="#__codelineno-145-39"></a><span class="err">```</span><span class="n">csharp</span>
</span><span id="__span-145-40"><a id="__codelineno-145-40" name="__codelineno-145-40" href="#__codelineno-145-40"></a><span class="c1">// NB: All samples in this chapter assume the following namespace imports:</span>
</span><span id="__span-145-41"><a id="__codelineno-145-41" name="__codelineno-145-41" href="#__codelineno-145-41"></a><span class="k">using</span><span class="w"> </span><span class="nn">System</span><span class="p">;</span>
</span><span id="__span-145-42"><a id="__codelineno-145-42" name="__codelineno-145-42" href="#__codelineno-145-42"></a><span class="k">using</span><span class="w"> </span><span class="nn">System.Threading</span><span class="p">;</span>
</span><span id="__span-145-43"><a id="__codelineno-145-43" name="__codelineno-145-43" href="#__codelineno-145-43"></a><span class="k">class</span><span class="w"> </span><span class="nc">ThreadTest</span>
</span><span id="__span-145-44"><a id="__codelineno-145-44" name="__codelineno-145-44" href="#__codelineno-145-44"></a><span class="p">{</span>
</span><span id="__span-145-45"><a id="__codelineno-145-45" name="__codelineno-145-45" href="#__codelineno-145-45"></a><span class="w"> </span><span class="k">static</span><span class="w"> </span><span class="k">void</span><span class="w"> </span><span class="nf">Main</span><span class="p">()</span>
</span><span id="__span-145-46"><a id="__codelineno-145-46" name="__codelineno-145-46" href="#__codelineno-145-46"></a><span class="w"> </span><span class="p">{</span>
</span><span id="__span-145-47"><a id="__codelineno-145-47" name="__codelineno-145-47" href="#__codelineno-145-47"></a><span class="w"> </span><span class="n">Thread</span><span class="w"> </span><span class="n">t</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">Thread</span><span class="w"> </span><span class="p">(</span><span class="n">WriteY</span><span class="p">);</span><span class="w"> </span><span class="c1">// Kick off a new thread</span>
</span><span id="__span-145-48"><a id="__codelineno-145-48" name="__codelineno-145-48" href="#__codelineno-145-48"></a><span class="w"> </span><span class="n">t</span><span class="p">.</span><span class="n">Start</span><span class="p">();</span><span class="w"> </span><span class="c1">// running WriteY()</span>
</span><span id="__span-145-49"><a id="__codelineno-145-49" name="__codelineno-145-49" href="#__codelineno-145-49"></a><span class="w"> </span><span class="c1">// Simultaneously, do something on the main thread.</span>
</span><span id="__span-145-50"><a id="__codelineno-145-50" name="__codelineno-145-50" href="#__codelineno-145-50"></a><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mi">1000</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="o">++</span><span class="p">)</span><span class="w"> </span><span class="n">Console</span><span class="p">.</span><span class="n">Write</span><span class="w"> </span><span class="p">(</span><span class="s">&quot;x&quot;</span><span class="p">);</span><span class="n">Thread</span><span class="p">.</span><span class="n">Sleep</span><span class="p">(</span><span class="mi">100</span><span class="p">);}</span>
</span><span id="__span-145-51"><a id="__codelineno-145-51" name="__codelineno-145-51" href="#__codelineno-145-51"></a><span class="w"> </span><span class="k">static</span><span class="w"> </span><span class="k">void</span><span class="w"> </span><span class="nf">WriteY</span><span class="p">()</span>
</span><span id="__span-145-52"><a id="__codelineno-145-52" name="__codelineno-145-52" href="#__codelineno-145-52"></a><span class="w"> </span><span class="p">{</span>
</span><span id="__span-145-53"><a id="__codelineno-145-53" name="__codelineno-145-53" href="#__codelineno-145-53"></a><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mi">1000</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="o">++</span><span class="p">)</span><span class="w"> </span><span class="n">Console</span><span class="p">.</span><span class="n">Write</span><span class="w"> </span><span class="p">(</span><span class="s">&quot;y&quot;</span><span class="p">);</span><span class="n">Thread</span><span class="p">.</span><span class="n">Sleep</span><span class="p">(</span><span class="mi">100</span><span class="p">);</span>
</span><span id="__span-145-54"><a id="__codelineno-145-54" name="__codelineno-145-54" href="#__codelineno-145-54"></a><span class="w"> </span><span class="p">}</span>
</span><span id="__span-145-55"><a id="__codelineno-145-55" name="__codelineno-145-55" href="#__codelineno-145-55"></a><span class="p">}</span>
</span><span id="__span-145-56"><a id="__codelineno-145-56" name="__codelineno-145-56" href="#__codelineno-145-56"></a><span class="c1">// Typical Output:</span>
</span><span id="__span-145-57"><a id="__codelineno-145-57" name="__codelineno-145-57" href="#__codelineno-145-57"></a><span class="n">xxxxxxxxxxxxxxxxyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyy</span>
</span><span id="__span-145-58"><a id="__codelineno-145-58" name="__codelineno-145-58" href="#__codelineno-145-58"></a><span class="n">xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxyyyyyyyyyyyyy</span>
</span><span id="__span-145-59"><a id="__codelineno-145-59" name="__codelineno-145-59" href="#__codelineno-145-59"></a><span class="n">yyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyxxxxxxxxxxxxxxxxxxxxxx</span>
</span><span id="__span-145-60"><a id="__codelineno-145-60" name="__codelineno-145-60" href="#__codelineno-145-60"></a><span class="n">xxxxxxxxxxxxxxxxxxxxxxyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyy</span>
</span><span id="__span-145-61"><a id="__codelineno-145-61" name="__codelineno-145-61" href="#__codelineno-145-61"></a><span class="n">yyyyyyyyyyyyyxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx</span>
</span><span id="__span-145-62"><a id="__codelineno-145-62" name="__codelineno-145-62" href="#__codelineno-145-62"></a><span class="p">...</span>
</span></code></pre></div>
<p>The main thread creates a new thread t on which it runs a method that repeatedly prints the character y. Simultaneously, the main thread repeatedly prints the character x, as shown in Figure 14-1. On a single-core computer, the operating system must allocate â€œslicesâ€ of time to each thread (typically 20 ms in Windows) to simulate concurrency, resulting in repeated blocks of x and y. On a multicore or multiprocessor machine, the two threads can genuinely execute in parallel (subject to competition by other active processes on the computer), although you still get repeated blocks of x and y in this example because of subtleties in the mechanism by which Console handles concurrent requests.</p>
<p>After itâ€™s started, a threadâ€™s IsAlive property returns true, until the point at which the thread ends. A thread ends when the delegate passed to the Threadâ€™s constructor finishes executing. After itâ€™s ended, a thread cannot restart.</p>
<p>Each thread has a Name property that you can set for the benefit of debugging. This is particularly useful in Visual Studio because the threadâ€™s name is displayed in the Threads Window and Debug Location toolbar. You can set a threadâ€™s name just once; attempts to change it later will throw an exception. The static <code>Thread.CurrentThread</code> property gives you the currently executing thread:</p>
<div class="language-csharp highlight"><pre><span></span><code><span id="__span-146-1"><a id="__codelineno-146-1" name="__codelineno-146-1" href="#__codelineno-146-1"></a><span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="w"> </span><span class="p">(</span><span class="n">Thread</span><span class="p">.</span><span class="n">CurrentThread</span><span class="p">.</span><span class="n">Name</span><span class="p">);</span>
</span></code></pre></div>
<h2 id="join-and-sleep">Join and Sleep</h2>
<p>You can wait for another thread to end by calling its Join method</p>
<div class="language-csharp highlight"><pre><span></span><code><span id="__span-147-1"><a id="__codelineno-147-1" name="__codelineno-147-1" href="#__codelineno-147-1"></a><span class="k">static</span><span class="w"> </span><span class="k">void</span><span class="w"> </span><span class="nf">Main</span><span class="p">()</span>
</span><span id="__span-147-2"><a id="__codelineno-147-2" name="__codelineno-147-2" href="#__codelineno-147-2"></a><span class="p">{</span>
</span><span id="__span-147-3"><a id="__codelineno-147-3" name="__codelineno-147-3" href="#__codelineno-147-3"></a><span class="w"> </span><span class="n">Thread</span><span class="w"> </span><span class="n">t</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">Thread</span><span class="w"> </span><span class="p">(</span><span class="n">Go</span><span class="p">);</span>
</span><span id="__span-147-4"><a id="__codelineno-147-4" name="__codelineno-147-4" href="#__codelineno-147-4"></a><span class="w"> </span><span class="n">t</span><span class="p">.</span><span class="n">Start</span><span class="p">();</span>
</span><span id="__span-147-5"><a id="__codelineno-147-5" name="__codelineno-147-5" href="#__codelineno-147-5"></a><span class="w"> </span><span class="n">t</span><span class="p">.</span><span class="n">Join</span><span class="p">();</span>
</span><span id="__span-147-6"><a id="__codelineno-147-6" name="__codelineno-147-6" href="#__codelineno-147-6"></a><span class="w"> </span><span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="w"> </span><span class="p">(</span><span class="s">&quot;Thread t has ended!&quot;</span><span class="p">);</span>
</span><span id="__span-147-7"><a id="__codelineno-147-7" name="__codelineno-147-7" href="#__codelineno-147-7"></a><span class="p">}</span>
</span><span id="__span-147-8"><a id="__codelineno-147-8" name="__codelineno-147-8" href="#__codelineno-147-8"></a><span class="k">static</span><span class="w"> </span><span class="k">void</span><span class="w"> </span><span class="nf">Go</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mi">1000</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="o">++</span><span class="p">)</span><span class="w"> </span><span class="n">Console</span><span class="p">.</span><span class="n">Write</span><span class="w"> </span><span class="p">(</span><span class="s">&quot;y&quot;</span><span class="p">);</span><span class="w"> </span><span class="p">}</span>
</span></code></pre></div>
<p>This prints â€œyâ€ 1,000 times, followed by â€œThread t has ended!â€ immediately afterâ€ ward. You can include a timeout when calling Join, either in milliseconds or as a TimeSpan. It then returns true if the thread ended or false if it timed out.</p>
<p>Thread.Sleep pauses the current thread for a specified period:</p>
<div class="language-csharp highlight"><pre><span></span><code><span id="__span-148-1"><a id="__codelineno-148-1" name="__codelineno-148-1" href="#__codelineno-148-1"></a><span class="n">Thread</span><span class="p">.</span><span class="n">Sleep</span><span class="w"> </span><span class="p">(</span><span class="n">TimeSpan</span><span class="p">.</span><span class="n">FromHours</span><span class="w"> </span><span class="p">(</span><span class="mi">1</span><span class="p">));</span><span class="w"> </span><span class="c1">// Sleep for 1 hour</span>
</span><span id="__span-148-2"><a id="__codelineno-148-2" name="__codelineno-148-2" href="#__codelineno-148-2"></a><span class="n">Thread</span><span class="p">.</span><span class="n">Sleep</span><span class="w"> </span><span class="p">(</span><span class="mi">500</span><span class="p">);</span><span class="w"> </span><span class="c1">// Sleep for 500 milliseconds</span>
</span></code></pre></div>
<p>Thread.Sleep(0) relinquishes the threadâ€™s current time slice immediately, voluntarily handing over the CPU to other threads. Thread.Yield() does the same thing except that it relinquishes only to threads running on the same processor</p>
<p>While waiting on a Sleep or Join, a thread is blocked.</p>
<h2 id="blocking">Blocking</h2>
<p>A thread is deemed blocked when its execution is paused for some reason, such as when Sleeping or waiting for another to end via Join. A blocked thread immediately yields its processor time slice, and from then on it consumes no processor time until its blocking condition is satisfied. You can test for a thread being blocked via its ThreadState property:</p>
<div class="language-csharp highlight"><pre><span></span><code><span id="__span-149-1"><a id="__codelineno-149-1" name="__codelineno-149-1" href="#__codelineno-149-1"></a><span class="kt">bool</span><span class="w"> </span><span class="n">blocked</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">someThread</span><span class="p">.</span><span class="n">ThreadState</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="n">ThreadState</span><span class="p">.</span><span class="n">WaitSleepJoin</span><span class="p">)</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
</span></code></pre></div>
<p>ThreadState is a flags enum, combining three â€œlayersâ€ of data in a bitwise fashion. Most values, however, are redundant, unused, or deprecated. The following extension method strips a ThreadState to one of four useful values: Unstarted, Running, WaitSleepJoin, and Stopped:</p>
<div class="language-csharp highlight"><pre><span></span><code><span id="__span-150-1"><a id="__codelineno-150-1" name="__codelineno-150-1" href="#__codelineno-150-1"></a><span class="k">public</span><span class="w"> </span><span class="k">static</span><span class="w"> </span><span class="n">ThreadState</span><span class="w"> </span><span class="nf">Simplify</span><span class="w"> </span><span class="p">(</span><span class="k">this</span><span class="w"> </span><span class="n">ThreadState</span><span class="w"> </span><span class="n">ts</span><span class="p">)</span>
</span><span id="__span-150-2"><a id="__codelineno-150-2" name="__codelineno-150-2" href="#__codelineno-150-2"></a><span class="p">{</span>
</span><span id="__span-150-3"><a id="__codelineno-150-3" name="__codelineno-150-3" href="#__codelineno-150-3"></a><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="n">ts</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="p">(</span><span class="n">ThreadState</span><span class="p">.</span><span class="n">Unstarted</span><span class="w"> </span><span class="o">|</span>
</span><span id="__span-150-4"><a id="__codelineno-150-4" name="__codelineno-150-4" href="#__codelineno-150-4"></a><span class="w"> </span><span class="n">ThreadState</span><span class="p">.</span><span class="n">WaitSleepJoin</span><span class="w"> </span><span class="o">|</span>
</span><span id="__span-150-5"><a id="__codelineno-150-5" name="__codelineno-150-5" href="#__codelineno-150-5"></a><span class="w"> </span><span class="n">ThreadState</span><span class="p">.</span><span class="n">Stopped</span><span class="p">);</span>
</span><span id="__span-150-6"><a id="__codelineno-150-6" name="__codelineno-150-6" href="#__codelineno-150-6"></a><span class="p">}</span>
</span></code></pre></div>
<p>The ThreadState property is useful for diagnostic purposes but unsuitable for synchronization, because a threadâ€™s state can change in between testing ThreadState and acting on that information.</p>
<p>When a thread blocks or unblocks, the OS performs a context switch. This incurs a small overhead, typically one or two microseconds.</p>
<h3 id="io-bound-versus-compute-bound">I/O-bound versus compute-bound</h3>
<p>An operation that spends most of its time waiting for something to happen is called I/O-boundâ€”an example is downloading a web page or calling Console.ReadLine. (I/O-bound operations typically involve input or output, but this is not a hard requirement: Thread.Sleep is also deemed I/O-bound.) In contrast, an operation that spends most of its time performing CPU-intensive work is called compute-bound.</p>
<h3 id="blocking-versus-spinning">Blocking versus spinning</h3>
<p>An I/O-bound operation works in one of two ways: it either waits synchronously on the current thread until the operation is complete (such as Console.ReadLine, Thread.Sleep, or Thread.Join), or operates asynchronously, firing a callback when the operation finishes some time thereafter (more on this later).</p>
<p>I/O-bound operations that wait synchronously spend most of their time blocking a thread. They can also â€œspinâ€ in a loop periodically:</p>
<div class="language-csharp highlight"><pre><span></span><code><span id="__span-151-1"><a id="__codelineno-151-1" name="__codelineno-151-1" href="#__codelineno-151-1"></a><span class="k">while</span><span class="w"> </span><span class="p">(</span><span class="n">DateTime</span><span class="p">.</span><span class="n">Now</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">nextStartTime</span><span class="p">)</span>
</span><span id="__span-151-2"><a id="__codelineno-151-2" name="__codelineno-151-2" href="#__codelineno-151-2"></a><span class="w"> </span><span class="n">Thread</span><span class="p">.</span><span class="n">Sleep</span><span class="w"> </span><span class="p">(</span><span class="mi">100</span><span class="p">);</span>
</span></code></pre></div>
<p>Leaving aside that there are better ways to do this (such as timers or signaling conâ€ structs), another option is that a thread can spin continuously:</p>
<div class="language-csharp highlight"><pre><span></span><code><span id="__span-152-1"><a id="__codelineno-152-1" name="__codelineno-152-1" href="#__codelineno-152-1"></a><span class="k">while</span><span class="w"> </span><span class="p">(</span><span class="n">DateTime</span><span class="p">.</span><span class="n">Now</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">nextStartTime</span><span class="p">);</span>
</span></code></pre></div>
<p>In general, this is very wasteful on processor time: as far as the CLR and OS are concerned, the thread is performing an important calculation and thus is allocated resources accordingly. In effect, weâ€™ve turned what should be an I/O-bound operation into a compute-bound operation.</p>
<aside>
ðŸ‘‰ðŸ¿ There are a couple of nuances with regard to spinning versus blocking. First, spinning very briefly can be effective when you expect a condition to be satisfied soon (perhaps within a few microseconds) because it avoids the overhead and latency of a context switch.

</aside>

<aside>
ðŸ‘‰ðŸ¿ Second, blocking does not incur a zero cost. This is because each thread ties up around 1 MB of memory for as long as it lives and causes an ongoing administrative overhead for the CLR and OS. For this reason, blocking can be troublesome in the context of heavily I/O-bound programs that need to handle hundreds or thousands of concurrent operations. Instead, such programs need to use a callback-based approach, rescinding their thread entirely while waiting.

</aside>

<h2 id="local-versus-shared-state">Local versus Shared State</h2>
<p>The CLR assigns each thread its own memory stack so that local variables are kept separate. In the next example, we define a method with a local variable and then call the method simultaneously on the main thread and a newly created thread:</p>
<div class="language-csharp highlight"><pre><span></span><code><span id="__span-153-1"><a id="__codelineno-153-1" name="__codelineno-153-1" href="#__codelineno-153-1"></a><span class="k">static</span><span class="w"> </span><span class="k">void</span><span class="w"> </span><span class="nf">Main</span><span class="p">()</span>
</span><span id="__span-153-2"><a id="__codelineno-153-2" name="__codelineno-153-2" href="#__codelineno-153-2"></a><span class="p">{</span>
</span><span id="__span-153-3"><a id="__codelineno-153-3" name="__codelineno-153-3" href="#__codelineno-153-3"></a><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="nf">Thread</span><span class="w"> </span><span class="p">(</span><span class="n">Go</span><span class="p">).</span><span class="n">Start</span><span class="p">();</span><span class="w"> </span><span class="c1">// Call Go() on a new thread</span>
</span><span id="__span-153-4"><a id="__codelineno-153-4" name="__codelineno-153-4" href="#__codelineno-153-4"></a><span class="w"> </span><span class="n">Go</span><span class="p">();</span><span class="w"> </span><span class="c1">// Call Go() on the main thread</span>
</span><span id="__span-153-5"><a id="__codelineno-153-5" name="__codelineno-153-5" href="#__codelineno-153-5"></a><span class="p">}</span>
</span><span id="__span-153-6"><a id="__codelineno-153-6" name="__codelineno-153-6" href="#__codelineno-153-6"></a><span class="k">static</span><span class="w"> </span><span class="k">void</span><span class="w"> </span><span class="nf">Go</span><span class="p">()</span>
</span><span id="__span-153-7"><a id="__codelineno-153-7" name="__codelineno-153-7" href="#__codelineno-153-7"></a><span class="p">{</span>
</span><span id="__span-153-8"><a id="__codelineno-153-8" name="__codelineno-153-8" href="#__codelineno-153-8"></a><span class="w"> </span><span class="c1">// Declare and use a local variable - &#39;cycles&#39;</span>
</span><span id="__span-153-9"><a id="__codelineno-153-9" name="__codelineno-153-9" href="#__codelineno-153-9"></a><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">cycles</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">cycles</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mi">5</span><span class="p">;</span><span class="w"> </span><span class="n">cycles</span><span class="o">++</span><span class="p">)</span><span class="w"> </span><span class="n">Console</span><span class="p">.</span><span class="n">Write</span><span class="w"> </span><span class="p">(</span><span class="sc">&#39;?&#39;</span><span class="p">);</span>
</span><span id="__span-153-10"><a id="__codelineno-153-10" name="__codelineno-153-10" href="#__codelineno-153-10"></a><span class="p">}</span>
</span></code></pre></div>
<p>A separate copy of the cycles variable is created on each threadâ€™s memory stack, and so the output is, predictably, 10 question marks</p>
<p>Threads share data if they have a common reference to the same object instance:</p>
<div class="language-csharp highlight"><pre><span></span><code><span id="__span-154-1"><a id="__codelineno-154-1" name="__codelineno-154-1" href="#__codelineno-154-1"></a><span class="k">class</span><span class="w"> </span><span class="nc">ThreadTest</span>
</span><span id="__span-154-2"><a id="__codelineno-154-2" name="__codelineno-154-2" href="#__codelineno-154-2"></a><span class="p">{</span>
</span><span id="__span-154-3"><a id="__codelineno-154-3" name="__codelineno-154-3" href="#__codelineno-154-3"></a><span class="w"> </span><span class="kt">bool</span><span class="w"> </span><span class="n">_done</span><span class="p">;</span>
</span><span id="__span-154-4"><a id="__codelineno-154-4" name="__codelineno-154-4" href="#__codelineno-154-4"></a><span class="w"> </span><span class="k">static</span><span class="w"> </span><span class="k">void</span><span class="w"> </span><span class="nf">Main</span><span class="p">()</span>
</span><span id="__span-154-5"><a id="__codelineno-154-5" name="__codelineno-154-5" href="#__codelineno-154-5"></a><span class="w"> </span><span class="p">{</span>
</span><span id="__span-154-6"><a id="__codelineno-154-6" name="__codelineno-154-6" href="#__codelineno-154-6"></a><span class="w"> </span><span class="n">ThreadTest</span><span class="w"> </span><span class="n">tt</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">ThreadTest</span><span class="p">();</span><span class="w"> </span><span class="c1">// Create a common instance</span>
</span><span id="__span-154-7"><a id="__codelineno-154-7" name="__codelineno-154-7" href="#__codelineno-154-7"></a><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="nf">Thread</span><span class="w"> </span><span class="p">(</span><span class="n">tt</span><span class="p">.</span><span class="n">Go</span><span class="p">).</span><span class="n">Start</span><span class="p">();</span>
</span><span id="__span-154-8"><a id="__codelineno-154-8" name="__codelineno-154-8" href="#__codelineno-154-8"></a><span class="w"> </span><span class="n">tt</span><span class="p">.</span><span class="n">Go</span><span class="p">();</span>
</span><span id="__span-154-9"><a id="__codelineno-154-9" name="__codelineno-154-9" href="#__codelineno-154-9"></a><span class="w"> </span><span class="p">}</span>
</span><span id="__span-154-10"><a id="__codelineno-154-10" name="__codelineno-154-10" href="#__codelineno-154-10"></a><span class="w"> </span><span class="k">void</span><span class="w"> </span><span class="nf">Go</span><span class="p">()</span><span class="w"> </span><span class="c1">// Note that this is an instance method</span>
</span><span id="__span-154-11"><a id="__codelineno-154-11" name="__codelineno-154-11" href="#__codelineno-154-11"></a><span class="w"> </span><span class="p">{</span>
</span><span id="__span-154-12"><a id="__codelineno-154-12" name="__codelineno-154-12" href="#__codelineno-154-12"></a><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="n">_done</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">_done</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">true</span><span class="p">;</span><span class="w"> </span><span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="w"> </span><span class="p">(</span><span class="s">&quot;Done&quot;</span><span class="p">);</span><span class="w"> </span><span class="p">}</span>
</span><span id="__span-154-13"><a id="__codelineno-154-13" name="__codelineno-154-13" href="#__codelineno-154-13"></a><span class="p">}</span>
</span><span id="__span-154-14"><a id="__codelineno-154-14" name="__codelineno-154-14" href="#__codelineno-154-14"></a><span class="p">}</span>
</span></code></pre></div>
<p>Because both threads call Go() on the same ThreadTest instance, they share the _done field. This results in â€œDoneâ€ being printed once instead of twice.</p>
<p>Local variables captured by a lambda expression or anonymous delegate are conâ€ verted by the compiler into fields and so can also be shared</p>
<div class="language-csharp highlight"><pre><span></span><code><span id="__span-155-1"><a id="__codelineno-155-1" name="__codelineno-155-1" href="#__codelineno-155-1"></a><span class="k">static</span><span class="w"> </span><span class="k">void</span><span class="w"> </span><span class="nf">Main</span><span class="p">()</span>
</span><span id="__span-155-2"><a id="__codelineno-155-2" name="__codelineno-155-2" href="#__codelineno-155-2"></a><span class="p">{</span>
</span><span id="__span-155-3"><a id="__codelineno-155-3" name="__codelineno-155-3" href="#__codelineno-155-3"></a><span class="w"> </span><span class="kt">bool</span><span class="w"> </span><span class="n">done</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">false</span><span class="p">;</span>
</span><span id="__span-155-4"><a id="__codelineno-155-4" name="__codelineno-155-4" href="#__codelineno-155-4"></a><span class="w"> </span><span class="n">ThreadStart</span><span class="w"> </span><span class="n">action</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="o">=&gt;</span>
</span><span id="__span-155-5"><a id="__codelineno-155-5" name="__codelineno-155-5" href="#__codelineno-155-5"></a><span class="w"> </span><span class="p">{</span>
</span><span id="__span-155-6"><a id="__codelineno-155-6" name="__codelineno-155-6" href="#__codelineno-155-6"></a><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="n">done</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">done</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">true</span><span class="p">;</span><span class="w"> </span><span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="w"> </span><span class="p">(</span><span class="s">&quot;Done&quot;</span><span class="p">);</span><span class="w"> </span><span class="p">}</span>
</span><span id="__span-155-7"><a id="__codelineno-155-7" name="__codelineno-155-7" href="#__codelineno-155-7"></a><span class="w"> </span><span class="p">};</span>
</span><span id="__span-155-8"><a id="__codelineno-155-8" name="__codelineno-155-8" href="#__codelineno-155-8"></a><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="nf">Thread</span><span class="w"> </span><span class="p">(</span><span class="n">action</span><span class="p">).</span><span class="n">Start</span><span class="p">();</span>
</span><span id="__span-155-9"><a id="__codelineno-155-9" name="__codelineno-155-9" href="#__codelineno-155-9"></a><span class="w"> </span><span class="n">action</span><span class="p">();</span>
</span><span id="__span-155-10"><a id="__codelineno-155-10" name="__codelineno-155-10" href="#__codelineno-155-10"></a><span class="p">}</span>
</span></code></pre></div>
<p>Static fields offer another way to share data between threads:</p>
<div class="language-csharp highlight"><pre><span></span><code><span id="__span-156-1"><a id="__codelineno-156-1" name="__codelineno-156-1" href="#__codelineno-156-1"></a><span class="k">class</span><span class="w"> </span><span class="nc">ThreadTest</span>
</span><span id="__span-156-2"><a id="__codelineno-156-2" name="__codelineno-156-2" href="#__codelineno-156-2"></a><span class="p">{</span>
</span><span id="__span-156-3"><a id="__codelineno-156-3" name="__codelineno-156-3" href="#__codelineno-156-3"></a><span class="w"> </span><span class="k">static</span><span class="w"> </span><span class="kt">bool</span><span class="w"> </span><span class="n">_done</span><span class="p">;</span><span class="w"> </span><span class="c1">// Static fields are shared between all threads</span>
</span><span id="__span-156-4"><a id="__codelineno-156-4" name="__codelineno-156-4" href="#__codelineno-156-4"></a><span class="w"> </span><span class="c1">// in the same application domain.</span>
</span><span id="__span-156-5"><a id="__codelineno-156-5" name="__codelineno-156-5" href="#__codelineno-156-5"></a><span class="w"> </span><span class="k">static</span><span class="w"> </span><span class="k">void</span><span class="w"> </span><span class="nf">Main</span><span class="p">()</span>
</span><span id="__span-156-6"><a id="__codelineno-156-6" name="__codelineno-156-6" href="#__codelineno-156-6"></a><span class="w"> </span><span class="p">{</span>
</span><span id="__span-156-7"><a id="__codelineno-156-7" name="__codelineno-156-7" href="#__codelineno-156-7"></a><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="nf">Thread</span><span class="w"> </span><span class="p">(</span><span class="n">Go</span><span class="p">).</span><span class="n">Start</span><span class="p">();</span>
</span><span id="__span-156-8"><a id="__codelineno-156-8" name="__codelineno-156-8" href="#__codelineno-156-8"></a><span class="w"> </span><span class="n">Go</span><span class="p">();</span>
</span><span id="__span-156-9"><a id="__codelineno-156-9" name="__codelineno-156-9" href="#__codelineno-156-9"></a><span class="w"> </span><span class="p">}</span>
</span><span id="__span-156-10"><a id="__codelineno-156-10" name="__codelineno-156-10" href="#__codelineno-156-10"></a><span class="w"> </span><span class="k">static</span><span class="w"> </span><span class="k">void</span><span class="w"> </span><span class="nf">Go</span><span class="p">()</span>
</span><span id="__span-156-11"><a id="__codelineno-156-11" name="__codelineno-156-11" href="#__codelineno-156-11"></a><span class="w"> </span><span class="p">{</span>
</span><span id="__span-156-12"><a id="__codelineno-156-12" name="__codelineno-156-12" href="#__codelineno-156-12"></a><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="n">_done</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">_done</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">true</span><span class="p">;</span><span class="w"> </span><span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="w"> </span><span class="p">(</span><span class="s">&quot;Done&quot;</span><span class="p">);</span><span class="w"> </span><span class="p">}</span>
</span><span id="__span-156-13"><a id="__codelineno-156-13" name="__codelineno-156-13" href="#__codelineno-156-13"></a><span class="w"> </span><span class="p">}</span>
</span><span id="__span-156-14"><a id="__codelineno-156-14" name="__codelineno-156-14" href="#__codelineno-156-14"></a><span class="p">}</span>
</span></code></pre></div>
<p>All three examples illustrate another key concept: that of thread safety (or rather, lack of it!). The output is actually indeterminate: itâ€™s possible (though unlikely) that â€œDoneâ€ could be printed twice. If, however, we swap the order of statements in the Go method, the odds of â€œDoneâ€ being printed twice go up dramatically</p>
<div class="language-csharp highlight"><pre><span></span><code><span id="__span-157-1"><a id="__codelineno-157-1" name="__codelineno-157-1" href="#__codelineno-157-1"></a><span class="k">static</span><span class="w"> </span><span class="k">void</span><span class="w"> </span><span class="nf">Go</span><span class="p">()</span>
</span><span id="__span-157-2"><a id="__codelineno-157-2" name="__codelineno-157-2" href="#__codelineno-157-2"></a><span class="p">{</span>
</span><span id="__span-157-3"><a id="__codelineno-157-3" name="__codelineno-157-3" href="#__codelineno-157-3"></a><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="n">_done</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="w"> </span><span class="p">(</span><span class="s">&quot;Done&quot;</span><span class="p">);</span><span class="w"> </span><span class="n">_done</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">true</span><span class="p">;</span><span class="w"> </span><span class="p">}</span>
</span><span id="__span-157-4"><a id="__codelineno-157-4" name="__codelineno-157-4" href="#__codelineno-157-4"></a><span class="p">}</span>
</span></code></pre></div>
<p>The problem is that one thread can be evaluating the if statement at exactly the same time as the other thread is executing the WriteLine statementâ€”before itâ€™s had a chance to set done to true.</p>
<aside>
ðŸ’¡ Our example illustrates one of many ways that shared writable state can introduce the kind of intermittent errors for which multithreading is notorious. Next, we look at how to fix our program by locking; however, itâ€™s better to avoid shared state altogether where possible. We see later how asynchronous programming patterns help with this.

</aside>

<h2 id="locking-and-thread-safety"><strong>Locking and Thread Safety</strong></h2>
<p>We can fix the previous example by obtaining an exclusive lock while reading and writing to the shared field. C# provides the <strong>lock</strong> statement for just this purpose:</p>
<div class="language-csharp highlight"><pre><span></span><code><span id="__span-158-1"><a id="__codelineno-158-1" name="__codelineno-158-1" href="#__codelineno-158-1"></a><span class="k">class</span><span class="w"> </span><span class="nc">ThreadSafe</span>
</span><span id="__span-158-2"><a id="__codelineno-158-2" name="__codelineno-158-2" href="#__codelineno-158-2"></a><span class="p">{</span>
</span><span id="__span-158-3"><a id="__codelineno-158-3" name="__codelineno-158-3" href="#__codelineno-158-3"></a><span class="w"> </span><span class="k">static</span><span class="w"> </span><span class="kt">bool</span><span class="w"> </span><span class="n">_done</span><span class="p">;</span>
</span><span id="__span-158-4"><a id="__codelineno-158-4" name="__codelineno-158-4" href="#__codelineno-158-4"></a><span class="w"> </span><span class="k">static</span><span class="w"> </span><span class="k">readonly</span><span class="w"> </span><span class="kt">object</span><span class="w"> </span><span class="n">_locker</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="kt">object</span><span class="p">();</span>
</span><span id="__span-158-5"><a id="__codelineno-158-5" name="__codelineno-158-5" href="#__codelineno-158-5"></a><span class="w"> </span><span class="k">static</span><span class="w"> </span><span class="k">void</span><span class="w"> </span><span class="nf">Main</span><span class="p">()</span>
</span><span id="__span-158-6"><a id="__codelineno-158-6" name="__codelineno-158-6" href="#__codelineno-158-6"></a><span class="w"> </span><span class="p">{</span>
</span><span id="__span-158-7"><a id="__codelineno-158-7" name="__codelineno-158-7" href="#__codelineno-158-7"></a><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="nf">Thread</span><span class="w"> </span><span class="p">(</span><span class="n">Go</span><span class="p">).</span><span class="n">Start</span><span class="p">();</span>
</span><span id="__span-158-8"><a id="__codelineno-158-8" name="__codelineno-158-8" href="#__codelineno-158-8"></a><span class="w"> </span><span class="n">Go</span><span class="p">();</span>
</span><span id="__span-158-9"><a id="__codelineno-158-9" name="__codelineno-158-9" href="#__codelineno-158-9"></a><span class="w"> </span><span class="p">}</span>
</span><span id="__span-158-10"><a id="__codelineno-158-10" name="__codelineno-158-10" href="#__codelineno-158-10"></a><span class="w"> </span><span class="k">static</span><span class="w"> </span><span class="k">void</span><span class="w"> </span><span class="nf">Go</span><span class="p">()</span>
</span><span id="__span-158-11"><a id="__codelineno-158-11" name="__codelineno-158-11" href="#__codelineno-158-11"></a><span class="w"> </span><span class="p">{</span>
</span><span id="__span-158-12"><a id="__codelineno-158-12" name="__codelineno-158-12" href="#__codelineno-158-12"></a><span class="w"> </span><span class="k">lock</span><span class="w"> </span><span class="p">(</span><span class="n">_locker</span><span class="p">)</span>
</span><span id="__span-158-13"><a id="__codelineno-158-13" name="__codelineno-158-13" href="#__codelineno-158-13"></a><span class="w"> </span><span class="p">{</span>
</span><span id="__span-158-14"><a id="__codelineno-158-14" name="__codelineno-158-14" href="#__codelineno-158-14"></a><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="n">_done</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="w"> </span><span class="p">(</span><span class="s">&quot;Done&quot;</span><span class="p">);</span><span class="w"> </span><span class="n">_done</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">true</span><span class="p">;</span><span class="w"> </span><span class="p">}</span>
</span><span id="__span-158-15"><a id="__codelineno-158-15" name="__codelineno-158-15" href="#__codelineno-158-15"></a><span class="w"> </span><span class="p">}</span>
</span><span id="__span-158-16"><a id="__codelineno-158-16" name="__codelineno-158-16" href="#__codelineno-158-16"></a><span class="w"> </span><span class="p">}</span>
</span><span id="__span-158-17"><a id="__codelineno-158-17" name="__codelineno-158-17" href="#__codelineno-158-17"></a><span class="p">}</span>
</span></code></pre></div>
<p>When two threads simultaneously contend a lock (which can be upon any reference-type object; in this case, _locker), one thread waits, or blocks, until the lock becomes available. In this case, it ensures that only one thread can enter its code block at a time, and â€œDoneâ€ will be printed just once. Code thatâ€™s protected in such a mannerâ€”from indeterminacy in a multithreaded contextâ€”is called thread-safe.</p>
<aside>
ðŸ’¡ Even the act of autoincrementing a variable is not thread-safe: the expression x++ executes on the underlying processor as distinct read-increment-write operations. So, if two threads execute x++ at once outside a lock, the variable can end up getâ€ ting incremented once rather than twice (

</aside>

<p>Locking is not a silver bullet for thread safetyâ€”itâ€™s easy to forget to lock around accessing a field, and locking can create problems of its own (such as deadlocking).</p>
<h2 id="passing-data-to-a-thread">Passing Data to a Thread</h2>
<p>Sometimes, youâ€™ll want to pass arguments to the threadâ€™s startup method. The easiest way to do this is with a lambda expression that calls the method with the desired arguments:</p>
<div class="language-csharp highlight"><pre><span></span><code><span id="__span-159-1"><a id="__codelineno-159-1" name="__codelineno-159-1" href="#__codelineno-159-1"></a><span class="k">static</span><span class="w"> </span><span class="k">void</span><span class="w"> </span><span class="nf">Main</span><span class="p">()</span>
</span><span id="__span-159-2"><a id="__codelineno-159-2" name="__codelineno-159-2" href="#__codelineno-159-2"></a><span class="p">{</span>
</span><span id="__span-159-3"><a id="__codelineno-159-3" name="__codelineno-159-3" href="#__codelineno-159-3"></a><span class="w"> </span><span class="n">Thread</span><span class="w"> </span><span class="n">t</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">Thread</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="n">Print</span><span class="w"> </span><span class="p">(</span><span class="s">&quot;Hello from t!&quot;</span><span class="p">)</span><span class="w"> </span><span class="p">);</span>
</span><span id="__span-159-4"><a id="__codelineno-159-4" name="__codelineno-159-4" href="#__codelineno-159-4"></a><span class="w"> </span><span class="n">t</span><span class="p">.</span><span class="n">Start</span><span class="p">();</span>
</span><span id="__span-159-5"><a id="__codelineno-159-5" name="__codelineno-159-5" href="#__codelineno-159-5"></a><span class="p">}</span>
</span><span id="__span-159-6"><a id="__codelineno-159-6" name="__codelineno-159-6" href="#__codelineno-159-6"></a><span class="k">static</span><span class="w"> </span><span class="k">void</span><span class="w"> </span><span class="nf">Print</span><span class="w"> </span><span class="p">(</span><span class="kt">string</span><span class="w"> </span><span class="n">message</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="w"> </span><span class="p">(</span><span class="n">message</span><span class="p">);</span><span class="w"> </span><span class="p">}</span>
</span></code></pre></div>
<p>With this approach, you can pass in any number of arguments to the method. You can even wrap the entire implementation in a multistatement lambda:</p>
<div class="language-csharp highlight"><pre><span></span><code><span id="__span-160-1"><a id="__codelineno-160-1" name="__codelineno-160-1" href="#__codelineno-160-1"></a><span class="k">new</span><span class="w"> </span><span class="nf">Thread</span><span class="w"> </span><span class="p">(()</span><span class="w"> </span><span class="o">=&gt;</span>
</span><span id="__span-160-2"><a id="__codelineno-160-2" name="__codelineno-160-2" href="#__codelineno-160-2"></a><span class="p">{</span>
</span><span id="__span-160-3"><a id="__codelineno-160-3" name="__codelineno-160-3" href="#__codelineno-160-3"></a><span class="w"> </span><span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="w"> </span><span class="p">(</span><span class="s">&quot;I&#39;m running on another thread!&quot;</span><span class="p">);</span>
</span><span id="__span-160-4"><a id="__codelineno-160-4" name="__codelineno-160-4" href="#__codelineno-160-4"></a><span class="w"> </span><span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="w"> </span><span class="p">(</span><span class="s">&quot;This is so easy!&quot;</span><span class="p">);</span>
</span><span id="__span-160-5"><a id="__codelineno-160-5" name="__codelineno-160-5" href="#__codelineno-160-5"></a><span class="p">}).</span><span class="n">Start</span><span class="p">();</span>
</span></code></pre></div>
<p>An alternative (and less flexible) technique is to pass an argument into Threadâ€™s Start method:</p>
<div class="language-csharp highlight"><pre><span></span><code><span id="__span-161-1"><a id="__codelineno-161-1" name="__codelineno-161-1" href="#__codelineno-161-1"></a><span class="k">static</span><span class="w"> </span><span class="k">void</span><span class="w"> </span><span class="nf">Main</span><span class="p">()</span>
</span><span id="__span-161-2"><a id="__codelineno-161-2" name="__codelineno-161-2" href="#__codelineno-161-2"></a><span class="p">{</span>
</span><span id="__span-161-3"><a id="__codelineno-161-3" name="__codelineno-161-3" href="#__codelineno-161-3"></a><span class="w"> </span><span class="n">Thread</span><span class="w"> </span><span class="n">t</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">Thread</span><span class="w"> </span><span class="p">(</span><span class="n">Print</span><span class="p">);</span>
</span><span id="__span-161-4"><a id="__codelineno-161-4" name="__codelineno-161-4" href="#__codelineno-161-4"></a><span class="w"> </span><span class="n">t</span><span class="p">.</span><span class="n">Start</span><span class="w"> </span><span class="p">(</span><span class="s">&quot;Hello from t!&quot;</span><span class="p">);</span>
</span><span id="__span-161-5"><a id="__codelineno-161-5" name="__codelineno-161-5" href="#__codelineno-161-5"></a><span class="p">}</span>
</span><span id="__span-161-6"><a id="__codelineno-161-6" name="__codelineno-161-6" href="#__codelineno-161-6"></a><span class="k">static</span><span class="w"> </span><span class="k">void</span><span class="w"> </span><span class="nf">Print</span><span class="w"> </span><span class="p">(</span><span class="kt">object</span><span class="w"> </span><span class="n">messageObj</span><span class="p">)</span>
</span><span id="__span-161-7"><a id="__codelineno-161-7" name="__codelineno-161-7" href="#__codelineno-161-7"></a><span class="p">{</span>
</span><span id="__span-161-8"><a id="__codelineno-161-8" name="__codelineno-161-8" href="#__codelineno-161-8"></a><span class="w"> </span><span class="kt">string</span><span class="w"> </span><span class="n">message</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="kt">string</span><span class="p">)</span><span class="w"> </span><span class="n">messageObj</span><span class="p">;</span><span class="w"> </span><span class="c1">// We need to cast here</span>
</span><span id="__span-161-9"><a id="__codelineno-161-9" name="__codelineno-161-9" href="#__codelineno-161-9"></a><span class="w"> </span><span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="w"> </span><span class="p">(</span><span class="n">message</span><span class="p">);</span>
</span><span id="__span-161-10"><a id="__codelineno-161-10" name="__codelineno-161-10" href="#__codelineno-161-10"></a><span class="p">}</span>
</span></code></pre></div>
<h3 id="lambda-expressions-and-captured-variables">Lambda expressions and captured variables</h3>
<p>As we saw, a lambda expression is the most convenient and powerful way to pass data to a thread. However, you must be careful about accidentally modifying captured variables after starting the thread.</p>
<div class="language-csharp highlight"><pre><span></span><code><span id="__span-162-1"><a id="__codelineno-162-1" name="__codelineno-162-1" href="#__codelineno-162-1"></a><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mi">10</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="o">++</span><span class="p">)</span>
</span><span id="__span-162-2"><a id="__codelineno-162-2" name="__codelineno-162-2" href="#__codelineno-162-2"></a><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="nf">Thread</span><span class="w"> </span><span class="p">(()</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="n">Console</span><span class="p">.</span><span class="n">Write</span><span class="w"> </span><span class="p">(</span><span class="n">i</span><span class="p">)).</span><span class="n">Start</span><span class="p">();</span>
</span><span id="__span-162-3"><a id="__codelineno-162-3" name="__codelineno-162-3" href="#__codelineno-162-3"></a><span class="c1">//The output is nondeterministic! Hereâ€™s a typical result:</span>
</span><span id="__span-162-4"><a id="__codelineno-162-4" name="__codelineno-162-4" href="#__codelineno-162-4"></a><span class="mi">0223557799</span>
</span></code></pre></div>
<p>The problem is that the i variable refers to the same memory location throughout the loopâ€™s lifetime. Therefore, each thread calls Console.Write on a variable whose value can change as it is running! The solution is to use a temporary variable as follows:</p>
<div class="language-csharp highlight"><pre><span></span><code><span id="__span-163-1"><a id="__codelineno-163-1" name="__codelineno-163-1" href="#__codelineno-163-1"></a><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mi">10</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="o">++</span><span class="p">)</span>
</span><span id="__span-163-2"><a id="__codelineno-163-2" name="__codelineno-163-2" href="#__codelineno-163-2"></a><span class="p">{</span>
</span><span id="__span-163-3"><a id="__codelineno-163-3" name="__codelineno-163-3" href="#__codelineno-163-3"></a><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">temp</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">i</span><span class="p">;</span>
</span><span id="__span-163-4"><a id="__codelineno-163-4" name="__codelineno-163-4" href="#__codelineno-163-4"></a><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="nf">Thread</span><span class="w"> </span><span class="p">(()</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="n">Console</span><span class="p">.</span><span class="n">Write</span><span class="w"> </span><span class="p">(</span><span class="n">temp</span><span class="p">)).</span><span class="n">Start</span><span class="p">();</span>
</span><span id="__span-163-5"><a id="__codelineno-163-5" name="__codelineno-163-5" href="#__codelineno-163-5"></a><span class="p">}</span>
</span></code></pre></div>
<p>Variable temp is now local to each loop iteration. Therefore, each thread captures a different memory location and thereâ€™s no problem.</p>
<h2 id="exception-handling">Exception Handling</h2>
<p>Any try/catch/finally blocks in effect when a thread is created are of no relevance to the thread when it starts executing. Consider the following program:</p>
<div class="language-csharp highlight"><pre><span></span><code><span id="__span-164-1"><a id="__codelineno-164-1" name="__codelineno-164-1" href="#__codelineno-164-1"></a><span class="k">public</span><span class="w"> </span><span class="k">static</span><span class="w"> </span><span class="k">void</span><span class="w"> </span><span class="nf">Main</span><span class="p">()</span>
</span><span id="__span-164-2"><a id="__codelineno-164-2" name="__codelineno-164-2" href="#__codelineno-164-2"></a><span class="p">{</span>
</span><span id="__span-164-3"><a id="__codelineno-164-3" name="__codelineno-164-3" href="#__codelineno-164-3"></a><span class="w"> </span><span class="k">try</span>
</span><span id="__span-164-4"><a id="__codelineno-164-4" name="__codelineno-164-4" href="#__codelineno-164-4"></a><span class="w"> </span><span class="p">{</span>
</span><span id="__span-164-5"><a id="__codelineno-164-5" name="__codelineno-164-5" href="#__codelineno-164-5"></a><span class="k">new</span><span class="w"> </span><span class="nf">Thread</span><span class="w"> </span><span class="p">(</span><span class="n">Go</span><span class="p">).</span><span class="n">Start</span><span class="p">();</span>
</span><span id="__span-164-6"><a id="__codelineno-164-6" name="__codelineno-164-6" href="#__codelineno-164-6"></a><span class="w"> </span><span class="p">}</span>
</span><span id="__span-164-7"><a id="__codelineno-164-7" name="__codelineno-164-7" href="#__codelineno-164-7"></a><span class="w"> </span><span class="k">catch</span><span class="w"> </span><span class="p">(</span><span class="n">Exception</span><span class="w"> </span><span class="n">ex</span><span class="p">)</span>
</span><span id="__span-164-8"><a id="__codelineno-164-8" name="__codelineno-164-8" href="#__codelineno-164-8"></a><span class="w"> </span><span class="p">{</span>
</span><span id="__span-164-9"><a id="__codelineno-164-9" name="__codelineno-164-9" href="#__codelineno-164-9"></a><span class="w"> </span><span class="c1">// We&#39;ll never get here!</span>
</span><span id="__span-164-10"><a id="__codelineno-164-10" name="__codelineno-164-10" href="#__codelineno-164-10"></a><span class="w"> </span><span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="w"> </span><span class="p">(</span><span class="s">&quot;Exception!&quot;</span><span class="p">);</span>
</span><span id="__span-164-11"><a id="__codelineno-164-11" name="__codelineno-164-11" href="#__codelineno-164-11"></a><span class="w"> </span><span class="p">}</span>
</span><span id="__span-164-12"><a id="__codelineno-164-12" name="__codelineno-164-12" href="#__codelineno-164-12"></a><span class="p">}</span>
</span><span id="__span-164-13"><a id="__codelineno-164-13" name="__codelineno-164-13" href="#__codelineno-164-13"></a><span class="k">static</span><span class="w"> </span><span class="k">void</span><span class="w"> </span><span class="nf">Go</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">throw</span><span class="w"> </span><span class="k">null</span><span class="p">;</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="c1">// Throws a NullReferenceException</span>
</span></code></pre></div>
<p>The try/catch statement in this example is ineffective, and the newly created thread will be encumbered with an unhandled NullReferenceException. This behavior makes sense when you consider that each thread has an independent execution path.</p>
<p>The remedy is to move the exception handler into the Go method:</p>
<div class="language-csharp highlight"><pre><span></span><code><span id="__span-165-1"><a id="__codelineno-165-1" name="__codelineno-165-1" href="#__codelineno-165-1"></a><span class="k">public</span><span class="w"> </span><span class="k">static</span><span class="w"> </span><span class="k">void</span><span class="w"> </span><span class="nf">Main</span><span class="p">()</span>
</span><span id="__span-165-2"><a id="__codelineno-165-2" name="__codelineno-165-2" href="#__codelineno-165-2"></a><span class="p">{</span>
</span><span id="__span-165-3"><a id="__codelineno-165-3" name="__codelineno-165-3" href="#__codelineno-165-3"></a><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="nf">Thread</span><span class="w"> </span><span class="p">(</span><span class="n">Go</span><span class="p">).</span><span class="n">Start</span><span class="p">();</span>
</span><span id="__span-165-4"><a id="__codelineno-165-4" name="__codelineno-165-4" href="#__codelineno-165-4"></a><span class="p">}</span>
</span><span id="__span-165-5"><a id="__codelineno-165-5" name="__codelineno-165-5" href="#__codelineno-165-5"></a><span class="k">static</span><span class="w"> </span><span class="k">void</span><span class="w"> </span><span class="nf">Go</span><span class="p">()</span>
</span><span id="__span-165-6"><a id="__codelineno-165-6" name="__codelineno-165-6" href="#__codelineno-165-6"></a><span class="p">{</span>
</span><span id="__span-165-7"><a id="__codelineno-165-7" name="__codelineno-165-7" href="#__codelineno-165-7"></a><span class="w"> </span><span class="k">try</span>
</span><span id="__span-165-8"><a id="__codelineno-165-8" name="__codelineno-165-8" href="#__codelineno-165-8"></a><span class="w"> </span><span class="p">{</span>
</span><span id="__span-165-9"><a id="__codelineno-165-9" name="__codelineno-165-9" href="#__codelineno-165-9"></a><span class="w"> </span><span class="p">...</span>
</span><span id="__span-165-10"><a id="__codelineno-165-10" name="__codelineno-165-10" href="#__codelineno-165-10"></a><span class="w"> </span><span class="k">throw</span><span class="w"> </span><span class="k">null</span><span class="p">;</span><span class="w"> </span><span class="c1">// The NullReferenceException will get caught below</span>
</span><span id="__span-165-11"><a id="__codelineno-165-11" name="__codelineno-165-11" href="#__codelineno-165-11"></a><span class="w"> </span><span class="p">...</span>
</span><span id="__span-165-12"><a id="__codelineno-165-12" name="__codelineno-165-12" href="#__codelineno-165-12"></a><span class="w"> </span><span class="p">}</span>
</span><span id="__span-165-13"><a id="__codelineno-165-13" name="__codelineno-165-13" href="#__codelineno-165-13"></a><span class="w"> </span><span class="k">catch</span><span class="w"> </span><span class="p">(</span><span class="n">Exception</span><span class="w"> </span><span class="n">ex</span><span class="p">)</span>
</span><span id="__span-165-14"><a id="__codelineno-165-14" name="__codelineno-165-14" href="#__codelineno-165-14"></a><span class="w"> </span><span class="p">{</span>
</span><span id="__span-165-15"><a id="__codelineno-165-15" name="__codelineno-165-15" href="#__codelineno-165-15"></a><span class="w"> </span><span class="c1">// Typically log the exception, and/or signal another thread</span>
</span><span id="__span-165-16"><a id="__codelineno-165-16" name="__codelineno-165-16" href="#__codelineno-165-16"></a><span class="w"> </span><span class="c1">// that we&#39;ve come unstuck</span>
</span><span id="__span-165-17"><a id="__codelineno-165-17" name="__codelineno-165-17" href="#__codelineno-165-17"></a><span class="w"> </span><span class="p">...</span>
</span><span id="__span-165-18"><a id="__codelineno-165-18" name="__codelineno-165-18" href="#__codelineno-165-18"></a><span class="w"> </span><span class="p">}</span>
</span><span id="__span-165-19"><a id="__codelineno-165-19" name="__codelineno-165-19" href="#__codelineno-165-19"></a><span class="p">}</span>
</span></code></pre></div>
<p>You need an exception handler on all thread entry methods in production applicaâ€ tionsâ€”just as you do (usually at a higher level, in the execution stack) on your main thread. An unhandled exception causes the whole application to shut downâ€”with an ugly dialog box!</p>
<aside>
ðŸ’¡ In writing such exception handling blocks, rarely would you ignore the error: typically, youâ€™d log the details of the exception. For a client application you might display a dialog box allowing the user to automatically submit those details to your web server. You then might choose to restart the application, because itâ€™s possible that an unexpected exception might leave your program in an invalid state.

</aside>

<h3 id="centralized-exception-handling">Centralized exception handling</h3>
<p>In WPF, UWP, and Windows Forms applications, you can subscribe to global exception handling events, Application.DispatcherUnhandledException, and Application.ThreadException, respectively. These fire after an unhandled excepâ€ tion in any part of your program thatâ€™s called via the message loop (this amounts to all code that runs on the main thread while the Application is active). This is useful as a backstop for logging and reporting bugs (although it wonâ€™t fire for unhandled exceptions on non-UI threads that you create). Handling these events prevents the program from shutting down, although you may choose to restart the application to avoid the potential corruption of state that can follow from (or that led to) the unhandled exception.</p>
<h3 id="foreground-versus-background-threads">Foreground versus Background Threads</h3>
<p>By default, threads you create explicitly are foreground threads. Foreground threads keep the application alive for as long as any one of them is running, whereas backâ€ ground threads do not. After all foreground threads finish, the application ends, and any background threads still running abruptly terminate.</p>
<p>You can query or change a threadâ€™s background status using its IsBackground property:</p>
<div class="language-csharp highlight"><pre><span></span><code><span id="__span-166-1"><a id="__codelineno-166-1" name="__codelineno-166-1" href="#__codelineno-166-1"></a><span class="k">static</span><span class="w"> </span><span class="k">void</span><span class="w"> </span><span class="nf">Main</span><span class="w"> </span><span class="p">(</span><span class="kt">string</span><span class="p">[]</span><span class="w"> </span><span class="n">args</span><span class="p">)</span>
</span><span id="__span-166-2"><a id="__codelineno-166-2" name="__codelineno-166-2" href="#__codelineno-166-2"></a><span class="p">{</span>
</span><span id="__span-166-3"><a id="__codelineno-166-3" name="__codelineno-166-3" href="#__codelineno-166-3"></a><span class="w"> </span><span class="n">Thread</span><span class="w"> </span><span class="n">worker</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">Thread</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="n">Console</span><span class="p">.</span><span class="n">ReadLine</span><span class="p">()</span><span class="w"> </span><span class="p">);</span>
</span><span id="__span-166-4"><a id="__codelineno-166-4" name="__codelineno-166-4" href="#__codelineno-166-4"></a><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">args</span><span class="p">.</span><span class="n">Length</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="n">worker</span><span class="p">.</span><span class="n">IsBackground</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">true</span><span class="p">;</span>
</span><span id="__span-166-5"><a id="__codelineno-166-5" name="__codelineno-166-5" href="#__codelineno-166-5"></a><span class="w"> </span><span class="n">worker</span><span class="p">.</span><span class="n">Start</span><span class="p">();</span>
</span><span id="__span-166-6"><a id="__codelineno-166-6" name="__codelineno-166-6" href="#__codelineno-166-6"></a><span class="p">}</span>
</span></code></pre></div>
<p>If this program is called with no arguments, the worker thread assumes foreground status and will wait on the ReadLine statement for the user to press Enter. Meanâ€ while, the main thread exits, but the application keeps running because a foreâ€ ground thread is still alive. On the other hand, if an argument is passed to Main(), the worker is assigned background status, and the program exits almost immediately as the main thread ends (terminating the ReadLine).</p>
<p>When a process terminates in this manner, any finally blocks in the execution stack of background threads are circumvented. If your program employs finally (or using) blocks to perform cleanup work such as deleting temporary files, you can avoid this by explicitly waiting out such background threads upon exiting an application, either by joining the thread, or with a signaling construct</p>
<h2 id="thread-priority">Thread Priority</h2>
<p>A threadâ€™s Priority property determines how much execution time it is allotted relâ€ ative to other active threads in the OS, on the following scale:</p>
<div class="language-csharp highlight"><pre><span></span><code><span id="__span-167-1"><a id="__codelineno-167-1" name="__codelineno-167-1" href="#__codelineno-167-1"></a><span class="k">enum</span><span class="w"> </span><span class="n">ThreadPriority</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">Lowest</span><span class="p">,</span><span class="w"> </span><span class="n">BelowNormal</span><span class="p">,</span><span class="w"> </span><span class="n">Normal</span><span class="p">,</span><span class="w"> </span><span class="n">AboveNormal</span><span class="p">,</span><span class="w"> </span><span class="n">Highest</span><span class="w"> </span><span class="p">}</span>
</span></code></pre></div>
<p>This becomes relevant when multiple threads are simultaneously active. You need to take care when elevating a threadâ€™s priority because it can starve other threads. If you want a thread to have higher priority than threads in other processes, you must also elevate the process priority using the Process class in System.Diagnostics:</p>
<div class="language-csharp highlight"><pre><span></span><code><span id="__span-168-1"><a id="__codelineno-168-1" name="__codelineno-168-1" href="#__codelineno-168-1"></a><span class="k">using</span><span class="w"> </span><span class="nn">Process</span><span class="w"> </span><span class="n">p</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Process</span><span class="p">.</span><span class="n">GetCurrentProcess</span><span class="p">();</span>
</span><span id="__span-168-2"><a id="__codelineno-168-2" name="__codelineno-168-2" href="#__codelineno-168-2"></a><span class="n">p</span><span class="p">.</span><span class="n">PriorityClass</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ProcessPriorityClass</span><span class="p">.</span><span class="n">High</span><span class="p">;</span>
</span></code></pre></div>
<p>This can work well for non-UI processes that do minimal work and need low latency (the ability to respond very quickly) in the work they do. With computehungry applications (particularly those with a user interface), elevating process priâ€ ority can starve other processes, slowing down the entire computer.</p>
<h2 id="signaling">Signaling</h2>
<p>Sometimes, you need a thread to wait until receiving notification(s) from other thread(s). This is called signaling. The simplest signaling construct is ManualReset Event. Calling WaitOne on a ManualResetEvent blocks the current thread until another thread â€œopensâ€ the signal by calling Set. In the following example, we start up a thread that waits on a ManualResetEvent. It remains blocked for two seconds until the main thread signals it:</p>
<div class="language-csharp highlight"><pre><span></span><code><span id="__span-169-1"><a id="__codelineno-169-1" name="__codelineno-169-1" href="#__codelineno-169-1"></a><span class="kt">var</span><span class="w"> </span><span class="n">signal</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">ManualResetEvent</span><span class="w"> </span><span class="p">(</span><span class="k">false</span><span class="p">);</span>
</span><span id="__span-169-2"><a id="__codelineno-169-2" name="__codelineno-169-2" href="#__codelineno-169-2"></a><span class="k">new</span><span class="w"> </span><span class="nf">Thread</span><span class="w"> </span><span class="p">(()</span><span class="w"> </span><span class="o">=&gt;</span>
</span><span id="__span-169-3"><a id="__codelineno-169-3" name="__codelineno-169-3" href="#__codelineno-169-3"></a><span class="p">{</span>
</span><span id="__span-169-4"><a id="__codelineno-169-4" name="__codelineno-169-4" href="#__codelineno-169-4"></a><span class="w"> </span><span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="w"> </span><span class="p">(</span><span class="s">&quot;Waiting for signal...&quot;</span><span class="p">);</span>
</span><span id="__span-169-5"><a id="__codelineno-169-5" name="__codelineno-169-5" href="#__codelineno-169-5"></a><span class="w"> </span><span class="n">signal</span><span class="p">.</span><span class="n">WaitOne</span><span class="p">();</span>
</span><span id="__span-169-6"><a id="__codelineno-169-6" name="__codelineno-169-6" href="#__codelineno-169-6"></a><span class="w"> </span><span class="n">signal</span><span class="p">.</span><span class="n">Dispose</span><span class="p">();</span>
</span><span id="__span-169-7"><a id="__codelineno-169-7" name="__codelineno-169-7" href="#__codelineno-169-7"></a><span class="w"> </span><span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="w"> </span><span class="p">(</span><span class="s">&quot;Got signal!&quot;</span><span class="p">);</span>
</span><span id="__span-169-8"><a id="__codelineno-169-8" name="__codelineno-169-8" href="#__codelineno-169-8"></a><span class="p">}).</span><span class="n">Start</span><span class="p">();</span>
</span><span id="__span-169-9"><a id="__codelineno-169-9" name="__codelineno-169-9" href="#__codelineno-169-9"></a><span class="n">Thread</span><span class="p">.</span><span class="n">Sleep</span><span class="p">(</span><span class="mi">2000</span><span class="p">);</span>
</span><span id="__span-169-10"><a id="__codelineno-169-10" name="__codelineno-169-10" href="#__codelineno-169-10"></a><span class="n">signal</span><span class="p">.</span><span class="n">Set</span><span class="p">();</span><span class="w"> </span><span class="c1">// &quot;Open&quot; the signal</span>
</span></code></pre></div>
<p>After calling Set, the signal remains open; you can close it again by calling Reset</p>
<h2 id="threading-in-rich-client-applications">Threading in Rich Client Applications</h2>
<p>In WPF, UWP, and Windows Forms applications, executing long-running operaâ€ tions on the main thread makes the application unresponsive because the main thread also processes the message loop that performs rendering and handles keyâ€ board and mouse events.</p>
<p>A popular approach is to start up â€œworkerâ€ threads for time-consuming operations. The code on a worker thread runs a time-consuming operation and then updates the UI when complete. However, all rich client applications have a threading model whereby UI elements and controls can be accessed only from the thread that created them (typically the main UI thread). Violating this causes either unpredictable behavior, or an exception to be thrown.</p>
<p>Hence when you want to update the UI from a worker thread, you must forward the request to the UI thread (the technical term is marshal). The low-level way to do this is as follows (later, we discuss other solutions which build on these):</p>
<ul>
<li>In WPF, call BeginInvoke or Invoke on the elementâ€™s Dispatcher object</li>
<li>In UWP apps, call RunAsync or Invoke on the Dispatcher object</li>
<li>In Windows Forms, call BeginInvoke or Invoke on the control</li>
</ul>
<p>All of these methods accept a delegate referencing the method you want to run. BeginInvoke/RunAsync work by enqueuing the delegate to the UI threadâ€™s message queue (the same queue that handles keyboard, mouse, and timer events). Invoke does the same thing, but then blocks until the message has been read and processed by the UI thread. Because of this, Invoke lets you get a return value back from the method. If you donâ€™t need a return value, BeginInvoke/RunAsync are preferable in that they donâ€™t block the caller and donâ€™t introduce the possibility of deadlock</p>
<p>You can imagine that when you call <code>Application.Run</code>, the following pseudo-code executes:</p>
<div class="language-csharp highlight"><pre><span></span><code><span id="__span-170-1"><a id="__codelineno-170-1" name="__codelineno-170-1" href="#__codelineno-170-1"></a><span class="k">while</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="n">thisApplication</span><span class="p">.</span><span class="n">Ended</span><span class="p">)</span>
</span><span id="__span-170-2"><a id="__codelineno-170-2" name="__codelineno-170-2" href="#__codelineno-170-2"></a><span class="p">{</span>
</span><span id="__span-170-3"><a id="__codelineno-170-3" name="__codelineno-170-3" href="#__codelineno-170-3"></a><span class="w"> </span><span class="n">wait</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">something</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">appear</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">message</span><span class="w"> </span><span class="n">queue</span>
</span><span id="__span-170-4"><a id="__codelineno-170-4" name="__codelineno-170-4" href="#__codelineno-170-4"></a><span class="w"> </span><span class="n">Got</span><span class="w"> </span><span class="n">something</span><span class="p">:</span><span class="w"> </span><span class="n">what</span><span class="w"> </span><span class="n">kind</span><span class="w"> </span><span class="n">of</span><span class="w"> </span><span class="n">message</span><span class="w"> </span><span class="k">is</span><span class="w"> </span><span class="n">it</span><span class="o">?</span>
</span><span id="__span-170-5"><a id="__codelineno-170-5" name="__codelineno-170-5" href="#__codelineno-170-5"></a><span class="w"> </span><span class="n">Keyboard</span><span class="o">/</span><span class="n">mouse</span><span class="w"> </span><span class="n">message</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">fire</span><span class="w"> </span><span class="n">an</span><span class="w"> </span><span class="k">event</span><span class="w"> </span><span class="n">handler</span>
</span><span id="__span-170-6"><a id="__codelineno-170-6" name="__codelineno-170-6" href="#__codelineno-170-6"></a><span class="w"> </span><span class="n">User</span><span class="w"> </span><span class="n">BeginInvoke</span><span class="w"> </span><span class="n">message</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">execute</span><span class="w"> </span><span class="k">delegate</span>
</span><span id="__span-170-7"><a id="__codelineno-170-7" name="__codelineno-170-7" href="#__codelineno-170-7"></a><span class="w"> </span><span class="n">User</span><span class="w"> </span><span class="n">Invoke</span><span class="w"> </span><span class="n">message</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">execute</span><span class="w"> </span><span class="k">delegate</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="n">post</span><span class="w"> </span><span class="n">result</span>
</span><span id="__span-170-8"><a id="__codelineno-170-8" name="__codelineno-170-8" href="#__codelineno-170-8"></a><span class="p">}</span>
</span></code></pre></div>
<p>To demonstrate, suppose that we have a WPF window that contains a text box called txtMessage, whose content we want a worker thread to update after performing a time-consuming task (which we will simulate by calling <code>Thread.Sleep</code>).</p>
<div class="language-csharp highlight"><pre><span></span><code><span id="__span-171-1"><a id="__codelineno-171-1" name="__codelineno-171-1" href="#__codelineno-171-1"></a><span class="k">partial</span><span class="w"> </span><span class="k">class</span><span class="w"> </span><span class="nc">MyWindow</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="n">Window</span>
</span><span id="__span-171-2"><a id="__codelineno-171-2" name="__codelineno-171-2" href="#__codelineno-171-2"></a><span class="p">{</span>
</span><span id="__span-171-3"><a id="__codelineno-171-3" name="__codelineno-171-3" href="#__codelineno-171-3"></a><span class="w"> </span><span class="k">public</span><span class="w"> </span><span class="nf">MyWindow</span><span class="p">()</span>
</span><span id="__span-171-4"><a id="__codelineno-171-4" name="__codelineno-171-4" href="#__codelineno-171-4"></a><span class="w"> </span><span class="p">{</span>
</span><span id="__span-171-5"><a id="__codelineno-171-5" name="__codelineno-171-5" href="#__codelineno-171-5"></a><span class="w"> </span><span class="n">InitializeComponent</span><span class="p">();</span>
</span><span id="__span-171-6"><a id="__codelineno-171-6" name="__codelineno-171-6" href="#__codelineno-171-6"></a><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="nf">Thread</span><span class="w"> </span><span class="p">(</span><span class="n">Work</span><span class="p">).</span><span class="n">Start</span><span class="p">();</span>
</span><span id="__span-171-7"><a id="__codelineno-171-7" name="__codelineno-171-7" href="#__codelineno-171-7"></a><span class="w"> </span><span class="p">}</span>
</span><span id="__span-171-8"><a id="__codelineno-171-8" name="__codelineno-171-8" href="#__codelineno-171-8"></a><span class="w"> </span><span class="k">void</span><span class="w"> </span><span class="nf">Work</span><span class="p">()</span>
</span><span id="__span-171-9"><a id="__codelineno-171-9" name="__codelineno-171-9" href="#__codelineno-171-9"></a><span class="w"> </span><span class="p">{</span>
</span><span id="__span-171-10"><a id="__codelineno-171-10" name="__codelineno-171-10" href="#__codelineno-171-10"></a><span class="w"> </span><span class="n">Thread</span><span class="p">.</span><span class="n">Sleep</span><span class="w"> </span><span class="p">(</span><span class="mi">5000</span><span class="p">);</span><span class="w"> </span><span class="c1">// Simulate time-consuming task</span>
</span><span id="__span-171-11"><a id="__codelineno-171-11" name="__codelineno-171-11" href="#__codelineno-171-11"></a><span class="w"> </span><span class="n">UpdateMessage</span><span class="w"> </span><span class="p">(</span><span class="s">&quot;The answer&quot;</span><span class="p">);</span>
</span><span id="__span-171-12"><a id="__codelineno-171-12" name="__codelineno-171-12" href="#__codelineno-171-12"></a><span class="w"> </span><span class="p">}</span>
</span><span id="__span-171-13"><a id="__codelineno-171-13" name="__codelineno-171-13" href="#__codelineno-171-13"></a><span class="w"> </span><span class="k">void</span><span class="w"> </span><span class="nf">UpdateMessage</span><span class="w"> </span><span class="p">(</span><span class="kt">string</span><span class="w"> </span><span class="n">message</span><span class="p">)</span>
</span><span id="__span-171-14"><a id="__codelineno-171-14" name="__codelineno-171-14" href="#__codelineno-171-14"></a><span class="w"> </span><span class="p">{</span>
</span><span id="__span-171-15"><a id="__codelineno-171-15" name="__codelineno-171-15" href="#__codelineno-171-15"></a><span class="w"> </span><span class="n">Action</span><span class="w"> </span><span class="n">action</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="n">txtMessage</span><span class="p">.</span><span class="n">Text</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">message</span><span class="p">;</span>
</span><span id="__span-171-16"><a id="__codelineno-171-16" name="__codelineno-171-16" href="#__codelineno-171-16"></a><span class="w"> </span><span class="n">Dispatcher</span><span class="p">.</span><span class="n">BeginInvoke</span><span class="w"> </span><span class="p">(</span><span class="n">action</span><span class="p">);</span>
</span><span id="__span-171-17"><a id="__codelineno-171-17" name="__codelineno-171-17" href="#__codelineno-171-17"></a><span class="w"> </span><span class="p">}</span>
</span><span id="__span-171-18"><a id="__codelineno-171-18" name="__codelineno-171-18" href="#__codelineno-171-18"></a><span class="p">}</span>
</span></code></pre></div>
<p>Running this results in a responsive window appearing immediately. Five seconds later, it updates the textbox. The code is similar for Windows Forms, except that we call the (Formâ€™s) BeginInvoke method, instead:</p>
<div class="language-csharp highlight"><pre><span></span><code><span id="__span-172-1"><a id="__codelineno-172-1" name="__codelineno-172-1" href="#__codelineno-172-1"></a><span class="k">void</span><span class="w"> </span><span class="nf">UpdateMessage</span><span class="w"> </span><span class="p">(</span><span class="kt">string</span><span class="w"> </span><span class="n">message</span><span class="p">)</span>
</span><span id="__span-172-2"><a id="__codelineno-172-2" name="__codelineno-172-2" href="#__codelineno-172-2"></a><span class="w"> </span><span class="p">{</span>
</span><span id="__span-172-3"><a id="__codelineno-172-3" name="__codelineno-172-3" href="#__codelineno-172-3"></a><span class="w"> </span><span class="n">Action</span><span class="w"> </span><span class="n">action</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="n">txtMessage</span><span class="p">.</span><span class="n">Text</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">message</span><span class="p">;</span>
</span><span id="__span-172-4"><a id="__codelineno-172-4" name="__codelineno-172-4" href="#__codelineno-172-4"></a><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="n">BeginInvoke</span><span class="w"> </span><span class="p">(</span><span class="n">action</span><span class="p">);</span>
</span><span id="__span-172-5"><a id="__codelineno-172-5" name="__codelineno-172-5" href="#__codelineno-172-5"></a><span class="w"> </span><span class="p">}</span>
</span></code></pre></div>
<aside>
ðŸ’¡ **Multiple UI Threads**
Itâ€™s possible to have multiple UI threads if they each own different windows. The main scenario is when you have an application with multiple top-level windows, often called a Single Document Interface (SDI) application, such as Microsoft Word. Each SDI window typically shows itself as a separate â€œapplicationâ€ on the taskbar and is mostly isolated, functionally, from other SDI windows. By giving each such window its own UI thread, each window can be made more responsive with respect to the others.

</aside>

<h2 id="synchronization-contexts">Synchronization Contexts</h2>
<p>In the <code>System.ComponentModel</code> namespace, thereâ€™s a class called Synchronization Context, which enables the generalization of thread marshaling</p>
<p>The rich-client APIs for mobile and desktop (UWP, WPF, and Windows Forms) each define and instantiate SynchronizationContext subclasses, which you can obtain via the static property SynchronizationContext.Current (while running on a UI thread). Capturing this property let you later post to UI controls from a worker thread:</p>
<div class="language-csharp highlight"><pre><span></span><code><span id="__span-173-1"><a id="__codelineno-173-1" name="__codelineno-173-1" href="#__codelineno-173-1"></a><span class="k">partial</span><span class="w"> </span><span class="k">class</span><span class="w"> </span><span class="nc">MyWindow</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="n">Window</span>
</span><span id="__span-173-2"><a id="__codelineno-173-2" name="__codelineno-173-2" href="#__codelineno-173-2"></a><span class="p">{</span>
</span><span id="__span-173-3"><a id="__codelineno-173-3" name="__codelineno-173-3" href="#__codelineno-173-3"></a><span class="w"> </span><span class="n">SynchronizationContext</span><span class="w"> </span><span class="n">_uiSyncContext</span><span class="p">;</span>
</span><span id="__span-173-4"><a id="__codelineno-173-4" name="__codelineno-173-4" href="#__codelineno-173-4"></a><span class="w"> </span><span class="k">public</span><span class="w"> </span><span class="nf">MyWindow</span><span class="p">()</span>
</span><span id="__span-173-5"><a id="__codelineno-173-5" name="__codelineno-173-5" href="#__codelineno-173-5"></a><span class="w"> </span><span class="p">{</span>
</span><span id="__span-173-6"><a id="__codelineno-173-6" name="__codelineno-173-6" href="#__codelineno-173-6"></a><span class="w"> </span><span class="n">InitializeComponent</span><span class="p">();</span>
</span><span id="__span-173-7"><a id="__codelineno-173-7" name="__codelineno-173-7" href="#__codelineno-173-7"></a><span class="w"> </span><span class="c1">// Capture the synchronization context for the current UI thread:</span>
</span><span id="__span-173-8"><a id="__codelineno-173-8" name="__codelineno-173-8" href="#__codelineno-173-8"></a><span class="w"> </span><span class="n">_uiSyncContext</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">SynchronizationContext</span><span class="p">.</span><span class="n">Current</span><span class="p">;</span>
</span><span id="__span-173-9"><a id="__codelineno-173-9" name="__codelineno-173-9" href="#__codelineno-173-9"></a><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="nf">Thread</span><span class="w"> </span><span class="p">(</span><span class="n">Work</span><span class="p">).</span><span class="n">Start</span><span class="p">();</span>
</span><span id="__span-173-10"><a id="__codelineno-173-10" name="__codelineno-173-10" href="#__codelineno-173-10"></a><span class="w"> </span><span class="p">}</span>
</span><span id="__span-173-11"><a id="__codelineno-173-11" name="__codelineno-173-11" href="#__codelineno-173-11"></a><span class="w"> </span><span class="k">void</span><span class="w"> </span><span class="nf">Work</span><span class="p">()</span>
</span><span id="__span-173-12"><a id="__codelineno-173-12" name="__codelineno-173-12" href="#__codelineno-173-12"></a><span class="w"> </span><span class="p">{</span>
</span><span id="__span-173-13"><a id="__codelineno-173-13" name="__codelineno-173-13" href="#__codelineno-173-13"></a><span class="w"> </span><span class="n">Thread</span><span class="p">.</span><span class="n">Sleep</span><span class="w"> </span><span class="p">(</span><span class="mi">5000</span><span class="p">);</span><span class="w"> </span><span class="c1">// Simulate time-consuming task</span>
</span><span id="__span-173-14"><a id="__codelineno-173-14" name="__codelineno-173-14" href="#__codelineno-173-14"></a><span class="w"> </span><span class="n">UpdateMessage</span><span class="w"> </span><span class="p">(</span><span class="s">&quot;The answer&quot;</span><span class="p">);</span>
</span><span id="__span-173-15"><a id="__codelineno-173-15" name="__codelineno-173-15" href="#__codelineno-173-15"></a><span class="w"> </span><span class="p">}</span>
</span><span id="__span-173-16"><a id="__codelineno-173-16" name="__codelineno-173-16" href="#__codelineno-173-16"></a><span class="w"> </span><span class="k">void</span><span class="w"> </span><span class="nf">UpdateMessage</span><span class="w"> </span><span class="p">(</span><span class="kt">string</span><span class="w"> </span><span class="n">message</span><span class="p">)</span>
</span><span id="__span-173-17"><a id="__codelineno-173-17" name="__codelineno-173-17" href="#__codelineno-173-17"></a><span class="w"> </span><span class="p">{</span>
</span><span id="__span-173-18"><a id="__codelineno-173-18" name="__codelineno-173-18" href="#__codelineno-173-18"></a><span class="w"> </span><span class="c1">// Marshal the delegate to the UI thread:</span>
</span><span id="__span-173-19"><a id="__codelineno-173-19" name="__codelineno-173-19" href="#__codelineno-173-19"></a><span class="w"> </span><span class="n">_uiSyncContext</span><span class="p">.</span><span class="n">Post</span><span class="w"> </span><span class="p">(</span><span class="n">_</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="n">txtMessage</span><span class="p">.</span><span class="n">Text</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">message</span><span class="p">,</span><span class="w"> </span><span class="k">null</span><span class="p">);</span>
</span><span id="__span-173-20"><a id="__codelineno-173-20" name="__codelineno-173-20" href="#__codelineno-173-20"></a><span class="w"> </span><span class="p">}</span>
</span><span id="__span-173-21"><a id="__codelineno-173-21" name="__codelineno-173-21" href="#__codelineno-173-21"></a><span class="p">}</span>
</span></code></pre></div>
<p>This is useful because the same technique works with all rich-client User Interface APIs</p>
<h2 id="the-thread-pool">The Thread Pool</h2>
<p>Whenever you start a thread, a few hundred microseconds are spent organizing such things as a fresh local variable stack. The thread pool cuts this overhead by having a pool of pre-created recyclable threads. Thread pooling is essential for efficient parallel programming and fine-grained concurrency; it allows short operations to run without being overwhelmed with the overhead of thread startup.</p>
<p>There are a few things to be wary of when using pooled threads</p>
<ul>
<li>You cannot set the Name of a pooled thread, making debugging more difficult (although you can attach a description when debugging in Visual Studioâ€™s Threads window).</li>
<li>Pooled threads are always background threads</li>
<li>Blocking pooled threads can degrade performance</li>
</ul>
<p>You are free to change the priority of a pooled threadâ€”it will be restored to normal when released back to the pool.ou can determine whether youâ€™re currently executing on a pooled thread via the property Thread.CurrentThread.IsThreadPoolThread.</p>
<h3 id="entering-the-thread-pool">Entering the thread pool</h3>
<p>The easiest way to explicitly run something on a pooled thread is to use Task.Run()</p>
<div class="language-csharp highlight"><pre><span></span><code><span id="__span-174-1"><a id="__codelineno-174-1" name="__codelineno-174-1" href="#__codelineno-174-1"></a><span class="c1">// Task is in System.Threading.Tasks</span>
</span><span id="__span-174-2"><a id="__codelineno-174-2" name="__codelineno-174-2" href="#__codelineno-174-2"></a><span class="n">Task</span><span class="p">.</span><span class="n">Run</span><span class="w"> </span><span class="p">(()</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="w"> </span><span class="p">(</span><span class="s">&quot;Hello from the thread pool&quot;</span><span class="p">));</span>
</span></code></pre></div>
<h1 id="tasks">Tasks</h1>
<p>A thread is a low-level tool for creating concurrency, and as such, it has limitations. In particular</p>
<ul>
<li>Although itâ€™s easy to pass data into a thread that you start, thereâ€™s no easy way to get a â€œreturn valueâ€ back from a thread that you Join. You need to set up some kind of shared field. And if the operation throws an exception, catching and propagating that exception is equally painful</li>
<li>You canâ€™t tell a thread to start something else when itâ€™s finished; instead you must Join it (blocking your own thread in the process)</li>
</ul>
<p>These limitations discourage fine-grained concurrency; in other words, they make it difficult to compose larger concurrent operations by combining smaller ones (something essential for the asynchronous programming that we look at in following sections). This in turn leads to greater reliance on manual synchronization (locking, signaling, and so on) and the problems that go with it</p>
<p>The direct use of threads also has performance implications. And should you need to run hundreds or thouâ€ sands of concurrent I/O-bound operations, a thread-based approach consumes hundreds or thousands of megabytes of memory purely in thread overhead.</p>
<p>The Task class helps with all of these problems. Compared to a thread, a Task is higher-level abstractionâ€”it represents a concurrent operation that might or might not be backed by a thread. Tasks are compositional (you can chain them together through the use of continuations). They can use the thread pool to lessen startup latency, and with a TaskCompletionSource, they can employ a callback approach that avoids threads altogether while waiting on I/O-bound operations.</p>
<h2 id="starting-a-task">Starting a Task</h2>
<p>The easiest way to start a Task backed by a thread is with the static method Task.Run (the Task class is in the System.Threading.Tasks namespace). Simply pass in an Action delegate:</p>
<div class="language-csharp highlight"><pre><span></span><code><span id="__span-175-1"><a id="__codelineno-175-1" name="__codelineno-175-1" href="#__codelineno-175-1"></a><span class="n">Task</span><span class="p">.</span><span class="n">Run</span><span class="w"> </span><span class="p">(()</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="w"> </span><span class="p">(</span><span class="s">&quot;Foo&quot;</span><span class="p">));</span>
</span></code></pre></div>
<p>Tasks use pooled threads by default, which are background threads. This means that when the main thread ends, so do any tasks that you create. Hence, to run these examples from a Console application, you must block the main thread after starting the task (for instance, by Waiting the task or by calling Console.ReadLine)</p>
<div class="language-csharp highlight"><pre><span></span><code><span id="__span-176-1"><a id="__codelineno-176-1" name="__codelineno-176-1" href="#__codelineno-176-1"></a><span class="k">static</span><span class="w"> </span><span class="k">void</span><span class="w"> </span><span class="nf">Main</span><span class="p">()</span>
</span><span id="__span-176-2"><a id="__codelineno-176-2" name="__codelineno-176-2" href="#__codelineno-176-2"></a><span class="p">{</span>
</span><span id="__span-176-3"><a id="__codelineno-176-3" name="__codelineno-176-3" href="#__codelineno-176-3"></a><span class="w"> </span><span class="n">Task</span><span class="p">.</span><span class="n">Run</span><span class="w"> </span><span class="p">(()</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="w"> </span><span class="p">(</span><span class="s">&quot;Foo&quot;</span><span class="p">));</span>
</span><span id="__span-176-4"><a id="__codelineno-176-4" name="__codelineno-176-4" href="#__codelineno-176-4"></a><span class="w"> </span><span class="n">Console</span><span class="p">.</span><span class="n">ReadLine</span><span class="p">();</span>
</span><span id="__span-176-5"><a id="__codelineno-176-5" name="__codelineno-176-5" href="#__codelineno-176-5"></a><span class="p">}</span>
</span></code></pre></div>
<p>You can track a taskâ€™s execution status via its Status property</p>
<h3 id="wait">Wait</h3>
<p>Calling Wait on a task blocks until it completes and is the equivalent of calling Join on a thread:</p>
<div class="language-csharp highlight"><pre><span></span><code><span id="__span-177-1"><a id="__codelineno-177-1" name="__codelineno-177-1" href="#__codelineno-177-1"></a><span class="n">Task</span><span class="w"> </span><span class="n">task</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Task</span><span class="p">.</span><span class="n">Run</span><span class="w"> </span><span class="p">(()</span><span class="w"> </span><span class="o">=&gt;</span>
</span><span id="__span-177-2"><a id="__codelineno-177-2" name="__codelineno-177-2" href="#__codelineno-177-2"></a><span class="p">{</span>
</span><span id="__span-177-3"><a id="__codelineno-177-3" name="__codelineno-177-3" href="#__codelineno-177-3"></a><span class="w"> </span><span class="n">Thread</span><span class="p">.</span><span class="n">Sleep</span><span class="w"> </span><span class="p">(</span><span class="mi">2000</span><span class="p">);</span>
</span><span id="__span-177-4"><a id="__codelineno-177-4" name="__codelineno-177-4" href="#__codelineno-177-4"></a><span class="w"> </span><span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="w"> </span><span class="p">(</span><span class="s">&quot;Foo&quot;</span><span class="p">);</span>
</span><span id="__span-177-5"><a id="__codelineno-177-5" name="__codelineno-177-5" href="#__codelineno-177-5"></a><span class="p">});</span>
</span><span id="__span-177-6"><a id="__codelineno-177-6" name="__codelineno-177-6" href="#__codelineno-177-6"></a><span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="w"> </span><span class="p">(</span><span class="n">task</span><span class="p">.</span><span class="n">IsCompleted</span><span class="p">);</span><span class="w"> </span><span class="c1">// False</span>
</span><span id="__span-177-7"><a id="__codelineno-177-7" name="__codelineno-177-7" href="#__codelineno-177-7"></a><span class="n">task</span><span class="p">.</span><span class="n">Wait</span><span class="p">();</span><span class="w"> </span><span class="c1">// Blocks until task is complete</span>
</span></code></pre></div>
<p>Wait lets you optionally specify a timeout and a cancellation token to end the wait early</p>
<h3 id="long-running-tasks">Long-running tasks</h3>
<p>By default, the CLR runs tasks on pooled threads, which is ideal for short-running compute-bound work. For longer-running and blocking operations (such as our preceding example), you can prevent use of a pooled thread as follows:</p>
<div class="language-csharp highlight"><pre><span></span><code><span id="__span-178-1"><a id="__codelineno-178-1" name="__codelineno-178-1" href="#__codelineno-178-1"></a><span class="n">Task</span><span class="w"> </span><span class="n">task</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Task</span><span class="p">.</span><span class="n">Factory</span><span class="p">.</span><span class="n">StartNew</span><span class="w"> </span><span class="p">(()</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="p">...,</span><span class="w"> </span><span class="n">TaskCreationOptions</span><span class="p">.</span><span class="n">LongRunning</span><span class="p">);</span>
</span></code></pre></div>
<p>Running one long-running task on a pooled thread wonâ€™t cause trouble; itâ€™s when you run multiple long-running tasks in parallel (particularly ones that block) that performance can suffer. And in that case, there are usually better solutions than <code>TaskCreationOptions.LongRunning</code>:</p>
<ul>
<li>If the tasks are I/O bound, TaskCompletionSource and asynchronous functions let you implement concurrency with callbacks (continuations) instead of threads.</li>
<li>If the tasks are compute bound, a producer/consumer queue lets you throttle the concurrency for those tasks, avoiding starvation for other threads and processes</li>
</ul>
<h2 id="returning-values">Returning values</h2>
<p>Task has a generic subclass called Task<TResult>, which allows a task to emit a return value. You can obtain a Task<TResult> by calling Task.Run with a Func <TResult> delegate (or a compatible lambda expression) instead of an Action:</p>
<div class="language-csharp highlight"><pre><span></span><code><span id="__span-179-1"><a id="__codelineno-179-1" name="__codelineno-179-1" href="#__codelineno-179-1"></a><span class="n">Task</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span><span class="w"> </span><span class="n">task</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Task</span><span class="p">.</span><span class="n">Run</span><span class="w"> </span><span class="p">(()</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="w"> </span><span class="p">(</span><span class="s">&quot;Foo&quot;</span><span class="p">);</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="mi">3</span><span class="p">;</span><span class="w"> </span><span class="p">});</span>
</span><span id="__span-179-2"><a id="__codelineno-179-2" name="__codelineno-179-2" href="#__codelineno-179-2"></a><span class="c1">// ...</span>
</span></code></pre></div>
<p>You can obtain the result later by querying the Result property. If the task hasnâ€™t yet finished, accessing this property will block the current thread until the task finishes:</p>
<div class="language-csharp highlight"><pre><span></span><code><span id="__span-180-1"><a id="__codelineno-180-1" name="__codelineno-180-1" href="#__codelineno-180-1"></a><span class="kt">int</span><span class="w"> </span><span class="n">result</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">task</span><span class="p">.</span><span class="n">Result</span><span class="p">;</span><span class="w"> </span><span class="c1">// Blocks if not already finished</span>
</span><span id="__span-180-2"><a id="__codelineno-180-2" name="__codelineno-180-2" href="#__codelineno-180-2"></a><span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="w"> </span><span class="p">(</span><span class="n">result</span><span class="p">);</span><span class="w"> </span><span class="c1">// 3</span>
</span></code></pre></div>
<p>In the following example, we create a task that uses LINQ to count the number of prime numbers in the first three million (+2) integers:</p>
<h2 id="exceptions">Exceptions</h2>
<p>Unlike with threads, tasks conveniently propagate exceptions. So, if the code in your task throws an unhandled exception (in other words, if your task faults), that exception is automatically rethrown to whoever calls Wait()â€”or accesses the Result property of a Task<TResult></p>
<div class="language-csharp highlight"><pre><span></span><code><span id="__span-181-1"><a id="__codelineno-181-1" name="__codelineno-181-1" href="#__codelineno-181-1"></a><span class="c1">// Start a Task that throws a NullReferenceException:</span>
</span><span id="__span-181-2"><a id="__codelineno-181-2" name="__codelineno-181-2" href="#__codelineno-181-2"></a><span class="n">Task</span><span class="w"> </span><span class="n">task</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Task</span><span class="p">.</span><span class="n">Run</span><span class="w"> </span><span class="p">(()</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">throw</span><span class="w"> </span><span class="k">null</span><span class="p">;</span><span class="w"> </span><span class="p">});</span>
</span><span id="__span-181-3"><a id="__codelineno-181-3" name="__codelineno-181-3" href="#__codelineno-181-3"></a><span class="k">try</span>
</span><span id="__span-181-4"><a id="__codelineno-181-4" name="__codelineno-181-4" href="#__codelineno-181-4"></a><span class="p">{</span>
</span><span id="__span-181-5"><a id="__codelineno-181-5" name="__codelineno-181-5" href="#__codelineno-181-5"></a><span class="w"> </span><span class="n">task</span><span class="p">.</span><span class="n">Wait</span><span class="p">();</span>
</span><span id="__span-181-6"><a id="__codelineno-181-6" name="__codelineno-181-6" href="#__codelineno-181-6"></a><span class="p">}</span>
</span><span id="__span-181-7"><a id="__codelineno-181-7" name="__codelineno-181-7" href="#__codelineno-181-7"></a><span class="k">catch</span><span class="w"> </span><span class="p">(</span><span class="n">AggregateException</span><span class="w"> </span><span class="n">aex</span><span class="p">)</span>
</span><span id="__span-181-8"><a id="__codelineno-181-8" name="__codelineno-181-8" href="#__codelineno-181-8"></a><span class="p">{</span>
</span><span id="__span-181-9"><a id="__codelineno-181-9" name="__codelineno-181-9" href="#__codelineno-181-9"></a><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">aex</span><span class="p">.</span><span class="n">InnerException</span><span class="w"> </span><span class="k">is</span><span class="w"> </span><span class="n">NullReferenceException</span><span class="p">)</span>
</span><span id="__span-181-10"><a id="__codelineno-181-10" name="__codelineno-181-10" href="#__codelineno-181-10"></a><span class="w"> </span><span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="w"> </span><span class="p">(</span><span class="s">&quot;Null!&quot;</span><span class="p">);</span>
</span><span id="__span-181-11"><a id="__codelineno-181-11" name="__codelineno-181-11" href="#__codelineno-181-11"></a><span class="w"> </span><span class="k">else</span>
</span><span id="__span-181-12"><a id="__codelineno-181-12" name="__codelineno-181-12" href="#__codelineno-181-12"></a><span class="w"> </span><span class="k">throw</span><span class="p">;</span>
</span><span id="__span-181-13"><a id="__codelineno-181-13" name="__codelineno-181-13" href="#__codelineno-181-13"></a><span class="p">}</span>
</span></code></pre></div>
<h2 id="continuations">Continuations</h2>
<p>A continuation says to a task, â€œwhen youâ€™ve finished, continue by doing something else.â€ A continuation is usually implemented by a callback that executes once upon completion of an operation. There are two ways to attach a continuation to a task. The first is particularly significant because itâ€™s used by C#â€™s asynchronous functions, as youâ€™ll see soon.</p>
<div class="language-csharp highlight"><pre><span></span><code><span id="__span-182-1"><a id="__codelineno-182-1" name="__codelineno-182-1" href="#__codelineno-182-1"></a><span class="n">Task</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span><span class="w"> </span><span class="n">primeNumberTask</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Task</span><span class="p">.</span><span class="n">Run</span><span class="w"> </span><span class="p">(()</span><span class="w"> </span><span class="o">=&gt;</span>
</span><span id="__span-182-2"><a id="__codelineno-182-2" name="__codelineno-182-2" href="#__codelineno-182-2"></a><span class="w"> </span><span class="n">Enumerable</span><span class="p">.</span><span class="n">Range</span><span class="w"> </span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="mi">3000000</span><span class="p">).</span><span class="n">Count</span><span class="w"> </span><span class="p">(</span><span class="n">n</span><span class="w"> </span><span class="o">=&gt;</span>
</span><span id="__span-182-3"><a id="__codelineno-182-3" name="__codelineno-182-3" href="#__codelineno-182-3"></a><span class="w"> </span><span class="n">Enumerable</span><span class="p">.</span><span class="n">Range</span><span class="w"> </span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="p">)</span><span class="n">Math</span><span class="p">.</span><span class="n">Sqrt</span><span class="p">(</span><span class="n">n</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">).</span><span class="n">All</span><span class="w"> </span><span class="p">(</span><span class="n">i</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="n">n</span><span class="w"> </span><span class="o">%</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">0</span><span class="p">)));</span>
</span><span id="__span-182-4"><a id="__codelineno-182-4" name="__codelineno-182-4" href="#__codelineno-182-4"></a><span class="kt">var</span><span class="w"> </span><span class="n">awaiter</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">primeNumberTask</span><span class="p">.</span><span class="n">GetAwaiter</span><span class="p">();</span>
</span><span id="__span-182-5"><a id="__codelineno-182-5" name="__codelineno-182-5" href="#__codelineno-182-5"></a><span class="n">awaiter</span><span class="p">.</span><span class="n">OnCompleted</span><span class="w"> </span><span class="p">(()</span><span class="w"> </span><span class="o">=&gt;</span>
</span><span id="__span-182-6"><a id="__codelineno-182-6" name="__codelineno-182-6" href="#__codelineno-182-6"></a><span class="p">{</span>
</span><span id="__span-182-7"><a id="__codelineno-182-7" name="__codelineno-182-7" href="#__codelineno-182-7"></a><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">result</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">awaiter</span><span class="p">.</span><span class="n">GetResult</span><span class="p">();</span>
</span><span id="__span-182-8"><a id="__codelineno-182-8" name="__codelineno-182-8" href="#__codelineno-182-8"></a><span class="w"> </span><span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="w"> </span><span class="p">(</span><span class="n">result</span><span class="p">);</span><span class="w"> </span><span class="c1">// Writes result</span>
</span><span id="__span-182-9"><a id="__codelineno-182-9" name="__codelineno-182-9" href="#__codelineno-182-9"></a><span class="p">});</span>
</span></code></pre></div>
<h2 id="taskcompletionsource">TaskCompletionSource</h2>
<p>Weâ€™ve seen how Task.Run creates a task that runs a delegate on a pooled (or nonpooled) thread. Another way to create a task is with TaskCompletionSource.</p>
<p>TaskCompletionSource lets you create a task out of any operation that starts and finishes some time later. It works by giving you a â€œslaveâ€ task that you manually driveâ€”by indicating when the operation finishes or faults. This is ideal for I/Obound work: you get all the benefits of tasks (with their ability to propagate return values, exceptions, and continuations) without blocking a thread for the duration of the operation.</p>
<p>To use TaskCompletionSource, you simply instantiate the class. It exposes a Task property that returns a task upon which you can wait and attach continuationsâ€” just as with any other task. The task, however, is controlled entirely by the TaskCompletionSource object via the following methods</p>
<div class="language-csharp highlight"><pre><span></span><code><span id="__span-183-1"><a id="__codelineno-183-1" name="__codelineno-183-1" href="#__codelineno-183-1"></a><span class="k">public</span><span class="w"> </span><span class="k">class</span><span class="w"> </span><span class="nc">TaskCompletionSource</span><span class="o">&lt;</span><span class="n">TResult</span><span class="o">&gt;</span>
</span><span id="__span-183-2"><a id="__codelineno-183-2" name="__codelineno-183-2" href="#__codelineno-183-2"></a><span class="p">{</span>
</span><span id="__span-183-3"><a id="__codelineno-183-3" name="__codelineno-183-3" href="#__codelineno-183-3"></a><span class="w"> </span><span class="k">public</span><span class="w"> </span><span class="k">void</span><span class="w"> </span><span class="nf">SetResult</span><span class="w"> </span><span class="p">(</span><span class="n">TResult</span><span class="w"> </span><span class="n">result</span><span class="p">);</span>
</span><span id="__span-183-4"><a id="__codelineno-183-4" name="__codelineno-183-4" href="#__codelineno-183-4"></a><span class="w"> </span><span class="k">public</span><span class="w"> </span><span class="k">void</span><span class="w"> </span><span class="nf">SetException</span><span class="w"> </span><span class="p">(</span><span class="n">Exception</span><span class="w"> </span><span class="n">exception</span><span class="p">);</span>
</span><span id="__span-183-5"><a id="__codelineno-183-5" name="__codelineno-183-5" href="#__codelineno-183-5"></a><span class="w"> </span><span class="k">public</span><span class="w"> </span><span class="k">void</span><span class="w"> </span><span class="nf">SetCanceled</span><span class="p">();</span>
</span><span id="__span-183-6"><a id="__codelineno-183-6" name="__codelineno-183-6" href="#__codelineno-183-6"></a><span class="w"> </span><span class="k">public</span><span class="w"> </span><span class="kt">bool</span><span class="w"> </span><span class="nf">TrySetResult</span><span class="w"> </span><span class="p">(</span><span class="n">TResult</span><span class="w"> </span><span class="n">result</span><span class="p">);</span>
</span><span id="__span-183-7"><a id="__codelineno-183-7" name="__codelineno-183-7" href="#__codelineno-183-7"></a><span class="w"> </span><span class="k">public</span><span class="w"> </span><span class="kt">bool</span><span class="w"> </span><span class="nf">TrySetException</span><span class="w"> </span><span class="p">(</span><span class="n">Exception</span><span class="w"> </span><span class="n">exception</span><span class="p">);</span>
</span><span id="__span-183-8"><a id="__codelineno-183-8" name="__codelineno-183-8" href="#__codelineno-183-8"></a><span class="w"> </span><span class="k">public</span><span class="w"> </span><span class="kt">bool</span><span class="w"> </span><span class="nf">TrySetCanceled</span><span class="p">();</span>
</span><span id="__span-183-9"><a id="__codelineno-183-9" name="__codelineno-183-9" href="#__codelineno-183-9"></a><span class="w"> </span><span class="k">public</span><span class="w"> </span><span class="kt">bool</span><span class="w"> </span><span class="nf">TrySetCanceled</span><span class="w"> </span><span class="p">(</span><span class="n">CancellationToken</span><span class="w"> </span><span class="n">cancellationToken</span><span class="p">);</span>
</span><span id="__span-183-10"><a id="__codelineno-183-10" name="__codelineno-183-10" href="#__codelineno-183-10"></a><span class="w"> </span><span class="p">...</span>
</span><span id="__span-183-11"><a id="__codelineno-183-11" name="__codelineno-183-11" href="#__codelineno-183-11"></a><span class="p">}</span>
</span></code></pre></div>
<div class="language-csharp highlight"><pre><span></span><code><span id="__span-184-1"><a id="__codelineno-184-1" name="__codelineno-184-1" href="#__codelineno-184-1"></a><span class="kt">var</span><span class="w"> </span><span class="n">tcs</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">TaskCompletionSource</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span><span class="p">();</span>
</span><span id="__span-184-2"><a id="__codelineno-184-2" name="__codelineno-184-2" href="#__codelineno-184-2"></a><span class="k">new</span><span class="w"> </span><span class="nf">Thread</span><span class="w"> </span><span class="p">(()</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">Thread</span><span class="p">.</span><span class="n">Sleep</span><span class="w"> </span><span class="p">(</span><span class="mi">5000</span><span class="p">);</span><span class="w"> </span><span class="n">tcs</span><span class="p">.</span><span class="n">SetResult</span><span class="w"> </span><span class="p">(</span><span class="mi">42</span><span class="p">);</span><span class="w"> </span><span class="p">})</span>
</span><span id="__span-184-3"><a id="__codelineno-184-3" name="__codelineno-184-3" href="#__codelineno-184-3"></a><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">IsBackground</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">true</span><span class="w"> </span><span class="p">}</span>
</span><span id="__span-184-4"><a id="__codelineno-184-4" name="__codelineno-184-4" href="#__codelineno-184-4"></a><span class="w"> </span><span class="p">.</span><span class="n">Start</span><span class="p">();</span>
</span><span id="__span-184-5"><a id="__codelineno-184-5" name="__codelineno-184-5" href="#__codelineno-184-5"></a><span class="n">Task</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span><span class="w"> </span><span class="n">task</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">tcs</span><span class="p">.</span><span class="n">Task</span><span class="p">;</span><span class="w"> </span><span class="c1">// Our &quot;slave&quot; task.</span>
</span><span id="__span-184-6"><a id="__codelineno-184-6" name="__codelineno-184-6" href="#__codelineno-184-6"></a><span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="w"> </span><span class="p">(</span><span class="n">task</span><span class="p">.</span><span class="n">Result</span><span class="p">);</span><span class="w"> </span><span class="c1">// 42</span>
</span></code></pre></div>
<p>With TaskCompletionSource, we can write our own Run method</p>
<div class="language-csharp highlight"><pre><span></span><code><span id="__span-185-1"><a id="__codelineno-185-1" name="__codelineno-185-1" href="#__codelineno-185-1"></a><span class="k">void</span><span class="w"> </span><span class="nf">Main</span><span class="p">()</span>
</span><span id="__span-185-2"><a id="__codelineno-185-2" name="__codelineno-185-2" href="#__codelineno-185-2"></a><span class="p">{</span>
</span><span id="__span-185-3"><a id="__codelineno-185-3" name="__codelineno-185-3" href="#__codelineno-185-3"></a><span class="w">    </span><span class="n">Task</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span><span class="w"> </span><span class="n">task</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Run</span><span class="w"> </span><span class="p">(()</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">Thread</span><span class="p">.</span><span class="n">Sleep</span><span class="w"> </span><span class="p">(</span><span class="mi">5000</span><span class="p">);</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="mi">42</span><span class="p">;</span><span class="w"> </span><span class="p">});</span>
</span><span id="__span-185-4"><a id="__codelineno-185-4" name="__codelineno-185-4" href="#__codelineno-185-4"></a><span class="w">    </span><span class="n">task</span><span class="p">.</span><span class="n">Result</span><span class="p">.</span><span class="n">Dump</span><span class="p">();</span>
</span><span id="__span-185-5"><a id="__codelineno-185-5" name="__codelineno-185-5" href="#__codelineno-185-5"></a><span class="p">}</span>
</span><span id="__span-185-6"><a id="__codelineno-185-6" name="__codelineno-185-6" href="#__codelineno-185-6"></a>
</span><span id="__span-185-7"><a id="__codelineno-185-7" name="__codelineno-185-7" href="#__codelineno-185-7"></a><span class="n">Task</span><span class="o">&lt;</span><span class="n">TResult</span><span class="o">&gt;</span><span class="w"> </span><span class="n">Run</span><span class="o">&lt;</span><span class="n">TResult</span><span class="o">&gt;</span><span class="w"> </span><span class="p">(</span><span class="n">Func</span><span class="o">&lt;</span><span class="n">TResult</span><span class="o">&gt;</span><span class="w"> </span><span class="n">function</span><span class="p">)</span>
</span><span id="__span-185-8"><a id="__codelineno-185-8" name="__codelineno-185-8" href="#__codelineno-185-8"></a><span class="p">{</span>
</span><span id="__span-185-9"><a id="__codelineno-185-9" name="__codelineno-185-9" href="#__codelineno-185-9"></a><span class="w">    </span><span class="kt">var</span><span class="w"> </span><span class="n">tcs</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">TaskCompletionSource</span><span class="o">&lt;</span><span class="n">TResult</span><span class="o">&gt;</span><span class="p">();</span>
</span><span id="__span-185-10"><a id="__codelineno-185-10" name="__codelineno-185-10" href="#__codelineno-185-10"></a><span class="w">    </span><span class="k">new</span><span class="w"> </span><span class="nf">Thread</span><span class="w"> </span><span class="p">(()</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span>
</span><span id="__span-185-11"><a id="__codelineno-185-11" name="__codelineno-185-11" href="#__codelineno-185-11"></a><span class="w">    </span><span class="p">{</span>
</span><span id="__span-185-12"><a id="__codelineno-185-12" name="__codelineno-185-12" href="#__codelineno-185-12"></a><span class="w">        </span><span class="k">try</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">tcs</span><span class="p">.</span><span class="n">SetResult</span><span class="w"> </span><span class="p">(</span><span class="n">function</span><span class="p">());</span><span class="w"> </span><span class="p">}</span>
</span><span id="__span-185-13"><a id="__codelineno-185-13" name="__codelineno-185-13" href="#__codelineno-185-13"></a><span class="w">        </span><span class="k">catch</span><span class="w"> </span><span class="p">(</span><span class="n">Exception</span><span class="w"> </span><span class="n">ex</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">tcs</span><span class="p">.</span><span class="n">SetException</span><span class="w"> </span><span class="p">(</span><span class="n">ex</span><span class="p">);</span><span class="w"> </span><span class="p">}</span>
</span><span id="__span-185-14"><a id="__codelineno-185-14" name="__codelineno-185-14" href="#__codelineno-185-14"></a><span class="w">    </span><span class="p">}).</span><span class="n">Start</span><span class="p">();</span>
</span><span id="__span-185-15"><a id="__codelineno-185-15" name="__codelineno-185-15" href="#__codelineno-185-15"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">tcs</span><span class="p">.</span><span class="n">Task</span><span class="p">;</span>
</span><span id="__span-185-16"><a id="__codelineno-185-16" name="__codelineno-185-16" href="#__codelineno-185-16"></a><span class="p">}</span>
</span></code></pre></div>
<p>Now we can write our general-purpose Delay method</p>
<div class="language-csharp highlight"><pre><span></span><code><span id="__span-186-1"><a id="__codelineno-186-1" name="__codelineno-186-1" href="#__codelineno-186-1"></a><span class="k">void</span><span class="w"> </span><span class="nf">Main</span><span class="p">()</span>
</span><span id="__span-186-2"><a id="__codelineno-186-2" name="__codelineno-186-2" href="#__codelineno-186-2"></a><span class="p">{</span>
</span><span id="__span-186-3"><a id="__codelineno-186-3" name="__codelineno-186-3" href="#__codelineno-186-3"></a><span class="w">    </span><span class="n">Delay</span><span class="w"> </span><span class="p">(</span><span class="mi">5000</span><span class="p">).</span><span class="n">GetAwaiter</span><span class="p">().</span><span class="n">OnCompleted</span><span class="w"> </span><span class="p">(()</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="w"> </span><span class="p">(</span><span class="mi">42</span><span class="p">));</span>
</span><span id="__span-186-4"><a id="__codelineno-186-4" name="__codelineno-186-4" href="#__codelineno-186-4"></a><span class="p">}</span>
</span><span id="__span-186-5"><a id="__codelineno-186-5" name="__codelineno-186-5" href="#__codelineno-186-5"></a>
</span><span id="__span-186-6"><a id="__codelineno-186-6" name="__codelineno-186-6" href="#__codelineno-186-6"></a><span class="n">Task</span><span class="w"> </span><span class="nf">Delay</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">milliseconds</span><span class="p">)</span>
</span><span id="__span-186-7"><a id="__codelineno-186-7" name="__codelineno-186-7" href="#__codelineno-186-7"></a><span class="p">{</span>
</span><span id="__span-186-8"><a id="__codelineno-186-8" name="__codelineno-186-8" href="#__codelineno-186-8"></a><span class="w">    </span><span class="kt">var</span><span class="w"> </span><span class="n">tcs</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">TaskCompletionSource</span><span class="o">&lt;</span><span class="kt">object</span><span class="o">&gt;</span><span class="p">();</span>
</span><span id="__span-186-9"><a id="__codelineno-186-9" name="__codelineno-186-9" href="#__codelineno-186-9"></a><span class="w">    </span><span class="kt">var</span><span class="w"> </span><span class="n">timer</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">System</span><span class="p">.</span><span class="n">Timers</span><span class="p">.</span><span class="n">Timer</span><span class="w"> </span><span class="p">(</span><span class="n">milliseconds</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">AutoReset</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">false</span><span class="w"> </span><span class="p">};</span>
</span><span id="__span-186-10"><a id="__codelineno-186-10" name="__codelineno-186-10" href="#__codelineno-186-10"></a><span class="w">    </span><span class="n">timer</span><span class="p">.</span><span class="n">Elapsed</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="k">delegate</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">timer</span><span class="p">.</span><span class="n">Dispose</span><span class="p">();</span><span class="w"> </span><span class="n">tcs</span><span class="p">.</span><span class="n">SetResult</span><span class="w"> </span><span class="p">(</span><span class="k">null</span><span class="p">);</span><span class="w"> </span><span class="p">};</span>
</span><span id="__span-186-11"><a id="__codelineno-186-11" name="__codelineno-186-11" href="#__codelineno-186-11"></a><span class="w">    </span><span class="n">timer</span><span class="p">.</span><span class="n">Start</span><span class="p">();</span>
</span><span id="__span-186-12"><a id="__codelineno-186-12" name="__codelineno-186-12" href="#__codelineno-186-12"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">tcs</span><span class="p">.</span><span class="n">Task</span><span class="p">;</span>
</span><span id="__span-186-13"><a id="__codelineno-186-13" name="__codelineno-186-13" href="#__codelineno-186-13"></a><span class="p">}</span>
</span></code></pre></div>
<h2 id="taskdelay">Task.Delay</h2>
<p>The Delay method that we just wrote is sufficiently useful that itâ€™s available as a static method on the Task class</p>
<div class="language-csharp highlight"><pre><span></span><code><span id="__span-187-1"><a id="__codelineno-187-1" name="__codelineno-187-1" href="#__codelineno-187-1"></a><span class="n">Task</span><span class="p">.</span><span class="n">Delay</span><span class="w"> </span><span class="p">(</span><span class="mi">5000</span><span class="p">).</span><span class="n">GetAwaiter</span><span class="p">().</span><span class="n">OnCompleted</span><span class="w"> </span><span class="p">(()</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="w"> </span><span class="p">(</span><span class="mi">42</span><span class="p">));</span>
</span></code></pre></div>
<p>Task.Delay is the asynchronous equivalent of Thread.Sleep.</p>
<h1 id="principles-of-asynchrony">Principles of Asynchrony</h1>
<h2 id="synchronous-versus-asynchronous-operations">Synchronous versus Asynchronous Operations</h2>
<p>A synchronous operation does its work before returning to the caller. </p>
<p>An asynchronous operation can do (most or all of) its work after returning to the caller.</p>
<p>The majority of methods that you write and call are synchronous. An example is List<T>.Add, or Console.WriteLine, or Thread.Sleep. Asynchronous methods are less common and initiate concurrency, because work continues in parallel to the caller. Asynchronous methods typically return quickly (or immediately) to the caller; thus, they are also called nonblocking methods.</p>
<p>Most of the asynchronous methods that weâ€™ve seen so far can be described as general-purpose methods</p>
<ul>
<li>Thread.Start</li>
<li>Task.Run</li>
<li>Methods that attach continuations to tasks</li>
</ul>
<h2 id="what-is-asynchronous-programming">What Is Asynchronous Programming?</h2>
<p>The principle of asynchronous programming is that you write long-running (or potentially long-running) functions asynchronously. This is in contrast to the conventional approach of writing long-running functions synchronously, and then calling those functions from a new thread or task to introduce concurrency as required.</p>
<p>The difference with the asynchronous approach is that concurrency is initiated inside the long-running function rather than from outside the function. This has two benefits</p>
<ul>
<li>I/O-bound concurrency can be implemented without tying up threads (as we demonstrate in â€œTaskCompletionSourceâ€ on page 598), improving scalability and efficiency.</li>
<li>Rich-client applications end up with less code on worker threads, simplifying thread safety</li>
</ul>
<p>This, in turn, leads to two distinct uses for asynchronous programming. The first is writing (typically server-side) applications that deal efficiently with a lot of concurâ€ rent I/O. The challenge here is not thread safety (because thereâ€™s usually minimal shared state) but thread efficiency; in particular, not consuming a thread per netâ€ work request. So, in this context, itâ€™s only I/O-bound operations that benefit from asynchrony.</p>
<p>The second use is to simplify thread safety in rich-client applications. This is particularly relevant as a program grows in size, because to deal with complexity, we typically refactor larger methods into smaller ones, resulting in chains of methods that call one another (call graphs).</p>
<p>With a traditional synchronous call graph, if any operation within the graph is longrunning, we must run the entire call graph on a worker thread to maintain a responsive UI. Hence, we end up with a single concurrent operation that spans many methods (coarse-grained concurrency), and this requires considering thread safety for every method in the graph.</p>
<p>With an asynchronous call graph, we need not start a thread until itâ€™s actually needed, typically low in the graph (or not at all in the case of I/O-bound operations). All other methods can run entirely on the UI thread, with much-simplified thread safety. This results in fine-grained concurrencyâ€”a sequence of small concurâ€ rent operations, between which execution bounces to the UI thread.</p>
<p>To benefit from this, both I/O- and compute-bound operations need to be written asynchronously; a good rule of thumb is to include anything that might take longer than 50 ms.</p>
<h1 id="obsolete-patterns">Obsolete Patterns</h1>
<h2 id="event-based-asynchronous-pattern">Event-Based Asynchronous Pattern</h2>
<h3 id="backgroundworker">BackgroundWorker</h3>
<p>BackgroundWorker in System.ComponentModel is a general-purpose implementaâ€ tion of the EAP. It allows rich-client apps to start a worker thread and report completion and percentage-based progress without needing to explicitly capture synchronization context. Hereâ€™s an example:</p>
<div class="language-csharp highlight"><pre><span></span><code><span id="__span-188-1"><a id="__codelineno-188-1" name="__codelineno-188-1" href="#__codelineno-188-1"></a><span class="kt">var</span><span class="w"> </span><span class="n">worker</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">BackgroundWorker</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">WorkerSupportsCancellation</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">true</span><span class="w"> </span><span class="p">};</span>
</span><span id="__span-188-2"><a id="__codelineno-188-2" name="__codelineno-188-2" href="#__codelineno-188-2"></a><span class="n">worker</span><span class="p">.</span><span class="n">DoWork</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="p">(</span><span class="n">sender</span><span class="p">,</span><span class="w"> </span><span class="n">args</span><span class="p">)</span><span class="w"> </span><span class="o">=&gt;</span>
</span><span id="__span-188-3"><a id="__codelineno-188-3" name="__codelineno-188-3" href="#__codelineno-188-3"></a><span class="p">{</span><span class="w"> </span><span class="c1">// This runs on a worker thread</span>
</span><span id="__span-188-4"><a id="__codelineno-188-4" name="__codelineno-188-4" href="#__codelineno-188-4"></a><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">args</span><span class="p">.</span><span class="n">Cancel</span><span class="p">)</span><span class="w"> </span><span class="k">return</span><span class="p">;</span>
</span><span id="__span-188-5"><a id="__codelineno-188-5" name="__codelineno-188-5" href="#__codelineno-188-5"></a><span class="w"> </span><span class="n">Thread</span><span class="p">.</span><span class="n">Sleep</span><span class="p">(</span><span class="mi">1000</span><span class="p">);</span>
</span><span id="__span-188-6"><a id="__codelineno-188-6" name="__codelineno-188-6" href="#__codelineno-188-6"></a><span class="w"> </span><span class="n">args</span><span class="p">.</span><span class="n">Result</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">123</span><span class="p">;</span>
</span><span id="__span-188-7"><a id="__codelineno-188-7" name="__codelineno-188-7" href="#__codelineno-188-7"></a><span class="p">};</span>
</span><span id="__span-188-8"><a id="__codelineno-188-8" name="__codelineno-188-8" href="#__codelineno-188-8"></a><span class="n">worker</span><span class="p">.</span><span class="n">RunWorkerCompleted</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="p">(</span><span class="n">sender</span><span class="p">,</span><span class="w"> </span><span class="n">args</span><span class="p">)</span><span class="w"> </span><span class="o">=&gt;</span>
</span><span id="__span-188-9"><a id="__codelineno-188-9" name="__codelineno-188-9" href="#__codelineno-188-9"></a><span class="p">{</span><span class="w"> </span><span class="c1">// Runs on UI thread</span>
</span><span id="__span-188-10"><a id="__codelineno-188-10" name="__codelineno-188-10" href="#__codelineno-188-10"></a><span class="w"> </span><span class="c1">// We can safely update UI controls here...</span>
</span><span id="__span-188-11"><a id="__codelineno-188-11" name="__codelineno-188-11" href="#__codelineno-188-11"></a><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">args</span><span class="p">.</span><span class="n">Cancelled</span><span class="p">)</span>
</span><span id="__span-188-12"><a id="__codelineno-188-12" name="__codelineno-188-12" href="#__codelineno-188-12"></a><span class="w"> </span><span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="w"> </span><span class="p">(</span><span class="s">&quot;Cancelled&quot;</span><span class="p">);</span>
</span><span id="__span-188-13"><a id="__codelineno-188-13" name="__codelineno-188-13" href="#__codelineno-188-13"></a><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="nf">if</span><span class="w"> </span><span class="p">(</span><span class="n">args</span><span class="p">.</span><span class="n">Error</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="k">null</span><span class="p">)</span>
</span><span id="__span-188-14"><a id="__codelineno-188-14" name="__codelineno-188-14" href="#__codelineno-188-14"></a><span class="w"> </span><span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="w"> </span><span class="p">(</span><span class="s">&quot;Error: &quot;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">args</span><span class="p">.</span><span class="n">Error</span><span class="p">.</span><span class="n">Message</span><span class="p">);</span>
</span><span id="__span-188-15"><a id="__codelineno-188-15" name="__codelineno-188-15" href="#__codelineno-188-15"></a><span class="w"> </span><span class="k">else</span>
</span><span id="__span-188-16"><a id="__codelineno-188-16" name="__codelineno-188-16" href="#__codelineno-188-16"></a><span class="w"> </span><span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="w"> </span><span class="p">(</span><span class="s">&quot;Result is: &quot;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">args</span><span class="p">.</span><span class="n">Result</span><span class="p">);</span>
</span><span id="__span-188-17"><a id="__codelineno-188-17" name="__codelineno-188-17" href="#__codelineno-188-17"></a><span class="p">};</span>
</span><span id="__span-188-18"><a id="__codelineno-188-18" name="__codelineno-188-18" href="#__codelineno-188-18"></a><span class="n">worker</span><span class="p">.</span><span class="n">RunWorkerAsync</span><span class="p">();</span><span class="w"> </span><span class="c1">// Captures sync context and starts operation</span>
</span></code></pre></div>
<p>RunWorkerAsync starts the operation, firing the DoWork event on a pooled worker thread. It also captures the synchronization context, and when the operation completes (or faults), the RunWorkerCompleted event is invoked through that synchroniâ€ zation context (like a continuation).# Chapter 15 : Streams and I/O</p>
<h1 id="stream-architecture">Stream Architecture</h1>
<p>The .NET stream architecture centers on three concepts: backing stores, decorators, and adapters</p>
<p>A backing store is the endpoint that makes input and output useful, such as a file or network connection. Precisely, it is either or both of the following</p>
<ul>
<li>A source from which bytes can be sequentially read</li>
<li>A destination to which bytes can be sequentially written</li>
</ul>
<p>A backing store is of no use, though, unless exposed to the programmer. A Stream is the standard .NET class for this purpose; it exposes a standard set of methods for reading, writing, and positioning. Unlike an array, for which all the backing data exists in memory at once, a stream deals with data seriallyâ€”either one byte at a time or in blocks of a manageable size. Hence, a stream can use a small, fixed amount of memory regardless of the size of its backing store.</p>
<p>Backing store streams</p>
<ul>
<li>These are hardwired to a particular type of backing store, such as FileStream or NetworkStream.</li>
</ul>
<p>Decorator streams</p>
<ul>
<li>These feed off another stream, transforming the data in some way, such as DeflateStream or CryptoStream.</li>
</ul>
<p>Decorator streams have the following architectural benefit</p>
<ul>
<li>They liberate backing store streams from needing to implement such features as compression and encryption themselves.</li>
<li>Streams donâ€™t suffer a change of interface when decorated.</li>
<li>You connect decorators at runtime.</li>
<li>You can chain decorators together (e.g., a compressor followed by an encryptor).</li>
</ul>
<p>Both backing store and decorator streams deal exclusively in bytes. Although this is flexible and efficient, applications often work at higher levels such as text or XML. Adapters bridge this gap by wrapping a stream in a class with specialized methods typed to a particular format. For example, a text reader exposes a ReadLine method; an XML writer exposes a WriteAttributes method.</p>
<p>To summarize, backing store streams provide the raw data; decorator streams provide transparent binary transformations such as encryption; adapters offer typed methods for dealing in higher-level types such as strings and XML.</p>
<h1 id="using-streams">Using Streams</h1>
<p>The abstract Stream class is the base for all streams. It defines methods and properâ€ ties for three fundamental operations: reading, writing, and seeking, as well as for administrative tasks such as closing, flushing, and configuring timeouts</p>
<p>There are also asynchronous versions of the Read and Write methods, both of which return Tasks and optionally accept a cancellation token, and overloads that work with Span<T> and Memory<T> types</p>
<div class="language-csharp highlight"><pre><span></span><code><span id="__span-189-1"><a id="__codelineno-189-1" name="__codelineno-189-1" href="#__codelineno-189-1"></a><span class="k">using</span><span class="w"> </span><span class="nn">System</span><span class="p">;</span>
</span><span id="__span-189-2"><a id="__codelineno-189-2" name="__codelineno-189-2" href="#__codelineno-189-2"></a><span class="k">using</span><span class="w"> </span><span class="nn">System.IO</span><span class="p">;</span>
</span><span id="__span-189-3"><a id="__codelineno-189-3" name="__codelineno-189-3" href="#__codelineno-189-3"></a><span class="k">class</span><span class="w"> </span><span class="nc">Program</span>
</span><span id="__span-189-4"><a id="__codelineno-189-4" name="__codelineno-189-4" href="#__codelineno-189-4"></a><span class="p">{</span>
</span><span id="__span-189-5"><a id="__codelineno-189-5" name="__codelineno-189-5" href="#__codelineno-189-5"></a><span class="w"> </span><span class="k">static</span><span class="w"> </span><span class="k">void</span><span class="w"> </span><span class="nf">Main</span><span class="p">()</span>
</span><span id="__span-189-6"><a id="__codelineno-189-6" name="__codelineno-189-6" href="#__codelineno-189-6"></a><span class="w"> </span><span class="p">{</span>
</span><span id="__span-189-7"><a id="__codelineno-189-7" name="__codelineno-189-7" href="#__codelineno-189-7"></a><span class="w"> </span><span class="c1">// Create a file called test.txt in the current directory:</span>
</span><span id="__span-189-8"><a id="__codelineno-189-8" name="__codelineno-189-8" href="#__codelineno-189-8"></a><span class="w"> </span><span class="k">using</span><span class="w"> </span><span class="p">(</span><span class="n">Stream</span><span class="w"> </span><span class="n">s</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">FileStream</span><span class="w"> </span><span class="p">(</span><span class="s">&quot;test.txt&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">FileMode</span><span class="p">.</span><span class="n">Create</span><span class="p">))</span>
</span><span id="__span-189-9"><a id="__codelineno-189-9" name="__codelineno-189-9" href="#__codelineno-189-9"></a><span class="w"> </span><span class="p">{</span>
</span><span id="__span-189-10"><a id="__codelineno-189-10" name="__codelineno-189-10" href="#__codelineno-189-10"></a><span class="w"> </span><span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="w"> </span><span class="p">(</span><span class="n">s</span><span class="p">.</span><span class="n">CanRead</span><span class="p">);</span><span class="w"> </span><span class="c1">// True</span>
</span><span id="__span-189-11"><a id="__codelineno-189-11" name="__codelineno-189-11" href="#__codelineno-189-11"></a><span class="w"> </span><span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="w"> </span><span class="p">(</span><span class="n">s</span><span class="p">.</span><span class="n">CanWrite</span><span class="p">);</span><span class="w"> </span><span class="c1">// True</span>
</span><span id="__span-189-12"><a id="__codelineno-189-12" name="__codelineno-189-12" href="#__codelineno-189-12"></a><span class="w"> </span><span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="w"> </span><span class="p">(</span><span class="n">s</span><span class="p">.</span><span class="n">CanSeek</span><span class="p">);</span><span class="w"> </span><span class="c1">// True</span>
</span><span id="__span-189-13"><a id="__codelineno-189-13" name="__codelineno-189-13" href="#__codelineno-189-13"></a><span class="w"> </span><span class="n">s</span><span class="p">.</span><span class="n">WriteByte</span><span class="w"> </span><span class="p">(</span><span class="mi">101</span><span class="p">);</span>
</span><span id="__span-189-14"><a id="__codelineno-189-14" name="__codelineno-189-14" href="#__codelineno-189-14"></a><span class="w"> </span><span class="n">s</span><span class="p">.</span><span class="n">WriteByte</span><span class="w"> </span><span class="p">(</span><span class="mi">102</span><span class="p">);</span>
</span><span id="__span-189-15"><a id="__codelineno-189-15" name="__codelineno-189-15" href="#__codelineno-189-15"></a><span class="w"> </span><span class="kt">byte</span><span class="p">[]</span><span class="w"> </span><span class="n">block</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="mi">3</span><span class="p">,</span><span class="w"> </span><span class="mi">4</span><span class="p">,</span><span class="w"> </span><span class="mi">5</span><span class="w"> </span><span class="p">};</span>
</span><span id="__span-189-16"><a id="__codelineno-189-16" name="__codelineno-189-16" href="#__codelineno-189-16"></a><span class="w"> </span><span class="n">s</span><span class="p">.</span><span class="n">Write</span><span class="w"> </span><span class="p">(</span><span class="n">block</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="n">block</span><span class="p">.</span><span class="n">Length</span><span class="p">);</span><span class="w"> </span><span class="c1">// Write block of 5 bytes</span>
</span><span id="__span-189-17"><a id="__codelineno-189-17" name="__codelineno-189-17" href="#__codelineno-189-17"></a><span class="w"> </span><span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="w"> </span><span class="p">(</span><span class="n">s</span><span class="p">.</span><span class="n">Length</span><span class="p">);</span><span class="w"> </span><span class="c1">// 7</span>
</span><span id="__span-189-18"><a id="__codelineno-189-18" name="__codelineno-189-18" href="#__codelineno-189-18"></a><span class="w"> </span><span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="w"> </span><span class="p">(</span><span class="n">s</span><span class="p">.</span><span class="n">Position</span><span class="p">);</span><span class="w"> </span><span class="c1">// 7</span>
</span><span id="__span-189-19"><a id="__codelineno-189-19" name="__codelineno-189-19" href="#__codelineno-189-19"></a><span class="w"> </span><span class="o">**</span><span class="n">s</span><span class="p">.</span><span class="n">Position</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="c1">// Move back to the start**</span>
</span><span id="__span-189-20"><a id="__codelineno-189-20" name="__codelineno-189-20" href="#__codelineno-189-20"></a><span class="w"> </span><span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="w"> </span><span class="p">(</span><span class="n">s</span><span class="p">.</span><span class="n">ReadByte</span><span class="p">());</span><span class="w"> </span><span class="c1">// 101</span>
</span><span id="__span-189-21"><a id="__codelineno-189-21" name="__codelineno-189-21" href="#__codelineno-189-21"></a><span class="w"> </span><span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="w"> </span><span class="p">(</span><span class="n">s</span><span class="p">.</span><span class="n">ReadByte</span><span class="p">());</span><span class="w"> </span><span class="c1">// 102</span>
</span><span id="__span-189-22"><a id="__codelineno-189-22" name="__codelineno-189-22" href="#__codelineno-189-22"></a><span class="w"> </span><span class="c1">// Read from the stream back into the block array:</span>
</span><span id="__span-189-23"><a id="__codelineno-189-23" name="__codelineno-189-23" href="#__codelineno-189-23"></a><span class="w"> </span><span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="w"> </span><span class="p">(</span><span class="n">s</span><span class="p">.</span><span class="n">Read</span><span class="w"> </span><span class="p">(</span><span class="n">block</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="n">block</span><span class="p">.</span><span class="n">Length</span><span class="p">));</span><span class="w"> </span><span class="c1">// 5</span>
</span><span id="__span-189-24"><a id="__codelineno-189-24" name="__codelineno-189-24" href="#__codelineno-189-24"></a><span class="w"> </span><span class="c1">// Assuming the last Read returned 5, we&#39;ll be at</span>
</span><span id="__span-189-25"><a id="__codelineno-189-25" name="__codelineno-189-25" href="#__codelineno-189-25"></a><span class="w"> </span><span class="c1">// the end of the file, so Read will now return 0:</span>
</span><span id="__span-189-26"><a id="__codelineno-189-26" name="__codelineno-189-26" href="#__codelineno-189-26"></a><span class="w"> </span><span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="w"> </span><span class="p">(</span><span class="n">s</span><span class="p">.</span><span class="n">Read</span><span class="w"> </span><span class="p">(</span><span class="n">block</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="n">block</span><span class="p">.</span><span class="n">Length</span><span class="p">));</span><span class="w"> </span><span class="c1">// 0</span>
</span><span id="__span-189-27"><a id="__codelineno-189-27" name="__codelineno-189-27" href="#__codelineno-189-27"></a><span class="w"> </span><span class="p">}</span>
</span><span id="__span-189-28"><a id="__codelineno-189-28" name="__codelineno-189-28" href="#__codelineno-189-28"></a><span class="w"> </span><span class="p">}</span>
</span><span id="__span-189-29"><a id="__codelineno-189-29" name="__codelineno-189-29" href="#__codelineno-189-29"></a><span class="p">}</span>
</span></code></pre></div>
<h2 id="reading-and-writing">Reading and Writing</h2>
<p>A stream can support reading, writing, or both. If CanWrite returns false, the stream is read-only; if CanRead returns false, the stream is write-only</p>
<p>Read receives a block of data from the stream into an array. It returns the number of bytes received, which is always either less than or equal to the count argument. If itâ€™s less than count, it means that either the end of the stream has been reached or the stream is giving you the data in smaller chunks (as is often the case with network streams). In either case, the balance of bytes in the array will remain unwritten, their previous values preserved.</p>
<p>The Read method could read anywhere from 1 to 1,000 bytes, leaving the balance of the stream unread.</p>
<p>Hereâ€™s the correct way to read a 1,000-byte stream:</p>
<div class="language-csharp highlight"><pre><span></span><code><span id="__span-190-1"><a id="__codelineno-190-1" name="__codelineno-190-1" href="#__codelineno-190-1"></a><span class="kt">byte</span><span class="p">[]</span><span class="w"> </span><span class="n">data</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="kt">byte</span><span class="w"> </span><span class="p">[</span><span class="mi">1000</span><span class="p">];</span>
</span><span id="__span-190-2"><a id="__codelineno-190-2" name="__codelineno-190-2" href="#__codelineno-190-2"></a><span class="c1">// bytesRead will always end up at 1000, unless the stream is</span>
</span><span id="__span-190-3"><a id="__codelineno-190-3" name="__codelineno-190-3" href="#__codelineno-190-3"></a><span class="c1">// itself smaller in length:</span>
</span><span id="__span-190-4"><a id="__codelineno-190-4" name="__codelineno-190-4" href="#__codelineno-190-4"></a><span class="kt">int</span><span class="w"> </span><span class="n">bytesRead</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
</span><span id="__span-190-5"><a id="__codelineno-190-5" name="__codelineno-190-5" href="#__codelineno-190-5"></a><span class="kt">int</span><span class="w"> </span><span class="n">chunkSize</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span>
</span><span id="__span-190-6"><a id="__codelineno-190-6" name="__codelineno-190-6" href="#__codelineno-190-6"></a><span class="k">while</span><span class="w"> </span><span class="p">(</span><span class="n">bytesRead</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">data</span><span class="p">.</span><span class="n">Length</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">chunkSize</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span>
</span><span id="__span-190-7"><a id="__codelineno-190-7" name="__codelineno-190-7" href="#__codelineno-190-7"></a><span class="w"> </span><span class="n">bytesRead</span><span class="w"> </span><span class="o">+=</span>
</span><span id="__span-190-8"><a id="__codelineno-190-8" name="__codelineno-190-8" href="#__codelineno-190-8"></a><span class="w"> </span><span class="n">chunkSize</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">s</span><span class="p">.</span><span class="n">Read</span><span class="w"> </span><span class="p">(</span><span class="n">data</span><span class="p">,</span><span class="w"> </span><span class="n">bytesRead</span><span class="p">,</span><span class="w"> </span><span class="n">data</span><span class="p">.</span><span class="n">Length</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">bytesRead</span><span class="p">);</span>
</span></code></pre></div>
<p>Fortunately, the BinaryReader type provides a simpler way to achieve the same result</p>
<div class="language-csharp highlight"><pre><span></span><code><span id="__span-191-1"><a id="__codelineno-191-1" name="__codelineno-191-1" href="#__codelineno-191-1"></a><span class="kt">byte</span><span class="p">[]</span><span class="w"> </span><span class="n">data</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">BinaryReader</span><span class="w"> </span><span class="p">(</span><span class="n">s</span><span class="p">).</span><span class="n">ReadBytes</span><span class="w"> </span><span class="p">(</span><span class="mi">1000</span><span class="p">);</span>
</span></code></pre></div>
<h2 id="seeking">Seeking</h2>
<p>A stream is seekable if CanSeek returns true. With a seekable stream (such as a file stream), you can query or modify its Length (by calling SetLength) and at any time change the Position at which youâ€™re reading or writing. The Position property is relative to the beginning of the stream; the Seek method, however, allows you to move relative to the current position or the end of the stream.</p>
<p>With a nonseekable stream (such as an encryption stream), the only way to deterâ€ mine its length is to read it completely through. Furthermore, if you need to reread a previous section, you must close the stream and start afresh with a new one.</p>
<h2 id="closing-and-flushing">Closing and Flushing</h2>
<p>Streams must be disposed after use to release underlying resources such as file and socket handles. A simple way to guarantee this is by instantiating streams within using blocks.</p>
<ul>
<li>Dispose and Close are identical in function.</li>
<li>Disposing or closing a stream repeatedly causes no error.</li>
</ul>
<h2 id="timeouts">Timeouts</h2>
<p>A stream supports read and write timeouts if CanTimeout returns true. Network streams support timeouts; file and memory streams do not. For streams that supâ€ port timeouts, the ReadTimeout and WriteTimeout properties determine the desired timeout in milliseconds, where 0 means no timeout. The Read and Write methods indicate that a timeout has occurred by throwing an exception.</p>
<h2 id="thread-safety">Thread Safety</h2>
<p>As a rule, streams are not thread-safe, meaning that two threads cannot concurrently read or write to the same stream without possible error. The Stream class offers a simple workaround via the static Synchronized method. This method accepts a stream of any type and returns a thread-safe wrapper. The wrapper works by obtaining an exclusive lock around each read, write, or seek, ensuring that only one thread can perform such an operation at a time. In practice, this allows multiple threads to simultaneously append data to the same streamâ€”other kinds of activities (such as concurrent reading) require additional locking to ensure that each thread accesses the desired portion of the stream.</p>
<h2 id="file-streams">File Streams</h2>
<p>The simplest way to instantiate a FileStream is to use one of the following static faÃ§ade methods on the File class</p>
<div class="language-csharp highlight"><pre><span></span><code><span id="__span-192-1"><a id="__codelineno-192-1" name="__codelineno-192-1" href="#__codelineno-192-1"></a><span class="n">FileStream</span><span class="w"> </span><span class="n">fs1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">File</span><span class="p">.</span><span class="n">OpenRead</span><span class="w"> </span><span class="p">(</span><span class="s">&quot;readme.bin&quot;</span><span class="p">);</span><span class="w"> </span><span class="c1">// Read-only</span>
</span><span id="__span-192-2"><a id="__codelineno-192-2" name="__codelineno-192-2" href="#__codelineno-192-2"></a><span class="n">FileStream</span><span class="w"> </span><span class="n">fs2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">File</span><span class="p">.</span><span class="n">OpenWrite</span><span class="w"> </span><span class="p">(</span><span class="s">&quot;writeme.tmp&quot;</span><span class="p">);</span><span class="w"> </span><span class="c1">// Write-only</span>
</span><span id="__span-192-3"><a id="__codelineno-192-3" name="__codelineno-192-3" href="#__codelineno-192-3"></a><span class="n">FileStream</span><span class="w"> </span><span class="n">fs3</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">File</span><span class="p">.</span><span class="n">Create</span><span class="w"> </span><span class="p">(</span><span class="s">&quot;readwrite.tmp&quot;</span><span class="p">);</span><span class="w"> </span><span class="c1">// Read/write</span>
</span></code></pre></div>
<p>You can also directly instantiate a FileStream. Its constructors provide access to every feature, allowing you to specify a filename or low-level file handle, file creation and access modes, and options for sharing, buffering, and security</p>
<div class="language-csharp highlight"><pre><span></span><code><span id="__span-193-1"><a id="__codelineno-193-1" name="__codelineno-193-1" href="#__codelineno-193-1"></a><span class="n">sing</span><span class="w"> </span><span class="kt">var</span><span class="w"> </span><span class="n">fs</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">FileStream</span><span class="w"> </span><span class="p">(</span><span class="s">&quot;readwrite.tmp&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">FileMode</span><span class="p">.</span><span class="n">Open</span><span class="p">);</span>
</span></code></pre></div>
<h3 id="shortcut-methods-on-the-file-class">Shortcut Methods on the File Class</h3>
<p>The following static methods read an entire file into memory in one step</p>
<ul>
<li>File.ReadAllText (returns a string)</li>
<li>File.ReadAllLines (returns an array of strings)</li>
<li>File.ReadAllBytes (returns a byte array)</li>
</ul>
<p>The following static methods write an entire file in one step:</p>
<ul>
<li>File.WriteAllText</li>
<li>File.WriteAllLines</li>
<li>File.WriteAllBytes</li>
<li>File.AppendAllText (great for appending to a log file)</li>
</ul>
<p>Thereâ€™s also a static method called File.ReadLines: this is like ReadAllLines except that it returns a lazily evaluated IEnumerable<string>. This is more efficient because it doesnâ€™t load the entire file into memory at once. LINQ is ideal for consuming the results: the following calculates the number of lines greater than 80 characters in length:</p>
<div class="language-csharp highlight"><pre><span></span><code><span id="__span-194-1"><a id="__codelineno-194-1" name="__codelineno-194-1" href="#__codelineno-194-1"></a><span class="kt">int</span><span class="w"> </span><span class="n">longLines</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">File</span><span class="p">.</span><span class="n">ReadLines</span><span class="w"> </span><span class="p">(</span><span class="s">&quot;filePath&quot;</span><span class="p">)</span>
</span><span id="__span-194-2"><a id="__codelineno-194-2" name="__codelineno-194-2" href="#__codelineno-194-2"></a><span class="w"> </span><span class="p">.</span><span class="n">Count</span><span class="w"> </span><span class="p">(</span><span class="n">l</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="n">l</span><span class="p">.</span><span class="n">Length</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">80</span><span class="p">);</span>
</span></code></pre></div>
<h3 id="specifying-a-filename">Specifying a filename</h3>
<p>A filename can be either absolute (e.g., c:\temp\test.txtâ€”or in Unix, /tmp/test.txt) or relative to the current directory (e.g., test.txt or temp\test.txt). You can access or change the current directory via the static <code>Environment.CurrentDirectory</code> property.</p>
<p><code>AppDomain.CurrentDomain.BaseDirectory</code> returns the application base directory, which in normal cases is the folder containing the programâ€™s executable. To specify a filename relative to this directory, you can call Path.Combine:</p>
<div class="language-csharp highlight"><pre><span></span><code><span id="__span-195-1"><a id="__codelineno-195-1" name="__codelineno-195-1" href="#__codelineno-195-1"></a><span class="kt">string</span><span class="w"> </span><span class="n">baseFolder</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">AppDomain</span><span class="p">.</span><span class="n">CurrentDomain</span><span class="p">.</span><span class="n">BaseDirectory</span><span class="p">;</span>
</span><span id="__span-195-2"><a id="__codelineno-195-2" name="__codelineno-195-2" href="#__codelineno-195-2"></a><span class="kt">string</span><span class="w"> </span><span class="n">logoPath</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Path</span><span class="p">.</span><span class="n">Combine</span><span class="w"> </span><span class="p">(</span><span class="n">baseFolder</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;logo.jpg&quot;</span><span class="p">);</span>
</span><span id="__span-195-3"><a id="__codelineno-195-3" name="__codelineno-195-3" href="#__codelineno-195-3"></a><span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="w"> </span><span class="p">(</span><span class="n">File</span><span class="p">.</span><span class="n">Exists</span><span class="w"> </span><span class="p">(</span><span class="n">logoPath</span><span class="p">));</span>
</span></code></pre></div>
<p>You can read and write across a Windows network via a Universal Naming Convenâ€ tion (UNC) path, such as \JoesPC\PicShare\pic.jpg or \10.1.1.2\PicShare\pic.jpg.</p>
<h3 id="specifying-a-filemode">Specifying a FileMode</h3>
<p>All of FileStreamâ€™s constructors that accept a filename also require a FileMode enum argument.</p>
<p>File.Create and FileMode.Create will throw an exception if used on hidden files. To overwrite a hidden file, you must delete and re-create it:</p>
<div class="language-csharp highlight"><pre><span></span><code><span id="__span-196-1"><a id="__codelineno-196-1" name="__codelineno-196-1" href="#__codelineno-196-1"></a><span class="n">File</span><span class="p">.</span><span class="n">Delete</span><span class="w"> </span><span class="p">(</span><span class="s">&quot;hidden.txt&quot;</span><span class="p">);</span>
</span><span id="__span-196-2"><a id="__codelineno-196-2" name="__codelineno-196-2" href="#__codelineno-196-2"></a><span class="k">using</span><span class="w"> </span><span class="nn">var</span><span class="w"> </span><span class="n">file</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">File</span><span class="p">.</span><span class="n">Create</span><span class="w"> </span><span class="p">(</span><span class="s">&quot;hidden.txt&quot;</span><span class="p">);</span>
</span><span id="__span-196-3"><a id="__codelineno-196-3" name="__codelineno-196-3" href="#__codelineno-196-3"></a><span class="p">...</span>
</span></code></pre></div>
<h3 id="advanced-filestream-features">Advanced FileStream features</h3>
<ul>
<li>A FileShare enum describing how much access to grant other processes wantâ€ ing to dip into the same file before youâ€™ve finished (None, Read [default], Read Write, or Write).</li>
<li>The size, in bytes, of the internal buffer (default is currently 4 KB).</li>
<li>A flag indicating whether to defer to the operating system for asynchronous I/O</li>
<li>A FileOptions flags enum for requesting operating system encryption (Encrypted), automatic deletion upon closure for temporary files (DeleteOn Close), and optimization hints (RandomAccess and SequentialScan). There is also a WriteThrough flag that requests that the OS disable write-behind caching; this is for transactional files or logs. Flags not supported by the underlying OS are silently ignored.</li>
</ul>
<h2 id="memorystream">MemoryStream</h2>
<p>MemoryStream uses an array as a backing store. This partly defeats the purpose of having a stream because the entire backing store must reside in memory at once. MemoryStream is still useful when you need random access to a nonseekable stream. If you know the source stream will be of a manageable size, you can copy it into a MemoryStream as follows:</p>
<div class="language-csharp highlight"><pre><span></span><code><span id="__span-197-1"><a id="__codelineno-197-1" name="__codelineno-197-1" href="#__codelineno-197-1"></a><span class="kt">var</span><span class="w"> </span><span class="n">ms</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">MemoryStream</span><span class="p">();</span>
</span><span id="__span-197-2"><a id="__codelineno-197-2" name="__codelineno-197-2" href="#__codelineno-197-2"></a><span class="n">sourceStream</span><span class="p">.</span><span class="n">CopyTo</span><span class="w"> </span><span class="p">(</span><span class="n">ms</span><span class="p">);</span>
</span></code></pre></div>
<p>You can convert a MemoryStream to a byte array by calling ToArray. The GetBuffer method does the same job more efficiently by returning a direct reference to the underlying storage array</p>
<h2 id="pipestream">PipeStream</h2>
<p>PipeStream provides a simple means by which one process can communicate with another through the operating systemâ€™s pipes protocol. There are two kinds of pipe:</p>
<p>Anonymous pipe (faster)</p>
<ul>
<li>Allows one-way communication between a parent and child process on the same computer.</li>
</ul>
<p>Named pipe (more flexible)</p>
<ul>
<li>Allows two-way communication between arbitrary processes on the same computer or different computers across a network.</li>
</ul>
<p>A pipe is good for interprocess communication (IPC) on a single computer</p>
<h1 id="stream-adapters">Stream Adapters</h1>
<p>A Stream deals only in bytes; to read or write data types such as strings, integers, or XML elements, you must plug in an adapter. Hereâ€™s what .NET Core provides</p>
<ul>
<li>Text adapters (for string and character data)<ul>
<li>TextReader, TextWriter</li>
<li>StreamReader, StreamWriter</li>
<li>StringReader, StringWriter</li>
</ul>
</li>
<li>Binary adapters (for primitive types such as int, bool, string, and float)<ul>
<li>BinaryReader, BinaryWriter</li>
</ul>
</li>
<li>XML adapters<ul>
<li>XmlReader, XmlWriter</li>
</ul>
</li>
</ul>
<h2 id="text-adapters">Text Adapters</h2>
<p>TextReader and TextWriter are the abstract base classes for adapters that deal exclusively with characters and strings. Each has two general-purpose implementations in .NET Core</p>
<ul>
<li>StreamReader/StreamWriter</li>
<li>StringReader/StringWriter</li>
</ul>
<p>Peek returns the next character in the stream without advancing the position. Both Peek and the zero-argument version of Read return âˆ’1 if at the end of the stream;</p>
<p>otherwise, they return an integer that can be cast directly to a char. The overload of Read that accepts a char[] buffer is identical in functionality to the ReadBlock method.</p>
<aside>
ðŸ’¡ `Environment.NewLine` returns the newline sequence for the current OS. On Windows, this is "\r\n" (think â€œReturNâ€) and is loosely modeled on a mechanical typewriter: a CR (character 13) folâ€ lowed by an LF (character 10).

</aside>

<h3 id="streamreader-and-streamwriter">StreamReader and StreamWriter</h3>
<div class="language-csharp highlight"><pre><span></span><code><span id="__span-198-1"><a id="__codelineno-198-1" name="__codelineno-198-1" href="#__codelineno-198-1"></a><span class="k">using</span><span class="w"> </span><span class="p">(</span><span class="n">FileStream</span><span class="w"> </span><span class="n">fs</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">File</span><span class="p">.</span><span class="n">Create</span><span class="w"> </span><span class="p">(</span><span class="s">&quot;test.txt&quot;</span><span class="p">))</span>
</span><span id="__span-198-2"><a id="__codelineno-198-2" name="__codelineno-198-2" href="#__codelineno-198-2"></a><span class="k">using</span><span class="w"> </span><span class="p">(</span><span class="n">TextWriter</span><span class="w"> </span><span class="n">writer</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">StreamWriter</span><span class="w"> </span><span class="p">(</span><span class="n">fs</span><span class="p">))</span>
</span><span id="__span-198-3"><a id="__codelineno-198-3" name="__codelineno-198-3" href="#__codelineno-198-3"></a><span class="p">{</span>
</span><span id="__span-198-4"><a id="__codelineno-198-4" name="__codelineno-198-4" href="#__codelineno-198-4"></a><span class="w"> </span><span class="n">writer</span><span class="p">.</span><span class="n">WriteLine</span><span class="w"> </span><span class="p">(</span><span class="s">&quot;Line1&quot;</span><span class="p">);</span>
</span><span id="__span-198-5"><a id="__codelineno-198-5" name="__codelineno-198-5" href="#__codelineno-198-5"></a><span class="w"> </span><span class="n">writer</span><span class="p">.</span><span class="n">WriteLine</span><span class="w"> </span><span class="p">(</span><span class="s">&quot;Line2&quot;</span><span class="p">);</span>
</span><span id="__span-198-6"><a id="__codelineno-198-6" name="__codelineno-198-6" href="#__codelineno-198-6"></a><span class="p">}</span>
</span><span id="__span-198-7"><a id="__codelineno-198-7" name="__codelineno-198-7" href="#__codelineno-198-7"></a><span class="k">using</span><span class="w"> </span><span class="p">(</span><span class="n">FileStream</span><span class="w"> </span><span class="n">fs</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">File</span><span class="p">.</span><span class="n">OpenRead</span><span class="w"> </span><span class="p">(</span><span class="s">&quot;test.txt&quot;</span><span class="p">))</span>
</span><span id="__span-198-8"><a id="__codelineno-198-8" name="__codelineno-198-8" href="#__codelineno-198-8"></a><span class="k">using</span><span class="w"> </span><span class="p">(</span><span class="n">TextReader</span><span class="w"> </span><span class="n">reader</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">StreamReader</span><span class="w"> </span><span class="p">(</span><span class="n">fs</span><span class="p">))</span>
</span><span id="__span-198-9"><a id="__codelineno-198-9" name="__codelineno-198-9" href="#__codelineno-198-9"></a><span class="p">{</span>
</span><span id="__span-198-10"><a id="__codelineno-198-10" name="__codelineno-198-10" href="#__codelineno-198-10"></a><span class="w"> </span><span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="w"> </span><span class="p">(</span><span class="n">reader</span><span class="p">.</span><span class="n">ReadLine</span><span class="p">());</span><span class="w"> </span><span class="c1">// Line1</span>
</span><span id="__span-198-11"><a id="__codelineno-198-11" name="__codelineno-198-11" href="#__codelineno-198-11"></a><span class="w"> </span><span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="w"> </span><span class="p">(</span><span class="n">reader</span><span class="p">.</span><span class="n">ReadLine</span><span class="p">());</span><span class="w"> </span><span class="c1">// Line2</span>
</span><span id="__span-198-12"><a id="__codelineno-198-12" name="__codelineno-198-12" href="#__codelineno-198-12"></a><span class="p">}</span>
</span></code></pre></div>
<p>Because text adapters are so often coupled with files, the File class provides the static methods CreateText, AppendText, and OpenText to shortcut the process</p>
<div class="language-csharp highlight"><pre><span></span><code><span id="__span-199-1"><a id="__codelineno-199-1" name="__codelineno-199-1" href="#__codelineno-199-1"></a><span class="k">using</span><span class="w"> </span><span class="p">(</span><span class="n">TextWriter</span><span class="w"> </span><span class="n">writer</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">File</span><span class="p">.</span><span class="n">CreateText</span><span class="w"> </span><span class="p">(</span><span class="s">&quot;test.txt&quot;</span><span class="p">))</span>
</span><span id="__span-199-2"><a id="__codelineno-199-2" name="__codelineno-199-2" href="#__codelineno-199-2"></a><span class="p">{</span>
</span><span id="__span-199-3"><a id="__codelineno-199-3" name="__codelineno-199-3" href="#__codelineno-199-3"></a><span class="w"> </span><span class="n">writer</span><span class="p">.</span><span class="n">WriteLine</span><span class="w"> </span><span class="p">(</span><span class="s">&quot;Line1&quot;</span><span class="p">);</span>
</span><span id="__span-199-4"><a id="__codelineno-199-4" name="__codelineno-199-4" href="#__codelineno-199-4"></a><span class="w"> </span><span class="n">writer</span><span class="p">.</span><span class="n">WriteLine</span><span class="w"> </span><span class="p">(</span><span class="s">&quot;Line2&quot;</span><span class="p">);</span>
</span><span id="__span-199-5"><a id="__codelineno-199-5" name="__codelineno-199-5" href="#__codelineno-199-5"></a><span class="p">}</span>
</span><span id="__span-199-6"><a id="__codelineno-199-6" name="__codelineno-199-6" href="#__codelineno-199-6"></a><span class="k">using</span><span class="w"> </span><span class="p">(</span><span class="n">TextWriter</span><span class="w"> </span><span class="n">writer</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">File</span><span class="p">.</span><span class="n">AppendText</span><span class="w"> </span><span class="p">(</span><span class="s">&quot;test.txt&quot;</span><span class="p">))</span>
</span><span id="__span-199-7"><a id="__codelineno-199-7" name="__codelineno-199-7" href="#__codelineno-199-7"></a><span class="w"> </span><span class="n">writer</span><span class="p">.</span><span class="n">WriteLine</span><span class="w"> </span><span class="p">(</span><span class="s">&quot;Line3&quot;</span><span class="p">);</span>
</span><span id="__span-199-8"><a id="__codelineno-199-8" name="__codelineno-199-8" href="#__codelineno-199-8"></a><span class="k">using</span><span class="w"> </span><span class="p">(</span><span class="n">TextReader</span><span class="w"> </span><span class="n">reader</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">File</span><span class="p">.</span><span class="n">OpenText</span><span class="w"> </span><span class="p">(</span><span class="s">&quot;test.txt&quot;</span><span class="p">))</span>
</span><span id="__span-199-9"><a id="__codelineno-199-9" name="__codelineno-199-9" href="#__codelineno-199-9"></a><span class="w"> </span><span class="k">while</span><span class="w"> </span><span class="p">(</span><span class="n">reader</span><span class="p">.</span><span class="n">Peek</span><span class="p">()</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
</span><span id="__span-199-10"><a id="__codelineno-199-10" name="__codelineno-199-10" href="#__codelineno-199-10"></a><span class="w"> </span><span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="w"> </span><span class="p">(</span><span class="n">reader</span><span class="p">.</span><span class="n">ReadLine</span><span class="p">());</span><span class="w"> </span><span class="c1">// Line1</span>
</span><span id="__span-199-11"><a id="__codelineno-199-11" name="__codelineno-199-11" href="#__codelineno-199-11"></a><span class="w"> </span><span class="c1">// Line2</span>
</span><span id="__span-199-12"><a id="__codelineno-199-12" name="__codelineno-199-12" href="#__codelineno-199-12"></a><span class="w"> </span><span class="c1">// Line3</span>
</span></code></pre></div>
<p>This also illustrates how to test for the end of a file (viz. reader.Peek()). Another option is to read until reader.ReadLine returns null.</p>
<h3 id="character-encodings">Character encodings</h3>
<p>TextReader and TextWriter are by themselves just abstract classes with no connecâ€ tion to a stream or backing store. The StreamReader and StreamWriter types, howâ€ ever, are connected to an underlying byte-oriented stream, so they must convert between characters and bytes. They do so through an Encoding class from the System.Text namespace, which you choose when constructing the StreamReader or StreamWriter. If you choose none, the default UTF-8 encoding is used.</p>
<h2 id="binary-adapters">Binary Adapters</h2>
<p>BinaryReader and BinaryWriter read and write native data types: bool, byte, char, decimal, float, double, short, int, long, sbyte, ushort, uint, and ulong, as well as strings and arrays of the primitive data types.</p>
<p>Unlike StreamReader and StreamWriter, binary adapters store primitive data types efficiently because they are represented in memory. So, an int uses four bytes; a double uses eight bytes. Strings are written through a text encoding (as with Stream Reader and StreamWriter) but are length-prefixed in order to make it possible to read back a series of strings without needing special delimiters.</p>
<div class="language-csharp highlight"><pre><span></span><code><span id="__span-200-1"><a id="__codelineno-200-1" name="__codelineno-200-1" href="#__codelineno-200-1"></a><span class="c1">//Imagine that we have a simple type, defined as follows:</span>
</span><span id="__span-200-2"><a id="__codelineno-200-2" name="__codelineno-200-2" href="#__codelineno-200-2"></a><span class="k">public</span><span class="w"> </span><span class="k">class</span><span class="w"> </span><span class="nc">Person</span>
</span><span id="__span-200-3"><a id="__codelineno-200-3" name="__codelineno-200-3" href="#__codelineno-200-3"></a><span class="p">{</span>
</span><span id="__span-200-4"><a id="__codelineno-200-4" name="__codelineno-200-4" href="#__codelineno-200-4"></a><span class="w"> </span><span class="k">public</span><span class="w"> </span><span class="kt">string</span><span class="w"> </span><span class="n">Name</span><span class="p">;</span>
</span><span id="__span-200-5"><a id="__codelineno-200-5" name="__codelineno-200-5" href="#__codelineno-200-5"></a><span class="w"> </span><span class="k">public</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">Age</span><span class="p">;</span>
</span><span id="__span-200-6"><a id="__codelineno-200-6" name="__codelineno-200-6" href="#__codelineno-200-6"></a><span class="w"> </span><span class="k">public</span><span class="w"> </span><span class="kt">double</span><span class="w"> </span><span class="n">Height</span><span class="p">;</span>
</span><span id="__span-200-7"><a id="__codelineno-200-7" name="__codelineno-200-7" href="#__codelineno-200-7"></a><span class="p">}</span>
</span><span id="__span-200-8"><a id="__codelineno-200-8" name="__codelineno-200-8" href="#__codelineno-200-8"></a><span class="c1">//We can add the following methods to Person to save/load its data to/from a stream</span>
</span><span id="__span-200-9"><a id="__codelineno-200-9" name="__codelineno-200-9" href="#__codelineno-200-9"></a><span class="k">using</span><span class="w"> </span><span class="nn">binary</span><span class="w"> </span><span class="n">adapters</span><span class="p">:</span>
</span><span id="__span-200-10"><a id="__codelineno-200-10" name="__codelineno-200-10" href="#__codelineno-200-10"></a>
</span><span id="__span-200-11"><a id="__codelineno-200-11" name="__codelineno-200-11" href="#__codelineno-200-11"></a><span class="k">public</span><span class="w"> </span><span class="k">void</span><span class="w"> </span><span class="nf">SaveData</span><span class="w"> </span><span class="p">(</span><span class="n">Stream</span><span class="w"> </span><span class="n">s</span><span class="p">)</span>
</span><span id="__span-200-12"><a id="__codelineno-200-12" name="__codelineno-200-12" href="#__codelineno-200-12"></a><span class="p">{</span>
</span><span id="__span-200-13"><a id="__codelineno-200-13" name="__codelineno-200-13" href="#__codelineno-200-13"></a><span class="w"> </span><span class="kt">var</span><span class="w"> </span><span class="n">w</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">BinaryWriter</span><span class="w"> </span><span class="p">(</span><span class="n">s</span><span class="p">);</span>
</span><span id="__span-200-14"><a id="__codelineno-200-14" name="__codelineno-200-14" href="#__codelineno-200-14"></a><span class="w"> </span><span class="n">w</span><span class="p">.</span><span class="n">Write</span><span class="w"> </span><span class="p">(</span><span class="n">Name</span><span class="p">);</span>
</span><span id="__span-200-15"><a id="__codelineno-200-15" name="__codelineno-200-15" href="#__codelineno-200-15"></a><span class="w"> </span><span class="n">w</span><span class="p">.</span><span class="n">Write</span><span class="w"> </span><span class="p">(</span><span class="n">Age</span><span class="p">);</span>
</span><span id="__span-200-16"><a id="__codelineno-200-16" name="__codelineno-200-16" href="#__codelineno-200-16"></a><span class="w"> </span><span class="n">w</span><span class="p">.</span><span class="n">Write</span><span class="w"> </span><span class="p">(</span><span class="n">Height</span><span class="p">);</span>
</span><span id="__span-200-17"><a id="__codelineno-200-17" name="__codelineno-200-17" href="#__codelineno-200-17"></a><span class="w"> </span><span class="n">w</span><span class="p">.</span><span class="n">Flush</span><span class="p">();</span><span class="w"> </span><span class="c1">// Ensure the BinaryWriter buffer is cleared.</span>
</span><span id="__span-200-18"><a id="__codelineno-200-18" name="__codelineno-200-18" href="#__codelineno-200-18"></a><span class="w"> </span><span class="c1">// We won&#39;t dispose/close it, so more data</span>
</span><span id="__span-200-19"><a id="__codelineno-200-19" name="__codelineno-200-19" href="#__codelineno-200-19"></a><span class="p">}</span><span class="w"> </span><span class="c1">// can be written to the stream.</span>
</span><span id="__span-200-20"><a id="__codelineno-200-20" name="__codelineno-200-20" href="#__codelineno-200-20"></a>
</span><span id="__span-200-21"><a id="__codelineno-200-21" name="__codelineno-200-21" href="#__codelineno-200-21"></a><span class="k">public</span><span class="w"> </span><span class="k">void</span><span class="w"> </span><span class="nf">LoadData</span><span class="w"> </span><span class="p">(</span><span class="n">Stream</span><span class="w"> </span><span class="n">s</span><span class="p">)</span>
</span><span id="__span-200-22"><a id="__codelineno-200-22" name="__codelineno-200-22" href="#__codelineno-200-22"></a><span class="p">{</span>
</span><span id="__span-200-23"><a id="__codelineno-200-23" name="__codelineno-200-23" href="#__codelineno-200-23"></a><span class="w"> </span><span class="kt">var</span><span class="w"> </span><span class="n">r</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">BinaryReader</span><span class="w"> </span><span class="p">(</span><span class="n">s</span><span class="p">);</span>
</span><span id="__span-200-24"><a id="__codelineno-200-24" name="__codelineno-200-24" href="#__codelineno-200-24"></a><span class="w"> </span><span class="n">Name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">r</span><span class="p">.</span><span class="n">ReadString</span><span class="p">();</span>
</span><span id="__span-200-25"><a id="__codelineno-200-25" name="__codelineno-200-25" href="#__codelineno-200-25"></a><span class="w"> </span><span class="n">Age</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">r</span><span class="p">.</span><span class="n">ReadInt32</span><span class="p">();</span>
</span><span id="__span-200-26"><a id="__codelineno-200-26" name="__codelineno-200-26" href="#__codelineno-200-26"></a><span class="w"> </span><span class="n">Height</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">r</span><span class="p">.</span><span class="n">ReadDouble</span><span class="p">();</span>
</span><span id="__span-200-27"><a id="__codelineno-200-27" name="__codelineno-200-27" href="#__codelineno-200-27"></a><span class="p">}</span>
</span></code></pre></div>
<h2 id="closing-and-disposing-stream-adapters">Closing and Disposing Stream Adapters</h2>
<p>You have four choices in tearing down stream adapters:</p>
<ul>
<li>Close the adapter only</li>
<li>Close the adapter and then close the stream</li>
<li>(For writers) Flush the adapter and then close the stream</li>
<li>(For readers) Close just the stream</li>
</ul>
<p>Options 1 and 2 are semantically identical because closing an adapter automatically closes the underlying stream. Whenever you nest using statements, youâ€™re implicitly taking option 2:</p>
<div class="language-csharp highlight"><pre><span></span><code><span id="__span-201-1"><a id="__codelineno-201-1" name="__codelineno-201-1" href="#__codelineno-201-1"></a><span class="k">using</span><span class="w"> </span><span class="p">(</span><span class="n">FileStream</span><span class="w"> </span><span class="n">fs</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">File</span><span class="p">.</span><span class="n">Create</span><span class="w"> </span><span class="p">(</span><span class="s">&quot;test.txt&quot;</span><span class="p">))</span>
</span><span id="__span-201-2"><a id="__codelineno-201-2" name="__codelineno-201-2" href="#__codelineno-201-2"></a><span class="k">using</span><span class="w"> </span><span class="p">(</span><span class="n">TextWriter</span><span class="w"> </span><span class="n">writer</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">StreamWriter</span><span class="w"> </span><span class="p">(</span><span class="n">fs</span><span class="p">))</span>
</span><span id="__span-201-3"><a id="__codelineno-201-3" name="__codelineno-201-3" href="#__codelineno-201-3"></a><span class="w"> </span><span class="n">writer</span><span class="p">.</span><span class="n">WriteLine</span><span class="w"> </span><span class="p">(</span><span class="s">&quot;Line&quot;</span><span class="p">);</span>
</span></code></pre></div>
<p>Because the nest disposes from the inside out, the adapter is first closed, and then the stream. Furthermore, if an exception is thrown within the adapterâ€™s constructor, the stream still closes. Itâ€™s hard to go wrong with nested using statements!</p>
<h1 id="compression-streams">Compression Streams</h1>
<p>Two general-purpose compression streams are provided in the <a href="http://system.io/">System.IO</a> .Compression namespace: DeflateStream and GZipStream. Both use a popular compression algorithm similar to that of the ZIP format. They differ in that GZip Stream writes an additional protocol at the start and endâ€”including a CRC to detect errors. GZipStream also conforms to a standard recognized by other software.</p>
<p>NET Core also includes BrotliStream, which implements the Brotli compression algorithm. BrotliStream is more than 10 times slower than DeflateStream and GZipStream but achieves a better compression ratio. (The performance hit applies only to compressionâ€”decompression performs very well.)</p>
<p>All three streams allow reading and writing, with the following provisos:</p>
<ul>
<li>You always write to the stream when compressing</li>
<li>You always read from the stream when decompressing.</li>
</ul>
<p>DeflateStream, GZipStream, and BrotliStream are decorators; they compress or decompress data from another stream that you supply in construction. In the following example, we compress and decompress a series of bytes using a File Stream as the backing store:</p>
<div class="language-csharp highlight"><pre><span></span><code><span id="__span-202-1"><a id="__codelineno-202-1" name="__codelineno-202-1" href="#__codelineno-202-1"></a><span class="k">using</span><span class="w"> </span><span class="p">(</span><span class="n">Stream</span><span class="w"> </span><span class="n">s</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">File</span><span class="p">.</span><span class="n">Create</span><span class="w"> </span><span class="p">(</span><span class="s">&quot;compressed.bin&quot;</span><span class="p">))</span>
</span><span id="__span-202-2"><a id="__codelineno-202-2" name="__codelineno-202-2" href="#__codelineno-202-2"></a><span class="k">using</span><span class="w"> </span><span class="p">(</span><span class="n">Stream</span><span class="w"> </span><span class="n">ds</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">DeflateStream</span><span class="w"> </span><span class="p">(</span><span class="n">s</span><span class="p">,</span><span class="w"> </span><span class="n">CompressionMode</span><span class="p">.</span><span class="n">Compress</span><span class="p">))</span>
</span><span id="__span-202-3"><a id="__codelineno-202-3" name="__codelineno-202-3" href="#__codelineno-202-3"></a><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kt">byte</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mi">100</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="o">++</span><span class="p">)</span>
</span><span id="__span-202-4"><a id="__codelineno-202-4" name="__codelineno-202-4" href="#__codelineno-202-4"></a><span class="w"> </span><span class="n">ds</span><span class="p">.</span><span class="n">WriteByte</span><span class="w"> </span><span class="p">(</span><span class="n">i</span><span class="p">);</span>
</span><span id="__span-202-5"><a id="__codelineno-202-5" name="__codelineno-202-5" href="#__codelineno-202-5"></a>
</span><span id="__span-202-6"><a id="__codelineno-202-6" name="__codelineno-202-6" href="#__codelineno-202-6"></a><span class="k">using</span><span class="w"> </span><span class="p">(</span><span class="n">Stream</span><span class="w"> </span><span class="n">s</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">File</span><span class="p">.</span><span class="n">OpenRead</span><span class="w"> </span><span class="p">(</span><span class="s">&quot;compressed.bin&quot;</span><span class="p">))</span>
</span><span id="__span-202-7"><a id="__codelineno-202-7" name="__codelineno-202-7" href="#__codelineno-202-7"></a><span class="k">using</span><span class="w"> </span><span class="p">(</span><span class="n">Stream</span><span class="w"> </span><span class="n">ds</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">DeflateStream</span><span class="w"> </span><span class="p">(</span><span class="n">s</span><span class="p">,</span><span class="w"> </span><span class="n">CompressionMode</span><span class="p">.</span><span class="n">Decompress</span><span class="p">))</span>
</span><span id="__span-202-8"><a id="__codelineno-202-8" name="__codelineno-202-8" href="#__codelineno-202-8"></a><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kt">byte</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mi">100</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="o">++</span><span class="p">)</span>
</span><span id="__span-202-9"><a id="__codelineno-202-9" name="__codelineno-202-9" href="#__codelineno-202-9"></a><span class="w"> </span><span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="w"> </span><span class="p">(</span><span class="n">ds</span><span class="p">.</span><span class="n">ReadByte</span><span class="p">());</span><span class="w"> </span><span class="c1">// Writes 0 to 99</span>
</span></code></pre></div>
<h1 id="file-and-directory-operations">File and Directory Operations</h1>
<p>The <code>System.IO</code> namespace provides a set of types for performing â€œutilityâ€ file and directory operations, such as copying and moving, creating directories, and setting file attributes and permissions. For most features, you can choose between either of two classes, one offering static methods and the other instance methods:</p>
<ul>
<li>Static classes : File and Directory</li>
<li>Instance-method classes (constructed with a file or directory name)<ul>
<li>FileInfo and DirectoryInfo</li>
</ul>
</li>
</ul>
<p>Additionally, thereâ€™s a static class called Path. This does nothing to files or directories; instead, it provides string manipulation methods for filenames and directory paths. Path also assists with temporary files.</p>
<h2 id="the-file-class">The File Class</h2>
<p>File is a static class whose methods all accept a filename. The filename can be either relative to the current directory or fully qualified with a directory. Here are its methâ€ ods (all public and static):</p>
<div class="language-csharp highlight"><pre><span></span><code><span id="__span-203-1"><a id="__codelineno-203-1" name="__codelineno-203-1" href="#__codelineno-203-1"></a><span class="kt">bool</span><span class="w"> </span><span class="nf">Exists</span><span class="w"> </span><span class="p">(</span><span class="kt">string</span><span class="w"> </span><span class="n">path</span><span class="p">);</span><span class="w"> </span><span class="c1">// Returns true if the file is present</span>
</span><span id="__span-203-2"><a id="__codelineno-203-2" name="__codelineno-203-2" href="#__codelineno-203-2"></a><span class="k">void</span><span class="w"> </span><span class="nf">Delete</span><span class="w"> </span><span class="p">(</span><span class="kt">string</span><span class="w"> </span><span class="n">path</span><span class="p">);</span>
</span><span id="__span-203-3"><a id="__codelineno-203-3" name="__codelineno-203-3" href="#__codelineno-203-3"></a><span class="k">void</span><span class="w"> </span><span class="nf">Copy</span><span class="w"> </span><span class="p">(</span><span class="kt">string</span><span class="w"> </span><span class="n">sourceFileName</span><span class="p">,</span><span class="w"> </span><span class="kt">string</span><span class="w"> </span><span class="n">destFileName</span><span class="p">);</span>
</span><span id="__span-203-4"><a id="__codelineno-203-4" name="__codelineno-203-4" href="#__codelineno-203-4"></a><span class="k">void</span><span class="w"> </span><span class="nf">Move</span><span class="w"> </span><span class="p">(</span><span class="kt">string</span><span class="w"> </span><span class="n">sourceFileName</span><span class="p">,</span><span class="w"> </span><span class="kt">string</span><span class="w"> </span><span class="n">destFileName</span><span class="p">);</span>
</span><span id="__span-203-5"><a id="__codelineno-203-5" name="__codelineno-203-5" href="#__codelineno-203-5"></a><span class="k">void</span><span class="w"> </span><span class="nf">Replace</span><span class="w"> </span><span class="p">(</span><span class="kt">string</span><span class="w"> </span><span class="n">sourceFileName</span><span class="p">,</span><span class="w"> </span><span class="kt">string</span><span class="w"> </span><span class="n">destinationFileName</span><span class="p">,</span>
</span><span id="__span-203-6"><a id="__codelineno-203-6" name="__codelineno-203-6" href="#__codelineno-203-6"></a><span class="w"> </span><span class="kt">string</span><span class="w"> </span><span class="n">destinationBackupFileName</span><span class="p">);</span>
</span><span id="__span-203-7"><a id="__codelineno-203-7" name="__codelineno-203-7" href="#__codelineno-203-7"></a><span class="n">FileAttributes</span><span class="w"> </span><span class="nf">GetAttributes</span><span class="w"> </span><span class="p">(</span><span class="kt">string</span><span class="w"> </span><span class="n">path</span><span class="p">);</span>
</span><span id="__span-203-8"><a id="__codelineno-203-8" name="__codelineno-203-8" href="#__codelineno-203-8"></a><span class="k">void</span><span class="w"> </span><span class="nf">SetAttributes</span><span class="w"> </span><span class="p">(</span><span class="kt">string</span><span class="w"> </span><span class="n">path</span><span class="p">,</span><span class="w"> </span><span class="n">FileAttributes</span><span class="w"> </span><span class="n">fileAttributes</span><span class="p">);</span>
</span><span id="__span-203-9"><a id="__codelineno-203-9" name="__codelineno-203-9" href="#__codelineno-203-9"></a><span class="k">void</span><span class="w"> </span><span class="nf">Decrypt</span><span class="w"> </span><span class="p">(</span><span class="kt">string</span><span class="w"> </span><span class="n">path</span><span class="p">);</span>
</span><span id="__span-203-10"><a id="__codelineno-203-10" name="__codelineno-203-10" href="#__codelineno-203-10"></a><span class="k">void</span><span class="w"> </span><span class="nf">Encrypt</span><span class="w"> </span><span class="p">(</span><span class="kt">string</span><span class="w"> </span><span class="n">path</span><span class="p">);</span>
</span><span id="__span-203-11"><a id="__codelineno-203-11" name="__codelineno-203-11" href="#__codelineno-203-11"></a><span class="n">DateTime</span><span class="w"> </span><span class="nf">GetCreationTime</span><span class="w"> </span><span class="p">(</span><span class="kt">string</span><span class="w"> </span><span class="n">path</span><span class="p">);</span><span class="w"> </span><span class="c1">// UTC versions are</span>
</span><span id="__span-203-12"><a id="__codelineno-203-12" name="__codelineno-203-12" href="#__codelineno-203-12"></a><span class="n">DateTime</span><span class="w"> </span><span class="nf">GetLastAccessTime</span><span class="w"> </span><span class="p">(</span><span class="kt">string</span><span class="w"> </span><span class="n">path</span><span class="p">);</span><span class="w"> </span><span class="c1">// also provided.</span>
</span><span id="__span-203-13"><a id="__codelineno-203-13" name="__codelineno-203-13" href="#__codelineno-203-13"></a><span class="n">DateTime</span><span class="w"> </span><span class="nf">GetLastWriteTime</span><span class="w"> </span><span class="p">(</span><span class="kt">string</span><span class="w"> </span><span class="n">path</span><span class="p">);</span>
</span><span id="__span-203-14"><a id="__codelineno-203-14" name="__codelineno-203-14" href="#__codelineno-203-14"></a><span class="k">void</span><span class="w"> </span><span class="nf">SetCreationTime</span><span class="w"> </span><span class="p">(</span><span class="kt">string</span><span class="w"> </span><span class="n">path</span><span class="p">,</span><span class="w"> </span><span class="n">DateTime</span><span class="w"> </span><span class="n">creationTime</span><span class="p">);</span>
</span><span id="__span-203-15"><a id="__codelineno-203-15" name="__codelineno-203-15" href="#__codelineno-203-15"></a><span class="k">void</span><span class="w"> </span><span class="nf">SetLastAccessTime</span><span class="w"> </span><span class="p">(</span><span class="kt">string</span><span class="w"> </span><span class="n">path</span><span class="p">,</span><span class="w"> </span><span class="n">DateTime</span><span class="w"> </span><span class="n">lastAccessTime</span><span class="p">);</span>
</span><span id="__span-203-16"><a id="__codelineno-203-16" name="__codelineno-203-16" href="#__codelineno-203-16"></a><span class="k">void</span><span class="w"> </span><span class="nf">SetLastWriteTime</span><span class="w"> </span><span class="p">(</span><span class="kt">string</span><span class="w"> </span><span class="n">path</span><span class="p">,</span><span class="w"> </span><span class="n">DateTime</span><span class="w"> </span><span class="n">lastWriteTime</span><span class="p">);</span>
</span><span id="__span-203-17"><a id="__codelineno-203-17" name="__codelineno-203-17" href="#__codelineno-203-17"></a><span class="n">FileSecurity</span><span class="w"> </span><span class="nf">GetAccessControl</span><span class="w"> </span><span class="p">(</span><span class="kt">string</span><span class="w"> </span><span class="n">path</span><span class="p">);</span>
</span><span id="__span-203-18"><a id="__codelineno-203-18" name="__codelineno-203-18" href="#__codelineno-203-18"></a><span class="n">FileSecurity</span><span class="w"> </span><span class="nf">GetAccessControl</span><span class="w"> </span><span class="p">(</span><span class="kt">string</span><span class="w"> </span><span class="n">path</span><span class="p">,</span>
</span><span id="__span-203-19"><a id="__codelineno-203-19" name="__codelineno-203-19" href="#__codelineno-203-19"></a><span class="w"> </span><span class="n">AccessControlSections</span><span class="w"> </span><span class="n">includeSections</span><span class="p">);</span>
</span><span id="__span-203-20"><a id="__codelineno-203-20" name="__codelineno-203-20" href="#__codelineno-203-20"></a><span class="k">void</span><span class="w"> </span><span class="nf">SetAccessControl</span><span class="w"> </span><span class="p">(</span><span class="kt">string</span><span class="w"> </span><span class="n">path</span><span class="p">,</span><span class="w"> </span><span class="n">FileSecurity</span><span class="w"> </span><span class="n">fileSecurity</span><span class="p">);</span>
</span></code></pre></div>
<p>Move throws an exception if the destination file already exists; Replace does not. Both methods allow the file to be renamed as well as moved to another directory.</p>
<p>Delete throws an UnauthorizedAccessException if the file is marked read-only; you can tell this in advance by calling GetAttributes. It also throws that exception if the OS denies delete permission for that file to your process. Here are all the members of the FileAttribute enum that GetAttributes returns:</p>
<h2 id="the-directory-class">The Directory Class</h2>
<p>The static Directory class provides a set of methods analogous to those in the File classâ€”for checking whether a directory exists (Exists), moving a directory (Move), deleting a directory (Delete), getting/setting times of creation or last access, and getting/setting security permissions. Furthermore, Directory exposes the following static methods:</p>
<div class="language-csharp highlight"><pre><span></span><code><span id="__span-204-1"><a id="__codelineno-204-1" name="__codelineno-204-1" href="#__codelineno-204-1"></a><span class="kt">string</span><span class="w"> </span><span class="nf">GetCurrentDirectory</span><span class="w"> </span><span class="p">();</span>
</span><span id="__span-204-2"><a id="__codelineno-204-2" name="__codelineno-204-2" href="#__codelineno-204-2"></a><span class="k">void</span><span class="w"> </span><span class="nf">SetCurrentDirectory</span><span class="w"> </span><span class="p">(</span><span class="kt">string</span><span class="w"> </span><span class="n">path</span><span class="p">);</span>
</span><span id="__span-204-3"><a id="__codelineno-204-3" name="__codelineno-204-3" href="#__codelineno-204-3"></a><span class="n">DirectoryInfo</span><span class="w"> </span><span class="nf">CreateDirectory</span><span class="w"> </span><span class="p">(</span><span class="kt">string</span><span class="w"> </span><span class="n">path</span><span class="p">);</span>
</span><span id="__span-204-4"><a id="__codelineno-204-4" name="__codelineno-204-4" href="#__codelineno-204-4"></a><span class="n">DirectoryInfo</span><span class="w"> </span><span class="nf">GetParent</span><span class="w"> </span><span class="p">(</span><span class="kt">string</span><span class="w"> </span><span class="n">path</span><span class="p">);</span>
</span><span id="__span-204-5"><a id="__codelineno-204-5" name="__codelineno-204-5" href="#__codelineno-204-5"></a><span class="kt">string</span><span class="w"> </span><span class="nf">GetDirectoryRoot</span><span class="w"> </span><span class="p">(</span><span class="kt">string</span><span class="w"> </span><span class="n">path</span><span class="p">);</span>
</span><span id="__span-204-6"><a id="__codelineno-204-6" name="__codelineno-204-6" href="#__codelineno-204-6"></a><span class="kt">string</span><span class="p">[]</span><span class="w"> </span><span class="nf">GetLogicalDrives</span><span class="p">();</span><span class="w"> </span><span class="c1">// Gets mount points on Unix</span>
</span><span id="__span-204-7"><a id="__codelineno-204-7" name="__codelineno-204-7" href="#__codelineno-204-7"></a><span class="c1">// The following methods all return full paths:</span>
</span><span id="__span-204-8"><a id="__codelineno-204-8" name="__codelineno-204-8" href="#__codelineno-204-8"></a>
</span><span id="__span-204-9"><a id="__codelineno-204-9" name="__codelineno-204-9" href="#__codelineno-204-9"></a><span class="kt">string</span><span class="p">[]</span><span class="w"> </span><span class="nf">GetFiles</span><span class="w"> </span><span class="p">(</span><span class="kt">string</span><span class="w"> </span><span class="n">path</span><span class="p">);</span>
</span><span id="__span-204-10"><a id="__codelineno-204-10" name="__codelineno-204-10" href="#__codelineno-204-10"></a><span class="kt">string</span><span class="p">[]</span><span class="w"> </span><span class="nf">GetDirectories</span><span class="w"> </span><span class="p">(</span><span class="kt">string</span><span class="w"> </span><span class="n">path</span><span class="p">);</span>
</span><span id="__span-204-11"><a id="__codelineno-204-11" name="__codelineno-204-11" href="#__codelineno-204-11"></a><span class="kt">string</span><span class="p">[]</span><span class="w"> </span><span class="nf">GetFileSystemEntries</span><span class="w"> </span><span class="p">(</span><span class="kt">string</span><span class="w"> </span><span class="n">path</span><span class="p">);</span>
</span><span id="__span-204-12"><a id="__codelineno-204-12" name="__codelineno-204-12" href="#__codelineno-204-12"></a><span class="n">IEnumerable</span><span class="o">&lt;</span><span class="kt">string</span><span class="o">&gt;</span><span class="w"> </span><span class="n">EnumerateFiles</span><span class="w"> </span><span class="p">(</span><span class="kt">string</span><span class="w"> </span><span class="n">path</span><span class="p">);</span>
</span><span id="__span-204-13"><a id="__codelineno-204-13" name="__codelineno-204-13" href="#__codelineno-204-13"></a><span class="n">IEnumerable</span><span class="o">&lt;</span><span class="kt">string</span><span class="o">&gt;</span><span class="w"> </span><span class="n">EnumerateDirectories</span><span class="w"> </span><span class="p">(</span><span class="kt">string</span><span class="w"> </span><span class="n">path</span><span class="p">);</span>
</span><span id="__span-204-14"><a id="__codelineno-204-14" name="__codelineno-204-14" href="#__codelineno-204-14"></a><span class="n">IEnumerable</span><span class="o">&lt;</span><span class="kt">string</span><span class="o">&gt;</span><span class="w"> </span><span class="n">EnumerateFileSystemEntries</span><span class="w"> </span><span class="p">(</span><span class="kt">string</span><span class="w"> </span><span class="n">path</span><span class="p">);</span>
</span></code></pre></div>
<p>Hereâ€™s how to create a directory if it doesnâ€™t already exist:</p>
<div class="language-csharp highlight"><pre><span></span><code><span id="__span-205-1"><a id="__codelineno-205-1" name="__codelineno-205-1" href="#__codelineno-205-1"></a><span class="n">Here</span><span class="err">â€™</span><span class="n">s</span><span class="w"> </span><span class="n">how</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">create</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">directory</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="n">it</span><span class="w"> </span><span class="n">doesn</span><span class="err">â€™</span><span class="n">t</span><span class="w"> </span><span class="n">already</span><span class="w"> </span><span class="n">exist</span><span class="p">:</span>
</span><span id="__span-205-2"><a id="__codelineno-205-2" name="__codelineno-205-2" href="#__codelineno-205-2"></a><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="n">Directory</span><span class="p">.</span><span class="n">Exists</span><span class="w"> </span><span class="p">(</span><span class="s">@&quot;d:\test&quot;</span><span class="p">))</span>
</span><span id="__span-205-3"><a id="__codelineno-205-3" name="__codelineno-205-3" href="#__codelineno-205-3"></a><span class="w"> </span><span class="n">Directory</span><span class="p">.</span><span class="n">CreateDirectory</span><span class="w"> </span><span class="p">(</span><span class="s">@&quot;d:\test&quot;</span><span class="p">);</span>
</span></code></pre></div>
<h2 id="fileinfo-and-directoryinfo">FileInfo and DirectoryInfo</h2>
<p>The static methods on File and Directory are convenient for executing a single file or directory operation. If you need to call a series of methods in a row, the FileInfo and DirectoryInfo classes provide an object model that makes the job easier.</p>
<p>FileInfo offers most of the Fileâ€™s static methods in instance formâ€”with some additional properties such as Extension, Length, IsReadOnly, and Directoryâ€”for returning a DirectoryInfo object:</p>
<div class="language-csharp highlight"><pre><span></span><code><span id="__span-206-1"><a id="__codelineno-206-1" name="__codelineno-206-1" href="#__codelineno-206-1"></a><span class="k">static</span><span class="w"> </span><span class="kt">string</span><span class="w"> </span><span class="n">TestDirectory</span><span class="w"> </span><span class="o">=&gt;</span>
</span><span id="__span-206-2"><a id="__codelineno-206-2" name="__codelineno-206-2" href="#__codelineno-206-2"></a><span class="w"> </span><span class="n">RuntimeInformation</span><span class="p">.</span><span class="n">IsOSPlatform</span><span class="w"> </span><span class="p">(</span><span class="n">OSPlatform</span><span class="p">.</span><span class="n">Windows</span><span class="p">)</span>
</span><span id="__span-206-3"><a id="__codelineno-206-3" name="__codelineno-206-3" href="#__codelineno-206-3"></a><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="s">@&quot;C:\Temp&quot;</span>
</span><span id="__span-206-4"><a id="__codelineno-206-4" name="__codelineno-206-4" href="#__codelineno-206-4"></a><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s">&quot;/tmp&quot;</span><span class="p">;</span>
</span><span id="__span-206-5"><a id="__codelineno-206-5" name="__codelineno-206-5" href="#__codelineno-206-5"></a><span class="n">Directory</span><span class="p">.</span><span class="n">CreateDirectory</span><span class="w"> </span><span class="p">(</span><span class="n">TestDirectory</span><span class="p">);</span>
</span><span id="__span-206-6"><a id="__codelineno-206-6" name="__codelineno-206-6" href="#__codelineno-206-6"></a><span class="n">FileInfo</span><span class="w"> </span><span class="n">fi</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">FileInfo</span><span class="w"> </span><span class="p">(</span><span class="n">Path</span><span class="p">.</span><span class="n">Combine</span><span class="w"> </span><span class="p">(</span><span class="n">TestDirectory</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;FileInfo.txt&quot;</span><span class="p">));</span>
</span><span id="__span-206-7"><a id="__codelineno-206-7" name="__codelineno-206-7" href="#__codelineno-206-7"></a><span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="w"> </span><span class="p">(</span><span class="n">fi</span><span class="p">.</span><span class="n">Exists</span><span class="p">);</span><span class="w"> </span><span class="c1">// false</span>
</span><span id="__span-206-8"><a id="__codelineno-206-8" name="__codelineno-206-8" href="#__codelineno-206-8"></a><span class="k">using</span><span class="w"> </span><span class="p">(</span><span class="n">TextWriter</span><span class="w"> </span><span class="n">w</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">fi</span><span class="p">.</span><span class="n">CreateText</span><span class="p">())</span>
</span><span id="__span-206-9"><a id="__codelineno-206-9" name="__codelineno-206-9" href="#__codelineno-206-9"></a><span class="w"> </span><span class="n">w</span><span class="p">.</span><span class="n">Write</span><span class="w"> </span><span class="p">(</span><span class="s">&quot;Some text&quot;</span><span class="p">);</span>
</span><span id="__span-206-10"><a id="__codelineno-206-10" name="__codelineno-206-10" href="#__codelineno-206-10"></a><span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="w"> </span><span class="p">(</span><span class="n">fi</span><span class="p">.</span><span class="n">Exists</span><span class="p">);</span><span class="w"> </span><span class="c1">// false (still)</span>
</span><span id="__span-206-11"><a id="__codelineno-206-11" name="__codelineno-206-11" href="#__codelineno-206-11"></a><span class="n">fi</span><span class="p">.</span><span class="n">Refresh</span><span class="p">();</span>
</span><span id="__span-206-12"><a id="__codelineno-206-12" name="__codelineno-206-12" href="#__codelineno-206-12"></a><span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="w"> </span><span class="p">(</span><span class="n">fi</span><span class="p">.</span><span class="n">Exists</span><span class="p">);</span><span class="w"> </span><span class="c1">// true</span>
</span><span id="__span-206-13"><a id="__codelineno-206-13" name="__codelineno-206-13" href="#__codelineno-206-13"></a><span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="w"> </span><span class="p">(</span><span class="n">fi</span><span class="p">.</span><span class="n">Name</span><span class="p">);</span><span class="w"> </span><span class="c1">// FileInfo.txt</span>
</span><span id="__span-206-14"><a id="__codelineno-206-14" name="__codelineno-206-14" href="#__codelineno-206-14"></a><span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="w"> </span><span class="p">(</span><span class="n">fi</span><span class="p">.</span><span class="n">FullName</span><span class="p">);</span><span class="w"> </span><span class="c1">// c:\temp\FileInfo.txt (Windows)</span>
</span><span id="__span-206-15"><a id="__codelineno-206-15" name="__codelineno-206-15" href="#__codelineno-206-15"></a><span class="w"> </span><span class="c1">// /tmp/FileInfo.txt (Unix)</span>
</span><span id="__span-206-16"><a id="__codelineno-206-16" name="__codelineno-206-16" href="#__codelineno-206-16"></a><span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="w"> </span><span class="p">(</span><span class="n">fi</span><span class="p">.</span><span class="n">DirectoryName</span><span class="p">);</span><span class="w"> </span><span class="c1">// c:\temp (Windows)</span>
</span><span id="__span-206-17"><a id="__codelineno-206-17" name="__codelineno-206-17" href="#__codelineno-206-17"></a><span class="w"> </span><span class="c1">// /tmp (Unix)</span>
</span><span id="__span-206-18"><a id="__codelineno-206-18" name="__codelineno-206-18" href="#__codelineno-206-18"></a><span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="w"> </span><span class="p">(</span><span class="n">fi</span><span class="p">.</span><span class="n">Directory</span><span class="p">.</span><span class="n">Name</span><span class="p">);</span><span class="w"> </span><span class="c1">// temp</span>
</span><span id="__span-206-19"><a id="__codelineno-206-19" name="__codelineno-206-19" href="#__codelineno-206-19"></a><span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="w"> </span><span class="p">(</span><span class="n">fi</span><span class="p">.</span><span class="n">Extension</span><span class="p">);</span><span class="w"> </span><span class="c1">// .txt</span>
</span><span id="__span-206-20"><a id="__codelineno-206-20" name="__codelineno-206-20" href="#__codelineno-206-20"></a><span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="w"> </span><span class="p">(</span><span class="n">fi</span><span class="p">.</span><span class="n">Length</span><span class="p">);</span><span class="w"> </span><span class="c1">// 9</span>
</span><span id="__span-206-21"><a id="__codelineno-206-21" name="__codelineno-206-21" href="#__codelineno-206-21"></a><span class="n">fi</span><span class="p">.</span><span class="n">Encrypt</span><span class="p">();</span>
</span><span id="__span-206-22"><a id="__codelineno-206-22" name="__codelineno-206-22" href="#__codelineno-206-22"></a><span class="n">fi</span><span class="p">.</span><span class="n">Attributes</span><span class="w"> </span><span class="o">^=</span><span class="w"> </span><span class="n">FileAttributes</span><span class="p">.</span><span class="n">Hidden</span><span class="p">;</span><span class="w"> </span><span class="c1">// (Toggle hidden flag)</span>
</span><span id="__span-206-23"><a id="__codelineno-206-23" name="__codelineno-206-23" href="#__codelineno-206-23"></a><span class="n">fi</span><span class="p">.</span><span class="n">IsReadOnly</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">true</span><span class="p">;</span>
</span><span id="__span-206-24"><a id="__codelineno-206-24" name="__codelineno-206-24" href="#__codelineno-206-24"></a><span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="w"> </span><span class="p">(</span><span class="n">fi</span><span class="p">.</span><span class="n">Attributes</span><span class="p">);</span><span class="w"> </span><span class="c1">// ReadOnly,Archive,Hidden,Encrypted</span>
</span><span id="__span-206-25"><a id="__codelineno-206-25" name="__codelineno-206-25" href="#__codelineno-206-25"></a><span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="w"> </span><span class="p">(</span><span class="n">fi</span><span class="p">.</span><span class="n">CreationTime</span><span class="p">);</span><span class="w"> </span><span class="c1">// 3/09/2019 1:24:05 PM</span>
</span><span id="__span-206-26"><a id="__codelineno-206-26" name="__codelineno-206-26" href="#__codelineno-206-26"></a><span class="n">fi</span><span class="p">.</span><span class="n">MoveTo</span><span class="w"> </span><span class="p">(</span><span class="n">Path</span><span class="p">.</span><span class="n">Combine</span><span class="w"> </span><span class="p">(</span><span class="n">TestDirectory</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;FileInfoX.txt&quot;</span><span class="p">));</span>
</span><span id="__span-206-27"><a id="__codelineno-206-27" name="__codelineno-206-27" href="#__codelineno-206-27"></a><span class="n">DirectoryInfo</span><span class="w"> </span><span class="n">di</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">fi</span><span class="p">.</span><span class="n">Directory</span><span class="p">;</span>
</span><span id="__span-206-28"><a id="__codelineno-206-28" name="__codelineno-206-28" href="#__codelineno-206-28"></a><span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="w"> </span><span class="p">(</span><span class="n">di</span><span class="p">.</span><span class="n">Name</span><span class="p">);</span><span class="w"> </span><span class="c1">// temp or tmp</span>
</span><span id="__span-206-29"><a id="__codelineno-206-29" name="__codelineno-206-29" href="#__codelineno-206-29"></a><span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="w"> </span><span class="p">(</span><span class="n">di</span><span class="p">.</span><span class="n">FullName</span><span class="p">);</span><span class="w"> </span><span class="c1">// c:\temp or /tmp</span>
</span><span id="__span-206-30"><a id="__codelineno-206-30" name="__codelineno-206-30" href="#__codelineno-206-30"></a><span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="w"> </span><span class="p">(</span><span class="n">di</span><span class="p">.</span><span class="n">Parent</span><span class="p">.</span><span class="n">FullName</span><span class="p">);</span><span class="w"> </span><span class="c1">// c:\ or /</span>
</span><span id="__span-206-31"><a id="__codelineno-206-31" name="__codelineno-206-31" href="#__codelineno-206-31"></a><span class="n">di</span><span class="p">.</span><span class="n">CreateSubdirectory</span><span class="w"> </span><span class="p">(</span><span class="s">&quot;SubFolder&quot;</span><span class="p">);</span>
</span></code></pre></div>
<p>Hereâ€™s how to use DirectoryInfo to enumerate files and subdirectories</p>
<div class="language-csharp highlight"><pre><span></span><code><span id="__span-207-1"><a id="__codelineno-207-1" name="__codelineno-207-1" href="#__codelineno-207-1"></a><span class="n">DirectoryInfo</span><span class="w"> </span><span class="n">di</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">DirectoryInfo</span><span class="w"> </span><span class="p">(</span><span class="s">@&quot;e:\photos&quot;</span><span class="p">);</span>
</span><span id="__span-207-2"><a id="__codelineno-207-2" name="__codelineno-207-2" href="#__codelineno-207-2"></a><span class="k">foreach</span><span class="w"> </span><span class="p">(</span><span class="n">FileInfo</span><span class="w"> </span><span class="n">fi</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">di</span><span class="p">.</span><span class="n">GetFiles</span><span class="w"> </span><span class="p">(</span><span class="s">&quot;*.jpg&quot;</span><span class="p">))</span>
</span><span id="__span-207-3"><a id="__codelineno-207-3" name="__codelineno-207-3" href="#__codelineno-207-3"></a><span class="w"> </span><span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="w"> </span><span class="p">(</span><span class="n">fi</span><span class="p">.</span><span class="n">Name</span><span class="p">);</span>
</span><span id="__span-207-4"><a id="__codelineno-207-4" name="__codelineno-207-4" href="#__codelineno-207-4"></a><span class="k">foreach</span><span class="w"> </span><span class="p">(</span><span class="n">DirectoryInfo</span><span class="w"> </span><span class="n">subDir</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">di</span><span class="p">.</span><span class="n">GetDirectories</span><span class="p">())</span>
</span><span id="__span-207-5"><a id="__codelineno-207-5" name="__codelineno-207-5" href="#__codelineno-207-5"></a><span class="w"> </span><span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="w"> </span><span class="p">(</span><span class="n">subDir</span><span class="p">.</span><span class="n">FullName</span><span class="p">);</span>
</span></code></pre></div>
<h2 id="path">Path</h2>
<p>The static Path class defines methods and fields for working with paths and filenames.</p>
<p>Assuming this setup code</p>
<div class="language-csharp highlight"><pre><span></span><code><span id="__span-208-1"><a id="__codelineno-208-1" name="__codelineno-208-1" href="#__codelineno-208-1"></a><span class="kt">string</span><span class="w"> </span><span class="n">dir</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">@&quot;c:\mydir&quot;</span><span class="p">;</span><span class="w"> </span><span class="c1">// or /mydir</span>
</span><span id="__span-208-2"><a id="__codelineno-208-2" name="__codelineno-208-2" href="#__codelineno-208-2"></a><span class="kt">string</span><span class="w"> </span><span class="n">file</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;myfile.txt&quot;</span><span class="p">;</span>
</span><span id="__span-208-3"><a id="__codelineno-208-3" name="__codelineno-208-3" href="#__codelineno-208-3"></a><span class="kt">string</span><span class="w"> </span><span class="n">path</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">@&quot;c:\mydir\myfile.txt&quot;</span><span class="p">;</span><span class="w"> </span><span class="c1">// or /mydir/myfile.txt</span>
</span><span id="__span-208-4"><a id="__codelineno-208-4" name="__codelineno-208-4" href="#__codelineno-208-4"></a><span class="n">Directory</span><span class="p">.</span><span class="n">SetCurrentDirectory</span><span class="w"> </span><span class="p">(</span><span class="s">@&quot;k:\demo&quot;</span><span class="p">);</span><span class="w"> </span><span class="c1">// or /demo</span>
</span></code></pre></div>
<h2 id="special-folders">Special Folders</h2>
<p>One thing missing from Path and Directory is a means to locate folders such as My Documents, Program Files, Application Data, and so on. This is provided instead by the <code>GetFolderPath</code> method in the <code>System.Environment</code> class:</p>
<div class="language-csharp highlight"><pre><span></span><code><span id="__span-209-1"><a id="__codelineno-209-1" name="__codelineno-209-1" href="#__codelineno-209-1"></a><span class="kt">string</span><span class="w"> </span><span class="n">myDocPath</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Environment</span><span class="p">.</span><span class="n">GetFolderPath</span>
</span><span id="__span-209-2"><a id="__codelineno-209-2" name="__codelineno-209-2" href="#__codelineno-209-2"></a><span class="w"> </span><span class="p">(</span><span class="n">Environment</span><span class="p">.</span><span class="n">SpecialFolder</span><span class="p">.</span><span class="n">MyDocuments</span><span class="p">);</span>
</span></code></pre></div>
<p>Environment.SpecialFolder is an enum whose values encompass all special direcâ€ tories in Windows, such as AdminTools, ApplicationData, Fonts, History, SendTo, StartMenu, and so on. Everything is covered here except the .NET Core directory, which you can obtain as follows:</p>
<div class="language-csharp highlight"><pre><span></span><code><span id="__span-210-1"><a id="__codelineno-210-1" name="__codelineno-210-1" href="#__codelineno-210-1"></a><span class="n">System</span><span class="p">.</span><span class="n">Runtime</span><span class="p">.</span><span class="n">InteropServices</span><span class="p">.</span><span class="n">RuntimeEnvironment</span><span class="p">.</span><span class="n">GetRuntimeDirectory</span><span class="p">()</span>
</span></code></pre></div>
<p>Of particular value on Windows systems is ApplicationData: this is where you can store settings that travel with a user across a network (if roaming profiles are enabled on the network domain) and LocalApplicationData, which is for nonâ€ roaming data (specific to the logged-in user) and CommonApplicationData, which is shared by every user of the computer. Writing application data to these folders is considered preferable to using the Windows Registry. The standard protocol for storing data in these folders is to create a subdirectory with the name of your application:</p>
<div class="language-csharp highlight"><pre><span></span><code><span id="__span-211-1"><a id="__codelineno-211-1" name="__codelineno-211-1" href="#__codelineno-211-1"></a><span class="kt">string</span><span class="w"> </span><span class="n">localAppDataPath</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Path</span><span class="p">.</span><span class="n">Combine</span><span class="w"> </span><span class="p">(</span>
</span><span id="__span-211-2"><a id="__codelineno-211-2" name="__codelineno-211-2" href="#__codelineno-211-2"></a><span class="w"> </span><span class="n">Environment</span><span class="p">.</span><span class="n">GetFolderPath</span><span class="w"> </span><span class="p">(</span><span class="n">Environment</span><span class="p">.</span><span class="n">SpecialFolder</span><span class="p">.</span><span class="n">ApplicationData</span><span class="p">),</span>
</span><span id="__span-211-3"><a id="__codelineno-211-3" name="__codelineno-211-3" href="#__codelineno-211-3"></a><span class="w"> </span><span class="s">&quot;MyCoolApplication&quot;</span><span class="p">);</span>
</span><span id="__span-211-4"><a id="__codelineno-211-4" name="__codelineno-211-4" href="#__codelineno-211-4"></a><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="n">Directory</span><span class="p">.</span><span class="n">Exists</span><span class="w"> </span><span class="p">(</span><span class="n">localAppDataPath</span><span class="p">))</span>
</span><span id="__span-211-5"><a id="__codelineno-211-5" name="__codelineno-211-5" href="#__codelineno-211-5"></a><span class="w"> </span><span class="n">Directory</span><span class="p">.</span><span class="n">CreateDirectory</span><span class="w"> </span><span class="p">(</span><span class="n">localAppDataPath</span><span class="p">);</span>
</span></code></pre></div>
<h2 id="querying-volume-information">Querying Volume Information</h2>
<p>You can query the drives on a computer with the DriveInfo class:</p>
<div class="language-csharp highlight"><pre><span></span><code><span id="__span-212-1"><a id="__codelineno-212-1" name="__codelineno-212-1" href="#__codelineno-212-1"></a><span class="n">DriveInfo</span><span class="w"> </span><span class="n">c</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">DriveInfo</span><span class="w"> </span><span class="p">(</span><span class="s">&quot;C&quot;</span><span class="p">);</span><span class="w"> </span><span class="c1">// Query the C: drive</span>
</span><span id="__span-212-2"><a id="__codelineno-212-2" name="__codelineno-212-2" href="#__codelineno-212-2"></a><span class="w"> </span><span class="c1">// On Unix: /</span>
</span><span id="__span-212-3"><a id="__codelineno-212-3" name="__codelineno-212-3" href="#__codelineno-212-3"></a><span class="kt">long</span><span class="w"> </span><span class="n">totalSize</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">c</span><span class="p">.</span><span class="n">TotalSize</span><span class="p">;</span><span class="w"> </span><span class="c1">// Size in bytes</span>
</span><span id="__span-212-4"><a id="__codelineno-212-4" name="__codelineno-212-4" href="#__codelineno-212-4"></a><span class="kt">long</span><span class="w"> </span><span class="n">freeBytes</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">c</span><span class="p">.</span><span class="n">TotalFreeSpace</span><span class="p">;</span><span class="w"> </span><span class="c1">// Ignores disk quotas</span>
</span><span id="__span-212-5"><a id="__codelineno-212-5" name="__codelineno-212-5" href="#__codelineno-212-5"></a><span class="kt">long</span><span class="w"> </span><span class="n">freeToMe</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">c</span><span class="p">.</span><span class="n">AvailableFreeSpace</span><span class="p">;</span><span class="w"> </span><span class="c1">// Takes quotas into account</span>
</span><span id="__span-212-6"><a id="__codelineno-212-6" name="__codelineno-212-6" href="#__codelineno-212-6"></a><span class="k">foreach</span><span class="w"> </span><span class="p">(</span><span class="n">DriveInfo</span><span class="w"> </span><span class="n">d</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">DriveInfo</span><span class="p">.</span><span class="n">GetDrives</span><span class="p">())</span><span class="w"> </span><span class="c1">// All defined drives</span>
</span><span id="__span-212-7"><a id="__codelineno-212-7" name="__codelineno-212-7" href="#__codelineno-212-7"></a><span class="w"> </span><span class="c1">// On Unix: mount points</span>
</span><span id="__span-212-8"><a id="__codelineno-212-8" name="__codelineno-212-8" href="#__codelineno-212-8"></a><span class="p">{</span>
</span><span id="__span-212-9"><a id="__codelineno-212-9" name="__codelineno-212-9" href="#__codelineno-212-9"></a><span class="w"> </span><span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="w"> </span><span class="p">(</span><span class="n">d</span><span class="p">.</span><span class="n">Name</span><span class="p">);</span><span class="w"> </span><span class="c1">// C:\</span>
</span><span id="__span-212-10"><a id="__codelineno-212-10" name="__codelineno-212-10" href="#__codelineno-212-10"></a><span class="w"> </span><span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="w"> </span><span class="p">(</span><span class="n">d</span><span class="p">.</span><span class="n">DriveType</span><span class="p">);</span><span class="w"> </span><span class="c1">// Fixed</span>
</span><span id="__span-212-11"><a id="__codelineno-212-11" name="__codelineno-212-11" href="#__codelineno-212-11"></a><span class="w"> </span><span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="w"> </span><span class="p">(</span><span class="n">d</span><span class="p">.</span><span class="n">RootDirectory</span><span class="p">);</span><span class="w"> </span><span class="c1">// C:\</span>
</span><span id="__span-212-12"><a id="__codelineno-212-12" name="__codelineno-212-12" href="#__codelineno-212-12"></a><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">d</span><span class="p">.</span><span class="n">IsReady</span><span class="p">)</span><span class="w"> </span><span class="c1">// If the drive is not ready, the following two</span>
</span><span id="__span-212-13"><a id="__codelineno-212-13" name="__codelineno-212-13" href="#__codelineno-212-13"></a><span class="w"> </span><span class="c1">// properties will throw exceptions:</span>
</span><span id="__span-212-14"><a id="__codelineno-212-14" name="__codelineno-212-14" href="#__codelineno-212-14"></a><span class="w"> </span><span class="p">{</span>
</span><span id="__span-212-15"><a id="__codelineno-212-15" name="__codelineno-212-15" href="#__codelineno-212-15"></a><span class="w"> </span><span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="w"> </span><span class="p">(</span><span class="n">d</span><span class="p">.</span><span class="n">VolumeLabel</span><span class="p">);</span><span class="w"> </span><span class="c1">// The Sea Drive</span>
</span><span id="__span-212-16"><a id="__codelineno-212-16" name="__codelineno-212-16" href="#__codelineno-212-16"></a><span class="w"> </span><span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="w"> </span><span class="p">(</span><span class="n">d</span><span class="p">.</span><span class="n">DriveFormat</span><span class="p">);</span><span class="w"> </span><span class="c1">// NTFS</span>
</span><span id="__span-212-17"><a id="__codelineno-212-17" name="__codelineno-212-17" href="#__codelineno-212-17"></a><span class="w"> </span><span class="p">}</span>
</span><span id="__span-212-18"><a id="__codelineno-212-18" name="__codelineno-212-18" href="#__codelineno-212-18"></a><span class="p">}</span>
</span></code></pre></div>
<h2 id="catching-filesystem-events">Catching Filesystem Events</h2>
<p>The FileSystemWatcher class lets you monitor a directory (and optionally, subdirectories) for activity. FileSystemWatcher has events that fire when files or subdirectories are created, modified, renamed, and deleted, as well as when their attributes change. These events fire regardless of the user or process performing the change. Hereâ€™s an example:</p>
<div class="language-csharp highlight"><pre><span></span><code><span id="__span-213-1"><a id="__codelineno-213-1" name="__codelineno-213-1" href="#__codelineno-213-1"></a><span class="k">static</span><span class="w"> </span><span class="k">void</span><span class="w"> </span><span class="nf">Main</span><span class="p">()</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="n">Watch</span><span class="w"> </span><span class="p">(</span><span class="n">TestDirectory</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;*.txt&quot;</span><span class="p">,</span><span class="w"> </span><span class="k">true</span><span class="p">);</span>
</span><span id="__span-213-2"><a id="__codelineno-213-2" name="__codelineno-213-2" href="#__codelineno-213-2"></a><span class="k">static</span><span class="w"> </span><span class="k">void</span><span class="w"> </span><span class="nf">Watch</span><span class="w"> </span><span class="p">(</span><span class="kt">string</span><span class="w"> </span><span class="n">path</span><span class="p">,</span><span class="w"> </span><span class="kt">string</span><span class="w"> </span><span class="n">filter</span><span class="p">,</span><span class="w"> </span><span class="kt">bool</span><span class="w"> </span><span class="n">includeSubDirs</span><span class="p">)</span>
</span><span id="__span-213-3"><a id="__codelineno-213-3" name="__codelineno-213-3" href="#__codelineno-213-3"></a><span class="p">{</span>
</span><span id="__span-213-4"><a id="__codelineno-213-4" name="__codelineno-213-4" href="#__codelineno-213-4"></a><span class="k">using</span><span class="w"> </span><span class="p">(</span><span class="kt">var</span><span class="w"> </span><span class="n">watcher</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">FileSystemWatcher</span><span class="w"> </span><span class="p">(</span><span class="n">path</span><span class="p">,</span><span class="w"> </span><span class="n">filter</span><span class="p">))</span>
</span><span id="__span-213-5"><a id="__codelineno-213-5" name="__codelineno-213-5" href="#__codelineno-213-5"></a><span class="w"> </span><span class="p">{</span>
</span><span id="__span-213-6"><a id="__codelineno-213-6" name="__codelineno-213-6" href="#__codelineno-213-6"></a><span class="w"> </span><span class="n">watcher</span><span class="p">.</span><span class="n">Created</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="n">FileCreatedChangedDeleted</span><span class="p">;</span>
</span><span id="__span-213-7"><a id="__codelineno-213-7" name="__codelineno-213-7" href="#__codelineno-213-7"></a><span class="w"> </span><span class="n">watcher</span><span class="p">.</span><span class="n">Changed</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="n">FileCreatedChangedDeleted</span><span class="p">;</span>
</span><span id="__span-213-8"><a id="__codelineno-213-8" name="__codelineno-213-8" href="#__codelineno-213-8"></a><span class="w"> </span><span class="n">watcher</span><span class="p">.</span><span class="n">Deleted</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="n">FileCreatedChangedDeleted</span><span class="p">;</span>
</span><span id="__span-213-9"><a id="__codelineno-213-9" name="__codelineno-213-9" href="#__codelineno-213-9"></a><span class="w"> </span><span class="n">watcher</span><span class="p">.</span><span class="n">Renamed</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="n">FileRenamed</span><span class="p">;</span>
</span><span id="__span-213-10"><a id="__codelineno-213-10" name="__codelineno-213-10" href="#__codelineno-213-10"></a><span class="w"> </span><span class="n">watcher</span><span class="p">.</span><span class="n">Error</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="n">FileError</span><span class="p">;</span>
</span><span id="__span-213-11"><a id="__codelineno-213-11" name="__codelineno-213-11" href="#__codelineno-213-11"></a><span class="w"> </span><span class="n">watcher</span><span class="p">.</span><span class="n">IncludeSubdirectories</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">includeSubDirs</span><span class="p">;</span>
</span><span id="__span-213-12"><a id="__codelineno-213-12" name="__codelineno-213-12" href="#__codelineno-213-12"></a><span class="w"> </span><span class="n">watcher</span><span class="p">.</span><span class="n">EnableRaisingEvents</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">true</span><span class="p">;</span>
</span><span id="__span-213-13"><a id="__codelineno-213-13" name="__codelineno-213-13" href="#__codelineno-213-13"></a><span class="w"> </span><span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="w"> </span><span class="p">(</span><span class="s">&quot;Listening for events - press &lt;enter&gt; to end&quot;</span><span class="p">);</span>
</span><span id="__span-213-14"><a id="__codelineno-213-14" name="__codelineno-213-14" href="#__codelineno-213-14"></a><span class="w"> </span><span class="n">Console</span><span class="p">.</span><span class="n">ReadLine</span><span class="p">();</span>
</span><span id="__span-213-15"><a id="__codelineno-213-15" name="__codelineno-213-15" href="#__codelineno-213-15"></a><span class="w"> </span><span class="p">}</span>
</span><span id="__span-213-16"><a id="__codelineno-213-16" name="__codelineno-213-16" href="#__codelineno-213-16"></a><span class="w"> </span><span class="c1">// Disposing the FileSystemWatcher stops further events from firing.</span>
</span><span id="__span-213-17"><a id="__codelineno-213-17" name="__codelineno-213-17" href="#__codelineno-213-17"></a><span class="p">}</span>
</span><span id="__span-213-18"><a id="__codelineno-213-18" name="__codelineno-213-18" href="#__codelineno-213-18"></a><span class="k">static</span><span class="w"> </span><span class="k">void</span><span class="w"> </span><span class="nf">FileCreatedChangedDeleted</span><span class="w"> </span><span class="p">(</span><span class="kt">object</span><span class="w"> </span><span class="n">o</span><span class="p">,</span><span class="w"> </span><span class="n">FileSystemEventArgs</span><span class="w"> </span><span class="n">e</span><span class="p">)</span>
</span><span id="__span-213-19"><a id="__codelineno-213-19" name="__codelineno-213-19" href="#__codelineno-213-19"></a><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="w"> </span><span class="p">(</span><span class="s">&quot;File {0} has been {1}&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">e</span><span class="p">.</span><span class="n">FullPath</span><span class="p">,</span><span class="w"> </span><span class="n">e</span><span class="p">.</span><span class="n">ChangeType</span><span class="p">);</span>
</span><span id="__span-213-20"><a id="__codelineno-213-20" name="__codelineno-213-20" href="#__codelineno-213-20"></a><span class="k">static</span><span class="w"> </span><span class="k">void</span><span class="w"> </span><span class="nf">FileRenamed</span><span class="w"> </span><span class="p">(</span><span class="kt">object</span><span class="w"> </span><span class="n">o</span><span class="p">,</span><span class="w"> </span><span class="n">RenamedEventArgs</span><span class="w"> </span><span class="n">e</span><span class="p">)</span>
</span><span id="__span-213-21"><a id="__codelineno-213-21" name="__codelineno-213-21" href="#__codelineno-213-21"></a><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="w"> </span><span class="p">(</span><span class="s">&quot;Renamed: {0}-&gt;{1}&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">e</span><span class="p">.</span><span class="n">OldFullPath</span><span class="p">,</span><span class="w"> </span><span class="n">e</span><span class="p">.</span><span class="n">FullPath</span><span class="p">);</span>
</span><span id="__span-213-22"><a id="__codelineno-213-22" name="__codelineno-213-22" href="#__codelineno-213-22"></a><span class="k">static</span><span class="w"> </span><span class="k">void</span><span class="w"> </span><span class="nf">FileError</span><span class="w"> </span><span class="p">(</span><span class="kt">object</span><span class="w"> </span><span class="n">o</span><span class="p">,</span><span class="w"> </span><span class="n">ErrorEventArgs</span><span class="w"> </span><span class="n">e</span><span class="p">)</span>
</span><span id="__span-213-23"><a id="__codelineno-213-23" name="__codelineno-213-23" href="#__codelineno-213-23"></a><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="w"> </span><span class="p">(</span><span class="s">&quot;Error: &quot;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">e</span><span class="p">.</span><span class="n">GetException</span><span class="p">().</span><span class="n">Message</span><span class="p">);</span>
</span><span id="__span-213-24"><a id="__codelineno-213-24" name="__codelineno-213-24" href="#__codelineno-213-24"></a><span class="k">static</span><span class="w"> </span><span class="kt">string</span><span class="w"> </span><span class="n">TestDirectory</span><span class="w"> </span><span class="o">=&gt;</span>
</span><span id="__span-213-25"><a id="__codelineno-213-25" name="__codelineno-213-25" href="#__codelineno-213-25"></a><span class="w"> </span><span class="n">RuntimeInformation</span><span class="p">.</span><span class="n">IsOSPlatform</span><span class="w"> </span><span class="p">(</span><span class="n">OSPlatform</span><span class="p">.</span><span class="n">Windows</span><span class="p">)</span>
</span><span id="__span-213-26"><a id="__codelineno-213-26" name="__codelineno-213-26" href="#__codelineno-213-26"></a><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="s">@&quot;C:\Temp&quot;</span>
</span><span id="__span-213-27"><a id="__codelineno-213-27" name="__codelineno-213-27" href="#__codelineno-213-27"></a><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s">&quot;/tmp&quot;</span><span class="p">;</span>
</span></code></pre></div>
<h1 id="os-security">OS Security</h1>
<p>All applications are subject to OS restrictions, based on the userâ€™s login privileges. These restrictions affect file I/O as well as other capabilities, such as access to the Windows Registry.</p>
<p>In Windows and Unix, there are two types of accounts</p>
<ul>
<li>An administrative/superuser account that imposes no restrictions in accessing the local computer</li>
<li>A limited permissions account that restricts administrative functions and visiâ€ bility of other usersâ€™ data</li>
</ul>
<p>On Windows, a feature called User Account Control (UAC) means that administraâ€ tors receive two tokens or â€œhatsâ€ when logging in: an administrative hat and an ordinary user hat. By default, programs run wearing the ordinary user hatâ€”with restricted permissionsâ€”unless the program requests administrative elevation. The user must then approve the request in the dialog box thatâ€™s presented.</p>
<p>By default, your application will run with restricted user privileges. This means that you must either:</p>
<ul>
<li>Write your application such that it can run without administrative privileges</li>
<li>Demand administrative elevation in the application manifest (Windows only), or detect the lack of required privileges and alert the user to restart the applicaâ€ tion as an administrator/super-user.</li>
</ul>
<p>The first option is safer and more convenient to the user. Designing your program to run without administrative privileges is easy in most cases</p>
<p>You can find out whether youâ€™re running under an administrative account, as follows:</p>
<div class="language-csharp highlight"><pre><span></span><code><span id="__span-214-1"><a id="__codelineno-214-1" name="__codelineno-214-1" href="#__codelineno-214-1"></a><span class="na">[DllImport(&quot;libc&quot;)]</span>
</span><span id="__span-214-2"><a id="__codelineno-214-2" name="__codelineno-214-2" href="#__codelineno-214-2"></a><span class="k">public</span><span class="w"> </span><span class="k">static</span><span class="w"> </span><span class="k">extern</span><span class="w"> </span><span class="kt">uint</span><span class="w"> </span><span class="nf">getuid</span><span class="p">();</span>
</span><span id="__span-214-3"><a id="__codelineno-214-3" name="__codelineno-214-3" href="#__codelineno-214-3"></a><span class="k">static</span><span class="w"> </span><span class="kt">bool</span><span class="w"> </span><span class="nf">IsRunningAsAdmin</span><span class="p">()</span>
</span><span id="__span-214-4"><a id="__codelineno-214-4" name="__codelineno-214-4" href="#__codelineno-214-4"></a><span class="p">{</span>
</span><span id="__span-214-5"><a id="__codelineno-214-5" name="__codelineno-214-5" href="#__codelineno-214-5"></a><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">RuntimeInformation</span><span class="p">.</span><span class="n">IsOSPlatform</span><span class="w"> </span><span class="p">(</span><span class="n">OSPlatform</span><span class="p">.</span><span class="n">Windows</span><span class="p">))</span>
</span><span id="__span-214-6"><a id="__codelineno-214-6" name="__codelineno-214-6" href="#__codelineno-214-6"></a><span class="w"> </span><span class="p">{</span>
</span><span id="__span-214-7"><a id="__codelineno-214-7" name="__codelineno-214-7" href="#__codelineno-214-7"></a><span class="w"> </span><span class="k">using</span><span class="w"> </span><span class="nn">var</span><span class="w"> </span><span class="n">identity</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">WindowsIdentity</span><span class="p">.</span><span class="n">GetCurrent</span><span class="p">();</span>
</span><span id="__span-214-8"><a id="__codelineno-214-8" name="__codelineno-214-8" href="#__codelineno-214-8"></a><span class="w"> </span><span class="kt">var</span><span class="w"> </span><span class="n">principal</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">WindowsPrincipal</span><span class="w"> </span><span class="p">(</span><span class="n">identity</span><span class="p">);</span>
</span><span id="__span-214-9"><a id="__codelineno-214-9" name="__codelineno-214-9" href="#__codelineno-214-9"></a><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="n">principal</span><span class="p">.</span><span class="n">IsInRole</span><span class="w"> </span><span class="p">(</span><span class="n">WindowsBuiltInRole</span><span class="p">.</span><span class="n">Administrator</span><span class="p">);</span>
</span><span id="__span-214-10"><a id="__codelineno-214-10" name="__codelineno-214-10" href="#__codelineno-214-10"></a><span class="w"> </span><span class="p">}</span>
</span><span id="__span-214-11"><a id="__codelineno-214-11" name="__codelineno-214-11" href="#__codelineno-214-11"></a><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="nf">getuid</span><span class="p">()</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
</span><span id="__span-214-12"><a id="__codelineno-214-12" name="__codelineno-214-12" href="#__codelineno-214-12"></a><span class="p">}</span>
</span></code></pre></div>
<h3 id="running-in-a-standard-user-account">Running in a Standard User Account</h3>
<p>Here are the key things that you cannot do in a standard user account</p>
<ul>
<li>Write to the following directories:<ul>
<li>The OS folder (typically \Windows or /bin, /sbin, ...) and subdirectories</li>
<li>The program files folder (\Program Files or /usr/bin, /opt) and subdirectories</li>
<li>The root of the OS drive (e.g., C:\ or /)</li>
</ul>
</li>
<li>Write to the HKEY_LOCAL_MACHINE branch of the Registry (Windows)</li>
<li>Read performance monitoring (WMI) data (Windows)</li>
</ul>
<p>If youâ€™re refused access to anything as a result of OS security, the CLR detects the failure and throws an UnauthorizedAccessException (rather than failing silently).</p>
<p>The recommended location for user documents is SpecialFolder.MyDocuments:</p>
<div class="language-csharp highlight"><pre><span></span><code><span id="__span-215-1"><a id="__codelineno-215-1" name="__codelineno-215-1" href="#__codelineno-215-1"></a><span class="kt">string</span><span class="w"> </span><span class="n">docsFolder</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Environment</span><span class="p">.</span><span class="n">GetFolderPath</span>
</span><span id="__span-215-2"><a id="__codelineno-215-2" name="__codelineno-215-2" href="#__codelineno-215-2"></a><span class="w"> </span><span class="p">(</span><span class="n">Environment</span><span class="p">.</span><span class="n">SpecialFolder</span><span class="p">.</span><span class="n">MyDocuments</span><span class="p">);</span>
</span><span id="__span-215-3"><a id="__codelineno-215-3" name="__codelineno-215-3" href="#__codelineno-215-3"></a><span class="kt">string</span><span class="w"> </span><span class="n">path</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Path</span><span class="p">.</span><span class="n">Combine</span><span class="w"> </span><span class="p">(</span><span class="n">docsFolder</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;test.txt&quot;</span><span class="p">);</span>
</span><span id="__span-215-4"><a id="__codelineno-215-4" name="__codelineno-215-4" href="#__codelineno-215-4"></a><span class="err">```#</span><span class="w"> </span><span class="n">Chapter</span><span class="w"> </span><span class="mi">17</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="n">Serialization</span>
</span><span id="__span-215-5"><a id="__codelineno-215-5" name="__codelineno-215-5" href="#__codelineno-215-5"></a>
</span><span id="__span-215-6"><a id="__codelineno-215-6" name="__codelineno-215-6" href="#__codelineno-215-6"></a><span class="n">This</span><span class="w"> </span><span class="n">chapter</span><span class="w"> </span><span class="n">introduces</span><span class="w"> </span><span class="n">serialization</span><span class="w"> </span><span class="k">and</span><span class="w"> </span><span class="n">deserialization</span><span class="p">,</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">mechanism</span><span class="w"> </span><span class="k">by</span><span class="w"> </span><span class="n">which</span><span class="w"> </span><span class="n">objects</span><span class="w"> </span><span class="n">can</span><span class="w"> </span><span class="n">be</span><span class="w"> </span><span class="n">represented</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">flat</span><span class="o">-</span><span class="n">text</span><span class="w"> </span><span class="k">or</span><span class="w"> </span><span class="n">binary</span><span class="w"> </span><span class="n">form</span><span class="p">.</span><span class="w"> </span><span class="n">Unless</span><span class="w"> </span><span class="n">otherwise</span><span class="w"> </span><span class="n">stated</span><span class="p">,</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">types</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="k">this</span><span class="w"> </span><span class="n">chapter</span><span class="w"> </span><span class="n">all</span><span class="w"> </span><span class="n">exist</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">following</span><span class="w"> </span><span class="n">namespaces</span>
</span><span id="__span-215-7"><a id="__codelineno-215-7" name="__codelineno-215-7" href="#__codelineno-215-7"></a>
</span><span id="__span-215-8"><a id="__codelineno-215-8" name="__codelineno-215-8" href="#__codelineno-215-8"></a><span class="err">```</span><span class="n">csharp</span>
</span><span id="__span-215-9"><a id="__codelineno-215-9" name="__codelineno-215-9" href="#__codelineno-215-9"></a><span class="n">System</span><span class="p">.</span><span class="n">Runtime</span><span class="p">.</span><span class="n">Serialization</span>
</span><span id="__span-215-10"><a id="__codelineno-215-10" name="__codelineno-215-10" href="#__codelineno-215-10"></a><span class="n">System</span><span class="p">.</span><span class="n">Xml</span><span class="p">.</span><span class="n">Serialization</span>
</span><span id="__span-215-11"><a id="__codelineno-215-11" name="__codelineno-215-11" href="#__codelineno-215-11"></a><span class="n">System</span><span class="p">.</span><span class="n">Text</span><span class="p">.</span><span class="n">Json</span>
</span></code></pre></div>
<h1 id="serialization-concepts">Serialization Concepts</h1>
<p>Serialization is the act of taking an in-memory object or object graph (set of objects that reference one another) and flattening it into a stream of bytes, XML, JSON, or a similar representation that can be stored or transmitted.</p>
<p>Deserialization works in reverse, taking a data stream and reconstituting it into an in-memory object or object graph.</p>
<p>Serialization and deserialization are typically used to do the following</p>
<ul>
<li>Transmit objects across a network or application boundary</li>
<li>Store representations of objects within a file or database</li>
</ul>
<p>Another, less common use is to deep-clone objects. You also can use the data conâ€ tract and XML serialization engines as general-purpose tools for loading and saving XML files of a known structure, whereas the JSON serializer can do the same for JSON files.</p>
<h2 id="serialization-engines">Serialization Engines</h2>
<p>There are four serialization engines in .NET Core:</p>
<ul>
<li>XmlSerializer (XML)</li>
<li>JsonSerializer (JSON)</li>
<li>The (somewhat redundant) data contract serializer (XML and JSON)</li>
<li>The binary serializer (binary)</li>
</ul>
<p>If youâ€™re serializing to XML, you can choose between XmlSerializer and the data contract serializer. XmlSerializer offers greater flexibility on how the XML is structured, whereas the data contract serializer has the unique ability to preserve shared object references.</p>
<p>If youâ€™re serializing to JSON, you also have a choice. JsonSerializer offers the best performance, whereas the data contract serializer has a few extra features due to its longer heritage. However, <strong>if you need extra features, a better choice is likely to be the third-party <a href="http://json.net/"><code>Json.NET</code></a> library.</strong></p>
<p>And if you donâ€™t care about the format, the binary serialization engine is the most powerful and easiest to use. The output, however, is not human-readable and itâ€™s less version-tolerant than the other serializers.</p>
<h2 id="xmlserializer">XmlSerializer</h2>
<p>The XML serialization engine can produce only XML, and it is less powerful than the binary and data contract serializers in saving and restoring a complex object graph (it cannot restore shared object references). Itâ€™s the most flexible of the four, however, in following an arbitrary output structure. For instance, you can choose whether properties are serialized to elements or attributes and the handling of a colâ€ lectionâ€™s outer element. The XML engine also provides excellent version tolerance. XmlSerializer was used by the legacy ASMX web services.</p>
<h2 id="jsonserializer">JsonSerializer</h2>
<p>The JSON serializer is fast and efficient, and was introduced relatively recently to .NET Core. It also offers good version tolerance and allows the use of custom converters for flexibility. JsonSerializer is used by <a href="http://asp.net/">ASP.NET</a> Core 3, removing the dependency on <a href="http://json.net/">Json.NET</a>, though it is straightforward to opt back in to <a href="http://json.net/">Json.NET</a> should its features be required.</p>
<h2 id="the-binary-serializer">The binary serializer</h2>
<p>The binary serialization engine is easy to use, highly automatic, and well supported throughout .NET Core 3 (and even more so in .NET Framework). Quite often, a single attribute is all thatâ€™s required to make a complex type fully serializable. The binary serializer is also faster than the data contract serializer when full type fidelity is needed. However, it tightly couples a typeâ€™s internal structure to the format of the serialized data, resulting in poor version tolerance (although it can tolerate the simâ€ ple addition of a field). The binary engine emits only binary data;</p>
<h2 id="formatters">Formatters</h2>
<p>The output of the data contract and binary serializers is shaped by a pluggable formatter. The role of a formatter is the same with both serialization engines, although they use completely different classes to do the job.</p>
<p>A formatter shapes the final presentation to suit a particular medium or context of serialization. In .NET Core, the data contract serializer lets you choose between XML and JSON formatters, and in .NET Framework you can also choose a binary formatter. A binary formatter is designed to work in a context for which an arbiâ€ trary stream of bytes will doâ€”typically a file/stream or proprietary messaging packet. Binary output is usually smaller than XML or JSON.</p>
<h1 id="the-xml-serializer">The XML Serializer</h1>
<p>The XmlSerializer class in the <code>System.Xml.Serialization</code> namespace serializes and deserializes based on attributes in your classes.</p>
<h2 id="getting-started-with-attribute-based-serialization">Getting Started with Attribute-Based Serialization</h2>
<div class="language-csharp highlight"><pre><span></span><code><span id="__span-216-1"><a id="__codelineno-216-1" name="__codelineno-216-1" href="#__codelineno-216-1"></a><span class="k">public</span><span class="w"> </span><span class="k">class</span><span class="w"> </span><span class="nc">Person</span>
</span><span id="__span-216-2"><a id="__codelineno-216-2" name="__codelineno-216-2" href="#__codelineno-216-2"></a><span class="p">{</span>
</span><span id="__span-216-3"><a id="__codelineno-216-3" name="__codelineno-216-3" href="#__codelineno-216-3"></a><span class="w"> </span><span class="k">public</span><span class="w"> </span><span class="kt">string</span><span class="w"> </span><span class="n">Name</span><span class="p">;</span>
</span><span id="__span-216-4"><a id="__codelineno-216-4" name="__codelineno-216-4" href="#__codelineno-216-4"></a><span class="w"> </span><span class="k">public</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">Age</span><span class="p">;</span>
</span><span id="__span-216-5"><a id="__codelineno-216-5" name="__codelineno-216-5" href="#__codelineno-216-5"></a><span class="p">}</span>
</span><span id="__span-216-6"><a id="__codelineno-216-6" name="__codelineno-216-6" href="#__codelineno-216-6"></a><span class="c1">//The following saves a Person to an XML file and then restores it:</span>
</span><span id="__span-216-7"><a id="__codelineno-216-7" name="__codelineno-216-7" href="#__codelineno-216-7"></a><span class="n">Person</span><span class="w"> </span><span class="n">p</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">Person</span><span class="p">();</span>
</span><span id="__span-216-8"><a id="__codelineno-216-8" name="__codelineno-216-8" href="#__codelineno-216-8"></a><span class="n">p</span><span class="p">.</span><span class="n">Name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;Stacey&quot;</span><span class="p">;</span><span class="w"> </span><span class="n">p</span><span class="p">.</span><span class="n">Age</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">30</span><span class="p">;</span>
</span><span id="__span-216-9"><a id="__codelineno-216-9" name="__codelineno-216-9" href="#__codelineno-216-9"></a><span class="kt">var</span><span class="w"> </span><span class="n">xs</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">XmlSerializer</span><span class="w"> </span><span class="p">(</span><span class="k">typeof</span><span class="w"> </span><span class="p">(</span><span class="n">Person</span><span class="p">));</span>
</span><span id="__span-216-10"><a id="__codelineno-216-10" name="__codelineno-216-10" href="#__codelineno-216-10"></a><span class="k">using</span><span class="w"> </span><span class="p">(</span><span class="n">Stream</span><span class="w"> </span><span class="n">s</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">File</span><span class="p">.</span><span class="n">Create</span><span class="w"> </span><span class="p">(</span><span class="s">&quot;person.xml&quot;</span><span class="p">))</span>
</span><span id="__span-216-11"><a id="__codelineno-216-11" name="__codelineno-216-11" href="#__codelineno-216-11"></a><span class="w"> </span><span class="n">xs</span><span class="p">.</span><span class="n">Serialize</span><span class="w"> </span><span class="p">(</span><span class="n">s</span><span class="p">,</span><span class="w"> </span><span class="n">p</span><span class="p">);</span>
</span><span id="__span-216-12"><a id="__codelineno-216-12" name="__codelineno-216-12" href="#__codelineno-216-12"></a><span class="n">Person</span><span class="w"> </span><span class="n">p2</span><span class="p">;</span>
</span><span id="__span-216-13"><a id="__codelineno-216-13" name="__codelineno-216-13" href="#__codelineno-216-13"></a><span class="k">using</span><span class="w"> </span><span class="p">(</span><span class="n">Stream</span><span class="w"> </span><span class="n">s</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">File</span><span class="p">.</span><span class="n">OpenRead</span><span class="w"> </span><span class="p">(</span><span class="s">&quot;person.xml&quot;</span><span class="p">))</span>
</span><span id="__span-216-14"><a id="__codelineno-216-14" name="__codelineno-216-14" href="#__codelineno-216-14"></a><span class="w"> </span><span class="n">p2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">Person</span><span class="p">)</span><span class="w"> </span><span class="n">xs</span><span class="p">.</span><span class="n">Deserialize</span><span class="w"> </span><span class="p">(</span><span class="n">s</span><span class="p">);</span>
</span><span id="__span-216-15"><a id="__codelineno-216-15" name="__codelineno-216-15" href="#__codelineno-216-15"></a><span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="w"> </span><span class="p">(</span><span class="n">p2</span><span class="p">.</span><span class="n">Name</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s">&quot; &quot;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">p2</span><span class="p">.</span><span class="n">Age</span><span class="p">);</span><span class="w"> </span><span class="c1">// Stacey 30</span>
</span></code></pre></div>
<p>Serialize and Deserialize can work with a Stream, XmlWriter/XmlReader, or TextWriter/TextReader. Hereâ€™s the resultant XML:</p>
<div class="language-xml highlight"><pre><span></span><code><span id="__span-217-1"><a id="__codelineno-217-1" name="__codelineno-217-1" href="#__codelineno-217-1"></a><span class="cp">&lt;?xml version=&quot;1.0&quot;?&gt;</span>
</span><span id="__span-217-2"><a id="__codelineno-217-2" name="__codelineno-217-2" href="#__codelineno-217-2"></a><span class="nt">&lt;Person</span><span class="w"> </span><span class="na">xmlns:xsi=</span><span class="s">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span>
</span><span id="__span-217-3"><a id="__codelineno-217-3" name="__codelineno-217-3" href="#__codelineno-217-3"></a><span class="w"> </span><span class="na">xmlns:xsd=</span><span class="s">&quot;http://www.w3.org/2001/XMLSchema&quot;</span><span class="nt">&gt;</span>
</span><span id="__span-217-4"><a id="__codelineno-217-4" name="__codelineno-217-4" href="#__codelineno-217-4"></a><span class="w"> </span><span class="nt">&lt;Name&gt;</span>Stacey<span class="nt">&lt;/Name&gt;</span>
</span><span id="__span-217-5"><a id="__codelineno-217-5" name="__codelineno-217-5" href="#__codelineno-217-5"></a><span class="w"> </span><span class="nt">&lt;Age&gt;</span>30<span class="nt">&lt;/Age&gt;</span>
</span><span id="__span-217-6"><a id="__codelineno-217-6" name="__codelineno-217-6" href="#__codelineno-217-6"></a><span class="nt">&lt;/Person&gt;</span>
</span></code></pre></div>
<p>XmlSerializer can serialize types without any attributesâ€”such as our Person type. By default, it serializes all public fields and properties on a type. You can exclude members that you donâ€™t want serialized by applying the <code>XmlIgnore</code> attribute:</p>
<div class="language-csharp highlight"><pre><span></span><code><span id="__span-218-1"><a id="__codelineno-218-1" name="__codelineno-218-1" href="#__codelineno-218-1"></a><span class="k">public</span><span class="w"> </span><span class="k">class</span><span class="w"> </span><span class="nc">Person</span>
</span><span id="__span-218-2"><a id="__codelineno-218-2" name="__codelineno-218-2" href="#__codelineno-218-2"></a><span class="p">{</span>
</span><span id="__span-218-3"><a id="__codelineno-218-3" name="__codelineno-218-3" href="#__codelineno-218-3"></a><span class="w"> </span><span class="p">...</span>
</span><span id="__span-218-4"><a id="__codelineno-218-4" name="__codelineno-218-4" href="#__codelineno-218-4"></a><span class="w"> </span><span class="na">[XmlIgnore]</span><span class="w"> </span><span class="k">public</span><span class="w"> </span><span class="n">DateTime</span><span class="w"> </span><span class="n">DateOfBirth</span><span class="p">;</span>
</span><span id="__span-218-5"><a id="__codelineno-218-5" name="__codelineno-218-5" href="#__codelineno-218-5"></a><span class="p">}</span>
</span></code></pre></div>
<p>XmlSerializer relies on a parameterless constructor for deserialization, throwing an exception if one is not present. (In our example, Person has an implicit parameâ€ terless constructor.) This also means that field initializers execute prior to deserialization:</p>
<div class="language-csharp highlight"><pre><span></span><code><span id="__span-219-1"><a id="__codelineno-219-1" name="__codelineno-219-1" href="#__codelineno-219-1"></a><span class="k">public</span><span class="w"> </span><span class="k">class</span><span class="w"> </span><span class="nc">Person</span>
</span><span id="__span-219-2"><a id="__codelineno-219-2" name="__codelineno-219-2" href="#__codelineno-219-2"></a><span class="p">{</span>
</span><span id="__span-219-3"><a id="__codelineno-219-3" name="__codelineno-219-3" href="#__codelineno-219-3"></a><span class="w"> </span><span class="k">public</span><span class="w"> </span><span class="kt">bool</span><span class="w"> </span><span class="n">Valid</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">true</span><span class="p">;</span><span class="w"> </span><span class="c1">// Executes before deserialization</span>
</span><span id="__span-219-4"><a id="__codelineno-219-4" name="__codelineno-219-4" href="#__codelineno-219-4"></a><span class="p">}</span>
</span></code></pre></div>
<p>Although XmlSerializer can serialize almost any type, it recognizes the following types and treats them specially:</p>
<ul>
<li>The primitive types, DateTime, TimeSpan, Guid, and nullable versions</li>
<li>byte[] (which is converted to base 64)</li>
<li>An XmlAttribute or XmlElement (whose contents are injected into the stream)</li>
<li>Any type implementing IXmlSerializable</li>
<li>Any collection type</li>
</ul>
<h3 id="attributes-names-and-namespaces">Attributes, names, and namespaces</h3>
<p>By default, fields and properties serialize to an XML element. You can request an XML attribute be used, instead, as follows:</p>
<div class="language-csharp highlight"><pre><span></span><code><span id="__span-220-1"><a id="__codelineno-220-1" name="__codelineno-220-1" href="#__codelineno-220-1"></a><span class="na">[XmlAttribute]</span><span class="w"> </span><span class="k">public</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">Age</span><span class="p">;</span>
</span><span id="__span-220-2"><a id="__codelineno-220-2" name="__codelineno-220-2" href="#__codelineno-220-2"></a><span class="c1">//You can control an element or attributeâ€™s name as follows:</span>
</span><span id="__span-220-3"><a id="__codelineno-220-3" name="__codelineno-220-3" href="#__codelineno-220-3"></a><span class="k">public</span><span class="w"> </span><span class="k">class</span><span class="w"> </span><span class="nc">Person</span>
</span><span id="__span-220-4"><a id="__codelineno-220-4" name="__codelineno-220-4" href="#__codelineno-220-4"></a><span class="p">{</span>
</span><span id="__span-220-5"><a id="__codelineno-220-5" name="__codelineno-220-5" href="#__codelineno-220-5"></a><span class="w"> </span><span class="na">[XmlElement (&quot;FirstName&quot;)]</span><span class="w"> </span><span class="k">public</span><span class="w"> </span><span class="kt">string</span><span class="w"> </span><span class="n">Name</span><span class="p">;</span>
</span><span id="__span-220-6"><a id="__codelineno-220-6" name="__codelineno-220-6" href="#__codelineno-220-6"></a><span class="w"> </span><span class="na">[XmlAttribute (&quot;RoughAge&quot;)]</span><span class="w"> </span><span class="k">public</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">Age</span><span class="p">;</span>
</span><span id="__span-220-7"><a id="__codelineno-220-7" name="__codelineno-220-7" href="#__codelineno-220-7"></a><span class="p">}</span>
</span><span id="__span-220-8"><a id="__codelineno-220-8" name="__codelineno-220-8" href="#__codelineno-220-8"></a>
</span><span id="__span-220-9"><a id="__codelineno-220-9" name="__codelineno-220-9" href="#__codelineno-220-9"></a><span class="c1">//Results</span>
</span><span id="__span-220-10"><a id="__codelineno-220-10" name="__codelineno-220-10" href="#__codelineno-220-10"></a><span class="o">&lt;</span><span class="n">Person</span><span class="w"> </span><span class="n">RoughAge</span><span class="o">=</span><span class="s">&quot;30&quot;</span><span class="w"> </span><span class="p">...</span><span class="o">&gt;</span>
</span><span id="__span-220-11"><a id="__codelineno-220-11" name="__codelineno-220-11" href="#__codelineno-220-11"></a><span class="w"> </span><span class="o">&lt;</span><span class="n">FirstName</span><span class="o">&gt;</span><span class="n">Stacey</span><span class="o">&lt;/</span><span class="n">FirstName</span><span class="o">&gt;</span>
</span><span id="__span-220-12"><a id="__codelineno-220-12" name="__codelineno-220-12" href="#__codelineno-220-12"></a><span class="o">&lt;/</span><span class="n">Person</span><span class="o">&gt;</span>
</span></code></pre></div>
<p>The default XML namespace is blank. To specify an XML namespace, [XmlElement] and [XmlAttribute] both accept a Namespace argument. You can also assign a name and namespace to the type itself with [XmlRoot]:</p>
<div class="language-csharp highlight"><pre><span></span><code><span id="__span-221-1"><a id="__codelineno-221-1" name="__codelineno-221-1" href="#__codelineno-221-1"></a><span class="na">[XmlRoot (&quot;Candidate&quot;, Namespace = &quot;http://mynamespace/test/&quot;)]</span>
</span><span id="__span-221-2"><a id="__codelineno-221-2" name="__codelineno-221-2" href="#__codelineno-221-2"></a><span class="k">public</span><span class="w"> </span><span class="k">class</span><span class="w"> </span><span class="nc">Person</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="p">...</span><span class="w"> </span><span class="p">}</span>
</span></code></pre></div>
<h3 id="xml-element-order">XML element order</h3>
<p>XmlSerializer writes elements in the order in which theyâ€™re defined in the class. You can change this by specifying an Order in the XmlElement attribute:</p>
<div class="language-csharp highlight"><pre><span></span><code><span id="__span-222-1"><a id="__codelineno-222-1" name="__codelineno-222-1" href="#__codelineno-222-1"></a><span class="k">public</span><span class="w"> </span><span class="k">class</span><span class="w"> </span><span class="nc">Person</span>
</span><span id="__span-222-2"><a id="__codelineno-222-2" name="__codelineno-222-2" href="#__codelineno-222-2"></a><span class="p">{</span>
</span><span id="__span-222-3"><a id="__codelineno-222-3" name="__codelineno-222-3" href="#__codelineno-222-3"></a><span class="w"> </span><span class="na">[XmlElement (Order = 2)]</span><span class="w"> </span><span class="k">public</span><span class="w"> </span><span class="kt">string</span><span class="w"> </span><span class="n">Name</span><span class="p">;</span>
</span><span id="__span-222-4"><a id="__codelineno-222-4" name="__codelineno-222-4" href="#__codelineno-222-4"></a><span class="w"> </span><span class="na">[XmlElement (Order = 1)]</span><span class="w"> </span><span class="k">public</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">Age</span><span class="p">;</span>
</span><span id="__span-222-5"><a id="__codelineno-222-5" name="__codelineno-222-5" href="#__codelineno-222-5"></a><span class="p">}</span>
</span></code></pre></div>
<p>If you use Order at all, you must use it throughout. The deserializer is not fussy about the order of elementsâ€”they can appear in any sequence and the type will properly deserialize.</p>
<h2 id="subclasses-and-child-objects">Subclasses and Child Objects</h2>
<h3 id="subclassing-the-root-type">Subclassing the root type</h3>
<div class="language-csharp highlight"><pre><span></span><code><span id="__span-223-1"><a id="__codelineno-223-1" name="__codelineno-223-1" href="#__codelineno-223-1"></a><span class="c1">//Suppose that your root type has two subclasses, as follows:</span>
</span><span id="__span-223-2"><a id="__codelineno-223-2" name="__codelineno-223-2" href="#__codelineno-223-2"></a><span class="k">public</span><span class="w"> </span><span class="k">class</span><span class="w"> </span><span class="nc">Person</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">public</span><span class="w"> </span><span class="kt">string</span><span class="w"> </span><span class="n">Name</span><span class="p">;</span><span class="w"> </span><span class="p">}</span>
</span><span id="__span-223-3"><a id="__codelineno-223-3" name="__codelineno-223-3" href="#__codelineno-223-3"></a><span class="k">public</span><span class="w"> </span><span class="k">class</span><span class="w"> </span><span class="nc">Student</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="n">Person</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="p">}</span>
</span><span id="__span-223-4"><a id="__codelineno-223-4" name="__codelineno-223-4" href="#__codelineno-223-4"></a><span class="k">public</span><span class="w"> </span><span class="k">class</span><span class="w"> </span><span class="nc">Teacher</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="n">Person</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="p">}</span>
</span><span id="__span-223-5"><a id="__codelineno-223-5" name="__codelineno-223-5" href="#__codelineno-223-5"></a><span class="c1">//and you want to write a reusable method to serialize the root type</span>
</span><span id="__span-223-6"><a id="__codelineno-223-6" name="__codelineno-223-6" href="#__codelineno-223-6"></a><span class="k">public</span><span class="w"> </span><span class="k">void</span><span class="w"> </span><span class="nf">SerializePerson</span><span class="w"> </span><span class="p">(</span><span class="n">Person</span><span class="w"> </span><span class="n">p</span><span class="p">,</span><span class="w"> </span><span class="kt">string</span><span class="w"> </span><span class="n">path</span><span class="p">)</span>
</span><span id="__span-223-7"><a id="__codelineno-223-7" name="__codelineno-223-7" href="#__codelineno-223-7"></a><span class="p">{</span>
</span><span id="__span-223-8"><a id="__codelineno-223-8" name="__codelineno-223-8" href="#__codelineno-223-8"></a><span class="w"> </span><span class="n">XmlSerializer</span><span class="w"> </span><span class="n">xs</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">XmlSerializer</span><span class="w"> </span><span class="p">(</span><span class="k">typeof</span><span class="w"> </span><span class="p">(</span><span class="n">Person</span><span class="p">));</span>
</span><span id="__span-223-9"><a id="__codelineno-223-9" name="__codelineno-223-9" href="#__codelineno-223-9"></a><span class="k">using</span><span class="w"> </span><span class="p">(</span><span class="n">Stream</span><span class="w"> </span><span class="n">s</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">File</span><span class="p">.</span><span class="n">Create</span><span class="w"> </span><span class="p">(</span><span class="n">path</span><span class="p">))</span>
</span><span id="__span-223-10"><a id="__codelineno-223-10" name="__codelineno-223-10" href="#__codelineno-223-10"></a><span class="w"> </span><span class="n">xs</span><span class="p">.</span><span class="n">Serialize</span><span class="w"> </span><span class="p">(</span><span class="n">s</span><span class="p">,</span><span class="w"> </span><span class="n">p</span><span class="p">);</span>
</span><span id="__span-223-11"><a id="__codelineno-223-11" name="__codelineno-223-11" href="#__codelineno-223-11"></a><span class="p">}</span>
</span></code></pre></div>
<p>To make this method work with a Student or Teacher, you must inform XmlSerializer about the subclasses. There are two ways to do this. The first is to register each subclass by applying the XmlInclude attribute:</p>
<div class="language-csharp highlight"><pre><span></span><code><span id="__span-224-1"><a id="__codelineno-224-1" name="__codelineno-224-1" href="#__codelineno-224-1"></a><span class="na">[XmlInclude (typeof (Student))]</span>
</span><span id="__span-224-2"><a id="__codelineno-224-2" name="__codelineno-224-2" href="#__codelineno-224-2"></a><span class="na">[XmlInclude (typeof (Teacher))]</span>
</span><span id="__span-224-3"><a id="__codelineno-224-3" name="__codelineno-224-3" href="#__codelineno-224-3"></a><span class="k">public</span><span class="w"> </span><span class="k">class</span><span class="w"> </span><span class="nc">Person</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">public</span><span class="w"> </span><span class="kt">string</span><span class="w"> </span><span class="n">Name</span><span class="p">;</span><span class="w"> </span><span class="p">}</span>
</span></code></pre></div>
<p>The second is to specify each of the subtypes when constructing XmlSerializer:</p>
<div class="language-csharp highlight"><pre><span></span><code><span id="__span-225-1"><a id="__codelineno-225-1" name="__codelineno-225-1" href="#__codelineno-225-1"></a><span class="n">XmlSerializer</span><span class="w"> </span><span class="n">xs</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">XmlSerializer</span><span class="w"> </span><span class="p">(</span><span class="k">typeof</span><span class="w"> </span><span class="p">(</span><span class="n">Person</span><span class="p">),</span>
</span><span id="__span-225-2"><a id="__codelineno-225-2" name="__codelineno-225-2" href="#__codelineno-225-2"></a><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">Type</span><span class="p">[]</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">typeof</span><span class="w"> </span><span class="p">(</span><span class="n">Student</span><span class="p">),</span><span class="w"> </span><span class="k">typeof</span><span class="w"> </span><span class="p">(</span><span class="n">Teacher</span><span class="p">)</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="p">);</span>
</span></code></pre></div>
<p>In either case, the serializer responds by recording the subtype in the type attribute:</p>
<div class="language-xml highlight"><pre><span></span><code><span id="__span-226-1"><a id="__codelineno-226-1" name="__codelineno-226-1" href="#__codelineno-226-1"></a><span class="nt">&lt;Person</span><span class="w"> </span><span class="na">xmlns:xsi=</span><span class="s">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span>
</span><span id="__span-226-2"><a id="__codelineno-226-2" name="__codelineno-226-2" href="#__codelineno-226-2"></a><span class="w"> </span><span class="na">xsi:type=</span><span class="s">&quot;Student&quot;</span><span class="nt">&gt;</span>
</span><span id="__span-226-3"><a id="__codelineno-226-3" name="__codelineno-226-3" href="#__codelineno-226-3"></a><span class="w"> </span><span class="nt">&lt;Name&gt;</span>Stacey<span class="nt">&lt;/Name&gt;</span>
</span><span id="__span-226-4"><a id="__codelineno-226-4" name="__codelineno-226-4" href="#__codelineno-226-4"></a><span class="nt">&lt;/Person&gt;</span>
</span></code></pre></div>
<p>This deserializer then knows from this attribute to instantiate a Student and not a Person.</p>
<p>You can control the name that appears in the XML type attribute by applying [XmlType] to the subclass:</p>
<div class="language-csharp highlight"><pre><span></span><code><span id="__span-227-1"><a id="__codelineno-227-1" name="__codelineno-227-1" href="#__codelineno-227-1"></a><span class="na">[XmlType (&quot;Candidate&quot;)]</span>
</span><span id="__span-227-2"><a id="__codelineno-227-2" name="__codelineno-227-2" href="#__codelineno-227-2"></a><span class="k">public</span><span class="w"> </span><span class="k">class</span><span class="w"> </span><span class="nc">Student</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="n">Person</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="p">}</span>
</span><span id="__span-227-3"><a id="__codelineno-227-3" name="__codelineno-227-3" href="#__codelineno-227-3"></a>
</span><span id="__span-227-4"><a id="__codelineno-227-4" name="__codelineno-227-4" href="#__codelineno-227-4"></a><span class="c1">//Result</span>
</span><span id="__span-227-5"><a id="__codelineno-227-5" name="__codelineno-227-5" href="#__codelineno-227-5"></a><span class="o">&lt;</span><span class="n">Person</span><span class="w"> </span><span class="n">xmlns</span><span class="p">:</span><span class="n">xsi</span><span class="o">=</span><span class="s">&quot;...&quot;</span>
</span><span id="__span-227-6"><a id="__codelineno-227-6" name="__codelineno-227-6" href="#__codelineno-227-6"></a><span class="w"> </span><span class="n">xsi</span><span class="p">:</span><span class="n">type</span><span class="o">=</span><span class="s">&quot;Candidate&quot;</span><span class="o">&gt;</span>
</span></code></pre></div>
<h3 id="serializing-child-objects">Serializing child objects</h3>
<p>XmlSerializer automatically recurses object references such as the HomeAddress field in Person:</p>
<div class="language-csharp highlight"><pre><span></span><code><span id="__span-228-1"><a id="__codelineno-228-1" name="__codelineno-228-1" href="#__codelineno-228-1"></a><span class="k">public</span><span class="w"> </span><span class="k">class</span><span class="w"> </span><span class="nc">Person</span>
</span><span id="__span-228-2"><a id="__codelineno-228-2" name="__codelineno-228-2" href="#__codelineno-228-2"></a><span class="p">{</span>
</span><span id="__span-228-3"><a id="__codelineno-228-3" name="__codelineno-228-3" href="#__codelineno-228-3"></a><span class="w"> </span><span class="k">public</span><span class="w"> </span><span class="kt">string</span><span class="w"> </span><span class="n">Name</span><span class="p">;</span>
</span><span id="__span-228-4"><a id="__codelineno-228-4" name="__codelineno-228-4" href="#__codelineno-228-4"></a><span class="w"> </span><span class="k">public</span><span class="w"> </span><span class="n">Address</span><span class="w"> </span><span class="n">HomeAddress</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">Address</span><span class="p">();</span>
</span><span id="__span-228-5"><a id="__codelineno-228-5" name="__codelineno-228-5" href="#__codelineno-228-5"></a><span class="p">}</span>
</span><span id="__span-228-6"><a id="__codelineno-228-6" name="__codelineno-228-6" href="#__codelineno-228-6"></a><span class="k">public</span><span class="w"> </span><span class="k">class</span><span class="w"> </span><span class="nc">Address</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">public</span><span class="w"> </span><span class="kt">string</span><span class="w"> </span><span class="n">Street</span><span class="p">,</span><span class="w"> </span><span class="n">PostCode</span><span class="p">;</span><span class="w"> </span><span class="p">}</span>
</span><span id="__span-228-7"><a id="__codelineno-228-7" name="__codelineno-228-7" href="#__codelineno-228-7"></a>
</span><span id="__span-228-8"><a id="__codelineno-228-8" name="__codelineno-228-8" href="#__codelineno-228-8"></a><span class="c1">//To demonstrate</span>
</span><span id="__span-228-9"><a id="__codelineno-228-9" name="__codelineno-228-9" href="#__codelineno-228-9"></a><span class="n">Person</span><span class="w"> </span><span class="n">p</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">Person</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">Name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;Stacey&quot;</span><span class="w"> </span><span class="p">};</span>
</span><span id="__span-228-10"><a id="__codelineno-228-10" name="__codelineno-228-10" href="#__codelineno-228-10"></a><span class="n">p</span><span class="p">.</span><span class="n">HomeAddress</span><span class="p">.</span><span class="n">Street</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;Odo St&quot;</span><span class="p">;</span>
</span><span id="__span-228-11"><a id="__codelineno-228-11" name="__codelineno-228-11" href="#__codelineno-228-11"></a><span class="n">p</span><span class="p">.</span><span class="n">HomeAddress</span><span class="p">.</span><span class="n">PostCode</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;6020&quot;</span><span class="p">;</span>
</span><span id="__span-228-12"><a id="__codelineno-228-12" name="__codelineno-228-12" href="#__codelineno-228-12"></a>
</span><span id="__span-228-13"><a id="__codelineno-228-13" name="__codelineno-228-13" href="#__codelineno-228-13"></a><span class="c1">//XML</span>
</span><span id="__span-228-14"><a id="__codelineno-228-14" name="__codelineno-228-14" href="#__codelineno-228-14"></a><span class="o">&lt;</span><span class="n">Person</span><span class="w"> </span><span class="p">...</span><span class="w"> </span><span class="o">&gt;</span>
</span><span id="__span-228-15"><a id="__codelineno-228-15" name="__codelineno-228-15" href="#__codelineno-228-15"></a><span class="w"> </span><span class="o">&lt;</span><span class="n">Name</span><span class="o">&gt;</span><span class="n">Stacey</span><span class="o">&lt;/</span><span class="n">Name</span><span class="o">&gt;</span>
</span><span id="__span-228-16"><a id="__codelineno-228-16" name="__codelineno-228-16" href="#__codelineno-228-16"></a><span class="w"> </span><span class="o">&lt;</span><span class="n">HomeAddress</span><span class="o">&gt;</span>
</span><span id="__span-228-17"><a id="__codelineno-228-17" name="__codelineno-228-17" href="#__codelineno-228-17"></a><span class="w"> </span><span class="o">&lt;</span><span class="n">Street</span><span class="o">&gt;</span><span class="n">Odo</span><span class="w"> </span><span class="n">St</span><span class="o">&lt;/</span><span class="n">Street</span><span class="o">&gt;</span>
</span><span id="__span-228-18"><a id="__codelineno-228-18" name="__codelineno-228-18" href="#__codelineno-228-18"></a><span class="w"> </span><span class="o">&lt;</span><span class="n">PostCode</span><span class="o">&gt;</span><span class="mi">6020</span><span class="o">&lt;/</span><span class="n">PostCode</span><span class="o">&gt;</span>
</span><span id="__span-228-19"><a id="__codelineno-228-19" name="__codelineno-228-19" href="#__codelineno-228-19"></a><span class="w"> </span><span class="o">&lt;/</span><span class="n">HomeAddress</span><span class="o">&gt;</span>
</span><span id="__span-228-20"><a id="__codelineno-228-20" name="__codelineno-228-20" href="#__codelineno-228-20"></a><span class="o">&lt;/</span><span class="n">Person</span><span class="o">&gt;</span>
</span></code></pre></div>
<h3 id="subclassing-child-objects">Subclassing child objects</h3>
<div class="language-csharp highlight"><pre><span></span><code><span id="__span-229-1"><a id="__codelineno-229-1" name="__codelineno-229-1" href="#__codelineno-229-1"></a><span class="k">public</span><span class="w"> </span><span class="k">class</span><span class="w"> </span><span class="nc">Address</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">public</span><span class="w"> </span><span class="kt">string</span><span class="w"> </span><span class="n">Street</span><span class="p">,</span><span class="w"> </span><span class="n">PostCode</span><span class="p">;</span><span class="w"> </span><span class="p">}</span>
</span><span id="__span-229-2"><a id="__codelineno-229-2" name="__codelineno-229-2" href="#__codelineno-229-2"></a><span class="k">public</span><span class="w"> </span><span class="k">class</span><span class="w"> </span><span class="nc">USAddress</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="n">Address</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="p">}</span>
</span><span id="__span-229-3"><a id="__codelineno-229-3" name="__codelineno-229-3" href="#__codelineno-229-3"></a><span class="k">public</span><span class="w"> </span><span class="k">class</span><span class="w"> </span><span class="nc">AUAddress</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="n">Address</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="p">}</span>
</span><span id="__span-229-4"><a id="__codelineno-229-4" name="__codelineno-229-4" href="#__codelineno-229-4"></a><span class="k">public</span><span class="w"> </span><span class="k">class</span><span class="w"> </span><span class="nc">Person</span>
</span><span id="__span-229-5"><a id="__codelineno-229-5" name="__codelineno-229-5" href="#__codelineno-229-5"></a><span class="p">{</span>
</span><span id="__span-229-6"><a id="__codelineno-229-6" name="__codelineno-229-6" href="#__codelineno-229-6"></a><span class="w"> </span><span class="k">public</span><span class="w"> </span><span class="kt">string</span><span class="w"> </span><span class="n">Name</span><span class="p">;</span>
</span><span id="__span-229-7"><a id="__codelineno-229-7" name="__codelineno-229-7" href="#__codelineno-229-7"></a><span class="w"> </span><span class="k">public</span><span class="w"> </span><span class="n">Address</span><span class="w"> </span><span class="n">HomeAddress</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">USAddress</span><span class="p">();</span>
</span><span id="__span-229-8"><a id="__codelineno-229-8" name="__codelineno-229-8" href="#__codelineno-229-8"></a><span class="p">}</span>
</span></code></pre></div>
<p>There are two distinct ways to proceed, depending on how you want the XML structured. If you want the element name always to match the field or property name with the subtype recorded in a type attribute:</p>
<div class="language-csharp highlight"><pre><span></span><code><span id="__span-230-1"><a id="__codelineno-230-1" name="__codelineno-230-1" href="#__codelineno-230-1"></a><span class="o">&lt;</span><span class="n">Person</span><span class="w"> </span><span class="p">...</span><span class="o">&gt;</span>
</span><span id="__span-230-2"><a id="__codelineno-230-2" name="__codelineno-230-2" href="#__codelineno-230-2"></a><span class="w"> </span><span class="p">...</span>
</span><span id="__span-230-3"><a id="__codelineno-230-3" name="__codelineno-230-3" href="#__codelineno-230-3"></a><span class="w"> </span><span class="o">&lt;</span><span class="n">HomeAddress</span><span class="w"> </span><span class="n">xsi</span><span class="p">:</span><span class="n">type</span><span class="o">=</span><span class="s">&quot;USAddress&quot;</span><span class="o">&gt;</span>
</span><span id="__span-230-4"><a id="__codelineno-230-4" name="__codelineno-230-4" href="#__codelineno-230-4"></a><span class="w"> </span><span class="p">...</span>
</span><span id="__span-230-5"><a id="__codelineno-230-5" name="__codelineno-230-5" href="#__codelineno-230-5"></a><span class="w"> </span><span class="o">&lt;/</span><span class="n">HomeAddress</span><span class="o">&gt;</span>
</span><span id="__span-230-6"><a id="__codelineno-230-6" name="__codelineno-230-6" href="#__codelineno-230-6"></a><span class="o">&lt;/</span><span class="n">Person</span><span class="o">&gt;</span>
</span></code></pre></div>
<p>you use [XmlInclude] to register each of the subclasses with Address, as follows:</p>
<div class="language-csharp highlight"><pre><span></span><code><span id="__span-231-1"><a id="__codelineno-231-1" name="__codelineno-231-1" href="#__codelineno-231-1"></a><span class="na">[XmlInclude (typeof (AUAddress))]</span>
</span><span id="__span-231-2"><a id="__codelineno-231-2" name="__codelineno-231-2" href="#__codelineno-231-2"></a><span class="na">[XmlInclude (typeof (USAddress))]</span>
</span><span id="__span-231-3"><a id="__codelineno-231-3" name="__codelineno-231-3" href="#__codelineno-231-3"></a><span class="k">public</span><span class="w"> </span><span class="k">class</span><span class="w"> </span><span class="nc">Address</span>
</span><span id="__span-231-4"><a id="__codelineno-231-4" name="__codelineno-231-4" href="#__codelineno-231-4"></a><span class="p">{</span>
</span><span id="__span-231-5"><a id="__codelineno-231-5" name="__codelineno-231-5" href="#__codelineno-231-5"></a><span class="w"> </span><span class="k">public</span><span class="w"> </span><span class="kt">string</span><span class="w"> </span><span class="n">Street</span><span class="p">,</span><span class="w"> </span><span class="n">PostCode</span><span class="p">;</span>
</span><span id="__span-231-6"><a id="__codelineno-231-6" name="__codelineno-231-6" href="#__codelineno-231-6"></a><span class="p">}</span>
</span></code></pre></div>
<p>If, on the other hand, you want the element name to reflect the name of the subtype, to the following effect:</p>
<div class="language-csharp highlight"><pre><span></span><code><span id="__span-232-1"><a id="__codelineno-232-1" name="__codelineno-232-1" href="#__codelineno-232-1"></a><span class="o">&lt;</span><span class="n">Person</span><span class="w"> </span><span class="p">...</span><span class="o">&gt;</span>
</span><span id="__span-232-2"><a id="__codelineno-232-2" name="__codelineno-232-2" href="#__codelineno-232-2"></a><span class="w"> </span><span class="p">...</span>
</span><span id="__span-232-3"><a id="__codelineno-232-3" name="__codelineno-232-3" href="#__codelineno-232-3"></a><span class="w"> </span><span class="o">&lt;</span><span class="n">USAddress</span><span class="o">&gt;</span>
</span><span id="__span-232-4"><a id="__codelineno-232-4" name="__codelineno-232-4" href="#__codelineno-232-4"></a><span class="w"> </span><span class="p">...</span>
</span><span id="__span-232-5"><a id="__codelineno-232-5" name="__codelineno-232-5" href="#__codelineno-232-5"></a><span class="w"> </span><span class="o">&lt;/</span><span class="n">USAddress</span><span class="o">&gt;</span>
</span><span id="__span-232-6"><a id="__codelineno-232-6" name="__codelineno-232-6" href="#__codelineno-232-6"></a><span class="o">&lt;/</span><span class="n">Person</span><span class="o">&gt;</span>
</span></code></pre></div>
<p>you instead stack multiple [XmlElement] attributes onto the field or property in the parent type:</p>
<div class="language-csharp highlight"><pre><span></span><code><span id="__span-233-1"><a id="__codelineno-233-1" name="__codelineno-233-1" href="#__codelineno-233-1"></a><span class="k">public</span><span class="w"> </span><span class="k">class</span><span class="w"> </span><span class="nc">Person</span>
</span><span id="__span-233-2"><a id="__codelineno-233-2" name="__codelineno-233-2" href="#__codelineno-233-2"></a><span class="p">{</span>
</span><span id="__span-233-3"><a id="__codelineno-233-3" name="__codelineno-233-3" href="#__codelineno-233-3"></a><span class="w"> </span><span class="k">public</span><span class="w"> </span><span class="kt">string</span><span class="w"> </span><span class="n">Name</span><span class="p">;</span>
</span><span id="__span-233-4"><a id="__codelineno-233-4" name="__codelineno-233-4" href="#__codelineno-233-4"></a><span class="w"> </span><span class="na">[XmlElement (&quot;Address&quot;, typeof (Address))]</span>
</span><span id="__span-233-5"><a id="__codelineno-233-5" name="__codelineno-233-5" href="#__codelineno-233-5"></a><span class="w"> </span><span class="na">[XmlElement (&quot;AUAddress&quot;, typeof (AUAddress))]</span>
</span><span id="__span-233-6"><a id="__codelineno-233-6" name="__codelineno-233-6" href="#__codelineno-233-6"></a><span class="w"> </span><span class="na">[XmlElement (&quot;USAddress&quot;, typeof (USAddress))]</span>
</span><span id="__span-233-7"><a id="__codelineno-233-7" name="__codelineno-233-7" href="#__codelineno-233-7"></a><span class="w"> </span><span class="k">public</span><span class="w"> </span><span class="n">Address</span><span class="w"> </span><span class="n">HomeAddress</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">USAddress</span><span class="p">();</span>
</span><span id="__span-233-8"><a id="__codelineno-233-8" name="__codelineno-233-8" href="#__codelineno-233-8"></a><span class="p">}</span>
</span></code></pre></div>
<h2 id="serializing-collections">Serializing Collections</h2>
<p>XmlSerializer recognizes and serializes concrete collection types without intervention:</p>
<div class="language-csharp highlight"><pre><span></span><code><span id="__span-234-1"><a id="__codelineno-234-1" name="__codelineno-234-1" href="#__codelineno-234-1"></a><span class="k">public</span><span class="w"> </span><span class="k">class</span><span class="w"> </span><span class="nc">Person</span>
</span><span id="__span-234-2"><a id="__codelineno-234-2" name="__codelineno-234-2" href="#__codelineno-234-2"></a><span class="p">{</span>
</span><span id="__span-234-3"><a id="__codelineno-234-3" name="__codelineno-234-3" href="#__codelineno-234-3"></a><span class="w"> </span><span class="k">public</span><span class="w"> </span><span class="kt">string</span><span class="w"> </span><span class="n">Name</span><span class="p">;</span>
</span><span id="__span-234-4"><a id="__codelineno-234-4" name="__codelineno-234-4" href="#__codelineno-234-4"></a><span class="w"> </span><span class="k">public</span><span class="w"> </span><span class="n">List</span><span class="o">&lt;</span><span class="n">Address</span><span class="o">&gt;</span><span class="w"> </span><span class="n">Addresses</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">List</span><span class="o">&lt;</span><span class="n">Address</span><span class="o">&gt;</span><span class="p">();</span>
</span><span id="__span-234-5"><a id="__codelineno-234-5" name="__codelineno-234-5" href="#__codelineno-234-5"></a><span class="p">}</span>
</span><span id="__span-234-6"><a id="__codelineno-234-6" name="__codelineno-234-6" href="#__codelineno-234-6"></a><span class="k">public</span><span class="w"> </span><span class="k">class</span><span class="w"> </span><span class="nc">Address</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">public</span><span class="w"> </span><span class="kt">string</span><span class="w"> </span><span class="n">Street</span><span class="p">,</span><span class="w"> </span><span class="n">PostCode</span><span class="p">;</span><span class="w"> </span><span class="p">}</span>
</span><span id="__span-234-7"><a id="__codelineno-234-7" name="__codelineno-234-7" href="#__codelineno-234-7"></a><span class="c1">//Hereâ€™s the XML to which this serializes:</span>
</span><span id="__span-234-8"><a id="__codelineno-234-8" name="__codelineno-234-8" href="#__codelineno-234-8"></a><span class="o">&lt;</span><span class="n">Person</span><span class="w"> </span><span class="p">...</span><span class="w"> </span><span class="o">&gt;</span>
</span><span id="__span-234-9"><a id="__codelineno-234-9" name="__codelineno-234-9" href="#__codelineno-234-9"></a><span class="w"> </span><span class="o">&lt;</span><span class="n">Name</span><span class="o">&gt;</span><span class="p">...</span><span class="o">&lt;/</span><span class="n">Name</span><span class="o">&gt;</span>
</span><span id="__span-234-10"><a id="__codelineno-234-10" name="__codelineno-234-10" href="#__codelineno-234-10"></a><span class="w"> </span><span class="o">&lt;</span><span class="n">Addresses</span><span class="o">&gt;</span>
</span><span id="__span-234-11"><a id="__codelineno-234-11" name="__codelineno-234-11" href="#__codelineno-234-11"></a><span class="w"> </span><span class="o">&lt;</span><span class="n">Address</span><span class="o">&gt;</span>
</span><span id="__span-234-12"><a id="__codelineno-234-12" name="__codelineno-234-12" href="#__codelineno-234-12"></a><span class="w"> </span><span class="o">&lt;</span><span class="n">Street</span><span class="o">&gt;</span><span class="p">...</span><span class="o">&lt;/</span><span class="n">Street</span><span class="o">&gt;</span>
</span><span id="__span-234-13"><a id="__codelineno-234-13" name="__codelineno-234-13" href="#__codelineno-234-13"></a><span class="w"> </span><span class="o">&lt;</span><span class="n">Postcode</span><span class="o">&gt;</span><span class="p">...</span><span class="o">&lt;/</span><span class="n">Postcode</span><span class="o">&gt;</span>
</span><span id="__span-234-14"><a id="__codelineno-234-14" name="__codelineno-234-14" href="#__codelineno-234-14"></a><span class="w"> </span><span class="o">&lt;/</span><span class="n">Address</span><span class="o">&gt;</span>
</span><span id="__span-234-15"><a id="__codelineno-234-15" name="__codelineno-234-15" href="#__codelineno-234-15"></a><span class="w"> </span><span class="o">&lt;</span><span class="n">Address</span><span class="o">&gt;</span>
</span><span id="__span-234-16"><a id="__codelineno-234-16" name="__codelineno-234-16" href="#__codelineno-234-16"></a><span class="w"> </span><span class="o">&lt;</span><span class="n">Street</span><span class="o">&gt;</span><span class="p">...</span><span class="o">&lt;/</span><span class="n">Street</span><span class="o">&gt;</span>
</span><span id="__span-234-17"><a id="__codelineno-234-17" name="__codelineno-234-17" href="#__codelineno-234-17"></a><span class="w"> </span><span class="o">&lt;</span><span class="n">Postcode</span><span class="o">&gt;</span><span class="p">...</span><span class="o">&lt;/</span><span class="n">Postcode</span><span class="o">&gt;</span>
</span><span id="__span-234-18"><a id="__codelineno-234-18" name="__codelineno-234-18" href="#__codelineno-234-18"></a><span class="w"> </span><span class="o">&lt;/</span><span class="n">Address</span><span class="o">&gt;</span>
</span><span id="__span-234-19"><a id="__codelineno-234-19" name="__codelineno-234-19" href="#__codelineno-234-19"></a><span class="w"> </span><span class="p">...</span>
</span><span id="__span-234-20"><a id="__codelineno-234-20" name="__codelineno-234-20" href="#__codelineno-234-20"></a><span class="w"> </span><span class="o">&lt;/</span><span class="n">Addresses</span><span class="o">&gt;</span>
</span><span id="__span-234-21"><a id="__codelineno-234-21" name="__codelineno-234-21" href="#__codelineno-234-21"></a><span class="o">&lt;/</span><span class="n">Person</span><span class="o">&gt;</span>
</span></code></pre></div>
<ul>
<li>The [XmlArray] attribute lets you rename the outer element (i.e., Addresses).</li>
<li>The [XmlArrayItem] attribute lets you rename the inner elements (i.e., the Address elements).</li>
</ul>
<div class="language-csharp highlight"><pre><span></span><code><span id="__span-235-1"><a id="__codelineno-235-1" name="__codelineno-235-1" href="#__codelineno-235-1"></a><span class="k">public</span><span class="w"> </span><span class="k">class</span><span class="w"> </span><span class="nc">Person</span>
</span><span id="__span-235-2"><a id="__codelineno-235-2" name="__codelineno-235-2" href="#__codelineno-235-2"></a><span class="p">{</span>
</span><span id="__span-235-3"><a id="__codelineno-235-3" name="__codelineno-235-3" href="#__codelineno-235-3"></a><span class="w"> </span><span class="k">public</span><span class="w"> </span><span class="kt">string</span><span class="w"> </span><span class="n">Name</span><span class="p">;</span>
</span><span id="__span-235-4"><a id="__codelineno-235-4" name="__codelineno-235-4" href="#__codelineno-235-4"></a><span class="w"> </span><span class="na">[XmlArray (&quot;PreviousAddresses&quot;)]</span>
</span><span id="__span-235-5"><a id="__codelineno-235-5" name="__codelineno-235-5" href="#__codelineno-235-5"></a><span class="w"> </span><span class="na">[XmlArrayItem (&quot;Location&quot;)]</span>
</span><span id="__span-235-6"><a id="__codelineno-235-6" name="__codelineno-235-6" href="#__codelineno-235-6"></a><span class="w"> </span><span class="k">public</span><span class="w"> </span><span class="n">List</span><span class="o">&lt;</span><span class="n">Address</span><span class="o">&gt;</span><span class="w"> </span><span class="n">Addresses</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">List</span><span class="o">&lt;</span><span class="n">Address</span><span class="o">&gt;</span><span class="p">();</span>
</span><span id="__span-235-7"><a id="__codelineno-235-7" name="__codelineno-235-7" href="#__codelineno-235-7"></a><span class="p">}</span>
</span><span id="__span-235-8"><a id="__codelineno-235-8" name="__codelineno-235-8" href="#__codelineno-235-8"></a><span class="c1">//serializes to this:</span>
</span><span id="__span-235-9"><a id="__codelineno-235-9" name="__codelineno-235-9" href="#__codelineno-235-9"></a><span class="o">&lt;</span><span class="n">Person</span><span class="w"> </span><span class="p">...</span><span class="w"> </span><span class="o">&gt;</span>
</span><span id="__span-235-10"><a id="__codelineno-235-10" name="__codelineno-235-10" href="#__codelineno-235-10"></a><span class="w"> </span><span class="o">&lt;</span><span class="n">Name</span><span class="o">&gt;</span><span class="p">...</span><span class="o">&lt;/</span><span class="n">Name</span><span class="o">&gt;</span>
</span><span id="__span-235-11"><a id="__codelineno-235-11" name="__codelineno-235-11" href="#__codelineno-235-11"></a><span class="w"> </span><span class="o">&lt;</span><span class="n">PreviousAddresses</span><span class="o">&gt;</span>
</span><span id="__span-235-12"><a id="__codelineno-235-12" name="__codelineno-235-12" href="#__codelineno-235-12"></a><span class="w"> </span><span class="o">&lt;</span><span class="n">Location</span><span class="o">&gt;</span>
</span><span id="__span-235-13"><a id="__codelineno-235-13" name="__codelineno-235-13" href="#__codelineno-235-13"></a><span class="w"> </span><span class="o">&lt;</span><span class="n">Street</span><span class="o">&gt;</span><span class="p">...</span><span class="o">&lt;/</span><span class="n">Street</span><span class="o">&gt;</span>
</span><span id="__span-235-14"><a id="__codelineno-235-14" name="__codelineno-235-14" href="#__codelineno-235-14"></a><span class="w"> </span><span class="o">&lt;</span><span class="n">Postcode</span><span class="o">&gt;</span><span class="p">...</span><span class="o">&lt;/</span><span class="n">Postcode</span><span class="o">&gt;</span>
</span><span id="__span-235-15"><a id="__codelineno-235-15" name="__codelineno-235-15" href="#__codelineno-235-15"></a><span class="w"> </span><span class="o">&lt;/</span><span class="n">Location</span><span class="o">&gt;</span>
</span><span id="__span-235-16"><a id="__codelineno-235-16" name="__codelineno-235-16" href="#__codelineno-235-16"></a><span class="w"> </span><span class="o">&lt;</span><span class="n">Location</span><span class="o">&gt;</span>
</span><span id="__span-235-17"><a id="__codelineno-235-17" name="__codelineno-235-17" href="#__codelineno-235-17"></a><span class="w"> </span><span class="o">&lt;</span><span class="n">Street</span><span class="o">&gt;</span><span class="p">...</span><span class="o">&lt;/</span><span class="n">Street</span><span class="o">&gt;</span>
</span><span id="__span-235-18"><a id="__codelineno-235-18" name="__codelineno-235-18" href="#__codelineno-235-18"></a><span class="w"> </span><span class="o">&lt;</span><span class="n">Postcode</span><span class="o">&gt;</span><span class="p">...</span><span class="o">&lt;/</span><span class="n">Postcode</span><span class="o">&gt;</span>
</span><span id="__span-235-19"><a id="__codelineno-235-19" name="__codelineno-235-19" href="#__codelineno-235-19"></a><span class="w"> </span><span class="o">&lt;/</span><span class="n">Location</span><span class="o">&gt;</span>
</span><span id="__span-235-20"><a id="__codelineno-235-20" name="__codelineno-235-20" href="#__codelineno-235-20"></a><span class="w"> </span><span class="p">...</span>
</span><span id="__span-235-21"><a id="__codelineno-235-21" name="__codelineno-235-21" href="#__codelineno-235-21"></a><span class="w"> </span><span class="o">&lt;/</span><span class="n">PreviousAddresses</span><span class="o">&gt;</span>
</span><span id="__span-235-22"><a id="__codelineno-235-22" name="__codelineno-235-22" href="#__codelineno-235-22"></a><span class="o">&lt;/</span><span class="n">Person</span><span class="o">&gt;</span>
</span></code></pre></div>
<ul>
<li>The XmlArray and XmlArrayItem attributes also allow you to specify XML namespaces.</li>
</ul>
<h3 id="working-with-subclassed-collection-elements">Working with subclassed collection elements</h3>
<p>The rules for subclassing collection elements follow naturally from the other subâ€ classing rules. To encode subclassed elements with the type attribute, for example:</p>
<div class="language-csharp highlight"><pre><span></span><code><span id="__span-236-1"><a id="__codelineno-236-1" name="__codelineno-236-1" href="#__codelineno-236-1"></a><span class="o">&lt;</span><span class="n">Person</span><span class="w"> </span><span class="p">...</span><span class="w"> </span><span class="o">&gt;</span>
</span><span id="__span-236-2"><a id="__codelineno-236-2" name="__codelineno-236-2" href="#__codelineno-236-2"></a><span class="w"> </span><span class="o">&lt;</span><span class="n">Name</span><span class="o">&gt;</span><span class="p">...</span><span class="o">&lt;/</span><span class="n">Name</span><span class="o">&gt;</span>
</span><span id="__span-236-3"><a id="__codelineno-236-3" name="__codelineno-236-3" href="#__codelineno-236-3"></a><span class="w"> </span><span class="o">&lt;</span><span class="n">Addresses</span><span class="o">&gt;</span>
</span><span id="__span-236-4"><a id="__codelineno-236-4" name="__codelineno-236-4" href="#__codelineno-236-4"></a><span class="w"> </span><span class="o">&lt;</span><span class="n">Address</span><span class="w"> </span><span class="n">xsi</span><span class="p">:</span><span class="n">type</span><span class="o">=</span><span class="s">&quot;AUAddress&quot;</span><span class="o">&gt;</span>
</span><span id="__span-236-5"><a id="__codelineno-236-5" name="__codelineno-236-5" href="#__codelineno-236-5"></a><span class="w"> </span><span class="p">...</span>
</span></code></pre></div>
<p>add [XmlInclude] attributes to the base (Address) type, as we did earlier. This works whether or not you suppress serialization of the outer element.</p>
<p>If you want subclassed elements to be named according to their type, for example:3</p>
<div class="language-xml highlight"><pre><span></span><code><span id="__span-237-1"><a id="__codelineno-237-1" name="__codelineno-237-1" href="#__codelineno-237-1"></a><span class="nt">&lt;Person</span><span class="w"> </span><span class="err">...</span><span class="w"> </span><span class="nt">&gt;</span>
</span><span id="__span-237-2"><a id="__codelineno-237-2" name="__codelineno-237-2" href="#__codelineno-237-2"></a><span class="w"> </span><span class="nt">&lt;Name&gt;</span>...<span class="nt">&lt;/Name&gt;</span>
</span><span id="__span-237-3"><a id="__codelineno-237-3" name="__codelineno-237-3" href="#__codelineno-237-3"></a><span class="w"> </span><span class="cp">&lt;!â€”start of optional outer elementâ€”&gt;</span>
</span><span id="__span-237-4"><a id="__codelineno-237-4" name="__codelineno-237-4" href="#__codelineno-237-4"></a><span class="w"> </span><span class="nt">&lt;AUAddress&gt;</span>
</span><span id="__span-237-5"><a id="__codelineno-237-5" name="__codelineno-237-5" href="#__codelineno-237-5"></a><span class="w"> </span><span class="nt">&lt;Street&gt;</span>...<span class="nt">&lt;/Street&gt;</span>
</span><span id="__span-237-6"><a id="__codelineno-237-6" name="__codelineno-237-6" href="#__codelineno-237-6"></a><span class="w"> </span><span class="nt">&lt;Postcode&gt;</span>...<span class="nt">&lt;/Postcode&gt;</span>
</span><span id="__span-237-7"><a id="__codelineno-237-7" name="__codelineno-237-7" href="#__codelineno-237-7"></a><span class="w"> </span><span class="nt">&lt;/AUAddress&gt;</span>
</span><span id="__span-237-8"><a id="__codelineno-237-8" name="__codelineno-237-8" href="#__codelineno-237-8"></a><span class="w"> </span><span class="nt">&lt;USAddress&gt;</span>
</span><span id="__span-237-9"><a id="__codelineno-237-9" name="__codelineno-237-9" href="#__codelineno-237-9"></a><span class="w"> </span><span class="nt">&lt;Street&gt;</span>...<span class="nt">&lt;/Street&gt;</span>
</span><span id="__span-237-10"><a id="__codelineno-237-10" name="__codelineno-237-10" href="#__codelineno-237-10"></a><span class="w"> </span><span class="nt">&lt;Postcode&gt;</span>...<span class="nt">&lt;/Postcode&gt;</span>
</span><span id="__span-237-11"><a id="__codelineno-237-11" name="__codelineno-237-11" href="#__codelineno-237-11"></a><span class="w"> </span><span class="nt">&lt;/USAddress&gt;</span>
</span><span id="__span-237-12"><a id="__codelineno-237-12" name="__codelineno-237-12" href="#__codelineno-237-12"></a><span class="w"> </span><span class="cp">&lt;!â€”end of optional outer elementâ€”&gt;</span>
</span><span id="__span-237-13"><a id="__codelineno-237-13" name="__codelineno-237-13" href="#__codelineno-237-13"></a><span class="nt">&lt;/Person&gt;</span>
</span></code></pre></div>
<div class="language-csharp highlight"><pre><span></span><code><span id="__span-238-1"><a id="__codelineno-238-1" name="__codelineno-238-1" href="#__codelineno-238-1"></a><span class="c1">//Stack multiple [XmlArrayItem] attributes if you want to include the outer collection</span>
</span><span id="__span-238-2"><a id="__codelineno-238-2" name="__codelineno-238-2" href="#__codelineno-238-2"></a><span class="c1">//element:</span>
</span><span id="__span-238-3"><a id="__codelineno-238-3" name="__codelineno-238-3" href="#__codelineno-238-3"></a><span class="na">[XmlArrayItem (&quot;Address&quot;, typeof (Address))]</span>
</span><span id="__span-238-4"><a id="__codelineno-238-4" name="__codelineno-238-4" href="#__codelineno-238-4"></a><span class="na">[XmlArrayItem (&quot;AUAddress&quot;, typeof (AUAddress))]</span>
</span><span id="__span-238-5"><a id="__codelineno-238-5" name="__codelineno-238-5" href="#__codelineno-238-5"></a><span class="na">[XmlArrayItem (&quot;USAddress&quot;, typeof (USAddress))]</span>
</span><span id="__span-238-6"><a id="__codelineno-238-6" name="__codelineno-238-6" href="#__codelineno-238-6"></a><span class="k">public</span><span class="w"> </span><span class="n">List</span><span class="o">&lt;</span><span class="n">Address</span><span class="o">&gt;</span><span class="w"> </span><span class="n">Addresses</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">List</span><span class="o">&lt;</span><span class="n">Address</span><span class="o">&gt;</span><span class="p">();</span>
</span><span id="__span-238-7"><a id="__codelineno-238-7" name="__codelineno-238-7" href="#__codelineno-238-7"></a>
</span><span id="__span-238-8"><a id="__codelineno-238-8" name="__codelineno-238-8" href="#__codelineno-238-8"></a><span class="c1">//Stack multiple [XmlElement] attributes if you want to exclude the outer collection</span>
</span><span id="__span-238-9"><a id="__codelineno-238-9" name="__codelineno-238-9" href="#__codelineno-238-9"></a><span class="c1">//element:</span>
</span><span id="__span-238-10"><a id="__codelineno-238-10" name="__codelineno-238-10" href="#__codelineno-238-10"></a><span class="na">[XmlElement (&quot;Address&quot;, typeof (Address))]</span>
</span><span id="__span-238-11"><a id="__codelineno-238-11" name="__codelineno-238-11" href="#__codelineno-238-11"></a><span class="na">[XmlElement (&quot;AUAddress&quot;, typeof (AUAddress))]</span>
</span><span id="__span-238-12"><a id="__codelineno-238-12" name="__codelineno-238-12" href="#__codelineno-238-12"></a><span class="na">[XmlElement (&quot;USAddress&quot;, typeof (USAddress))]</span>
</span><span id="__span-238-13"><a id="__codelineno-238-13" name="__codelineno-238-13" href="#__codelineno-238-13"></a><span class="k">public</span><span class="w"> </span><span class="n">List</span><span class="o">&lt;</span><span class="n">Address</span><span class="o">&gt;</span><span class="w"> </span><span class="n">Addresses</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">List</span><span class="o">&lt;</span><span class="n">Address</span><span class="o">&gt;</span><span class="p">();</span>
</span></code></pre></div>
<h3 id="ixmlserializable">IXmlSerializable</h3>
<p>Although attribute-based XML serialization is flexible, it has limitations. For instance, you cannot add serialization hooksâ€”nor can you serialize nonpublic members. Itâ€™s also awkward to use if the XML might present the same element or attribute in a number of different ways.</p>
<p>On that last issue, you can push the boundaries somewhat by passing an XmlAttributeOverrides object into XmlSerializerâ€™s constructor. There comes a point, however, when itâ€™s easier to take an imperative approach. This is the job of IXmlSerializable:</p>
<div class="language-csharp highlight"><pre><span></span><code><span id="__span-239-1"><a id="__codelineno-239-1" name="__codelineno-239-1" href="#__codelineno-239-1"></a><span class="k">public</span><span class="w"> </span><span class="k">interface</span><span class="w"> </span><span class="n">IXmlSerializable</span>
</span><span id="__span-239-2"><a id="__codelineno-239-2" name="__codelineno-239-2" href="#__codelineno-239-2"></a><span class="p">{</span>
</span><span id="__span-239-3"><a id="__codelineno-239-3" name="__codelineno-239-3" href="#__codelineno-239-3"></a><span class="w"> </span><span class="n">XmlSchema</span><span class="w"> </span><span class="nf">GetSchema</span><span class="p">();</span>
</span><span id="__span-239-4"><a id="__codelineno-239-4" name="__codelineno-239-4" href="#__codelineno-239-4"></a><span class="w"> </span><span class="k">void</span><span class="w"> </span><span class="nf">ReadXml</span><span class="w"> </span><span class="p">(</span><span class="n">XmlReader</span><span class="w"> </span><span class="n">reader</span><span class="p">);</span>
</span><span id="__span-239-5"><a id="__codelineno-239-5" name="__codelineno-239-5" href="#__codelineno-239-5"></a><span class="w"> </span><span class="k">void</span><span class="w"> </span><span class="nf">WriteXml</span><span class="w"> </span><span class="p">(</span><span class="n">XmlWriter</span><span class="w"> </span><span class="n">writer</span><span class="p">);</span>
</span><span id="__span-239-6"><a id="__codelineno-239-6" name="__codelineno-239-6" href="#__codelineno-239-6"></a><span class="p">}</span>
</span></code></pre></div>
<div class="language-csharp highlight"><pre><span></span><code><span id="__span-240-1"><a id="__codelineno-240-1" name="__codelineno-240-1" href="#__codelineno-240-1"></a><span class="c1">//Hereâ€™s an example:</span>
</span><span id="__span-240-2"><a id="__codelineno-240-2" name="__codelineno-240-2" href="#__codelineno-240-2"></a><span class="k">using</span><span class="w"> </span><span class="nn">System</span><span class="p">;</span>
</span><span id="__span-240-3"><a id="__codelineno-240-3" name="__codelineno-240-3" href="#__codelineno-240-3"></a><span class="k">using</span><span class="w"> </span><span class="nn">System.Xml</span><span class="p">;</span>
</span><span id="__span-240-4"><a id="__codelineno-240-4" name="__codelineno-240-4" href="#__codelineno-240-4"></a><span class="k">using</span><span class="w"> </span><span class="nn">System.Xml.Schema</span><span class="p">;</span>
</span><span id="__span-240-5"><a id="__codelineno-240-5" name="__codelineno-240-5" href="#__codelineno-240-5"></a><span class="k">using</span><span class="w"> </span><span class="nn">System.Xml.Serialization</span><span class="p">;</span>
</span><span id="__span-240-6"><a id="__codelineno-240-6" name="__codelineno-240-6" href="#__codelineno-240-6"></a><span class="k">public</span><span class="w"> </span><span class="k">class</span><span class="w"> </span><span class="nc">Address</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="n">IXmlSerializable</span>
</span><span id="__span-240-7"><a id="__codelineno-240-7" name="__codelineno-240-7" href="#__codelineno-240-7"></a><span class="p">{</span>
</span><span id="__span-240-8"><a id="__codelineno-240-8" name="__codelineno-240-8" href="#__codelineno-240-8"></a><span class="w"> </span><span class="k">public</span><span class="w"> </span><span class="kt">string</span><span class="w"> </span><span class="n">Street</span><span class="p">,</span><span class="w"> </span><span class="n">PostCode</span><span class="p">;</span>
</span><span id="__span-240-9"><a id="__codelineno-240-9" name="__codelineno-240-9" href="#__codelineno-240-9"></a><span class="w"> </span><span class="k">public</span><span class="w"> </span><span class="n">XmlSchema</span><span class="w"> </span><span class="nf">GetSchema</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="k">null</span><span class="p">;</span><span class="w"> </span><span class="p">}</span>
</span><span id="__span-240-10"><a id="__codelineno-240-10" name="__codelineno-240-10" href="#__codelineno-240-10"></a><span class="w"> </span><span class="k">public</span><span class="w"> </span><span class="k">void</span><span class="w"> </span><span class="nf">ReadXml</span><span class="p">(</span><span class="n">XmlReader</span><span class="w"> </span><span class="n">reader</span><span class="p">)</span>
</span><span id="__span-240-11"><a id="__codelineno-240-11" name="__codelineno-240-11" href="#__codelineno-240-11"></a><span class="w"> </span><span class="p">{</span>
</span><span id="__span-240-12"><a id="__codelineno-240-12" name="__codelineno-240-12" href="#__codelineno-240-12"></a><span class="w"> </span><span class="n">reader</span><span class="p">.</span><span class="n">ReadStartElement</span><span class="p">();</span>
</span><span id="__span-240-13"><a id="__codelineno-240-13" name="__codelineno-240-13" href="#__codelineno-240-13"></a><span class="w"> </span><span class="n">Street</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">reader</span><span class="p">.</span><span class="n">ReadElementContentAsString</span><span class="w"> </span><span class="p">(</span><span class="s">&quot;Street&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;&quot;</span><span class="p">);</span>
</span><span id="__span-240-14"><a id="__codelineno-240-14" name="__codelineno-240-14" href="#__codelineno-240-14"></a><span class="w"> </span><span class="n">PostCode</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">reader</span><span class="p">.</span><span class="n">ReadElementContentAsString</span><span class="w"> </span><span class="p">(</span><span class="s">&quot;PostCode&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;&quot;</span><span class="p">);</span>
</span><span id="__span-240-15"><a id="__codelineno-240-15" name="__codelineno-240-15" href="#__codelineno-240-15"></a><span class="w"> </span><span class="n">reader</span><span class="p">.</span><span class="n">ReadEndElement</span><span class="p">();</span>
</span><span id="__span-240-16"><a id="__codelineno-240-16" name="__codelineno-240-16" href="#__codelineno-240-16"></a><span class="w"> </span><span class="p">}</span>
</span><span id="__span-240-17"><a id="__codelineno-240-17" name="__codelineno-240-17" href="#__codelineno-240-17"></a><span class="w"> </span><span class="k">public</span><span class="w"> </span><span class="k">void</span><span class="w"> </span><span class="nf">WriteXml</span><span class="w"> </span><span class="p">(</span><span class="n">XmlWriter</span><span class="w"> </span><span class="n">writer</span><span class="p">)</span>
</span><span id="__span-240-18"><a id="__codelineno-240-18" name="__codelineno-240-18" href="#__codelineno-240-18"></a><span class="w"> </span><span class="p">{</span>
</span><span id="__span-240-19"><a id="__codelineno-240-19" name="__codelineno-240-19" href="#__codelineno-240-19"></a><span class="w"> </span><span class="n">writer</span><span class="p">.</span><span class="n">WriteElementString</span><span class="w"> </span><span class="p">(</span><span class="s">&quot;Street&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">Street</span><span class="p">);</span>
</span><span id="__span-240-20"><a id="__codelineno-240-20" name="__codelineno-240-20" href="#__codelineno-240-20"></a><span class="w"> </span><span class="n">writer</span><span class="p">.</span><span class="n">WriteElementString</span><span class="w"> </span><span class="p">(</span><span class="s">&quot;PostCode&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">PostCode</span><span class="p">);</span>
</span><span id="__span-240-21"><a id="__codelineno-240-21" name="__codelineno-240-21" href="#__codelineno-240-21"></a><span class="p">}</span>
</span><span id="__span-240-22"><a id="__codelineno-240-22" name="__codelineno-240-22" href="#__codelineno-240-22"></a><span class="p">}</span>
</span></code></pre></div>
<p>Serializing and deserializing an instance of Address via XmlSerializer automatiâ€ cally calls the WriteXml and ReadXml methods. Further, if Person were defined like this:</p>
<div class="language-csharp highlight"><pre><span></span><code><span id="__span-241-1"><a id="__codelineno-241-1" name="__codelineno-241-1" href="#__codelineno-241-1"></a><span class="k">public</span><span class="w"> </span><span class="k">class</span><span class="w"> </span><span class="nc">Person</span>
</span><span id="__span-241-2"><a id="__codelineno-241-2" name="__codelineno-241-2" href="#__codelineno-241-2"></a><span class="p">{</span>
</span><span id="__span-241-3"><a id="__codelineno-241-3" name="__codelineno-241-3" href="#__codelineno-241-3"></a><span class="w"> </span><span class="k">public</span><span class="w"> </span><span class="kt">string</span><span class="w"> </span><span class="n">Name</span><span class="p">;</span>
</span><span id="__span-241-4"><a id="__codelineno-241-4" name="__codelineno-241-4" href="#__codelineno-241-4"></a><span class="w"> </span><span class="k">public</span><span class="w"> </span><span class="n">Address</span><span class="w"> </span><span class="n">HomeAddress</span><span class="p">;</span>
</span><span id="__span-241-5"><a id="__codelineno-241-5" name="__codelineno-241-5" href="#__codelineno-241-5"></a><span class="p">}</span>
</span></code></pre></div>
<p>IXmlSerializable would be called upon selectively to serialize the HomeAddress field.</p>
<h1 id="the-json-serializer">The JSON Serializer</h1>
<p>JsonSerializer (in the System.Text.Json namespace) is straightforward to use because of the simplicity of the JSON format. The root of a JSON document is either an array or an object. Under that root are properties, which can be an object, array, string, number, "true", "false", or "null". The JSON serializer directly maps class property names to property names in JSON.</p>
<h2 id="getting-started">Getting Started</h2>
<div class="language-csharp highlight"><pre><span></span><code><span id="__span-242-1"><a id="__codelineno-242-1" name="__codelineno-242-1" href="#__codelineno-242-1"></a><span class="k">public</span><span class="w"> </span><span class="k">class</span><span class="w"> </span><span class="nc">Person</span>
</span><span id="__span-242-2"><a id="__codelineno-242-2" name="__codelineno-242-2" href="#__codelineno-242-2"></a><span class="p">{</span>
</span><span id="__span-242-3"><a id="__codelineno-242-3" name="__codelineno-242-3" href="#__codelineno-242-3"></a><span class="w"> </span><span class="k">public</span><span class="w"> </span><span class="kt">string</span><span class="w"> </span><span class="n">Name</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">get</span><span class="p">;</span><span class="w"> </span><span class="k">set</span><span class="p">;</span><span class="w"> </span><span class="p">}</span>
</span><span id="__span-242-4"><a id="__codelineno-242-4" name="__codelineno-242-4" href="#__codelineno-242-4"></a><span class="p">}</span>
</span><span id="__span-242-5"><a id="__codelineno-242-5" name="__codelineno-242-5" href="#__codelineno-242-5"></a><span class="kt">var</span><span class="w"> </span><span class="n">p</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">Person</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">Name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;Ian&quot;</span><span class="w"> </span><span class="p">};</span>
</span><span id="__span-242-6"><a id="__codelineno-242-6" name="__codelineno-242-6" href="#__codelineno-242-6"></a><span class="kt">string</span><span class="w"> </span><span class="n">json</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">JsonSerializer</span><span class="p">.</span><span class="n">Serialize</span><span class="w"> </span><span class="p">(</span><span class="n">p</span><span class="p">,</span>
</span><span id="__span-242-7"><a id="__codelineno-242-7" name="__codelineno-242-7" href="#__codelineno-242-7"></a><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">JsonSerializerOptions</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">WriteIndented</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">true</span><span class="w"> </span><span class="p">});</span>
</span><span id="__span-242-8"><a id="__codelineno-242-8" name="__codelineno-242-8" href="#__codelineno-242-8"></a>
</span><span id="__span-242-9"><a id="__codelineno-242-9" name="__codelineno-242-9" href="#__codelineno-242-9"></a><span class="c1">//result:</span>
</span><span id="__span-242-10"><a id="__codelineno-242-10" name="__codelineno-242-10" href="#__codelineno-242-10"></a><span class="p">{</span>
</span><span id="__span-242-11"><a id="__codelineno-242-11" name="__codelineno-242-11" href="#__codelineno-242-11"></a><span class="w"> </span><span class="n">Name</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;Ian&quot;</span>
</span><span id="__span-242-12"><a id="__codelineno-242-12" name="__codelineno-242-12" href="#__codelineno-242-12"></a><span class="p">}</span>
</span><span id="__span-242-13"><a id="__codelineno-242-13" name="__codelineno-242-13" href="#__codelineno-242-13"></a>
</span><span id="__span-242-14"><a id="__codelineno-242-14" name="__codelineno-242-14" href="#__codelineno-242-14"></a><span class="c1">//JsonSerializer.Deserialize method does the reverse</span>
</span><span id="__span-242-15"><a id="__codelineno-242-15" name="__codelineno-242-15" href="#__codelineno-242-15"></a><span class="n">Person</span><span class="w"> </span><span class="n">p2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">JsonSerializer</span><span class="p">.</span><span class="n">Deserialize</span><span class="o">&lt;</span><span class="n">Person</span><span class="o">&gt;</span><span class="w"> </span><span class="p">(</span><span class="n">json</span><span class="p">);</span>
</span></code></pre></div>
<h2 id="serializing-child-objects_1">Serializing Child Objects</h2>
<div class="language-csharp highlight"><pre><span></span><code><span id="__span-243-1"><a id="__codelineno-243-1" name="__codelineno-243-1" href="#__codelineno-243-1"></a><span class="k">public</span><span class="w"> </span><span class="k">class</span><span class="w"> </span><span class="nc">Address</span>
</span><span id="__span-243-2"><a id="__codelineno-243-2" name="__codelineno-243-2" href="#__codelineno-243-2"></a><span class="p">{</span>
</span><span id="__span-243-3"><a id="__codelineno-243-3" name="__codelineno-243-3" href="#__codelineno-243-3"></a><span class="w"> </span><span class="k">public</span><span class="w"> </span><span class="kt">string</span><span class="w"> </span><span class="n">Street</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">get</span><span class="p">;</span><span class="w"> </span><span class="k">set</span><span class="p">;</span><span class="w"> </span><span class="p">}</span>
</span><span id="__span-243-4"><a id="__codelineno-243-4" name="__codelineno-243-4" href="#__codelineno-243-4"></a><span class="w"> </span><span class="k">public</span><span class="w"> </span><span class="kt">string</span><span class="w"> </span><span class="n">PostCode</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">get</span><span class="p">;</span><span class="w"> </span><span class="k">set</span><span class="p">;</span><span class="w"> </span><span class="p">}</span>
</span><span id="__span-243-5"><a id="__codelineno-243-5" name="__codelineno-243-5" href="#__codelineno-243-5"></a><span class="p">}</span>
</span><span id="__span-243-6"><a id="__codelineno-243-6" name="__codelineno-243-6" href="#__codelineno-243-6"></a><span class="k">public</span><span class="w"> </span><span class="k">class</span><span class="w"> </span><span class="nc">Person</span>
</span><span id="__span-243-7"><a id="__codelineno-243-7" name="__codelineno-243-7" href="#__codelineno-243-7"></a><span class="p">{</span>
</span><span id="__span-243-8"><a id="__codelineno-243-8" name="__codelineno-243-8" href="#__codelineno-243-8"></a><span class="w"> </span><span class="k">public</span><span class="w"> </span><span class="kt">string</span><span class="w"> </span><span class="n">Name</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">get</span><span class="p">;</span><span class="w"> </span><span class="k">set</span><span class="p">;</span><span class="w"> </span><span class="p">}</span>
</span><span id="__span-243-9"><a id="__codelineno-243-9" name="__codelineno-243-9" href="#__codelineno-243-9"></a><span class="w"> </span><span class="k">public</span><span class="w"> </span><span class="n">Address</span><span class="w"> </span><span class="n">HomeAddress</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">get</span><span class="p">;</span><span class="w"> </span><span class="k">set</span><span class="p">;</span><span class="w"> </span><span class="p">}</span>
</span><span id="__span-243-10"><a id="__codelineno-243-10" name="__codelineno-243-10" href="#__codelineno-243-10"></a><span class="w"> </span><span class="k">public</span><span class="w"> </span><span class="n">Address</span><span class="w"> </span><span class="n">WorkAddress</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">get</span><span class="p">;</span><span class="w"> </span><span class="k">set</span><span class="p">;</span><span class="w"> </span><span class="p">}</span>
</span><span id="__span-243-11"><a id="__codelineno-243-11" name="__codelineno-243-11" href="#__codelineno-243-11"></a><span class="p">}</span>
</span><span id="__span-243-12"><a id="__codelineno-243-12" name="__codelineno-243-12" href="#__codelineno-243-12"></a><span class="c1">//We can serialize this with no extra work</span>
</span><span id="__span-243-13"><a id="__codelineno-243-13" name="__codelineno-243-13" href="#__codelineno-243-13"></a><span class="kt">var</span><span class="w"> </span><span class="n">home</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">Address</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">Street</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;1 Main St.&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">PostCode</span><span class="o">=</span><span class="s">&quot;11235&quot;</span><span class="w"> </span><span class="p">};</span>
</span><span id="__span-243-14"><a id="__codelineno-243-14" name="__codelineno-243-14" href="#__codelineno-243-14"></a><span class="kt">var</span><span class="w"> </span><span class="n">work</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">Address</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">Street</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;4 Elm Ln.&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">PostCode</span><span class="o">=</span><span class="s">&quot;31415&quot;</span><span class="w"> </span><span class="p">};</span>
</span><span id="__span-243-15"><a id="__codelineno-243-15" name="__codelineno-243-15" href="#__codelineno-243-15"></a><span class="kt">var</span><span class="w"> </span><span class="n">p</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">Person</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">Name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;Ian&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">HomeAddress</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">home</span><span class="p">,</span><span class="w"> </span><span class="n">WorkAddress</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">work</span><span class="w"> </span><span class="p">};</span>
</span><span id="__span-243-16"><a id="__codelineno-243-16" name="__codelineno-243-16" href="#__codelineno-243-16"></a><span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="w"> </span><span class="p">(</span><span class="n">JsonSerializer</span><span class="p">.</span><span class="n">Serialize</span><span class="w"> </span><span class="p">(</span><span class="n">p</span><span class="p">,</span>
</span><span id="__span-243-17"><a id="__codelineno-243-17" name="__codelineno-243-17" href="#__codelineno-243-17"></a><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">JsonSerializerOptions</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">WriteIndented</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">true</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="p">));</span>
</span></code></pre></div>
<div class="language-json highlight"><pre><span></span><code><span id="__span-244-1"><a id="__codelineno-244-1" name="__codelineno-244-1" href="#__codelineno-244-1"></a><span class="p">{</span>
</span><span id="__span-244-2"><a id="__codelineno-244-2" name="__codelineno-244-2" href="#__codelineno-244-2"></a><span class="w"> </span><span class="nt">&quot;Name&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Ian&quot;</span><span class="p">,</span>
</span><span id="__span-244-3"><a id="__codelineno-244-3" name="__codelineno-244-3" href="#__codelineno-244-3"></a><span class="w"> </span><span class="nt">&quot;HomeAddress&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-244-4"><a id="__codelineno-244-4" name="__codelineno-244-4" href="#__codelineno-244-4"></a><span class="w"> </span><span class="nt">&quot;Street&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;1 Main St.&quot;</span><span class="p">,</span>
</span><span id="__span-244-5"><a id="__codelineno-244-5" name="__codelineno-244-5" href="#__codelineno-244-5"></a><span class="w"> </span><span class="nt">&quot;PostCode&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;11235&quot;</span>
</span><span id="__span-244-6"><a id="__codelineno-244-6" name="__codelineno-244-6" href="#__codelineno-244-6"></a><span class="w"> </span><span class="p">},</span>
</span><span id="__span-244-7"><a id="__codelineno-244-7" name="__codelineno-244-7" href="#__codelineno-244-7"></a><span class="w"> </span><span class="nt">&quot;WorkAddress&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-244-8"><a id="__codelineno-244-8" name="__codelineno-244-8" href="#__codelineno-244-8"></a><span class="w"> </span><span class="nt">&quot;Street&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;4 Elm Ln.&quot;</span><span class="p">,</span>
</span><span id="__span-244-9"><a id="__codelineno-244-9" name="__codelineno-244-9" href="#__codelineno-244-9"></a><span class="w"> </span><span class="nt">&quot;PostCode&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;31415&quot;</span>
</span><span id="__span-244-10"><a id="__codelineno-244-10" name="__codelineno-244-10" href="#__codelineno-244-10"></a><span class="w"> </span><span class="p">}</span>
</span><span id="__span-244-11"><a id="__codelineno-244-11" name="__codelineno-244-11" href="#__codelineno-244-11"></a><span class="p">}</span>
</span></code></pre></div>
<h2 id="serializing-collections_1">Serializing Collections</h2>
<p>JsonSerializer automatically serializes collections. Collections can appear in an objectâ€™s properties as well as in the root object itself</p>
<div class="language-csharp highlight"><pre><span></span><code><span id="__span-245-1"><a id="__codelineno-245-1" name="__codelineno-245-1" href="#__codelineno-245-1"></a><span class="kt">var</span><span class="w"> </span><span class="n">sara</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">Person</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">Name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;Sara&quot;</span><span class="w"> </span><span class="p">};</span>
</span><span id="__span-245-2"><a id="__codelineno-245-2" name="__codelineno-245-2" href="#__codelineno-245-2"></a><span class="kt">var</span><span class="w"> </span><span class="n">ian</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">Person</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">Name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;Ian&quot;</span><span class="w"> </span><span class="p">};</span>
</span><span id="__span-245-3"><a id="__codelineno-245-3" name="__codelineno-245-3" href="#__codelineno-245-3"></a><span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="w"> </span><span class="p">(</span><span class="n">JsonSerializer</span><span class="p">.</span><span class="n">Serialize</span><span class="w"> </span><span class="p">(</span><span class="k">new</span><span class="p">[]</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">sara</span><span class="p">,</span><span class="w"> </span><span class="n">ian</span><span class="w"> </span><span class="p">},</span>
</span><span id="__span-245-4"><a id="__codelineno-245-4" name="__codelineno-245-4" href="#__codelineno-245-4"></a><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">JsonSerializerOptions</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">WriteIndented</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">true</span><span class="w"> </span><span class="p">}));</span>
</span><span id="__span-245-5"><a id="__codelineno-245-5" name="__codelineno-245-5" href="#__codelineno-245-5"></a><span class="c1">//Hereâ€™s the result:</span>
</span><span id="__span-245-6"><a id="__codelineno-245-6" name="__codelineno-245-6" href="#__codelineno-245-6"></a><span class="na">[</span>
</span><span id="__span-245-7"><a id="__codelineno-245-7" name="__codelineno-245-7" href="#__codelineno-245-7"></a><span class="na"> {</span>
</span><span id="__span-245-8"><a id="__codelineno-245-8" name="__codelineno-245-8" href="#__codelineno-245-8"></a><span class="na"> &quot;Name&quot;: &quot;Sara&quot;</span>
</span><span id="__span-245-9"><a id="__codelineno-245-9" name="__codelineno-245-9" href="#__codelineno-245-9"></a><span class="na"> },</span>
</span><span id="__span-245-10"><a id="__codelineno-245-10" name="__codelineno-245-10" href="#__codelineno-245-10"></a><span class="na"> {</span>
</span><span id="__span-245-11"><a id="__codelineno-245-11" name="__codelineno-245-11" href="#__codelineno-245-11"></a><span class="na"> &quot;Name&quot;: &quot;Ian&quot;</span>
</span><span id="__span-245-12"><a id="__codelineno-245-12" name="__codelineno-245-12" href="#__codelineno-245-12"></a><span class="na"> }</span>
</span><span id="__span-245-13"><a id="__codelineno-245-13" name="__codelineno-245-13" href="#__codelineno-245-13"></a><span class="na">]</span>
</span><span id="__span-245-14"><a id="__codelineno-245-14" name="__codelineno-245-14" href="#__codelineno-245-14"></a><span class="c1">//The following deserializes the JSON:</span>
</span><span id="__span-245-15"><a id="__codelineno-245-15" name="__codelineno-245-15" href="#__codelineno-245-15"></a><span class="n">Person</span><span class="p">[]</span><span class="w"> </span><span class="n">people</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">JsonSerializer</span><span class="p">.</span><span class="n">Deserialize</span><span class="o">&lt;</span><span class="n">Person</span><span class="p">[]</span><span class="o">&gt;</span><span class="w"> </span><span class="p">(</span><span class="n">json</span><span class="p">);</span>
</span></code></pre></div>
<h2 id="controlling-serialization-with-attributes">Controlling Serialization with Attributes</h2>
<p>You can control the serialization process with attributes defined in the <code>System.Text.Json.Serialization namespace</code>.</p>
<ul>
<li>
<p>JsonIgnoreAttribute</p>
<p>To Opt Out of Specific Property</p>
</li>
<li>
<p>JsonPropertyNameAttribute</p>
<p>To give Specific Name to Property</p>
</li>
<li>
<p>JsonExtensionDataAttribute</p>
<p>providing a mechanism to
store all unrecognized properties so that their values can be used when reserializing</p>
</li>
<li>
<p>JsonConverterAttribute</p>
<div class="language-csharp highlight"><pre><span></span><code><span id="__span-246-1"><a id="__codelineno-246-1" name="__codelineno-246-1" href="#__codelineno-246-1"></a><span class="p">{</span>
</span><span id="__span-246-2"><a id="__codelineno-246-2" name="__codelineno-246-2" href="#__codelineno-246-2"></a><span class="w"> </span><span class="s">&quot;Id&quot;</span><span class="p">:</span><span class="mi">27182</span><span class="p">,</span>
</span><span id="__span-246-3"><a id="__codelineno-246-3" name="__codelineno-246-3" href="#__codelineno-246-3"></a><span class="w"> </span><span class="s">&quot;Name&quot;</span><span class="p">:</span><span class="s">&quot;Sara&quot;</span><span class="p">,</span>
</span><span id="__span-246-4"><a id="__codelineno-246-4" name="__codelineno-246-4" href="#__codelineno-246-4"></a><span class="w"> </span><span class="s">&quot;Born&quot;</span><span class="p">:</span><span class="mi">464572800</span><span class="w"> </span><span class="c1">// Number of seconds since 1/1/1970</span>
</span><span id="__span-246-5"><a id="__codelineno-246-5" name="__codelineno-246-5" href="#__codelineno-246-5"></a><span class="p">}</span>
</span><span id="__span-246-6"><a id="__codelineno-246-6" name="__codelineno-246-6" href="#__codelineno-246-6"></a>
</span><span id="__span-246-7"><a id="__codelineno-246-7" name="__codelineno-246-7" href="#__codelineno-246-7"></a><span class="k">public</span><span class="w"> </span><span class="k">class</span><span class="w"> </span><span class="nc">Person</span>
</span><span id="__span-246-8"><a id="__codelineno-246-8" name="__codelineno-246-8" href="#__codelineno-246-8"></a><span class="p">{</span>
</span><span id="__span-246-9"><a id="__codelineno-246-9" name="__codelineno-246-9" href="#__codelineno-246-9"></a><span class="w"> </span><span class="k">public</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">Id</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">get</span><span class="p">;</span><span class="w"> </span><span class="k">set</span><span class="p">;</span><span class="w"> </span><span class="p">}</span>
</span><span id="__span-246-10"><a id="__codelineno-246-10" name="__codelineno-246-10" href="#__codelineno-246-10"></a><span class="w"> </span><span class="k">public</span><span class="w"> </span><span class="kt">string</span><span class="w"> </span><span class="n">Name</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">get</span><span class="p">;</span><span class="w"> </span><span class="k">set</span><span class="p">;</span><span class="w"> </span><span class="p">}</span>
</span><span id="__span-246-11"><a id="__codelineno-246-11" name="__codelineno-246-11" href="#__codelineno-246-11"></a><span class="w"> </span><span class="k">public</span><span class="w"> </span><span class="n">DateTime</span><span class="w"> </span><span class="n">Born</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">get</span><span class="p">;</span><span class="w"> </span><span class="k">set</span><span class="p">;</span><span class="w"> </span><span class="p">}</span>
</span><span id="__span-246-12"><a id="__codelineno-246-12" name="__codelineno-246-12" href="#__codelineno-246-12"></a><span class="p">}</span>
</span><span id="__span-246-13"><a id="__codelineno-246-13" name="__codelineno-246-13" href="#__codelineno-246-13"></a><span class="k">public</span><span class="w"> </span><span class="k">class</span><span class="w"> </span><span class="nc">UnixTimestampConverter</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="n">JsonConverter</span><span class="o">&lt;</span><span class="n">DateTime</span><span class="o">&gt;</span>
</span><span id="__span-246-14"><a id="__codelineno-246-14" name="__codelineno-246-14" href="#__codelineno-246-14"></a><span class="p">{</span>
</span><span id="__span-246-15"><a id="__codelineno-246-15" name="__codelineno-246-15" href="#__codelineno-246-15"></a><span class="w"> </span><span class="k">public</span><span class="w"> </span><span class="k">override</span><span class="w"> </span><span class="n">DateTime</span><span class="w"> </span><span class="nf">Read</span><span class="w"> </span><span class="p">(</span><span class="k">ref</span><span class="w"> </span><span class="n">Utf8JsonReader</span><span class="w"> </span><span class="n">reader</span><span class="p">,</span><span class="w"> </span><span class="n">Type</span><span class="w"> </span><span class="n">type</span><span class="p">,</span>
</span><span id="__span-246-16"><a id="__codelineno-246-16" name="__codelineno-246-16" href="#__codelineno-246-16"></a><span class="w"> </span><span class="n">JsonSerializerOptions</span><span class="w"> </span><span class="n">options</span><span class="p">)</span>
</span><span id="__span-246-17"><a id="__codelineno-246-17" name="__codelineno-246-17" href="#__codelineno-246-17"></a><span class="w"> </span><span class="p">{</span>
</span><span id="__span-246-18"><a id="__codelineno-246-18" name="__codelineno-246-18" href="#__codelineno-246-18"></a><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">reader</span><span class="p">.</span><span class="n">TryGetInt32</span><span class="p">(</span><span class="k">out</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">timestamp</span><span class="p">))</span>
</span><span id="__span-246-19"><a id="__codelineno-246-19" name="__codelineno-246-19" href="#__codelineno-246-19"></a><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="nf">DateTime</span><span class="w"> </span><span class="p">(</span><span class="mi">1970</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">).</span><span class="n">AddSeconds</span><span class="w"> </span><span class="p">(</span><span class="n">timestamp</span><span class="p">);</span>
</span><span id="__span-246-20"><a id="__codelineno-246-20" name="__codelineno-246-20" href="#__codelineno-246-20"></a><span class="w"> </span><span class="k">throw</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="nf">Exception</span><span class="w"> </span><span class="p">(</span><span class="s">&quot;Expected the timestamp as a number.&quot;</span><span class="p">);</span>
</span><span id="__span-246-21"><a id="__codelineno-246-21" name="__codelineno-246-21" href="#__codelineno-246-21"></a><span class="w"> </span><span class="p">}</span>
</span><span id="__span-246-22"><a id="__codelineno-246-22" name="__codelineno-246-22" href="#__codelineno-246-22"></a><span class="w"> </span><span class="k">public</span><span class="w"> </span><span class="k">override</span><span class="w"> </span><span class="k">void</span><span class="w"> </span><span class="nf">Write</span><span class="w"> </span><span class="p">(</span><span class="n">Utf8JsonWriter</span><span class="w"> </span><span class="n">writer</span><span class="p">,</span><span class="w"> </span><span class="n">DateTime</span><span class="w"> </span><span class="k">value</span><span class="p">,</span>
</span><span id="__span-246-23"><a id="__codelineno-246-23" name="__codelineno-246-23" href="#__codelineno-246-23"></a><span class="w"> </span><span class="n">JsonSerializerOptions</span><span class="w"> </span><span class="n">options</span><span class="p">)</span>
</span><span id="__span-246-24"><a id="__codelineno-246-24" name="__codelineno-246-24" href="#__codelineno-246-24"></a><span class="w"> </span><span class="p">{</span>
</span><span id="__span-246-25"><a id="__codelineno-246-25" name="__codelineno-246-25" href="#__codelineno-246-25"></a><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">timestamp</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="p">)(</span><span class="k">value</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">DateTime</span><span class="p">(</span><span class="mi">1970</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">)).</span><span class="n">TotalSeconds</span><span class="p">;</span>
</span><span id="__span-246-26"><a id="__codelineno-246-26" name="__codelineno-246-26" href="#__codelineno-246-26"></a><span class="w"> </span><span class="n">writer</span><span class="p">.</span><span class="n">WriteNumberValue</span><span class="p">(</span><span class="n">timestamp</span><span class="p">);</span>
</span><span id="__span-246-27"><a id="__codelineno-246-27" name="__codelineno-246-27" href="#__codelineno-246-27"></a><span class="w"> </span><span class="p">}</span>
</span><span id="__span-246-28"><a id="__codelineno-246-28" name="__codelineno-246-28" href="#__codelineno-246-28"></a><span class="p">}</span>
</span><span id="__span-246-29"><a id="__codelineno-246-29" name="__codelineno-246-29" href="#__codelineno-246-29"></a><span class="c1">//Then we can either apply the [JsonConverter] to the properties that we want to</span>
</span><span id="__span-246-30"><a id="__codelineno-246-30" name="__codelineno-246-30" href="#__codelineno-246-30"></a><span class="c1">//convert:</span>
</span><span id="__span-246-31"><a id="__codelineno-246-31" name="__codelineno-246-31" href="#__codelineno-246-31"></a><span class="na">[JsonConverter(typeof(UnixTimestampConverter))]</span>
</span><span id="__span-246-32"><a id="__codelineno-246-32" name="__codelineno-246-32" href="#__codelineno-246-32"></a><span class="k">public</span><span class="w"> </span><span class="n">DateTime</span><span class="w"> </span><span class="n">Born</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">get</span><span class="p">;</span><span class="w"> </span><span class="k">set</span><span class="p">;</span><span class="w"> </span><span class="p">}</span>
</span><span id="__span-246-33"><a id="__codelineno-246-33" name="__codelineno-246-33" href="#__codelineno-246-33"></a><span class="c1">//or, if the API is consistent in its representation of data types, make the </span>
</span><span id="__span-246-34"><a id="__codelineno-246-34" name="__codelineno-246-34" href="#__codelineno-246-34"></a><span class="c1">//converter act as a default:</span>
</span><span id="__span-246-35"><a id="__codelineno-246-35" name="__codelineno-246-35" href="#__codelineno-246-35"></a><span class="n">JsonSerializerOptions</span><span class="w"> </span><span class="n">opts</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">JsonSerializerOptions</span><span class="p">();</span>
</span><span id="__span-246-36"><a id="__codelineno-246-36" name="__codelineno-246-36" href="#__codelineno-246-36"></a><span class="n">opts</span><span class="p">.</span><span class="n">Converters</span><span class="p">.</span><span class="n">Add</span><span class="w"> </span><span class="p">(</span><span class="k">new</span><span class="w"> </span><span class="n">UnixTimestampConverter</span><span class="p">());</span>
</span><span id="__span-246-37"><a id="__codelineno-246-37" name="__codelineno-246-37" href="#__codelineno-246-37"></a><span class="kt">var</span><span class="w"> </span><span class="n">sara</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">JsonSerializer</span><span class="p">.</span><span class="n">Deserialize</span><span class="o">&lt;</span><span class="n">Person</span><span class="o">&gt;</span><span class="w"> </span><span class="p">(</span><span class="n">json</span><span class="p">,</span><span class="w"> </span><span class="n">opts</span><span class="p">);</span>
</span></code></pre></div>
</li>
</ul>
<h2 id="json-serialization-options">JSON Serialization Options</h2>
<p>The serializer accepts an optional JsonSerializationOptions parameter, allowing additional control over the serialization and deserialization process.</p>
<h3 id="writeindented">WriteIndented</h3>
<p>We have set WriteIndented to true throughout this section to instruct the serializer to emit whitespace to generate more human-readable JSON. The default is false, which results in everything being crammed onto one line.</p>
<h3 id="allowtrailingcommas">AllowTrailingCommas</h3>
<p>The JSON spec requires properties and array elements to be comma separated but does not allow trailing commas:</p>
<div class="language-csharp highlight"><pre><span></span><code><span id="__span-247-1"><a id="__codelineno-247-1" name="__codelineno-247-1" href="#__codelineno-247-1"></a><span class="p">{</span>
</span><span id="__span-247-2"><a id="__codelineno-247-2" name="__codelineno-247-2" href="#__codelineno-247-2"></a><span class="w"> </span><span class="s">&quot;Name&quot;</span><span class="p">:</span><span class="s">&quot;Dylan&quot;</span><span class="p">,</span>
</span><span id="__span-247-3"><a id="__codelineno-247-3" name="__codelineno-247-3" href="#__codelineno-247-3"></a><span class="w"> </span><span class="s">&quot;LuckyNumbers&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="mi">10</span><span class="p">,</span><span class="w"> </span><span class="mi">7</span><span class="p">,</span><span class="w"> </span><span class="p">],</span>
</span><span id="__span-247-4"><a id="__codelineno-247-4" name="__codelineno-247-4" href="#__codelineno-247-4"></a><span class="w"> </span><span class="s">&quot;Age&quot;</span><span class="p">:</span><span class="mi">46</span><span class="p">,</span>
</span><span id="__span-247-5"><a id="__codelineno-247-5" name="__codelineno-247-5" href="#__codelineno-247-5"></a><span class="p">}</span>
</span><span id="__span-247-6"><a id="__codelineno-247-6" name="__codelineno-247-6" href="#__codelineno-247-6"></a><span class="c1">//The trailing commas after 7 and 46 are not allowed by default.</span>
</span></code></pre></div>
<h3 id="readcommenthandling">ReadCommentHandling</h3>
<p>By default, the deserializer throws an exception when encountering comments (because comments are not part of the official JSON standard). Setting ReadComment Handling to JsonCommentHandling.Skip instructs the deserializer to skip over them instead, so the following can be successfully parsed:</p>
<div class="language-csharp highlight"><pre><span></span><code><span id="__span-248-1"><a id="__codelineno-248-1" name="__codelineno-248-1" href="#__codelineno-248-1"></a><span class="p">{</span>
</span><span id="__span-248-2"><a id="__codelineno-248-2" name="__codelineno-248-2" href="#__codelineno-248-2"></a><span class="w"> </span><span class="s">&quot;Name&quot;</span><span class="p">:</span><span class="s">&quot;Dylan&quot;</span><span class="w"> </span><span class="c1">// Comment here</span>
</span><span id="__span-248-3"><a id="__codelineno-248-3" name="__codelineno-248-3" href="#__codelineno-248-3"></a><span class="w"> </span><span class="cm">/* This is another comment */</span>
</span><span id="__span-248-4"><a id="__codelineno-248-4" name="__codelineno-248-4" href="#__codelineno-248-4"></a><span class="p">}</span>
</span></code></pre></div>
<h3 id="propertynamecaseinsensitive">PropertyNameCaseInsensitive</h3>
<p>By default, the deserializer is case sensitive when matching JSON property names to C# property names. This means that the following input:
<code>{ "name":"Dylan" }</code>
would fail to populate the Name property in our Person class (the JSON property would be ignored).</p>
<h3 id="propertynamingpolicy">PropertyNamingPolicy</h3>
<p>To better support the popular camel-case property naming convention, .NET Core 3 introduced PropertyNamingPolicy. It provides better performance than the justdescribed PropertyNameCaseInsensitive option and applies to both serialization and deserialization.</p>
<div class="language-csharp highlight"><pre><span></span><code><span id="__span-249-1"><a id="__codelineno-249-1" name="__codelineno-249-1" href="#__codelineno-249-1"></a><span class="kt">var</span><span class="w"> </span><span class="n">dylan</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">Person</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">Name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;Dylan&quot;</span><span class="w"> </span><span class="p">};</span>
</span><span id="__span-249-2"><a id="__codelineno-249-2" name="__codelineno-249-2" href="#__codelineno-249-2"></a><span class="kt">var</span><span class="w"> </span><span class="n">json</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">JsonSerializer</span><span class="p">.</span><span class="n">Serialize</span><span class="w"> </span><span class="p">(</span><span class="n">dylan</span><span class="p">,</span>
</span><span id="__span-249-3"><a id="__codelineno-249-3" name="__codelineno-249-3" href="#__codelineno-249-3"></a><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">JsonSerializerOptions</span><span class="p">{</span>
</span><span id="__span-249-4"><a id="__codelineno-249-4" name="__codelineno-249-4" href="#__codelineno-249-4"></a><span class="w"> </span><span class="n">PropertyNamingPolicy</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">JsonNamingPolicy</span><span class="p">.</span><span class="n">CamelCase</span>
</span><span id="__span-249-5"><a id="__codelineno-249-5" name="__codelineno-249-5" href="#__codelineno-249-5"></a><span class="w"> </span><span class="p">});</span>
</span><span id="__span-249-6"><a id="__codelineno-249-6" name="__codelineno-249-6" href="#__codelineno-249-6"></a><span class="n">yields</span><span class="p">:</span>
</span><span id="__span-249-7"><a id="__codelineno-249-7" name="__codelineno-249-7" href="#__codelineno-249-7"></a><span class="p">{</span><span class="s">&quot;name&quot;</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;Dylan&quot;</span><span class="p">}</span>
</span><span id="__span-249-8"><a id="__codelineno-249-8" name="__codelineno-249-8" href="#__codelineno-249-8"></a><span class="n">which</span><span class="w"> </span><span class="n">can</span><span class="w"> </span><span class="n">be</span><span class="w"> </span><span class="n">deserialized</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">same</span><span class="w"> </span><span class="n">way</span><span class="p">:</span>
</span><span id="__span-249-9"><a id="__codelineno-249-9" name="__codelineno-249-9" href="#__codelineno-249-9"></a><span class="kt">var</span><span class="w"> </span><span class="n">dylan2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">JsonSerializer</span><span class="p">.</span><span class="n">Deserialize</span><span class="o">&lt;</span><span class="n">Person</span><span class="o">&gt;</span><span class="w"> </span><span class="p">(</span><span class="n">json</span><span class="p">,</span>
</span><span id="__span-249-10"><a id="__codelineno-249-10" name="__codelineno-249-10" href="#__codelineno-249-10"></a><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">JsonSerializerOptions</span>
</span><span id="__span-249-11"><a id="__codelineno-249-11" name="__codelineno-249-11" href="#__codelineno-249-11"></a><span class="w"> </span><span class="p">{</span>
</span><span id="__span-249-12"><a id="__codelineno-249-12" name="__codelineno-249-12" href="#__codelineno-249-12"></a><span class="w"> </span><span class="n">PropertyNamingPolicy</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">JsonNamingPolicy</span><span class="p">.</span><span class="n">CamelCase</span>
</span><span id="__span-249-13"><a id="__codelineno-249-13" name="__codelineno-249-13" href="#__codelineno-249-13"></a><span class="w"> </span><span class="p">});</span>
</span></code></pre></div>
<h3 id="dictionarykeypolicy">DictionaryKeyPolicy</h3>
<p>With the DictionaryKeyPolicy option, you can force dictionary keys to serialize or deserialize with camel casing:</p>
<div class="language-csharp highlight"><pre><span></span><code><span id="__span-250-1"><a id="__codelineno-250-1" name="__codelineno-250-1" href="#__codelineno-250-1"></a><span class="kt">var</span><span class="w"> </span><span class="n">dict</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">Dictionary</span><span class="o">&lt;</span><span class="kt">string</span><span class="p">,</span><span class="w"> </span><span class="kt">string</span><span class="o">&gt;</span>
</span><span id="__span-250-2"><a id="__codelineno-250-2" name="__codelineno-250-2" href="#__codelineno-250-2"></a><span class="p">{</span>
</span><span id="__span-250-3"><a id="__codelineno-250-3" name="__codelineno-250-3" href="#__codelineno-250-3"></a><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="s">&quot;BookName&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Nutshell&quot;</span><span class="w"> </span><span class="p">}</span>
</span><span id="__span-250-4"><a id="__codelineno-250-4" name="__codelineno-250-4" href="#__codelineno-250-4"></a><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="s">&quot;BookVersion&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;8.0&quot;</span><span class="w"> </span><span class="p">},</span>
</span><span id="__span-250-5"><a id="__codelineno-250-5" name="__codelineno-250-5" href="#__codelineno-250-5"></a><span class="p">};</span>
</span><span id="__span-250-6"><a id="__codelineno-250-6" name="__codelineno-250-6" href="#__codelineno-250-6"></a><span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="w"> </span><span class="p">(</span><span class="n">JsonSerializer</span><span class="p">.</span><span class="n">Serialize</span><span class="w"> </span><span class="p">(</span><span class="n">dict</span><span class="p">,</span>
</span><span id="__span-250-7"><a id="__codelineno-250-7" name="__codelineno-250-7" href="#__codelineno-250-7"></a><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">JsonSerializerOptions</span>
</span><span id="__span-250-8"><a id="__codelineno-250-8" name="__codelineno-250-8" href="#__codelineno-250-8"></a><span class="w"> </span><span class="p">{</span>
</span><span id="__span-250-9"><a id="__codelineno-250-9" name="__codelineno-250-9" href="#__codelineno-250-9"></a><span class="w"> </span><span class="n">WriteIndented</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">true</span><span class="p">,</span>
</span><span id="__span-250-10"><a id="__codelineno-250-10" name="__codelineno-250-10" href="#__codelineno-250-10"></a><span class="w"> </span><span class="n">DictionaryKeyPolicy</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">JsonNamingPolicy</span><span class="p">.</span><span class="n">CamelCase</span>
</span><span id="__span-250-11"><a id="__codelineno-250-11" name="__codelineno-250-11" href="#__codelineno-250-11"></a><span class="w"> </span><span class="p">}));</span>
</span><span id="__span-250-12"><a id="__codelineno-250-12" name="__codelineno-250-12" href="#__codelineno-250-12"></a><span class="n">This</span><span class="w"> </span><span class="n">outputs</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">following</span><span class="p">:</span>
</span><span id="__span-250-13"><a id="__codelineno-250-13" name="__codelineno-250-13" href="#__codelineno-250-13"></a><span class="p">{</span>
</span><span id="__span-250-14"><a id="__codelineno-250-14" name="__codelineno-250-14" href="#__codelineno-250-14"></a><span class="w"> </span><span class="s">&quot;bookName&quot;</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;Nutshell&quot;</span>
</span><span id="__span-250-15"><a id="__codelineno-250-15" name="__codelineno-250-15" href="#__codelineno-250-15"></a><span class="w"> </span><span class="s">&quot;bookVersion&quot;</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;8.0&quot;</span><span class="p">,</span>
</span><span id="__span-250-16"><a id="__codelineno-250-16" name="__codelineno-250-16" href="#__codelineno-250-16"></a><span class="p">}</span>
</span></code></pre></div>
<h3 id="encoder">Encoder</h3>
<p>The default text encoder aggressively escapes characters such that the output can appear in an HTML document without additional processing:</p>
<div class="language-csharp highlight"><pre><span></span><code><span id="__span-251-1"><a id="__codelineno-251-1" name="__codelineno-251-1" href="#__codelineno-251-1"></a><span class="kt">string</span><span class="w"> </span><span class="n">dylan</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;&lt;b&gt;Dylan &amp; Friends&lt;/b&gt;&quot;</span><span class="p">;</span>
</span><span id="__span-251-2"><a id="__codelineno-251-2" name="__codelineno-251-2" href="#__codelineno-251-2"></a><span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="w"> </span><span class="p">(</span><span class="n">JsonSerializer</span><span class="p">.</span><span class="n">Serialize</span><span class="w"> </span><span class="p">(</span><span class="n">dylan</span><span class="p">));</span>
</span><span id="__span-251-3"><a id="__codelineno-251-3" name="__codelineno-251-3" href="#__codelineno-251-3"></a><span class="n">Here</span><span class="err">â€™</span><span class="n">s</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">output</span><span class="p">:</span>
</span><span id="__span-251-4"><a id="__codelineno-251-4" name="__codelineno-251-4" href="#__codelineno-251-4"></a><span class="s">&quot;\u003Cb\u003EDylan \u0026 Friends\u003C/b\u003E&quot;</span>
</span><span id="__span-251-5"><a id="__codelineno-251-5" name="__codelineno-251-5" href="#__codelineno-251-5"></a><span class="c1">//You can prevent this by changing the Encoder:</span>
</span><span id="__span-251-6"><a id="__codelineno-251-6" name="__codelineno-251-6" href="#__codelineno-251-6"></a><span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="w"> </span><span class="p">(</span><span class="n">JsonSerializer</span><span class="p">.</span><span class="n">Serialize</span><span class="w"> </span><span class="p">(</span><span class="n">dylan</span><span class="p">,</span>
</span><span id="__span-251-7"><a id="__codelineno-251-7" name="__codelineno-251-7" href="#__codelineno-251-7"></a><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">JsonSerializerOptions</span><span class="w"> </span><span class="p">{</span><span class="n">Encoder</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">JavaScriptEncoder</span><span class="p">.</span><span class="n">UnsafeRelaxedJsonEscaping</span>
</span><span id="__span-251-8"><a id="__codelineno-251-8" name="__codelineno-251-8" href="#__codelineno-251-8"></a><span class="w"> </span><span class="p">}));</span>
</span><span id="__span-251-9"><a id="__codelineno-251-9" name="__codelineno-251-9" href="#__codelineno-251-9"></a><span class="c1">//This yields the following output:</span>
</span><span id="__span-251-10"><a id="__codelineno-251-10" name="__codelineno-251-10" href="#__codelineno-251-10"></a><span class="s">&quot;&lt;b&gt;Dylan &amp; Friends&lt;/b&gt;&quot;</span>
</span></code></pre></div>
<h3 id="ignorenullvalues">IgnoreNullValues</h3>
<div class="language-csharp highlight"><pre><span></span><code><span id="__span-252-1"><a id="__codelineno-252-1" name="__codelineno-252-1" href="#__codelineno-252-1"></a><span class="kt">var</span><span class="w"> </span><span class="n">person</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">Person</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">Name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">null</span><span class="w"> </span><span class="p">};</span>
</span><span id="__span-252-2"><a id="__codelineno-252-2" name="__codelineno-252-2" href="#__codelineno-252-2"></a><span class="c1">//would serialize to:</span>
</span><span id="__span-252-3"><a id="__codelineno-252-3" name="__codelineno-252-3" href="#__codelineno-252-3"></a><span class="p">{</span>
</span><span id="__span-252-4"><a id="__codelineno-252-4" name="__codelineno-252-4" href="#__codelineno-252-4"></a><span class="w"> </span><span class="s">&quot;Name&quot;</span><span class="p">:</span><span class="w"> </span><span class="k">null</span>
</span><span id="__span-252-5"><a id="__codelineno-252-5" name="__codelineno-252-5" href="#__codelineno-252-5"></a><span class="p">}</span>
</span><span id="__span-252-6"><a id="__codelineno-252-6" name="__codelineno-252-6" href="#__codelineno-252-6"></a><span class="n">With</span><span class="w"> </span><span class="n">IgnoreNullValues</span><span class="w"> </span><span class="k">set</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="k">true</span><span class="p">,</span><span class="w"> </span><span class="k">null</span><span class="o">-</span><span class="k">value</span><span class="w"> </span><span class="n">properties</span><span class="w"> </span><span class="n">are</span><span class="w"> </span><span class="n">completely</span><span class="w"> </span><span class="n">ignored</span><span class="p">:</span>
</span><span id="__span-252-7"><a id="__codelineno-252-7" name="__codelineno-252-7" href="#__codelineno-252-7"></a><span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="w"> </span><span class="p">(</span><span class="n">JsonSerializer</span><span class="p">.</span><span class="n">Serialize</span><span class="w"> </span><span class="p">(</span><span class="n">person</span><span class="p">),</span>
</span><span id="__span-252-8"><a id="__codelineno-252-8" name="__codelineno-252-8" href="#__codelineno-252-8"></a><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">JsonSerializerOptions</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">IgnoreNullValues</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">true</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="p">));</span>
</span><span id="__span-252-9"><a id="__codelineno-252-9" name="__codelineno-252-9" href="#__codelineno-252-9"></a><span class="c1">//Hereâ€™s the output:</span>
</span><span id="__span-252-10"><a id="__codelineno-252-10" name="__codelineno-252-10" href="#__codelineno-252-10"></a><span class="p">{}</span>
</span></code></pre></div>
<h3 id="ignorereadonlyproperties">IgnoreReadOnlyProperties</h3>
<p>By default, read-only properties are serialized (but not deserialized, because there is no set accessor). You can tell the serializer to ignore read-only properties by setting IgnoreReadOnlyProperties to true</p>
<h1 id="the-binary-serializer_1">The Binary Serializer</h1>
<p>The binary serialization engine saves and restores objects with full type and reference fidelity, and you can use it to perform such tasks as saving and restoring objects to disk. The binary serializer is highly automated and can handle complex object graphs with minimum intervention.</p>
<p>There are two ways to make a type support binary serialization. The first is attribute-based; the second involves implementing ISerializable. Adding attributes is simpler; implementing ISerializable is more flexible. You typically implement ISerializable to do the following</p>
<ul>
<li>Dynamically control what gets serialized</li>
<li>Make your serializable type friendly to being subclassed by other parties</li>
</ul>
<h2 id="getting-started_1">Getting Started</h2>
<p>You can make a type serializable by applying a single attribute</p>
<div class="language-csharp highlight"><pre><span></span><code><span id="__span-253-1"><a id="__codelineno-253-1" name="__codelineno-253-1" href="#__codelineno-253-1"></a><span class="na">[Serializable]</span><span class="w"> </span><span class="k">public</span><span class="w"> </span><span class="k">sealed</span><span class="w"> </span><span class="k">class</span><span class="w"> </span><span class="nc">Person</span>
</span><span id="__span-253-2"><a id="__codelineno-253-2" name="__codelineno-253-2" href="#__codelineno-253-2"></a><span class="p">{</span>
</span><span id="__span-253-3"><a id="__codelineno-253-3" name="__codelineno-253-3" href="#__codelineno-253-3"></a><span class="w"> </span><span class="k">public</span><span class="w"> </span><span class="kt">string</span><span class="w"> </span><span class="n">Name</span><span class="p">;</span>
</span><span id="__span-253-4"><a id="__codelineno-253-4" name="__codelineno-253-4" href="#__codelineno-253-4"></a><span class="w"> </span><span class="k">public</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">Age</span><span class="p">;</span>
</span><span id="__span-253-5"><a id="__codelineno-253-5" name="__codelineno-253-5" href="#__codelineno-253-5"></a><span class="p">}</span>
</span></code></pre></div>
<p>The [Serializable] attribute instructs the serializer to include all fields in the type. This includes both private and public fields (but not properties). Every field must itself be serializable; otherwise, an exception is thrown. Primitive .NET types such as string and int support serialization (as do many other .NET types).</p>
<aside>
ðŸ‘‰ðŸ¿ The Serializable attribute is not inherited, so subclasses are not automatically serializable, unless also marked with this attribute.

</aside>

<p>To serialize an instance of Person, you instantiate BinaryFormatter (in System .Runtime.Serialization.Formatters.Binary) and call Serialize.</p>
<div class="language-csharp highlight"><pre><span></span><code><span id="__span-254-1"><a id="__codelineno-254-1" name="__codelineno-254-1" href="#__codelineno-254-1"></a><span class="n">Person</span><span class="w"> </span><span class="n">p</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">Person</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">Name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;George&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">Age</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">25</span><span class="w"> </span><span class="p">};</span>
</span><span id="__span-254-2"><a id="__codelineno-254-2" name="__codelineno-254-2" href="#__codelineno-254-2"></a><span class="n">IFormatter</span><span class="w"> </span><span class="n">formatter</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">BinaryFormatter</span><span class="p">();</span>
</span><span id="__span-254-3"><a id="__codelineno-254-3" name="__codelineno-254-3" href="#__codelineno-254-3"></a><span class="k">using</span><span class="w"> </span><span class="p">(</span><span class="n">FileStream</span><span class="w"> </span><span class="n">s</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">File</span><span class="p">.</span><span class="n">Create</span><span class="w"> </span><span class="p">(</span><span class="s">&quot;serialized.bin&quot;</span><span class="p">))</span>
</span><span id="__span-254-4"><a id="__codelineno-254-4" name="__codelineno-254-4" href="#__codelineno-254-4"></a><span class="w"> </span><span class="n">formatter</span><span class="p">.</span><span class="n">Serialize</span><span class="w"> </span><span class="p">(</span><span class="n">s</span><span class="p">,</span><span class="w"> </span><span class="n">p</span><span class="p">);</span>
</span></code></pre></div>
<p>All of the data necessary to reconstruct the Person object is written to the file serialized.bin. The Deserialize method restores the object:</p>
<div class="language-csharp highlight"><pre><span></span><code><span id="__span-255-1"><a id="__codelineno-255-1" name="__codelineno-255-1" href="#__codelineno-255-1"></a><span class="k">using</span><span class="w"> </span><span class="p">(</span><span class="n">FileStream</span><span class="w"> </span><span class="n">s</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">File</span><span class="p">.</span><span class="n">OpenRead</span><span class="w"> </span><span class="p">(</span><span class="s">&quot;serialized.bin&quot;</span><span class="p">))</span>
</span><span id="__span-255-2"><a id="__codelineno-255-2" name="__codelineno-255-2" href="#__codelineno-255-2"></a><span class="p">{</span>
</span><span id="__span-255-3"><a id="__codelineno-255-3" name="__codelineno-255-3" href="#__codelineno-255-3"></a><span class="w"> </span><span class="n">Person</span><span class="w"> </span><span class="n">p2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">Person</span><span class="p">)</span><span class="w"> </span><span class="n">formatter</span><span class="p">.</span><span class="n">Deserialize</span><span class="w"> </span><span class="p">(</span><span class="n">s</span><span class="p">);</span>
</span><span id="__span-255-4"><a id="__codelineno-255-4" name="__codelineno-255-4" href="#__codelineno-255-4"></a><span class="w"> </span><span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="w"> </span><span class="p">(</span><span class="n">p2</span><span class="p">.</span><span class="n">Name</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s">&quot; &quot;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">p2</span><span class="p">.</span><span class="n">Age</span><span class="p">);</span><span class="w"> </span><span class="c1">// George 25</span>
</span><span id="__span-255-5"><a id="__codelineno-255-5" name="__codelineno-255-5" href="#__codelineno-255-5"></a><span class="p">}</span>
</span></code></pre></div>
<aside>
ðŸ‘‰ðŸ¿ The deserializer bypasses all constructors and field initializers when re-creating objects. Behind the scenes, it calls Formatter Services.GetUninitializedObject to do this job. You can call this method yourself to implement some very grubby design patterns!

</aside>

<p>The serialized data includes full type and assembly information, so if we try to cast the result of deserialization to a matching Person type in a different assembly, an error would result. The deserializer fully restores object references to their original state upon deserialization. This includes collections, which are just treated as serializable objects like any other</p>
<p>The binary engine can handle large, complex object graphs without special assistance (other than ensuring that all particiâ€ pating members are serializable). One thing to be wary of is that the serializerâ€™s performance degrades in proportion to the number of references in your object graph. This can become an issue in a Remoting server that has to process many conâ€ current requests.</p>
<h1 id="binary-serialization-attributes">Binary Serialization Attributes</h1>
<h2 id="nonserialized">[NonSerialized]</h2>
<p>By default, all fields are serialized. Fields that you donâ€™t want serialized, such as those used for temporary calculations or for storing file or window handles, you must mark explicitly with the [NonSerialized] attribute:</p>
<h2 id="ondeserializing">[OnDeserializing]</h2>
<p>A method marked with the [OnDeserializing] attribute fires just prior to deserialâ€ ization and acts as a kind of constructor. This can be important because the binary deserializer bypasses all your normal constructors as well as field initializers.</p>
<p>In the following example, we define a field called Valid, which we exclude from serialization with the [NonSerialized] attribute:</p>
<div class="language-csharp highlight"><pre><span></span><code><span id="__span-256-1"><a id="__codelineno-256-1" name="__codelineno-256-1" href="#__codelineno-256-1"></a><span class="k">public</span><span class="w"> </span><span class="k">sealed</span><span class="w"> </span><span class="k">class</span><span class="w"> </span><span class="nc">Person</span>
</span><span id="__span-256-2"><a id="__codelineno-256-2" name="__codelineno-256-2" href="#__codelineno-256-2"></a><span class="p">{</span>
</span><span id="__span-256-3"><a id="__codelineno-256-3" name="__codelineno-256-3" href="#__codelineno-256-3"></a><span class="w"> </span><span class="k">public</span><span class="w"> </span><span class="kt">string</span><span class="w"> </span><span class="n">Name</span><span class="p">;</span>
</span><span id="__span-256-4"><a id="__codelineno-256-4" name="__codelineno-256-4" href="#__codelineno-256-4"></a><span class="w"> </span><span class="na">[NonSerialized]</span><span class="w"> </span><span class="k">public</span><span class="w"> </span><span class="kt">bool</span><span class="w"> </span><span class="n">Valid</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">true</span><span class="p">;</span>
</span><span id="__span-256-5"><a id="__codelineno-256-5" name="__codelineno-256-5" href="#__codelineno-256-5"></a><span class="w"> </span><span class="k">public</span><span class="w"> </span><span class="nf">Person</span><span class="p">()</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="n">Valid</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">true</span><span class="p">;</span>
</span><span id="__span-256-6"><a id="__codelineno-256-6" name="__codelineno-256-6" href="#__codelineno-256-6"></a><span class="p">}</span>
</span></code></pre></div>
<p>A deserialized Person will never be Validâ€”despite the constructor and field initialâ€ izer both setting Valid to true. We can solve this by writing a special deserialization constructor as follows:</p>
<div class="language-csharp highlight"><pre><span></span><code><span id="__span-257-1"><a id="__codelineno-257-1" name="__codelineno-257-1" href="#__codelineno-257-1"></a><span class="na">[OnDeserializing]</span>
</span><span id="__span-257-2"><a id="__codelineno-257-2" name="__codelineno-257-2" href="#__codelineno-257-2"></a><span class="k">void</span><span class="w"> </span><span class="nf">OnDeserializing</span><span class="w"> </span><span class="p">(</span><span class="n">StreamingContext</span><span class="w"> </span><span class="n">context</span><span class="p">)</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="n">Valid</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">true</span><span class="p">;</span>
</span></code></pre></div>
<h2 id="ondeserialized">[OnDeserialized]</h2>
<p>A method marked with the [OnDeserialized] attribute fires just after deserializaâ€ tion. This can be useful for updating calculated fields, and in conjunction with [OnSerializing], which we look at next.</p>
<h2 id="onserializing-and-onserialized">[OnSerializing] and [OnSerialized]</h2>
<p>The [OnSerializing] and [OnSerialized] attributes mark methods for execution before or after serialization.[OnSerializing] is useful for populating a field thatâ€™s used only for serialization.</p>
<div class="language-csharp highlight"><pre><span></span><code><span id="__span-258-1"><a id="__codelineno-258-1" name="__codelineno-258-1" href="#__codelineno-258-1"></a><span class="k">class</span><span class="w"> </span><span class="nc">Foo</span>
</span><span id="__span-258-2"><a id="__codelineno-258-2" name="__codelineno-258-2" href="#__codelineno-258-2"></a><span class="p">{</span>
</span><span id="__span-258-3"><a id="__codelineno-258-3" name="__codelineno-258-3" href="#__codelineno-258-3"></a><span class="w"> </span><span class="k">public</span><span class="w"> </span><span class="n">XDocument</span><span class="w"> </span><span class="n">Xml</span><span class="p">;</span>
</span><span id="__span-258-4"><a id="__codelineno-258-4" name="__codelineno-258-4" href="#__codelineno-258-4"></a><span class="p">}</span>
</span></code></pre></div>
<p>The difficulty is that XDocument (in the System.Xml.Linq namespace) is not itself serializable. We can solve this by applying the [NonSerialized] attribute to the Xml field and then defining an [OnSerializing] method that writes the content of the XDocument to a string field (that we do serialize):</p>
<div class="language-csharp highlight"><pre><span></span><code><span id="__span-259-1"><a id="__codelineno-259-1" name="__codelineno-259-1" href="#__codelineno-259-1"></a><span class="na">[Serializable]</span>
</span><span id="__span-259-2"><a id="__codelineno-259-2" name="__codelineno-259-2" href="#__codelineno-259-2"></a><span class="k">class</span><span class="w"> </span><span class="nc">Foo</span>
</span><span id="__span-259-3"><a id="__codelineno-259-3" name="__codelineno-259-3" href="#__codelineno-259-3"></a><span class="p">{</span>
</span><span id="__span-259-4"><a id="__codelineno-259-4" name="__codelineno-259-4" href="#__codelineno-259-4"></a><span class="w"> </span><span class="na">[NonSerialized]</span>
</span><span id="__span-259-5"><a id="__codelineno-259-5" name="__codelineno-259-5" href="#__codelineno-259-5"></a><span class="w"> </span><span class="k">public</span><span class="w"> </span><span class="n">XDocument</span><span class="w"> </span><span class="n">Xml</span><span class="p">;</span>
</span><span id="__span-259-6"><a id="__codelineno-259-6" name="__codelineno-259-6" href="#__codelineno-259-6"></a><span class="w"> </span><span class="kt">string</span><span class="w"> </span><span class="n">_xmlString</span><span class="p">;</span><span class="w"> </span><span class="c1">// used only for serialization</span>
</span><span id="__span-259-7"><a id="__codelineno-259-7" name="__codelineno-259-7" href="#__codelineno-259-7"></a><span class="w"> </span><span class="na">[OnSerializing]</span>
</span><span id="__span-259-8"><a id="__codelineno-259-8" name="__codelineno-259-8" href="#__codelineno-259-8"></a><span class="w"> </span><span class="k">void</span><span class="w"> </span><span class="nf">OnSerializing</span><span class="w"> </span><span class="p">(</span><span class="n">StreamingContext</span><span class="w"> </span><span class="n">context</span><span class="p">)</span>
</span><span id="__span-259-9"><a id="__codelineno-259-9" name="__codelineno-259-9" href="#__codelineno-259-9"></a><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="n">_xmlString</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Xml</span><span class="p">.</span><span class="n">ToString</span><span class="p">();</span>
</span><span id="__span-259-10"><a id="__codelineno-259-10" name="__codelineno-259-10" href="#__codelineno-259-10"></a><span class="p">}</span>
</span></code></pre></div>
<p>The final step is to reconstruct the XDocument when deserializating. We can do this by adding an [OnDeserialized] method:</p>
<div class="language-csharp highlight"><pre><span></span><code><span id="__span-260-1"><a id="__codelineno-260-1" name="__codelineno-260-1" href="#__codelineno-260-1"></a><span class="na">[OnDeserialized]</span>
</span><span id="__span-260-2"><a id="__codelineno-260-2" name="__codelineno-260-2" href="#__codelineno-260-2"></a><span class="w"> </span><span class="k">void</span><span class="w"> </span><span class="nf">OnDeserialized</span><span class="w"> </span><span class="p">(</span><span class="n">StreamingContext</span><span class="w"> </span><span class="n">context</span><span class="p">)</span>
</span><span id="__span-260-3"><a id="__codelineno-260-3" name="__codelineno-260-3" href="#__codelineno-260-3"></a><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="n">Xml</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">XDocument</span><span class="p">.</span><span class="n">Parse</span><span class="w"> </span><span class="p">(</span><span class="n">_xmlString</span><span class="p">);</span>
</span></code></pre></div>
<h2 id="optionalfield-and-versioning">[OptionalField] and Versioning</h2>
<p>Adding or removing fields doesnâ€™t break compatibility with already serialized data: the deserializer skips over data for which thereâ€™s no matching field. When adding a field, you can apply the following attribute to remind yourself that it might be absent from data serialized by an older version of the software:</p>
<div class="language-csharp highlight"><pre><span></span><code><span id="__span-261-1"><a id="__codelineno-261-1" name="__codelineno-261-1" href="#__codelineno-261-1"></a><span class="na">[Serializable]</span><span class="w"> </span><span class="k">public</span><span class="w"> </span><span class="k">sealed</span><span class="w"> </span><span class="k">class</span><span class="w"> </span><span class="nc">Person</span>
</span><span id="__span-261-2"><a id="__codelineno-261-2" name="__codelineno-261-2" href="#__codelineno-261-2"></a><span class="p">{</span>
</span><span id="__span-261-3"><a id="__codelineno-261-3" name="__codelineno-261-3" href="#__codelineno-261-3"></a><span class="w"> </span><span class="k">public</span><span class="w"> </span><span class="kt">string</span><span class="w"> </span><span class="n">Name</span><span class="p">;</span>
</span><span id="__span-261-4"><a id="__codelineno-261-4" name="__codelineno-261-4" href="#__codelineno-261-4"></a><span class="w"> </span><span class="na">[OptionalField (VersionAdded = 2)]</span><span class="w"> </span><span class="k">public</span><span class="w"> </span><span class="n">DateTime</span><span class="w"> </span><span class="n">DateOfBirth</span><span class="p">;</span>
</span><span id="__span-261-5"><a id="__codelineno-261-5" name="__codelineno-261-5" href="#__codelineno-261-5"></a><span class="p">}</span>
</span></code></pre></div>
<h1 id="binary-serialization-with-iserializable">Binary Serialization with ISerializable</h1>
<p>Implementing ISerializable gives a type complete control over its binary serialization and deserialization.</p>
<div class="language-csharp highlight"><pre><span></span><code><span id="__span-262-1"><a id="__codelineno-262-1" name="__codelineno-262-1" href="#__codelineno-262-1"></a><span class="c1">//Hereâ€™s the ISerializable interface definition:</span>
</span><span id="__span-262-2"><a id="__codelineno-262-2" name="__codelineno-262-2" href="#__codelineno-262-2"></a><span class="k">public</span><span class="w"> </span><span class="k">interface</span><span class="w"> </span><span class="n">ISerializable</span>
</span><span id="__span-262-3"><a id="__codelineno-262-3" name="__codelineno-262-3" href="#__codelineno-262-3"></a><span class="p">{</span>
</span><span id="__span-262-4"><a id="__codelineno-262-4" name="__codelineno-262-4" href="#__codelineno-262-4"></a><span class="w"> </span><span class="k">void</span><span class="w"> </span><span class="nf">GetObjectData</span><span class="w"> </span><span class="p">(</span><span class="n">SerializationInfo</span><span class="w"> </span><span class="n">info</span><span class="p">,</span><span class="w"> </span><span class="n">StreamingContext</span><span class="w"> </span><span class="n">context</span><span class="p">);</span>
</span><span id="__span-262-5"><a id="__codelineno-262-5" name="__codelineno-262-5" href="#__codelineno-262-5"></a><span class="p">}</span>
</span></code></pre></div>
<p>GetObjectData fires upon serialization; its job is to populate the Serialization Info object (a name-value dictionary) with data from all fields that you want serialâ€ ized. Hereâ€™s how we would write a GetObjectData method that serializes two fields, called Name and DateOfBirth:</p>
<div class="language-csharp highlight"><pre><span></span><code><span id="__span-263-1"><a id="__codelineno-263-1" name="__codelineno-263-1" href="#__codelineno-263-1"></a><span class="k">public</span><span class="w"> </span><span class="k">virtual</span><span class="w"> </span><span class="k">void</span><span class="w"> </span><span class="nf">GetObjectData</span><span class="w"> </span><span class="p">(</span><span class="n">SerializationInfo</span><span class="w"> </span><span class="n">info</span><span class="p">,</span>
</span><span id="__span-263-2"><a id="__codelineno-263-2" name="__codelineno-263-2" href="#__codelineno-263-2"></a><span class="w"> </span><span class="n">StreamingContext</span><span class="w"> </span><span class="n">context</span><span class="p">)</span>
</span><span id="__span-263-3"><a id="__codelineno-263-3" name="__codelineno-263-3" href="#__codelineno-263-3"></a><span class="w"> </span><span class="p">{</span>
</span><span id="__span-263-4"><a id="__codelineno-263-4" name="__codelineno-263-4" href="#__codelineno-263-4"></a><span class="w"> </span><span class="n">info</span><span class="p">.</span><span class="n">AddValue</span><span class="w"> </span><span class="p">(</span><span class="s">&quot;Name&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">Name</span><span class="p">);</span>
</span><span id="__span-263-5"><a id="__codelineno-263-5" name="__codelineno-263-5" href="#__codelineno-263-5"></a><span class="w"> </span><span class="n">info</span><span class="p">.</span><span class="n">AddValue</span><span class="w"> </span><span class="p">(</span><span class="s">&quot;DateOfBirth&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">DateOfBirth</span><span class="p">);</span>
</span><span id="__span-263-6"><a id="__codelineno-263-6" name="__codelineno-263-6" href="#__codelineno-263-6"></a><span class="w"> </span><span class="p">}</span>
</span></code></pre></div>
<p>In the following example, we define Player and Team classes, following the principles of immutability (with everything read-only). But because the immutable collections are not serializable, we need to take control over the serialization process by implementing ISerializable:</p>
<div class="language-csharp highlight"><pre><span></span><code><span id="__span-264-1"><a id="__codelineno-264-1" name="__codelineno-264-1" href="#__codelineno-264-1"></a><span class="na">[Serializable]</span><span class="w"> </span><span class="k">public</span><span class="w"> </span><span class="k">class</span><span class="w"> </span><span class="nc">Player</span>
</span><span id="__span-264-2"><a id="__codelineno-264-2" name="__codelineno-264-2" href="#__codelineno-264-2"></a><span class="p">{</span>
</span><span id="__span-264-3"><a id="__codelineno-264-3" name="__codelineno-264-3" href="#__codelineno-264-3"></a><span class="w"> </span><span class="k">public</span><span class="w"> </span><span class="k">readonly</span><span class="w"> </span><span class="kt">string</span><span class="w"> </span><span class="n">Name</span><span class="p">;</span>
</span><span id="__span-264-4"><a id="__codelineno-264-4" name="__codelineno-264-4" href="#__codelineno-264-4"></a><span class="w"> </span><span class="k">public</span><span class="w"> </span><span class="nf">Player</span><span class="w"> </span><span class="p">(</span><span class="kt">string</span><span class="w"> </span><span class="n">name</span><span class="p">)</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="n">Name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">name</span><span class="p">;</span>
</span><span id="__span-264-5"><a id="__codelineno-264-5" name="__codelineno-264-5" href="#__codelineno-264-5"></a><span class="p">}</span>
</span><span id="__span-264-6"><a id="__codelineno-264-6" name="__codelineno-264-6" href="#__codelineno-264-6"></a><span class="na">[Serializable]</span><span class="w"> </span><span class="k">public</span><span class="w"> </span><span class="k">class</span><span class="w"> </span><span class="nc">Team</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="n">ISerializable</span>
</span><span id="__span-264-7"><a id="__codelineno-264-7" name="__codelineno-264-7" href="#__codelineno-264-7"></a><span class="p">{</span>
</span><span id="__span-264-8"><a id="__codelineno-264-8" name="__codelineno-264-8" href="#__codelineno-264-8"></a><span class="w"> </span><span class="k">public</span><span class="w"> </span><span class="k">readonly</span><span class="w"> </span><span class="kt">string</span><span class="w"> </span><span class="n">Name</span><span class="p">;</span>
</span><span id="__span-264-9"><a id="__codelineno-264-9" name="__codelineno-264-9" href="#__codelineno-264-9"></a><span class="w"> </span><span class="k">public</span><span class="w"> </span><span class="k">readonly</span><span class="w"> </span><span class="n">ImmutableList</span><span class="o">&lt;</span><span class="n">Player</span><span class="o">&gt;</span><span class="w"> </span><span class="n">Players</span><span class="p">;</span><span class="w"> </span><span class="c1">// Not serializable!</span>
</span><span id="__span-264-10"><a id="__codelineno-264-10" name="__codelineno-264-10" href="#__codelineno-264-10"></a><span class="w"> </span><span class="k">public</span><span class="w"> </span><span class="nf">Team</span><span class="w"> </span><span class="p">(</span><span class="kt">string</span><span class="w"> </span><span class="n">name</span><span class="p">,</span><span class="w"> </span><span class="k">params</span><span class="w"> </span><span class="n">Player</span><span class="p">[]</span><span class="w"> </span><span class="n">players</span><span class="p">)</span>
</span><span id="__span-264-11"><a id="__codelineno-264-11" name="__codelineno-264-11" href="#__codelineno-264-11"></a><span class="w"> </span><span class="p">{</span>
</span><span id="__span-264-12"><a id="__codelineno-264-12" name="__codelineno-264-12" href="#__codelineno-264-12"></a><span class="w"> </span><span class="n">Name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">name</span><span class="p">;</span>
</span><span id="__span-264-13"><a id="__codelineno-264-13" name="__codelineno-264-13" href="#__codelineno-264-13"></a><span class="w"> </span><span class="n">Players</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">players</span><span class="p">.</span><span class="n">ToImmutableList</span><span class="p">();</span>
</span><span id="__span-264-14"><a id="__codelineno-264-14" name="__codelineno-264-14" href="#__codelineno-264-14"></a><span class="w"> </span><span class="p">}</span>
</span><span id="__span-264-15"><a id="__codelineno-264-15" name="__codelineno-264-15" href="#__codelineno-264-15"></a><span class="w"> </span><span class="c1">// Serialize the object:</span>
</span><span id="__span-264-16"><a id="__codelineno-264-16" name="__codelineno-264-16" href="#__codelineno-264-16"></a><span class="w"> </span><span class="k">public</span><span class="w"> </span><span class="k">virtual</span><span class="w"> </span><span class="k">void</span><span class="w"> </span><span class="nf">GetObjectData</span><span class="w"> </span><span class="p">(</span><span class="n">SerializationInfo</span><span class="w"> </span><span class="n">si</span><span class="p">,</span>
</span><span id="__span-264-17"><a id="__codelineno-264-17" name="__codelineno-264-17" href="#__codelineno-264-17"></a><span class="w"> </span><span class="n">StreamingContext</span><span class="w"> </span><span class="n">sc</span><span class="p">)</span>
</span><span id="__span-264-18"><a id="__codelineno-264-18" name="__codelineno-264-18" href="#__codelineno-264-18"></a><span class="w"> </span><span class="p">{</span>
</span><span id="__span-264-19"><a id="__codelineno-264-19" name="__codelineno-264-19" href="#__codelineno-264-19"></a><span class="w"> </span><span class="n">si</span><span class="p">.</span><span class="n">AddValue</span><span class="w"> </span><span class="p">(</span><span class="s">&quot;Name&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">Name</span><span class="p">);</span>
</span><span id="__span-264-20"><a id="__codelineno-264-20" name="__codelineno-264-20" href="#__codelineno-264-20"></a><span class="w"> </span><span class="c1">// Convert Players to an ordinary serializable array:</span>
</span><span id="__span-264-21"><a id="__codelineno-264-21" name="__codelineno-264-21" href="#__codelineno-264-21"></a><span class="w"> </span><span class="n">si</span><span class="p">.</span><span class="n">AddValue</span><span class="w"> </span><span class="p">(</span><span class="s">&quot;PlayerData&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">Players</span><span class="p">.</span><span class="n">ToArray</span><span class="p">());</span>
</span><span id="__span-264-22"><a id="__codelineno-264-22" name="__codelineno-264-22" href="#__codelineno-264-22"></a><span class="w"> </span><span class="p">}</span>
</span><span id="__span-264-23"><a id="__codelineno-264-23" name="__codelineno-264-23" href="#__codelineno-264-23"></a><span class="w"> </span><span class="c1">// Deserialize the object:</span>
</span><span id="__span-264-24"><a id="__codelineno-264-24" name="__codelineno-264-24" href="#__codelineno-264-24"></a><span class="w"> </span><span class="k">protected</span><span class="w"> </span><span class="nf">Team</span><span class="w"> </span><span class="p">(</span><span class="n">SerializationInfo</span><span class="w"> </span><span class="n">si</span><span class="p">,</span><span class="w"> </span><span class="n">StreamingContext</span><span class="w"> </span><span class="n">sc</span><span class="p">)</span>
</span><span id="__span-264-25"><a id="__codelineno-264-25" name="__codelineno-264-25" href="#__codelineno-264-25"></a><span class="w"> </span><span class="p">{</span>
</span><span id="__span-264-26"><a id="__codelineno-264-26" name="__codelineno-264-26" href="#__codelineno-264-26"></a><span class="w"> </span><span class="n">Name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">si</span><span class="p">.</span><span class="n">GetString</span><span class="w"> </span><span class="p">(</span><span class="s">&quot;Name&quot;</span><span class="p">);</span>
</span><span id="__span-264-27"><a id="__codelineno-264-27" name="__codelineno-264-27" href="#__codelineno-264-27"></a><span class="w"> </span><span class="c1">// Deserialize Players to an array to match our serialization:</span>
</span><span id="__span-264-28"><a id="__codelineno-264-28" name="__codelineno-264-28" href="#__codelineno-264-28"></a><span class="w"> </span><span class="n">Player</span><span class="p">[]</span><span class="w"> </span><span class="n">p</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">Player</span><span class="p">[])</span><span class="w"> </span><span class="n">si</span><span class="p">.</span><span class="n">GetValue</span><span class="w"> </span><span class="p">(</span><span class="s">&quot;PlayerData&quot;</span><span class="p">,</span><span class="w"> </span><span class="k">typeof</span><span class="w"> </span><span class="p">(</span><span class="n">Player</span><span class="p">[]));</span>
</span><span id="__span-264-29"><a id="__codelineno-264-29" name="__codelineno-264-29" href="#__codelineno-264-29"></a><span class="w"> </span><span class="c1">// Construct a new immutable List using this array:</span>
</span><span id="__span-264-30"><a id="__codelineno-264-30" name="__codelineno-264-30" href="#__codelineno-264-30"></a><span class="n">Players</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">p</span><span class="p">.</span><span class="n">ToImmutableList</span><span class="p">();</span>
</span><span id="__span-264-31"><a id="__codelineno-264-31" name="__codelineno-264-31" href="#__codelineno-264-31"></a><span class="w"> </span><span class="p">}</span>
</span><span id="__span-264-32"><a id="__codelineno-264-32" name="__codelineno-264-32" href="#__codelineno-264-32"></a><span class="p">}</span>
</span></code></pre></div>
<h2 id="subclassing-serializable-classes">Subclassing Serializable Classes</h2>
<div class="language-csharp highlight"><pre><span></span><code><span id="__span-265-1"><a id="__codelineno-265-1" name="__codelineno-265-1" href="#__codelineno-265-1"></a><span class="na">[Serializable]</span><span class="w"> </span><span class="k">public</span><span class="w"> </span><span class="k">class</span><span class="w"> </span><span class="nc">Person</span>
</span><span id="__span-265-2"><a id="__codelineno-265-2" name="__codelineno-265-2" href="#__codelineno-265-2"></a><span class="p">{</span>
</span><span id="__span-265-3"><a id="__codelineno-265-3" name="__codelineno-265-3" href="#__codelineno-265-3"></a><span class="w"> </span><span class="k">public</span><span class="w"> </span><span class="kt">string</span><span class="w"> </span><span class="n">Name</span><span class="p">;</span>
</span><span id="__span-265-4"><a id="__codelineno-265-4" name="__codelineno-265-4" href="#__codelineno-265-4"></a><span class="w"> </span><span class="k">public</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">Age</span><span class="p">;</span>
</span><span id="__span-265-5"><a id="__codelineno-265-5" name="__codelineno-265-5" href="#__codelineno-265-5"></a><span class="p">}</span>
</span><span id="__span-265-6"><a id="__codelineno-265-6" name="__codelineno-265-6" href="#__codelineno-265-6"></a><span class="na">[Serializable]</span><span class="w"> </span><span class="k">public</span><span class="w"> </span><span class="k">sealed</span><span class="w"> </span><span class="k">class</span><span class="w"> </span><span class="nc">Student</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="n">Person</span>
</span><span id="__span-265-7"><a id="__codelineno-265-7" name="__codelineno-265-7" href="#__codelineno-265-7"></a><span class="p">{</span>
</span><span id="__span-265-8"><a id="__codelineno-265-8" name="__codelineno-265-8" href="#__codelineno-265-8"></a><span class="w"> </span><span class="k">public</span><span class="w"> </span><span class="kt">string</span><span class="w"> </span><span class="n">Course</span><span class="p">;</span>
</span><span id="__span-265-9"><a id="__codelineno-265-9" name="__codelineno-265-9" href="#__codelineno-265-9"></a><span class="p">}</span>
</span></code></pre></div>
<p>In this example, both Person and Student are serializable, and both classes use the default runtime serialization behavior because neither class implements ISerializable. Now imagine that the developer of Person decides for some reason to implement ISerializable and provide a deserialization constructor to control Person serialiâ€ zation. The new version of Person might look like this:</p>
<div class="language-csharp highlight"><pre><span></span><code><span id="__span-266-1"><a id="__codelineno-266-1" name="__codelineno-266-1" href="#__codelineno-266-1"></a><span class="na">[Serializable]</span><span class="w"> </span><span class="k">public</span><span class="w"> </span><span class="k">class</span><span class="w"> </span><span class="nc">Person</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="n">ISerializable</span>
</span><span id="__span-266-2"><a id="__codelineno-266-2" name="__codelineno-266-2" href="#__codelineno-266-2"></a><span class="p">{</span>
</span><span id="__span-266-3"><a id="__codelineno-266-3" name="__codelineno-266-3" href="#__codelineno-266-3"></a><span class="w"> </span><span class="k">public</span><span class="w"> </span><span class="kt">string</span><span class="w"> </span><span class="n">Name</span><span class="p">;</span>
</span><span id="__span-266-4"><a id="__codelineno-266-4" name="__codelineno-266-4" href="#__codelineno-266-4"></a><span class="w"> </span><span class="k">public</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">Age</span><span class="p">;</span>
</span><span id="__span-266-5"><a id="__codelineno-266-5" name="__codelineno-266-5" href="#__codelineno-266-5"></a><span class="w"> </span><span class="k">public</span><span class="w"> </span><span class="k">virtual</span><span class="w"> </span><span class="k">void</span><span class="w"> </span><span class="nf">GetObjectData</span><span class="w"> </span><span class="p">(</span><span class="n">SerializationInfo</span><span class="w"> </span><span class="n">si</span><span class="p">,</span>
</span><span id="__span-266-6"><a id="__codelineno-266-6" name="__codelineno-266-6" href="#__codelineno-266-6"></a><span class="w"> </span><span class="n">StreamingContext</span><span class="w"> </span><span class="n">sc</span><span class="p">)</span>
</span><span id="__span-266-7"><a id="__codelineno-266-7" name="__codelineno-266-7" href="#__codelineno-266-7"></a><span class="w"> </span><span class="p">{</span>
</span><span id="__span-266-8"><a id="__codelineno-266-8" name="__codelineno-266-8" href="#__codelineno-266-8"></a><span class="w"> </span><span class="n">si</span><span class="p">.</span><span class="n">AddValue</span><span class="w"> </span><span class="p">(</span><span class="s">&quot;Name&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">Name</span><span class="p">);</span>
</span><span id="__span-266-9"><a id="__codelineno-266-9" name="__codelineno-266-9" href="#__codelineno-266-9"></a><span class="w"> </span><span class="n">si</span><span class="p">.</span><span class="n">AddValue</span><span class="w"> </span><span class="p">(</span><span class="s">&quot;Age&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">Age</span><span class="p">);</span>
</span><span id="__span-266-10"><a id="__codelineno-266-10" name="__codelineno-266-10" href="#__codelineno-266-10"></a><span class="w"> </span><span class="p">}</span>
</span><span id="__span-266-11"><a id="__codelineno-266-11" name="__codelineno-266-11" href="#__codelineno-266-11"></a><span class="w"> </span><span class="k">protected</span><span class="w"> </span><span class="nf">Person</span><span class="w"> </span><span class="p">(</span><span class="n">SerializationInfo</span><span class="w"> </span><span class="n">si</span><span class="p">,</span><span class="w"> </span><span class="n">StreamingContext</span><span class="w"> </span><span class="n">sc</span><span class="p">)</span>
</span><span id="__span-266-12"><a id="__codelineno-266-12" name="__codelineno-266-12" href="#__codelineno-266-12"></a><span class="w"> </span><span class="p">{</span>
</span><span id="__span-266-13"><a id="__codelineno-266-13" name="__codelineno-266-13" href="#__codelineno-266-13"></a><span class="w"> </span><span class="n">Name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">si</span><span class="p">.</span><span class="n">GetString</span><span class="w"> </span><span class="p">(</span><span class="s">&quot;Name&quot;</span><span class="p">);</span>
</span><span id="__span-266-14"><a id="__codelineno-266-14" name="__codelineno-266-14" href="#__codelineno-266-14"></a><span class="w"> </span><span class="n">Age</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">si</span><span class="p">.</span><span class="n">GetInt32</span><span class="w"> </span><span class="p">(</span><span class="s">&quot;Age&quot;</span><span class="p">);</span>
</span><span id="__span-266-15"><a id="__codelineno-266-15" name="__codelineno-266-15" href="#__codelineno-266-15"></a><span class="w"> </span><span class="p">}</span>
</span><span id="__span-266-16"><a id="__codelineno-266-16" name="__codelineno-266-16" href="#__codelineno-266-16"></a><span class="w"> </span><span class="k">public</span><span class="w"> </span><span class="nf">Person</span><span class="p">()</span><span class="w"> </span><span class="p">{}</span>
</span><span id="__span-266-17"><a id="__codelineno-266-17" name="__codelineno-266-17" href="#__codelineno-266-17"></a><span class="p">}</span>
</span></code></pre></div>
<p>Although this works for instances of Person, this change breaks serialization of Student instances. Serializing a Student instance would appear to succeed, but the Course field in the Student type isnâ€™t saved to the stream because the implementation of ISerializable.GetObjectData on Person has no knowledge of the members of the Student-derived type. Additionally, deserialization of Student instances throws an exception because the runtime is looking (unsuccessfully) for a deserialization constructor on Student.</p>
<p>The solution to this problem is to implement ISerializable from the outset for serializable classes that are public and nonsealed. (With internal classes, itâ€™s not so important because you can easily modify the subclasses later if required.)</p>
<div class="language-csharp highlight"><pre><span></span><code><span id="__span-267-1"><a id="__codelineno-267-1" name="__codelineno-267-1" href="#__codelineno-267-1"></a><span class="na">[Serializable]</span>
</span><span id="__span-267-2"><a id="__codelineno-267-2" name="__codelineno-267-2" href="#__codelineno-267-2"></a><span class="k">public</span><span class="w"> </span><span class="k">class</span><span class="w"> </span><span class="nc">Student</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="n">Person</span>
</span><span id="__span-267-3"><a id="__codelineno-267-3" name="__codelineno-267-3" href="#__codelineno-267-3"></a><span class="p">{</span>
</span><span id="__span-267-4"><a id="__codelineno-267-4" name="__codelineno-267-4" href="#__codelineno-267-4"></a><span class="w"> </span><span class="k">public</span><span class="w"> </span><span class="kt">string</span><span class="w"> </span><span class="n">Course</span><span class="p">;</span>
</span><span id="__span-267-5"><a id="__codelineno-267-5" name="__codelineno-267-5" href="#__codelineno-267-5"></a><span class="w"> </span><span class="k">public</span><span class="w"> </span><span class="k">override</span><span class="w"> </span><span class="k">void</span><span class="w"> </span><span class="nf">GetObjectData</span><span class="w"> </span><span class="p">(</span><span class="n">SerializationInfo</span><span class="w"> </span><span class="n">si</span><span class="p">,</span>
</span><span id="__span-267-6"><a id="__codelineno-267-6" name="__codelineno-267-6" href="#__codelineno-267-6"></a><span class="w"> </span><span class="n">StreamingContext</span><span class="w"> </span><span class="n">sc</span><span class="p">)</span>
</span><span id="__span-267-7"><a id="__codelineno-267-7" name="__codelineno-267-7" href="#__codelineno-267-7"></a><span class="w"> </span><span class="p">{</span>
</span><span id="__span-267-8"><a id="__codelineno-267-8" name="__codelineno-267-8" href="#__codelineno-267-8"></a><span class="w"> </span><span class="k">base</span><span class="p">.</span><span class="n">GetObjectData</span><span class="w"> </span><span class="p">(</span><span class="n">si</span><span class="p">,</span><span class="w"> </span><span class="n">sc</span><span class="p">);</span>
</span><span id="__span-267-9"><a id="__codelineno-267-9" name="__codelineno-267-9" href="#__codelineno-267-9"></a><span class="n">si</span><span class="p">.</span><span class="n">AddValue</span><span class="w"> </span><span class="p">(</span><span class="s">&quot;Course&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">Course</span><span class="p">);</span>
</span><span id="__span-267-10"><a id="__codelineno-267-10" name="__codelineno-267-10" href="#__codelineno-267-10"></a><span class="w"> </span><span class="p">}</span>
</span><span id="__span-267-11"><a id="__codelineno-267-11" name="__codelineno-267-11" href="#__codelineno-267-11"></a><span class="w"> </span><span class="k">protected</span><span class="w"> </span><span class="nf">Student</span><span class="w"> </span><span class="p">(</span><span class="n">SerializationInfo</span><span class="w"> </span><span class="n">si</span><span class="p">,</span><span class="w"> </span><span class="n">StreamingContext</span><span class="w"> </span><span class="n">sc</span><span class="p">)</span>
</span><span id="__span-267-12"><a id="__codelineno-267-12" name="__codelineno-267-12" href="#__codelineno-267-12"></a><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="k">base</span><span class="w"> </span><span class="p">(</span><span class="n">si</span><span class="p">,</span><span class="w"> </span><span class="n">sc</span><span class="p">)</span>
</span><span id="__span-267-13"><a id="__codelineno-267-13" name="__codelineno-267-13" href="#__codelineno-267-13"></a><span class="w"> </span><span class="p">{</span>
</span><span id="__span-267-14"><a id="__codelineno-267-14" name="__codelineno-267-14" href="#__codelineno-267-14"></a><span class="w"> </span><span class="n">Course</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">si</span><span class="p">.</span><span class="n">GetString</span><span class="w"> </span><span class="p">(</span><span class="s">&quot;Course&quot;</span><span class="p">);</span>
</span><span id="__span-267-15"><a id="__codelineno-267-15" name="__codelineno-267-15" href="#__codelineno-267-15"></a><span class="w"> </span><span class="p">}</span>
</span><span id="__span-267-16"><a id="__codelineno-267-16" name="__codelineno-267-16" href="#__codelineno-267-16"></a><span class="w"> </span><span class="k">public</span><span class="w"> </span><span class="nf">Student</span><span class="p">()</span><span class="w"> </span><span class="p">{}</span>
</span><span id="__span-267-17"><a id="__codelineno-267-17" name="__codelineno-267-17" href="#__codelineno-267-17"></a><span class="p">}</span>
</span><span id="__span-267-18"><a id="__codelineno-267-18" name="__codelineno-267-18" href="#__codelineno-267-18"></a><span class="err">```#</span><span class="w"> </span><span class="n">Chapter</span><span class="w"> </span><span class="mi">18</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="n">Assemblies</span>
</span><span id="__span-267-19"><a id="__codelineno-267-19" name="__codelineno-267-19" href="#__codelineno-267-19"></a>
</span><span id="__span-267-20"><a id="__codelineno-267-20" name="__codelineno-267-20" href="#__codelineno-267-20"></a><span class="n">An</span><span class="w"> </span><span class="n">assembly</span><span class="w"> </span><span class="k">is</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">basic</span><span class="w"> </span><span class="n">unit</span><span class="w"> </span><span class="n">of</span><span class="w"> </span><span class="n">deployment</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="p">.</span><span class="n">NET</span><span class="w"> </span><span class="n">Core</span><span class="w"> </span><span class="k">and</span><span class="w"> </span><span class="k">is</span><span class="w"> </span><span class="n">also</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">container</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">all</span><span class="w"> </span><span class="n">types</span><span class="p">.</span><span class="w"> </span><span class="n">An</span><span class="w"> </span><span class="n">assembly</span><span class="w"> </span><span class="n">contains</span><span class="w"> </span><span class="n">compiled</span><span class="w"> </span><span class="n">types</span><span class="w"> </span><span class="k">with</span><span class="w"> </span><span class="n">their</span><span class="w"> </span><span class="n">IL</span><span class="w"> </span><span class="n">code</span><span class="p">,</span><span class="w"> </span><span class="n">runtime</span><span class="w"> </span><span class="n">resources</span><span class="p">,</span><span class="w"> </span><span class="k">and</span><span class="w"> </span><span class="n">information</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">assist</span><span class="w"> </span><span class="k">with</span><span class="w"> </span><span class="n">versioning</span><span class="w"> </span><span class="k">and</span><span class="w"> </span><span class="n">referencing</span><span class="w"> </span><span class="n">other</span><span class="w"> </span><span class="n">assemblies</span><span class="p">.</span><span class="w"> </span><span class="n">An</span><span class="w"> </span><span class="n">assembly</span><span class="w"> </span><span class="n">also</span><span class="w"> </span><span class="n">defines</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">boundary</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">type</span><span class="w"> </span><span class="n">resolution</span><span class="p">.</span><span class="w"> </span><span class="n">In</span><span class="w"> </span><span class="p">.</span><span class="n">NET</span><span class="w"> </span><span class="n">Core</span><span class="p">,</span><span class="w"> </span><span class="n">an</span><span class="w"> </span><span class="n">assembly</span><span class="w"> </span><span class="n">comprises</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">single</span><span class="w"> </span><span class="n">file</span><span class="w"> </span><span class="k">with</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="p">.</span><span class="n">dll</span><span class="w"> </span><span class="n">extension</span><span class="p">.</span>
</span><span id="__span-267-21"><a id="__codelineno-267-21" name="__codelineno-267-21" href="#__codelineno-267-21"></a>
</span><span id="__span-267-22"><a id="__codelineno-267-22" name="__codelineno-267-22" href="#__codelineno-267-22"></a><span class="n">When</span><span class="w"> </span><span class="n">you</span><span class="w"> </span><span class="n">build</span><span class="w"> </span><span class="n">an</span><span class="w"> </span><span class="n">executable</span><span class="w"> </span><span class="n">application</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="p">.</span><span class="n">NET</span><span class="w"> </span><span class="n">Core</span><span class="p">,</span><span class="w"> </span><span class="n">you</span><span class="w"> </span><span class="n">end</span><span class="w"> </span><span class="n">up</span><span class="w"> </span><span class="k">with</span><span class="w"> </span><span class="n">two</span><span class="w"> </span><span class="n">files</span><span class="p">:</span><span class="w"> </span><span class="n">an</span><span class="w"> </span><span class="n">assembly</span><span class="w"> </span><span class="p">(.</span><span class="n">dll</span><span class="p">)</span><span class="w"> </span><span class="k">and</span><span class="w"> </span><span class="n">an</span><span class="w"> </span><span class="n">executable</span><span class="w"> </span><span class="n">launcher</span><span class="w"> </span><span class="p">(.</span><span class="n">exe</span><span class="p">)</span><span class="w"> </span><span class="n">appropriate</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">platform</span><span class="w"> </span><span class="n">you</span><span class="err">â€™</span><span class="n">re</span><span class="w"> </span><span class="n">targeting</span><span class="p">.</span><span class="w"> </span>
</span><span id="__span-267-23"><a id="__codelineno-267-23" name="__codelineno-267-23" href="#__codelineno-267-23"></a>
</span><span id="__span-267-24"><a id="__codelineno-267-24" name="__codelineno-267-24" href="#__codelineno-267-24"></a><span class="n">This</span><span class="w"> </span><span class="n">differs</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">what</span><span class="w"> </span><span class="n">happens</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="p">.</span><span class="n">NET</span><span class="w"> </span><span class="n">Framework</span><span class="p">,</span><span class="w"> </span><span class="n">which</span><span class="w"> </span><span class="n">generates</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">portable</span><span class="w"> </span><span class="n">executable</span><span class="w"> </span><span class="p">(</span><span class="n">PE</span><span class="p">)</span><span class="w"> </span><span class="n">assembly</span><span class="p">.</span><span class="w"> </span><span class="n">A</span><span class="w"> </span><span class="n">PE</span><span class="w"> </span><span class="n">has</span><span class="w"> </span><span class="n">an</span><span class="w"> </span><span class="p">.</span><span class="n">exe</span><span class="w"> </span><span class="n">extension</span><span class="w"> </span><span class="k">and</span><span class="w"> </span><span class="n">acts</span><span class="w"> </span><span class="n">both</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">an</span><span class="w"> </span><span class="n">assembly</span><span class="w"> </span><span class="k">and</span><span class="w"> </span><span class="n">an</span><span class="w"> </span><span class="n">application</span><span class="w"> </span><span class="n">launcher</span><span class="p">.</span><span class="w"> </span><span class="n">A</span><span class="w"> </span><span class="n">PE</span><span class="w"> </span><span class="n">can</span><span class="w"> </span><span class="n">simultaneously</span><span class="w"> </span><span class="n">target</span><span class="w"> </span><span class="mi">32</span><span class="o">-</span><span class="w"> </span><span class="k">and</span><span class="w"> </span><span class="mi">64</span><span class="o">-</span><span class="n">bit</span><span class="w"> </span><span class="n">versions</span><span class="w"> </span><span class="n">of</span><span class="w"> </span><span class="n">Windows</span><span class="p">.</span>
</span><span id="__span-267-25"><a id="__codelineno-267-25" name="__codelineno-267-25" href="#__codelineno-267-25"></a>
</span><span id="__span-267-26"><a id="__codelineno-267-26" name="__codelineno-267-26" href="#__codelineno-267-26"></a><span class="n">Most</span><span class="w"> </span><span class="n">of</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">types</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="k">this</span><span class="w"> </span><span class="n">chapter</span><span class="w"> </span><span class="n">come</span><span class="w"> </span><span class="k">from</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">following</span><span class="w"> </span><span class="n">namespaces</span>
</span><span id="__span-267-27"><a id="__codelineno-267-27" name="__codelineno-267-27" href="#__codelineno-267-27"></a>
</span><span id="__span-267-28"><a id="__codelineno-267-28" name="__codelineno-267-28" href="#__codelineno-267-28"></a><span class="err">```</span><span class="n">csharp</span>
</span><span id="__span-267-29"><a id="__codelineno-267-29" name="__codelineno-267-29" href="#__codelineno-267-29"></a><span class="n">System</span><span class="p">.</span><span class="n">Reflection</span>
</span><span id="__span-267-30"><a id="__codelineno-267-30" name="__codelineno-267-30" href="#__codelineno-267-30"></a><span class="n">System</span><span class="p">.</span><span class="n">Resources</span>
</span><span id="__span-267-31"><a id="__codelineno-267-31" name="__codelineno-267-31" href="#__codelineno-267-31"></a><span class="n">System</span><span class="p">.</span><span class="n">Globalization</span>
</span></code></pre></div>
<h1 id="whats-in-an-assembly">Whatâ€™s in an Assembly</h1>
<ul>
<li>
<p>An assembly manifest</p>
<p>Provides information to the CLR, such as the assemblyâ€™s name, version, and other assemblies that it references</p>
</li>
<li>
<p>An application manifest</p>
<p>Provides information to the operating system, such as how the assembly should be deployed and whether administrative elevation is required</p>
</li>
<li>
<p>Compiled types</p>
<p>The compiled IL code and metadata of the types defined within the assembly</p>
</li>
<li>
<p>Resources</p>
<p>Other data embedded within the assembly, such as images and localizable text</p>
</li>
</ul>
<h2 id="the-assembly-manifest">The Assembly Manifest</h2>
<p>The assembly manifest serves two purposes</p>
<ul>
<li>It describes the assembly to the managed hosting environment.</li>
<li>It acts as a directory to the modules, types, and resources in the assembly.</li>
</ul>
<p>Assemblies are thus self-describing. A consumer can discover all of an assemblyâ€™s data, types, and functionsâ€”without needing additional files.</p>
<aside>
ðŸ“¢ An assembly manifest is not something you add explicitly to an assemblyâ€”itâ€™s automatically embedded into an assembly as part of compilation.

</aside>

<p>Hereâ€™s a summary of the functionally significant data stored in the manifest</p>
<ul>
<li>The simple name of the assembly</li>
<li>A version number (AssemblyVersion)</li>
<li>A public key and signed hash of the assembly, if strongly named</li>
<li>A list of referenced assemblies, including their version and public key</li>
<li>A list of types defined in the assembly</li>
<li>The culture it targets, if a satellite assembly (AssemblyCulture)</li>
</ul>
<p>The manifest can also store the following informational data</p>
<ul>
<li>A full title and description (AssemblyTitle and AssemblyDescription)</li>
<li>Company and copyright information (AssemblyCompany and Assembly Copyright)</li>
<li>A display version (AssemblyInformationalVersion)</li>
<li>Additional attributes for custom data</li>
</ul>
<h3 id="specifying-assembly-attributes">Specifying assembly attributes</h3>
<p>Commonly used assembly attributes can be specified in Visual Studio on the projectâ€™s Properties page, on the Package tab. The settings on that tab are added to the project file (.csproj).</p>
<p>To specify attributes not supported by the Package tab, or if not working with a .csproj file, you can specify assembly attributes in source code. .NET Framework projects automatically create a file for this purpose, AssemblyInfo.cs in the Properties folder, but .NET Core projects do not. Although you can specify attributes in any source code file in your project, adding a .cs file specifically for attributes allows you to keep them together and well organized.</p>
<h2 id="the-application-manifest-windows">The Application Manifest (Windows)</h2>
<p>An application manifest is an XML file that communicates information about the assembly to the OS. An application manifest is embedded into the startup executable as a Win32 resource during the build process. If present, the manifest is read and processed before the CLR loads the assemblyâ€”and can influence how Windows launches the applicationâ€™s process.</p>
<p>A .NET application manifest has a root element called assembly in the XML nameâ€ space urn:schemas-microsoft-com:asm.v1</p>
<div class="language-xml highlight"><pre><span></span><code><span id="__span-268-1"><a id="__codelineno-268-1" name="__codelineno-268-1" href="#__codelineno-268-1"></a><span class="cp">&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;</span>
</span><span id="__span-268-2"><a id="__codelineno-268-2" name="__codelineno-268-2" href="#__codelineno-268-2"></a><span class="nt">&lt;assembly</span><span class="w"> </span><span class="na">manifestVersion=</span><span class="s">&quot;1.0&quot;</span><span class="w"> </span><span class="na">xmlns=</span><span class="s">&quot;urn:schemas-microsoft-com:asm.v1&quot;</span><span class="nt">&gt;</span>
</span><span id="__span-268-3"><a id="__codelineno-268-3" name="__codelineno-268-3" href="#__codelineno-268-3"></a><span class="w"> </span><span class="cm">&lt;!-- contents of manifest --&gt;</span>
</span><span id="__span-268-4"><a id="__codelineno-268-4" name="__codelineno-268-4" href="#__codelineno-268-4"></a><span class="nt">&lt;/assembly&gt;</span>
</span></code></pre></div>
<div class="language-xml highlight"><pre><span></span><code><span id="__span-269-1"><a id="__codelineno-269-1" name="__codelineno-269-1" href="#__codelineno-269-1"></a><span class="cp">&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;</span>
</span><span id="__span-269-2"><a id="__codelineno-269-2" name="__codelineno-269-2" href="#__codelineno-269-2"></a><span class="nt">&lt;assembly</span><span class="w"> </span><span class="na">manifestVersion=</span><span class="s">&quot;1.0&quot;</span><span class="w"> </span><span class="na">xmlns=</span><span class="s">&quot;urn:schemas-microsoft-com:asm.v1&quot;</span><span class="nt">&gt;</span>
</span><span id="__span-269-3"><a id="__codelineno-269-3" name="__codelineno-269-3" href="#__codelineno-269-3"></a><span class="w"> </span><span class="nt">&lt;trustInfo</span><span class="w"> </span><span class="na">xmlns=</span><span class="s">&quot;urn:schemas-microsoft-com:asm.v2&quot;</span><span class="nt">&gt;</span>
</span><span id="__span-269-4"><a id="__codelineno-269-4" name="__codelineno-269-4" href="#__codelineno-269-4"></a><span class="w"> </span><span class="nt">&lt;security&gt;</span>
</span><span id="__span-269-5"><a id="__codelineno-269-5" name="__codelineno-269-5" href="#__codelineno-269-5"></a><span class="w"> </span><span class="nt">&lt;requestedPrivileges&gt;</span>
</span><span id="__span-269-6"><a id="__codelineno-269-6" name="__codelineno-269-6" href="#__codelineno-269-6"></a><span class="w"> </span><span class="nt">&lt;requestedExecutionLevel</span><span class="w"> </span><span class="na">level=</span><span class="s">&quot;requireAdministrator&quot;</span><span class="w"> </span><span class="nt">/&gt;</span>
</span><span id="__span-269-7"><a id="__codelineno-269-7" name="__codelineno-269-7" href="#__codelineno-269-7"></a><span class="nt">&lt;/requestedPrivileges&gt;</span>
</span><span id="__span-269-8"><a id="__codelineno-269-8" name="__codelineno-269-8" href="#__codelineno-269-8"></a><span class="w"> </span><span class="nt">&lt;/security&gt;</span>
</span><span id="__span-269-9"><a id="__codelineno-269-9" name="__codelineno-269-9" href="#__codelineno-269-9"></a><span class="w"> </span><span class="nt">&lt;/trustInfo&gt;</span>
</span><span id="__span-269-10"><a id="__codelineno-269-10" name="__codelineno-269-10" href="#__codelineno-269-10"></a><span class="nt">&lt;/assembly&gt;</span>
</span></code></pre></div>
<h3 id="deploying-an-application-manifest">Deploying an application manifest</h3>
<p>You can add an application manifest to a .NET Core project in Visual Studio by right-clicking your project in Solution Explorer, selecting Add, then â€œNew item,â€ and then choosing Application Manifest File. Upon building, the manifest will be embedded into the output assembly.</p>
<h2 id="modules">Modules</h2>
<p>The contents of an assembly are actually packaged within an intermediate container, called a module. A module corresponds to a file containing the contents of an assembly. The reason for this extra layer of containership is to allow an assembly to span multiple files, a feature present in .NET Framework but absent in .NET Core.</p>
<h2 id="the-assembly-class">The Assembly Class</h2>
<p>The Assembly class in <code>System.Reflection</code> is a gateway to accessing assembly metaâ€ data at runtime. There are a number of ways to obtain an assembly object: the simplest is via a Typeâ€™s Assembly property:</p>
<div class="language-csharp highlight"><pre><span></span><code><span id="__span-270-1"><a id="__codelineno-270-1" name="__codelineno-270-1" href="#__codelineno-270-1"></a><span class="n">Assembly</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">typeof</span><span class="w"> </span><span class="p">(</span><span class="n">Program</span><span class="p">).</span><span class="n">Assembly</span><span class="p">;</span>
</span></code></pre></div>
<ul>
<li>
<p>GetExecutingAssembly</p>
<p>Returns the assembly of the type that defines the currently executing function</p>
</li>
<li>
<p>GetCallingAssembly</p>
<p>Does the same as GetExecutingAssembly but for the function that called the currently executing function</p>
</li>
<li>
<p>GetEntryAssembly</p>
<p>Returns the assembly defining the applicationâ€™s original entry method</p>
</li>
</ul>
<h1 id="strong-names-and-assembly-signing">Strong Names and Assembly Signing</h1>
<p>A strongly named assembly has a unique identity. It works by adding two bits of metadata to the manifest:</p>
<ul>
<li>A unique number that belongs to the authors of the assembly</li>
<li>A signed hash of the assembly, proving that the unique number holder produced the assembly</li>
</ul>
<p>This requires a public/private key pair. The public key provides the unique identifyâ€ ing number, and the private key facilitates signing.</p>
<p>The public key is valuable in guaranteeing the uniqueness of assembly references: a strongly named assembly incorporates the public key into its identity.</p>
<p>Strongly naming an assembly is important in .NET Frameâ€ work for two reasons</p>
<ul>
<li>It allows the assembly to be loaded into the â€œglobal assembly cacheâ€</li>
<li>It allows the assembly to by referenced by other strongly named assemblies.</li>
</ul>
<p>In .NET Framework, the private key protects your assembly from tampering, in that without your private key, no one can release a modified version of the assembly without the signature breaking. In practice, this is of use when loading an assembly into .NET Frameworkâ€™s global assembly cache.</p>
<h2 id="how-to-strongly-name-an-assembly">How to Strongly Name an Assembly</h2>
<p>To give an assembly a strong name, first generate a public/private key pair with the sn.exe utility</p>
<div class="language-csharp highlight"><pre><span></span><code><span id="__span-271-1"><a id="__codelineno-271-1" name="__codelineno-271-1" href="#__codelineno-271-1"></a><span class="n">sn</span><span class="p">.</span><span class="n">exe</span><span class="w"> </span><span class="o">-</span><span class="n">k</span><span class="w"> </span><span class="n">MyKeyPair</span><span class="p">.</span><span class="n">snk</span>
</span></code></pre></div>
<aside>
ðŸ“¢ Visual Studio installs a shortcut called Developer Command Prompt for VS, which starts a command prompt whose PATH contains development tools such as sn.exe.

</aside>

<p>This manufactures a new key pair and stores it to a file called MyKeyPair.snk. If you subsequently lose this file, you will permanently lose the ability to recompile your assembly with the same identity.</p>
<p>You can sign an assembly with this file by updating your project file. From Visual Studio, go to the Project Properties window, and then, on the Signing tab, select the â€œSign the assemblyâ€ checkbox and select your .snk file.</p>
<p>The same key pair can sign multiple assembliesâ€”theyâ€™ll still have distinct identities if their simple names differ.</p>
<h1 id="assembly-names">Assembly Names</h1>
<p>An assemblyâ€™s â€œidentityâ€ comprises four pieces of metadata from its manifest</p>
<ul>
<li>Its simple name</li>
<li>Its version (â€œ0.0.0.0â€ if not present)</li>
<li>Its culture (â€œneutralâ€ if not a satellite)</li>
<li>Its public key token (â€œnullâ€ if not strongly named)</li>
</ul>
<p>The simple name comes not from any attribute, but from the name of the file to which it was originally compiled (less any extension). So, the simple name of the System.Xml.dll assembly is â€œSystem.Xml.â€ Renaming a file doesnâ€™t change the assemblyâ€™s simple name.</p>
<p>The version number comes from the AssemblyVersion attribute. Itâ€™s a string divided into four parts as follows</p>
<div class="language-csharp highlight"><pre><span></span><code><span id="__span-272-1"><a id="__codelineno-272-1" name="__codelineno-272-1" href="#__codelineno-272-1"></a><span class="n">major</span><span class="p">.</span><span class="n">minor</span><span class="p">.</span><span class="n">build</span><span class="p">.</span><span class="n">revision</span>
</span></code></pre></div>
<p>You can specify a version number as follows:</p>
<div class="language-csharp highlight"><pre><span></span><code><span id="__span-273-1"><a id="__codelineno-273-1" name="__codelineno-273-1" href="#__codelineno-273-1"></a><span class="na">[assembly: AssemblyVersion (&quot;2.5.6.7&quot;)]</span>
</span></code></pre></div>
<h2 id="fully-qualified-names">Fully Qualified Names</h2>
<p>A fully qualified assembly name is a string that includes all four identifying components, in this format</p>
<div class="language-csharp highlight"><pre><span></span><code><span id="__span-274-1"><a id="__codelineno-274-1" name="__codelineno-274-1" href="#__codelineno-274-1"></a><span class="n">simple</span><span class="o">-</span><span class="n">name</span><span class="p">,</span><span class="w"> </span><span class="n">Version</span><span class="o">=</span><span class="n">version</span><span class="p">,</span><span class="w"> </span><span class="n">Culture</span><span class="o">=</span><span class="n">culture</span><span class="p">,</span><span class="w"> </span><span class="n">PublicKeyToken</span><span class="o">=</span><span class="k">public</span><span class="o">-</span><span class="n">key</span>
</span></code></pre></div>
<p>or example, the fully qualified name of System.Private.CoreLib.dll is System.Priâ€ vate.CoreLib, Version=4.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e.</p>
<h3 id="the-assemblyname-class">The AssemblyName Class</h3>
<p>AssemblyName is a class with a typed property for each of the four components of a fully qualified assembly name. AssemblyName has two purposes:</p>
<ul>
<li>It parses or builds a fully qualified assembly name</li>
<li>It stores some extra data to assist in resolving (finding) the assembly.</li>
</ul>
<p>You can obtain an AssemblyName object in any of the following ways</p>
<ul>
<li>Instantiate an AssemblyName, providing a fully qualified name</li>
<li>Call GetName on an existing Assembly</li>
<li>Call AssemblyName.GetAssemblyName, providing the path to an assembly file on disk</li>
</ul>
<p>You can also instantiate an AssemblyName object without any arguments and then set each of its properties to build a fully qualified name. An AssemblyName is mutable when constructed in this manner</p>
<div class="language-csharp highlight"><pre><span></span><code><span id="__span-275-1"><a id="__codelineno-275-1" name="__codelineno-275-1" href="#__codelineno-275-1"></a><span class="c1">//To use AssemblyName to obtain the simple name of an assembly:</span>
</span><span id="__span-275-2"><a id="__codelineno-275-2" name="__codelineno-275-2" href="#__codelineno-275-2"></a><span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="w"> </span><span class="p">(</span><span class="k">typeof</span><span class="w"> </span><span class="p">(</span><span class="kt">string</span><span class="p">).</span><span class="n">Assembly</span><span class="p">.</span><span class="n">GetName</span><span class="p">().</span><span class="n">Name</span><span class="p">);</span>
</span><span id="__span-275-3"><a id="__codelineno-275-3" name="__codelineno-275-3" href="#__codelineno-275-3"></a><span class="c1">// System.Private.CoreLib</span>
</span><span id="__span-275-4"><a id="__codelineno-275-4" name="__codelineno-275-4" href="#__codelineno-275-4"></a><span class="c1">//To get an assembly version:</span>
</span><span id="__span-275-5"><a id="__codelineno-275-5" name="__codelineno-275-5" href="#__codelineno-275-5"></a><span class="kt">string</span><span class="w"> </span><span class="n">v</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">myAssembly</span><span class="p">.</span><span class="n">GetName</span><span class="p">().</span><span class="n">Version</span><span class="p">.</span><span class="n">ToString</span><span class="p">();</span>
</span></code></pre></div>
<h2 id="assembly-informational-and-file-versions">Assembly Informational and File Versions</h2>
<p>Two further assembly attributes are available for expressing version-related inforâ€ mation. Unlike AssemblyVersion, the following two attributes do not affect an assemblyâ€™s identity and so have no effect on what happens at compile-time or at runtime:</p>
<ul>
<li>
<p>AssemblyInformationalVersion</p>
<p>The version as displayed to the end user. This is visible in the Windows File Properties dialog box as Product Version. Any string can go here, such as â€œ5.1 Beta 2.â€ Typically, all of the assemblies in an application would be assigned the same informational version number.</p>
</li>
<li>
<p>AssemblyFileVersion</p>
<p>This is intended to refer to the build number for that assembly. This is visible in the Windows File Properties dialog box as File Version. As with Assembly Version, it must contain a string consisting of up to four numbers separated by periods.</p>
</li>
</ul>
<h1 id="authenticode-signing">Authenticode Signing</h1>
<p>Authenticode is a code-signing system whose purpose is to <strong>prove the identity of the publisher</strong>. Authenticode and strong-name signing are independent: you can sign an assembly with either or both systems.</p>
<p>Although strong-name signing can prove that assemblies A, B, and C came from the same party (assuming the private key hasnâ€™t been leaked), it canâ€™t tell you who that party was. To know that the party was Joe Albahariâ€”or Microsoft Corporationâ€” you need Authenticode.</p>
<p>Authenticode is useful when downloading programs from the internet, because it provides assurance that a program came from whoever was named by the Certificate Authority and was not modified in transit. It also prevents the Unknown Publisher warning when running a downloaded application for the first time.</p>
<p>Authenticode signing is also a requirement when submitting apps to the Windows Store.</p>
<p>Authenticode works with not only .NET assemblies, but also unmanaged executables and binaries such as .msi deployment files. Of course, Authenticode doesnâ€™t guarantee that a program is free from malwareâ€”although it does make it less likely. A person or entity has been willing to put its name (backed by a passport or company document) behind the executable or library.</p>
<p>Signing with Authenticode requires that you contact a Certificate Authority (CA) with evidence of your personal identity or companyâ€™s identity (articles of incorporation, etc.). After the CA has checked your documents, it will issue an X.509 codesigning certificate that is typically valid for one to five years. This enables you to sign assemblies with the signtool utility. You can also make a certificate yourself with the makecert utility; however, it will be recognized only on computers on which the certificate is explicitly installed.</p>
<p>The fact that (non-self-signed) certificates can work on any computer relies on public key infrastructure. Essentially, your certificate is signed with another certificate belonging to a CA. The CA is trusted because all CAs are loaded into the OS (to see them, go to the Windows Control Panel and then, in the search box, type â€œcertificateâ€. In the Administrative Tools section, click â€œManage computer certificates.â€ This launches the Certificate Manager. Open the node Trusted Root Certification Authorities and click Certificates). A CA can revoke a publisherâ€™s certificate if leaked, so verifying an Authenticode signature requires periodically asking the CA for an up-to-date list of certification revocations. <strong>Because Authenticode uses cryptographic signing, an Authenticode signature is invalid if someone subsequently tampers with the file.</strong></p>
<h2 id="verifying-that-a-program-has-been-signed">Verifying that a program has been signed</h2>
<p>The easiest way to view an Authenticode signature on a file is to view the fileâ€™s properties in Windows Explorer (look in the Digital Signatures tab). The signtool utility also provides an option for this.</p>
<h1 id="resources-and-satellite-assemblies">Resources and Satellite Assemblies</h1>
<p>An application typically contains not only executable code, but also content such as text, images, or XML files. Such content can be represented in an assembly through a resource. There are two overlapping use cases for resources:</p>
<ul>
<li>Incorporating data that cannot go into source code, such as images</li>
<li>Storing data that might need translation in a multilingual application</li>
</ul>
<h2 id="directly-embedding-resources">Directly Embedding Resources</h2>
<p>To directly embed a resource using Visual Studio:</p>
<ul>
<li>Add the file to your project</li>
<li>Set its build action to Embedded Resource</li>
</ul>
<p>Visual Studio always prefixes resource names with the projectâ€™s default namespace, plus the names of any subfolders in which the file is contained. So, if your projectâ€™s default namespace was <code>Westwind.Reports</code> and your file was called banner.jpg in the folder pictures, the resource name would be <code>Westwind.Reports.pictures.banner.jpg</code>. <strong>Resource names are case sensitive</strong>. This makes project subâ€ folder names in Visual Studio that contain resources effecâ€ tively case sensitive.</p>
<p>To retrieve a resource, you call GetManifestResourceStream on the assembly conâ€ taining the resource. This returns a stream, which you can then read as any other</p>
<div class="language-csharp highlight"><pre><span></span><code><span id="__span-276-1"><a id="__codelineno-276-1" name="__codelineno-276-1" href="#__codelineno-276-1"></a><span class="n">Assembly</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Assembly</span><span class="p">.</span><span class="n">GetEntryAssembly</span><span class="p">();</span>
</span><span id="__span-276-2"><a id="__codelineno-276-2" name="__codelineno-276-2" href="#__codelineno-276-2"></a><span class="k">using</span><span class="w"> </span><span class="p">(</span><span class="n">Stream</span><span class="w"> </span><span class="n">s</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">a</span><span class="p">.</span><span class="n">GetManifestResourceStream</span><span class="w"> </span><span class="p">(</span><span class="s">&quot;TestProject.data.xml&quot;</span><span class="p">))</span>
</span><span id="__span-276-3"><a id="__codelineno-276-3" name="__codelineno-276-3" href="#__codelineno-276-3"></a><span class="k">using</span><span class="w"> </span><span class="p">(</span><span class="n">XmlReader</span><span class="w"> </span><span class="n">r</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">XmlReader</span><span class="p">.</span><span class="n">Create</span><span class="w"> </span><span class="p">(</span><span class="n">s</span><span class="p">))</span>
</span><span id="__span-276-4"><a id="__codelineno-276-4" name="__codelineno-276-4" href="#__codelineno-276-4"></a><span class="w"> </span><span class="p">...</span>
</span><span id="__span-276-5"><a id="__codelineno-276-5" name="__codelineno-276-5" href="#__codelineno-276-5"></a><span class="n">System</span><span class="p">.</span><span class="n">Drawing</span><span class="p">.</span><span class="n">Image</span><span class="w"> </span><span class="n">image</span><span class="p">;</span>
</span><span id="__span-276-6"><a id="__codelineno-276-6" name="__codelineno-276-6" href="#__codelineno-276-6"></a><span class="k">using</span><span class="w"> </span><span class="p">(</span><span class="n">Stream</span><span class="w"> </span><span class="n">s</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">a</span><span class="p">.</span><span class="n">GetManifestResourceStream</span><span class="w"> </span><span class="p">(</span><span class="s">&quot;TestProject.banner.jpg&quot;</span><span class="p">))</span>
</span><span id="__span-276-7"><a id="__codelineno-276-7" name="__codelineno-276-7" href="#__codelineno-276-7"></a><span class="w"> </span><span class="n">image</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">System</span><span class="p">.</span><span class="n">Drawing</span><span class="p">.</span><span class="n">Image</span><span class="p">.</span><span class="n">FromStream</span><span class="w"> </span><span class="p">(</span><span class="n">s</span><span class="p">);</span>
</span></code></pre></div>
<h2 id="resources-files">.resources Files</h2>
<p>.resources files are containers for potentially localizable content. A .resources file ends up as an embedded resource within an assemblyâ€”just like any other kind of file. The difference is that you must do the following:</p>
<ul>
<li>Package your content into the .resources file to begin with</li>
<li>Access its content through a ResourceManager or pack URI rather than a Get ManifestResourceStream</li>
</ul>
<p>.resources files are structured in binary and so are not human-editable; therefore, you must rely on tools provided by the Framework and Visual Studio to work with them. The standard approach with strings or simple data types is to use the .resx format, which can be converted to a .resources file either by Visual Studio or the resgen tool. The .resx format is also suitable for images intended for a Windows Forms or <a href="http://asp.net/">ASP.NET</a> application.</p>
<h2 id="satellite-assemblies">Satellite Assemblies</h2>
<p>Data embedded in .resources is localizable. Resource localization is relevant when your application runs on a version of Windows built to display everything in a different language. For consistency, your application should use that same language, too.</p>
<p>A typical setup is as follows</p>
<ul>
<li>The main assembly contains .resources for the default or fallback language.</li>
<li>Separate satellite assemblies contain localized .resources translated to different languages</li>
</ul>
<p>When your application runs, .NET Core examines the language of the current OS (from <code>CultureInfo.CurrentUICulture</code>). Whenever you request a resource using <code>ResourceManager</code>, the Framework looks for a localized satellite assembly. If oneâ€™s availableâ€”and it contains the resource key you requestedâ€”itâ€™s used in place of the main assemblyâ€™s version.</p>
<p>This means that you can enhance language support simply by adding new satellites without changing the main assembly. A satellite assembly cannot contain executable code, only resources.</p>
<p>Satellite assemblies are deployed in subdirectories of the assemblyâ€™s folder as follows:</p>
<div class="language-csharp highlight"><pre><span></span><code><span id="__span-277-1"><a id="__codelineno-277-1" name="__codelineno-277-1" href="#__codelineno-277-1"></a><span class="n">programBaseFolder</span><span class="err">\</span><span class="n">MyProgram</span><span class="p">.</span><span class="n">exe</span>
</span><span id="__span-277-2"><a id="__codelineno-277-2" name="__codelineno-277-2" href="#__codelineno-277-2"></a><span class="w"> </span><span class="err">\</span><span class="n">MyLibrary</span><span class="p">.</span><span class="n">exe</span>
</span><span id="__span-277-3"><a id="__codelineno-277-3" name="__codelineno-277-3" href="#__codelineno-277-3"></a><span class="w"> </span><span class="err">\</span><span class="n">XX</span><span class="err">\</span><span class="n">MyProgram</span><span class="p">.</span><span class="n">resources</span><span class="p">.</span><span class="n">dll</span>
</span><span id="__span-277-4"><a id="__codelineno-277-4" name="__codelineno-277-4" href="#__codelineno-277-4"></a><span class="w"> </span><span class="err">\</span><span class="n">XX</span><span class="err">\</span><span class="n">MyLibrary</span><span class="p">.</span><span class="n">resources</span><span class="p">.</span><span class="n">dll</span>
</span></code></pre></div>
<p><strong>XX refers to the two-letter language code (such as â€œdeâ€ for German) or a language and region code (such as â€œen-GBâ€ for English in Great Britain). This naming system allows the CLR to find and load the correct satellite assembly automatically.</strong></p>
<h3 id="building-satellite-assemblies">Building satellite assemblies</h3>
<div class="language-csharp highlight"><pre><span></span><code><span id="__span-278-1"><a id="__codelineno-278-1" name="__codelineno-278-1" href="#__codelineno-278-1"></a><span class="c1">//Recall our previous .resx example, which included the following:</span>
</span><span id="__span-278-2"><a id="__codelineno-278-2" name="__codelineno-278-2" href="#__codelineno-278-2"></a><span class="o">&lt;</span><span class="n">root</span><span class="o">&gt;</span>
</span><span id="__span-278-3"><a id="__codelineno-278-3" name="__codelineno-278-3" href="#__codelineno-278-3"></a><span class="w"> </span><span class="p">...</span>
</span><span id="__span-278-4"><a id="__codelineno-278-4" name="__codelineno-278-4" href="#__codelineno-278-4"></a><span class="w"> </span><span class="o">&lt;</span><span class="n">data</span><span class="w"> </span><span class="n">name</span><span class="o">=</span><span class="s">&quot;Greeting&quot;</span>
</span><span id="__span-278-5"><a id="__codelineno-278-5" name="__codelineno-278-5" href="#__codelineno-278-5"></a><span class="w"> </span><span class="o">&lt;</span><span class="k">value</span><span class="o">&gt;</span><span class="n">hello</span><span class="o">&lt;/</span><span class="k">value</span><span class="o">&gt;</span>
</span><span id="__span-278-6"><a id="__codelineno-278-6" name="__codelineno-278-6" href="#__codelineno-278-6"></a><span class="w"> </span><span class="o">&lt;/</span><span class="n">data</span><span class="o">&gt;</span>
</span><span id="__span-278-7"><a id="__codelineno-278-7" name="__codelineno-278-7" href="#__codelineno-278-7"></a><span class="o">&lt;/</span><span class="n">root</span><span class="o">&gt;</span>
</span></code></pre></div>
<p>We then retrieved the greeting at runtime as follows</p>
<div class="language-csharp highlight"><pre><span></span><code><span id="__span-279-1"><a id="__codelineno-279-1" name="__codelineno-279-1" href="#__codelineno-279-1"></a><span class="n">ResourceManager</span><span class="w"> </span><span class="n">r</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">ResourceManager</span><span class="w"> </span><span class="p">(</span><span class="s">&quot;welcome&quot;</span><span class="p">,</span>
</span><span id="__span-279-2"><a id="__codelineno-279-2" name="__codelineno-279-2" href="#__codelineno-279-2"></a><span class="w"> </span><span class="n">Assembly</span><span class="p">.</span><span class="n">GetExecutingAssembly</span><span class="p">());</span>
</span><span id="__span-279-3"><a id="__codelineno-279-3" name="__codelineno-279-3" href="#__codelineno-279-3"></a><span class="n">Console</span><span class="p">.</span><span class="n">Write</span><span class="w"> </span><span class="p">(</span><span class="n">r</span><span class="p">.</span><span class="n">GetString</span><span class="w"> </span><span class="p">(</span><span class="s">&quot;Greeting&quot;</span><span class="p">));</span>
</span></code></pre></div>
<p>Suppose that we want this to instead write â€œhalloâ€ if running on the German version of Windows. The first step is to add another .resx file named welcome.de.resx that substitutes hello for hallo:</p>
<div class="language-csharp highlight"><pre><span></span><code><span id="__span-280-1"><a id="__codelineno-280-1" name="__codelineno-280-1" href="#__codelineno-280-1"></a><span class="o">&lt;</span><span class="n">root</span><span class="o">&gt;</span>
</span><span id="__span-280-2"><a id="__codelineno-280-2" name="__codelineno-280-2" href="#__codelineno-280-2"></a><span class="w"> </span><span class="o">&lt;</span><span class="n">data</span><span class="w"> </span><span class="n">name</span><span class="o">=</span><span class="s">&quot;Greeting&quot;</span><span class="o">&gt;</span>
</span><span id="__span-280-3"><a id="__codelineno-280-3" name="__codelineno-280-3" href="#__codelineno-280-3"></a><span class="w"> </span><span class="o">&lt;</span><span class="k">value</span><span class="o">&gt;</span><span class="n">hallo</span><span class="o">&lt;</span><span class="k">value</span><span class="o">&gt;</span>
</span><span id="__span-280-4"><a id="__codelineno-280-4" name="__codelineno-280-4" href="#__codelineno-280-4"></a><span class="w"> </span><span class="o">&lt;/</span><span class="n">data</span><span class="o">&gt;</span>
</span><span id="__span-280-5"><a id="__codelineno-280-5" name="__codelineno-280-5" href="#__codelineno-280-5"></a><span class="o">&lt;/</span><span class="n">root</span><span class="o">&gt;</span>
</span></code></pre></div>
<p>In Visual Studio, this is all you need to doâ€”when you rebuild, a satellite assembly called MyApp.resources.dll is automatically created in a subdirectory called de.</p>
<h2 id="cultures-and-subcultures">Cultures and Subcultures</h2>
<p>Cultures are split into cultures and subcultures. A culture represents a particular language; a subculture represents a regional variation of that language. The Frameâ€ work follows the RFC1766 standard, which represents cultures and subcultures with two-letter codes. Here are the codes for English and German cultures:</p>
<div class="language-csharp highlight"><pre><span></span><code><span id="__span-281-1"><a id="__codelineno-281-1" name="__codelineno-281-1" href="#__codelineno-281-1"></a><span class="n">En</span>
</span><span id="__span-281-2"><a id="__codelineno-281-2" name="__codelineno-281-2" href="#__codelineno-281-2"></a><span class="n">de</span>
</span></code></pre></div>
<p>Here are the codes for the Australian English and Austrian German subcultures:</p>
<div class="language-csharp highlight"><pre><span></span><code><span id="__span-282-1"><a id="__codelineno-282-1" name="__codelineno-282-1" href="#__codelineno-282-1"></a><span class="n">en</span><span class="o">-</span><span class="n">AU</span>
</span><span id="__span-282-2"><a id="__codelineno-282-2" name="__codelineno-282-2" href="#__codelineno-282-2"></a><span class="n">de</span><span class="o">-</span><span class="n">AT</span>
</span></code></pre></div>
<p>A culture is represented in .NET with the System.Globalization.CultureInfo class. You can examine the current culture of your application as follows:</p>
<div class="language-csharp highlight"><pre><span></span><code><span id="__span-283-1"><a id="__codelineno-283-1" name="__codelineno-283-1" href="#__codelineno-283-1"></a><span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="w"> </span><span class="p">(</span><span class="n">System</span><span class="p">.</span><span class="n">Threading</span><span class="p">.</span><span class="n">Thread</span><span class="p">.</span><span class="n">CurrentThread</span><span class="p">.</span><span class="n">CurrentCulture</span><span class="p">);</span>
</span><span id="__span-283-2"><a id="__codelineno-283-2" name="__codelineno-283-2" href="#__codelineno-283-2"></a><span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="w"> </span><span class="p">(</span><span class="n">System</span><span class="p">.</span><span class="n">Threading</span><span class="p">.</span><span class="n">Thread</span><span class="p">.</span><span class="n">CurrentThread</span><span class="p">.</span><span class="n">CurrentUICulture</span><span class="p">);</span>
</span></code></pre></div>
<p><code>CurrentCulture</code> reflects the regional settings of the Windows Control Panel, whereas <code>CurrentUICulture</code> reflects the language of the OS.# Chapter 2 : C# Language Basics</p>
<h3 id="first-c-program">First C# Program</h3>
<div class="language-csharp highlight"><pre><span></span><code><span id="__span-284-1"><a id="__codelineno-284-1" name="__codelineno-284-1" href="#__codelineno-284-1"></a><span class="k">using</span><span class="w"> </span><span class="nn">System</span><span class="p">;</span>
</span><span id="__span-284-2"><a id="__codelineno-284-2" name="__codelineno-284-2" href="#__codelineno-284-2"></a><span class="k">class</span><span class="w"> </span><span class="nc">Test</span>
</span><span id="__span-284-3"><a id="__codelineno-284-3" name="__codelineno-284-3" href="#__codelineno-284-3"></a><span class="p">{</span>
</span><span id="__span-284-4"><a id="__codelineno-284-4" name="__codelineno-284-4" href="#__codelineno-284-4"></a><span class="w"> </span><span class="k">static</span><span class="w"> </span><span class="k">void</span><span class="w"> </span><span class="nf">Main</span><span class="p">()</span>
</span><span id="__span-284-5"><a id="__codelineno-284-5" name="__codelineno-284-5" href="#__codelineno-284-5"></a><span class="w"> </span><span class="p">{</span>
</span><span id="__span-284-6"><a id="__codelineno-284-6" name="__codelineno-284-6" href="#__codelineno-284-6"></a><span class="w"> </span><span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="w"> </span><span class="p">(</span><span class="n">FeetToInches</span><span class="w"> </span><span class="p">(</span><span class="mi">30</span><span class="p">));</span><span class="w"> </span><span class="c1">// 360</span>
</span><span id="__span-284-7"><a id="__codelineno-284-7" name="__codelineno-284-7" href="#__codelineno-284-7"></a><span class="w"> </span><span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="w"> </span><span class="p">(</span><span class="n">FeetToInches</span><span class="w"> </span><span class="p">(</span><span class="mi">100</span><span class="p">));</span><span class="w"> </span><span class="c1">// 1200</span>
</span><span id="__span-284-8"><a id="__codelineno-284-8" name="__codelineno-284-8" href="#__codelineno-284-8"></a><span class="w"> </span><span class="p">}</span>
</span><span id="__span-284-9"><a id="__codelineno-284-9" name="__codelineno-284-9" href="#__codelineno-284-9"></a><span class="w"> </span><span class="k">static</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="nf">FeetToInches</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">feet</span><span class="p">)</span>
</span><span id="__span-284-10"><a id="__codelineno-284-10" name="__codelineno-284-10" href="#__codelineno-284-10"></a><span class="w"> </span><span class="p">{</span>
</span><span id="__span-284-11"><a id="__codelineno-284-11" name="__codelineno-284-11" href="#__codelineno-284-11"></a><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">inches</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">feet</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mi">12</span><span class="p">;</span>
</span><span id="__span-284-12"><a id="__codelineno-284-12" name="__codelineno-284-12" href="#__codelineno-284-12"></a><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="n">inches</span><span class="p">;</span>
</span><span id="__span-284-13"><a id="__codelineno-284-13" name="__codelineno-284-13" href="#__codelineno-284-13"></a><span class="w"> </span><span class="p">}</span>
</span><span id="__span-284-14"><a id="__codelineno-284-14" name="__codelineno-284-14" href="#__codelineno-284-14"></a><span class="p">}</span>
</span></code></pre></div>
<p>At the outermost level of a program, types are organized into namespaces. The
using directive makes the System namespace available to our application, to use the
Console class. We could define all of our classes within the TestPrograms nameâ€
space, as follows:</p>
<div class="language-csharp highlight"><pre><span></span><code><span id="__span-285-1"><a id="__codelineno-285-1" name="__codelineno-285-1" href="#__codelineno-285-1"></a><span class="k">using</span><span class="w"> </span><span class="nn">System</span><span class="p">;</span>
</span><span id="__span-285-2"><a id="__codelineno-285-2" name="__codelineno-285-2" href="#__codelineno-285-2"></a><span class="k">namespace</span><span class="w"> </span><span class="nn">TestPrograms</span>
</span><span id="__span-285-3"><a id="__codelineno-285-3" name="__codelineno-285-3" href="#__codelineno-285-3"></a><span class="p">{</span>
</span><span id="__span-285-4"><a id="__codelineno-285-4" name="__codelineno-285-4" href="#__codelineno-285-4"></a><span class="w"> </span><span class="k">class</span><span class="w"> </span><span class="nc">Test</span><span class="w"> </span><span class="p">{...}</span>
</span><span id="__span-285-5"><a id="__codelineno-285-5" name="__codelineno-285-5" href="#__codelineno-285-5"></a><span class="w"> </span><span class="k">class</span><span class="w"> </span><span class="nc">Test2</span><span class="w"> </span><span class="p">{...}</span>
</span><span id="__span-285-6"><a id="__codelineno-285-6" name="__codelineno-285-6" href="#__codelineno-285-6"></a><span class="p">}</span>
</span></code></pre></div>
<p>The .NET Core libraries are organized into nested namespaces. For example, this is
the namespace that contains types for handling text: <code>using System.Text</code></p>
<h3 id="identifiers-and-keywords">Identifiers and Keywords</h3>
<p>Identifiers are names that programmers choose for their classes, methods, variables,
and so on. Here are the identifiers in our example program, in the order in which
they appear:</p>
<div class="language-csharp highlight"><pre><span></span><code><span id="__span-286-1"><a id="__codelineno-286-1" name="__codelineno-286-1" href="#__codelineno-286-1"></a><span class="n">System</span><span class="w"> </span><span class="n">Test</span><span class="w"> </span><span class="n">Main</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="n">Console</span><span class="w"> </span><span class="n">WriteLine</span>
</span></code></pre></div>
<aside>
ðŸ’¡ An identifier must be a whole word, essentially made up of Unicode characters
starting with a letter or underscore. C# identifiers are case sensitive. By convention,
parameters, local variables, and private fields should be in camel case (e.g., my
Variable), and all other identifiers should be in Pascal case (e.g., MyMethod).

</aside>

<p>Keywords are names that mean something special to the compiler. These are the
keywords in our example program:</p>
<div class="language-csharp highlight"><pre><span></span><code><span id="__span-287-1"><a id="__codelineno-287-1" name="__codelineno-287-1" href="#__codelineno-287-1"></a><span class="k">using</span><span class="w"> </span><span class="nn">class</span><span class="w"> </span><span class="k">static</span><span class="w"> </span><span class="k">void</span><span class="w"> </span><span class="kt">int</span>
</span></code></pre></div>
<p>Most keywords are reserved, which means that you canâ€™t use them as identifiers.</p>
<ul>
<li>
<p>list of C# reserved keywords</p>
<div class="language-csharp highlight"><pre><span></span><code><span id="__span-288-1"><a id="__codelineno-288-1" name="__codelineno-288-1" href="#__codelineno-288-1"></a><span class="k">abstract</span>
</span><span id="__span-288-2"><a id="__codelineno-288-2" name="__codelineno-288-2" href="#__codelineno-288-2"></a><span class="k">as</span>
</span><span id="__span-288-3"><a id="__codelineno-288-3" name="__codelineno-288-3" href="#__codelineno-288-3"></a><span class="k">base</span>
</span><span id="__span-288-4"><a id="__codelineno-288-4" name="__codelineno-288-4" href="#__codelineno-288-4"></a><span class="kt">bool</span>
</span><span id="__span-288-5"><a id="__codelineno-288-5" name="__codelineno-288-5" href="#__codelineno-288-5"></a><span class="k">break</span>
</span><span id="__span-288-6"><a id="__codelineno-288-6" name="__codelineno-288-6" href="#__codelineno-288-6"></a><span class="kt">byte</span>
</span><span id="__span-288-7"><a id="__codelineno-288-7" name="__codelineno-288-7" href="#__codelineno-288-7"></a><span class="k">case</span>
</span><span id="__span-288-8"><a id="__codelineno-288-8" name="__codelineno-288-8" href="#__codelineno-288-8"></a><span class="k">catch</span>
</span><span id="__span-288-9"><a id="__codelineno-288-9" name="__codelineno-288-9" href="#__codelineno-288-9"></a><span class="kt">char</span>
</span><span id="__span-288-10"><a id="__codelineno-288-10" name="__codelineno-288-10" href="#__codelineno-288-10"></a><span class="k">checked</span>
</span><span id="__span-288-11"><a id="__codelineno-288-11" name="__codelineno-288-11" href="#__codelineno-288-11"></a><span class="k">class</span>
</span><span id="__span-288-12"><a id="__codelineno-288-12" name="__codelineno-288-12" href="#__codelineno-288-12"></a><span class="nc">const</span>
</span><span id="__span-288-13"><a id="__codelineno-288-13" name="__codelineno-288-13" href="#__codelineno-288-13"></a><span class="k">continue</span>
</span><span id="__span-288-14"><a id="__codelineno-288-14" name="__codelineno-288-14" href="#__codelineno-288-14"></a><span class="kt">decimal</span>
</span><span id="__span-288-15"><a id="__codelineno-288-15" name="__codelineno-288-15" href="#__codelineno-288-15"></a><span class="k">default</span>
</span><span id="__span-288-16"><a id="__codelineno-288-16" name="__codelineno-288-16" href="#__codelineno-288-16"></a><span class="k">delegate</span>
</span><span id="__span-288-17"><a id="__codelineno-288-17" name="__codelineno-288-17" href="#__codelineno-288-17"></a><span class="k">do</span>
</span><span id="__span-288-18"><a id="__codelineno-288-18" name="__codelineno-288-18" href="#__codelineno-288-18"></a><span class="kt">double</span>
</span><span id="__span-288-19"><a id="__codelineno-288-19" name="__codelineno-288-19" href="#__codelineno-288-19"></a><span class="k">else</span>
</span><span id="__span-288-20"><a id="__codelineno-288-20" name="__codelineno-288-20" href="#__codelineno-288-20"></a><span class="k">enum</span>
</span><span id="__span-288-21"><a id="__codelineno-288-21" name="__codelineno-288-21" href="#__codelineno-288-21"></a><span class="k">event</span>
</span><span id="__span-288-22"><a id="__codelineno-288-22" name="__codelineno-288-22" href="#__codelineno-288-22"></a><span class="k">explicit</span>
</span><span id="__span-288-23"><a id="__codelineno-288-23" name="__codelineno-288-23" href="#__codelineno-288-23"></a><span class="k">extern</span>
</span><span id="__span-288-24"><a id="__codelineno-288-24" name="__codelineno-288-24" href="#__codelineno-288-24"></a><span class="k">false</span>
</span><span id="__span-288-25"><a id="__codelineno-288-25" name="__codelineno-288-25" href="#__codelineno-288-25"></a><span class="k">finally</span>
</span><span id="__span-288-26"><a id="__codelineno-288-26" name="__codelineno-288-26" href="#__codelineno-288-26"></a><span class="k">fixed</span>
</span><span id="__span-288-27"><a id="__codelineno-288-27" name="__codelineno-288-27" href="#__codelineno-288-27"></a><span class="kt">float</span>
</span><span id="__span-288-28"><a id="__codelineno-288-28" name="__codelineno-288-28" href="#__codelineno-288-28"></a><span class="k">for</span>
</span><span id="__span-288-29"><a id="__codelineno-288-29" name="__codelineno-288-29" href="#__codelineno-288-29"></a><span class="k">foreach</span>
</span><span id="__span-288-30"><a id="__codelineno-288-30" name="__codelineno-288-30" href="#__codelineno-288-30"></a><span class="k">goto</span>
</span><span id="__span-288-31"><a id="__codelineno-288-31" name="__codelineno-288-31" href="#__codelineno-288-31"></a><span class="k">if</span>
</span><span id="__span-288-32"><a id="__codelineno-288-32" name="__codelineno-288-32" href="#__codelineno-288-32"></a><span class="k">implicit</span>
</span><span id="__span-288-33"><a id="__codelineno-288-33" name="__codelineno-288-33" href="#__codelineno-288-33"></a><span class="k">in</span>
</span><span id="__span-288-34"><a id="__codelineno-288-34" name="__codelineno-288-34" href="#__codelineno-288-34"></a><span class="kt">int</span>
</span><span id="__span-288-35"><a id="__codelineno-288-35" name="__codelineno-288-35" href="#__codelineno-288-35"></a><span class="k">interface</span>
</span><span id="__span-288-36"><a id="__codelineno-288-36" name="__codelineno-288-36" href="#__codelineno-288-36"></a><span class="k">internal</span>
</span><span id="__span-288-37"><a id="__codelineno-288-37" name="__codelineno-288-37" href="#__codelineno-288-37"></a><span class="k">is</span>
</span><span id="__span-288-38"><a id="__codelineno-288-38" name="__codelineno-288-38" href="#__codelineno-288-38"></a><span class="k">lock</span>
</span><span id="__span-288-39"><a id="__codelineno-288-39" name="__codelineno-288-39" href="#__codelineno-288-39"></a><span class="kt">long</span>
</span><span id="__span-288-40"><a id="__codelineno-288-40" name="__codelineno-288-40" href="#__codelineno-288-40"></a><span class="k">namespace</span>
</span><span id="__span-288-41"><a id="__codelineno-288-41" name="__codelineno-288-41" href="#__codelineno-288-41"></a><span class="nn">new</span>
</span><span id="__span-288-42"><a id="__codelineno-288-42" name="__codelineno-288-42" href="#__codelineno-288-42"></a><span class="k">null</span>
</span><span id="__span-288-43"><a id="__codelineno-288-43" name="__codelineno-288-43" href="#__codelineno-288-43"></a><span class="kt">object</span>
</span><span id="__span-288-44"><a id="__codelineno-288-44" name="__codelineno-288-44" href="#__codelineno-288-44"></a><span class="k">operator</span>
</span><span id="__span-288-45"><a id="__codelineno-288-45" name="__codelineno-288-45" href="#__codelineno-288-45"></a><span class="k">out</span>
</span><span id="__span-288-46"><a id="__codelineno-288-46" name="__codelineno-288-46" href="#__codelineno-288-46"></a><span class="k">override</span>
</span><span id="__span-288-47"><a id="__codelineno-288-47" name="__codelineno-288-47" href="#__codelineno-288-47"></a><span class="k">params</span>
</span><span id="__span-288-48"><a id="__codelineno-288-48" name="__codelineno-288-48" href="#__codelineno-288-48"></a><span class="k">private</span>
</span><span id="__span-288-49"><a id="__codelineno-288-49" name="__codelineno-288-49" href="#__codelineno-288-49"></a><span class="k">protected</span>
</span><span id="__span-288-50"><a id="__codelineno-288-50" name="__codelineno-288-50" href="#__codelineno-288-50"></a><span class="k">public</span>
</span><span id="__span-288-51"><a id="__codelineno-288-51" name="__codelineno-288-51" href="#__codelineno-288-51"></a><span class="k">readonly</span>
</span><span id="__span-288-52"><a id="__codelineno-288-52" name="__codelineno-288-52" href="#__codelineno-288-52"></a><span class="k">ref</span>
</span><span id="__span-288-53"><a id="__codelineno-288-53" name="__codelineno-288-53" href="#__codelineno-288-53"></a><span class="k">return</span>
</span><span id="__span-288-54"><a id="__codelineno-288-54" name="__codelineno-288-54" href="#__codelineno-288-54"></a><span class="kt">sbyte</span>
</span><span id="__span-288-55"><a id="__codelineno-288-55" name="__codelineno-288-55" href="#__codelineno-288-55"></a><span class="k">sealed</span>
</span><span id="__span-288-56"><a id="__codelineno-288-56" name="__codelineno-288-56" href="#__codelineno-288-56"></a><span class="kt">short</span>
</span><span id="__span-288-57"><a id="__codelineno-288-57" name="__codelineno-288-57" href="#__codelineno-288-57"></a><span class="k">sizeof</span>
</span><span id="__span-288-58"><a id="__codelineno-288-58" name="__codelineno-288-58" href="#__codelineno-288-58"></a><span class="k">stackalloc</span>
</span><span id="__span-288-59"><a id="__codelineno-288-59" name="__codelineno-288-59" href="#__codelineno-288-59"></a><span class="k">static</span>
</span><span id="__span-288-60"><a id="__codelineno-288-60" name="__codelineno-288-60" href="#__codelineno-288-60"></a><span class="kt">string</span>
</span><span id="__span-288-61"><a id="__codelineno-288-61" name="__codelineno-288-61" href="#__codelineno-288-61"></a><span class="k">struct</span>
</span><span id="__span-288-62"><a id="__codelineno-288-62" name="__codelineno-288-62" href="#__codelineno-288-62"></a><span class="nc">switch</span>
</span><span id="__span-288-63"><a id="__codelineno-288-63" name="__codelineno-288-63" href="#__codelineno-288-63"></a><span class="k">this</span>
</span><span id="__span-288-64"><a id="__codelineno-288-64" name="__codelineno-288-64" href="#__codelineno-288-64"></a><span class="k">throw</span>
</span><span id="__span-288-65"><a id="__codelineno-288-65" name="__codelineno-288-65" href="#__codelineno-288-65"></a><span class="k">true</span>
</span><span id="__span-288-66"><a id="__codelineno-288-66" name="__codelineno-288-66" href="#__codelineno-288-66"></a><span class="k">try</span>
</span><span id="__span-288-67"><a id="__codelineno-288-67" name="__codelineno-288-67" href="#__codelineno-288-67"></a><span class="k">typeof</span>
</span><span id="__span-288-68"><a id="__codelineno-288-68" name="__codelineno-288-68" href="#__codelineno-288-68"></a><span class="kt">uint</span>
</span><span id="__span-288-69"><a id="__codelineno-288-69" name="__codelineno-288-69" href="#__codelineno-288-69"></a><span class="kt">ulong</span>
</span><span id="__span-288-70"><a id="__codelineno-288-70" name="__codelineno-288-70" href="#__codelineno-288-70"></a><span class="k">unchecked</span>
</span><span id="__span-288-71"><a id="__codelineno-288-71" name="__codelineno-288-71" href="#__codelineno-288-71"></a><span class="k">unsafe</span>
</span><span id="__span-288-72"><a id="__codelineno-288-72" name="__codelineno-288-72" href="#__codelineno-288-72"></a><span class="kt">ushort</span>
</span><span id="__span-288-73"><a id="__codelineno-288-73" name="__codelineno-288-73" href="#__codelineno-288-73"></a><span class="k">using</span>
</span><span id="__span-288-74"><a id="__codelineno-288-74" name="__codelineno-288-74" href="#__codelineno-288-74"></a><span class="nn">virtual</span>
</span><span id="__span-288-75"><a id="__codelineno-288-75" name="__codelineno-288-75" href="#__codelineno-288-75"></a><span class="k">void</span>
</span><span id="__span-288-76"><a id="__codelineno-288-76" name="__codelineno-288-76" href="#__codelineno-288-76"></a><span class="n">volatile</span>
</span><span id="__span-288-77"><a id="__codelineno-288-77" name="__codelineno-288-77" href="#__codelineno-288-77"></a><span class="k">while</span>
</span></code></pre></div>
</li>
</ul>
<h3 id="avoiding-conflicts">Avoiding conflicts</h3>
<p>If you really want to use an identifier that clashes with a reserved keyword, you can
do so by qualifying it with the @ prefix.</p>
<div class="language-csharp highlight"><pre><span></span><code><span id="__span-289-1"><a id="__codelineno-289-1" name="__codelineno-289-1" href="#__codelineno-289-1"></a><span class="k">class</span><span class="w"> </span><span class="nc">class</span><span class="w"> </span><span class="p">{...}</span><span class="w"> </span><span class="c1">// Illegal</span>
</span><span id="__span-289-2"><a id="__codelineno-289-2" name="__codelineno-289-2" href="#__codelineno-289-2"></a><span class="k">class</span><span class="w"> </span><span class="nc">@class</span><span class="w"> </span><span class="p">{...}</span><span class="w"> </span><span class="c1">// Legal</span>
</span></code></pre></div>
<h3 id="contextual-keywords">Contextual keywords</h3>
<p>Some keywords are contextual, meaning that you also can use them as identifiers without an @ symbol:</p>
<ul>
<li>
<p>Code</p>
<div class="language-csharp highlight"><pre><span></span><code><span id="__span-290-1"><a id="__codelineno-290-1" name="__codelineno-290-1" href="#__codelineno-290-1"></a><span class="k">add</span>
</span><span id="__span-290-2"><a id="__codelineno-290-2" name="__codelineno-290-2" href="#__codelineno-290-2"></a><span class="k">alias</span>
</span><span id="__span-290-3"><a id="__codelineno-290-3" name="__codelineno-290-3" href="#__codelineno-290-3"></a><span class="k">ascending</span>
</span><span id="__span-290-4"><a id="__codelineno-290-4" name="__codelineno-290-4" href="#__codelineno-290-4"></a><span class="k">async</span>
</span><span id="__span-290-5"><a id="__codelineno-290-5" name="__codelineno-290-5" href="#__codelineno-290-5"></a><span class="k">await</span>
</span><span id="__span-290-6"><a id="__codelineno-290-6" name="__codelineno-290-6" href="#__codelineno-290-6"></a><span class="k">by</span>
</span><span id="__span-290-7"><a id="__codelineno-290-7" name="__codelineno-290-7" href="#__codelineno-290-7"></a><span class="k">descending</span>
</span><span id="__span-290-8"><a id="__codelineno-290-8" name="__codelineno-290-8" href="#__codelineno-290-8"></a><span class="kt">dynamic</span>
</span><span id="__span-290-9"><a id="__codelineno-290-9" name="__codelineno-290-9" href="#__codelineno-290-9"></a><span class="k">equals</span>
</span><span id="__span-290-10"><a id="__codelineno-290-10" name="__codelineno-290-10" href="#__codelineno-290-10"></a><span class="k">from</span>
</span><span id="__span-290-11"><a id="__codelineno-290-11" name="__codelineno-290-11" href="#__codelineno-290-11"></a><span class="k">get</span>
</span><span id="__span-290-12"><a id="__codelineno-290-12" name="__codelineno-290-12" href="#__codelineno-290-12"></a><span class="n">global</span>
</span><span id="__span-290-13"><a id="__codelineno-290-13" name="__codelineno-290-13" href="#__codelineno-290-13"></a><span class="k">group</span>
</span><span id="__span-290-14"><a id="__codelineno-290-14" name="__codelineno-290-14" href="#__codelineno-290-14"></a><span class="k">in</span>
</span><span id="__span-290-15"><a id="__codelineno-290-15" name="__codelineno-290-15" href="#__codelineno-290-15"></a><span class="k">into</span>
</span><span id="__span-290-16"><a id="__codelineno-290-16" name="__codelineno-290-16" href="#__codelineno-290-16"></a><span class="k">join</span>
</span><span id="__span-290-17"><a id="__codelineno-290-17" name="__codelineno-290-17" href="#__codelineno-290-17"></a><span class="k">let</span>
</span><span id="__span-290-18"><a id="__codelineno-290-18" name="__codelineno-290-18" href="#__codelineno-290-18"></a><span class="k">nameof</span>
</span><span id="__span-290-19"><a id="__codelineno-290-19" name="__codelineno-290-19" href="#__codelineno-290-19"></a><span class="k">on</span>
</span><span id="__span-290-20"><a id="__codelineno-290-20" name="__codelineno-290-20" href="#__codelineno-290-20"></a><span class="k">orderby</span>
</span><span id="__span-290-21"><a id="__codelineno-290-21" name="__codelineno-290-21" href="#__codelineno-290-21"></a><span class="k">partial</span>
</span><span id="__span-290-22"><a id="__codelineno-290-22" name="__codelineno-290-22" href="#__codelineno-290-22"></a><span class="k">remove</span>
</span><span id="__span-290-23"><a id="__codelineno-290-23" name="__codelineno-290-23" href="#__codelineno-290-23"></a><span class="k">select</span>
</span><span id="__span-290-24"><a id="__codelineno-290-24" name="__codelineno-290-24" href="#__codelineno-290-24"></a><span class="k">set</span>
</span><span id="__span-290-25"><a id="__codelineno-290-25" name="__codelineno-290-25" href="#__codelineno-290-25"></a><span class="k">unmanaged</span>
</span><span id="__span-290-26"><a id="__codelineno-290-26" name="__codelineno-290-26" href="#__codelineno-290-26"></a><span class="k">value</span>
</span><span id="__span-290-27"><a id="__codelineno-290-27" name="__codelineno-290-27" href="#__codelineno-290-27"></a><span class="kt">var</span>
</span><span id="__span-290-28"><a id="__codelineno-290-28" name="__codelineno-290-28" href="#__codelineno-290-28"></a><span class="k">when</span>
</span><span id="__span-290-29"><a id="__codelineno-290-29" name="__codelineno-290-29" href="#__codelineno-290-29"></a><span class="k">where</span>
</span><span id="__span-290-30"><a id="__codelineno-290-30" name="__codelineno-290-30" href="#__codelineno-290-30"></a><span class="k">yield</span>
</span></code></pre></div>
<ul>
<li></li>
</ul>
</li>
</ul>
<h3 id="instance-versus-static-members">Instance versus static members</h3>
<p>The data members and function members that operate on the instance of the type are called instance members. The UnitConverterâ€™s Convert method and the intâ€™s ToString method are examples of instance members. By default, members are instance members.</p>
<p><strong>Data members and function members that donâ€™t operate on the instance of the type but rather on the type itself must be marked as static.</strong> The Test.Main and Console.WriteLine methods are static methods. <strong>The Console class is actually a static class, which means that all of its members are static.</strong> You never actually create instances of a Consoleâ€”one console is shared across the entire application.</p>
<div class="language-csharp highlight"><pre><span></span><code><span id="__span-291-1"><a id="__codelineno-291-1" name="__codelineno-291-1" href="#__codelineno-291-1"></a><span class="k">public</span><span class="w"> </span><span class="k">class</span><span class="w"> </span><span class="nc">Panda</span>
</span><span id="__span-291-2"><a id="__codelineno-291-2" name="__codelineno-291-2" href="#__codelineno-291-2"></a><span class="p">{</span>
</span><span id="__span-291-3"><a id="__codelineno-291-3" name="__codelineno-291-3" href="#__codelineno-291-3"></a><span class="w"> </span><span class="k">public</span><span class="w"> </span><span class="kt">string</span><span class="w"> </span><span class="n">Name</span><span class="p">;</span><span class="w"> </span><span class="c1">// Instance field</span>
</span><span id="__span-291-4"><a id="__codelineno-291-4" name="__codelineno-291-4" href="#__codelineno-291-4"></a><span class="w"> </span><span class="k">public</span><span class="w"> </span><span class="k">static</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">Population</span><span class="p">;</span><span class="w"> </span><span class="c1">// Static field</span>
</span><span id="__span-291-5"><a id="__codelineno-291-5" name="__codelineno-291-5" href="#__codelineno-291-5"></a><span class="w"> </span><span class="k">public</span><span class="w"> </span><span class="nf">Panda</span><span class="w"> </span><span class="p">(</span><span class="kt">string</span><span class="w"> </span><span class="n">n</span><span class="p">)</span><span class="w"> </span><span class="c1">// Constructor</span>
</span><span id="__span-291-6"><a id="__codelineno-291-6" name="__codelineno-291-6" href="#__codelineno-291-6"></a><span class="w"> </span><span class="p">{</span>
</span><span id="__span-291-7"><a id="__codelineno-291-7" name="__codelineno-291-7" href="#__codelineno-291-7"></a><span class="w"> </span><span class="n">Name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">n</span><span class="p">;</span><span class="w"> </span><span class="c1">// Assign the instance field</span>
</span><span id="__span-291-8"><a id="__codelineno-291-8" name="__codelineno-291-8" href="#__codelineno-291-8"></a><span class="w"> </span><span class="n">Population</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Population</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span><span class="w"> </span><span class="c1">// Increment the static Population field</span>
</span><span id="__span-291-9"><a id="__codelineno-291-9" name="__codelineno-291-9" href="#__codelineno-291-9"></a><span class="w"> </span><span class="p">}</span>
</span><span id="__span-291-10"><a id="__codelineno-291-10" name="__codelineno-291-10" href="#__codelineno-291-10"></a><span class="p">}</span>
</span><span id="__span-291-11"><a id="__codelineno-291-11" name="__codelineno-291-11" href="#__codelineno-291-11"></a>
</span><span id="__span-291-12"><a id="__codelineno-291-12" name="__codelineno-291-12" href="#__codelineno-291-12"></a><span class="k">using</span><span class="w"> </span><span class="nn">System</span><span class="p">;</span>
</span><span id="__span-291-13"><a id="__codelineno-291-13" name="__codelineno-291-13" href="#__codelineno-291-13"></a><span class="k">class</span><span class="w"> </span><span class="nc">Test</span>
</span><span id="__span-291-14"><a id="__codelineno-291-14" name="__codelineno-291-14" href="#__codelineno-291-14"></a><span class="p">{</span>
</span><span id="__span-291-15"><a id="__codelineno-291-15" name="__codelineno-291-15" href="#__codelineno-291-15"></a><span class="w"> </span><span class="k">static</span><span class="w"> </span><span class="k">void</span><span class="w"> </span><span class="nf">Main</span><span class="p">()</span>
</span><span id="__span-291-16"><a id="__codelineno-291-16" name="__codelineno-291-16" href="#__codelineno-291-16"></a><span class="w"> </span><span class="p">{</span>
</span><span id="__span-291-17"><a id="__codelineno-291-17" name="__codelineno-291-17" href="#__codelineno-291-17"></a><span class="w"> </span><span class="n">Panda</span><span class="w"> </span><span class="n">p1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">Panda</span><span class="w"> </span><span class="p">(</span><span class="s">&quot;Pan Dee&quot;</span><span class="p">);</span>
</span><span id="__span-291-18"><a id="__codelineno-291-18" name="__codelineno-291-18" href="#__codelineno-291-18"></a><span class="w"> </span><span class="n">Panda</span><span class="w"> </span><span class="n">p2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">Panda</span><span class="w"> </span><span class="p">(</span><span class="s">&quot;Pan Dah&quot;</span><span class="p">);</span>
</span><span id="__span-291-19"><a id="__codelineno-291-19" name="__codelineno-291-19" href="#__codelineno-291-19"></a><span class="w"> </span><span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="w"> </span><span class="p">(</span><span class="n">p1</span><span class="p">.</span><span class="n">Name</span><span class="p">);</span><span class="w"> </span><span class="c1">// Pan Dee</span>
</span><span id="__span-291-20"><a id="__codelineno-291-20" name="__codelineno-291-20" href="#__codelineno-291-20"></a><span class="w"> </span><span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="w"> </span><span class="p">(</span><span class="n">p2</span><span class="p">.</span><span class="n">Name</span><span class="p">);</span><span class="w"> </span><span class="c1">// Pan Dah</span>
</span><span id="__span-291-21"><a id="__codelineno-291-21" name="__codelineno-291-21" href="#__codelineno-291-21"></a><span class="w"> </span><span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="w"> </span><span class="p">(</span><span class="n">Panda</span><span class="p">.</span><span class="n">Population</span><span class="p">);</span><span class="w"> </span><span class="c1">// 2</span>
</span><span id="__span-291-22"><a id="__codelineno-291-22" name="__codelineno-291-22" href="#__codelineno-291-22"></a><span class="w"> </span><span class="p">}</span>
</span><span id="__span-291-23"><a id="__codelineno-291-23" name="__codelineno-291-23" href="#__codelineno-291-23"></a><span class="p">}</span>
</span></code></pre></div>
<h3 id="conversions">Conversions</h3>
<p>C# can convert between instances of compatible types. A conversion always creates
a new value from an existing one. Conversions can be either implicit or explicit:
implicit conversions happen automatically, and explicit conversions require a cast.</p>
<div class="language-csharp highlight"><pre><span></span><code><span id="__span-292-1"><a id="__codelineno-292-1" name="__codelineno-292-1" href="#__codelineno-292-1"></a><span class="kt">int</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">12345</span><span class="p">;</span><span class="w"> </span><span class="c1">// int is a 32-bit integer</span>
</span><span id="__span-292-2"><a id="__codelineno-292-2" name="__codelineno-292-2" href="#__codelineno-292-2"></a><span class="kt">long</span><span class="w"> </span><span class="n">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">x</span><span class="p">;</span><span class="w"> </span><span class="c1">// Implicit conversion to 64-bit integer</span>
</span><span id="__span-292-3"><a id="__codelineno-292-3" name="__codelineno-292-3" href="#__codelineno-292-3"></a><span class="kt">short</span><span class="w"> </span><span class="n">z</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="kt">short</span><span class="p">)</span><span class="n">x</span><span class="p">;</span><span class="w"> </span><span class="c1">// Explicit conversion to 16-bit integer</span>
</span></code></pre></div>
<p>Implicit conversions are allowed when both of the following are true</p>
<ul>
<li>The compiler can guarantee that they will always succeed</li>
<li><strong>No information is lost in conversion</strong></li>
</ul>
<p>Explicit conversions are required when one of the following is true</p>
<ul>
<li>The compiler cannot guarantee that they will always succeed</li>
<li><strong>Information might be lost during conversion</strong></li>
</ul>
<h3 id="overflow-check-operators">Overflow check operators</h3>
<p>The checked operator instructs the runtime to generate an OverflowException
rather than overflowing silently when an integral-type expression or statement
exceeds the arithmetic limits of that type.</p>
<p>You can use checked around either an expression or a statement block</p>
<div class="language-csharp highlight"><pre><span></span><code><span id="__span-293-1"><a id="__codelineno-293-1" name="__codelineno-293-1" href="#__codelineno-293-1"></a><span class="kt">int</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1000000</span><span class="p">;</span>
</span><span id="__span-293-2"><a id="__codelineno-293-2" name="__codelineno-293-2" href="#__codelineno-293-2"></a><span class="kt">int</span><span class="w"> </span><span class="n">b</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1000000</span><span class="p">;</span>
</span><span id="__span-293-3"><a id="__codelineno-293-3" name="__codelineno-293-3" href="#__codelineno-293-3"></a><span class="kt">int</span><span class="w"> </span><span class="n">c</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">checked</span><span class="w"> </span><span class="p">(</span><span class="n">a</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">b</span><span class="p">);</span><span class="w"> </span><span class="c1">// Checks just the expression.</span>
</span><span id="__span-293-4"><a id="__codelineno-293-4" name="__codelineno-293-4" href="#__codelineno-293-4"></a><span class="k">checked</span><span class="w"> </span><span class="c1">// Checks all expressions</span>
</span><span id="__span-293-5"><a id="__codelineno-293-5" name="__codelineno-293-5" href="#__codelineno-293-5"></a><span class="p">{</span><span class="w"> </span><span class="c1">// in statement block.</span>
</span><span id="__span-293-6"><a id="__codelineno-293-6" name="__codelineno-293-6" href="#__codelineno-293-6"></a><span class="w"> </span><span class="p">...</span>
</span><span id="__span-293-7"><a id="__codelineno-293-7" name="__codelineno-293-7" href="#__codelineno-293-7"></a><span class="w"> </span><span class="n">c</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">b</span><span class="p">;</span>
</span><span id="__span-293-8"><a id="__codelineno-293-8" name="__codelineno-293-8" href="#__codelineno-293-8"></a><span class="w"> </span><span class="p">...</span>
</span><span id="__span-293-9"><a id="__codelineno-293-9" name="__codelineno-293-9" href="#__codelineno-293-9"></a><span class="p">}</span>
</span></code></pre></div>
<p>You can make arithmetic overflow checking the default for all expressions in a proâ€
gram by selecting the checked option at the project level (in Visual Studio, go to
Advanced Build Settings). If you then need to disable overflow checking just for
specific expressions or statements, you can do so with the unchecked operator.</p>
<div class="language-csharp highlight"><pre><span></span><code><span id="__span-294-1"><a id="__codelineno-294-1" name="__codelineno-294-1" href="#__codelineno-294-1"></a><span class="kt">int</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kt">int</span><span class="p">.</span><span class="n">MaxValue</span><span class="p">;</span>
</span><span id="__span-294-2"><a id="__codelineno-294-2" name="__codelineno-294-2" href="#__codelineno-294-2"></a><span class="kt">int</span><span class="w"> </span><span class="n">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">unchecked</span><span class="w"> </span><span class="p">(</span><span class="n">x</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="p">);</span>
</span><span id="__span-294-3"><a id="__codelineno-294-3" name="__codelineno-294-3" href="#__codelineno-294-3"></a><span class="k">unchecked</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">z</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span><span class="w"> </span><span class="p">}</span>
</span></code></pre></div>
<p><code>==</code> and <code>!=</code> test for equality and inequality of any type but always return a bool
value.</p>
<div class="language-csharp highlight"><pre><span></span><code><span id="__span-295-1"><a id="__codelineno-295-1" name="__codelineno-295-1" href="#__codelineno-295-1"></a><span class="kt">int</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span>
</span><span id="__span-295-2"><a id="__codelineno-295-2" name="__codelineno-295-2" href="#__codelineno-295-2"></a><span class="kt">int</span><span class="w"> </span><span class="n">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">2</span><span class="p">;</span>
</span><span id="__span-295-3"><a id="__codelineno-295-3" name="__codelineno-295-3" href="#__codelineno-295-3"></a><span class="kt">int</span><span class="w"> </span><span class="n">z</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span>
</span><span id="__span-295-4"><a id="__codelineno-295-4" name="__codelineno-295-4" href="#__codelineno-295-4"></a><span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="w"> </span><span class="p">(</span><span class="n">x</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">y</span><span class="p">);</span><span class="w"> </span><span class="c1">// False</span>
</span><span id="__span-295-5"><a id="__codelineno-295-5" name="__codelineno-295-5" href="#__codelineno-295-5"></a><span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="w"> </span><span class="p">(</span><span class="n">x</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">z</span><span class="p">);</span><span class="w"> </span><span class="c1">// True</span>
</span></code></pre></div>
<p><strong>For reference types, equality, by default, is based on reference, as opposed to the
actual value of the underlying object</strong></p>
<div class="language-csharp highlight"><pre><span></span><code><span id="__span-296-1"><a id="__codelineno-296-1" name="__codelineno-296-1" href="#__codelineno-296-1"></a><span class="k">public</span><span class="w"> </span><span class="k">class</span><span class="w"> </span><span class="nc">Dude</span>
</span><span id="__span-296-2"><a id="__codelineno-296-2" name="__codelineno-296-2" href="#__codelineno-296-2"></a><span class="p">{</span>
</span><span id="__span-296-3"><a id="__codelineno-296-3" name="__codelineno-296-3" href="#__codelineno-296-3"></a><span class="w"> </span><span class="k">public</span><span class="w"> </span><span class="kt">string</span><span class="w"> </span><span class="n">Name</span><span class="p">;</span>
</span><span id="__span-296-4"><a id="__codelineno-296-4" name="__codelineno-296-4" href="#__codelineno-296-4"></a><span class="w"> </span><span class="k">public</span><span class="w"> </span><span class="nf">Dude</span><span class="w"> </span><span class="p">(</span><span class="kt">string</span><span class="w"> </span><span class="n">n</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">Name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">n</span><span class="p">;</span><span class="w"> </span><span class="p">}</span>
</span><span id="__span-296-5"><a id="__codelineno-296-5" name="__codelineno-296-5" href="#__codelineno-296-5"></a><span class="p">}</span>
</span><span id="__span-296-6"><a id="__codelineno-296-6" name="__codelineno-296-6" href="#__codelineno-296-6"></a><span class="p">...</span>
</span><span id="__span-296-7"><a id="__codelineno-296-7" name="__codelineno-296-7" href="#__codelineno-296-7"></a><span class="n">Dude</span><span class="w"> </span><span class="n">d1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">Dude</span><span class="w"> </span><span class="p">(</span><span class="s">&quot;John&quot;</span><span class="p">);</span>
</span><span id="__span-296-8"><a id="__codelineno-296-8" name="__codelineno-296-8" href="#__codelineno-296-8"></a><span class="n">Dude</span><span class="w"> </span><span class="n">d2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">Dude</span><span class="w"> </span><span class="p">(</span><span class="s">&quot;John&quot;</span><span class="p">);</span>
</span><span id="__span-296-9"><a id="__codelineno-296-9" name="__codelineno-296-9" href="#__codelineno-296-9"></a><span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="w"> </span><span class="p">(</span><span class="n">d1</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">d2</span><span class="p">);</span><span class="w"> </span><span class="c1">// False</span>
</span><span id="__span-296-10"><a id="__codelineno-296-10" name="__codelineno-296-10" href="#__codelineno-296-10"></a><span class="n">Dude</span><span class="w"> </span><span class="n">d3</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">d1</span><span class="p">;</span>
</span><span id="__span-296-11"><a id="__codelineno-296-11" name="__codelineno-296-11" href="#__codelineno-296-11"></a><span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="w"> </span><span class="p">(</span><span class="n">d1</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">d3</span><span class="p">);</span><span class="w"> </span><span class="c1">// True</span>
</span></code></pre></div>
<h3 id="conditional-operators">Conditional Operators</h3>
<p>The &amp;&amp; and || operators test for and and or conditions. They are frequently used in
conjunction with the ! operator, which expresses not.</p>
<div class="language-csharp highlight"><pre><span></span><code><span id="__span-297-1"><a id="__codelineno-297-1" name="__codelineno-297-1" href="#__codelineno-297-1"></a><span class="k">static</span><span class="w"> </span><span class="kt">bool</span><span class="w"> </span><span class="nf">UseUmbrella</span><span class="w"> </span><span class="p">(</span><span class="kt">bool</span><span class="w"> </span><span class="n">rainy</span><span class="p">,</span><span class="w"> </span><span class="kt">bool</span><span class="w"> </span><span class="n">sunny</span><span class="p">,</span><span class="w"> </span><span class="kt">bool</span><span class="w"> </span><span class="n">windy</span><span class="p">)</span>
</span><span id="__span-297-2"><a id="__codelineno-297-2" name="__codelineno-297-2" href="#__codelineno-297-2"></a><span class="p">{</span>
</span><span id="__span-297-3"><a id="__codelineno-297-3" name="__codelineno-297-3" href="#__codelineno-297-3"></a><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="o">!</span><span class="n">windy</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="p">(</span><span class="n">rainy</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="n">sunny</span><span class="p">);</span>
</span><span id="__span-297-4"><a id="__codelineno-297-4" name="__codelineno-297-4" href="#__codelineno-297-4"></a><span class="p">}</span>
</span></code></pre></div>
<p>The &amp;&amp; and || operators short-circuit evaluation when possible. In the preceding
example, if it is windy, the expression (rainy || sunny) is not even evaluated.
Short-circuiting is essential in allowing expressions such as the following to run
without throwing a <code>NullReferenceException</code></p>
<p><strong>The &amp; and | operators also test for and and or conditions. The difference is that they do not short-circuit. For this reason, they are rarely used in place of conditional operators.</strong></p>
<div class="language-csharp highlight"><pre><span></span><code><span id="__span-298-1"><a id="__codelineno-298-1" name="__codelineno-298-1" href="#__codelineno-298-1"></a><span class="k">return</span><span class="w"> </span><span class="o">!</span><span class="n">windy</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="p">(</span><span class="n">rainy</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">sunny</span><span class="p">);</span>
</span></code></pre></div>
<h3 id="conditional-operator-ternary-operator">Conditional operator (ternary operator)</h3>
<p>The conditional operator (more commonly called the ternary operator because itâ€™s
the only operator that takes three operands) has the form q ? a : b; thus, if condiâ€
tion q is true, a is evaluated, else b is evaluated:</p>
<div class="language-csharp highlight"><pre><span></span><code><span id="__span-299-1"><a id="__codelineno-299-1" name="__codelineno-299-1" href="#__codelineno-299-1"></a><span class="k">static</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="nf">Max</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">a</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">b</span><span class="p">)</span>
</span><span id="__span-299-2"><a id="__codelineno-299-2" name="__codelineno-299-2" href="#__codelineno-299-2"></a><span class="p">{</span>
</span><span id="__span-299-3"><a id="__codelineno-299-3" name="__codelineno-299-3" href="#__codelineno-299-3"></a><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="p">(</span><span class="n">a</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="n">b</span><span class="p">)</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="n">b</span><span class="p">;</span>
</span><span id="__span-299-4"><a id="__codelineno-299-4" name="__codelineno-299-4" href="#__codelineno-299-4"></a><span class="p">}</span>
</span></code></pre></div>
<h3 id="strings-and-characters">Strings and Characters</h3>
<p>C#â€™s char type (aliasing the System.Char type) represents a Unicode character and
occupies 2 bytes (UTF-16).</p>
<div class="language-csharp highlight"><pre><span></span><code><span id="__span-300-1"><a id="__codelineno-300-1" name="__codelineno-300-1" href="#__codelineno-300-1"></a><span class="kt">char</span><span class="w"> </span><span class="n">c</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="sc">&#39;A&#39;</span><span class="p">;</span><span class="w"> </span><span class="c1">// Simple character</span>
</span></code></pre></div>
<p>Escape sequences express characters that cannot be expressed or interpreted literally.
An escape sequence is a backslash followed by a character with a special meaning</p>
<div class="language-csharp highlight"><pre><span></span><code><span id="__span-301-1"><a id="__codelineno-301-1" name="__codelineno-301-1" href="#__codelineno-301-1"></a><span class="kt">char</span><span class="w"> </span><span class="n">newLine</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="sc">&#39;\n&#39;</span><span class="p">;</span>
</span><span id="__span-301-2"><a id="__codelineno-301-2" name="__codelineno-301-2" href="#__codelineno-301-2"></a><span class="kt">char</span><span class="w"> </span><span class="n">backSlash</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="sc">&#39;\\&#39;</span><span class="p">;</span>
</span></code></pre></div>
<h3 id="escape-sequence-characters">Escape sequence characters</h3>
<div class="language-text highlight"><pre><span></span><code><span id="__span-302-1"><a id="__codelineno-302-1" name="__codelineno-302-1" href="#__codelineno-302-1"></a>Char Meaning Value
</span><span id="__span-302-2"><a id="__codelineno-302-2" name="__codelineno-302-2" href="#__codelineno-302-2"></a>\&#39; Single quote 0x0027
</span><span id="__span-302-3"><a id="__codelineno-302-3" name="__codelineno-302-3" href="#__codelineno-302-3"></a>\&quot; Double quote 0x0022
</span><span id="__span-302-4"><a id="__codelineno-302-4" name="__codelineno-302-4" href="#__codelineno-302-4"></a>\\ Backslash 0x005C
</span><span id="__span-302-5"><a id="__codelineno-302-5" name="__codelineno-302-5" href="#__codelineno-302-5"></a>\0 Null 0x0000
</span><span id="__span-302-6"><a id="__codelineno-302-6" name="__codelineno-302-6" href="#__codelineno-302-6"></a>\a Alert 0x0007
</span><span id="__span-302-7"><a id="__codelineno-302-7" name="__codelineno-302-7" href="#__codelineno-302-7"></a>\b Backspace 0x0008
</span><span id="__span-302-8"><a id="__codelineno-302-8" name="__codelineno-302-8" href="#__codelineno-302-8"></a>\f Form feed 0x000C
</span><span id="__span-302-9"><a id="__codelineno-302-9" name="__codelineno-302-9" href="#__codelineno-302-9"></a>\n Newline 0x000A
</span><span id="__span-302-10"><a id="__codelineno-302-10" name="__codelineno-302-10" href="#__codelineno-302-10"></a>\r Carriage return 0x000D
</span><span id="__span-302-11"><a id="__codelineno-302-11" name="__codelineno-302-11" href="#__codelineno-302-11"></a>\t Horizontal tab 0x0009
</span><span id="__span-302-12"><a id="__codelineno-302-12" name="__codelineno-302-12" href="#__codelineno-302-12"></a>\v Vertical tab 0x000B
</span></code></pre></div>
<div class="language-csharp highlight"><pre><span></span><code><span id="__span-303-1"><a id="__codelineno-303-1" name="__codelineno-303-1" href="#__codelineno-303-1"></a><span class="kt">string</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;Here&#39;s a tab:\t&quot;</span><span class="p">;</span>
</span></code></pre></div>
<h3 id="string-concatenation">String concatenation</h3>
<p>The + operator concatenates two strings:</p>
<div class="language-csharp highlight"><pre><span></span><code><span id="__span-304-1"><a id="__codelineno-304-1" name="__codelineno-304-1" href="#__codelineno-304-1"></a><span class="kt">string</span><span class="w"> </span><span class="n">s</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;a&quot;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s">&quot;b&quot;</span><span class="p">;</span><span class="c1">//ab</span>
</span><span id="__span-304-2"><a id="__codelineno-304-2" name="__codelineno-304-2" href="#__codelineno-304-2"></a><span class="kt">string</span><span class="w"> </span><span class="n">s</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;a&quot;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">5</span><span class="p">;</span><span class="w"> </span><span class="c1">// a5</span>
</span></code></pre></div>
<aside>
âš ï¸ Using the + operator repeatedly to build up a string is inefficient: a better solution is
to use the System.Text.StringBuilder type.

</aside>

<h3 id="string-interpolation">String interpolation</h3>
<p>A string preceded with the $ character is called an interpolated string. Interpolated
strings can include expressions enclosed in braces</p>
<div class="language-csharp highlight"><pre><span></span><code><span id="__span-305-1"><a id="__codelineno-305-1" name="__codelineno-305-1" href="#__codelineno-305-1"></a><span class="kt">int</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">4</span><span class="p">;</span>
</span><span id="__span-305-2"><a id="__codelineno-305-2" name="__codelineno-305-2" href="#__codelineno-305-2"></a><span class="n">Console</span><span class="p">.</span><span class="n">Write</span><span class="w"> </span><span class="p">(</span><span class="s">$&quot;A square has {x} sides&quot;</span><span class="p">);</span><span class="w"> </span><span class="c1">// Prints: A square has 4 sides</span>
</span></code></pre></div>
<h3 id="definite-assignment">Definite Assignment</h3>
<p>C# enforces a definite assignment policy. In practice, this means that outside of an unsafe context, itâ€™s impossible to access uninitialized memory.</p>
<ul>
<li>Local variables must be assigned a value before they can be read.</li>
<li>Function arguments must be supplied when a method is called (unless marked as optional).</li>
<li>All other variables (such as fields and array elements) are automatically initialized by the runtime.</li>
</ul>
<p>For example, the following code results in a compile-time error</p>
<div class="language-csharp highlight"><pre><span></span><code><span id="__span-306-1"><a id="__codelineno-306-1" name="__codelineno-306-1" href="#__codelineno-306-1"></a><span class="k">static</span><span class="w"> </span><span class="k">void</span><span class="w"> </span><span class="nf">Main</span><span class="p">()</span>
</span><span id="__span-306-2"><a id="__codelineno-306-2" name="__codelineno-306-2" href="#__codelineno-306-2"></a><span class="p">{</span>
</span><span id="__span-306-3"><a id="__codelineno-306-3" name="__codelineno-306-3" href="#__codelineno-306-3"></a><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">x</span><span class="p">;</span>
</span><span id="__span-306-4"><a id="__codelineno-306-4" name="__codelineno-306-4" href="#__codelineno-306-4"></a><span class="w"> </span><span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="w"> </span><span class="p">(</span><span class="n">x</span><span class="p">);</span><span class="w"> </span><span class="c1">// Compile-time error</span>
</span><span id="__span-306-5"><a id="__codelineno-306-5" name="__codelineno-306-5" href="#__codelineno-306-5"></a><span class="p">}</span>
</span></code></pre></div>
<p>Fields and array elements are automatically initialized with the default values for
their type. </p>
<div class="language-csharp highlight"><pre><span></span><code><span id="__span-307-1"><a id="__codelineno-307-1" name="__codelineno-307-1" href="#__codelineno-307-1"></a><span class="k">static</span><span class="w"> </span><span class="k">void</span><span class="w"> </span><span class="nf">Main</span><span class="p">()</span>
</span><span id="__span-307-2"><a id="__codelineno-307-2" name="__codelineno-307-2" href="#__codelineno-307-2"></a><span class="p">{</span>
</span><span id="__span-307-3"><a id="__codelineno-307-3" name="__codelineno-307-3" href="#__codelineno-307-3"></a><span class="w"> </span><span class="kt">int</span><span class="p">[]</span><span class="w"> </span><span class="n">ints</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="kt">int</span><span class="p">[</span><span class="mi">2</span><span class="p">];</span>
</span><span id="__span-307-4"><a id="__codelineno-307-4" name="__codelineno-307-4" href="#__codelineno-307-4"></a><span class="w"> </span><span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="w"> </span><span class="p">(</span><span class="n">ints</span><span class="p">[</span><span class="mi">0</span><span class="p">]);</span><span class="w"> </span><span class="c1">// 0</span>
</span><span id="__span-307-5"><a id="__codelineno-307-5" name="__codelineno-307-5" href="#__codelineno-307-5"></a><span class="p">}</span>
</span></code></pre></div>
<p>The following code outputs 0, because fields are implicitly assigned a default value</p>
<div class="language-csharp highlight"><pre><span></span><code><span id="__span-308-1"><a id="__codelineno-308-1" name="__codelineno-308-1" href="#__codelineno-308-1"></a><span class="k">class</span><span class="w"> </span><span class="nc">Test</span>
</span><span id="__span-308-2"><a id="__codelineno-308-2" name="__codelineno-308-2" href="#__codelineno-308-2"></a><span class="p">{</span>
</span><span id="__span-308-3"><a id="__codelineno-308-3" name="__codelineno-308-3" href="#__codelineno-308-3"></a><span class="w"> </span><span class="k">static</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">x</span><span class="p">;</span>
</span><span id="__span-308-4"><a id="__codelineno-308-4" name="__codelineno-308-4" href="#__codelineno-308-4"></a><span class="w"> </span><span class="k">static</span><span class="w"> </span><span class="k">void</span><span class="w"> </span><span class="nf">Main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="w"> </span><span class="p">(</span><span class="n">x</span><span class="p">);</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="c1">// 0</span>
</span><span id="__span-308-5"><a id="__codelineno-308-5" name="__codelineno-308-5" href="#__codelineno-308-5"></a><span class="p">}</span>
</span></code></pre></div>
<h3 id="default-values">Default Values</h3>
<ul>
<li>All reference types : <code>null</code></li>
<li>All numeric and enum types : <code>0</code></li>
<li>char type : <code>\0</code></li>
<li>bool type : <code>False</code></li>
</ul>
<p>You can obtain the default value for any type via the default keyword:</p>
<div class="language-csharp highlight"><pre><span></span><code><span id="__span-309-1"><a id="__codelineno-309-1" name="__codelineno-309-1" href="#__codelineno-309-1"></a><span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="w"> </span><span class="p">(</span><span class="k">default</span><span class="w"> </span><span class="p">(</span><span class="kt">decimal</span><span class="p">));</span><span class="w"> </span><span class="c1">// 0</span>
</span><span id="__span-309-2"><a id="__codelineno-309-2" name="__codelineno-309-2" href="#__codelineno-309-2"></a><span class="kt">decimal</span><span class="w"> </span><span class="n">d</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">default</span><span class="p">;</span>
</span></code></pre></div>
<h3 id="parameters">Parameters</h3>
<p>A method may have a sequence of parameters. Parameters define the set of arguâ€
ments that must be provided for that method.</p>
<p>You can control how parameters are passed with the ref, in, and out modifier</p>
<h3 id="the-out-modifier">The out modifier</h3>
<p>An out argument is like a ref argument except for the following</p>
<ul>
<li>It need not be assigned before going into the function.</li>
<li>It must be assigned before it comes out of the function.</li>
</ul>
<p>The out modifier is most commonly used to get multiple return values back from a
method</p>
<div class="language-csharp highlight"><pre><span></span><code><span id="__span-310-1"><a id="__codelineno-310-1" name="__codelineno-310-1" href="#__codelineno-310-1"></a><span class="k">class</span><span class="w"> </span><span class="nc">Test</span>
</span><span id="__span-310-2"><a id="__codelineno-310-2" name="__codelineno-310-2" href="#__codelineno-310-2"></a><span class="p">{</span>
</span><span id="__span-310-3"><a id="__codelineno-310-3" name="__codelineno-310-3" href="#__codelineno-310-3"></a><span class="w"> </span><span class="k">static</span><span class="w"> </span><span class="k">void</span><span class="w"> </span><span class="nf">Split</span><span class="w"> </span><span class="p">(</span><span class="kt">string</span><span class="w"> </span><span class="n">name</span><span class="p">,</span><span class="w"> </span><span class="k">out</span><span class="w"> </span><span class="kt">string</span><span class="w"> </span><span class="n">firstNames</span><span class="p">,</span>
</span><span id="__span-310-4"><a id="__codelineno-310-4" name="__codelineno-310-4" href="#__codelineno-310-4"></a><span class="w"> </span><span class="k">out</span><span class="w"> </span><span class="kt">string</span><span class="w"> </span><span class="n">lastName</span><span class="p">)</span>
</span><span id="__span-310-5"><a id="__codelineno-310-5" name="__codelineno-310-5" href="#__codelineno-310-5"></a><span class="w"> </span><span class="p">{</span>
</span><span id="__span-310-6"><a id="__codelineno-310-6" name="__codelineno-310-6" href="#__codelineno-310-6"></a><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">name</span><span class="p">.</span><span class="n">LastIndexOf</span><span class="w"> </span><span class="p">(</span><span class="sc">&#39; &#39;</span><span class="p">);</span>
</span><span id="__span-310-7"><a id="__codelineno-310-7" name="__codelineno-310-7" href="#__codelineno-310-7"></a><span class="w"> </span><span class="n">firstNames</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">name</span><span class="p">.</span><span class="n">Substring</span><span class="w"> </span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="n">i</span><span class="p">);</span>
</span><span id="__span-310-8"><a id="__codelineno-310-8" name="__codelineno-310-8" href="#__codelineno-310-8"></a><span class="w"> </span><span class="n">lastName</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">name</span><span class="p">.</span><span class="n">Substring</span><span class="w"> </span><span class="p">(</span><span class="n">i</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="p">);</span>
</span><span id="__span-310-9"><a id="__codelineno-310-9" name="__codelineno-310-9" href="#__codelineno-310-9"></a><span class="w"> </span><span class="p">}</span>
</span><span id="__span-310-10"><a id="__codelineno-310-10" name="__codelineno-310-10" href="#__codelineno-310-10"></a><span class="w"> </span><span class="k">static</span><span class="w"> </span><span class="k">void</span><span class="w"> </span><span class="nf">Main</span><span class="p">()</span>
</span><span id="__span-310-11"><a id="__codelineno-310-11" name="__codelineno-310-11" href="#__codelineno-310-11"></a><span class="w"> </span><span class="p">{</span>
</span><span id="__span-310-12"><a id="__codelineno-310-12" name="__codelineno-310-12" href="#__codelineno-310-12"></a><span class="w"> </span><span class="kt">string</span><span class="w"> </span><span class="n">a</span><span class="p">,</span><span class="w"> </span><span class="n">b</span><span class="p">;</span>
</span><span id="__span-310-13"><a id="__codelineno-310-13" name="__codelineno-310-13" href="#__codelineno-310-13"></a><span class="w"> </span><span class="n">Split</span><span class="w"> </span><span class="p">(</span><span class="s">&quot;Stevie Ray Vaughan&quot;</span><span class="p">,</span><span class="w"> </span><span class="k">out</span><span class="w"> </span><span class="n">a</span><span class="p">,</span><span class="w"> </span><span class="k">out</span><span class="w"> </span><span class="n">b</span><span class="p">);</span>
</span><span id="__span-310-14"><a id="__codelineno-310-14" name="__codelineno-310-14" href="#__codelineno-310-14"></a><span class="w"> </span><span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="w"> </span><span class="p">(</span><span class="n">a</span><span class="p">);</span><span class="w"> </span><span class="c1">// Stevie Ray</span>
</span><span id="__span-310-15"><a id="__codelineno-310-15" name="__codelineno-310-15" href="#__codelineno-310-15"></a><span class="w"> </span><span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="w"> </span><span class="p">(</span><span class="n">b</span><span class="p">);</span><span class="w"> </span><span class="c1">// Vaughan</span>
</span><span id="__span-310-16"><a id="__codelineno-310-16" name="__codelineno-310-16" href="#__codelineno-310-16"></a><span class="w"> </span><span class="p">}</span>
</span><span id="__span-310-17"><a id="__codelineno-310-17" name="__codelineno-310-17" href="#__codelineno-310-17"></a><span class="p">}</span>
</span></code></pre></div>
<p><strong>Like a ref parameter, an out parameter is passed by reference.</strong></p>
<h3 id="out-variables-and-discards">Out variables and discards</h3>
<p>From C# 7, you can declare variables on the fly when calling methods with out parameters. We can shorten the Main method in our preceding example as follows.</p>
<p>When calling methods with multiple out parameters, sometimes youâ€™re not interested in receiving values from all the parameters. In such cases, you can discard the ones in which youâ€™re not interested by using an underscore</p>
<div class="language-csharp highlight"><pre><span></span><code><span id="__span-311-1"><a id="__codelineno-311-1" name="__codelineno-311-1" href="#__codelineno-311-1"></a><span class="n">Split</span><span class="w"> </span><span class="p">(</span><span class="s">&quot;Stevie Ray Vaughan&quot;</span><span class="p">,</span><span class="w"> </span><span class="k">out</span><span class="w"> </span><span class="kt">string</span><span class="w"> </span><span class="n">a</span><span class="p">,</span><span class="w"> </span><span class="k">out</span><span class="w"> </span><span class="n">_</span><span class="p">);</span><span class="w"> </span><span class="c1">// Discard the 2nd param</span>
</span><span id="__span-311-2"><a id="__codelineno-311-2" name="__codelineno-311-2" href="#__codelineno-311-2"></a><span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="w"> </span><span class="p">(</span><span class="n">a</span><span class="p">);</span>
</span></code></pre></div>
<h3 id="the-in-modifier">The in modifier</h3>
<p>An in parameter is similar to a ref parameter except that the argumentâ€™s value can not modified by the method (doing so generates a compile-time error). This modifier is most useful when passing a large value type to the method because <strong>it allows the compiler to avoid the overhead of copying the argument prior to passing it in while still protecting the original value from modification</strong>.</p>
<p>Overloading solely on the presence of in is permitted</p>
<div class="language-csharp highlight"><pre><span></span><code><span id="__span-312-1"><a id="__codelineno-312-1" name="__codelineno-312-1" href="#__codelineno-312-1"></a><span class="k">void</span><span class="w"> </span><span class="nf">Foo</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">SomeBigStruct</span><span class="w"> </span><span class="n">a</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="p">...</span><span class="w"> </span><span class="p">}</span>
</span><span id="__span-312-2"><a id="__codelineno-312-2" name="__codelineno-312-2" href="#__codelineno-312-2"></a><span class="k">void</span><span class="w"> </span><span class="nf">Foo</span><span class="w"> </span><span class="p">(</span><span class="k">in</span><span class="w"> </span><span class="n">SomeBigStruct</span><span class="w"> </span><span class="n">a</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="p">...</span><span class="w"> </span><span class="p">}</span>
</span><span id="__span-312-3"><a id="__codelineno-312-3" name="__codelineno-312-3" href="#__codelineno-312-3"></a><span class="n">SomeBigStruct</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">...;</span>
</span><span id="__span-312-4"><a id="__codelineno-312-4" name="__codelineno-312-4" href="#__codelineno-312-4"></a><span class="n">Foo</span><span class="w"> </span><span class="p">(</span><span class="n">x</span><span class="p">);</span><span class="w"> </span><span class="c1">// Calls the first overload</span>
</span><span id="__span-312-5"><a id="__codelineno-312-5" name="__codelineno-312-5" href="#__codelineno-312-5"></a><span class="n">Foo</span><span class="w"> </span><span class="p">(</span><span class="k">in</span><span class="w"> </span><span class="n">x</span><span class="p">);</span><span class="w"> </span><span class="c1">// Calls the second overload</span>
</span></code></pre></div>
<h3 id="named-arguments">Named arguments</h3>
<div class="language-csharp highlight"><pre><span></span><code><span id="__span-313-1"><a id="__codelineno-313-1" name="__codelineno-313-1" href="#__codelineno-313-1"></a><span class="k">void</span><span class="w"> </span><span class="nf">Foo</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">y</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="w"> </span><span class="p">(</span><span class="n">x</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s">&quot;, &quot;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">y</span><span class="p">);</span><span class="w"> </span><span class="p">}</span>
</span><span id="__span-313-2"><a id="__codelineno-313-2" name="__codelineno-313-2" href="#__codelineno-313-2"></a><span class="k">void</span><span class="w"> </span><span class="nf">Test</span><span class="p">()</span>
</span><span id="__span-313-3"><a id="__codelineno-313-3" name="__codelineno-313-3" href="#__codelineno-313-3"></a><span class="p">{</span>
</span><span id="__span-313-4"><a id="__codelineno-313-4" name="__codelineno-313-4" href="#__codelineno-313-4"></a><span class="w"> </span><span class="n">Foo</span><span class="w"> </span><span class="p">(</span><span class="n">x</span><span class="p">:</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="p">:</span><span class="mi">2</span><span class="p">);</span><span class="w"> </span><span class="c1">// 1, 2</span>
</span><span id="__span-313-5"><a id="__codelineno-313-5" name="__codelineno-313-5" href="#__codelineno-313-5"></a><span class="p">}</span>
</span></code></pre></div>
<p><strong>Named arguments can occur in any order.</strong> The following calls to Foo are semantically identical:</p>
<div class="language-csharp highlight"><pre><span></span><code><span id="__span-314-1"><a id="__codelineno-314-1" name="__codelineno-314-1" href="#__codelineno-314-1"></a><span class="n">Foo</span><span class="w"> </span><span class="p">(</span><span class="n">x</span><span class="p">:</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="p">:</span><span class="mi">2</span><span class="p">);</span>
</span><span id="__span-314-2"><a id="__codelineno-314-2" name="__codelineno-314-2" href="#__codelineno-314-2"></a><span class="n">Foo</span><span class="w"> </span><span class="p">(</span><span class="n">y</span><span class="p">:</span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="n">x</span><span class="p">:</span><span class="mi">1</span><span class="p">);</span>
</span></code></pre></div>
<aside>
ðŸ’¡ Named arguments are particularly useful in conjunction with optional parameters.
For instance, consider the following method

</aside>

<div class="language-csharp highlight"><pre><span></span><code><span id="__span-315-1"><a id="__codelineno-315-1" name="__codelineno-315-1" href="#__codelineno-315-1"></a><span class="k">void</span><span class="w"> </span><span class="nf">Bar</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">b</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">c</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">d</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="p">...</span><span class="w"> </span><span class="p">}</span>
</span><span id="__span-315-2"><a id="__codelineno-315-2" name="__codelineno-315-2" href="#__codelineno-315-2"></a><span class="n">Bar</span><span class="w"> </span><span class="p">(</span><span class="n">d</span><span class="p">:</span><span class="mi">3</span><span class="p">);</span>
</span></code></pre></div>
<h3 id="var-implicitly-typed-local-variables">var Implicitly Typed Local Variables</h3>
<p>It is often the case that you declare and initialize a variable in one step. If the compiler is able to infer the type from the initialization expression, you can use the keyword var in place of the type declaration.</p>
<div class="language-csharp highlight"><pre><span></span><code><span id="__span-316-1"><a id="__codelineno-316-1" name="__codelineno-316-1" href="#__codelineno-316-1"></a><span class="kt">var</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;hello&quot;</span><span class="p">;</span>
</span><span id="__span-316-2"><a id="__codelineno-316-2" name="__codelineno-316-2" href="#__codelineno-316-2"></a><span class="kt">var</span><span class="w"> </span><span class="n">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">System</span><span class="p">.</span><span class="n">Text</span><span class="p">.</span><span class="n">StringBuilder</span><span class="p">();</span>
</span><span id="__span-316-3"><a id="__codelineno-316-3" name="__codelineno-316-3" href="#__codelineno-316-3"></a><span class="kt">var</span><span class="w"> </span><span class="n">z</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="kt">float</span><span class="p">)</span><span class="n">Math</span><span class="p">.</span><span class="n">PI</span><span class="p">;</span>
</span></code></pre></div>
<h3 id="null-operators">Null Operators</h3>
<h3 id="null-coalescing-operator">Null-Coalescing Operator</h3>
<p>The <code>??</code> operator is the null-coalescing operator. It says, â€œIf the operand to the left is non-null, give it to me; otherwise, give me another value.â€</p>
<div class="language-csharp highlight"><pre><span></span><code><span id="__span-317-1"><a id="__codelineno-317-1" name="__codelineno-317-1" href="#__codelineno-317-1"></a><span class="kt">string</span><span class="w"> </span><span class="n">s1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">null</span><span class="p">;</span>
</span><span id="__span-317-2"><a id="__codelineno-317-2" name="__codelineno-317-2" href="#__codelineno-317-2"></a><span class="kt">string</span><span class="w"> </span><span class="n">s2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">s1</span><span class="w"> </span><span class="o">??</span><span class="w"> </span><span class="s">&quot;nothing&quot;</span><span class="p">;</span><span class="w"> </span><span class="c1">// s2 evaluates to &quot;nothing&quot;</span>
</span></code></pre></div>
<h3 id="null-coalescing-assignment-operator">Null-Coalescing Assignment Operator</h3>
<p>The <code>??=</code> operator is the null-coalescing assignment operator. It says, â€œIf the operand to the left is null, assign the right operand to the left operand.â€</p>
<div class="language-csharp highlight"><pre><span></span><code><span id="__span-318-1"><a id="__codelineno-318-1" name="__codelineno-318-1" href="#__codelineno-318-1"></a><span class="kt">string</span><span class="w"> </span><span class="n">s1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">null</span><span class="p">;</span>
</span><span id="__span-318-2"><a id="__codelineno-318-2" name="__codelineno-318-2" href="#__codelineno-318-2"></a><span class="n">s1</span><span class="w"> </span><span class="o">??=</span><span class="w"> </span><span class="s">&quot;something&quot;</span><span class="p">;</span>
</span><span id="__span-318-3"><a id="__codelineno-318-3" name="__codelineno-318-3" href="#__codelineno-318-3"></a><span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="w"> </span><span class="p">(</span><span class="n">s1</span><span class="p">);</span><span class="w"> </span><span class="c1">// something</span>
</span><span id="__span-318-4"><a id="__codelineno-318-4" name="__codelineno-318-4" href="#__codelineno-318-4"></a><span class="n">s1</span><span class="w"> </span><span class="o">??=</span><span class="w"> </span><span class="s">&quot;everything&quot;</span><span class="p">;</span>
</span><span id="__span-318-5"><a id="__codelineno-318-5" name="__codelineno-318-5" href="#__codelineno-318-5"></a><span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="w"> </span><span class="p">(</span><span class="n">s1</span><span class="p">);</span><span class="w"> </span><span class="c1">// something</span>
</span></code></pre></div>
<h3 id="null-conditional-operator">Null-Conditional Operator</h3>
<p>The <code>?.</code> operator is the null-conditional or â€œElvisâ€ operator (after the Elvis emoticon).
It allows you to call methods and access members just like the standard dot operator
except that if the operand on the left is null, the expression evaluates to null instead
of throwing a NullReferenceException</p>
<div class="language-csharp highlight"><pre><span></span><code><span id="__span-319-1"><a id="__codelineno-319-1" name="__codelineno-319-1" href="#__codelineno-319-1"></a><span class="n">System</span><span class="p">.</span><span class="n">Text</span><span class="p">.</span><span class="n">StringBuilder</span><span class="w"> </span><span class="n">sb</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">null</span><span class="p">;</span>
</span><span id="__span-319-2"><a id="__codelineno-319-2" name="__codelineno-319-2" href="#__codelineno-319-2"></a><span class="kt">string</span><span class="w"> </span><span class="n">s</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">sb</span><span class="o">?.</span><span class="n">ToString</span><span class="p">();</span><span class="w"> </span><span class="c1">// No error; s instead evaluates to null</span>
</span><span id="__span-319-3"><a id="__codelineno-319-3" name="__codelineno-319-3" href="#__codelineno-319-3"></a><span class="c1">//The last line is equivalent to the following</span>
</span><span id="__span-319-4"><a id="__codelineno-319-4" name="__codelineno-319-4" href="#__codelineno-319-4"></a><span class="kt">string</span><span class="w"> </span><span class="n">s</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">sb</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="k">null</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="k">null</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="n">sb</span><span class="p">.</span><span class="n">ToString</span><span class="p">());</span>
</span></code></pre></div>
<h3 id="namespaces">Namespaces</h3>
<p>A namespace is a domain for type names. Types are typically organized into hierâ€
archical namespaces, making them easier to find and avoiding conflicts.</p>
<ul>
<li>Namespaces are independent of assemblies, which are units of
deployment such as an .exe or .dll</li>
<li>Namespaces also have no impact on member visibilityâ€”
public, internal, private, and so on.</li>
</ul>
<div class="language-csharp highlight"><pre><span></span><code><span id="__span-320-1"><a id="__codelineno-320-1" name="__codelineno-320-1" href="#__codelineno-320-1"></a><span class="k">namespace</span><span class="w"> </span><span class="nn">Outer.Middle.Inner</span>
</span><span id="__span-320-2"><a id="__codelineno-320-2" name="__codelineno-320-2" href="#__codelineno-320-2"></a><span class="p">{</span>
</span><span id="__span-320-3"><a id="__codelineno-320-3" name="__codelineno-320-3" href="#__codelineno-320-3"></a><span class="w"> </span><span class="k">class</span><span class="w"> </span><span class="nc">Class1</span><span class="w"> </span><span class="p">{}</span>
</span><span id="__span-320-4"><a id="__codelineno-320-4" name="__codelineno-320-4" href="#__codelineno-320-4"></a><span class="w"> </span><span class="k">class</span><span class="w"> </span><span class="nc">Class2</span><span class="w"> </span><span class="p">{}</span>
</span><span id="__span-320-5"><a id="__codelineno-320-5" name="__codelineno-320-5" href="#__codelineno-320-5"></a><span class="p">}</span>
</span></code></pre></div>
<p>The dots in the namespace indicate a hierarchy of nested namespaces. The code that follows is semantically identical to the preceding example</p>
<div class="language-csharp highlight"><pre><span></span><code><span id="__span-321-1"><a id="__codelineno-321-1" name="__codelineno-321-1" href="#__codelineno-321-1"></a><span class="k">namespace</span><span class="w"> </span><span class="nn">Outer</span>
</span><span id="__span-321-2"><a id="__codelineno-321-2" name="__codelineno-321-2" href="#__codelineno-321-2"></a><span class="p">{</span>
</span><span id="__span-321-3"><a id="__codelineno-321-3" name="__codelineno-321-3" href="#__codelineno-321-3"></a><span class="w"> </span><span class="k">namespace</span><span class="w"> </span><span class="nn">Middle</span>
</span><span id="__span-321-4"><a id="__codelineno-321-4" name="__codelineno-321-4" href="#__codelineno-321-4"></a><span class="w"> </span><span class="p">{</span>
</span><span id="__span-321-5"><a id="__codelineno-321-5" name="__codelineno-321-5" href="#__codelineno-321-5"></a><span class="w"> </span><span class="k">namespace</span><span class="w"> </span><span class="nn">Inner</span>
</span><span id="__span-321-6"><a id="__codelineno-321-6" name="__codelineno-321-6" href="#__codelineno-321-6"></a><span class="w"> </span><span class="p">{</span>
</span><span id="__span-321-7"><a id="__codelineno-321-7" name="__codelineno-321-7" href="#__codelineno-321-7"></a><span class="w"> </span><span class="k">class</span><span class="w"> </span><span class="nc">Class1</span><span class="w"> </span><span class="p">{}</span>
</span><span id="__span-321-8"><a id="__codelineno-321-8" name="__codelineno-321-8" href="#__codelineno-321-8"></a><span class="w"> </span><span class="k">class</span><span class="w"> </span><span class="nc">Class2</span><span class="w"> </span><span class="p">{}</span>
</span><span id="__span-321-9"><a id="__codelineno-321-9" name="__codelineno-321-9" href="#__codelineno-321-9"></a><span class="w"> </span><span class="p">}</span>
</span><span id="__span-321-10"><a id="__codelineno-321-10" name="__codelineno-321-10" href="#__codelineno-321-10"></a><span class="w"> </span><span class="p">}</span>
</span><span id="__span-321-11"><a id="__codelineno-321-11" name="__codelineno-321-11" href="#__codelineno-321-11"></a><span class="p">}</span>
</span></code></pre></div>
<h3 id="repeated-namespaces">Repeated namespaces</h3>
<div class="language-csharp highlight"><pre><span></span><code><span id="__span-322-1"><a id="__codelineno-322-1" name="__codelineno-322-1" href="#__codelineno-322-1"></a><span class="k">namespace</span><span class="w"> </span><span class="nn">Outer.Middle.Inner</span>
</span><span id="__span-322-2"><a id="__codelineno-322-2" name="__codelineno-322-2" href="#__codelineno-322-2"></a><span class="p">{</span>
</span><span id="__span-322-3"><a id="__codelineno-322-3" name="__codelineno-322-3" href="#__codelineno-322-3"></a><span class="w"> </span><span class="k">class</span><span class="w"> </span><span class="nc">Class1</span><span class="w"> </span><span class="p">{}</span>
</span><span id="__span-322-4"><a id="__codelineno-322-4" name="__codelineno-322-4" href="#__codelineno-322-4"></a><span class="p">}</span>
</span><span id="__span-322-5"><a id="__codelineno-322-5" name="__codelineno-322-5" href="#__codelineno-322-5"></a><span class="k">namespace</span><span class="w"> </span><span class="nn">Outer.Middle.Inner</span>
</span><span id="__span-322-6"><a id="__codelineno-322-6" name="__codelineno-322-6" href="#__codelineno-322-6"></a><span class="p">{</span>
</span><span id="__span-322-7"><a id="__codelineno-322-7" name="__codelineno-322-7" href="#__codelineno-322-7"></a><span class="w"> </span><span class="k">class</span><span class="w"> </span><span class="nc">Class2</span><span class="w"> </span><span class="p">{}</span>
</span><span id="__span-322-8"><a id="__codelineno-322-8" name="__codelineno-322-8" href="#__codelineno-322-8"></a><span class="p">}</span>
</span></code></pre></div>
<p>We can even break the example into two source files such that we could compile
each class into a different assembly.</p>
<div class="language-csharp highlight"><pre><span></span><code><span id="__span-323-1"><a id="__codelineno-323-1" name="__codelineno-323-1" href="#__codelineno-323-1"></a><span class="c1">//Source file 1:</span>
</span><span id="__span-323-2"><a id="__codelineno-323-2" name="__codelineno-323-2" href="#__codelineno-323-2"></a><span class="k">namespace</span><span class="w"> </span><span class="nn">Outer.Middle.Inner</span>
</span><span id="__span-323-3"><a id="__codelineno-323-3" name="__codelineno-323-3" href="#__codelineno-323-3"></a><span class="p">{</span>
</span><span id="__span-323-4"><a id="__codelineno-323-4" name="__codelineno-323-4" href="#__codelineno-323-4"></a><span class="k">class</span><span class="w"> </span><span class="nc">Class1</span><span class="w"> </span><span class="p">{}</span>
</span><span id="__span-323-5"><a id="__codelineno-323-5" name="__codelineno-323-5" href="#__codelineno-323-5"></a><span class="p">}</span>
</span><span id="__span-323-6"><a id="__codelineno-323-6" name="__codelineno-323-6" href="#__codelineno-323-6"></a><span class="c1">//Source file 2:</span>
</span><span id="__span-323-7"><a id="__codelineno-323-7" name="__codelineno-323-7" href="#__codelineno-323-7"></a><span class="k">namespace</span><span class="w"> </span><span class="nn">Outer.Middle.Inner</span>
</span><span id="__span-323-8"><a id="__codelineno-323-8" name="__codelineno-323-8" href="#__codelineno-323-8"></a><span class="p">{</span>
</span><span id="__span-323-9"><a id="__codelineno-323-9" name="__codelineno-323-9" href="#__codelineno-323-9"></a><span class="w"> </span><span class="k">class</span><span class="w"> </span><span class="nc">Class2</span><span class="w"> </span><span class="p">{}</span>
</span><span id="__span-323-10"><a id="__codelineno-323-10" name="__codelineno-323-10" href="#__codelineno-323-10"></a><span class="p">}</span>
</span><span id="__span-323-11"><a id="__codelineno-323-11" name="__codelineno-323-11" href="#__codelineno-323-11"></a><span class="err">```#</span><span class="w"> </span><span class="n">Chapter</span><span class="w"> </span><span class="mi">20</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="n">Dynamic</span><span class="w"> </span><span class="n">Programming</span>
</span><span id="__span-323-12"><a id="__codelineno-323-12" name="__codelineno-323-12" href="#__codelineno-323-12"></a>
</span><span id="__span-323-13"><a id="__codelineno-323-13" name="__codelineno-323-13" href="#__codelineno-323-13"></a><span class="n">In</span><span class="w"> </span><span class="k">this</span><span class="w"> </span><span class="n">chapter</span><span class="p">,</span><span class="w"> </span><span class="n">we</span><span class="w"> </span><span class="n">look</span><span class="w"> </span><span class="n">briefly</span><span class="w"> </span><span class="n">at</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">Dynamic</span><span class="w"> </span><span class="n">Language</span><span class="w"> </span><span class="n">Runtime</span><span class="w"> </span><span class="k">and</span><span class="w"> </span><span class="n">then</span><span class="w"> </span><span class="n">explore</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">following</span><span class="w"> </span><span class="kt">dynamic</span><span class="w"> </span><span class="n">programming</span><span class="w"> </span><span class="n">patterns</span><span class="p">:</span>
</span><span id="__span-323-14"><a id="__codelineno-323-14" name="__codelineno-323-14" href="#__codelineno-323-14"></a>
</span><span id="__span-323-15"><a id="__codelineno-323-15" name="__codelineno-323-15" href="#__codelineno-323-15"></a><span class="err">#</span><span class="w"> </span><span class="n">The</span><span class="w"> </span><span class="n">Dynamic</span><span class="w"> </span><span class="n">Language</span><span class="w"> </span><span class="n">Runtime</span>
</span><span id="__span-323-16"><a id="__codelineno-323-16" name="__codelineno-323-16" href="#__codelineno-323-16"></a>
</span><span id="__span-323-17"><a id="__codelineno-323-17" name="__codelineno-323-17" href="#__codelineno-323-17"></a><span class="n">C</span><span class="err">#</span><span class="w"> </span><span class="n">relies</span><span class="w"> </span><span class="k">on</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">Dynamic</span><span class="w"> </span><span class="n">Language</span><span class="w"> </span><span class="n">Runtime</span><span class="w"> </span><span class="p">(</span><span class="n">DLR</span><span class="p">)</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">perform</span><span class="w"> </span><span class="kt">dynamic</span><span class="w"> </span><span class="n">binding</span>
</span><span id="__span-323-18"><a id="__codelineno-323-18" name="__codelineno-323-18" href="#__codelineno-323-18"></a>
</span><span id="__span-323-19"><a id="__codelineno-323-19" name="__codelineno-323-19" href="#__codelineno-323-19"></a><span class="n">Contrary</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">its</span><span class="w"> </span><span class="n">name</span><span class="p">,</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="o">**</span><span class="n">DLR</span><span class="w"> </span><span class="k">is</span><span class="w"> </span><span class="k">not</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="kt">dynamic</span><span class="w"> </span><span class="n">version</span><span class="w"> </span><span class="n">of</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">CLR</span><span class="p">.</span><span class="w"> </span><span class="n">Rather</span><span class="p">,</span><span class="w"> </span><span class="n">it</span><span class="err">â€™</span><span class="n">s</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">library</span><span class="w"> </span><span class="n">that</span><span class="w"> </span><span class="n">sits</span><span class="w"> </span><span class="n">atop</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">CLR</span><span class="o">**</span><span class="err">â€”</span><span class="n">just</span><span class="w"> </span><span class="n">like</span><span class="w"> </span><span class="n">any</span><span class="w"> </span><span class="n">other</span><span class="w"> </span><span class="n">library</span><span class="w"> </span><span class="n">such</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">System</span><span class="p">.</span><span class="n">Xml</span><span class="p">.</span><span class="n">dll</span><span class="p">.</span><span class="w"> </span><span class="n">Its</span><span class="w"> </span><span class="n">primary</span><span class="w"> </span><span class="n">role</span><span class="w"> </span><span class="k">is</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">provide</span><span class="w"> </span><span class="n">runtime</span><span class="w"> </span><span class="n">services</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">unify</span><span class="w"> </span><span class="kt">dynamic</span><span class="w"> </span><span class="n">programming</span><span class="err">â€”</span><span class="k">in</span><span class="w"> </span><span class="n">both</span><span class="w"> </span><span class="n">statically</span><span class="w"> </span><span class="k">and</span><span class="w"> </span><span class="n">dynamically</span><span class="w"> </span><span class="n">typed</span><span class="w"> </span><span class="n">languages</span><span class="p">.</span><span class="w"> </span><span class="n">Hence</span><span class="p">,</span><span class="w"> </span><span class="n">languages</span><span class="w"> </span><span class="n">such</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">C</span><span class="err">#</span><span class="p">,</span><span class="w"> </span><span class="n">Visual</span><span class="w"> </span><span class="n">Basic</span><span class="p">,</span><span class="w"> </span><span class="n">IronPython</span><span class="p">,</span><span class="w"> </span><span class="k">and</span><span class="w"> </span><span class="n">IronRuby</span><span class="w"> </span><span class="n">all</span><span class="w"> </span><span class="n">use</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">same</span><span class="w"> </span><span class="n">protocol</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">calling</span><span class="w"> </span><span class="n">functions</span><span class="w"> </span><span class="n">dynamically</span><span class="p">.</span><span class="w"> </span><span class="n">This</span><span class="w"> </span><span class="k">allows</span><span class="w"> </span><span class="n">them</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">share</span><span class="w"> </span><span class="n">libraries</span><span class="w"> </span><span class="k">and</span><span class="w"> </span><span class="n">call</span><span class="w"> </span><span class="n">code</span><span class="w"> </span><span class="n">written</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">other</span><span class="w"> </span><span class="n">languages</span><span class="p">.</span>
</span><span id="__span-323-20"><a id="__codelineno-323-20" name="__codelineno-323-20" href="#__codelineno-323-20"></a>
</span><span id="__span-323-21"><a id="__codelineno-323-21" name="__codelineno-323-21" href="#__codelineno-323-21"></a><span class="err">#</span><span class="w"> </span><span class="n">Numeric</span><span class="w"> </span><span class="n">Type</span><span class="w"> </span><span class="n">Unification</span>
</span><span id="__span-323-22"><a id="__codelineno-323-22" name="__codelineno-323-22" href="#__codelineno-323-22"></a>
</span><span id="__span-323-23"><a id="__codelineno-323-23" name="__codelineno-323-23" href="#__codelineno-323-23"></a><span class="err">```</span><span class="n">csharp</span>
</span><span id="__span-323-24"><a id="__codelineno-323-24" name="__codelineno-323-24" href="#__codelineno-323-24"></a><span class="k">static</span><span class="w"> </span><span class="kt">dynamic</span><span class="w"> </span><span class="nf">Mean</span><span class="w"> </span><span class="p">(</span><span class="kt">dynamic</span><span class="w"> </span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="kt">dynamic</span><span class="w"> </span><span class="n">y</span><span class="p">)</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="p">(</span><span class="n">x</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">y</span><span class="p">)</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="mi">2</span><span class="p">;</span>
</span><span id="__span-323-25"><a id="__codelineno-323-25" name="__codelineno-323-25" href="#__codelineno-323-25"></a><span class="k">static</span><span class="w"> </span><span class="k">void</span><span class="w"> </span><span class="nf">Main</span><span class="p">()</span>
</span><span id="__span-323-26"><a id="__codelineno-323-26" name="__codelineno-323-26" href="#__codelineno-323-26"></a><span class="p">{</span>
</span><span id="__span-323-27"><a id="__codelineno-323-27" name="__codelineno-323-27" href="#__codelineno-323-27"></a><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">3</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">5</span><span class="p">;</span>
</span><span id="__span-323-28"><a id="__codelineno-323-28" name="__codelineno-323-28" href="#__codelineno-323-28"></a><span class="w"> </span><span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="w"> </span><span class="p">(</span><span class="n">Mean</span><span class="w"> </span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="p">));</span>
</span><span id="__span-323-29"><a id="__codelineno-323-29" name="__codelineno-323-29" href="#__codelineno-323-29"></a><span class="p">}</span>
</span></code></pre></div>
<p>However, this (unnecessarily) sacrifices static type safety. The following compiles without error but then fails at runtime:</p>
<div class="language-csharp highlight"><pre><span></span><code><span id="__span-324-1"><a id="__codelineno-324-1" name="__codelineno-324-1" href="#__codelineno-324-1"></a><span class="kt">string</span><span class="w"> </span><span class="n">s</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Mean</span><span class="w"> </span><span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="w"> </span><span class="mi">5</span><span class="p">);</span><span class="w"> </span><span class="c1">// Runtime error!</span>
</span></code></pre></div>
<p>We can fix this by introducing a generic type parameter and then casting to dynamic within the calculation itself:</p>
<div class="language-csharp highlight"><pre><span></span><code><span id="__span-325-1"><a id="__codelineno-325-1" name="__codelineno-325-1" href="#__codelineno-325-1"></a><span class="k">static</span><span class="w"> </span><span class="n">T</span><span class="w"> </span><span class="n">Mean</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span><span class="w"> </span><span class="p">(</span><span class="n">T</span><span class="w"> </span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="n">T</span><span class="w"> </span><span class="n">y</span><span class="p">)</span>
</span><span id="__span-325-2"><a id="__codelineno-325-2" name="__codelineno-325-2" href="#__codelineno-325-2"></a><span class="p">{</span>
</span><span id="__span-325-3"><a id="__codelineno-325-3" name="__codelineno-325-3" href="#__codelineno-325-3"></a><span class="w"> </span><span class="kt">dynamic</span><span class="w"> </span><span class="n">result</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">((</span><span class="kt">dynamic</span><span class="p">)</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">y</span><span class="p">)</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="mi">2</span><span class="p">;</span>
</span><span id="__span-325-4"><a id="__codelineno-325-4" name="__codelineno-325-4" href="#__codelineno-325-4"></a><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="p">(</span><span class="n">T</span><span class="p">)</span><span class="w"> </span><span class="n">result</span><span class="p">;</span>
</span><span id="__span-325-5"><a id="__codelineno-325-5" name="__codelineno-325-5" href="#__codelineno-325-5"></a><span class="p">}</span>
</span></code></pre></div>
<p>Dynamic binding incurs a small performance hitâ€”even with call-site caching. You can mitigate this by adding statically typed overloads that cover just the most comâ€ monly used types. For example, if subsequent performance profiling showed that calling Mean with doubles was a bottleneck, you could add the following overload:</p>
<div class="language-csharp highlight"><pre><span></span><code><span id="__span-326-1"><a id="__codelineno-326-1" name="__codelineno-326-1" href="#__codelineno-326-1"></a><span class="k">static</span><span class="w"> </span><span class="kt">double</span><span class="w"> </span><span class="nf">Mean</span><span class="w"> </span><span class="p">(</span><span class="kt">double</span><span class="w"> </span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="kt">double</span><span class="w"> </span><span class="n">y</span><span class="p">)</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="p">(</span><span class="n">x</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">y</span><span class="p">)</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="mi">2</span><span class="p">;</span>
</span></code></pre></div>
<p>The compiler will favor that overload when Mean is called with arguments that are known at compile time to be of type double.</p>
<h1 id="implementing-dynamic-objects">Implementing Dynamic Objects</h1>
<p>An object can provide its binding semantics by implementing IDynamicMetaObject Providerâ€”or more easily by subclassing DynamicObject, which provides a default implementation of this interface. This is demonstrated briefly in Chapter 4 via the following example:</p>
<div class="language-csharp highlight"><pre><span></span><code><span id="__span-327-1"><a id="__codelineno-327-1" name="__codelineno-327-1" href="#__codelineno-327-1"></a><span class="k">static</span><span class="w"> </span><span class="k">void</span><span class="w"> </span><span class="nf">Main</span><span class="p">()</span>
</span><span id="__span-327-2"><a id="__codelineno-327-2" name="__codelineno-327-2" href="#__codelineno-327-2"></a><span class="p">{</span>
</span><span id="__span-327-3"><a id="__codelineno-327-3" name="__codelineno-327-3" href="#__codelineno-327-3"></a><span class="w"> </span><span class="kt">dynamic</span><span class="w"> </span><span class="n">d</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">Duck</span><span class="p">();</span>
</span><span id="__span-327-4"><a id="__codelineno-327-4" name="__codelineno-327-4" href="#__codelineno-327-4"></a><span class="w"> </span><span class="n">d</span><span class="p">.</span><span class="n">Quack</span><span class="p">();</span><span class="w"> </span><span class="c1">// Quack method was called</span>
</span><span id="__span-327-5"><a id="__codelineno-327-5" name="__codelineno-327-5" href="#__codelineno-327-5"></a><span class="w"> </span><span class="n">d</span><span class="p">.</span><span class="n">Waddle</span><span class="p">();</span><span class="w"> </span><span class="c1">// Waddle method was called</span>
</span><span id="__span-327-6"><a id="__codelineno-327-6" name="__codelineno-327-6" href="#__codelineno-327-6"></a><span class="p">}</span>
</span><span id="__span-327-7"><a id="__codelineno-327-7" name="__codelineno-327-7" href="#__codelineno-327-7"></a><span class="k">public</span><span class="w"> </span><span class="k">class</span><span class="w"> </span><span class="nc">Duck</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="n">DynamicObject</span>
</span><span id="__span-327-8"><a id="__codelineno-327-8" name="__codelineno-327-8" href="#__codelineno-327-8"></a><span class="p">{</span>
</span><span id="__span-327-9"><a id="__codelineno-327-9" name="__codelineno-327-9" href="#__codelineno-327-9"></a><span class="w"> </span><span class="k">public</span><span class="w"> </span><span class="k">override</span><span class="w"> </span><span class="kt">bool</span><span class="w"> </span><span class="nf">TryInvokeMember</span><span class="w"> </span><span class="p">(</span>
</span><span id="__span-327-10"><a id="__codelineno-327-10" name="__codelineno-327-10" href="#__codelineno-327-10"></a><span class="w"> </span><span class="n">InvokeMemberBinder</span><span class="w"> </span><span class="n">binder</span><span class="p">,</span><span class="w"> </span><span class="kt">object</span><span class="p">[]</span><span class="w"> </span><span class="n">args</span><span class="p">,</span><span class="w"> </span><span class="k">out</span><span class="w"> </span><span class="kt">object</span><span class="w"> </span><span class="n">result</span><span class="p">)</span>
</span><span id="__span-327-11"><a id="__codelineno-327-11" name="__codelineno-327-11" href="#__codelineno-327-11"></a><span class="w"> </span><span class="p">{</span>
</span><span id="__span-327-12"><a id="__codelineno-327-12" name="__codelineno-327-12" href="#__codelineno-327-12"></a><span class="w"> </span><span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="w"> </span><span class="p">(</span><span class="n">binder</span><span class="p">.</span><span class="n">Name</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s">&quot; method was called&quot;</span><span class="p">);</span>
</span><span id="__span-327-13"><a id="__codelineno-327-13" name="__codelineno-327-13" href="#__codelineno-327-13"></a><span class="w"> </span><span class="n">result</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">null</span><span class="p">;</span>
</span><span id="__span-327-14"><a id="__codelineno-327-14" name="__codelineno-327-14" href="#__codelineno-327-14"></a><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="k">true</span><span class="p">;</span>
</span><span id="__span-327-15"><a id="__codelineno-327-15" name="__codelineno-327-15" href="#__codelineno-327-15"></a><span class="w"> </span><span class="p">}</span>
</span><span id="__span-327-16"><a id="__codelineno-327-16" name="__codelineno-327-16" href="#__codelineno-327-16"></a><span class="p">}</span>
</span></code></pre></div>
<h1 id="interoperating-with-dynamic-languages">Interoperating with Dynamic Languages</h1>
<p>Although C# supports dynamic binding via the dynamic keyword, it doesnâ€™t go as far as allowing you to execute an expression described in a string at runtime:</p>
<div class="language-csharp highlight"><pre><span></span><code><span id="__span-328-1"><a id="__codelineno-328-1" name="__codelineno-328-1" href="#__codelineno-328-1"></a><span class="kt">string</span><span class="w"> </span><span class="n">expr</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;2 * 3&quot;</span><span class="p">;</span>
</span><span id="__span-328-2"><a id="__codelineno-328-2" name="__codelineno-328-2" href="#__codelineno-328-2"></a><span class="c1">// We can&#39;t &quot;execute&quot; expr</span>
</span></code></pre></div>
<p>This is because the code to translate a string into an expression tree requires a lexiâ€ cal and semantic parser. These features are built into the C# compiler and are not available as a runtime service. At runtime, C# merely provides a binder, which instructs the DLR how to interpret an already built expression tree.</p>
<p>True dynamic languages such as IronPython and IronRuby do allow you to execute an arbitrary string, and this is useful in tasks such as scripting, dynamic configuraâ€ tion, and implementing dynamic rules engines. So, although you can write most of your application in C#, it can be useful to call out to a dynamic language for such tasks. In addition, you might want to use an API that is written in a dynamic lanâ€ guage where no equivalent functionality is available in a .NET library</p>
<p>In the following example, we use IronPython to evaluate an expression created at runtime from within C#. You could use this script to write a calculator:</p>
<div class="language-csharp highlight"><pre><span></span><code><span id="__span-329-1"><a id="__codelineno-329-1" name="__codelineno-329-1" href="#__codelineno-329-1"></a><span class="k">using</span><span class="w"> </span><span class="nn">System</span><span class="p">;</span>
</span><span id="__span-329-2"><a id="__codelineno-329-2" name="__codelineno-329-2" href="#__codelineno-329-2"></a><span class="k">using</span><span class="w"> </span><span class="nn">IronPython.Hosting</span><span class="p">;</span>
</span><span id="__span-329-3"><a id="__codelineno-329-3" name="__codelineno-329-3" href="#__codelineno-329-3"></a><span class="k">using</span><span class="w"> </span><span class="nn">Microsoft.Scripting</span><span class="p">;</span>
</span><span id="__span-329-4"><a id="__codelineno-329-4" name="__codelineno-329-4" href="#__codelineno-329-4"></a><span class="k">using</span><span class="w"> </span><span class="nn">Microsoft.Scripting.Hosting</span><span class="p">;</span>
</span><span id="__span-329-5"><a id="__codelineno-329-5" name="__codelineno-329-5" href="#__codelineno-329-5"></a><span class="k">class</span><span class="w"> </span><span class="nc">Calculator</span>
</span><span id="__span-329-6"><a id="__codelineno-329-6" name="__codelineno-329-6" href="#__codelineno-329-6"></a><span class="p">{</span>
</span><span id="__span-329-7"><a id="__codelineno-329-7" name="__codelineno-329-7" href="#__codelineno-329-7"></a><span class="w"> </span><span class="k">static</span><span class="w"> </span><span class="k">void</span><span class="w"> </span><span class="nf">Main</span><span class="p">()</span>
</span><span id="__span-329-8"><a id="__codelineno-329-8" name="__codelineno-329-8" href="#__codelineno-329-8"></a><span class="w"> </span><span class="p">{</span>
</span><span id="__span-329-9"><a id="__codelineno-329-9" name="__codelineno-329-9" href="#__codelineno-329-9"></a><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">result</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="p">)</span><span class="w"> </span><span class="n">Calculate</span><span class="w"> </span><span class="p">(</span><span class="s">&quot;2 * 3&quot;</span><span class="p">);</span>
</span><span id="__span-329-10"><a id="__codelineno-329-10" name="__codelineno-329-10" href="#__codelineno-329-10"></a><span class="w"> </span><span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="w"> </span><span class="p">(</span><span class="n">result</span><span class="p">);</span><span class="w"> </span><span class="c1">// 6</span>
</span><span id="__span-329-11"><a id="__codelineno-329-11" name="__codelineno-329-11" href="#__codelineno-329-11"></a><span class="w"> </span><span class="p">}</span>
</span><span id="__span-329-12"><a id="__codelineno-329-12" name="__codelineno-329-12" href="#__codelineno-329-12"></a><span class="w"> </span><span class="k">static</span><span class="w"> </span><span class="kt">object</span><span class="w"> </span><span class="nf">Calculate</span><span class="w"> </span><span class="p">(</span><span class="kt">string</span><span class="w"> </span><span class="n">expression</span><span class="p">)</span>
</span><span id="__span-329-13"><a id="__codelineno-329-13" name="__codelineno-329-13" href="#__codelineno-329-13"></a><span class="w"> </span><span class="p">{</span>
</span><span id="__span-329-14"><a id="__codelineno-329-14" name="__codelineno-329-14" href="#__codelineno-329-14"></a><span class="w"> </span><span class="n">ScriptEngine</span><span class="w"> </span><span class="n">engine</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Python</span><span class="p">.</span><span class="n">CreateEngine</span><span class="p">();</span>
</span><span id="__span-329-15"><a id="__codelineno-329-15" name="__codelineno-329-15" href="#__codelineno-329-15"></a><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="n">engine</span><span class="p">.</span><span class="n">Execute</span><span class="w"> </span><span class="p">(</span><span class="n">expression</span><span class="p">);</span>
</span><span id="__span-329-16"><a id="__codelineno-329-16" name="__codelineno-329-16" href="#__codelineno-329-16"></a><span class="w"> </span><span class="p">}</span>
</span><span id="__span-329-17"><a id="__codelineno-329-17" name="__codelineno-329-17" href="#__codelineno-329-17"></a><span class="p">}</span>
</span></code></pre></div>
<p>To run this code, add the NuGet packages DynamicLanguageRuntime (not to be confused with the System.Dynamic.Runâ€ time package) and IronPython to your application.</p>
<p>Because weâ€™re passing a string into Python, the expression will be evaluated accordâ€ ing to Pythonâ€™s rules and not C#â€™s. It also means that we can use Pythonâ€™s language features, such as lists:</p>
<div class="language-csharp highlight"><pre><span></span><code><span id="__span-330-1"><a id="__codelineno-330-1" name="__codelineno-330-1" href="#__codelineno-330-1"></a><span class="kt">var</span><span class="w"> </span><span class="n">list</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">IEnumerable</span><span class="p">)</span><span class="w"> </span><span class="n">Calculate</span><span class="w"> </span><span class="p">(</span><span class="s">&quot;[1, 2, 3] + [4, 5]&quot;</span><span class="p">);</span>
</span><span id="__span-330-2"><a id="__codelineno-330-2" name="__codelineno-330-2" href="#__codelineno-330-2"></a><span class="k">foreach</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">n</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">list</span><span class="p">)</span><span class="w"> </span><span class="n">Console</span><span class="p">.</span><span class="n">Write</span><span class="w"> </span><span class="p">(</span><span class="n">n</span><span class="p">);</span><span class="w"> </span><span class="c1">// 12345</span>
</span><span id="__span-330-3"><a id="__codelineno-330-3" name="__codelineno-330-3" href="#__codelineno-330-3"></a><span class="err">```#</span><span class="w"> </span><span class="n">Chapter</span><span class="w"> </span><span class="mi">25</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="n">Native</span><span class="w"> </span><span class="k">and</span><span class="w"> </span><span class="n">COM</span><span class="w"> </span><span class="n">Interoperability</span>
</span><span id="__span-330-4"><a id="__codelineno-330-4" name="__codelineno-330-4" href="#__codelineno-330-4"></a>
</span><span id="__span-330-5"><a id="__codelineno-330-5" name="__codelineno-330-5" href="#__codelineno-330-5"></a><span class="n">This</span><span class="w"> </span><span class="n">chapter</span><span class="w"> </span><span class="n">describes</span><span class="w"> </span><span class="n">how</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">integrate</span><span class="w"> </span><span class="k">with</span><span class="w"> </span><span class="nf">native</span><span class="w"> </span><span class="p">(</span><span class="k">unmanaged</span><span class="p">)</span><span class="w"> </span><span class="n">Dynamic</span><span class="o">-</span><span class="n">Link</span><span class="w"> </span><span class="n">Libraries</span><span class="w"> </span><span class="p">(</span><span class="n">DLLs</span><span class="p">)</span><span class="w"> </span><span class="k">and</span><span class="w"> </span><span class="n">Component</span><span class="w"> </span><span class="n">Object</span><span class="w"> </span><span class="n">Model</span><span class="w"> </span><span class="p">(</span><span class="n">COM</span><span class="p">)</span><span class="w"> </span><span class="n">components</span><span class="p">.</span><span class="w"> </span><span class="n">Unless</span><span class="w"> </span><span class="n">other</span><span class="err">â€</span><span class="w"> </span><span class="n">wise</span><span class="w"> </span><span class="n">stated</span><span class="p">,</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">types</span><span class="w"> </span><span class="n">mentioned</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="k">this</span><span class="w"> </span><span class="n">chapter</span><span class="w"> </span><span class="n">exist</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">either</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">System</span><span class="w"> </span><span class="k">or</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="err">`</span><span class="n">System</span><span class="p">.</span><span class="n">Runtime</span><span class="p">.</span><span class="n">InteropServices</span><span class="err">`</span><span class="w"> </span><span class="n">namespace</span><span class="p">.</span>
</span><span id="__span-330-6"><a id="__codelineno-330-6" name="__codelineno-330-6" href="#__codelineno-330-6"></a>
</span><span id="__span-330-7"><a id="__codelineno-330-7" name="__codelineno-330-7" href="#__codelineno-330-7"></a><span class="err">#</span><span class="w"> </span><span class="n">COM</span><span class="w"> </span><span class="n">Interoperability</span>
</span><span id="__span-330-8"><a id="__codelineno-330-8" name="__codelineno-330-8" href="#__codelineno-330-8"></a>
</span><span id="__span-330-9"><a id="__codelineno-330-9" name="__codelineno-330-9" href="#__codelineno-330-9"></a><span class="n">The</span><span class="w"> </span><span class="p">.</span><span class="n">NET</span><span class="w"> </span><span class="n">runtime</span><span class="w"> </span><span class="n">provides</span><span class="w"> </span><span class="n">special</span><span class="w"> </span><span class="n">support</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">COM</span><span class="p">,</span><span class="w"> </span><span class="n">enabling</span><span class="w"> </span><span class="n">COM</span><span class="w"> </span><span class="n">objects</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">be</span><span class="w"> </span><span class="n">used</span><span class="w"> </span><span class="k">from</span><span class="w"> </span><span class="p">.</span><span class="n">NET</span><span class="p">,</span><span class="w"> </span><span class="k">and</span><span class="w"> </span><span class="n">vice</span><span class="w"> </span><span class="n">versa</span><span class="p">.</span><span class="w"> </span><span class="n">COM</span><span class="w"> </span><span class="k">is</span><span class="w"> </span><span class="n">available</span><span class="w"> </span><span class="n">only</span><span class="w"> </span><span class="k">on</span><span class="w"> </span><span class="n">Windows</span><span class="p">.</span>
</span><span id="__span-330-10"><a id="__codelineno-330-10" name="__codelineno-330-10" href="#__codelineno-330-10"></a>
</span><span id="__span-330-11"><a id="__codelineno-330-11" name="__codelineno-330-11" href="#__codelineno-330-11"></a><span class="err">##</span><span class="w"> </span><span class="n">The</span><span class="w"> </span><span class="n">Purpose</span><span class="w"> </span><span class="n">of</span><span class="w"> </span><span class="n">COM</span>
</span><span id="__span-330-12"><a id="__codelineno-330-12" name="__codelineno-330-12" href="#__codelineno-330-12"></a>
</span><span id="__span-330-13"><a id="__codelineno-330-13" name="__codelineno-330-13" href="#__codelineno-330-13"></a><span class="n">COM</span><span class="w"> </span><span class="k">is</span><span class="w"> </span><span class="n">an</span><span class="w"> </span><span class="n">acronym</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="o">**</span><span class="n">Component</span><span class="w"> </span><span class="n">Object</span><span class="w"> </span><span class="n">Model</span><span class="o">**</span><span class="p">,</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">binary</span><span class="w"> </span><span class="n">standard</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">interfacing</span><span class="w"> </span><span class="k">with</span><span class="w"> </span><span class="n">libraries</span><span class="p">,</span><span class="w"> </span><span class="n">released</span><span class="w"> </span><span class="k">by</span><span class="w"> </span><span class="n">Microsoft</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="mi">1993</span><span class="p">.</span><span class="w"> </span><span class="n">The</span><span class="w"> </span><span class="o">**</span><span class="n">motivation</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">inventing</span><span class="w"> </span><span class="n">COM</span><span class="w"> </span><span class="n">was</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">enable</span><span class="w"> </span><span class="n">components</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">communicate</span><span class="w"> </span><span class="k">with</span><span class="w"> </span><span class="n">one</span><span class="w"> </span><span class="n">another</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">language</span><span class="w"> </span><span class="n">independent</span><span class="w"> </span><span class="k">and</span><span class="w"> </span><span class="n">version</span><span class="o">-</span><span class="n">tolerant</span><span class="w"> </span><span class="n">manner</span><span class="p">.</span><span class="o">**</span><span class="w"> </span><span class="n">Before</span><span class="w"> </span><span class="n">COM</span><span class="p">,</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">approach</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">Windows</span><span class="w"> </span><span class="n">was</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">publish</span><span class="w"> </span><span class="n">DLLs</span><span class="w"> </span><span class="n">that</span><span class="w"> </span><span class="n">declared</span><span class="w"> </span><span class="n">structures</span><span class="w"> </span><span class="k">and</span><span class="w"> </span><span class="n">functions</span><span class="w"> </span><span class="k">using</span><span class="w"> </span><span class="nn">the</span><span class="w"> </span><span class="n">C</span><span class="w"> </span><span class="n">programming</span><span class="w"> </span><span class="n">language</span><span class="p">.</span><span class="w"> </span><span class="n">Not</span><span class="w"> </span><span class="n">only</span><span class="w"> </span><span class="k">is</span><span class="w"> </span><span class="k">this</span><span class="w"> </span><span class="n">approach</span><span class="w"> </span><span class="n">language</span><span class="w"> </span><span class="n">specific</span><span class="p">,</span><span class="w"> </span><span class="n">but</span><span class="w"> </span><span class="n">it</span><span class="err">â€™</span><span class="n">s</span><span class="w"> </span><span class="n">also</span><span class="w"> </span><span class="n">brittle</span><span class="p">.</span><span class="w"> </span><span class="n">The</span><span class="w"> </span><span class="n">specification</span><span class="w"> </span><span class="n">of</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">type</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">such</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">library</span><span class="w"> </span><span class="k">is</span><span class="w"> </span><span class="n">inseparable</span><span class="w"> </span><span class="k">from</span><span class="w"> </span><span class="n">its</span><span class="w"> </span><span class="n">implementation</span><span class="p">:</span><span class="w"> </span><span class="n">even</span><span class="w"> </span><span class="n">updating</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">structure</span><span class="w"> </span><span class="k">with</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">field</span><span class="w"> </span><span class="n">means</span><span class="w"> </span><span class="n">breaking</span><span class="w"> </span><span class="n">its</span><span class="w"> </span><span class="n">specification</span><span class="p">.</span>
</span><span id="__span-330-14"><a id="__codelineno-330-14" name="__codelineno-330-14" href="#__codelineno-330-14"></a>
</span><span id="__span-330-15"><a id="__codelineno-330-15" name="__codelineno-330-15" href="#__codelineno-330-15"></a><span class="n">The</span><span class="w"> </span><span class="n">beauty</span><span class="w"> </span><span class="n">of</span><span class="w"> </span><span class="n">COM</span><span class="w"> </span><span class="n">was</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">separate</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">specification</span><span class="w"> </span><span class="n">of</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">type</span><span class="w"> </span><span class="k">from</span><span class="w"> </span><span class="n">its</span><span class="w"> </span><span class="n">underlying</span><span class="w"> </span><span class="n">implementation</span><span class="w"> </span><span class="n">through</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">construct</span><span class="w"> </span><span class="n">known</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">COM</span><span class="w"> </span><span class="k">interface</span><span class="p">.</span><span class="w"> </span><span class="n">COM</span><span class="w"> </span><span class="n">also</span><span class="w"> </span><span class="n">allowed</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">calling</span><span class="w"> </span><span class="n">of</span><span class="w"> </span><span class="n">methods</span><span class="w"> </span><span class="k">on</span><span class="w"> </span><span class="n">stateful</span><span class="w"> </span><span class="n">objects</span><span class="err">â€”</span><span class="n">rather</span><span class="w"> </span><span class="n">than</span><span class="w"> </span><span class="n">being</span><span class="w"> </span><span class="n">limited</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">simple</span><span class="w"> </span><span class="n">procedure</span><span class="w"> </span><span class="n">calls</span><span class="p">.</span>
</span><span id="__span-330-16"><a id="__codelineno-330-16" name="__codelineno-330-16" href="#__codelineno-330-16"></a>
</span><span id="__span-330-17"><a id="__codelineno-330-17" name="__codelineno-330-17" href="#__codelineno-330-17"></a><span class="o">**</span><span class="n">In</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">way</span><span class="p">,</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="p">.</span><span class="n">NET</span><span class="w"> </span><span class="n">programming</span><span class="w"> </span><span class="n">model</span><span class="w"> </span><span class="k">is</span><span class="w"> </span><span class="n">an</span><span class="w"> </span><span class="n">evolution</span><span class="w"> </span><span class="n">of</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">principles</span><span class="w"> </span><span class="n">of</span><span class="w"> </span><span class="n">COM</span><span class="w"> </span><span class="n">programming</span><span class="p">:</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="p">.</span><span class="n">NET</span><span class="w"> </span><span class="n">platform</span><span class="w"> </span><span class="n">also</span><span class="w"> </span><span class="n">facilitates</span><span class="w"> </span><span class="n">cross</span><span class="o">-</span><span class="n">language</span><span class="w"> </span><span class="n">development</span><span class="w"> </span><span class="k">and</span><span class="w"> </span><span class="k">allows</span><span class="w"> </span><span class="n">binary</span><span class="w"> </span><span class="n">components</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">evolve</span><span class="w"> </span><span class="n">without</span><span class="w"> </span><span class="n">breaking</span><span class="w"> </span><span class="n">applications</span><span class="w"> </span><span class="n">that</span><span class="w"> </span><span class="n">depend</span><span class="w"> </span><span class="k">on</span><span class="w"> </span><span class="n">them</span><span class="p">.</span><span class="o">**</span>
</span><span id="__span-330-18"><a id="__codelineno-330-18" name="__codelineno-330-18" href="#__codelineno-330-18"></a>
</span><span id="__span-330-19"><a id="__codelineno-330-19" name="__codelineno-330-19" href="#__codelineno-330-19"></a><span class="err">##</span><span class="w"> </span><span class="n">The</span><span class="w"> </span><span class="n">Basics</span><span class="w"> </span><span class="n">of</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">COM</span><span class="w"> </span><span class="n">Type</span><span class="w"> </span><span class="n">System</span>
</span><span id="__span-330-20"><a id="__codelineno-330-20" name="__codelineno-330-20" href="#__codelineno-330-20"></a>
</span><span id="__span-330-21"><a id="__codelineno-330-21" name="__codelineno-330-21" href="#__codelineno-330-21"></a><span class="n">The</span><span class="w"> </span><span class="n">COM</span><span class="w"> </span><span class="n">type</span><span class="w"> </span><span class="n">system</span><span class="w"> </span><span class="n">revolves</span><span class="w"> </span><span class="n">around</span><span class="w"> </span><span class="n">interfaces</span><span class="p">.</span><span class="w"> </span><span class="n">A</span><span class="w"> </span><span class="n">COM</span><span class="w"> </span><span class="k">interface</span><span class="w"> </span><span class="k">is</span><span class="w"> </span><span class="n">rather</span><span class="w"> </span><span class="n">like</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="p">.</span><span class="n">NET</span><span class="w"> </span><span class="k">interface</span><span class="p">,</span><span class="w"> </span><span class="n">but</span><span class="w"> </span><span class="n">it</span><span class="err">â€™</span><span class="n">s</span><span class="w"> </span><span class="n">more</span><span class="w"> </span><span class="n">prevalent</span><span class="w"> </span><span class="n">because</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">COM</span><span class="w"> </span><span class="n">type</span><span class="w"> </span><span class="n">exposes</span><span class="w"> </span><span class="n">its</span><span class="w"> </span><span class="n">functional</span><span class="err">â€</span><span class="w"> </span><span class="n">ity</span><span class="w"> </span><span class="n">only</span><span class="w"> </span><span class="n">through</span><span class="w"> </span><span class="n">an</span><span class="w"> </span><span class="k">interface</span><span class="p">.</span><span class="w"> </span><span class="n">In</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="p">.</span><span class="n">NET</span><span class="w"> </span><span class="n">world</span><span class="p">,</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">instance</span><span class="p">,</span><span class="w"> </span><span class="n">we</span><span class="w"> </span><span class="n">could</span><span class="w"> </span><span class="n">declare</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">type</span><span class="w"> </span><span class="n">simply</span><span class="p">,</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">follows</span><span class="p">:</span>
</span><span id="__span-330-22"><a id="__codelineno-330-22" name="__codelineno-330-22" href="#__codelineno-330-22"></a>
</span><span id="__span-330-23"><a id="__codelineno-330-23" name="__codelineno-330-23" href="#__codelineno-330-23"></a><span class="err">```</span><span class="n">csharp</span>
</span><span id="__span-330-24"><a id="__codelineno-330-24" name="__codelineno-330-24" href="#__codelineno-330-24"></a><span class="k">public</span><span class="w"> </span><span class="k">class</span><span class="w"> </span><span class="nc">Foo</span>
</span><span id="__span-330-25"><a id="__codelineno-330-25" name="__codelineno-330-25" href="#__codelineno-330-25"></a><span class="p">{</span>
</span><span id="__span-330-26"><a id="__codelineno-330-26" name="__codelineno-330-26" href="#__codelineno-330-26"></a><span class="w"> </span><span class="k">public</span><span class="w"> </span><span class="kt">string</span><span class="w"> </span><span class="nf">Test</span><span class="p">()</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="s">&quot;Hello, world&quot;</span><span class="p">;</span>
</span><span id="__span-330-27"><a id="__codelineno-330-27" name="__codelineno-330-27" href="#__codelineno-330-27"></a><span class="p">}</span>
</span></code></pre></div>
<p>Consumers of that type can use Foo directly. And if we later changed the implementation of Test(), calling assemblies would not require recompilation. In this respect, .NET separates interface from implementationâ€”without requiring interâ€ faces. We could even add an overload without breaking callers:</p>
<div class="language-csharp highlight"><pre><span></span><code><span id="__span-331-1"><a id="__codelineno-331-1" name="__codelineno-331-1" href="#__codelineno-331-1"></a><span class="k">public</span><span class="w"> </span><span class="kt">string</span><span class="w"> </span><span class="nf">Test</span><span class="w"> </span><span class="p">(</span><span class="kt">string</span><span class="w"> </span><span class="n">s</span><span class="p">)</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="s">$&quot;Hello, world {s}&quot;</span><span class="p">;</span>
</span></code></pre></div>
<p>In the COM world, Foo exposes its functionality through an interface to achieve this same decoupling. So, in Fooâ€™s type library, an interface such as this would exist</p>
<div class="language-csharp highlight"><pre><span></span><code><span id="__span-332-1"><a id="__codelineno-332-1" name="__codelineno-332-1" href="#__codelineno-332-1"></a><span class="k">public</span><span class="w"> </span><span class="k">interface</span><span class="w"> </span><span class="n">IFoo</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="kt">string</span><span class="w"> </span><span class="n">Test</span><span class="p">();</span><span class="w"> </span><span class="p">}</span>
</span></code></pre></div>
<p>(Weâ€™ve illustrated this by showing a C# interfaceâ€”not a COM interface. The princiâ€ ple, however, is the sameâ€”although the plumbing is different.)</p>
<p>When it comes to adding the overloaded version of Test, life is more complicated with COM than with .NET. First, we would avoid modifying the IFoo interface because this would break binary compatibility with the previous version (one of the principles of COM is that interfaces, once published, are immutable). Second, COM doesnâ€™t allow method overloading. The solution is to instead have Foo implement a second interface:</p>
<div class="language-csharp highlight"><pre><span></span><code><span id="__span-333-1"><a id="__codelineno-333-1" name="__codelineno-333-1" href="#__codelineno-333-1"></a><span class="k">public</span><span class="w"> </span><span class="k">interface</span><span class="w"> </span><span class="n">IFoo2</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="kt">string</span><span class="w"> </span><span class="n">Test</span><span class="w"> </span><span class="p">(</span><span class="kt">string</span><span class="w"> </span><span class="n">s</span><span class="p">);</span><span class="w"> </span><span class="p">}</span>
</span><span id="__span-333-2"><a id="__codelineno-333-2" name="__codelineno-333-2" href="#__codelineno-333-2"></a><span class="c1">//(Again, weâ€™ve transliterated this into a .NET interface for familiarity.)</span>
</span></code></pre></div>
<p>Supporting multiple interfaces is of key importance in making COM libraries versionable</p>
<h2 id="iunknown-and-idispatch">IUnknown and IDispatch</h2>
<p>All COM interfaces are identified with a Globally Unique Identifier (GUID).</p>
<p>The root interface in COM is IUnknown all COM objects must implement it. This interface has three methods:</p>
<ul>
<li>AddRef</li>
<li>Release</li>
<li>QueryInterface</li>
</ul>
<p>AddRef and Release are for lifetime management given that COM uses reference counting rather than automatic garbage collection (COM was designed to work with unmanaged code, where automatic garbage collection isnâ€™t feasible). The Query Interface method returns an object reference that supports that interface, if it can do so.</p>
<p>To enable dynamic programming (e.g., scripting and automation), a COM object can also implement IDispatch. This enables dynamic languages such as VBScript to call COM objects in a late-bound mannerâ€”rather like dynamic in C# (although only for simple invocations).</p>
<h1 id="calling-a-com-component-from-c">Calling a COM Component from C</h1>
<p>The CLRâ€™s built-in support for COM means that you donâ€™t work directly with IUnknown and IDispatch. Instead, you work with CLR objects and the runtime marshals your calls to the COM world via Runtime-Callable Wrappers (RCWs). The runtime also handles lifetime management by calling AddRef and Release (when the .NET object is finalized) and takes care of the primitive type conversions between the two worlds. Type conversion ensures that each side sees, for example, the integer and string types in their familiar forms.</p>
<p>The CLRâ€™s built-in support for COM means that you donâ€™t work directly with IUnknown and IDispatch. Instead, you work with CLR objects and the runtime marshals your calls to the COM world via Runtime-Callable Wrappers (RCWs). The runtime also handles lifetime management by calling AddRef and Release (when the .NET object is finalized) and takes care of the primitive type conversions between the two worlds. Type conversion ensures that each side sees, for example, the integer and string types in their familiar forms.</p>
<p>Additionally, there needs to be some way to access RCWs in a statically typed fashâ€ ion. This is the job of COM interop types. COM interop types are automatically genâ€ erated proxy types that expose a .NET member for each COM member. The type library importer tool (tlbimp.exe) generates COM interop types from the command line, based on a COM library that you choose, and compiles them into a COM interop assembly.</p>
<p>If a COM component implements multiple interfaces, the tlbimp.exe tool generates a single type that contains a union of members from all interfaces.</p>
<p>You can create a COM interop assembly in Visual Studio by going to the Add Referâ€ ence dialog box and choosing a library from the COM tab. For example, if you have Microsoft Excel installed, adding a reference to the Microsoft Excel Object Library allows you to interoperate with Excelâ€™s COM classes. Hereâ€™s the C# code to create and show a workbook, and then populate a cell in that workbook:</p>
<div class="language-csharp highlight"><pre><span></span><code><span id="__span-334-1"><a id="__codelineno-334-1" name="__codelineno-334-1" href="#__codelineno-334-1"></a><span class="k">using</span><span class="w"> </span><span class="nn">System</span><span class="p">;</span>
</span><span id="__span-334-2"><a id="__codelineno-334-2" name="__codelineno-334-2" href="#__codelineno-334-2"></a><span class="k">using</span><span class="w"> </span><span class="nn">Excel</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Microsoft</span><span class="p">.</span><span class="n">Office</span><span class="p">.</span><span class="n">Interop</span><span class="p">.</span><span class="n">Excel</span><span class="p">;</span>
</span><span id="__span-334-3"><a id="__codelineno-334-3" name="__codelineno-334-3" href="#__codelineno-334-3"></a><span class="k">class</span><span class="w"> </span><span class="nc">Program</span>
</span><span id="__span-334-4"><a id="__codelineno-334-4" name="__codelineno-334-4" href="#__codelineno-334-4"></a><span class="p">{</span>
</span><span id="__span-334-5"><a id="__codelineno-334-5" name="__codelineno-334-5" href="#__codelineno-334-5"></a><span class="w"> </span><span class="k">static</span><span class="w"> </span><span class="k">void</span><span class="w"> </span><span class="nf">Main</span><span class="p">()</span>
</span><span id="__span-334-6"><a id="__codelineno-334-6" name="__codelineno-334-6" href="#__codelineno-334-6"></a><span class="w"> </span><span class="p">{</span>
</span><span id="__span-334-7"><a id="__codelineno-334-7" name="__codelineno-334-7" href="#__codelineno-334-7"></a><span class="w"> </span><span class="kt">var</span><span class="w"> </span><span class="n">excel</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">Excel</span><span class="p">.</span><span class="n">Application</span><span class="p">();</span>
</span><span id="__span-334-8"><a id="__codelineno-334-8" name="__codelineno-334-8" href="#__codelineno-334-8"></a><span class="w"> </span><span class="n">excel</span><span class="p">.</span><span class="n">Visible</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">true</span><span class="p">;</span>
</span><span id="__span-334-9"><a id="__codelineno-334-9" name="__codelineno-334-9" href="#__codelineno-334-9"></a><span class="w"> </span><span class="n">Excel</span><span class="p">.</span><span class="n">Workbook</span><span class="w"> </span><span class="n">workBook</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">excel</span><span class="p">.</span><span class="n">Workbooks</span><span class="p">.</span><span class="n">Add</span><span class="p">();</span>
</span><span id="__span-334-10"><a id="__codelineno-334-10" name="__codelineno-334-10" href="#__codelineno-334-10"></a><span class="w"> </span><span class="p">((</span><span class="n">Excel</span><span class="p">.</span><span class="n">Range</span><span class="p">)</span><span class="n">excel</span><span class="p">.</span><span class="n">Cells</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">]).</span><span class="n">Font</span><span class="p">.</span><span class="n">FontStyle</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;Bold&quot;</span><span class="p">;</span>
</span><span id="__span-334-11"><a id="__codelineno-334-11" name="__codelineno-334-11" href="#__codelineno-334-11"></a><span class="w"> </span><span class="p">((</span><span class="n">Excel</span><span class="p">.</span><span class="n">Range</span><span class="p">)</span><span class="n">excel</span><span class="p">.</span><span class="n">Cells</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">]).</span><span class="n">Value2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;Hello World&quot;</span><span class="p">;</span>
</span><span id="__span-334-12"><a id="__codelineno-334-12" name="__codelineno-334-12" href="#__codelineno-334-12"></a><span class="w"> </span><span class="n">workBook</span><span class="p">.</span><span class="n">SaveAs</span><span class="w"> </span><span class="p">(</span><span class="s">@&quot;d:\temp.xlsx&quot;</span><span class="p">);</span>
</span><span id="__span-334-13"><a id="__codelineno-334-13" name="__codelineno-334-13" href="#__codelineno-334-13"></a><span class="w"> </span><span class="p">}</span>
</span><span id="__span-334-14"><a id="__codelineno-334-14" name="__codelineno-334-14" href="#__codelineno-334-14"></a><span class="p">}</span>
</span></code></pre></div>
<p><strong>It is currently necessary to embed interop types in your application (otherwise, .NET Core wonâ€™t locate them at runtime).</strong> Either click the COM reference in Visual Studioâ€™s Solution Explorer and set the Embed Interop Types property to true in the Properties window, or open your .csproj file and add the following line (in boldface):</p>
<div class="language-csharp highlight"><pre><span></span><code><span id="__span-335-1"><a id="__codelineno-335-1" name="__codelineno-335-1" href="#__codelineno-335-1"></a><span class="o">&lt;</span><span class="n">ItemGroup</span><span class="o">&gt;</span>
</span><span id="__span-335-2"><a id="__codelineno-335-2" name="__codelineno-335-2" href="#__codelineno-335-2"></a><span class="w"> </span><span class="o">&lt;</span><span class="n">COMReference</span><span class="w"> </span><span class="n">Include</span><span class="o">=</span><span class="s">&quot;Microsoft.Office.Excel.dll&quot;</span><span class="o">&gt;</span>
</span><span id="__span-335-3"><a id="__codelineno-335-3" name="__codelineno-335-3" href="#__codelineno-335-3"></a><span class="w"> </span><span class="p">...</span>
</span><span id="__span-335-4"><a id="__codelineno-335-4" name="__codelineno-335-4" href="#__codelineno-335-4"></a><span class="w"> </span><span class="o">&lt;</span><span class="n">EmbedInteropTypes</span><span class="o">&gt;</span><span class="k">true</span><span class="o">&lt;/</span><span class="n">EmbedInteropTypes</span><span class="o">&gt;</span>
</span><span id="__span-335-5"><a id="__codelineno-335-5" name="__codelineno-335-5" href="#__codelineno-335-5"></a><span class="w"> </span><span class="o">&lt;/</span><span class="n">COMReference</span><span class="o">&gt;</span>
</span><span id="__span-335-6"><a id="__codelineno-335-6" name="__codelineno-335-6" href="#__codelineno-335-6"></a><span class="o">&lt;/</span><span class="n">ItemGroup</span><span class="o">&gt;</span>
</span></code></pre></div>
<h3 id="optional-parameters-and-named-arguments">Optional Parameters and Named Arguments</h3>
<p>Because COM APIs donâ€™t support function overloading, itâ€™s very common to have functions with numerous parameters, many of which are optional. For instance, hereâ€™s how you might call an Excel workbookâ€™s Save method:</p>
<div class="language-csharp highlight"><pre><span></span><code><span id="__span-336-1"><a id="__codelineno-336-1" name="__codelineno-336-1" href="#__codelineno-336-1"></a><span class="kt">var</span><span class="w"> </span><span class="n">missing</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">System</span><span class="p">.</span><span class="n">Reflection</span><span class="p">.</span><span class="n">Missing</span><span class="p">.</span><span class="n">Value</span><span class="p">;</span>
</span><span id="__span-336-2"><a id="__codelineno-336-2" name="__codelineno-336-2" href="#__codelineno-336-2"></a><span class="n">workBook</span><span class="p">.</span><span class="n">SaveAs</span><span class="w"> </span><span class="p">(</span><span class="s">@&quot;d:\temp.xlsx&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">missing</span><span class="p">,</span><span class="w"> </span><span class="n">missing</span><span class="p">,</span><span class="w"> </span><span class="n">missing</span><span class="p">,</span><span class="w"> </span><span class="n">missing</span><span class="p">,</span>
</span><span id="__span-336-3"><a id="__codelineno-336-3" name="__codelineno-336-3" href="#__codelineno-336-3"></a><span class="w"> </span><span class="n">missing</span><span class="p">,</span><span class="w"> </span><span class="n">Excel</span><span class="p">.</span><span class="n">XlSaveAsAccessMode</span><span class="p">.</span><span class="n">xlNoChange</span><span class="p">,</span><span class="w"> </span><span class="n">missing</span><span class="p">,</span><span class="w"> </span><span class="n">missing</span><span class="p">,</span>
</span><span id="__span-336-4"><a id="__codelineno-336-4" name="__codelineno-336-4" href="#__codelineno-336-4"></a><span class="w"> </span><span class="n">missing</span><span class="p">,</span><span class="w"> </span><span class="n">missing</span><span class="p">,</span><span class="w"> </span><span class="n">missing</span><span class="p">);</span>
</span><span id="__span-336-5"><a id="__codelineno-336-5" name="__codelineno-336-5" href="#__codelineno-336-5"></a>
</span><span id="__span-336-6"><a id="__codelineno-336-6" name="__codelineno-336-6" href="#__codelineno-336-6"></a><span class="c1">//The good news is that C#â€™s support for optional parameters is COM-aware, so we</span>
</span><span id="__span-336-7"><a id="__codelineno-336-7" name="__codelineno-336-7" href="#__codelineno-336-7"></a><span class="c1">//can just do this:</span>
</span><span id="__span-336-8"><a id="__codelineno-336-8" name="__codelineno-336-8" href="#__codelineno-336-8"></a><span class="n">workBook</span><span class="p">.</span><span class="n">SaveAs</span><span class="w"> </span><span class="p">(</span><span class="s">@&quot;d:\temp.xlsx&quot;</span><span class="p">);</span>
</span><span id="__span-336-9"><a id="__codelineno-336-9" name="__codelineno-336-9" href="#__codelineno-336-9"></a>
</span><span id="__span-336-10"><a id="__codelineno-336-10" name="__codelineno-336-10" href="#__codelineno-336-10"></a><span class="c1">//Named arguments allow you to specify additional arguments, regardless of their</span>
</span><span id="__span-336-11"><a id="__codelineno-336-11" name="__codelineno-336-11" href="#__codelineno-336-11"></a><span class="c1">//position:</span>
</span><span id="__span-336-12"><a id="__codelineno-336-12" name="__codelineno-336-12" href="#__codelineno-336-12"></a><span class="n">workBook</span><span class="p">.</span><span class="n">SaveAs</span><span class="w"> </span><span class="p">(</span><span class="s">@&quot;c:\test.xlsx&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">Password</span><span class="p">:</span><span class="s">&quot;foo&quot;</span><span class="p">);</span>
</span></code></pre></div>
<h2 id="implicit-ref-parameters">Implicit ref Parameters</h2>
<p>Some COM APIs (Microsoft Word, in particular) expose functions that declare every parameter as pass-by-referenceâ€”whether or not the function modifies the parameter value. This is because of the perceived performance gain from not copying argument values (the real performance gain is negligible).</p>
<p>Historically, calling such methods from C# has been clumsy because you must specify the ref keyword with every argument, and this prevents the use of optional parameters. For instance, to open a Word document, we used to have to do this:</p>
<div class="language-csharp highlight"><pre><span></span><code><span id="__span-337-1"><a id="__codelineno-337-1" name="__codelineno-337-1" href="#__codelineno-337-1"></a><span class="kt">object</span><span class="w"> </span><span class="n">filename</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;foo.doc&quot;</span><span class="p">;</span>
</span><span id="__span-337-2"><a id="__codelineno-337-2" name="__codelineno-337-2" href="#__codelineno-337-2"></a><span class="kt">object</span><span class="w"> </span><span class="n">notUsed1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Missing</span><span class="p">.</span><span class="n">Value</span><span class="p">;</span>
</span><span id="__span-337-3"><a id="__codelineno-337-3" name="__codelineno-337-3" href="#__codelineno-337-3"></a><span class="kt">object</span><span class="w"> </span><span class="n">notUsed2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Missing</span><span class="p">.</span><span class="n">Value</span><span class="p">;</span>
</span><span id="__span-337-4"><a id="__codelineno-337-4" name="__codelineno-337-4" href="#__codelineno-337-4"></a><span class="kt">object</span><span class="w"> </span><span class="n">notUsed3</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Missing</span><span class="p">.</span><span class="n">Value</span><span class="p">;</span>
</span><span id="__span-337-5"><a id="__codelineno-337-5" name="__codelineno-337-5" href="#__codelineno-337-5"></a><span class="p">...</span>
</span><span id="__span-337-6"><a id="__codelineno-337-6" name="__codelineno-337-6" href="#__codelineno-337-6"></a><span class="n">Open</span><span class="w"> </span><span class="p">(</span><span class="k">ref</span><span class="w"> </span><span class="n">filename</span><span class="p">,</span><span class="w"> </span><span class="k">ref</span><span class="w"> </span><span class="n">notUsed1</span><span class="p">,</span><span class="w"> </span><span class="k">ref</span><span class="w"> </span><span class="n">notUsed2</span><span class="p">,</span><span class="w"> </span><span class="k">ref</span><span class="w"> </span><span class="n">notUsed3</span><span class="p">,</span><span class="w"> </span><span class="p">...);</span>
</span></code></pre></div>
<p>Thanks to implicit ref parameters, you can omit the ref modifier on COM function calls, allowing the use of optional parameters</p>
<div class="language-csharp highlight"><pre><span></span><code><span id="__span-338-1"><a id="__codelineno-338-1" name="__codelineno-338-1" href="#__codelineno-338-1"></a><span class="n">word</span><span class="p">.</span><span class="n">Open</span><span class="w"> </span><span class="p">(</span><span class="s">&quot;foo.doc&quot;</span><span class="p">);</span>
</span></code></pre></div>
<p>The caveat is that you will get neither a compile-time nor a runtime error if the COM method youâ€™re calling actually does mutate an argument value.</p>
<h2 id="indexers">Indexers</h2>
<p>The ability to omit the ref modifier has another benefit: it makes COM indexers with ref parameters accessible via ordinary C# indexer syntax. This would otherâ€ wise be forbidden because ref/out parameters are not supported with C# indexers</p>
<p>You can also call COM properties that accept arguments. In the following example, Foo is a property that accepts an integer argument:</p>
<div class="language-csharp highlight"><pre><span></span><code><span id="__span-339-1"><a id="__codelineno-339-1" name="__codelineno-339-1" href="#__codelineno-339-1"></a><span class="n">myComObject</span><span class="p">.</span><span class="n">Foo</span><span class="w"> </span><span class="p">[</span><span class="mi">123</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;Hello&quot;</span><span class="p">;</span>
</span></code></pre></div>
<p>Writing such properties yourself in C# is still prohibited: a type can expose an indexer only on itself (the default indexer). Therefore, if you wanted to write code in C# that would make the preceding statement legal, Foo would need to return another type that exposed a (default) indexer.</p>
<h2 id="dynamic-binding">Dynamic Binding</h2>
<p>There are two ways that dynamic binding can help when calling COM components. The first way is in allowing access to a COM component without a COM interop type. To do this, call Type.GetTypeFromProgID with the COM component name to obtain a COM instance, and then use dynamic binding to call members from then on. Of course, thereâ€™s no IntelliSense, and compile-time checks are impossible:</p>
<div class="language-csharp highlight"><pre><span></span><code><span id="__span-340-1"><a id="__codelineno-340-1" name="__codelineno-340-1" href="#__codelineno-340-1"></a><span class="n">Type</span><span class="w"> </span><span class="n">excelAppType</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Type</span><span class="p">.</span><span class="n">GetTypeFromProgID</span><span class="w"> </span><span class="p">(</span><span class="s">&quot;Excel.Application&quot;</span><span class="p">,</span><span class="w"> </span><span class="k">true</span><span class="p">);</span>
</span><span id="__span-340-2"><a id="__codelineno-340-2" name="__codelineno-340-2" href="#__codelineno-340-2"></a><span class="kt">dynamic</span><span class="w"> </span><span class="n">excel</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Activator</span><span class="p">.</span><span class="n">CreateInstance</span><span class="w"> </span><span class="p">(</span><span class="n">excelAppType</span><span class="p">);</span>
</span><span id="__span-340-3"><a id="__codelineno-340-3" name="__codelineno-340-3" href="#__codelineno-340-3"></a><span class="n">excel</span><span class="p">.</span><span class="n">Visible</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">true</span><span class="p">;</span>
</span><span id="__span-340-4"><a id="__codelineno-340-4" name="__codelineno-340-4" href="#__codelineno-340-4"></a><span class="kt">dynamic</span><span class="w"> </span><span class="n">wb</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">excel</span><span class="p">.</span><span class="n">Workbooks</span><span class="p">.</span><span class="n">Add</span><span class="p">();</span>
</span><span id="__span-340-5"><a id="__codelineno-340-5" name="__codelineno-340-5" href="#__codelineno-340-5"></a><span class="n">excel</span><span class="p">.</span><span class="n">Cells</span><span class="w"> </span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">].</span><span class="n">Value2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;foo&quot;</span><span class="p">;</span>
</span></code></pre></div>
<p>Dynamic binding can also be useful (to a lesser extent) in dealing with the COM variant type. For reasons due more to poor design that necessity, COM API functions are often peppered with this type, which is roughly equivalent to object in .NET. If you enable â€œEmbed Interop Typesâ€ in your project (more on this soon), the runtime will map variant to dynamic, instead of mapping variant to object, avoiding the need for casts. For instance, you could legally do this:</p>
<div class="language-csharp highlight"><pre><span></span><code><span id="__span-341-1"><a id="__codelineno-341-1" name="__codelineno-341-1" href="#__codelineno-341-1"></a><span class="n">excel</span><span class="p">.</span><span class="n">Cells</span><span class="w"> </span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">].</span><span class="n">Font</span><span class="p">.</span><span class="n">FontStyle</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;Bold&quot;</span><span class="p">;</span>
</span></code></pre></div>
<h1 id="embedding-interop-types">Embedding Interop Types</h1>
<p>We said previously that C# ordinarily calls COM components via interop types that are generated by calling the tlbimp.exe tool (directly, or via Visual Studio).</p>
<p>Historically, your only option was to reference interop assemblies just as you would with any other assembly. This could be troublesome because interop assemblies can get quite large with complex COM components. A tiny add-in for Microsoft Word, for instance, requires an interop assembly that is orders of magnitude larger than itself.</p>
<p>Rather than referencing an interop assembly, you have the option of embedding the portions that use it. The compiler analyzes the assembly to work out precisely the types and members that your application requires, and embeds definitions for (just) those types and members directly in your application. This avoids bloat as well as the need to ship an additional file.</p>
<p>To enable this feature, either select the COM reference in Visual Studioâ€™s Solution Explorer and then set Embed Interop Types to true in the Properties window, or edit your .csproj file as we described earlier</p>
<h2 id="type-equivalence">Type Equivalence</h2>
<p>The CLR supports type equivalence for linked interop types. This means that if two assemblies each link to an interop type, those types will be considered equivalent if they wrap the same COM type. This holds true even if the interop assemblies to which they linked were generated independently.</p>
<p>Type equivalence relies on the TypeIdentifierAttribute attribute in the System.Runtime.InteropServices nameâ€ space. The compiler automatically applies this attribute when you link to interop assemblies. COM types are then considâ€ ered equivalent if they have the same GUID.</p>
<h1 id="exposing-c-objects-to-com">Exposing C# Objects to COM</h1>
<p>Itâ€™s also possible to write classes in C# that can be consumed in the COM world. The CLR makes this possible through a proxy called a COM-Callable Wrapper (CCW). A CCW marshals types between the two worlds (as with an RCW) and implements IUnknown (and optionally IDispatch) as required by the COM protocol.A CCW is lifetime-controlled from the COM side via reference counting (rather than through the CLRâ€™s garbage collector).</p>
<p>You can expose any public class to COM (as an in-proc server). To do so, first create an interface, assign it a unique GUID (in Visual Studio, you can use Tools &gt; Create GUID), declare it visible to COM, and then set the interface type:</p>
<div class="language-csharp highlight"><pre><span></span><code><span id="__span-342-1"><a id="__codelineno-342-1" name="__codelineno-342-1" href="#__codelineno-342-1"></a><span class="k">namespace</span><span class="w"> </span><span class="nn">MyCom</span>
</span><span id="__span-342-2"><a id="__codelineno-342-2" name="__codelineno-342-2" href="#__codelineno-342-2"></a><span class="p">{</span>
</span><span id="__span-342-3"><a id="__codelineno-342-3" name="__codelineno-342-3" href="#__codelineno-342-3"></a><span class="w"> </span><span class="na">[ComVisible(true)]</span>
</span><span id="__span-342-4"><a id="__codelineno-342-4" name="__codelineno-342-4" href="#__codelineno-342-4"></a><span class="w"> </span><span class="na">[Guid (&quot;226E5561-C68E-4B2B-BD28-25103ABCA3B1&quot;)]</span><span class="w"> </span><span class="c1">// Change this GUID</span>
</span><span id="__span-342-5"><a id="__codelineno-342-5" name="__codelineno-342-5" href="#__codelineno-342-5"></a><span class="w"> </span><span class="na">[InterfaceType (ComInterfaceType.InterfaceIsIUnknown)]</span>
</span><span id="__span-342-6"><a id="__codelineno-342-6" name="__codelineno-342-6" href="#__codelineno-342-6"></a><span class="w"> </span><span class="k">public</span><span class="w"> </span><span class="k">interface</span><span class="w"> </span><span class="n">IServer</span>
</span><span id="__span-342-7"><a id="__codelineno-342-7" name="__codelineno-342-7" href="#__codelineno-342-7"></a><span class="w"> </span><span class="p">{</span>
</span><span id="__span-342-8"><a id="__codelineno-342-8" name="__codelineno-342-8" href="#__codelineno-342-8"></a><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="nf">Fibonacci</span><span class="p">();</span>
</span><span id="__span-342-9"><a id="__codelineno-342-9" name="__codelineno-342-9" href="#__codelineno-342-9"></a><span class="w"> </span><span class="p">}</span>
</span><span id="__span-342-10"><a id="__codelineno-342-10" name="__codelineno-342-10" href="#__codelineno-342-10"></a><span class="p">}</span>
</span></code></pre></div>
<p>Next, provide an implementation of your interface, assigning a unique GUID to that implementation:</p>
<div class="language-csharp highlight"><pre><span></span><code><span id="__span-343-1"><a id="__codelineno-343-1" name="__codelineno-343-1" href="#__codelineno-343-1"></a><span class="k">namespace</span><span class="w"> </span><span class="nn">MyCom</span>
</span><span id="__span-343-2"><a id="__codelineno-343-2" name="__codelineno-343-2" href="#__codelineno-343-2"></a><span class="p">{</span>
</span><span id="__span-343-3"><a id="__codelineno-343-3" name="__codelineno-343-3" href="#__codelineno-343-3"></a><span class="w"> </span><span class="na">[ComVisible(true)]</span>
</span><span id="__span-343-4"><a id="__codelineno-343-4" name="__codelineno-343-4" href="#__codelineno-343-4"></a><span class="w"> </span><span class="na">[Guid (&quot;09E01FCD-9970-4DB3-B537-0EC555967DD9&quot;)]</span><span class="w"> </span><span class="c1">// Change this GUID</span>
</span><span id="__span-343-5"><a id="__codelineno-343-5" name="__codelineno-343-5" href="#__codelineno-343-5"></a><span class="w"> </span><span class="k">public</span><span class="w"> </span><span class="k">class</span><span class="w"> </span><span class="nc">Server</span>
</span><span id="__span-343-6"><a id="__codelineno-343-6" name="__codelineno-343-6" href="#__codelineno-343-6"></a><span class="w"> </span><span class="p">{</span>
</span><span id="__span-343-7"><a id="__codelineno-343-7" name="__codelineno-343-7" href="#__codelineno-343-7"></a><span class="w"> </span><span class="k">public</span><span class="w"> </span><span class="kt">ulong</span><span class="w"> </span><span class="nf">Fibonacci</span><span class="w"> </span><span class="p">(</span><span class="kt">ulong</span><span class="w"> </span><span class="n">whichTerm</span><span class="p">)</span>
</span><span id="__span-343-8"><a id="__codelineno-343-8" name="__codelineno-343-8" href="#__codelineno-343-8"></a><span class="w"> </span><span class="p">{</span>
</span><span id="__span-343-9"><a id="__codelineno-343-9" name="__codelineno-343-9" href="#__codelineno-343-9"></a><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">whichTerm</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="k">throw</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">ArgumentException</span><span class="w"> </span><span class="p">(</span><span class="s">&quot;...&quot;</span><span class="p">);</span>
</span><span id="__span-343-10"><a id="__codelineno-343-10" name="__codelineno-343-10" href="#__codelineno-343-10"></a><span class="w"> </span><span class="kt">ulong</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
</span><span id="__span-343-11"><a id="__codelineno-343-11" name="__codelineno-343-11" href="#__codelineno-343-11"></a><span class="w"> </span><span class="kt">ulong</span><span class="w"> </span><span class="n">b</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span>
</span><span id="__span-343-12"><a id="__codelineno-343-12" name="__codelineno-343-12" href="#__codelineno-343-12"></a><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kt">ulong</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">whichTerm</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="o">++</span><span class="p">)</span>
</span><span id="__span-343-13"><a id="__codelineno-343-13" name="__codelineno-343-13" href="#__codelineno-343-13"></a><span class="w"> </span><span class="p">{</span>
</span><span id="__span-343-14"><a id="__codelineno-343-14" name="__codelineno-343-14" href="#__codelineno-343-14"></a><span class="w"> </span><span class="kt">ulong</span><span class="w"> </span><span class="n">tmp</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">a</span><span class="p">;</span>
</span><span id="__span-343-15"><a id="__codelineno-343-15" name="__codelineno-343-15" href="#__codelineno-343-15"></a><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">b</span><span class="p">;</span>
</span><span id="__span-343-16"><a id="__codelineno-343-16" name="__codelineno-343-16" href="#__codelineno-343-16"></a><span class="w"> </span><span class="n">b</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">tmp</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">b</span><span class="p">;</span>
</span><span id="__span-343-17"><a id="__codelineno-343-17" name="__codelineno-343-17" href="#__codelineno-343-17"></a><span class="w"> </span><span class="p">}</span>
</span><span id="__span-343-18"><a id="__codelineno-343-18" name="__codelineno-343-18" href="#__codelineno-343-18"></a><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="n">a</span><span class="p">;</span>
</span><span id="__span-343-19"><a id="__codelineno-343-19" name="__codelineno-343-19" href="#__codelineno-343-19"></a><span class="w"> </span><span class="p">}</span>
</span><span id="__span-343-20"><a id="__codelineno-343-20" name="__codelineno-343-20" href="#__codelineno-343-20"></a><span class="w"> </span><span class="p">}</span>
</span><span id="__span-343-21"><a id="__codelineno-343-21" name="__codelineno-343-21" href="#__codelineno-343-21"></a><span class="p">}</span>
</span></code></pre></div>
<p>Edit your .csproj file, adding the following line (in boldface):</p>
<div class="language-xml highlight"><pre><span></span><code><span id="__span-344-1"><a id="__codelineno-344-1" name="__codelineno-344-1" href="#__codelineno-344-1"></a><span class="nt">&lt;PropertyGroup&gt;</span>
</span><span id="__span-344-2"><a id="__codelineno-344-2" name="__codelineno-344-2" href="#__codelineno-344-2"></a><span class="w"> </span><span class="nt">&lt;TargetFramework&gt;</span>netcoreapp3.0<span class="nt">&lt;/TargetFramework&gt;</span>
</span><span id="__span-344-3"><a id="__codelineno-344-3" name="__codelineno-344-3" href="#__codelineno-344-3"></a><span class="w"> </span>**<span class="nt">&lt;EnableComHosting&gt;</span>true<span class="nt">&lt;/EnableComHosting&gt;</span>**
</span><span id="__span-344-4"><a id="__codelineno-344-4" name="__codelineno-344-4" href="#__codelineno-344-4"></a><span class="nt">&lt;/PropertyGroup&gt;</span>
</span></code></pre></div>
<p>Now, when you build your project, an additional file is generated, <code>MyCom.comhost.dll</code>, which can be registered for COM interop. (Keep in mind that the file will always be 32 bit or 64 bit depending on your project configuration: thereâ€™s no such thing as â€œAny CPUâ€ in this scenario.) From an elevated command prompt, switch to the directory holding your DLL and run regsvr32 <code>MyCom.comhost.dll</code>.</p>
<p>You can then consume your COM component from most COM-capable languages. For example, you can create this Visual Basic Script in a text editor and run it by double-clicking the file in Windows Explorer, or by starting it from a command prompt as you would a program:</p>
<div class="language-visual-basic highlight"><pre><span></span><code><span id="__span-345-1"><a id="__codelineno-345-1" name="__codelineno-345-1" href="#__codelineno-345-1"></a><span class="c">REM Save file as ComClient.vbs</span>
</span><span id="__span-345-2"><a id="__codelineno-345-2" name="__codelineno-345-2" href="#__codelineno-345-2"></a><span class="k">Dim</span><span class="w"> </span><span class="n">obj</span>
</span><span id="__span-345-3"><a id="__codelineno-345-3" name="__codelineno-345-3" href="#__codelineno-345-3"></a><span class="k">Set</span><span class="w"> </span><span class="n">obj</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">CreateObject</span><span class="p">(</span><span class="s">&quot;MyCom.Server&quot;</span><span class="p">)</span>
</span><span id="__span-345-4"><a id="__codelineno-345-4" name="__codelineno-345-4" href="#__codelineno-345-4"></a><span class="n">result</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">obj</span><span class="p">.</span><span class="n">Fibonacci</span><span class="p">(</span><span class="mi">12</span><span class="p">)</span>
</span><span id="__span-345-5"><a id="__codelineno-345-5" name="__codelineno-345-5" href="#__codelineno-345-5"></a><span class="n">Wscript</span><span class="p">.</span><span class="n">Echo</span><span class="w"> </span><span class="n">result</span>
</span></code></pre></div>
<p>Note that .NET Framework and .NET Core cannot be loaded into the same process. Therefore, a .NET Core COM server cannot be loaded into a .NET Framework COM client process, or vice versa.</p>
<h2 id="enabling-registry-free-com">Enabling Registry-Free COM</h2>
<p>Traditionally, COM adds type information to the registry. Registry-free COM uses a manifest file instead of the registry to control object activation. To enable this feature, add the following line (in boldface) to your .csproj file:</p>
<div class="language-xml highlight"><pre><span></span><code><span id="__span-346-1"><a id="__codelineno-346-1" name="__codelineno-346-1" href="#__codelineno-346-1"></a><span class="nt">&lt;PropertyGroup&gt;</span>
</span><span id="__span-346-2"><a id="__codelineno-346-2" name="__codelineno-346-2" href="#__codelineno-346-2"></a><span class="w"> </span><span class="nt">&lt;TargetFramework&gt;</span>netcoreapp3.0<span class="nt">&lt;/TargetFramework&gt;</span>
</span><span id="__span-346-3"><a id="__codelineno-346-3" name="__codelineno-346-3" href="#__codelineno-346-3"></a><span class="w"> </span><span class="nt">&lt;EnableComHosting&gt;</span>true<span class="nt">&lt;/EnableComHosting&gt;</span>
</span><span id="__span-346-4"><a id="__codelineno-346-4" name="__codelineno-346-4" href="#__codelineno-346-4"></a><span class="w"> </span>**<span class="nt">&lt;EnableRegFreeCom&gt;</span>true<span class="nt">&lt;/EnableRegFreeCom&gt;</span>**
</span><span id="__span-346-5"><a id="__codelineno-346-5" name="__codelineno-346-5" href="#__codelineno-346-5"></a><span class="nt">&lt;/PropertyGroup&gt;</span>
</span></code></pre></div>
<p>Your build will then generate MyCom.X.manifest</p>
<p>There is no support in .NET Core 3 for generating a COM type library (*.tlb). You can manually write an Interface Definition Language (IDL) file or C++ header for the native declarations in your interface.# Chapter 26 : Regular Expressions</p>
<h1 id="use-case">Use Case</h1>
<p>Regular expressions are used for tasks such as:</p>
<ul>
<li>Validating text input such as passwords and phone numbers</li>
<li>Parsing textual data into more structured forms (e.g., a NuGet version string)</li>
<li>Replacing patterns of text in a document (e.g., whole words only)</li>
</ul>
<p>All regular expression types are defined in <code>System.Text.RegularExpressions</code></p>
<aside>
ðŸ”¥ All inputs in Excel add-ins are in text format, so we ca use Regular Expression for data validation or for parsing.

</aside>

<h1 id="regular-expression-basics">Regular Expression Basics</h1>
<p>One of the most common regular expression operators is a quantifier. ? is a quantiâ€ fier that matches the preceding item 0 or 1 time. In other words, ? means optional. An item is either a single character or a complex structure of characters in square brackets. For example, the regular expression "colou?r" matches color and colour, but not colouur:</p>
<div class="language-csharp highlight"><pre><span></span><code><span id="__span-347-1"><a id="__codelineno-347-1" name="__codelineno-347-1" href="#__codelineno-347-1"></a><span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="w"> </span><span class="p">(</span><span class="n">Regex</span><span class="p">.</span><span class="n">Match</span><span class="w"> </span><span class="p">(</span><span class="s">&quot;color&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">@&quot;colou?r&quot;</span><span class="p">).</span><span class="n">Success</span><span class="p">);</span><span class="w"> </span><span class="c1">// True</span>
</span><span id="__span-347-2"><a id="__codelineno-347-2" name="__codelineno-347-2" href="#__codelineno-347-2"></a><span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="w"> </span><span class="p">(</span><span class="n">Regex</span><span class="p">.</span><span class="n">Match</span><span class="w"> </span><span class="p">(</span><span class="s">&quot;colour&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">@&quot;colou?r&quot;</span><span class="p">).</span><span class="n">Success</span><span class="p">);</span><span class="w"> </span><span class="c1">// True</span>
</span><span id="__span-347-3"><a id="__codelineno-347-3" name="__codelineno-347-3" href="#__codelineno-347-3"></a><span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="w"> </span><span class="p">(</span><span class="n">Regex</span><span class="p">.</span><span class="n">Match</span><span class="w"> </span><span class="p">(</span><span class="s">&quot;colouur&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">@&quot;colou?r&quot;</span><span class="p">).</span><span class="n">Success</span><span class="p">);</span><span class="w"> </span><span class="c1">// False</span>
</span></code></pre></div>
<p>Regex.Match searches within a larger string. The object that it returns has properâ€ ties for the Index and Length of the match as well as the actual Value matched:</p>
<div class="language-csharp highlight"><pre><span></span><code><span id="__span-348-1"><a id="__codelineno-348-1" name="__codelineno-348-1" href="#__codelineno-348-1"></a><span class="n">Match</span><span class="w"> </span><span class="n">m</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Regex</span><span class="p">.</span><span class="n">Match</span><span class="w"> </span><span class="p">(</span><span class="s">&quot;any colour you like&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">@&quot;colou?r&quot;</span><span class="p">);</span>
</span><span id="__span-348-2"><a id="__codelineno-348-2" name="__codelineno-348-2" href="#__codelineno-348-2"></a><span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="w"> </span><span class="p">(</span><span class="n">m</span><span class="p">.</span><span class="n">Success</span><span class="p">);</span><span class="w"> </span><span class="c1">// True</span>
</span><span id="__span-348-3"><a id="__codelineno-348-3" name="__codelineno-348-3" href="#__codelineno-348-3"></a><span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="w"> </span><span class="p">(</span><span class="n">m</span><span class="p">.</span><span class="n">Index</span><span class="p">);</span><span class="w"> </span><span class="c1">// 4</span>
</span><span id="__span-348-4"><a id="__codelineno-348-4" name="__codelineno-348-4" href="#__codelineno-348-4"></a><span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="w"> </span><span class="p">(</span><span class="n">m</span><span class="p">.</span><span class="n">Length</span><span class="p">);</span><span class="w"> </span><span class="c1">// 6</span>
</span><span id="__span-348-5"><a id="__codelineno-348-5" name="__codelineno-348-5" href="#__codelineno-348-5"></a><span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="w"> </span><span class="p">(</span><span class="n">m</span><span class="p">.</span><span class="n">Value</span><span class="p">);</span><span class="w"> </span><span class="c1">// colour</span>
</span><span id="__span-348-6"><a id="__codelineno-348-6" name="__codelineno-348-6" href="#__codelineno-348-6"></a><span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="w"> </span><span class="p">(</span><span class="n">m</span><span class="p">.</span><span class="n">ToString</span><span class="p">());</span><span class="w"> </span><span class="c1">// colour</span>
</span></code></pre></div>
<p>You can think of <code>Regex.Match</code> as a more powerful version of the stringâ€™s <code>IndexOf</code> method. The difference is that it searches for a pattern rather than a literal string. </p>
<p>The <code>IsMatch</code> method is a shortcut for calling Match and then testing the Success property.</p>
<p>The regular expressions engine works from left to right by default, so only the leftâ€ most match is returned. You can use the NextMatch method to return more matches:</p>
<div class="language-csharp highlight"><pre><span></span><code><span id="__span-349-1"><a id="__codelineno-349-1" name="__codelineno-349-1" href="#__codelineno-349-1"></a><span class="n">Match</span><span class="w"> </span><span class="n">m1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Regex</span><span class="p">.</span><span class="n">Match</span><span class="w"> </span><span class="p">(</span><span class="s">&quot;One color? There are two colours in my head!&quot;</span><span class="p">,</span>
</span><span id="__span-349-2"><a id="__codelineno-349-2" name="__codelineno-349-2" href="#__codelineno-349-2"></a><span class="w"> </span><span class="s">@&quot;colou?rs?&quot;</span><span class="p">);</span>
</span><span id="__span-349-3"><a id="__codelineno-349-3" name="__codelineno-349-3" href="#__codelineno-349-3"></a><span class="n">Match</span><span class="w"> </span><span class="n">m2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">m1</span><span class="p">.</span><span class="n">NextMatch</span><span class="p">();</span>
</span><span id="__span-349-4"><a id="__codelineno-349-4" name="__codelineno-349-4" href="#__codelineno-349-4"></a><span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="w"> </span><span class="p">(</span><span class="n">m1</span><span class="p">);</span><span class="w"> </span><span class="c1">// color</span>
</span><span id="__span-349-5"><a id="__codelineno-349-5" name="__codelineno-349-5" href="#__codelineno-349-5"></a><span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="w"> </span><span class="p">(</span><span class="n">m2</span><span class="p">);</span><span class="w"> </span><span class="c1">// colours</span>
</span></code></pre></div>
<p>The Matches method returns all matches in an array. We can rewrite the preceding example as follows:</p>
<div class="language-csharp highlight"><pre><span></span><code><span id="__span-350-1"><a id="__codelineno-350-1" name="__codelineno-350-1" href="#__codelineno-350-1"></a><span class="k">foreach</span><span class="w"> </span><span class="p">(</span><span class="n">Match</span><span class="w"> </span><span class="n">m</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">Regex</span><span class="p">.</span><span class="n">Matches</span>
</span><span id="__span-350-2"><a id="__codelineno-350-2" name="__codelineno-350-2" href="#__codelineno-350-2"></a><span class="w"> </span><span class="p">(</span><span class="s">&quot;One color? There are two colours in my head!&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">@&quot;colou?rs?&quot;</span><span class="p">))</span>
</span><span id="__span-350-3"><a id="__codelineno-350-3" name="__codelineno-350-3" href="#__codelineno-350-3"></a><span class="w"> </span><span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="w"> </span><span class="p">(</span><span class="n">m</span><span class="p">);</span>
</span></code></pre></div>
<p>Another common regular expressions operator is the alternator, expressed with a vertical bar, |. An alternator expresses alternatives. The following matches â€œJen,â€ â€œJenny,â€ and â€œJenniferâ€:</p>
<div class="language-csharp highlight"><pre><span></span><code><span id="__span-351-1"><a id="__codelineno-351-1" name="__codelineno-351-1" href="#__codelineno-351-1"></a><span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="w"> </span><span class="p">(</span><span class="n">Regex</span><span class="p">.</span><span class="n">IsMatch</span><span class="w"> </span><span class="p">(</span><span class="s">&quot;Jenny&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Jen(ny|nifer)?&quot;</span><span class="p">));</span><span class="w"> </span><span class="c1">// True</span>
</span></code></pre></div>
<p>The brackets around an alternator separate the alternatives from the rest of the expression.</p>
<aside>
ðŸ“¢ You can specify a timeout when matching regular expressions. If a match operation takes longer than the specified TimeSpan, a `RegexMatchTimeoutException` is thrown. This can be useful if your program processes arbitrary regular expressions (for instance, in an advanced search dialog box) because it preâ€ vents malformed regular expressions from infinitely spinning.

</aside>

<h2 id="compiled-regular-expressions">Compiled Regular Expressions</h2>
<p>In some of the preceding examples, we called a static RegEx method repeatedly with the same pattern. An alternative approach in these cases is to instantiate a Regex object with the pattern and <code>RegexOptions.Compiled</code> and then call instance methods:</p>
<div class="language-csharp highlight"><pre><span></span><code><span id="__span-352-1"><a id="__codelineno-352-1" name="__codelineno-352-1" href="#__codelineno-352-1"></a><span class="n">Regex</span><span class="w"> </span><span class="n">r</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">Regex</span><span class="w"> </span><span class="p">(</span><span class="s">@&quot;sausages?&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">RegexOptions</span><span class="p">.</span><span class="n">Compiled</span><span class="p">);</span>
</span><span id="__span-352-2"><a id="__codelineno-352-2" name="__codelineno-352-2" href="#__codelineno-352-2"></a><span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="w"> </span><span class="p">(</span><span class="n">r</span><span class="p">.</span><span class="n">Match</span><span class="w"> </span><span class="p">(</span><span class="s">&quot;sausage&quot;</span><span class="p">));</span><span class="w"> </span><span class="c1">// sausage</span>
</span><span id="__span-352-3"><a id="__codelineno-352-3" name="__codelineno-352-3" href="#__codelineno-352-3"></a><span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="w"> </span><span class="p">(</span><span class="n">r</span><span class="p">.</span><span class="n">Match</span><span class="w"> </span><span class="p">(</span><span class="s">&quot;sausages&quot;</span><span class="p">));</span><span class="w"> </span><span class="c1">// sausages</span>
</span></code></pre></div>
<p>RegexOptions.Compiled instructs the RegEx instance to use lightweight code generâ€ ation (DynamicMethod in Reflection.Emit) to dynamically build and compile code tailored to that particular regular expression. This results in faster matching, at the expense of an initial compilation cost.</p>
<p>You can also instantiate a Regex object without using RegexOptions.Compiled. A Regex instance is immutable.</p>
<aside>
ðŸ“¢ The regular expressions engine is fast. Even without compilation, a simple match typically takes less than a microsecond.

</aside>

<h2 id="regexoptions">RegexOptions</h2>
<p>The <code>RegexOptions</code> flags <code>enum</code> lets you tweak matching behavior. A common use for <code>RegexOptions</code> is to perform a case-insensitive search:</p>
<div class="language-csharp highlight"><pre><span></span><code><span id="__span-353-1"><a id="__codelineno-353-1" name="__codelineno-353-1" href="#__codelineno-353-1"></a><span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="w"> </span><span class="p">(</span><span class="n">Regex</span><span class="p">.</span><span class="n">Match</span><span class="w"> </span><span class="p">(</span><span class="s">&quot;a&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;A&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">RegexOptions</span><span class="p">.</span><span class="n">IgnoreCase</span><span class="p">));</span><span class="w"> </span><span class="c1">// a</span>
</span></code></pre></div>
<p>This applies the current cultureâ€™s rules for case equivalence. The <code>CultureInvariant</code> flag lets you request the invariant culture instead:</p>
<div class="language-csharp highlight"><pre><span></span><code><span id="__span-354-1"><a id="__codelineno-354-1" name="__codelineno-354-1" href="#__codelineno-354-1"></a><span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="w"> </span><span class="p">(</span><span class="n">Regex</span><span class="p">.</span><span class="n">Match</span><span class="w"> </span><span class="p">(</span><span class="s">&quot;a&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;A&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">RegexOptions</span><span class="p">.</span><span class="n">IgnoreCase</span>
</span><span id="__span-354-2"><a id="__codelineno-354-2" name="__codelineno-354-2" href="#__codelineno-354-2"></a><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">RegexOptions</span><span class="p">.</span><span class="n">CultureInvariant</span><span class="p">));</span>
</span></code></pre></div>
<p>You can activate most of the <code>RegexOptions</code> flags within a regular expression itself, using a single-letter code, as follows:</p>
<div class="language-csharp highlight"><pre><span></span><code><span id="__span-355-1"><a id="__codelineno-355-1" name="__codelineno-355-1" href="#__codelineno-355-1"></a><span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="w"> </span><span class="p">(</span><span class="n">Regex</span><span class="p">.</span><span class="n">Match</span><span class="w"> </span><span class="p">(</span><span class="s">&quot;a&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">@&quot;(?i)A&quot;</span><span class="p">));</span><span class="w"> </span><span class="c1">// a</span>
</span></code></pre></div>
<p>You can turn options on and off throughout an expression:</p>
<div class="language-csharp highlight"><pre><span></span><code><span id="__span-356-1"><a id="__codelineno-356-1" name="__codelineno-356-1" href="#__codelineno-356-1"></a><span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="w"> </span><span class="p">(</span><span class="n">Regex</span><span class="p">.</span><span class="n">Match</span><span class="w"> </span><span class="p">(</span><span class="s">&quot;AAAa&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">@&quot;(?i)a(?-i)a&quot;</span><span class="p">));</span>
</span></code></pre></div>
<p>Another useful option is <code>IgnorePatternWhitespace</code> or (?x). This allows you to insert whitespace to make a regular expression more readableâ€”without the whiteâ€ space being taken literally.</p>
<h2 id="character-escapes">Character Escapes</h2>
<p>Regular expressions have the following metacharacters, which have a special rather than literal meaning:</p>
<div class="language-csharp highlight"><pre><span></span><code><span id="__span-357-1"><a id="__codelineno-357-1" name="__codelineno-357-1" href="#__codelineno-357-1"></a><span class="err">â€¢</span><span class="w"> </span><span class="err">\</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="p">[</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="o">^</span><span class="w"> </span><span class="err">$</span><span class="w"> </span><span class="p">.</span><span class="w"> </span><span class="err">#</span>
</span></code></pre></div>
<p>To use a metacharacter literally, you must prefix, or escape, the character with a backslash. In the following example, we escape the ? character to match the string "what?":</p>
<div class="language-csharp highlight"><pre><span></span><code><span id="__span-358-1"><a id="__codelineno-358-1" name="__codelineno-358-1" href="#__codelineno-358-1"></a><span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="w"> </span><span class="p">(</span><span class="n">Regex</span><span class="p">.</span><span class="n">Match</span><span class="w"> </span><span class="p">(</span><span class="s">&quot;what?&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">@&quot;what\?&quot;</span><span class="p">));</span><span class="w"> </span><span class="c1">// what? (correct)</span>
</span><span id="__span-358-2"><a id="__codelineno-358-2" name="__codelineno-358-2" href="#__codelineno-358-2"></a><span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="w"> </span><span class="p">(</span><span class="n">Regex</span><span class="p">.</span><span class="n">Match</span><span class="w"> </span><span class="p">(</span><span class="s">&quot;what?&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">@&quot;what?&quot;</span><span class="p">));</span><span class="w"> </span><span class="c1">// what (incorrect)</span>
</span></code></pre></div>
<p>The Regexâ€™s Escape and Unescape methods convert a string containing regular expression metacharacters by replacing them with escaped equivalents, and vice versa:</p>
<div class="language-csharp highlight"><pre><span></span><code><span id="__span-359-1"><a id="__codelineno-359-1" name="__codelineno-359-1" href="#__codelineno-359-1"></a><span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="p">(</span><span class="n">Regex</span><span class="p">.</span><span class="n">Escape</span><span class="p">(</span><span class="s">@&quot;?&quot;</span><span class="p">));</span><span class="w"> </span><span class="c1">// \?</span>
</span><span id="__span-359-2"><a id="__codelineno-359-2" name="__codelineno-359-2" href="#__codelineno-359-2"></a><span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="p">(</span><span class="n">Regex</span><span class="p">.</span><span class="n">Unescape</span><span class="p">(</span><span class="s">@&quot;\?&quot;</span><span class="p">));</span><span class="w"> </span><span class="c1">// ?</span>
</span></code></pre></div>
<p>All the regular expression strings in this chapter we express with the C# @ literal. This is to bypass C#â€™s escape mechanism, which also uses the backslash. Without the @, a literal backslash would require four backslashes:</p>
<div class="language-csharp highlight"><pre><span></span><code><span id="__span-360-1"><a id="__codelineno-360-1" name="__codelineno-360-1" href="#__codelineno-360-1"></a><span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="w"> </span><span class="p">(</span><span class="n">Regex</span><span class="p">.</span><span class="n">Match</span><span class="w"> </span><span class="p">(</span><span class="s">&quot;\\&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;\\\\&quot;</span><span class="p">));</span><span class="w"> </span><span class="c1">// \</span>
</span></code></pre></div>
<p>Unless you include the (?x) option, spaces are treated literally in regular expressions:</p>
<div class="language-csharp highlight"><pre><span></span><code><span id="__span-361-1"><a id="__codelineno-361-1" name="__codelineno-361-1" href="#__codelineno-361-1"></a><span class="n">Console</span><span class="p">.</span><span class="n">Write</span><span class="w"> </span><span class="p">(</span><span class="n">Regex</span><span class="p">.</span><span class="n">IsMatch</span><span class="w"> </span><span class="p">(</span><span class="s">&quot;hello world&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">@&quot;hello world&quot;</span><span class="p">));</span><span class="w"> </span><span class="c1">// True</span>
</span></code></pre></div>
<h2 id="character-sets">Character Sets</h2>
<p>Character sets act as wildcards for a particular set of characters:</p>
<p>To match exactly one of a set of characters, put the character set in square brackets:</p>
<div class="language-csharp highlight"><pre><span></span><code><span id="__span-362-1"><a id="__codelineno-362-1" name="__codelineno-362-1" href="#__codelineno-362-1"></a><span class="n">Console</span><span class="p">.</span><span class="n">Write</span><span class="w"> </span><span class="p">(</span><span class="n">Regex</span><span class="p">.</span><span class="n">Matches</span><span class="w"> </span><span class="p">(</span><span class="s">&quot;That is that.&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;[Tt]hat&quot;</span><span class="p">).</span><span class="n">Count</span><span class="p">);</span><span class="w"> </span><span class="c1">// 2</span>
</span></code></pre></div>
<p>To match any character except those in a set, put the set in square brackets with a ^ symbol before the first character:</p>
<div class="language-csharp highlight"><pre><span></span><code><span id="__span-363-1"><a id="__codelineno-363-1" name="__codelineno-363-1" href="#__codelineno-363-1"></a><span class="n">Console</span><span class="p">.</span><span class="n">Write</span><span class="w"> </span><span class="p">(</span><span class="n">Regex</span><span class="p">.</span><span class="n">Match</span><span class="w"> </span><span class="p">(</span><span class="s">&quot;quiz qwerty&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;q[^aeiou]&quot;</span><span class="p">).</span><span class="n">Index</span><span class="p">);</span><span class="w"> </span><span class="c1">// 5</span>
</span></code></pre></div>
<p>You can specify a range of characters by using a hyphen. The following regular expression matches a chess move:</p>
<div class="language-csharp highlight"><pre><span></span><code><span id="__span-364-1"><a id="__codelineno-364-1" name="__codelineno-364-1" href="#__codelineno-364-1"></a><span class="n">Console</span><span class="p">.</span><span class="n">Write</span><span class="w"> </span><span class="p">(</span><span class="n">Regex</span><span class="p">.</span><span class="n">Match</span><span class="w"> </span><span class="p">(</span><span class="s">&quot;b1-c4&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">@&quot;[a-h]\d-[a-h]\d&quot;</span><span class="p">).</span><span class="n">Success</span><span class="p">);</span><span class="w"> </span><span class="c1">// True</span>
</span></code></pre></div>
<p><strong><code>\d</code> indicates a digit character, so <code>\d</code> will match any digit. <code>\D</code> matches any non-digit character.</strong></p>
<p>\w indicates a word character, which includes letters, numbers, and the underscore. \W matches any nonword character. These work as expected for non-English letters, too, such as Cyrillic.</p>
<p><code>.</code> matches any character except \n (but allows \r).</p>
<p><code>\p</code> matches a character in a specified category, such as <code>{Lu}</code> for uppercase letter or <code>{P}</code> for punctuation (we list the categories in the reference section later in the chapter):</p>
<div class="language-csharp highlight"><pre><span></span><code><span id="__span-365-1"><a id="__codelineno-365-1" name="__codelineno-365-1" href="#__codelineno-365-1"></a><span class="n">Console</span><span class="p">.</span><span class="n">Write</span><span class="w"> </span><span class="p">(</span><span class="n">Regex</span><span class="p">.</span><span class="n">IsMatch</span><span class="w"> </span><span class="p">(</span><span class="s">&quot;Yes, please&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">@&quot;\p{P}&quot;</span><span class="p">));</span><span class="w"> </span><span class="c1">// True</span>
</span></code></pre></div>
<p>We will find more uses for <code>\d</code>, <code>\w</code>, and <code>.</code> when we combine them with quantifiers.</p>
<h2 id="quantifiers">Quantifiers</h2>
<p>Quantifiers match an item a specified number of times:</p>
<p>The * quantifier matches the preceding character or group zero or more times. The following matches cv.docx, along with any numbered versions of the same file (e.g., cv2.docx, cv15.docx):</p>
<div class="language-csharp highlight"><pre><span></span><code><span id="__span-366-1"><a id="__codelineno-366-1" name="__codelineno-366-1" href="#__codelineno-366-1"></a><span class="n">Console</span><span class="p">.</span><span class="n">Write</span><span class="w"> </span><span class="p">(</span><span class="n">Regex</span><span class="p">.</span><span class="n">Match</span><span class="w"> </span><span class="p">(</span><span class="s">&quot;cv15.docx&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">@&quot;cv\d*\.docx&quot;</span><span class="p">).</span><span class="n">Success</span><span class="p">);</span><span class="w"> </span><span class="c1">// True</span>
</span></code></pre></div>
<p>Notice that we must escape the period in the file extension using a backslash.</p>
<p>The following allows anything between cv and .docx and is equivalent to dir cv*.docx:</p>
<div class="language-csharp highlight"><pre><span></span><code><span id="__span-367-1"><a id="__codelineno-367-1" name="__codelineno-367-1" href="#__codelineno-367-1"></a><span class="n">Console</span><span class="p">.</span><span class="n">Write</span><span class="w"> </span><span class="p">(</span><span class="n">Regex</span><span class="p">.</span><span class="n">Match</span><span class="w"> </span><span class="p">(</span><span class="s">&quot;cvjoint.docx&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">@&quot;cv.*\.docx&quot;</span><span class="p">).</span><span class="n">Success</span><span class="p">);</span><span class="w"> </span><span class="c1">// True</span>
</span></code></pre></div>
<p>The + quantifier matches the preceding character or group one or more times; for example:</p>
<div class="language-csharp highlight"><pre><span></span><code><span id="__span-368-1"><a id="__codelineno-368-1" name="__codelineno-368-1" href="#__codelineno-368-1"></a><span class="n">Console</span><span class="p">.</span><span class="n">Write</span><span class="w"> </span><span class="p">(</span><span class="n">Regex</span><span class="p">.</span><span class="n">Matches</span><span class="w"> </span><span class="p">(</span><span class="s">&quot;slow! yeah slooow!&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;slo+w&quot;</span><span class="p">).</span><span class="n">Count</span><span class="p">);</span><span class="w"> </span><span class="c1">// 2</span>
</span></code></pre></div>
<p>The {} quantifier matches a specified number (or range) of repetitions. The followâ€ ing matches a blood pressure reading:</p>
<div class="language-csharp highlight"><pre><span></span><code><span id="__span-369-1"><a id="__codelineno-369-1" name="__codelineno-369-1" href="#__codelineno-369-1"></a><span class="n">Regex</span><span class="w"> </span><span class="n">bp</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">Regex</span><span class="w"> </span><span class="p">(</span><span class="s">@&quot;\d{2,3}/\d{2,3}&quot;</span><span class="p">);</span>
</span><span id="__span-369-2"><a id="__codelineno-369-2" name="__codelineno-369-2" href="#__codelineno-369-2"></a><span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="w"> </span><span class="p">(</span><span class="n">bp</span><span class="p">.</span><span class="n">Match</span><span class="w"> </span><span class="p">(</span><span class="s">&quot;It used to be 160/110&quot;</span><span class="p">));</span><span class="w"> </span><span class="c1">// 160/110</span>
</span><span id="__span-369-3"><a id="__codelineno-369-3" name="__codelineno-369-3" href="#__codelineno-369-3"></a><span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="w"> </span><span class="p">(</span><span class="n">bp</span><span class="p">.</span><span class="n">Match</span><span class="w"> </span><span class="p">(</span><span class="s">&quot;Now it&#39;s only 115/75&quot;</span><span class="p">));</span><span class="w"> </span><span class="c1">// 115/75</span>
</span></code></pre></div>
<h2 id="greedy-versus-lazy-quantifiers">Greedy Versus Lazy Quantifiers</h2>
<p>By default, quantifiers are greedy, as opposed to lazy. A greedy quantifier repeats as many times as it can before advancing. A lazy quantifier repeats as few times as it can before advancing. You can make any quantifier lazy by suffixing it with the ? symbol. To illustrate the difference, consider the following HTML fragment:</p>
<div class="language-csharp highlight"><pre><span></span><code><span id="__span-370-1"><a id="__codelineno-370-1" name="__codelineno-370-1" href="#__codelineno-370-1"></a><span class="kt">string</span><span class="w"> </span><span class="n">html</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;&lt;i&gt;By default&lt;/i&gt; quantifiers are &lt;i&gt;greedy&lt;/i&gt; creatures&quot;</span><span class="p">;</span>
</span></code></pre></div>
<p>Suppose that we want to extract the two phrases in italics. If we execute the following:</p>
<div class="language-csharp highlight"><pre><span></span><code><span id="__span-371-1"><a id="__codelineno-371-1" name="__codelineno-371-1" href="#__codelineno-371-1"></a><span class="k">foreach</span><span class="w"> </span><span class="p">(</span><span class="n">Match</span><span class="w"> </span><span class="n">m</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">Regex</span><span class="p">.</span><span class="n">Matches</span><span class="w"> </span><span class="p">(</span><span class="n">html</span><span class="p">,</span><span class="w"> </span><span class="s">@&quot;&lt;i&gt;.*&lt;/i&gt;&quot;</span><span class="p">))</span>
</span><span id="__span-371-2"><a id="__codelineno-371-2" name="__codelineno-371-2" href="#__codelineno-371-2"></a><span class="w"> </span><span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="w"> </span><span class="p">(</span><span class="n">m</span><span class="p">);</span>
</span></code></pre></div>
<p>the result is not two matches, but a single match:</p>
<div class="language-csharp highlight"><pre><span></span><code><span id="__span-372-1"><a id="__codelineno-372-1" name="__codelineno-372-1" href="#__codelineno-372-1"></a><span class="o">&lt;</span><span class="n">i</span><span class="o">&gt;</span><span class="n">By</span><span class="w"> </span><span class="k">default</span><span class="o">&lt;/</span><span class="n">i</span><span class="o">&gt;</span><span class="w"> </span><span class="n">quantifiers</span><span class="w"> </span><span class="n">are</span><span class="w"> </span><span class="o">&lt;</span><span class="n">i</span><span class="o">&gt;</span><span class="n">greedy</span><span class="o">&lt;/</span><span class="n">i</span><span class="o">&gt;</span>
</span></code></pre></div>
<p>The problem is that our <code>*</code> quantifier greedily repeats as many times as it can before matching <code>&lt;/i&gt;</code>. So, it passes right by the first <code>&lt;/i&gt;</code>, stopping only at the final <code>&lt;/i&gt;</code> (the last point at which the rest of the expression can still match).</p>
<p>If we make the quantifier lazy, the <code>*</code> bails out at the first point at which the rest of the expression can match:</p>
<div class="language-csharp highlight"><pre><span></span><code><span id="__span-373-1"><a id="__codelineno-373-1" name="__codelineno-373-1" href="#__codelineno-373-1"></a><span class="k">foreach</span><span class="w"> </span><span class="p">(</span><span class="n">Match</span><span class="w"> </span><span class="n">m</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">Regex</span><span class="p">.</span><span class="n">Matches</span><span class="w"> </span><span class="p">(</span><span class="n">html</span><span class="p">,</span><span class="w"> </span><span class="s">@&quot;&lt;i&gt;.*?&lt;/i&gt;&quot;</span><span class="p">))</span>
</span><span id="__span-373-2"><a id="__codelineno-373-2" name="__codelineno-373-2" href="#__codelineno-373-2"></a><span class="w"> </span><span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="w"> </span><span class="p">(</span><span class="n">m</span><span class="p">);</span>
</span></code></pre></div>
<p>Hereâ€™s the result:</p>
<div class="language-csharp highlight"><pre><span></span><code><span id="__span-374-1"><a id="__codelineno-374-1" name="__codelineno-374-1" href="#__codelineno-374-1"></a><span class="o">&lt;</span><span class="n">i</span><span class="o">&gt;</span><span class="n">By</span><span class="w"> </span><span class="k">default</span><span class="o">&lt;/</span><span class="n">i</span><span class="o">&gt;</span>
</span><span id="__span-374-2"><a id="__codelineno-374-2" name="__codelineno-374-2" href="#__codelineno-374-2"></a><span class="o">&lt;</span><span class="n">i</span><span class="o">&gt;</span><span class="n">greedy</span><span class="o">&lt;/</span><span class="n">i</span><span class="o">&gt;</span>
</span></code></pre></div>
<h1 id="zero-width-assertions">Zero-Width Assertions</h1>
<p>The regular expressions language lets you place conditions on what should occur before or after a match, through lookbehind, lookahead, anchors, and word boundaries. These are called zero-width assertions, because they donâ€™t increase the width (or length) of the match itself.</p>
<h2 id="lookahead-and-lookbehind">Lookahead and Lookbehind</h2>
<p>The <code>(?=expr)</code> construct checks whether the text that follows matches expr, without including expr in the result. This is called positive lookahead. In the following example, we look for a number followed by the word miles:</p>
<div class="language-csharp highlight"><pre><span></span><code><span id="__span-375-1"><a id="__codelineno-375-1" name="__codelineno-375-1" href="#__codelineno-375-1"></a><span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="w"> </span><span class="p">(</span><span class="n">Regex</span><span class="p">.</span><span class="n">Match</span><span class="w"> </span><span class="p">(</span><span class="s">&quot;say 25 miles more&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">@&quot;\d+\s(?=miles)&quot;</span><span class="p">));</span><span class="c1">//25</span>
</span></code></pre></div>
<p>Notice the word â€œmilesâ€ was not returned in the result, even though it was required to satisfy the match.</p>
<p>After a successful lookahead, matching continues as though the sneak preview never took place. So, if we append .* to our expression like this:</p>
<div class="language-csharp highlight"><pre><span></span><code><span id="__span-376-1"><a id="__codelineno-376-1" name="__codelineno-376-1" href="#__codelineno-376-1"></a><span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="w"> </span><span class="p">(</span><span class="n">Regex</span><span class="p">.</span><span class="n">Match</span><span class="w"> </span><span class="p">(</span><span class="s">&quot;say 25 miles more&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">@&quot;\d+\s(?=miles).*&quot;</span><span class="p">));</span>
</span><span id="__span-376-2"><a id="__codelineno-376-2" name="__codelineno-376-2" href="#__codelineno-376-2"></a><span class="c1">//25 miles more</span>
</span></code></pre></div>
<p>Lookahead can be useful in enforcing rules for a strong password. Suppose that a password must be at least six characters and contain at least one digit. With a lookup, we could achieve this as follows:</p>
<div class="language-csharp highlight"><pre><span></span><code><span id="__span-377-1"><a id="__codelineno-377-1" name="__codelineno-377-1" href="#__codelineno-377-1"></a><span class="kt">string</span><span class="w"> </span><span class="n">password</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;...&quot;</span><span class="p">;</span><span class="w"> </span><span class="kt">bool</span><span class="w"> </span><span class="n">ok</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Regex</span><span class="p">.</span><span class="n">IsMatch</span><span class="w"> </span><span class="p">(</span><span class="n">password</span><span class="p">,</span><span class="w"> </span><span class="s">@&quot;(?=.*\d).{6,}&quot;</span><span class="p">);</span>
</span></code></pre></div>
<p>This first performs a lookahead to ensure that a digit occurs somewhere in the string. If satisfied, it returns to its position before the sneak preview began and matches six or more characters.</p>
<p>The opposite is the negative lookahead construct, (?!expr). This requires that the match not be followed by expr. The following expression matches â€œgoodâ€â€”unless â€œhoweverâ€ or â€œbutâ€ appears later in the string:</p>
<div class="language-csharp highlight"><pre><span></span><code><span id="__span-378-1"><a id="__codelineno-378-1" name="__codelineno-378-1" href="#__codelineno-378-1"></a><span class="kt">string</span><span class="w"> </span><span class="n">regex</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;(?i)good(?!.*(however|but))&quot;</span><span class="p">;</span>
</span><span id="__span-378-2"><a id="__codelineno-378-2" name="__codelineno-378-2" href="#__codelineno-378-2"></a><span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="w"> </span><span class="p">(</span><span class="n">Regex</span><span class="p">.</span><span class="n">IsMatch</span><span class="w"> </span><span class="p">(</span><span class="s">&quot;Good work! But...&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">regex</span><span class="p">));</span><span class="w"> </span><span class="c1">// False</span>
</span><span id="__span-378-3"><a id="__codelineno-378-3" name="__codelineno-378-3" href="#__codelineno-378-3"></a><span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="w"> </span><span class="p">(</span><span class="n">Regex</span><span class="p">.</span><span class="n">IsMatch</span><span class="w"> </span><span class="p">(</span><span class="s">&quot;Good work! Thanks!&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">regex</span><span class="p">));</span><span class="w"> </span><span class="c1">// True</span>
</span></code></pre></div>
<p>The (?&lt;=expr) construct denotes positive lookbehind and requires that a match be preceded by a specified expression. The opposite construct, (?&lt;!expr), denotes negative lookbehind and requires that a match not be preceded by a specified expression. For example, the following matches â€œgoodâ€â€”unless â€œhoweverâ€ appears earlier in the string:</p>
<div class="language-csharp highlight"><pre><span></span><code><span id="__span-379-1"><a id="__codelineno-379-1" name="__codelineno-379-1" href="#__codelineno-379-1"></a><span class="kt">string</span><span class="w"> </span><span class="n">regex</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;(?i)(?&lt;!however.*)good&quot;</span><span class="p">;</span>
</span><span id="__span-379-2"><a id="__codelineno-379-2" name="__codelineno-379-2" href="#__codelineno-379-2"></a><span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="w"> </span><span class="p">(</span><span class="n">Regex</span><span class="p">.</span><span class="n">IsMatch</span><span class="w"> </span><span class="p">(</span><span class="s">&quot;However good, we...&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">regex</span><span class="p">));</span><span class="w"> </span><span class="c1">// False</span>
</span><span id="__span-379-3"><a id="__codelineno-379-3" name="__codelineno-379-3" href="#__codelineno-379-3"></a><span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="w"> </span><span class="p">(</span><span class="n">Regex</span><span class="p">.</span><span class="n">IsMatch</span><span class="w"> </span><span class="p">(</span><span class="s">&quot;Very good, thanks!&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">regex</span><span class="p">));</span><span class="w"> </span><span class="c1">// True</span>
</span></code></pre></div>
<h2 id="anchors">Anchors</h2>
<p>The anchors <code>^</code> and <code>$</code> match a particular position. By default:</p>
<ul>
<li><code>^</code> Matches the start of the string,<code>^</code> has two context-dependent meanings: an anchor and a character class negator.</li>
<li><code>$</code> Matches the end of the string. <code>$</code> has two context-dependent meanings: an anchor and a replacement group denoter</li>
</ul>
<p>For example</p>
<div class="language-csharp highlight"><pre><span></span><code><span id="__span-380-1"><a id="__codelineno-380-1" name="__codelineno-380-1" href="#__codelineno-380-1"></a><span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="w"> </span><span class="p">(</span><span class="n">Regex</span><span class="p">.</span><span class="n">Match</span><span class="w"> </span><span class="p">(</span><span class="s">&quot;Not now&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;^[Nn]o&quot;</span><span class="p">));</span><span class="w"> </span><span class="c1">// No</span>
</span><span id="__span-380-2"><a id="__codelineno-380-2" name="__codelineno-380-2" href="#__codelineno-380-2"></a><span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="w"> </span><span class="p">(</span><span class="n">Regex</span><span class="p">.</span><span class="n">Match</span><span class="w"> </span><span class="p">(</span><span class="s">&quot;f = 0.2F&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;[Ff]$&quot;</span><span class="p">));</span><span class="w"> </span><span class="c1">// F</span>
</span></code></pre></div>
<p>When you specify <code>RegexOptions.Multiline</code> or include (?m) in the expression:</p>
<ul>
<li><code>^</code> matches the start of the string or line (directly after a \n)</li>
<li><code>$</code> matches the end of the string or line (directly before a \n)</li>
</ul>
<p>Thereâ€™s a catch to using $ in multiline mode: a newline in Windows is nearly always denoted with \r\n rather than just \n. This means that for $ to be useful for Windows files, you must usually match the \r, as well, with a positive lookahead:</p>
<div class="language-csharp highlight"><pre><span></span><code><span id="__span-381-1"><a id="__codelineno-381-1" name="__codelineno-381-1" href="#__codelineno-381-1"></a><span class="p">(</span><span class="o">?=</span><span class="err">\</span><span class="n">r</span><span class="o">?</span><span class="err">$</span><span class="p">)</span>
</span></code></pre></div>
<p>The positive lookahead ensures that \r doesnâ€™t become part of the result. The following matches lines that end in ".txt":</p>
<div class="language-csharp highlight"><pre><span></span><code><span id="__span-382-1"><a id="__codelineno-382-1" name="__codelineno-382-1" href="#__codelineno-382-1"></a><span class="kt">string</span><span class="w"> </span><span class="n">fileNames</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;a.txt&quot;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s">&quot;\r\n&quot;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s">&quot;b.docx&quot;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s">&quot;\r\n&quot;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s">&quot;c.txt&quot;</span><span class="p">;</span>
</span><span id="__span-382-2"><a id="__codelineno-382-2" name="__codelineno-382-2" href="#__codelineno-382-2"></a><span class="kt">string</span><span class="w"> </span><span class="n">r</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">@&quot;.+\.txt(?=\r?$)&quot;</span><span class="p">;</span>
</span><span id="__span-382-3"><a id="__codelineno-382-3" name="__codelineno-382-3" href="#__codelineno-382-3"></a><span class="k">foreach</span><span class="w"> </span><span class="p">(</span><span class="n">Match</span><span class="w"> </span><span class="n">m</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">Regex</span><span class="p">.</span><span class="n">Matches</span><span class="w"> </span><span class="p">(</span><span class="n">fileNames</span><span class="p">,</span><span class="w"> </span><span class="n">r</span><span class="p">,</span><span class="w"> </span><span class="n">RegexOptions</span><span class="p">.</span><span class="n">Multiline</span><span class="p">))</span>
</span><span id="__span-382-4"><a id="__codelineno-382-4" name="__codelineno-382-4" href="#__codelineno-382-4"></a><span class="w"> </span><span class="n">Console</span><span class="p">.</span><span class="n">Write</span><span class="w"> </span><span class="p">(</span><span class="n">m</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s">&quot; &quot;</span><span class="p">);</span>
</span><span id="__span-382-5"><a id="__codelineno-382-5" name="__codelineno-382-5" href="#__codelineno-382-5"></a><span class="c1">//OUTPUT: a.txt c.txt</span>
</span></code></pre></div>
<p>The following matches all empty lines in string s:</p>
<div class="language-csharp highlight"><pre><span></span><code><span id="__span-383-1"><a id="__codelineno-383-1" name="__codelineno-383-1" href="#__codelineno-383-1"></a><span class="n">MatchCollection</span><span class="w"> </span><span class="n">emptyLines</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Regex</span><span class="p">.</span><span class="n">Matches</span><span class="w"> </span><span class="p">(</span><span class="n">s</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;^(?=\r?$)&quot;</span><span class="p">,</span><span class="n">RegexOptions</span><span class="p">.</span><span class="n">Multiline</span><span class="p">);</span>
</span></code></pre></div>
<p>The following matches all lines that are either empty or contain only whitespace:</p>
<div class="language-csharp highlight"><pre><span></span><code><span id="__span-384-1"><a id="__codelineno-384-1" name="__codelineno-384-1" href="#__codelineno-384-1"></a><span class="n">MatchCollection</span><span class="w"> </span><span class="n">blankLines</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Regex</span><span class="p">.</span><span class="n">Matches</span><span class="w"> </span><span class="p">(</span><span class="n">s</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;^[ \t]*(?=\r?$)&quot;</span><span class="p">,</span><span class="n">RegexOptions</span><span class="p">.</span><span class="n">Multiline</span><span class="p">);</span>
</span></code></pre></div>
<p>Because an anchor matches a position rather than a character, specifying an anchor on its own matches an empty string:</p>
<div class="language-csharp highlight"><pre><span></span><code><span id="__span-385-1"><a id="__codelineno-385-1" name="__codelineno-385-1" href="#__codelineno-385-1"></a><span class="n">nsole</span><span class="p">.</span><span class="n">WriteLine</span><span class="w"> </span><span class="p">(</span><span class="n">Regex</span><span class="p">.</span><span class="n">Match</span><span class="w"> </span><span class="p">(</span><span class="s">&quot;x&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;$&quot;</span><span class="p">).</span><span class="n">Length</span><span class="p">);</span><span class="w"> </span><span class="c1">// 0</span>
</span></code></pre></div>
<h2 id="word-boundaries">Word Boundaries</h2>
<p>The word boundary assertion \b matches where word characters (\w) adjoin either:</p>
<ul>
<li>Nonword characters (\W)</li>
<li>The beginning/end of the string (^ and $)</li>
</ul>
<div class="language-csharp highlight"><pre><span></span><code><span id="__span-386-1"><a id="__codelineno-386-1" name="__codelineno-386-1" href="#__codelineno-386-1"></a><span class="k">foreach</span><span class="w"> </span><span class="p">(</span><span class="n">Match</span><span class="w"> </span><span class="n">m</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">Regex</span><span class="p">.</span><span class="n">Matches</span><span class="w"> </span><span class="p">(</span><span class="s">&quot;Wedding in Sarajevo&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">@&quot;\b\w+\b&quot;</span><span class="p">))</span>
</span><span id="__span-386-2"><a id="__codelineno-386-2" name="__codelineno-386-2" href="#__codelineno-386-2"></a><span class="w"> </span><span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="w"> </span><span class="p">(</span><span class="n">m</span><span class="p">);</span>
</span><span id="__span-386-3"><a id="__codelineno-386-3" name="__codelineno-386-3" href="#__codelineno-386-3"></a><span class="c1">//Wedding</span>
</span><span id="__span-386-4"><a id="__codelineno-386-4" name="__codelineno-386-4" href="#__codelineno-386-4"></a><span class="c1">//in</span>
</span><span id="__span-386-5"><a id="__codelineno-386-5" name="__codelineno-386-5" href="#__codelineno-386-5"></a><span class="c1">//Sarajevo</span>
</span></code></pre></div>
<p>The following statements highlight the effect of a word boundary</p>
<div class="language-csharp highlight"><pre><span></span><code><span id="__span-387-1"><a id="__codelineno-387-1" name="__codelineno-387-1" href="#__codelineno-387-1"></a><span class="kt">int</span><span class="w"> </span><span class="n">one</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Regex</span><span class="p">.</span><span class="n">Matches</span><span class="w"> </span><span class="p">(</span><span class="s">&quot;Wedding in Sarajevo&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">@&quot;\bin\b&quot;</span><span class="p">).</span><span class="n">Count</span><span class="p">;</span><span class="w"> </span><span class="c1">// 1</span>
</span><span id="__span-387-2"><a id="__codelineno-387-2" name="__codelineno-387-2" href="#__codelineno-387-2"></a><span class="kt">int</span><span class="w"> </span><span class="n">two</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Regex</span><span class="p">.</span><span class="n">Matches</span><span class="w"> </span><span class="p">(</span><span class="s">&quot;Wedding in Sarajevo&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">@&quot;in&quot;</span><span class="p">).</span><span class="n">Count</span><span class="p">;</span><span class="w"> </span><span class="c1">// 2</span>
</span></code></pre></div>
<p>The next query uses positive lookahead to return words followed by â€œ(sic)â€:</p>
<div class="language-csharp highlight"><pre><span></span><code><span id="__span-388-1"><a id="__codelineno-388-1" name="__codelineno-388-1" href="#__codelineno-388-1"></a><span class="kt">string</span><span class="w"> </span><span class="n">text</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;Don&#39;t loose (sic) your cool&quot;</span><span class="p">;</span>
</span><span id="__span-388-2"><a id="__codelineno-388-2" name="__codelineno-388-2" href="#__codelineno-388-2"></a><span class="n">Console</span><span class="p">.</span><span class="n">Write</span><span class="w"> </span><span class="p">(</span><span class="n">Regex</span><span class="p">.</span><span class="n">Match</span><span class="w"> </span><span class="p">(</span><span class="n">text</span><span class="p">,</span><span class="w"> </span><span class="s">@&quot;\b\w+\b\s(?=\(sic\))&quot;</span><span class="p">));</span><span class="w"> </span><span class="c1">// loose</span>
</span></code></pre></div>
<h1 id="groups">Groups</h1>
<p>Sometimes, itâ€™s useful to separate a regular expression into a series of subexpressions, or groups. For instance, consider the following regular expression that represents a US phone number such as 206-465-1918:</p>
<div class="language-csharp highlight"><pre><span></span><code><span id="__span-389-1"><a id="__codelineno-389-1" name="__codelineno-389-1" href="#__codelineno-389-1"></a><span class="err">\</span><span class="n">d</span><span class="p">{</span><span class="mi">3</span><span class="p">}</span><span class="o">-</span><span class="err">\</span><span class="n">d</span><span class="p">{</span><span class="mi">3</span><span class="p">}</span><span class="o">-</span><span class="err">\</span><span class="n">d</span><span class="p">{</span><span class="mi">4</span><span class="p">}</span>
</span></code></pre></div>
<p>Suppose that we want to separate this into two groups: area code and local number. We can achieve this by using parentheses to capture each group:</p>
<div class="language-csharp highlight"><pre><span></span><code><span id="__span-390-1"><a id="__codelineno-390-1" name="__codelineno-390-1" href="#__codelineno-390-1"></a><span class="p">(</span><span class="err">\</span><span class="n">d</span><span class="p">{</span><span class="mi">3</span><span class="p">})</span><span class="o">-</span><span class="p">(</span><span class="err">\</span><span class="n">d</span><span class="p">{</span><span class="mi">3</span><span class="p">}</span><span class="o">-</span><span class="err">\</span><span class="n">d</span><span class="p">{</span><span class="mi">4</span><span class="p">})</span>
</span></code></pre></div>
<p>We then retrieve the groups programmatically:</p>
<div class="language-csharp highlight"><pre><span></span><code><span id="__span-391-1"><a id="__codelineno-391-1" name="__codelineno-391-1" href="#__codelineno-391-1"></a><span class="n">Match</span><span class="w"> </span><span class="n">m</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Regex</span><span class="p">.</span><span class="n">Match</span><span class="w"> </span><span class="p">(</span><span class="s">&quot;206-465-1918&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">@&quot;(\d{3})-(\d{3}-\d{4})&quot;</span><span class="p">);</span>
</span><span id="__span-391-2"><a id="__codelineno-391-2" name="__codelineno-391-2" href="#__codelineno-391-2"></a><span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="w"> </span><span class="p">(</span><span class="n">m</span><span class="p">.</span><span class="n">Groups</span><span class="p">[</span><span class="mi">1</span><span class="p">]);</span><span class="w"> </span><span class="c1">// 206</span>
</span><span id="__span-391-3"><a id="__codelineno-391-3" name="__codelineno-391-3" href="#__codelineno-391-3"></a><span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="w"> </span><span class="p">(</span><span class="n">m</span><span class="p">.</span><span class="n">Groups</span><span class="p">[</span><span class="mi">2</span><span class="p">]);</span><span class="w"> </span><span class="c1">// 465-1918</span>
</span></code></pre></div>
<p>The zeroth group represents the entire match. In other words, it has the same value as the matchâ€™s Value:</p>
<div class="language-csharp highlight"><pre><span></span><code><span id="__span-392-1"><a id="__codelineno-392-1" name="__codelineno-392-1" href="#__codelineno-392-1"></a><span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="w"> </span><span class="p">(</span><span class="n">m</span><span class="p">.</span><span class="n">Groups</span><span class="p">[</span><span class="mi">0</span><span class="p">]);</span><span class="w"> </span><span class="c1">// 206-465-1918</span>
</span><span id="__span-392-2"><a id="__codelineno-392-2" name="__codelineno-392-2" href="#__codelineno-392-2"></a><span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="w"> </span><span class="p">(</span><span class="n">m</span><span class="p">);</span><span class="w"> </span><span class="c1">// 206-465-1918</span>
</span></code></pre></div>
<p>Groups are part of the regular expressions language itself. This means that you can refer to a group within a regular expression. The \n syntax lets you index the group by group number n within the expression. For example, the expression (\w)ee\1 matches deed and peep. In the following example, we find all words in a string startâ€ ing and ending in the same letter:</p>
<div class="language-csharp highlight"><pre><span></span><code><span id="__span-393-1"><a id="__codelineno-393-1" name="__codelineno-393-1" href="#__codelineno-393-1"></a><span class="k">foreach</span><span class="w"> </span><span class="p">(</span><span class="n">Match</span><span class="w"> </span><span class="n">m</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">Regex</span><span class="p">.</span><span class="n">Matches</span><span class="w"> </span><span class="p">(</span><span class="s">&quot;pop pope peep&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">@&quot;\b(\w)\w+\1\b&quot;</span><span class="p">))</span>
</span><span id="__span-393-2"><a id="__codelineno-393-2" name="__codelineno-393-2" href="#__codelineno-393-2"></a><span class="w"> </span><span class="n">Console</span><span class="p">.</span><span class="n">Write</span><span class="w"> </span><span class="p">(</span><span class="n">m</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s">&quot; &quot;</span><span class="p">);</span><span class="w"> </span><span class="c1">// pop peep</span>
</span></code></pre></div>
<p>The brackets around the \w instruct the regular expressions engine to store the subâ€ match in a group (in this case, a single letter) so that it can be used later. We refer to that group later using \1, meaning the first group in the expression.</p>
<h2 id="named-groups">Named Groups</h2>
<p>In a long or complex expression, it can be easier to work with groups by name rather than index. Hereâ€™s a rewrite of the previous example, using a group that we name 'letter'</p>
<div class="language-csharp highlight"><pre><span></span><code><span id="__span-394-1"><a id="__codelineno-394-1" name="__codelineno-394-1" href="#__codelineno-394-1"></a><span class="kt">string</span><span class="w"> </span><span class="n">regEx</span><span class="w"> </span><span class="o">=</span>
</span><span id="__span-394-2"><a id="__codelineno-394-2" name="__codelineno-394-2" href="#__codelineno-394-2"></a><span class="w"> </span><span class="s">@&quot;\b&quot;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="c1">// word boundary</span>
</span><span id="__span-394-3"><a id="__codelineno-394-3" name="__codelineno-394-3" href="#__codelineno-394-3"></a><span class="w"> </span><span class="s">@&quot;(?&#39;letter&#39;\w)&quot;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="c1">// match first letter, and name it &#39;letter&#39;</span>
</span><span id="__span-394-4"><a id="__codelineno-394-4" name="__codelineno-394-4" href="#__codelineno-394-4"></a><span class="w"> </span><span class="s">@&quot;\w+&quot;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="c1">// match middle letters</span>
</span><span id="__span-394-5"><a id="__codelineno-394-5" name="__codelineno-394-5" href="#__codelineno-394-5"></a><span class="w"> </span><span class="s">@&quot;\k&#39;letter&#39;&quot;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="c1">// match last letter, denoted by &#39;letter&#39;</span>
</span><span id="__span-394-6"><a id="__codelineno-394-6" name="__codelineno-394-6" href="#__codelineno-394-6"></a><span class="w"> </span><span class="s">@&quot;\b&quot;</span><span class="p">;</span><span class="w"> </span><span class="c1">// word boundary</span>
</span><span id="__span-394-7"><a id="__codelineno-394-7" name="__codelineno-394-7" href="#__codelineno-394-7"></a><span class="k">foreach</span><span class="w"> </span><span class="p">(</span><span class="n">Match</span><span class="w"> </span><span class="n">m</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">Regex</span><span class="p">.</span><span class="n">Matches</span><span class="w"> </span><span class="p">(</span><span class="s">&quot;bob pope peep&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">regEx</span><span class="p">))</span>
</span><span id="__span-394-8"><a id="__codelineno-394-8" name="__codelineno-394-8" href="#__codelineno-394-8"></a><span class="w"> </span><span class="n">Console</span><span class="p">.</span><span class="n">Write</span><span class="w"> </span><span class="p">(</span><span class="n">m</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s">&quot; &quot;</span><span class="p">);</span><span class="w"> </span><span class="c1">// bob peep</span>
</span></code></pre></div>
<p>Hereâ€™s how to name a captured group:</p>
<div class="language-csharp highlight"><pre><span></span><code><span id="__span-395-1"><a id="__codelineno-395-1" name="__codelineno-395-1" href="#__codelineno-395-1"></a><span class="p">(</span><span class="o">?</span><span class="err">&#39;</span><span class="k">group</span><span class="o">-</span><span class="n">name</span><span class="err">&#39;</span><span class="k">group</span><span class="o">-</span><span class="n">expr</span><span class="p">)</span><span class="w"> </span><span class="k">or</span><span class="w"> </span><span class="p">(</span><span class="o">?&lt;</span><span class="k">group</span><span class="o">-</span><span class="n">name</span><span class="o">&gt;</span><span class="k">group</span><span class="o">-</span><span class="n">expr</span><span class="p">)</span>
</span></code></pre></div>
<p>And hereâ€™s how to refer to a group:</p>
<div class="language-csharp highlight"><pre><span></span><code><span id="__span-396-1"><a id="__codelineno-396-1" name="__codelineno-396-1" href="#__codelineno-396-1"></a><span class="err">\</span><span class="n">k</span><span class="err">&#39;</span><span class="k">group</span><span class="o">-</span><span class="n">name</span><span class="err">&#39;</span><span class="w"> </span><span class="k">or</span><span class="w"> </span><span class="err">\</span><span class="n">k</span><span class="o">&lt;</span><span class="k">group</span><span class="o">-</span><span class="n">name</span><span class="o">&gt;</span>
</span></code></pre></div>
<p>The following example matches a simple (non-nested) XML/HTML element by looking for start and end nodes with a matching name:</p>
<div class="language-csharp highlight"><pre><span></span><code><span id="__span-397-1"><a id="__codelineno-397-1" name="__codelineno-397-1" href="#__codelineno-397-1"></a><span class="kt">string</span><span class="w"> </span><span class="n">regFind</span><span class="w"> </span><span class="o">=</span>
</span><span id="__span-397-2"><a id="__codelineno-397-2" name="__codelineno-397-2" href="#__codelineno-397-2"></a><span class="w"> </span><span class="s">@&quot;&lt;(?&#39;tag&#39;\w+?).*&gt;&quot;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="c1">// lazy-match first tag, and name it &#39;tag&#39;</span>
</span><span id="__span-397-3"><a id="__codelineno-397-3" name="__codelineno-397-3" href="#__codelineno-397-3"></a><span class="w"> </span><span class="s">@&quot;(?&#39;text&#39;.*?)&quot;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="c1">// lazy-match text content, name it &#39;text&#39;</span>
</span><span id="__span-397-4"><a id="__codelineno-397-4" name="__codelineno-397-4" href="#__codelineno-397-4"></a><span class="w"> </span><span class="s">@&quot;&lt;/\k&#39;tag&#39;&gt;&quot;</span><span class="p">;</span><span class="w"> </span><span class="c1">// match last tag, denoted by &#39;tag&#39;</span>
</span><span id="__span-397-5"><a id="__codelineno-397-5" name="__codelineno-397-5" href="#__codelineno-397-5"></a>
</span><span id="__span-397-6"><a id="__codelineno-397-6" name="__codelineno-397-6" href="#__codelineno-397-6"></a><span class="n">Match</span><span class="w"> </span><span class="n">m</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Regex</span><span class="p">.</span><span class="n">Match</span><span class="w"> </span><span class="p">(</span><span class="s">&quot;&lt;h1&gt;hello&lt;/h1&gt;&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">regFind</span><span class="p">);</span>
</span><span id="__span-397-7"><a id="__codelineno-397-7" name="__codelineno-397-7" href="#__codelineno-397-7"></a><span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="w"> </span><span class="p">(</span><span class="n">m</span><span class="p">.</span><span class="n">Groups</span><span class="w"> </span><span class="p">[</span><span class="s">&quot;tag&quot;</span><span class="p">]);</span><span class="w"> </span><span class="c1">// h1</span>
</span><span id="__span-397-8"><a id="__codelineno-397-8" name="__codelineno-397-8" href="#__codelineno-397-8"></a><span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="w"> </span><span class="p">(</span><span class="n">m</span><span class="p">.</span><span class="n">Groups</span><span class="w"> </span><span class="p">[</span><span class="s">&quot;text&quot;</span><span class="p">]);</span><span class="w"> </span><span class="c1">// hello</span>
</span></code></pre></div>
<p>Allowing for all possible variations in XML structure, such as nested elements, is more complex. The .NET regular expressions engine has a sophisticated extension called â€œmatched balanced constructsâ€ that can assist with nested tagsâ€”information on this is available on the internet and in Mastering Regular Expressions (Oâ€™Reilly) by Jeffrey E. F. Friedl</p>
<h1 id="replacing-and-splitting-text">Replacing and Splitting Text</h1>
<p>The RegEx.Replace method works like string.Replace except that it uses a regular expression</p>
<p>The following replaces â€œcatâ€ with â€œdogâ€. Unlike with string.Replace, â€œcatapultâ€ wonâ€™t change into â€œdogapultâ€ because we match on word boundaries:</p>
<div class="language-csharp highlight"><pre><span></span><code><span id="__span-398-1"><a id="__codelineno-398-1" name="__codelineno-398-1" href="#__codelineno-398-1"></a><span class="kt">string</span><span class="w"> </span><span class="n">find</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">@&quot;\bcat\b&quot;</span><span class="p">;</span>
</span><span id="__span-398-2"><a id="__codelineno-398-2" name="__codelineno-398-2" href="#__codelineno-398-2"></a><span class="kt">string</span><span class="w"> </span><span class="n">replace</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;dog&quot;</span><span class="p">;</span>
</span><span id="__span-398-3"><a id="__codelineno-398-3" name="__codelineno-398-3" href="#__codelineno-398-3"></a><span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="w"> </span><span class="p">(</span><span class="n">Regex</span><span class="p">.</span><span class="n">Replace</span><span class="w"> </span><span class="p">(</span><span class="s">&quot;catapult the cat&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">find</span><span class="p">,</span><span class="w"> </span><span class="n">replace</span><span class="p">));</span>
</span><span id="__span-398-4"><a id="__codelineno-398-4" name="__codelineno-398-4" href="#__codelineno-398-4"></a><span class="c1">//OUTPUT: catapult the dog</span>
</span></code></pre></div>
<p>The replacement string can reference the original match with the $0 substitution construct. The following example wraps numbers within a string in angle brackets:</p>
<div class="language-csharp highlight"><pre><span></span><code><span id="__span-399-1"><a id="__codelineno-399-1" name="__codelineno-399-1" href="#__codelineno-399-1"></a><span class="kt">string</span><span class="w"> </span><span class="n">text</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;10 plus 20 makes 30&quot;</span><span class="p">;</span>
</span><span id="__span-399-2"><a id="__codelineno-399-2" name="__codelineno-399-2" href="#__codelineno-399-2"></a><span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="w"> </span><span class="p">(</span><span class="n">Regex</span><span class="p">.</span><span class="n">Replace</span><span class="w"> </span><span class="p">(</span><span class="n">text</span><span class="p">,</span><span class="w"> </span><span class="s">@&quot;\d+&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">@&quot;&lt;$0&gt;&quot;</span><span class="p">));</span>
</span><span id="__span-399-3"><a id="__codelineno-399-3" name="__codelineno-399-3" href="#__codelineno-399-3"></a><span class="n">OUTPUT</span><span class="p">:</span><span class="w"> </span><span class="o">&lt;</span><span class="mi">10</span><span class="o">&gt;</span><span class="w"> </span><span class="n">plus</span><span class="w"> </span><span class="o">&lt;</span><span class="mi">20</span><span class="o">&gt;</span><span class="w"> </span><span class="n">makes</span><span class="w"> </span><span class="o">&lt;</span><span class="mi">30</span><span class="o">&gt;</span>
</span></code></pre></div>
<p>You can access any captured groups with $1, $2, $3, and so on, or ${name} for a named group. To illustrate how this can be useful, consider the regular expression in the previous section that matched a simple XML element. By rearranging the groups, we can form a replacement expression that moves the elementâ€™s content into an XML attribute:</p>
<div class="language-csharp highlight"><pre><span></span><code><span id="__span-400-1"><a id="__codelineno-400-1" name="__codelineno-400-1" href="#__codelineno-400-1"></a><span class="kt">string</span><span class="w"> </span><span class="n">regFind</span><span class="w"> </span><span class="o">=</span>
</span><span id="__span-400-2"><a id="__codelineno-400-2" name="__codelineno-400-2" href="#__codelineno-400-2"></a><span class="w"> </span><span class="s">@&quot;&lt;(?&#39;tag&#39;\w+?).*&gt;&quot;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="c1">// lazy-match first tag, and name it &#39;tag&#39;</span>
</span><span id="__span-400-3"><a id="__codelineno-400-3" name="__codelineno-400-3" href="#__codelineno-400-3"></a><span class="w"> </span><span class="s">@&quot;(?&#39;text&#39;.*?)&quot;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="c1">// lazy-match text content, name it &#39;text&#39;</span>
</span><span id="__span-400-4"><a id="__codelineno-400-4" name="__codelineno-400-4" href="#__codelineno-400-4"></a><span class="w"> </span><span class="s">@&quot;&lt;/\k&#39;tag&#39;&gt;&quot;</span><span class="p">;</span><span class="w"> </span><span class="c1">// match last tag, denoted by &#39;tag&#39;</span>
</span><span id="__span-400-5"><a id="__codelineno-400-5" name="__codelineno-400-5" href="#__codelineno-400-5"></a><span class="kt">string</span><span class="w"> </span><span class="n">regReplace</span><span class="w"> </span><span class="o">=</span>
</span><span id="__span-400-6"><a id="__codelineno-400-6" name="__codelineno-400-6" href="#__codelineno-400-6"></a><span class="w"> </span><span class="s">@&quot;&lt;${tag}&quot;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="c1">// &lt;tag</span>
</span><span id="__span-400-7"><a id="__codelineno-400-7" name="__codelineno-400-7" href="#__codelineno-400-7"></a><span class="w"> </span><span class="s">@&quot;value=&quot;&quot;&quot;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="c1">// value=&quot;</span>
</span><span id="__span-400-8"><a id="__codelineno-400-8" name="__codelineno-400-8" href="#__codelineno-400-8"></a><span class="w"> </span><span class="s">@&quot;${text}&quot;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="c1">// text</span>
</span><span id="__span-400-9"><a id="__codelineno-400-9" name="__codelineno-400-9" href="#__codelineno-400-9"></a><span class="w"> </span><span class="s">@&quot;&quot;&quot;/&gt;&quot;</span><span class="p">;</span><span class="w"> </span><span class="c1">// &quot;/&gt;</span>
</span><span id="__span-400-10"><a id="__codelineno-400-10" name="__codelineno-400-10" href="#__codelineno-400-10"></a><span class="n">Console</span><span class="p">.</span><span class="n">Write</span><span class="w"> </span><span class="p">(</span><span class="n">Regex</span><span class="p">.</span><span class="n">Replace</span><span class="w"> </span><span class="p">(</span><span class="s">&quot;&lt;msg&gt;hello&lt;/msg&gt;&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">regFind</span><span class="p">,</span><span class="w"> </span><span class="n">regReplace</span><span class="p">));</span>
</span><span id="__span-400-11"><a id="__codelineno-400-11" name="__codelineno-400-11" href="#__codelineno-400-11"></a><span class="c1">//Hereâ€™s the result:</span>
</span><span id="__span-400-12"><a id="__codelineno-400-12" name="__codelineno-400-12" href="#__codelineno-400-12"></a><span class="o">&lt;</span><span class="n">msg</span><span class="w"> </span><span class="k">value</span><span class="o">=</span><span class="s">&quot;hello&quot;</span><span class="o">/&gt;</span>
</span></code></pre></div>
<h2 id="matchevaluator-delegate">MatchEvaluator Delegate</h2>
<p>Replace has an overload that takes a MatchEvaluator delegate, which is invoked per match. This allows you to delegate the content of the replacement string to C# code when the regular expressions language isnâ€™t expressive enough:</p>
<div class="language-csharp highlight"><pre><span></span><code><span id="__span-401-1"><a id="__codelineno-401-1" name="__codelineno-401-1" href="#__codelineno-401-1"></a><span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="w"> </span><span class="p">(</span><span class="n">Regex</span><span class="p">.</span><span class="n">Replace</span><span class="w"> </span><span class="p">(</span><span class="s">&quot;5 is less than 10&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">@&quot;\d+&quot;</span><span class="p">,</span>
</span><span id="__span-401-2"><a id="__codelineno-401-2" name="__codelineno-401-2" href="#__codelineno-401-2"></a><span class="w"> </span><span class="n">m</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="p">.</span><span class="n">Parse</span><span class="w"> </span><span class="p">(</span><span class="n">m</span><span class="p">.</span><span class="n">Value</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mi">10</span><span class="p">).</span><span class="n">ToString</span><span class="p">())</span><span class="w"> </span><span class="p">);</span>
</span><span id="__span-401-3"><a id="__codelineno-401-3" name="__codelineno-401-3" href="#__codelineno-401-3"></a><span class="c1">//OUTPUT: 50 is less than 100</span>
</span></code></pre></div>
<h2 id="splitting-text">Splitting Text</h2>
<p>The static <code>Regex.Split</code> method is a more powerful version of the <code>string.Split</code> method, with a regular expression denoting the separator pattern. In this example, we split a string, where any digit counts as a separator:</p>
<div class="language-csharp highlight"><pre><span></span><code><span id="__span-402-1"><a id="__codelineno-402-1" name="__codelineno-402-1" href="#__codelineno-402-1"></a><span class="k">foreach</span><span class="w"> </span><span class="p">(</span><span class="kt">string</span><span class="w"> </span><span class="n">s</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">Regex</span><span class="p">.</span><span class="n">Split</span><span class="w"> </span><span class="p">(</span><span class="s">&quot;a5b7c&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">@&quot;\d&quot;</span><span class="p">))</span>
</span><span id="__span-402-2"><a id="__codelineno-402-2" name="__codelineno-402-2" href="#__codelineno-402-2"></a><span class="w"> </span><span class="n">Console</span><span class="p">.</span><span class="n">Write</span><span class="w"> </span><span class="p">(</span><span class="n">s</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s">&quot; &quot;</span><span class="p">);</span><span class="w"> </span><span class="c1">// a b c</span>
</span></code></pre></div>
<p>The result, here, doesnâ€™t include the separators themselves. You can include the sepâ€ arators, however, by wrapping the expression in a positive lookahead. The following splits a camel-case string into separate words:</p>
<div class="language-csharp highlight"><pre><span></span><code><span id="__span-403-1"><a id="__codelineno-403-1" name="__codelineno-403-1" href="#__codelineno-403-1"></a><span class="k">foreach</span><span class="w"> </span><span class="p">(</span><span class="kt">string</span><span class="w"> </span><span class="n">s</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">Regex</span><span class="p">.</span><span class="n">Split</span><span class="w"> </span><span class="p">(</span><span class="s">&quot;oneTwoThree&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">@&quot;(?=[A-Z])&quot;</span><span class="p">))</span>
</span><span id="__span-403-2"><a id="__codelineno-403-2" name="__codelineno-403-2" href="#__codelineno-403-2"></a><span class="w"> </span><span class="n">Console</span><span class="p">.</span><span class="n">Write</span><span class="w"> </span><span class="p">(</span><span class="n">s</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s">&quot; &quot;</span><span class="p">);</span><span class="w"> </span><span class="c1">// one Two Three</span>
</span></code></pre></div>
<h1 id="cookbook-regular-expressions">Cookbook Regular Expressions</h1>
<h2 id="recipes">Recipes</h2>
<h3 id="matching-social-security-numberphone-number">Matching Social Security number/phone number</h3>
<div class="language-csharp highlight"><pre><span></span><code><span id="__span-404-1"><a id="__codelineno-404-1" name="__codelineno-404-1" href="#__codelineno-404-1"></a><span class="kt">string</span><span class="w"> </span><span class="n">ssNum</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">@&quot;\d{3}-\d{2}-\d{4}&quot;</span><span class="p">;</span>
</span><span id="__span-404-2"><a id="__codelineno-404-2" name="__codelineno-404-2" href="#__codelineno-404-2"></a><span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="w"> </span><span class="p">(</span><span class="n">Regex</span><span class="p">.</span><span class="n">IsMatch</span><span class="w"> </span><span class="p">(</span><span class="s">&quot;123-45-6789&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">ssNum</span><span class="p">));</span><span class="w"> </span><span class="c1">// True</span>
</span><span id="__span-404-3"><a id="__codelineno-404-3" name="__codelineno-404-3" href="#__codelineno-404-3"></a><span class="kt">string</span><span class="w"> </span><span class="n">phone</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">@&quot;(?x)</span>
</span><span id="__span-404-4"><a id="__codelineno-404-4" name="__codelineno-404-4" href="#__codelineno-404-4"></a><span class="s"> ( \d{3}[-\s] | \(\d{3}\)\s? )</span>
</span><span id="__span-404-5"><a id="__codelineno-404-5" name="__codelineno-404-5" href="#__codelineno-404-5"></a><span class="s"> \d{3}[-\s]?</span>
</span><span id="__span-404-6"><a id="__codelineno-404-6" name="__codelineno-404-6" href="#__codelineno-404-6"></a><span class="s"> \d{4}&quot;</span><span class="p">;</span>
</span><span id="__span-404-7"><a id="__codelineno-404-7" name="__codelineno-404-7" href="#__codelineno-404-7"></a><span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="w"> </span><span class="p">(</span><span class="n">Regex</span><span class="p">.</span><span class="n">IsMatch</span><span class="w"> </span><span class="p">(</span><span class="s">&quot;123-456-7890&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">phone</span><span class="p">));</span><span class="w"> </span><span class="c1">// True</span>
</span><span id="__span-404-8"><a id="__codelineno-404-8" name="__codelineno-404-8" href="#__codelineno-404-8"></a><span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="w"> </span><span class="p">(</span><span class="n">Regex</span><span class="p">.</span><span class="n">IsMatch</span><span class="w"> </span><span class="p">(</span><span class="s">&quot;(123) 456-7890&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">phone</span><span class="p">));</span><span class="w"> </span><span class="c1">// True</span>
</span></code></pre></div>
<h3 id="extracting-name-value-pairs-one-per-line">Extracting â€œname = valueâ€ pairs (one per line)</h3>
<div class="language-csharp highlight"><pre><span></span><code><span id="__span-405-1"><a id="__codelineno-405-1" name="__codelineno-405-1" href="#__codelineno-405-1"></a><span class="n">Note</span><span class="w"> </span><span class="n">that</span><span class="w"> </span><span class="k">this</span><span class="w"> </span><span class="n">starts</span><span class="w"> </span><span class="k">with</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">multiline</span><span class="w"> </span><span class="nf">directive</span><span class="w"> </span><span class="p">(</span><span class="o">?</span><span class="n">m</span><span class="p">):</span>
</span><span id="__span-405-2"><a id="__codelineno-405-2" name="__codelineno-405-2" href="#__codelineno-405-2"></a><span class="kt">string</span><span class="w"> </span><span class="n">r</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">@&quot;(?m)^\s*(?&#39;name&#39;\w+)\s*=\s*(?&#39;value&#39;.*)\s*(?=\r?$)&quot;</span><span class="p">;</span>
</span><span id="__span-405-3"><a id="__codelineno-405-3" name="__codelineno-405-3" href="#__codelineno-405-3"></a><span class="kt">string</span><span class="w"> </span><span class="n">text</span><span class="w"> </span><span class="o">=</span>
</span><span id="__span-405-4"><a id="__codelineno-405-4" name="__codelineno-405-4" href="#__codelineno-405-4"></a><span class="w"> </span><span class="s">@&quot;id = 3</span>
</span><span id="__span-405-5"><a id="__codelineno-405-5" name="__codelineno-405-5" href="#__codelineno-405-5"></a><span class="s"> secure = true</span>
</span><span id="__span-405-6"><a id="__codelineno-405-6" name="__codelineno-405-6" href="#__codelineno-405-6"></a><span class="s"> timeout = 30&quot;</span><span class="p">;</span>
</span><span id="__span-405-7"><a id="__codelineno-405-7" name="__codelineno-405-7" href="#__codelineno-405-7"></a><span class="k">foreach</span><span class="w"> </span><span class="p">(</span><span class="n">Match</span><span class="w"> </span><span class="n">m</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">Regex</span><span class="p">.</span><span class="n">Matches</span><span class="w"> </span><span class="p">(</span><span class="n">text</span><span class="p">,</span><span class="w"> </span><span class="n">r</span><span class="p">))</span>
</span><span id="__span-405-8"><a id="__codelineno-405-8" name="__codelineno-405-8" href="#__codelineno-405-8"></a><span class="w"> </span><span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="w"> </span><span class="p">(</span><span class="n">m</span><span class="p">.</span><span class="n">Groups</span><span class="p">[</span><span class="s">&quot;name&quot;</span><span class="p">]</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s">&quot; is &quot;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">m</span><span class="p">.</span><span class="n">Groups</span><span class="p">[</span><span class="s">&quot;value&quot;</span><span class="p">]);</span>
</span><span id="__span-405-9"><a id="__codelineno-405-9" name="__codelineno-405-9" href="#__codelineno-405-9"></a><span class="c1">//id is 3 secure is true timeout is 30</span>
</span></code></pre></div>
<h3 id="strong-password-validation">Strong password validation</h3>
<div class="language-csharp highlight"><pre><span></span><code><span id="__span-406-1"><a id="__codelineno-406-1" name="__codelineno-406-1" href="#__codelineno-406-1"></a><span class="kt">string</span><span class="w"> </span><span class="n">r</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">@&quot;(?x)^(?=.* ( \d | \p{P} | \p{S} )).{6,}&quot;</span><span class="p">;</span>
</span><span id="__span-406-2"><a id="__codelineno-406-2" name="__codelineno-406-2" href="#__codelineno-406-2"></a><span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="w"> </span><span class="p">(</span><span class="n">Regex</span><span class="p">.</span><span class="n">IsMatch</span><span class="w"> </span><span class="p">(</span><span class="s">&quot;abc12&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">r</span><span class="p">));</span><span class="w"> </span><span class="c1">// False</span>
</span><span id="__span-406-3"><a id="__codelineno-406-3" name="__codelineno-406-3" href="#__codelineno-406-3"></a><span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="w"> </span><span class="p">(</span><span class="n">Regex</span><span class="p">.</span><span class="n">IsMatch</span><span class="w"> </span><span class="p">(</span><span class="s">&quot;abcdef&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">r</span><span class="p">));</span><span class="w"> </span><span class="c1">// False</span>
</span><span id="__span-406-4"><a id="__codelineno-406-4" name="__codelineno-406-4" href="#__codelineno-406-4"></a><span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="w"> </span><span class="p">(</span><span class="n">Regex</span><span class="p">.</span><span class="n">IsMatch</span><span class="w"> </span><span class="p">(</span><span class="s">&quot;ab88yz&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">r</span><span class="p">));</span><span class="w"> </span><span class="c1">// True</span>
</span></code></pre></div>
<h3 id="lines-of-at-least-80-characters">Lines of at least 80 characters</h3>
<div class="language-csharp highlight"><pre><span></span><code><span id="__span-407-1"><a id="__codelineno-407-1" name="__codelineno-407-1" href="#__codelineno-407-1"></a><span class="kt">string</span><span class="w"> </span><span class="n">r</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">@&quot;(?m)^.{80,}(?=\r?$)&quot;</span><span class="p">;</span>
</span><span id="__span-407-2"><a id="__codelineno-407-2" name="__codelineno-407-2" href="#__codelineno-407-2"></a><span class="kt">string</span><span class="w"> </span><span class="n">fifty</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="kt">string</span><span class="w"> </span><span class="p">(</span><span class="sc">&#39;x&#39;</span><span class="p">,</span><span class="w"> </span><span class="mi">50</span><span class="p">);</span>
</span><span id="__span-407-3"><a id="__codelineno-407-3" name="__codelineno-407-3" href="#__codelineno-407-3"></a><span class="kt">string</span><span class="w"> </span><span class="n">eighty</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="kt">string</span><span class="w"> </span><span class="p">(</span><span class="sc">&#39;x&#39;</span><span class="p">,</span><span class="w"> </span><span class="mi">80</span><span class="p">);</span>
</span><span id="__span-407-4"><a id="__codelineno-407-4" name="__codelineno-407-4" href="#__codelineno-407-4"></a><span class="kt">string</span><span class="w"> </span><span class="n">text</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">eighty</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s">&quot;\r\n&quot;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">fifty</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s">&quot;\r\n&quot;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">eighty</span><span class="p">;</span>
</span><span id="__span-407-5"><a id="__codelineno-407-5" name="__codelineno-407-5" href="#__codelineno-407-5"></a><span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="w"> </span><span class="p">(</span><span class="n">Regex</span><span class="p">.</span><span class="n">Matches</span><span class="w"> </span><span class="p">(</span><span class="n">text</span><span class="p">,</span><span class="w"> </span><span class="n">r</span><span class="p">).</span><span class="n">Count</span><span class="p">);</span><span class="w"> </span><span class="c1">// 2</span>
</span></code></pre></div>
<h3 id="parsing-datestimes-nnn-hms-ampm">Parsing dates/times (N/N/N H:M:S AM/PM)</h3>
<p>This expression handles a variety of numeric date formatsâ€”and works whether the year comes first or last. The (?x) directive improves readability by allowing whiteâ€ space; the (?i) switches off case sensitivity (for the optional AM/PM designator). You can then access each component of the match through the Groups collection:</p>
<div class="language-csharp highlight"><pre><span></span><code><span id="__span-408-1"><a id="__codelineno-408-1" name="__codelineno-408-1" href="#__codelineno-408-1"></a><span class="kt">string</span><span class="w"> </span><span class="n">r</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">@&quot;(?x)(?i)</span>
</span><span id="__span-408-2"><a id="__codelineno-408-2" name="__codelineno-408-2" href="#__codelineno-408-2"></a><span class="s">(\d{1,4}) [./-]</span>
</span><span id="__span-408-3"><a id="__codelineno-408-3" name="__codelineno-408-3" href="#__codelineno-408-3"></a><span class="s"> (\d{1,2}) [./-]</span>
</span><span id="__span-408-4"><a id="__codelineno-408-4" name="__codelineno-408-4" href="#__codelineno-408-4"></a><span class="s"> (\d{1,4}) [\sT]</span>
</span><span id="__span-408-5"><a id="__codelineno-408-5" name="__codelineno-408-5" href="#__codelineno-408-5"></a><span class="s">(\d+):(\d+):(\d+) \s? (A\.?M\.?|P\.?M\.?)?&quot;</span><span class="p">;</span>
</span><span id="__span-408-6"><a id="__codelineno-408-6" name="__codelineno-408-6" href="#__codelineno-408-6"></a><span class="kt">string</span><span class="w"> </span><span class="n">text</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;01/02/2008 5:20:50 PM&quot;</span><span class="p">;</span>
</span><span id="__span-408-7"><a id="__codelineno-408-7" name="__codelineno-408-7" href="#__codelineno-408-7"></a><span class="k">foreach</span><span class="w"> </span><span class="p">(</span><span class="n">Group</span><span class="w"> </span><span class="n">g</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">Regex</span><span class="p">.</span><span class="n">Match</span><span class="w"> </span><span class="p">(</span><span class="n">text</span><span class="p">,</span><span class="w"> </span><span class="n">r</span><span class="p">).</span><span class="n">Groups</span><span class="p">)</span>
</span><span id="__span-408-8"><a id="__codelineno-408-8" name="__codelineno-408-8" href="#__codelineno-408-8"></a><span class="w"> </span><span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="w"> </span><span class="p">(</span><span class="n">g</span><span class="p">.</span><span class="n">Value</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s">&quot; &quot;</span><span class="p">);</span>
</span><span id="__span-408-9"><a id="__codelineno-408-9" name="__codelineno-408-9" href="#__codelineno-408-9"></a><span class="c1">//01/02/2008 5:20:50 PM 01 02 2008 5 20 50 PM</span>
</span></code></pre></div>
<p>(Of course, this doesnâ€™t verify that the date/time is correct.)</p>
<h3 id="matching-roman-numerals">Matching Roman numerals</h3>
<div class="language-csharp highlight"><pre><span></span><code><span id="__span-409-1"><a id="__codelineno-409-1" name="__codelineno-409-1" href="#__codelineno-409-1"></a><span class="kt">string</span><span class="w"> </span><span class="n">r</span><span class="w"> </span><span class="o">=</span>
</span><span id="__span-409-2"><a id="__codelineno-409-2" name="__codelineno-409-2" href="#__codelineno-409-2"></a><span class="w"> </span><span class="s">@&quot;(?i)\bm*&quot;</span><span class="w"> </span><span class="o">+</span>
</span><span id="__span-409-3"><a id="__codelineno-409-3" name="__codelineno-409-3" href="#__codelineno-409-3"></a><span class="w"> </span><span class="s">@&quot;(d?c{0,3}|c[dm])&quot;</span><span class="w"> </span><span class="o">+</span>
</span><span id="__span-409-4"><a id="__codelineno-409-4" name="__codelineno-409-4" href="#__codelineno-409-4"></a><span class="w"> </span><span class="s">@&quot;(l?x{0,3}|x[lc])&quot;</span><span class="w"> </span><span class="o">+</span>
</span><span id="__span-409-5"><a id="__codelineno-409-5" name="__codelineno-409-5" href="#__codelineno-409-5"></a><span class="w"> </span><span class="s">@&quot;(v?i{0,3}|i[vx])&quot;</span><span class="w"> </span><span class="o">+</span>
</span><span id="__span-409-6"><a id="__codelineno-409-6" name="__codelineno-409-6" href="#__codelineno-409-6"></a><span class="w"> </span><span class="s">@&quot;\b&quot;</span><span class="p">;</span>
</span><span id="__span-409-7"><a id="__codelineno-409-7" name="__codelineno-409-7" href="#__codelineno-409-7"></a><span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="w"> </span><span class="p">(</span><span class="n">Regex</span><span class="p">.</span><span class="n">IsMatch</span><span class="w"> </span><span class="p">(</span><span class="s">&quot;MCMLXXXIV&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">r</span><span class="p">));</span><span class="w"> </span><span class="c1">// True</span>
</span></code></pre></div>
<h3 id="removing-repeated-words">Removing repeated words</h3>
<div class="language-csharp highlight"><pre><span></span><code><span id="__span-410-1"><a id="__codelineno-410-1" name="__codelineno-410-1" href="#__codelineno-410-1"></a><span class="kt">string</span><span class="w"> </span><span class="n">r</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">@&quot;(?&#39;dupe&#39;\w+)\W\k&#39;dupe&#39;&quot;</span><span class="p">;</span>
</span><span id="__span-410-2"><a id="__codelineno-410-2" name="__codelineno-410-2" href="#__codelineno-410-2"></a><span class="kt">string</span><span class="w"> </span><span class="n">text</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;In the the beginning...&quot;</span><span class="p">;</span>
</span><span id="__span-410-3"><a id="__codelineno-410-3" name="__codelineno-410-3" href="#__codelineno-410-3"></a><span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="w"> </span><span class="p">(</span><span class="n">Regex</span><span class="p">.</span><span class="n">Replace</span><span class="w"> </span><span class="p">(</span><span class="n">text</span><span class="p">,</span><span class="w"> </span><span class="n">r</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;${dupe}&quot;</span><span class="p">));</span>
</span><span id="__span-410-4"><a id="__codelineno-410-4" name="__codelineno-410-4" href="#__codelineno-410-4"></a><span class="c1">//In the beginning</span>
</span></code></pre></div>
<h3 id="word-count">Word count</h3>
<div class="language-csharp highlight"><pre><span></span><code><span id="__span-411-1"><a id="__codelineno-411-1" name="__codelineno-411-1" href="#__codelineno-411-1"></a><span class="kt">string</span><span class="w"> </span><span class="n">r</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">@&quot;\b(\w|[-&#39;])+\b&quot;</span><span class="p">;</span>
</span><span id="__span-411-2"><a id="__codelineno-411-2" name="__codelineno-411-2" href="#__codelineno-411-2"></a><span class="kt">string</span><span class="w"> </span><span class="n">text</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;It&#39;s all mumbo-jumbo to me&quot;</span><span class="p">;</span>
</span><span id="__span-411-3"><a id="__codelineno-411-3" name="__codelineno-411-3" href="#__codelineno-411-3"></a><span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="w"> </span><span class="p">(</span><span class="n">Regex</span><span class="p">.</span><span class="n">Matches</span><span class="w"> </span><span class="p">(</span><span class="n">text</span><span class="p">,</span><span class="w"> </span><span class="n">r</span><span class="p">).</span><span class="n">Count</span><span class="p">);</span><span class="w"> </span><span class="c1">// 5</span>
</span></code></pre></div>
<h3 id="matching-a-guid">Matching a GUID</h3>
<div class="language-csharp highlight"><pre><span></span><code><span id="__span-412-1"><a id="__codelineno-412-1" name="__codelineno-412-1" href="#__codelineno-412-1"></a><span class="kt">string</span><span class="w"> </span><span class="n">r</span><span class="w"> </span><span class="o">=</span>
</span><span id="__span-412-2"><a id="__codelineno-412-2" name="__codelineno-412-2" href="#__codelineno-412-2"></a><span class="w"> </span><span class="s">@&quot;(?i)\b&quot;</span><span class="w"> </span><span class="o">+</span>
</span><span id="__span-412-3"><a id="__codelineno-412-3" name="__codelineno-412-3" href="#__codelineno-412-3"></a><span class="w"> </span><span class="s">@&quot;[0-9a-fA-F]{8}\-&quot;</span><span class="w"> </span><span class="o">+</span>
</span><span id="__span-412-4"><a id="__codelineno-412-4" name="__codelineno-412-4" href="#__codelineno-412-4"></a><span class="w"> </span><span class="s">@&quot;[0-9a-fA-F]{4}\-&quot;</span><span class="w"> </span><span class="o">+</span>
</span><span id="__span-412-5"><a id="__codelineno-412-5" name="__codelineno-412-5" href="#__codelineno-412-5"></a><span class="w"> </span><span class="s">@&quot;[0-9a-fA-F]{4}\-&quot;</span><span class="w"> </span><span class="o">+</span>
</span><span id="__span-412-6"><a id="__codelineno-412-6" name="__codelineno-412-6" href="#__codelineno-412-6"></a><span class="w"> </span><span class="s">@&quot;[0-9a-fA-F]{4}\-&quot;</span><span class="w"> </span><span class="o">+</span>
</span><span id="__span-412-7"><a id="__codelineno-412-7" name="__codelineno-412-7" href="#__codelineno-412-7"></a><span class="w"> </span><span class="s">@&quot;[0-9a-fA-F]{12}&quot;</span><span class="w"> </span><span class="o">+</span>
</span><span id="__span-412-8"><a id="__codelineno-412-8" name="__codelineno-412-8" href="#__codelineno-412-8"></a><span class="w"> </span><span class="s">@&quot;\b&quot;</span><span class="p">;</span>
</span><span id="__span-412-9"><a id="__codelineno-412-9" name="__codelineno-412-9" href="#__codelineno-412-9"></a><span class="kt">string</span><span class="w"> </span><span class="n">text</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;Its key is {3F2504E0-4F89-11D3-9A0C-0305E82C3301}.&quot;</span><span class="p">;</span>
</span><span id="__span-412-10"><a id="__codelineno-412-10" name="__codelineno-412-10" href="#__codelineno-412-10"></a><span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="w"> </span><span class="p">(</span><span class="n">Regex</span><span class="p">.</span><span class="n">Match</span><span class="w"> </span><span class="p">(</span><span class="n">text</span><span class="p">,</span><span class="w"> </span><span class="n">r</span><span class="p">).</span><span class="n">Index</span><span class="p">);</span><span class="w"> </span><span class="c1">// 12</span>
</span></code></pre></div>
<h3 id="parsing-an-xmlhtml-tag">Parsing an XML/HTML tag</h3>
<p>Regex is useful for parsing HTML fragmentsâ€”particularly when the document might be imperfectly formed:</p>
<div class="language-csharp highlight"><pre><span></span><code><span id="__span-413-1"><a id="__codelineno-413-1" name="__codelineno-413-1" href="#__codelineno-413-1"></a><span class="kt">string</span><span class="w"> </span><span class="n">r</span><span class="w"> </span><span class="o">=</span>
</span><span id="__span-413-2"><a id="__codelineno-413-2" name="__codelineno-413-2" href="#__codelineno-413-2"></a><span class="w"> </span><span class="s">@&quot;&lt;(?&#39;tag&#39;\w+?).*&gt;&quot;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="c1">// lazy-match first tag, and name it &#39;tag&#39;</span>
</span><span id="__span-413-3"><a id="__codelineno-413-3" name="__codelineno-413-3" href="#__codelineno-413-3"></a><span class="w"> </span><span class="s">@&quot;(?&#39;text&#39;.*?)&quot;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="c1">// lazy-match text content, name it &#39;textd&#39;</span>
</span><span id="__span-413-4"><a id="__codelineno-413-4" name="__codelineno-413-4" href="#__codelineno-413-4"></a><span class="w"> </span><span class="s">@&quot;&lt;/\k&#39;tag&#39;&gt;&quot;</span><span class="p">;</span><span class="w"> </span><span class="c1">// match last tag, denoted by &#39;tag&#39;</span>
</span><span id="__span-413-5"><a id="__codelineno-413-5" name="__codelineno-413-5" href="#__codelineno-413-5"></a><span class="kt">string</span><span class="w"> </span><span class="n">text</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;&lt;h1&gt;hello&lt;/h1&gt;&quot;</span><span class="p">;</span>
</span><span id="__span-413-6"><a id="__codelineno-413-6" name="__codelineno-413-6" href="#__codelineno-413-6"></a><span class="n">Match</span><span class="w"> </span><span class="n">m</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Regex</span><span class="p">.</span><span class="n">Match</span><span class="w"> </span><span class="p">(</span><span class="n">text</span><span class="p">,</span><span class="w"> </span><span class="n">r</span><span class="p">);</span>
</span><span id="__span-413-7"><a id="__codelineno-413-7" name="__codelineno-413-7" href="#__codelineno-413-7"></a><span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="w"> </span><span class="p">(</span><span class="n">m</span><span class="p">.</span><span class="n">Groups</span><span class="w"> </span><span class="p">[</span><span class="s">&quot;tag&quot;</span><span class="p">]);</span><span class="w"> </span><span class="c1">// h1</span>
</span><span id="__span-413-8"><a id="__codelineno-413-8" name="__codelineno-413-8" href="#__codelineno-413-8"></a><span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="w"> </span><span class="p">(</span><span class="n">m</span><span class="p">.</span><span class="n">Groups</span><span class="w"> </span><span class="p">[</span><span class="s">&quot;text&quot;</span><span class="p">]);</span><span class="w"> </span><span class="c1">// hello</span>
</span></code></pre></div>
<h3 id="splitting-a-camel-cased-word">Splitting a camel-cased word</h3>
<p>This requires a positive lookahead to include the uppercase separators</p>
<div class="language-csharp highlight"><pre><span></span><code><span id="__span-414-1"><a id="__codelineno-414-1" name="__codelineno-414-1" href="#__codelineno-414-1"></a><span class="kt">string</span><span class="w"> </span><span class="n">r</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">@&quot;(?=[A-Z])&quot;</span><span class="p">;</span>
</span><span id="__span-414-2"><a id="__codelineno-414-2" name="__codelineno-414-2" href="#__codelineno-414-2"></a><span class="k">foreach</span><span class="w"> </span><span class="p">(</span><span class="kt">string</span><span class="w"> </span><span class="n">s</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">Regex</span><span class="p">.</span><span class="n">Split</span><span class="w"> </span><span class="p">(</span><span class="s">&quot;oneTwoThree&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">r</span><span class="p">))</span>
</span><span id="__span-414-3"><a id="__codelineno-414-3" name="__codelineno-414-3" href="#__codelineno-414-3"></a><span class="n">Console</span><span class="p">.</span><span class="n">Write</span><span class="w"> </span><span class="p">(</span><span class="n">s</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s">&quot; &quot;</span><span class="p">);</span><span class="w"> </span><span class="c1">// one Two Three</span>
</span></code></pre></div>
<h3 id="obtaining-a-legal-filename">Obtaining a legal filename</h3>
<div class="language-csharp highlight"><pre><span></span><code><span id="__span-415-1"><a id="__codelineno-415-1" name="__codelineno-415-1" href="#__codelineno-415-1"></a><span class="kt">string</span><span class="w"> </span><span class="n">input</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;My \&quot;good\&quot; &lt;recipes&gt;.txt&quot;</span><span class="p">;</span>
</span><span id="__span-415-2"><a id="__codelineno-415-2" name="__codelineno-415-2" href="#__codelineno-415-2"></a><span class="kt">char</span><span class="p">[]</span><span class="w"> </span><span class="n">invalidChars</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">System</span><span class="p">.</span><span class="n">IO</span><span class="p">.</span><span class="n">Path</span><span class="p">.</span><span class="n">GetInvalidFileNameChars</span><span class="p">();</span>
</span><span id="__span-415-3"><a id="__codelineno-415-3" name="__codelineno-415-3" href="#__codelineno-415-3"></a><span class="kt">string</span><span class="w"> </span><span class="n">invalidString</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Regex</span><span class="p">.</span><span class="n">Escape</span><span class="w"> </span><span class="p">(</span><span class="k">new</span><span class="w"> </span><span class="kt">string</span><span class="w"> </span><span class="p">(</span><span class="n">invalidChars</span><span class="p">));</span>
</span><span id="__span-415-4"><a id="__codelineno-415-4" name="__codelineno-415-4" href="#__codelineno-415-4"></a><span class="kt">string</span><span class="w"> </span><span class="n">valid</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Regex</span><span class="p">.</span><span class="n">Replace</span><span class="w"> </span><span class="p">(</span><span class="n">input</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;[&quot;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">invalidString</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s">&quot;]&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;&quot;</span><span class="p">);</span>
</span><span id="__span-415-5"><a id="__codelineno-415-5" name="__codelineno-415-5" href="#__codelineno-415-5"></a><span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="w"> </span><span class="p">(</span><span class="n">valid</span><span class="p">);</span>
</span><span id="__span-415-6"><a id="__codelineno-415-6" name="__codelineno-415-6" href="#__codelineno-415-6"></a><span class="c1">//My good recipes.txt</span>
</span></code></pre></div>
<h3 id="parsing-google-search-terms-from-a-web-stats-log">Parsing Google search terms from a web stats log</h3>
<div class="language-csharp highlight"><pre><span></span><code><span id="__span-416-1"><a id="__codelineno-416-1" name="__codelineno-416-1" href="#__codelineno-416-1"></a><span class="kt">string</span><span class="w"> </span><span class="n">sample</span><span class="w"> </span><span class="o">=</span>
</span><span id="__span-416-2"><a id="__codelineno-416-2" name="__codelineno-416-2" href="#__codelineno-416-2"></a><span class="w"> </span><span class="s">&quot;http://google.com/search?hl=en&amp;q=greedy+quantifiers+regex&amp;btnG=Search&quot;</span><span class="p">;</span>
</span><span id="__span-416-3"><a id="__codelineno-416-3" name="__codelineno-416-3" href="#__codelineno-416-3"></a><span class="n">Match</span><span class="w"> </span><span class="n">m</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Regex</span><span class="p">.</span><span class="n">Match</span><span class="w"> </span><span class="p">(</span><span class="n">sample</span><span class="p">,</span><span class="w"> </span><span class="s">@&quot;(?&lt;=google\..+search\?.*q=).+?(?=(&amp;|$))&quot;</span><span class="p">);</span>
</span><span id="__span-416-4"><a id="__codelineno-416-4" name="__codelineno-416-4" href="#__codelineno-416-4"></a><span class="kt">string</span><span class="p">[]</span><span class="w"> </span><span class="n">keywords</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">m</span><span class="p">.</span><span class="n">Value</span><span class="p">.</span><span class="n">Split</span><span class="w"> </span><span class="p">(</span>
</span><span id="__span-416-5"><a id="__codelineno-416-5" name="__codelineno-416-5" href="#__codelineno-416-5"></a><span class="w"> </span><span class="k">new</span><span class="p">[]</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="sc">&#39;+&#39;</span><span class="w"> </span><span class="p">},</span><span class="w"> </span><span class="n">StringSplitOptions</span><span class="p">.</span><span class="n">RemoveEmptyEntries</span><span class="p">);</span>
</span><span id="__span-416-6"><a id="__codelineno-416-6" name="__codelineno-416-6" href="#__codelineno-416-6"></a><span class="k">foreach</span><span class="w"> </span><span class="p">(</span><span class="kt">string</span><span class="w"> </span><span class="n">keyword</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">keywords</span><span class="p">)</span>
</span><span id="__span-416-7"><a id="__codelineno-416-7" name="__codelineno-416-7" href="#__codelineno-416-7"></a><span class="w"> </span><span class="n">Console</span><span class="p">.</span><span class="n">Write</span><span class="w"> </span><span class="p">(</span><span class="n">keyword</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s">&quot; &quot;</span><span class="p">);</span><span class="w"> </span><span class="c1">// greedy quantifiers regex</span>
</span><span id="__span-416-8"><a id="__codelineno-416-8" name="__codelineno-416-8" href="#__codelineno-416-8"></a><span class="err">```#</span><span class="w"> </span><span class="n">Chapter</span><span class="w"> </span><span class="mi">3</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="n">Creating</span><span class="w"> </span><span class="n">Types</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">C</span><span class="err">#</span>
</span><span id="__span-416-9"><a id="__codelineno-416-9" name="__codelineno-416-9" href="#__codelineno-416-9"></a>
</span><span id="__span-416-10"><a id="__codelineno-416-10" name="__codelineno-416-10" href="#__codelineno-416-10"></a><span class="err">###</span><span class="w"> </span><span class="n">Declaring</span><span class="w"> </span><span class="n">multiple</span><span class="w"> </span><span class="n">fields</span><span class="w"> </span><span class="n">together</span>
</span><span id="__span-416-11"><a id="__codelineno-416-11" name="__codelineno-416-11" href="#__codelineno-416-11"></a>
</span><span id="__span-416-12"><a id="__codelineno-416-12" name="__codelineno-416-12" href="#__codelineno-416-12"></a><span class="n">For</span><span class="w"> </span><span class="n">convenience</span><span class="p">,</span><span class="w"> </span><span class="n">you</span><span class="w"> </span><span class="n">can</span><span class="w"> </span><span class="n">declare</span><span class="w"> </span><span class="n">multiple</span><span class="w"> </span><span class="n">fields</span><span class="w"> </span><span class="n">of</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">same</span><span class="w"> </span><span class="n">type</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">comma</span><span class="w"> </span><span class="n">separated</span><span class="w"> </span><span class="n">list</span><span class="p">.</span><span class="w"> </span><span class="n">This</span><span class="w"> </span><span class="k">is</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">convenient</span><span class="w"> </span><span class="n">way</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">all</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">fields</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">share</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">same</span><span class="w"> </span><span class="n">attributes</span><span class="w"> </span><span class="k">and</span><span class="w"> </span><span class="n">field</span><span class="w"> </span><span class="n">modifiers</span><span class="p">:</span>
</span><span id="__span-416-13"><a id="__codelineno-416-13" name="__codelineno-416-13" href="#__codelineno-416-13"></a>
</span><span id="__span-416-14"><a id="__codelineno-416-14" name="__codelineno-416-14" href="#__codelineno-416-14"></a><span class="err">```</span><span class="n">csharp</span>
</span><span id="__span-416-15"><a id="__codelineno-416-15" name="__codelineno-416-15" href="#__codelineno-416-15"></a><span class="k">static</span><span class="w"> </span><span class="k">readonly</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">legs</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">8</span><span class="p">,</span>
</span><span id="__span-416-16"><a id="__codelineno-416-16" name="__codelineno-416-16" href="#__codelineno-416-16"></a><span class="w"> </span><span class="n">eyes</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">2</span><span class="p">;</span>
</span></code></pre></div>
<h3 id="constants">Constants</h3>
<p>A constant is evaluated statically at compile time and the compiler literally substitutes its value whenever used (rather like a macro in C++). A constant can be any of the built-in numeric types, bool, char, string, or an enum type.</p>
<div class="language-csharp highlight"><pre><span></span><code><span id="__span-417-1"><a id="__codelineno-417-1" name="__codelineno-417-1" href="#__codelineno-417-1"></a><span class="k">public</span><span class="w"> </span><span class="k">class</span><span class="w"> </span><span class="nc">Test</span>
</span><span id="__span-417-2"><a id="__codelineno-417-2" name="__codelineno-417-2" href="#__codelineno-417-2"></a><span class="p">{</span>
</span><span id="__span-417-3"><a id="__codelineno-417-3" name="__codelineno-417-3" href="#__codelineno-417-3"></a><span class="w"> </span><span class="k">public</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="kt">string</span><span class="w"> </span><span class="n">Message</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;Hello World&quot;</span><span class="p">;</span>
</span><span id="__span-417-4"><a id="__codelineno-417-4" name="__codelineno-417-4" href="#__codelineno-417-4"></a><span class="p">}</span>
</span></code></pre></div>
<p>A constant can serve a similar role to a static readonly field, but it is much more restrictiveâ€”both in the types you can use and in field initialization semantics. A constant also differs from a static readonly field in that the evaluation of the constant occurs at compile time; thus:</p>
<div class="language-csharp highlight"><pre><span></span><code><span id="__span-418-1"><a id="__codelineno-418-1" name="__codelineno-418-1" href="#__codelineno-418-1"></a><span class="k">public</span><span class="w"> </span><span class="k">static</span><span class="w"> </span><span class="kt">double</span><span class="w"> </span><span class="nf">Circumference</span><span class="w"> </span><span class="p">(</span><span class="kt">double</span><span class="w"> </span><span class="n">radius</span><span class="p">)</span>
</span><span id="__span-418-2"><a id="__codelineno-418-2" name="__codelineno-418-2" href="#__codelineno-418-2"></a><span class="p">{</span>
</span><span id="__span-418-3"><a id="__codelineno-418-3" name="__codelineno-418-3" href="#__codelineno-418-3"></a><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="mi">2</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">System</span><span class="p">.</span><span class="n">Math</span><span class="p">.</span><span class="n">PI</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">radius</span><span class="p">;</span>
</span><span id="__span-418-4"><a id="__codelineno-418-4" name="__codelineno-418-4" href="#__codelineno-418-4"></a><span class="p">}</span>
</span><span id="__span-418-5"><a id="__codelineno-418-5" name="__codelineno-418-5" href="#__codelineno-418-5"></a><span class="c1">//is compiled to</span>
</span><span id="__span-418-6"><a id="__codelineno-418-6" name="__codelineno-418-6" href="#__codelineno-418-6"></a><span class="k">public</span><span class="w"> </span><span class="k">static</span><span class="w"> </span><span class="kt">double</span><span class="w"> </span><span class="nf">Circumference</span><span class="w"> </span><span class="p">(</span><span class="kt">double</span><span class="w"> </span><span class="n">radius</span><span class="p">)</span>
</span><span id="__span-418-7"><a id="__codelineno-418-7" name="__codelineno-418-7" href="#__codelineno-418-7"></a><span class="p">{</span>
</span><span id="__span-418-8"><a id="__codelineno-418-8" name="__codelineno-418-8" href="#__codelineno-418-8"></a><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="mf">6.2831853071795862</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">radius</span><span class="p">;</span>
</span><span id="__span-418-9"><a id="__codelineno-418-9" name="__codelineno-418-9" href="#__codelineno-418-9"></a><span class="p">}</span>
</span></code></pre></div>
<h3 id="expression-bodied-methods">Expression-bodied methods</h3>
<p>A method that comprises a single expression</p>
<div class="language-csharp highlight"><pre><span></span><code><span id="__span-419-1"><a id="__codelineno-419-1" name="__codelineno-419-1" href="#__codelineno-419-1"></a><span class="kt">int</span><span class="w"> </span><span class="nf">Foo</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">x</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mi">2</span><span class="p">;</span><span class="w"> </span><span class="p">}</span>
</span><span id="__span-419-2"><a id="__codelineno-419-2" name="__codelineno-419-2" href="#__codelineno-419-2"></a><span class="kt">int</span><span class="w"> </span><span class="nf">Foo</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">x</span><span class="p">)</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mi">2</span><span class="p">;</span>
</span><span id="__span-419-3"><a id="__codelineno-419-3" name="__codelineno-419-3" href="#__codelineno-419-3"></a><span class="k">void</span><span class="w"> </span><span class="nf">Foo</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">x</span><span class="p">)</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="w"> </span><span class="p">(</span><span class="n">x</span><span class="p">);</span>
</span></code></pre></div>
<h3 id="local-methods_1">Local methods</h3>
<p>method within another method</p>
<div class="language-csharp highlight"><pre><span></span><code><span id="__span-420-1"><a id="__codelineno-420-1" name="__codelineno-420-1" href="#__codelineno-420-1"></a><span class="k">void</span><span class="w"> </span><span class="nf">WriteCubes</span><span class="p">()</span>
</span><span id="__span-420-2"><a id="__codelineno-420-2" name="__codelineno-420-2" href="#__codelineno-420-2"></a><span class="p">{</span>
</span><span id="__span-420-3"><a id="__codelineno-420-3" name="__codelineno-420-3" href="#__codelineno-420-3"></a><span class="w"> </span><span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="w"> </span><span class="p">(</span><span class="n">Cube</span><span class="w"> </span><span class="p">(</span><span class="mi">3</span><span class="p">));</span>
</span><span id="__span-420-4"><a id="__codelineno-420-4" name="__codelineno-420-4" href="#__codelineno-420-4"></a><span class="w"> </span><span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="w"> </span><span class="p">(</span><span class="n">Cube</span><span class="w"> </span><span class="p">(</span><span class="mi">4</span><span class="p">));</span>
</span><span id="__span-420-5"><a id="__codelineno-420-5" name="__codelineno-420-5" href="#__codelineno-420-5"></a><span class="w"> </span><span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="w"> </span><span class="p">(</span><span class="n">Cube</span><span class="w"> </span><span class="p">(</span><span class="mi">5</span><span class="p">));</span>
</span><span id="__span-420-6"><a id="__codelineno-420-6" name="__codelineno-420-6" href="#__codelineno-420-6"></a><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="nf">Cube</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="k">value</span><span class="p">)</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="k">value</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">value</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">value</span><span class="p">;</span>
</span><span id="__span-420-7"><a id="__codelineno-420-7" name="__codelineno-420-7" href="#__codelineno-420-7"></a><span class="p">}</span>
</span></code></pre></div>
<p>The local method (Cube, in this case) is visible only to the enclosing method (WriteCubes). This simplifies the containing type and instantly signals to anyone looking at the code that Cube is used nowhere else. Another benefit of local methods is that they can access the local variables and parameters of the enclosing method.</p>
<p><strong>Local methods can appear within other function kinds, such as property accessors, constructors, and so on. You can even put local methods inside other local methods, and inside lambda expressions that use a statement block</strong></p>
<h3 id="static-local-methods_1">Static local methods</h3>
<p>Adding the static modifier to a local method prevents it from seeing the local variâ€
ables and parameters of the enclosing method. This helps to reduce coupling as well
as enabling the local method to declare variables as it pleases, without risk of collidâ€
ing with those in the containing method.</p>
<h1 id="classes">Classes</h1>
<h3 id="properties">Properties</h3>
<p>Properties look like fields from the outside, but internally they contain logic, like methods do.</p>
<p>A property is declared like a field but with a get/set block added.</p>
<div class="language-csharp highlight"><pre><span></span><code><span id="__span-421-1"><a id="__codelineno-421-1" name="__codelineno-421-1" href="#__codelineno-421-1"></a><span class="k">public</span><span class="w"> </span><span class="k">class</span><span class="w"> </span><span class="nc">Stock</span>
</span><span id="__span-421-2"><a id="__codelineno-421-2" name="__codelineno-421-2" href="#__codelineno-421-2"></a><span class="p">{</span>
</span><span id="__span-421-3"><a id="__codelineno-421-3" name="__codelineno-421-3" href="#__codelineno-421-3"></a><span class="w"> </span><span class="kt">decimal</span><span class="w"> </span><span class="n">currentPrice</span><span class="p">;</span><span class="w"> </span><span class="c1">// The private &quot;backing&quot; field</span>
</span><span id="__span-421-4"><a id="__codelineno-421-4" name="__codelineno-421-4" href="#__codelineno-421-4"></a><span class="w"> </span><span class="k">public</span><span class="w"> </span><span class="kt">decimal</span><span class="w"> </span><span class="n">CurrentPrice</span><span class="w"> </span><span class="c1">// The public property</span>
</span><span id="__span-421-5"><a id="__codelineno-421-5" name="__codelineno-421-5" href="#__codelineno-421-5"></a><span class="w"> </span><span class="p">{</span>
</span><span id="__span-421-6"><a id="__codelineno-421-6" name="__codelineno-421-6" href="#__codelineno-421-6"></a><span class="w"> </span><span class="k">get</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="n">currentPrice</span><span class="p">;</span><span class="w"> </span><span class="p">}</span>
</span><span id="__span-421-7"><a id="__codelineno-421-7" name="__codelineno-421-7" href="#__codelineno-421-7"></a><span class="w"> </span><span class="k">set</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">currentPrice</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">value</span><span class="p">;</span><span class="w"> </span><span class="p">}</span>
</span><span id="__span-421-8"><a id="__codelineno-421-8" name="__codelineno-421-8" href="#__codelineno-421-8"></a><span class="w"> </span><span class="p">}</span>
</span><span id="__span-421-9"><a id="__codelineno-421-9" name="__codelineno-421-9" href="#__codelineno-421-9"></a><span class="p">}</span>
</span></code></pre></div>
<h3 id="automatic-properties">Automatic properties</h3>
<p>The most common implementation for a property is a getter and/or setter that simply reads and writes to a private field of the same type as the property. An automatic property declaration instructs the compiler to provide this implementation.</p>
<div class="language-csharp highlight"><pre><span></span><code><span id="__span-422-1"><a id="__codelineno-422-1" name="__codelineno-422-1" href="#__codelineno-422-1"></a><span class="k">public</span><span class="w"> </span><span class="k">class</span><span class="w"> </span><span class="nc">Stock</span>
</span><span id="__span-422-2"><a id="__codelineno-422-2" name="__codelineno-422-2" href="#__codelineno-422-2"></a><span class="p">{</span>
</span><span id="__span-422-3"><a id="__codelineno-422-3" name="__codelineno-422-3" href="#__codelineno-422-3"></a><span class="w"> </span><span class="p">...</span>
</span><span id="__span-422-4"><a id="__codelineno-422-4" name="__codelineno-422-4" href="#__codelineno-422-4"></a><span class="w"> </span><span class="k">public</span><span class="w"> </span><span class="kt">decimal</span><span class="w"> </span><span class="n">CurrentPrice</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">get</span><span class="p">;</span><span class="w"> </span><span class="k">set</span><span class="p">;</span><span class="w"> </span><span class="p">}</span>
</span><span id="__span-422-5"><a id="__codelineno-422-5" name="__codelineno-422-5" href="#__codelineno-422-5"></a><span class="p">}</span>
</span></code></pre></div>
<h3 id="property-initializers">Property initializers</h3>
<p>You can add a property initializer to automatic properties, just as with fields:</p>
<p>Properties with an initializer can be read-only:</p>
<div class="language-csharp highlight"><pre><span></span><code><span id="__span-423-1"><a id="__codelineno-423-1" name="__codelineno-423-1" href="#__codelineno-423-1"></a><span class="k">public</span><span class="w"> </span><span class="kt">decimal</span><span class="w"> </span><span class="n">CurrentPrice</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">get</span><span class="p">;</span><span class="w"> </span><span class="k">set</span><span class="p">;</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">123</span><span class="p">;</span>
</span><span id="__span-423-2"><a id="__codelineno-423-2" name="__codelineno-423-2" href="#__codelineno-423-2"></a><span class="k">public</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">Maximum</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">get</span><span class="p">;</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">999</span><span class="p">;</span>
</span></code></pre></div>
<h3 id="static-constructors">Static Constructors</h3>
<p>A static constructor executes once per type rather than once per instance. A type can
define only one static constructor, and it must be parameterless and have the same
name as the type</p>
<div class="language-csharp highlight"><pre><span></span><code><span id="__span-424-1"><a id="__codelineno-424-1" name="__codelineno-424-1" href="#__codelineno-424-1"></a><span class="k">class</span><span class="w"> </span><span class="nc">Test</span>
</span><span id="__span-424-2"><a id="__codelineno-424-2" name="__codelineno-424-2" href="#__codelineno-424-2"></a><span class="p">{</span>
</span><span id="__span-424-3"><a id="__codelineno-424-3" name="__codelineno-424-3" href="#__codelineno-424-3"></a><span class="w"> </span><span class="k">static</span><span class="w"> </span><span class="nf">Test</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="w"> </span><span class="p">(</span><span class="s">&quot;Type Initialized&quot;</span><span class="p">);</span><span class="w"> </span><span class="p">}</span>
</span><span id="__span-424-4"><a id="__codelineno-424-4" name="__codelineno-424-4" href="#__codelineno-424-4"></a><span class="p">}</span>
</span></code></pre></div>
<p>The runtime automatically invokes a static constructor just prior to the type being
used. Two things trigger this.</p>
<ul>
<li>Instantiating the type</li>
<li>Accessing a static member in the type</li>
</ul>
<h3 id="static-constructors-and-field-initialization-order">Static constructors and field initialization order</h3>
<p>Static field initializers run just before the static constructor is called. If a type has no static constructor, static field initializers will execute just prior to the type being used or anytime earlier at the whim of the runtime</p>
<p>Static field initializers run in the order in which the fields are declared. The following example illustrates this: X is initialized to 0 and Y is initialized to 3.</p>
<div class="language-csharp highlight"><pre><span></span><code><span id="__span-425-1"><a id="__codelineno-425-1" name="__codelineno-425-1" href="#__codelineno-425-1"></a><span class="k">class</span><span class="w"> </span><span class="nc">Foo</span>
</span><span id="__span-425-2"><a id="__codelineno-425-2" name="__codelineno-425-2" href="#__codelineno-425-2"></a><span class="p">{</span>
</span><span id="__span-425-3"><a id="__codelineno-425-3" name="__codelineno-425-3" href="#__codelineno-425-3"></a><span class="w"> </span><span class="k">public</span><span class="w"> </span><span class="k">static</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">X</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Y</span><span class="p">;</span><span class="w"> </span><span class="c1">// 0</span>
</span><span id="__span-425-4"><a id="__codelineno-425-4" name="__codelineno-425-4" href="#__codelineno-425-4"></a><span class="w"> </span><span class="k">public</span><span class="w"> </span><span class="k">static</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">Y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">3</span><span class="p">;</span><span class="w"> </span><span class="c1">// 3</span>
</span><span id="__span-425-5"><a id="__codelineno-425-5" name="__codelineno-425-5" href="#__codelineno-425-5"></a><span class="p">}</span>
</span></code></pre></div>
<h3 id="static-classes">Static Classes</h3>
<p>A class can be marked static, indicating that it must be composed solely of static members and cannot be subclassed. The <code>System.Console</code> and <code>System.Math</code> classes are good examples of static classes</p>
<h3 id="finalizers_1">Finalizers</h3>
<p>Finalizers are class-only methods that execute before the garbage collector reclaims the memory for an unreferenced object. The syntax for a finalizer is the name of the class prefixed with the <code>~</code> symbol:</p>
<div class="language-csharp highlight"><pre><span></span><code><span id="__span-426-1"><a id="__codelineno-426-1" name="__codelineno-426-1" href="#__codelineno-426-1"></a><span class="k">class</span><span class="w"> </span><span class="nc">Class1</span>
</span><span id="__span-426-2"><a id="__codelineno-426-2" name="__codelineno-426-2" href="#__codelineno-426-2"></a><span class="p">{</span>
</span><span id="__span-426-3"><a id="__codelineno-426-3" name="__codelineno-426-3" href="#__codelineno-426-3"></a><span class="w"> </span><span class="o">~</span><span class="n">Class1</span><span class="p">()</span>
</span><span id="__span-426-4"><a id="__codelineno-426-4" name="__codelineno-426-4" href="#__codelineno-426-4"></a><span class="w"> </span><span class="p">{</span>
</span><span id="__span-426-5"><a id="__codelineno-426-5" name="__codelineno-426-5" href="#__codelineno-426-5"></a><span class="w"> </span><span class="p">...</span>
</span><span id="__span-426-6"><a id="__codelineno-426-6" name="__codelineno-426-6" href="#__codelineno-426-6"></a><span class="w"> </span><span class="p">}</span>
</span><span id="__span-426-7"><a id="__codelineno-426-7" name="__codelineno-426-7" href="#__codelineno-426-7"></a><span class="p">}</span>
</span></code></pre></div>
<p>You can write single-statement finalizers using expression-bodied syntax</p>
<div class="language-csharp highlight"><pre><span></span><code><span id="__span-427-1"><a id="__codelineno-427-1" name="__codelineno-427-1" href="#__codelineno-427-1"></a><span class="o">~</span><span class="n">Class1</span><span class="p">()</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="w"> </span><span class="p">(</span><span class="s">&quot;Finalizing&quot;</span><span class="p">);</span>
</span></code></pre></div>
<h3 id="partial-types-and-methods">Partial Types and Methods</h3>
<p>Partial types allow a type definition to be splitâ€”typically across multiple files. A
common scenario is for a partial class to be autogenerated from some other source
(such as a Visual Studio template or designer), and for that class to be augmented
with additional hand-authored methods:</p>
<div class="language-csharp highlight"><pre><span></span><code><span id="__span-428-1"><a id="__codelineno-428-1" name="__codelineno-428-1" href="#__codelineno-428-1"></a><span class="c1">// PaymentFormGen.cs - auto-generated</span>
</span><span id="__span-428-2"><a id="__codelineno-428-2" name="__codelineno-428-2" href="#__codelineno-428-2"></a><span class="k">partial</span><span class="w"> </span><span class="k">class</span><span class="w"> </span><span class="nc">PaymentForm</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="p">...</span><span class="w"> </span><span class="p">}</span>
</span><span id="__span-428-3"><a id="__codelineno-428-3" name="__codelineno-428-3" href="#__codelineno-428-3"></a><span class="c1">// PaymentForm.cs - hand-authored</span>
</span><span id="__span-428-4"><a id="__codelineno-428-4" name="__codelineno-428-4" href="#__codelineno-428-4"></a><span class="k">partial</span><span class="w"> </span><span class="k">class</span><span class="w"> </span><span class="nc">PaymentForm</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="p">...</span><span class="w"> </span><span class="p">}</span>
</span></code></pre></div>
<p>Each participant must have the partial declaration</p>
<h3 id="partial-methods">Partial methods</h3>
<p>A partial type can contain partial methods. These let an autogenerated partial type provide customizable hooks for manual authoring;</p>
<div class="language-csharp highlight"><pre><span></span><code><span id="__span-429-1"><a id="__codelineno-429-1" name="__codelineno-429-1" href="#__codelineno-429-1"></a><span class="k">partial</span><span class="w"> </span><span class="k">class</span><span class="w"> </span><span class="nc">PaymentForm</span><span class="w"> </span><span class="c1">// In auto-generated file</span>
</span><span id="__span-429-2"><a id="__codelineno-429-2" name="__codelineno-429-2" href="#__codelineno-429-2"></a><span class="p">{</span>
</span><span id="__span-429-3"><a id="__codelineno-429-3" name="__codelineno-429-3" href="#__codelineno-429-3"></a><span class="w"> </span><span class="p">...</span>
</span><span id="__span-429-4"><a id="__codelineno-429-4" name="__codelineno-429-4" href="#__codelineno-429-4"></a><span class="w"> </span><span class="k">partial</span><span class="w"> </span><span class="k">void</span><span class="w"> </span><span class="nf">ValidatePayment</span><span class="w"> </span><span class="p">(</span><span class="kt">decimal</span><span class="w"> </span><span class="n">amount</span><span class="p">);</span>
</span><span id="__span-429-5"><a id="__codelineno-429-5" name="__codelineno-429-5" href="#__codelineno-429-5"></a><span class="p">}</span>
</span><span id="__span-429-6"><a id="__codelineno-429-6" name="__codelineno-429-6" href="#__codelineno-429-6"></a><span class="k">partial</span><span class="w"> </span><span class="k">class</span><span class="w"> </span><span class="nc">PaymentForm</span><span class="w"> </span><span class="c1">// In hand-authored file</span>
</span><span id="__span-429-7"><a id="__codelineno-429-7" name="__codelineno-429-7" href="#__codelineno-429-7"></a><span class="p">{</span>
</span><span id="__span-429-8"><a id="__codelineno-429-8" name="__codelineno-429-8" href="#__codelineno-429-8"></a><span class="w"> </span><span class="p">...</span>
</span><span id="__span-429-9"><a id="__codelineno-429-9" name="__codelineno-429-9" href="#__codelineno-429-9"></a><span class="w"> </span><span class="k">partial</span><span class="w"> </span><span class="k">void</span><span class="w"> </span><span class="nf">ValidatePayment</span><span class="w"> </span><span class="p">(</span><span class="kt">decimal</span><span class="w"> </span><span class="n">amount</span><span class="p">)</span>
</span><span id="__span-429-10"><a id="__codelineno-429-10" name="__codelineno-429-10" href="#__codelineno-429-10"></a><span class="w"> </span><span class="p">{</span>
</span><span id="__span-429-11"><a id="__codelineno-429-11" name="__codelineno-429-11" href="#__codelineno-429-11"></a><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">amount</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">100</span><span class="p">)</span>
</span><span id="__span-429-12"><a id="__codelineno-429-12" name="__codelineno-429-12" href="#__codelineno-429-12"></a><span class="w"> </span><span class="p">...</span>
</span><span id="__span-429-13"><a id="__codelineno-429-13" name="__codelineno-429-13" href="#__codelineno-429-13"></a><span class="w"> </span><span class="p">}</span>
</span><span id="__span-429-14"><a id="__codelineno-429-14" name="__codelineno-429-14" href="#__codelineno-429-14"></a><span class="p">}</span>
</span></code></pre></div>
<p>A partial method consists of two parts: a definition and an implementation. The definition is typically written by a code generator, and the implementation is typically manually authored. If an implementation is not provided, the definition of the partial method is compiled away (as is the code that calls it). This allows autogenerated code to be liberal in providing hooks without having to worry about bloat. Partial methods must be void and are implicitly private</p>
<h3 id="the-nameof-operator">The nameof operator</h3>
<p>The nameof operator returns the name of any symbol (type, member, variable, and
so on) as a string:</p>
<div class="language-csharp highlight"><pre><span></span><code><span id="__span-430-1"><a id="__codelineno-430-1" name="__codelineno-430-1" href="#__codelineno-430-1"></a><span class="kt">int</span><span class="w"> </span><span class="n">count</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">123</span><span class="p">;</span>
</span><span id="__span-430-2"><a id="__codelineno-430-2" name="__codelineno-430-2" href="#__codelineno-430-2"></a><span class="kt">string</span><span class="w"> </span><span class="n">name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">nameof</span><span class="w"> </span><span class="p">(</span><span class="n">count</span><span class="p">);</span><span class="w"> </span><span class="c1">// name is &quot;count&quot;</span>
</span><span id="__span-430-3"><a id="__codelineno-430-3" name="__codelineno-430-3" href="#__codelineno-430-3"></a><span class="kt">string</span><span class="w"> </span><span class="n">name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">nameof</span><span class="w"> </span><span class="p">(</span><span class="n">StringBuilder</span><span class="p">.</span><span class="n">Length</span><span class="p">);</span><span class="c1">//&quot;Length&quot;</span>
</span><span id="__span-430-4"><a id="__codelineno-430-4" name="__codelineno-430-4" href="#__codelineno-430-4"></a><span class="k">nameof</span><span class="w"> </span><span class="p">(</span><span class="n">StringBuilder</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s">&quot;.&quot;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="k">nameof</span><span class="w"> </span><span class="p">(</span><span class="n">StringBuilder</span><span class="p">.</span><span class="n">Length</span><span class="p">);</span><span class="c1">//StringBuilder.Length</span>
</span></code></pre></div>
<h1 id="inheritance">Inheritance</h1>
<p>A class can inherit from another class to extend or customize the original class. Inheriting from a class lets you reuse the functionality in that class instead of building it from scratch. A class can inherit from only a single class, but can itself be inherited by many classes, thus forming a class hierarchy.</p>
<div class="language-csharp highlight"><pre><span></span><code><span id="__span-431-1"><a id="__codelineno-431-1" name="__codelineno-431-1" href="#__codelineno-431-1"></a><span class="k">public</span><span class="w"> </span><span class="k">class</span><span class="w"> </span><span class="nc">Asset</span>
</span><span id="__span-431-2"><a id="__codelineno-431-2" name="__codelineno-431-2" href="#__codelineno-431-2"></a><span class="p">{</span>
</span><span id="__span-431-3"><a id="__codelineno-431-3" name="__codelineno-431-3" href="#__codelineno-431-3"></a><span class="w"> </span><span class="k">public</span><span class="w"> </span><span class="kt">string</span><span class="w"> </span><span class="n">Name</span><span class="p">;</span>
</span><span id="__span-431-4"><a id="__codelineno-431-4" name="__codelineno-431-4" href="#__codelineno-431-4"></a><span class="p">}</span>
</span><span id="__span-431-5"><a id="__codelineno-431-5" name="__codelineno-431-5" href="#__codelineno-431-5"></a><span class="k">public</span><span class="w"> </span><span class="k">class</span><span class="w"> </span><span class="nc">Stock</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="n">Asset</span><span class="w"> </span><span class="c1">// inherits from Asset</span>
</span><span id="__span-431-6"><a id="__codelineno-431-6" name="__codelineno-431-6" href="#__codelineno-431-6"></a><span class="p">{</span>
</span><span id="__span-431-7"><a id="__codelineno-431-7" name="__codelineno-431-7" href="#__codelineno-431-7"></a><span class="w"> </span><span class="k">public</span><span class="w"> </span><span class="kt">long</span><span class="w"> </span><span class="n">SharesOwned</span><span class="p">;</span>
</span><span id="__span-431-8"><a id="__codelineno-431-8" name="__codelineno-431-8" href="#__codelineno-431-8"></a><span class="p">}</span>
</span><span id="__span-431-9"><a id="__codelineno-431-9" name="__codelineno-431-9" href="#__codelineno-431-9"></a><span class="k">public</span><span class="w"> </span><span class="k">class</span><span class="w"> </span><span class="nc">House</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="n">Asset</span><span class="w"> </span><span class="c1">// inherits from Asset</span>
</span><span id="__span-431-10"><a id="__codelineno-431-10" name="__codelineno-431-10" href="#__codelineno-431-10"></a><span class="p">{</span>
</span><span id="__span-431-11"><a id="__codelineno-431-11" name="__codelineno-431-11" href="#__codelineno-431-11"></a><span class="w"> </span><span class="k">public</span><span class="w"> </span><span class="kt">decimal</span><span class="w"> </span><span class="n">Mortgage</span><span class="p">;</span>
</span><span id="__span-431-12"><a id="__codelineno-431-12" name="__codelineno-431-12" href="#__codelineno-431-12"></a><span class="p">}</span>
</span><span id="__span-431-13"><a id="__codelineno-431-13" name="__codelineno-431-13" href="#__codelineno-431-13"></a><span class="n">Stock</span><span class="w"> </span><span class="n">msft</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">Stock</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">Name</span><span class="o">=</span><span class="s">&quot;MSFT&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">SharesOwned</span><span class="o">=</span><span class="mi">1000</span><span class="w"> </span><span class="p">};</span>
</span><span id="__span-431-14"><a id="__codelineno-431-14" name="__codelineno-431-14" href="#__codelineno-431-14"></a><span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="w"> </span><span class="p">(</span><span class="n">msft</span><span class="p">.</span><span class="n">Name</span><span class="p">);</span><span class="w"> </span><span class="c1">// MSFT</span>
</span><span id="__span-431-15"><a id="__codelineno-431-15" name="__codelineno-431-15" href="#__codelineno-431-15"></a><span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="w"> </span><span class="p">(</span><span class="n">msft</span><span class="p">.</span><span class="n">SharesOwned</span><span class="p">);</span><span class="w"> </span><span class="c1">// 1000</span>
</span><span id="__span-431-16"><a id="__codelineno-431-16" name="__codelineno-431-16" href="#__codelineno-431-16"></a>
</span><span id="__span-431-17"><a id="__codelineno-431-17" name="__codelineno-431-17" href="#__codelineno-431-17"></a><span class="n">House</span><span class="w"> </span><span class="n">mansion</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">House</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">Name</span><span class="o">=</span><span class="s">&quot;Mansion&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">Mortgage</span><span class="o">=</span><span class="mi">250000</span><span class="w"> </span><span class="p">};</span>
</span><span id="__span-431-18"><a id="__codelineno-431-18" name="__codelineno-431-18" href="#__codelineno-431-18"></a><span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="w"> </span><span class="p">(</span><span class="n">mansion</span><span class="p">.</span><span class="n">Name</span><span class="p">);</span><span class="w"> </span><span class="c1">// Mansion</span>
</span><span id="__span-431-19"><a id="__codelineno-431-19" name="__codelineno-431-19" href="#__codelineno-431-19"></a><span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="w"> </span><span class="p">(</span><span class="n">mansion</span><span class="p">.</span><span class="n">Mortgage</span><span class="p">);</span><span class="w"> </span><span class="c1">// 250000</span>
</span></code></pre></div>
<p>The <strong>derived classes, Stock and House</strong>, inherit the Name property from the <strong>base class, Asset</strong>.</p>
<ul>
<li>A derived class is also called a subclass.</li>
<li>A base class is also called a superclass.</li>
</ul>
<h3 id="polymorphism"><strong>Polymorphism</strong></h3>
<p>References are polymorphic. This means a variable of type x can refer to an object
that subclasses x.</p>
<div class="language-csharp highlight"><pre><span></span><code><span id="__span-432-1"><a id="__codelineno-432-1" name="__codelineno-432-1" href="#__codelineno-432-1"></a><span class="k">public</span><span class="w"> </span><span class="k">static</span><span class="w"> </span><span class="k">void</span><span class="w"> </span><span class="nf">Display</span><span class="w"> </span><span class="p">(</span><span class="n">Asset</span><span class="w"> </span><span class="n">asset</span><span class="p">)</span>
</span><span id="__span-432-2"><a id="__codelineno-432-2" name="__codelineno-432-2" href="#__codelineno-432-2"></a><span class="p">{</span>
</span><span id="__span-432-3"><a id="__codelineno-432-3" name="__codelineno-432-3" href="#__codelineno-432-3"></a><span class="w"> </span><span class="n">System</span><span class="p">.</span><span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="w"> </span><span class="p">(</span><span class="n">asset</span><span class="p">.</span><span class="n">Name</span><span class="p">);</span>
</span><span id="__span-432-4"><a id="__codelineno-432-4" name="__codelineno-432-4" href="#__codelineno-432-4"></a><span class="p">}</span>
</span><span id="__span-432-5"><a id="__codelineno-432-5" name="__codelineno-432-5" href="#__codelineno-432-5"></a><span class="c1">//This method can display both a Stock and a House, since they are both Assets</span>
</span><span id="__span-432-6"><a id="__codelineno-432-6" name="__codelineno-432-6" href="#__codelineno-432-6"></a><span class="o">**</span><span class="n">Stock</span><span class="o">**</span><span class="w"> </span><span class="n">msft</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">Stock</span><span class="w"> </span><span class="p">...</span><span class="w"> </span><span class="p">;</span>
</span><span id="__span-432-7"><a id="__codelineno-432-7" name="__codelineno-432-7" href="#__codelineno-432-7"></a><span class="n">House</span><span class="w"> </span><span class="n">mansion</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">House</span><span class="w"> </span><span class="p">...</span><span class="w"> </span><span class="p">;</span>
</span><span id="__span-432-8"><a id="__codelineno-432-8" name="__codelineno-432-8" href="#__codelineno-432-8"></a><span class="n">Display</span><span class="w"> </span><span class="p">(</span><span class="n">msft</span><span class="p">);</span>
</span><span id="__span-432-9"><a id="__codelineno-432-9" name="__codelineno-432-9" href="#__codelineno-432-9"></a><span class="n">Display</span><span class="w"> </span><span class="p">(</span><span class="n">mansion</span><span class="p">);</span>
</span></code></pre></div>
<p>Polymorphism works on the basis that subclasses (Stock and House) have all the
features of their base class (Asset).</p>
<p>The converse, however, is not true. If Display
was modified to accept a House, you could not pass in an Asset</p>
<h3 id="casting-and-reference-conversions">Casting and Reference Conversions</h3>
<p>An object reference can be</p>
<ul>
<li>Implicitly upcast to a base class reference</li>
<li>Explicitly downcast to a subclass reference</li>
</ul>
<p>Upcasting and downcasting between compatible reference types performs reference conversions: a new reference is (logically) created that points to the same object. An upcast always succeeds; a downcast succeeds only if the object is suitably typed.</p>
<p><strong>Upcasting</strong></p>
<p>An upcast operation creates a base class reference from a subclass reference.</p>
<div class="language-csharp highlight"><pre><span></span><code><span id="__span-433-1"><a id="__codelineno-433-1" name="__codelineno-433-1" href="#__codelineno-433-1"></a><span class="n">Stock</span><span class="w"> </span><span class="n">msft</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">Stock</span><span class="p">();</span>
</span><span id="__span-433-2"><a id="__codelineno-433-2" name="__codelineno-433-2" href="#__codelineno-433-2"></a><span class="n">Asset</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">msft</span><span class="p">;</span><span class="w"> </span><span class="c1">// Upcast</span>
</span><span id="__span-433-3"><a id="__codelineno-433-3" name="__codelineno-433-3" href="#__codelineno-433-3"></a>
</span><span id="__span-433-4"><a id="__codelineno-433-4" name="__codelineno-433-4" href="#__codelineno-433-4"></a><span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="w"> </span><span class="p">(</span><span class="n">a</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">msft</span><span class="p">);</span><span class="w"> </span><span class="c1">// True</span>
</span><span id="__span-433-5"><a id="__codelineno-433-5" name="__codelineno-433-5" href="#__codelineno-433-5"></a>
</span><span id="__span-433-6"><a id="__codelineno-433-6" name="__codelineno-433-6" href="#__codelineno-433-6"></a><span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="w"> </span><span class="p">(</span><span class="n">a</span><span class="p">.</span><span class="n">Name</span><span class="p">);</span><span class="w"> </span><span class="c1">// OK</span>
</span><span id="__span-433-7"><a id="__codelineno-433-7" name="__codelineno-433-7" href="#__codelineno-433-7"></a><span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="w"> </span><span class="p">(</span><span class="n">a</span><span class="p">.</span><span class="n">SharesOwned</span><span class="p">);</span><span class="w"> </span><span class="c1">// Error: SharesOwned undefined</span>
</span></code></pre></div>
<p><strong>Downcasting</strong></p>
<p>A downcast operation creates a subclass reference from a base class reference.</p>
<div class="language-csharp highlight"><pre><span></span><code><span id="__span-434-1"><a id="__codelineno-434-1" name="__codelineno-434-1" href="#__codelineno-434-1"></a><span class="n">Stock</span><span class="w"> </span><span class="n">msft</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">Stock</span><span class="p">();</span>
</span><span id="__span-434-2"><a id="__codelineno-434-2" name="__codelineno-434-2" href="#__codelineno-434-2"></a><span class="n">Asset</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">msft</span><span class="p">;</span><span class="w"> </span><span class="c1">// Upcast</span>
</span><span id="__span-434-3"><a id="__codelineno-434-3" name="__codelineno-434-3" href="#__codelineno-434-3"></a><span class="n">Stock</span><span class="w"> </span><span class="n">s</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">Stock</span><span class="p">)</span><span class="n">a</span><span class="p">;</span><span class="w"> </span><span class="c1">// Downcast</span>
</span><span id="__span-434-4"><a id="__codelineno-434-4" name="__codelineno-434-4" href="#__codelineno-434-4"></a><span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="w"> </span><span class="p">(</span><span class="n">s</span><span class="p">.</span><span class="n">SharesOwned</span><span class="p">);</span><span class="w"> </span><span class="c1">// &lt;No error&gt;</span>
</span><span id="__span-434-5"><a id="__codelineno-434-5" name="__codelineno-434-5" href="#__codelineno-434-5"></a><span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="w"> </span><span class="p">(</span><span class="n">s</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">a</span><span class="p">);</span><span class="w"> </span><span class="c1">// True</span>
</span><span id="__span-434-6"><a id="__codelineno-434-6" name="__codelineno-434-6" href="#__codelineno-434-6"></a><span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="w"> </span><span class="p">(</span><span class="n">s</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">msft</span><span class="p">);</span><span class="w"> </span><span class="c1">// True</span>
</span></code></pre></div>
<div class="language-csharp highlight"><pre><span></span><code><span id="__span-435-1"><a id="__codelineno-435-1" name="__codelineno-435-1" href="#__codelineno-435-1"></a><span class="n">House</span><span class="w"> </span><span class="n">h</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">House</span><span class="p">();</span>
</span><span id="__span-435-2"><a id="__codelineno-435-2" name="__codelineno-435-2" href="#__codelineno-435-2"></a><span class="n">Asset</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">h</span><span class="p">;</span><span class="w"> </span><span class="c1">// Upcast always succeeds</span>
</span><span id="__span-435-3"><a id="__codelineno-435-3" name="__codelineno-435-3" href="#__codelineno-435-3"></a><span class="n">Stock</span><span class="w"> </span><span class="n">s</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">Stock</span><span class="p">)</span><span class="n">a</span><span class="p">;</span><span class="w"> </span><span class="c1">// Downcast fails: a is not a Stock</span>
</span></code></pre></div>
<p><strong>The as operator</strong></p>
<p>The as operator performs a downcast that evaluates to null (rather than throwing
an exception) if the downcast fails</p>
<div class="language-csharp highlight"><pre><span></span><code><span id="__span-436-1"><a id="__codelineno-436-1" name="__codelineno-436-1" href="#__codelineno-436-1"></a><span class="n">Asset</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">Asset</span><span class="p">();</span>
</span><span id="__span-436-2"><a id="__codelineno-436-2" name="__codelineno-436-2" href="#__codelineno-436-2"></a><span class="n">Stock</span><span class="w"> </span><span class="n">s</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">Stock</span><span class="p">;</span><span class="w"> </span><span class="c1">// s is null; no exception thrown</span>
</span></code></pre></div>
<p>This is useful when youâ€™re going to subsequently test whether the result is null:</p>
<div class="language-csharp highlight"><pre><span></span><code><span id="__span-437-1"><a id="__codelineno-437-1" name="__codelineno-437-1" href="#__codelineno-437-1"></a><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">s</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="k">null</span><span class="p">)</span><span class="w"> </span><span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="w"> </span><span class="p">(</span><span class="n">s</span><span class="p">.</span><span class="n">SharesOwned</span><span class="p">);</span>
</span></code></pre></div>
<p><strong>The is operator</strong></p>
<p>The is operator tests whether a reference conversion would succeed; in other words, whether an object derives from a specified class (or implements an interface). It is often used to test before downcasting.The is operator also evaluates to true if an unboxing conversion would succeed.</p>
<div class="language-csharp highlight"><pre><span></span><code><span id="__span-438-1"><a id="__codelineno-438-1" name="__codelineno-438-1" href="#__codelineno-438-1"></a><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">a</span><span class="w"> </span><span class="k">is</span><span class="w"> </span><span class="n">Stock</span><span class="p">)</span>
</span><span id="__span-438-2"><a id="__codelineno-438-2" name="__codelineno-438-2" href="#__codelineno-438-2"></a><span class="w"> </span><span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="w"> </span><span class="p">(((</span><span class="n">Stock</span><span class="p">)</span><span class="n">a</span><span class="p">).</span><span class="n">SharesOwned</span><span class="p">);</span>
</span></code></pre></div>
<p><strong>The is operator and pattern variables</strong></p>
<p>From C# 7, you can introduce a variable while using the is operator:</p>
<div class="language-csharp highlight"><pre><span></span><code><span id="__span-439-1"><a id="__codelineno-439-1" name="__codelineno-439-1" href="#__codelineno-439-1"></a><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">a</span><span class="w"> </span><span class="k">is</span><span class="w"> </span><span class="n">Stock</span><span class="w"> </span><span class="n">s</span><span class="p">)</span>
</span><span id="__span-439-2"><a id="__codelineno-439-2" name="__codelineno-439-2" href="#__codelineno-439-2"></a><span class="w"> </span><span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="w"> </span><span class="p">(</span><span class="n">s</span><span class="p">.</span><span class="n">SharesOwned</span><span class="p">);</span>
</span></code></pre></div>
<p>This is equivalent to:</p>
<div class="language-csharp highlight"><pre><span></span><code><span id="__span-440-1"><a id="__codelineno-440-1" name="__codelineno-440-1" href="#__codelineno-440-1"></a><span class="n">Stock</span><span class="w"> </span><span class="n">s</span><span class="p">;</span>
</span><span id="__span-440-2"><a id="__codelineno-440-2" name="__codelineno-440-2" href="#__codelineno-440-2"></a><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">a</span><span class="w"> </span><span class="k">is</span><span class="w"> </span><span class="n">Stock</span><span class="p">)</span>
</span><span id="__span-440-3"><a id="__codelineno-440-3" name="__codelineno-440-3" href="#__codelineno-440-3"></a><span class="p">{</span>
</span><span id="__span-440-4"><a id="__codelineno-440-4" name="__codelineno-440-4" href="#__codelineno-440-4"></a><span class="w"> </span><span class="n">s</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">Stock</span><span class="p">)</span><span class="w"> </span><span class="n">a</span><span class="p">;</span>
</span><span id="__span-440-5"><a id="__codelineno-440-5" name="__codelineno-440-5" href="#__codelineno-440-5"></a><span class="w"> </span><span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="w"> </span><span class="p">(</span><span class="n">s</span><span class="p">.</span><span class="n">SharesOwned</span><span class="p">);</span>
</span><span id="__span-440-6"><a id="__codelineno-440-6" name="__codelineno-440-6" href="#__codelineno-440-6"></a><span class="p">}</span>
</span></code></pre></div>
<h3 id="virtual-function-members"><strong>Virtual Function Members</strong></h3>
<p>A function marked as virtual can be overridden by subclasses wanting to provide a specialized implementation. Methods, properties, indexers, and events can all be declared virtual.</p>
<div class="language-csharp highlight"><pre><span></span><code><span id="__span-441-1"><a id="__codelineno-441-1" name="__codelineno-441-1" href="#__codelineno-441-1"></a><span class="k">public</span><span class="w"> </span><span class="k">class</span><span class="w"> </span><span class="nc">Asset</span>
</span><span id="__span-441-2"><a id="__codelineno-441-2" name="__codelineno-441-2" href="#__codelineno-441-2"></a><span class="p">{</span>
</span><span id="__span-441-3"><a id="__codelineno-441-3" name="__codelineno-441-3" href="#__codelineno-441-3"></a><span class="w"> </span><span class="k">public</span><span class="w"> </span><span class="kt">string</span><span class="w"> </span><span class="n">Name</span><span class="p">;</span>
</span><span id="__span-441-4"><a id="__codelineno-441-4" name="__codelineno-441-4" href="#__codelineno-441-4"></a><span class="w"> </span><span class="k">public</span><span class="w"> </span><span class="k">virtual</span><span class="w"> </span><span class="kt">decimal</span><span class="w"> </span><span class="n">Liability</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="c1">// Expression-bodied property</span>
</span><span id="__span-441-5"><a id="__codelineno-441-5" name="__codelineno-441-5" href="#__codelineno-441-5"></a><span class="p">}</span>
</span><span id="__span-441-6"><a id="__codelineno-441-6" name="__codelineno-441-6" href="#__codelineno-441-6"></a><span class="c1">//(Liability =&gt; 0 is a shortcut for { get { return 0; } }.</span>
</span></code></pre></div>
<p>A subclass overrides a virtual method by applying the override modifier:</p>
<div class="language-csharp highlight"><pre><span></span><code><span id="__span-442-1"><a id="__codelineno-442-1" name="__codelineno-442-1" href="#__codelineno-442-1"></a><span class="k">public</span><span class="w"> </span><span class="k">class</span><span class="w"> </span><span class="nc">Stock</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="n">Asset</span>
</span><span id="__span-442-2"><a id="__codelineno-442-2" name="__codelineno-442-2" href="#__codelineno-442-2"></a><span class="p">{</span>
</span><span id="__span-442-3"><a id="__codelineno-442-3" name="__codelineno-442-3" href="#__codelineno-442-3"></a><span class="w"> </span><span class="k">public</span><span class="w"> </span><span class="kt">long</span><span class="w"> </span><span class="n">SharesOwned</span><span class="p">;</span>
</span><span id="__span-442-4"><a id="__codelineno-442-4" name="__codelineno-442-4" href="#__codelineno-442-4"></a><span class="p">}</span>
</span><span id="__span-442-5"><a id="__codelineno-442-5" name="__codelineno-442-5" href="#__codelineno-442-5"></a><span class="k">public</span><span class="w"> </span><span class="k">class</span><span class="w"> </span><span class="nc">House</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="n">Asset</span>
</span><span id="__span-442-6"><a id="__codelineno-442-6" name="__codelineno-442-6" href="#__codelineno-442-6"></a><span class="p">{</span>
</span><span id="__span-442-7"><a id="__codelineno-442-7" name="__codelineno-442-7" href="#__codelineno-442-7"></a><span class="w"> </span><span class="k">public</span><span class="w"> </span><span class="kt">decimal</span><span class="w"> </span><span class="n">Mortgage</span><span class="p">;</span>
</span><span id="__span-442-8"><a id="__codelineno-442-8" name="__codelineno-442-8" href="#__codelineno-442-8"></a><span class="w"> </span><span class="k">public</span><span class="w"> </span><span class="k">override</span><span class="w"> </span><span class="kt">decimal</span><span class="w"> </span><span class="n">Liability</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="n">Mortgage</span><span class="p">;</span>
</span><span id="__span-442-9"><a id="__codelineno-442-9" name="__codelineno-442-9" href="#__codelineno-442-9"></a><span class="p">}</span>
</span></code></pre></div>
<h3 id="abstract-classes-and-abstract-members">Abstract Classes and Abstract Members</h3>
<p>A class declared as abstract can never be instantiated. Instead, only its concrete subclasses can be instantiated.</p>
<p>Abstract classes are able to define abstract members. Abstract members are like virtual members, except they donâ€™t provide a default implementation. That implementation must be provided by the subclass, unless that subclass is also declared abstract.</p>
<div class="language-csharp highlight"><pre><span></span><code><span id="__span-443-1"><a id="__codelineno-443-1" name="__codelineno-443-1" href="#__codelineno-443-1"></a><span class="k">public</span><span class="w"> </span><span class="k">abstract</span><span class="w"> </span><span class="k">class</span><span class="w"> </span><span class="nc">Asset</span>
</span><span id="__span-443-2"><a id="__codelineno-443-2" name="__codelineno-443-2" href="#__codelineno-443-2"></a><span class="p">{</span>
</span><span id="__span-443-3"><a id="__codelineno-443-3" name="__codelineno-443-3" href="#__codelineno-443-3"></a><span class="w"> </span><span class="c1">// Note empty implementation</span>
</span><span id="__span-443-4"><a id="__codelineno-443-4" name="__codelineno-443-4" href="#__codelineno-443-4"></a><span class="w"> </span><span class="k">public</span><span class="w"> </span><span class="k">abstract</span><span class="w"> </span><span class="kt">decimal</span><span class="w"> </span><span class="n">NetValue</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">get</span><span class="p">;</span><span class="w"> </span><span class="p">}</span>
</span><span id="__span-443-5"><a id="__codelineno-443-5" name="__codelineno-443-5" href="#__codelineno-443-5"></a><span class="p">}</span>
</span><span id="__span-443-6"><a id="__codelineno-443-6" name="__codelineno-443-6" href="#__codelineno-443-6"></a><span class="k">public</span><span class="w"> </span><span class="k">class</span><span class="w"> </span><span class="nc">Stock</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="n">Asset</span>
</span><span id="__span-443-7"><a id="__codelineno-443-7" name="__codelineno-443-7" href="#__codelineno-443-7"></a><span class="p">{</span>
</span><span id="__span-443-8"><a id="__codelineno-443-8" name="__codelineno-443-8" href="#__codelineno-443-8"></a><span class="w"> </span><span class="k">public</span><span class="w"> </span><span class="kt">long</span><span class="w"> </span><span class="n">SharesOwned</span><span class="p">;</span>
</span><span id="__span-443-9"><a id="__codelineno-443-9" name="__codelineno-443-9" href="#__codelineno-443-9"></a><span class="w"> </span><span class="k">public</span><span class="w"> </span><span class="kt">decimal</span><span class="w"> </span><span class="n">CurrentPrice</span><span class="p">;</span>
</span><span id="__span-443-10"><a id="__codelineno-443-10" name="__codelineno-443-10" href="#__codelineno-443-10"></a><span class="w"> </span><span class="c1">// Override like a virtual method.</span>
</span><span id="__span-443-11"><a id="__codelineno-443-11" name="__codelineno-443-11" href="#__codelineno-443-11"></a><span class="w"> </span><span class="k">public</span><span class="w"> </span><span class="k">override</span><span class="w"> </span><span class="kt">decimal</span><span class="w"> </span><span class="n">NetValue</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="n">CurrentPrice</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">SharesOwned</span><span class="p">;</span>
</span><span id="__span-443-12"><a id="__codelineno-443-12" name="__codelineno-443-12" href="#__codelineno-443-12"></a><span class="p">}</span>
</span></code></pre></div>
<h3 id="new-versus-override">new versus override</h3>
<div class="language-csharp highlight"><pre><span></span><code><span id="__span-444-1"><a id="__codelineno-444-1" name="__codelineno-444-1" href="#__codelineno-444-1"></a><span class="k">public</span><span class="w"> </span><span class="k">class</span><span class="w"> </span><span class="nc">BaseClass</span>
</span><span id="__span-444-2"><a id="__codelineno-444-2" name="__codelineno-444-2" href="#__codelineno-444-2"></a><span class="p">{</span>
</span><span id="__span-444-3"><a id="__codelineno-444-3" name="__codelineno-444-3" href="#__codelineno-444-3"></a><span class="w"> </span><span class="k">public</span><span class="w"> </span><span class="k">virtual</span><span class="w"> </span><span class="k">void</span><span class="w"> </span><span class="nf">Foo</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="w"> </span><span class="p">(</span><span class="s">&quot;BaseClass.Foo&quot;</span><span class="p">);</span><span class="w"> </span><span class="p">}</span>
</span><span id="__span-444-4"><a id="__codelineno-444-4" name="__codelineno-444-4" href="#__codelineno-444-4"></a><span class="p">}</span>
</span><span id="__span-444-5"><a id="__codelineno-444-5" name="__codelineno-444-5" href="#__codelineno-444-5"></a><span class="k">public</span><span class="w"> </span><span class="k">class</span><span class="w"> </span><span class="nc">Overrider</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="n">BaseClass</span>
</span><span id="__span-444-6"><a id="__codelineno-444-6" name="__codelineno-444-6" href="#__codelineno-444-6"></a><span class="p">{</span>
</span><span id="__span-444-7"><a id="__codelineno-444-7" name="__codelineno-444-7" href="#__codelineno-444-7"></a><span class="w"> </span><span class="k">public</span><span class="w"> </span><span class="k">override</span><span class="w"> </span><span class="k">void</span><span class="w"> </span><span class="nf">Foo</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="w"> </span><span class="p">(</span><span class="s">&quot;Overrider.Foo&quot;</span><span class="p">);</span><span class="w"> </span><span class="p">}</span>
</span><span id="__span-444-8"><a id="__codelineno-444-8" name="__codelineno-444-8" href="#__codelineno-444-8"></a><span class="p">}</span>
</span><span id="__span-444-9"><a id="__codelineno-444-9" name="__codelineno-444-9" href="#__codelineno-444-9"></a><span class="k">public</span><span class="w"> </span><span class="k">class</span><span class="w"> </span><span class="nc">Hider</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="n">BaseClass</span>
</span><span id="__span-444-10"><a id="__codelineno-444-10" name="__codelineno-444-10" href="#__codelineno-444-10"></a><span class="p">{</span>
</span><span id="__span-444-11"><a id="__codelineno-444-11" name="__codelineno-444-11" href="#__codelineno-444-11"></a><span class="w"> </span><span class="k">public</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="k">void</span><span class="w"> </span><span class="nf">Foo</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="w"> </span><span class="p">(</span><span class="s">&quot;Hider.Foo&quot;</span><span class="p">);</span><span class="w"> </span><span class="p">}</span>
</span><span id="__span-444-12"><a id="__codelineno-444-12" name="__codelineno-444-12" href="#__codelineno-444-12"></a><span class="p">}</span>
</span><span id="__span-444-13"><a id="__codelineno-444-13" name="__codelineno-444-13" href="#__codelineno-444-13"></a>
</span><span id="__span-444-14"><a id="__codelineno-444-14" name="__codelineno-444-14" href="#__codelineno-444-14"></a><span class="n">Overrider</span><span class="w"> </span><span class="n">over</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">Overrider</span><span class="p">();</span>
</span><span id="__span-444-15"><a id="__codelineno-444-15" name="__codelineno-444-15" href="#__codelineno-444-15"></a><span class="n">BaseClass</span><span class="w"> </span><span class="n">b1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">over</span><span class="p">;</span>
</span><span id="__span-444-16"><a id="__codelineno-444-16" name="__codelineno-444-16" href="#__codelineno-444-16"></a><span class="n">over</span><span class="p">.</span><span class="n">Foo</span><span class="p">();</span><span class="w"> </span><span class="c1">// Overrider.Foo</span>
</span><span id="__span-444-17"><a id="__codelineno-444-17" name="__codelineno-444-17" href="#__codelineno-444-17"></a><span class="n">b1</span><span class="p">.</span><span class="n">Foo</span><span class="p">();</span><span class="w"> </span><span class="c1">// Overrider.Foo</span>
</span><span id="__span-444-18"><a id="__codelineno-444-18" name="__codelineno-444-18" href="#__codelineno-444-18"></a><span class="n">Hider</span><span class="w"> </span><span class="n">h</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">Hider</span><span class="p">();</span>
</span><span id="__span-444-19"><a id="__codelineno-444-19" name="__codelineno-444-19" href="#__codelineno-444-19"></a><span class="n">BaseClass</span><span class="w"> </span><span class="n">b2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">h</span><span class="p">;</span>
</span><span id="__span-444-20"><a id="__codelineno-444-20" name="__codelineno-444-20" href="#__codelineno-444-20"></a><span class="n">h</span><span class="p">.</span><span class="n">Foo</span><span class="p">();</span><span class="w"> </span><span class="c1">// Hider.Foo</span>
</span><span id="__span-444-21"><a id="__codelineno-444-21" name="__codelineno-444-21" href="#__codelineno-444-21"></a><span class="n">b2</span><span class="p">.</span><span class="n">Foo</span><span class="p">();</span><span class="w"> </span><span class="c1">// BaseClass.Foo</span>
</span></code></pre></div>
<h3 id="sealing-functions-and-classes">Sealing Functions and Classes</h3>
<p>An overridden function member may seal its implementation with the sealed keyword to prevent it from being overridden by further subclasses. In our earlier virtual function member example, we could have sealed Houseâ€™s implementation of Liability, preventing a class that derives from House from overriding Liability,as follows.</p>
<div class="language-csharp highlight"><pre><span></span><code><span id="__span-445-1"><a id="__codelineno-445-1" name="__codelineno-445-1" href="#__codelineno-445-1"></a><span class="k">public</span><span class="w"> </span><span class="k">sealed</span><span class="w"> </span><span class="k">override</span><span class="w"> </span><span class="kt">decimal</span><span class="w"> </span><span class="n">Liability</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">get</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="n">Mortgage</span><span class="p">;</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="p">}</span>
</span></code></pre></div>
<p>You can also seal the class itself, implicitly sealing all the virtual functions, by applying the sealed modifier to the class itself. Sealing a class is more common than sealing a function member.
Although you can seal against overriding, you canâ€™t seal a member against being hidden.</p>
<h3 id="the-base-keyword">The base Keyword</h3>
<p>The base keyword is similar to the this keyword. It serves two essential purposes</p>
<ul>
<li>Accessing an overridden function member from the subclass</li>
<li>Calling a base-class constructor</li>
</ul>
<div class="language-csharp highlight"><pre><span></span><code><span id="__span-446-1"><a id="__codelineno-446-1" name="__codelineno-446-1" href="#__codelineno-446-1"></a><span class="k">public</span><span class="w"> </span><span class="k">class</span><span class="w"> </span><span class="nc">House</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="n">Asset</span>
</span><span id="__span-446-2"><a id="__codelineno-446-2" name="__codelineno-446-2" href="#__codelineno-446-2"></a><span class="p">{</span>
</span><span id="__span-446-3"><a id="__codelineno-446-3" name="__codelineno-446-3" href="#__codelineno-446-3"></a><span class="w"> </span><span class="p">...</span>
</span><span id="__span-446-4"><a id="__codelineno-446-4" name="__codelineno-446-4" href="#__codelineno-446-4"></a><span class="w"> </span><span class="k">public</span><span class="w"> </span><span class="k">override</span><span class="w"> </span><span class="kt">decimal</span><span class="w"> </span><span class="n">Liability</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="k">base</span><span class="p">.</span><span class="n">Liability</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">Mortgage</span><span class="p">;</span>
</span><span id="__span-446-5"><a id="__codelineno-446-5" name="__codelineno-446-5" href="#__codelineno-446-5"></a><span class="p">}</span>
</span></code></pre></div>
<p>With the base keyword, we access Assetâ€™s Liability property nonvirtually. This means we will always access Assetâ€™s version of this propertyâ€”regardless of the instanceâ€™s actual runtime type.</p>
<h3 id="constructors-and-inheritance">Constructors and Inheritance</h3>
<p>A subclass must declare its own constructors. The base classâ€™s constructors are accessible to the derived class, but are never automatically inherited.</p>
<div class="language-csharp highlight"><pre><span></span><code><span id="__span-447-1"><a id="__codelineno-447-1" name="__codelineno-447-1" href="#__codelineno-447-1"></a><span class="k">public</span><span class="w"> </span><span class="k">class</span><span class="w"> </span><span class="nc">Baseclass</span>
</span><span id="__span-447-2"><a id="__codelineno-447-2" name="__codelineno-447-2" href="#__codelineno-447-2"></a><span class="p">{</span>
</span><span id="__span-447-3"><a id="__codelineno-447-3" name="__codelineno-447-3" href="#__codelineno-447-3"></a><span class="w"> </span><span class="k">public</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">X</span><span class="p">;</span>
</span><span id="__span-447-4"><a id="__codelineno-447-4" name="__codelineno-447-4" href="#__codelineno-447-4"></a><span class="w"> </span><span class="k">public</span><span class="w"> </span><span class="nf">Baseclass</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="p">}</span>
</span><span id="__span-447-5"><a id="__codelineno-447-5" name="__codelineno-447-5" href="#__codelineno-447-5"></a><span class="w"> </span><span class="k">public</span><span class="w"> </span><span class="nf">Baseclass</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">x</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="n">X</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">x</span><span class="p">;</span><span class="w"> </span><span class="p">}</span>
</span><span id="__span-447-6"><a id="__codelineno-447-6" name="__codelineno-447-6" href="#__codelineno-447-6"></a><span class="p">}</span>
</span><span id="__span-447-7"><a id="__codelineno-447-7" name="__codelineno-447-7" href="#__codelineno-447-7"></a><span class="k">public</span><span class="w"> </span><span class="k">class</span><span class="w"> </span><span class="nc">Subclass</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="n">Baseclass</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="p">}</span>
</span><span id="__span-447-8"><a id="__codelineno-447-8" name="__codelineno-447-8" href="#__codelineno-447-8"></a>
</span><span id="__span-447-9"><a id="__codelineno-447-9" name="__codelineno-447-9" href="#__codelineno-447-9"></a><span class="n">Subclass</span><span class="w"> </span><span class="n">s</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">Subclass</span><span class="w"> </span><span class="p">(</span><span class="mi">123</span><span class="p">);</span><span class="c1">//This is illegal</span>
</span></code></pre></div>
<p>Subclass must hence â€œredefineâ€ any constructors it wants to expose. In doing so, however, it can call any of the base classâ€™s constructors with the base keyword:</p>
<div class="language-csharp highlight"><pre><span></span><code><span id="__span-448-1"><a id="__codelineno-448-1" name="__codelineno-448-1" href="#__codelineno-448-1"></a><span class="k">public</span><span class="w"> </span><span class="k">class</span><span class="w"> </span><span class="nc">Subclass</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="n">Baseclass</span>
</span><span id="__span-448-2"><a id="__codelineno-448-2" name="__codelineno-448-2" href="#__codelineno-448-2"></a><span class="p">{</span>
</span><span id="__span-448-3"><a id="__codelineno-448-3" name="__codelineno-448-3" href="#__codelineno-448-3"></a><span class="w"> </span><span class="k">public</span><span class="w"> </span><span class="nf">Subclass</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">x</span><span class="p">)</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="k">base</span><span class="w"> </span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="p">}</span>
</span><span id="__span-448-4"><a id="__codelineno-448-4" name="__codelineno-448-4" href="#__codelineno-448-4"></a><span class="p">}</span>
</span></code></pre></div>
<h3 id="constructor-and-field-initialization-order">Constructor and field initialization order</h3>
<p>When an object is instantiated, initialization takes place in the following order</p>
<ul>
<li>From subclass to base class<ul>
<li>Fields are initialized</li>
<li>Arguments to base-class constructor calls are evaluated</li>
</ul>
</li>
<li>From base class to subclass<ul>
<li>Constructor bodies execute</li>
</ul>
</li>
</ul>
<div class="language-csharp highlight"><pre><span></span><code><span id="__span-449-1"><a id="__codelineno-449-1" name="__codelineno-449-1" href="#__codelineno-449-1"></a><span class="k">public</span><span class="w"> </span><span class="k">class</span><span class="w"> </span><span class="nc">B</span>
</span><span id="__span-449-2"><a id="__codelineno-449-2" name="__codelineno-449-2" href="#__codelineno-449-2"></a><span class="p">{</span>
</span><span id="__span-449-3"><a id="__codelineno-449-3" name="__codelineno-449-3" href="#__codelineno-449-3"></a><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span><span class="w"> </span><span class="c1">// Executes 3rd</span>
</span><span id="__span-449-4"><a id="__codelineno-449-4" name="__codelineno-449-4" href="#__codelineno-449-4"></a><span class="w"> </span><span class="k">public</span><span class="w"> </span><span class="nf">B</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">x</span><span class="p">)</span>
</span><span id="__span-449-5"><a id="__codelineno-449-5" name="__codelineno-449-5" href="#__codelineno-449-5"></a><span class="w"> </span><span class="p">{</span>
</span><span id="__span-449-6"><a id="__codelineno-449-6" name="__codelineno-449-6" href="#__codelineno-449-6"></a><span class="w"> </span><span class="p">...</span><span class="w"> </span><span class="c1">// Executes 4th</span>
</span><span id="__span-449-7"><a id="__codelineno-449-7" name="__codelineno-449-7" href="#__codelineno-449-7"></a><span class="w"> </span><span class="p">}</span>
</span><span id="__span-449-8"><a id="__codelineno-449-8" name="__codelineno-449-8" href="#__codelineno-449-8"></a><span class="p">}</span>
</span><span id="__span-449-9"><a id="__codelineno-449-9" name="__codelineno-449-9" href="#__codelineno-449-9"></a><span class="k">public</span><span class="w"> </span><span class="k">class</span><span class="w"> </span><span class="nc">D</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="n">B</span>
</span><span id="__span-449-10"><a id="__codelineno-449-10" name="__codelineno-449-10" href="#__codelineno-449-10"></a><span class="p">{</span>
</span><span id="__span-449-11"><a id="__codelineno-449-11" name="__codelineno-449-11" href="#__codelineno-449-11"></a><span class="kt">int</span><span class="w"> </span><span class="n">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span><span class="w"> </span><span class="c1">// Executes 1st</span>
</span><span id="__span-449-12"><a id="__codelineno-449-12" name="__codelineno-449-12" href="#__codelineno-449-12"></a><span class="w"> </span><span class="k">public</span><span class="w"> </span><span class="nf">D</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">x</span><span class="p">)</span>
</span><span id="__span-449-13"><a id="__codelineno-449-13" name="__codelineno-449-13" href="#__codelineno-449-13"></a><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="k">base</span><span class="w"> </span><span class="p">(</span><span class="n">x</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="c1">// Executes 2nd</span>
</span><span id="__span-449-14"><a id="__codelineno-449-14" name="__codelineno-449-14" href="#__codelineno-449-14"></a><span class="w"> </span><span class="p">{</span>
</span><span id="__span-449-15"><a id="__codelineno-449-15" name="__codelineno-449-15" href="#__codelineno-449-15"></a><span class="w"> </span><span class="p">...</span><span class="w"> </span><span class="c1">// Executes 5th</span>
</span><span id="__span-449-16"><a id="__codelineno-449-16" name="__codelineno-449-16" href="#__codelineno-449-16"></a><span class="w"> </span><span class="p">}</span>
</span><span id="__span-449-17"><a id="__codelineno-449-17" name="__codelineno-449-17" href="#__codelineno-449-17"></a><span class="p">}</span>
</span></code></pre></div>
<h3 id="the-object-type">The object Type</h3>
<p><strong>object (System.Object) is the ultimate base class for all types.</strong> Any type can be
upcast to object.</p>
<p>To illustrate how this is useful, consider a general-purpose stack. A stack is a data structure based on the principle of LIFOâ€”â€œLast-In First-Out.â€ A stack has two operations: push an object on the stack, and pop an object off the stack. Here is a simple implementation that can hold up to 10 objects</p>
<div class="language-csharp highlight"><pre><span></span><code><span id="__span-450-1"><a id="__codelineno-450-1" name="__codelineno-450-1" href="#__codelineno-450-1"></a><span class="k">public</span><span class="w"> </span><span class="k">class</span><span class="w"> </span><span class="nc">Stack</span>
</span><span id="__span-450-2"><a id="__codelineno-450-2" name="__codelineno-450-2" href="#__codelineno-450-2"></a><span class="p">{</span>
</span><span id="__span-450-3"><a id="__codelineno-450-3" name="__codelineno-450-3" href="#__codelineno-450-3"></a><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">position</span><span class="p">;</span>
</span><span id="__span-450-4"><a id="__codelineno-450-4" name="__codelineno-450-4" href="#__codelineno-450-4"></a><span class="w"> </span><span class="kt">object</span><span class="p">[]</span><span class="w"> </span><span class="n">data</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="kt">object</span><span class="p">[</span><span class="mi">10</span><span class="p">];</span>
</span><span id="__span-450-5"><a id="__codelineno-450-5" name="__codelineno-450-5" href="#__codelineno-450-5"></a><span class="w"> </span><span class="k">public</span><span class="w"> </span><span class="k">void</span><span class="w"> </span><span class="nf">Push</span><span class="w"> </span><span class="p">(</span><span class="kt">object</span><span class="w"> </span><span class="n">obj</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">data</span><span class="p">[</span><span class="n">position</span><span class="o">++</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">obj</span><span class="p">;</span><span class="w"> </span><span class="p">}</span>
</span><span id="__span-450-6"><a id="__codelineno-450-6" name="__codelineno-450-6" href="#__codelineno-450-6"></a><span class="w"> </span><span class="k">public</span><span class="w"> </span><span class="kt">object</span><span class="w"> </span><span class="nf">Pop</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="n">data</span><span class="p">[</span><span class="o">--</span><span class="n">position</span><span class="p">];</span><span class="w"> </span><span class="p">}</span>
</span><span id="__span-450-7"><a id="__codelineno-450-7" name="__codelineno-450-7" href="#__codelineno-450-7"></a><span class="p">}</span>
</span></code></pre></div>
<p>Because Stack works with the object type, we can Push and Pop instances of any type to and from the Stack</p>
<div class="language-csharp highlight"><pre><span></span><code><span id="__span-451-1"><a id="__codelineno-451-1" name="__codelineno-451-1" href="#__codelineno-451-1"></a><span class="n">Stack</span><span class="w"> </span><span class="n">stack</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">Stack</span><span class="p">();</span>
</span><span id="__span-451-2"><a id="__codelineno-451-2" name="__codelineno-451-2" href="#__codelineno-451-2"></a><span class="n">stack</span><span class="p">.</span><span class="n">Push</span><span class="w"> </span><span class="p">(</span><span class="s">&quot;sausage&quot;</span><span class="p">);</span>
</span><span id="__span-451-3"><a id="__codelineno-451-3" name="__codelineno-451-3" href="#__codelineno-451-3"></a><span class="kt">string</span><span class="w"> </span><span class="n">s</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="kt">string</span><span class="p">)</span><span class="w"> </span><span class="n">stack</span><span class="p">.</span><span class="n">Pop</span><span class="p">();</span><span class="w"> </span><span class="c1">// Downcast, so explicit cast is needed</span>
</span><span id="__span-451-4"><a id="__codelineno-451-4" name="__codelineno-451-4" href="#__codelineno-451-4"></a><span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="w"> </span><span class="p">(</span><span class="n">s</span><span class="p">);</span><span class="w"> </span><span class="c1">// sausage</span>
</span></code></pre></div>
<p>object is a reference type, by virtue of being a class. Despite this, value types, such as int, can also be cast to and from object, and so be added to our stack. This feature of C# is called type unification and is demonstrated here:</p>
<div class="language-csharp highlight"><pre><span></span><code><span id="__span-452-1"><a id="__codelineno-452-1" name="__codelineno-452-1" href="#__codelineno-452-1"></a><span class="n">stack</span><span class="p">.</span><span class="n">Push</span><span class="w"> </span><span class="p">(</span><span class="mi">3</span><span class="p">);</span>
</span><span id="__span-452-2"><a id="__codelineno-452-2" name="__codelineno-452-2" href="#__codelineno-452-2"></a><span class="kt">int</span><span class="w"> </span><span class="n">three</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="p">)</span><span class="w"> </span><span class="n">stack</span><span class="p">.</span><span class="n">Pop</span><span class="p">();</span>
</span></code></pre></div>
<aside>
ðŸ’¡ When you cast between a value type and object, the CLR must perform some special work to bridge the difference in semantics between value and reference types. This process is called boxing and unboxing

</aside>

<h3 id="boxing-and-unboxing">Boxing and Unboxing</h3>
<p>Boxing is the act of converting a value-type instance to a reference-type instance. The reference type may be either the object class or an interface</p>
<div class="language-csharp highlight"><pre><span></span><code><span id="__span-453-1"><a id="__codelineno-453-1" name="__codelineno-453-1" href="#__codelineno-453-1"></a><span class="kt">int</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">9</span><span class="p">;</span>
</span><span id="__span-453-2"><a id="__codelineno-453-2" name="__codelineno-453-2" href="#__codelineno-453-2"></a><span class="kt">object</span><span class="w"> </span><span class="n">obj</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">x</span><span class="p">;</span><span class="w"> </span><span class="c1">// Box the int</span>
</span></code></pre></div>
<p>Unboxing reverses the operation, by casting the object back to the original value type</p>
<div class="language-csharp highlight"><pre><span></span><code><span id="__span-454-1"><a id="__codelineno-454-1" name="__codelineno-454-1" href="#__codelineno-454-1"></a><span class="kt">int</span><span class="w"> </span><span class="n">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="p">)</span><span class="n">obj</span><span class="p">;</span><span class="w"> </span><span class="c1">// Unbox the int</span>
</span><span id="__span-454-2"><a id="__codelineno-454-2" name="__codelineno-454-2" href="#__codelineno-454-2"></a><span class="kt">object</span><span class="w"> </span><span class="n">obj</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">9</span><span class="p">;</span><span class="w"> </span><span class="c1">// 9 is inferred to be of type int</span>
</span><span id="__span-454-3"><a id="__codelineno-454-3" name="__codelineno-454-3" href="#__codelineno-454-3"></a><span class="kt">long</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="kt">long</span><span class="p">)</span><span class="w"> </span><span class="n">obj</span><span class="p">;</span><span class="w"> </span><span class="c1">// InvalidCastException</span>
</span></code></pre></div>
<p>Unboxing requires an explicit cast. The runtime checks that the stated value type
matches the actual object type, and throws an InvalidCastException if the check
fails.</p>
<h3 id="the-gettype-method-and-typeof-operator">The GetType Method and typeof Operator</h3>
<p>All types in C# are represented at runtime with an instance of System.Type. There
are two basic ways to get a System.Type object:</p>
<ul>
<li>Call GetType on the instance</li>
<li>Use the typeof operator on a type name</li>
</ul>
<p>GetType is evaluated at runtime; typeof is evaluated statically at compile time</p>
<div class="language-csharp highlight"><pre><span></span><code><span id="__span-455-1"><a id="__codelineno-455-1" name="__codelineno-455-1" href="#__codelineno-455-1"></a><span class="k">using</span><span class="w"> </span><span class="nn">System</span><span class="p">;</span>
</span><span id="__span-455-2"><a id="__codelineno-455-2" name="__codelineno-455-2" href="#__codelineno-455-2"></a><span class="k">public</span><span class="w"> </span><span class="k">class</span><span class="w"> </span><span class="nc">Point</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">public</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">X</span><span class="p">,</span><span class="w"> </span><span class="n">Y</span><span class="p">;</span><span class="w"> </span><span class="p">}</span>
</span><span id="__span-455-3"><a id="__codelineno-455-3" name="__codelineno-455-3" href="#__codelineno-455-3"></a><span class="k">class</span><span class="w"> </span><span class="nc">Test</span>
</span><span id="__span-455-4"><a id="__codelineno-455-4" name="__codelineno-455-4" href="#__codelineno-455-4"></a><span class="p">{</span>
</span><span id="__span-455-5"><a id="__codelineno-455-5" name="__codelineno-455-5" href="#__codelineno-455-5"></a><span class="w"> </span><span class="k">static</span><span class="w"> </span><span class="k">void</span><span class="w"> </span><span class="nf">Main</span><span class="p">()</span>
</span><span id="__span-455-6"><a id="__codelineno-455-6" name="__codelineno-455-6" href="#__codelineno-455-6"></a><span class="w"> </span><span class="p">{</span>
</span><span id="__span-455-7"><a id="__codelineno-455-7" name="__codelineno-455-7" href="#__codelineno-455-7"></a><span class="w"> </span><span class="n">Point</span><span class="w"> </span><span class="n">p</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">Point</span><span class="p">();</span>
</span><span id="__span-455-8"><a id="__codelineno-455-8" name="__codelineno-455-8" href="#__codelineno-455-8"></a><span class="w"> </span><span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="w"> </span><span class="p">(</span><span class="n">p</span><span class="p">.</span><span class="n">GetType</span><span class="p">().</span><span class="n">Name</span><span class="p">);</span><span class="w"> </span><span class="c1">// Point</span>
</span><span id="__span-455-9"><a id="__codelineno-455-9" name="__codelineno-455-9" href="#__codelineno-455-9"></a><span class="w"> </span><span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="w"> </span><span class="p">(</span><span class="k">typeof</span><span class="w"> </span><span class="p">(</span><span class="n">Point</span><span class="p">).</span><span class="n">Name</span><span class="p">);</span><span class="w"> </span><span class="c1">// Point</span>
</span><span id="__span-455-10"><a id="__codelineno-455-10" name="__codelineno-455-10" href="#__codelineno-455-10"></a><span class="w"> </span><span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="w"> </span><span class="p">(</span><span class="n">p</span><span class="p">.</span><span class="n">GetType</span><span class="p">()</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="k">typeof</span><span class="p">(</span><span class="n">Point</span><span class="p">));</span><span class="w"> </span><span class="c1">// True</span>
</span><span id="__span-455-11"><a id="__codelineno-455-11" name="__codelineno-455-11" href="#__codelineno-455-11"></a><span class="w"> </span><span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="w"> </span><span class="p">(</span><span class="n">p</span><span class="p">.</span><span class="n">X</span><span class="p">.</span><span class="n">GetType</span><span class="p">().</span><span class="n">Name</span><span class="p">);</span><span class="w"> </span><span class="c1">// Int32</span>
</span><span id="__span-455-12"><a id="__codelineno-455-12" name="__codelineno-455-12" href="#__codelineno-455-12"></a><span class="w"> </span><span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="w"> </span><span class="p">(</span><span class="n">p</span><span class="p">.</span><span class="n">Y</span><span class="p">.</span><span class="n">GetType</span><span class="p">().</span><span class="n">FullName</span><span class="p">);</span><span class="w"> </span><span class="c1">// System.Int32</span>
</span><span id="__span-455-13"><a id="__codelineno-455-13" name="__codelineno-455-13" href="#__codelineno-455-13"></a><span class="w"> </span><span class="p">}</span>
</span><span id="__span-455-14"><a id="__codelineno-455-14" name="__codelineno-455-14" href="#__codelineno-455-14"></a><span class="p">}</span>
</span></code></pre></div>
<h3 id="the-tostring-method">The ToString Method</h3>
<p>The ToString method returns the default textual representation of a type instance.
This method is overridden by all built-in types. Here is an example of using the int
typeâ€™s ToString method</p>
<div class="language-csharp highlight"><pre><span></span><code><span id="__span-456-1"><a id="__codelineno-456-1" name="__codelineno-456-1" href="#__codelineno-456-1"></a><span class="kt">int</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span>
</span><span id="__span-456-2"><a id="__codelineno-456-2" name="__codelineno-456-2" href="#__codelineno-456-2"></a><span class="kt">string</span><span class="w"> </span><span class="n">s</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">x</span><span class="p">.</span><span class="n">ToString</span><span class="p">();</span><span class="w"> </span><span class="c1">// s is &quot;1&quot;</span>
</span></code></pre></div>
<p>You can override the ToString method on custom types as follows</p>
<div class="language-csharp highlight"><pre><span></span><code><span id="__span-457-1"><a id="__codelineno-457-1" name="__codelineno-457-1" href="#__codelineno-457-1"></a><span class="k">public</span><span class="w"> </span><span class="k">class</span><span class="w"> </span><span class="nc">Panda</span>
</span><span id="__span-457-2"><a id="__codelineno-457-2" name="__codelineno-457-2" href="#__codelineno-457-2"></a><span class="p">{</span>
</span><span id="__span-457-3"><a id="__codelineno-457-3" name="__codelineno-457-3" href="#__codelineno-457-3"></a><span class="w"> </span><span class="k">public</span><span class="w"> </span><span class="kt">string</span><span class="w"> </span><span class="n">Name</span><span class="p">;</span>
</span><span id="__span-457-4"><a id="__codelineno-457-4" name="__codelineno-457-4" href="#__codelineno-457-4"></a><span class="w"> </span><span class="k">public</span><span class="w"> </span><span class="k">override</span><span class="w"> </span><span class="kt">string</span><span class="w"> </span><span class="nf">ToString</span><span class="p">()</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="n">Name</span><span class="p">;</span>
</span><span id="__span-457-5"><a id="__codelineno-457-5" name="__codelineno-457-5" href="#__codelineno-457-5"></a><span class="p">}</span>
</span><span id="__span-457-6"><a id="__codelineno-457-6" name="__codelineno-457-6" href="#__codelineno-457-6"></a><span class="p">...</span>
</span><span id="__span-457-7"><a id="__codelineno-457-7" name="__codelineno-457-7" href="#__codelineno-457-7"></a><span class="n">Panda</span><span class="w"> </span><span class="n">p</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">Panda</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">Name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;Petey&quot;</span><span class="w"> </span><span class="p">};</span>
</span><span id="__span-457-8"><a id="__codelineno-457-8" name="__codelineno-457-8" href="#__codelineno-457-8"></a><span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="w"> </span><span class="p">(</span><span class="n">p</span><span class="p">);</span><span class="w"> </span><span class="c1">// Petey</span>
</span></code></pre></div>
<p><strong>If you donâ€™t override ToString, the method returns the type name</strong></p>
<h1 id="structs">Structs</h1>
<p>A struct is similar to a class, with the following key differences</p>
<ul>
<li>A struct is a value type, whereas a class is a reference type</li>
<li>A struct does not support inheritance (</li>
</ul>
<p>A struct can have all the members a class can, except the following</p>
<ul>
<li>A parameterless constructor</li>
<li>Field initializers</li>
<li>A finalizer</li>
<li>Virtual or protected members</li>
</ul>
<p>The construction semantics of a struct are as follows</p>
<ul>
<li>A parameterless constructor that you canâ€™t override implicitly exists. This perâ€
forms a bitwise-zeroing of its fields.</li>
<li>When you define a struct constructor, you must explicitly assign every field.</li>
</ul>
<div class="language-csharp highlight"><pre><span></span><code><span id="__span-458-1"><a id="__codelineno-458-1" name="__codelineno-458-1" href="#__codelineno-458-1"></a><span class="k">public</span><span class="w"> </span><span class="k">struct</span><span class="w"> </span><span class="nc">Point</span>
</span><span id="__span-458-2"><a id="__codelineno-458-2" name="__codelineno-458-2" href="#__codelineno-458-2"></a><span class="p">{</span>
</span><span id="__span-458-3"><a id="__codelineno-458-3" name="__codelineno-458-3" href="#__codelineno-458-3"></a><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="p">;</span>
</span><span id="__span-458-4"><a id="__codelineno-458-4" name="__codelineno-458-4" href="#__codelineno-458-4"></a><span class="w"> </span><span class="k">public</span><span class="w"> </span><span class="nf">Point</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">y</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">x</span><span class="p">;</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="n">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">y</span><span class="p">;</span><span class="w"> </span><span class="p">}</span>
</span><span id="__span-458-5"><a id="__codelineno-458-5" name="__codelineno-458-5" href="#__codelineno-458-5"></a><span class="p">}</span>
</span></code></pre></div>
<h1 id="access-modifiers">Access Modifiers</h1>
<p>To promote encapsulation, a type or type member may limit its accessibility to other types and other assemblies by adding one of five access modifiers to the declaration.</p>
<ol>
<li><strong>public</strong><ul>
<li>Fully accessible. This is the implicit accessibility for members of an enum or
interface.</li>
</ul>
</li>
<li><strong>internal</strong><ul>
<li>Accessible only within the containing assembly or friend assemblies. This is the
default accessibility for non-nested types.</li>
</ul>
</li>
<li><strong>private</strong><ul>
<li>Accessible only within the containing type. This is the default accessibility for
members of a class or struct.</li>
</ul>
</li>
<li><strong>protected</strong><ul>
<li>Fully accessible. This is the implicit accessibility for members of an enum or
interface.</li>
</ul>
</li>
<li><strong>protected internal</strong><ul>
<li>The union of protected and internal accessibility. Eric Lippert explains it as
follows: Everything is as private as possible by default, and each modifier
makes the thing more accessible. So something that is protected internal is
made more accessible in two ways.</li>
</ul>
</li>
</ol>
<p><strong>Examples</strong></p>
<div class="language-csharp highlight"><pre><span></span><code><span id="__span-459-1"><a id="__codelineno-459-1" name="__codelineno-459-1" href="#__codelineno-459-1"></a><span class="c1">//Class2 is accessible from outside its assembly; Class1 is not:</span>
</span><span id="__span-459-2"><a id="__codelineno-459-2" name="__codelineno-459-2" href="#__codelineno-459-2"></a><span class="k">class</span><span class="w"> </span><span class="nc">Class1</span><span class="w"> </span><span class="p">{}</span><span class="w"> </span><span class="c1">// Class1 is internal (default)</span>
</span><span id="__span-459-3"><a id="__codelineno-459-3" name="__codelineno-459-3" href="#__codelineno-459-3"></a><span class="k">public</span><span class="w"> </span><span class="k">class</span><span class="w"> </span><span class="nc">Class2</span><span class="w"> </span><span class="p">{}</span>
</span></code></pre></div>
<div class="language-csharp highlight"><pre><span></span><code><span id="__span-460-1"><a id="__codelineno-460-1" name="__codelineno-460-1" href="#__codelineno-460-1"></a><span class="c1">//ClassB exposes field x to other types in the same assembly; ClassA does not:</span>
</span><span id="__span-460-2"><a id="__codelineno-460-2" name="__codelineno-460-2" href="#__codelineno-460-2"></a><span class="k">class</span><span class="w"> </span><span class="nc">ClassA</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">x</span><span class="p">;</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="c1">// x is private (default)</span>
</span><span id="__span-460-3"><a id="__codelineno-460-3" name="__codelineno-460-3" href="#__codelineno-460-3"></a><span class="k">class</span><span class="w"> </span><span class="nc">ClassB</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">internal</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">x</span><span class="p">;</span><span class="w"> </span><span class="p">}</span>
</span></code></pre></div>
<div class="language-csharp highlight"><pre><span></span><code><span id="__span-461-1"><a id="__codelineno-461-1" name="__codelineno-461-1" href="#__codelineno-461-1"></a><span class="c1">//Functions within Subclass can call Bar but not Foo</span>
</span><span id="__span-461-2"><a id="__codelineno-461-2" name="__codelineno-461-2" href="#__codelineno-461-2"></a><span class="k">class</span><span class="w"> </span><span class="nc">BaseClass</span>
</span><span id="__span-461-3"><a id="__codelineno-461-3" name="__codelineno-461-3" href="#__codelineno-461-3"></a><span class="p">{</span>
</span><span id="__span-461-4"><a id="__codelineno-461-4" name="__codelineno-461-4" href="#__codelineno-461-4"></a><span class="w"> </span><span class="k">void</span><span class="w"> </span><span class="nf">Foo</span><span class="p">()</span><span class="w"> </span><span class="p">{}</span><span class="w"> </span><span class="c1">// Foo is private (default)</span>
</span><span id="__span-461-5"><a id="__codelineno-461-5" name="__codelineno-461-5" href="#__codelineno-461-5"></a><span class="w"> </span><span class="k">protected</span><span class="w"> </span><span class="k">void</span><span class="w"> </span><span class="nf">Bar</span><span class="p">()</span><span class="w"> </span><span class="p">{}</span>
</span><span id="__span-461-6"><a id="__codelineno-461-6" name="__codelineno-461-6" href="#__codelineno-461-6"></a><span class="p">}</span>
</span><span id="__span-461-7"><a id="__codelineno-461-7" name="__codelineno-461-7" href="#__codelineno-461-7"></a><span class="k">class</span><span class="w"> </span><span class="nc">Subclass</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="n">BaseClass</span>
</span><span id="__span-461-8"><a id="__codelineno-461-8" name="__codelineno-461-8" href="#__codelineno-461-8"></a><span class="p">{</span>
</span><span id="__span-461-9"><a id="__codelineno-461-9" name="__codelineno-461-9" href="#__codelineno-461-9"></a><span class="w"> </span><span class="k">void</span><span class="w"> </span><span class="nf">Test1</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">Foo</span><span class="p">();</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="c1">// Error - cannot access Foo</span>
</span><span id="__span-461-10"><a id="__codelineno-461-10" name="__codelineno-461-10" href="#__codelineno-461-10"></a><span class="w"> </span><span class="k">void</span><span class="w"> </span><span class="nf">Test2</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">Bar</span><span class="p">();</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="c1">// OK</span>
</span><span id="__span-461-11"><a id="__codelineno-461-11" name="__codelineno-461-11" href="#__codelineno-461-11"></a><span class="p">}</span>
</span></code></pre></div>
<h1 id="interfaces">Interfaces</h1>
<p>An interface is similar to a class, but it provides a specification rather than an implementation for its members. An interface is special in the following ways:</p>
<ul>
<li>Interface members are all implicitly abstract. In contrast, a class can provide both abstract members and concrete members with implementations.</li>
<li>A class (or struct) can implement multiple interfaces. In contrast, a class can inherit from only a single class, and a struct cannot inherit at all</li>
</ul>
<p>An interface declaration is like a class declaration, but it provides no implementation for its members, since all its members are implicitly abstract. These members will be implemented by the classes and structs that implement the interface. A</p>
<div class="language-csharp highlight"><pre><span></span><code><span id="__span-462-1"><a id="__codelineno-462-1" name="__codelineno-462-1" href="#__codelineno-462-1"></a><span class="k">public</span><span class="w"> </span><span class="k">interface</span><span class="w"> </span><span class="n">IEnumerator</span>
</span><span id="__span-462-2"><a id="__codelineno-462-2" name="__codelineno-462-2" href="#__codelineno-462-2"></a><span class="p">{</span>
</span><span id="__span-462-3"><a id="__codelineno-462-3" name="__codelineno-462-3" href="#__codelineno-462-3"></a><span class="w"> </span><span class="kt">bool</span><span class="w"> </span><span class="nf">MoveNext</span><span class="p">();</span>
</span><span id="__span-462-4"><a id="__codelineno-462-4" name="__codelineno-462-4" href="#__codelineno-462-4"></a><span class="w"> </span><span class="kt">object</span><span class="w"> </span><span class="n">Current</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">get</span><span class="p">;</span><span class="w"> </span><span class="p">}</span>
</span><span id="__span-462-5"><a id="__codelineno-462-5" name="__codelineno-462-5" href="#__codelineno-462-5"></a><span class="w"> </span><span class="k">void</span><span class="w"> </span><span class="nf">Reset</span><span class="p">();</span>
</span><span id="__span-462-6"><a id="__codelineno-462-6" name="__codelineno-462-6" href="#__codelineno-462-6"></a><span class="p">}</span>
</span><span id="__span-462-7"><a id="__codelineno-462-7" name="__codelineno-462-7" href="#__codelineno-462-7"></a>
</span><span id="__span-462-8"><a id="__codelineno-462-8" name="__codelineno-462-8" href="#__codelineno-462-8"></a><span class="k">internal</span><span class="w"> </span><span class="k">class</span><span class="w"> </span><span class="nc">Countdown</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="n">IEnumerator</span>
</span><span id="__span-462-9"><a id="__codelineno-462-9" name="__codelineno-462-9" href="#__codelineno-462-9"></a><span class="p">{</span>
</span><span id="__span-462-10"><a id="__codelineno-462-10" name="__codelineno-462-10" href="#__codelineno-462-10"></a><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">count</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">11</span><span class="p">;</span>
</span><span id="__span-462-11"><a id="__codelineno-462-11" name="__codelineno-462-11" href="#__codelineno-462-11"></a><span class="w"> </span><span class="k">public</span><span class="w"> </span><span class="kt">bool</span><span class="w"> </span><span class="nf">MoveNext</span><span class="p">()</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="n">count</span><span class="o">--</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
</span><span id="__span-462-12"><a id="__codelineno-462-12" name="__codelineno-462-12" href="#__codelineno-462-12"></a><span class="w"> </span><span class="k">public</span><span class="w"> </span><span class="kt">object</span><span class="w"> </span><span class="n">Current</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="n">count</span><span class="p">;</span>
</span><span id="__span-462-13"><a id="__codelineno-462-13" name="__codelineno-462-13" href="#__codelineno-462-13"></a><span class="w"> </span><span class="k">public</span><span class="w"> </span><span class="k">void</span><span class="w"> </span><span class="nf">Reset</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">throw</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">NotSupportedException</span><span class="p">();</span><span class="w"> </span><span class="p">}</span>
</span><span id="__span-462-14"><a id="__codelineno-462-14" name="__codelineno-462-14" href="#__codelineno-462-14"></a><span class="p">}</span>
</span><span id="__span-462-15"><a id="__codelineno-462-15" name="__codelineno-462-15" href="#__codelineno-462-15"></a>
</span><span id="__span-462-16"><a id="__codelineno-462-16" name="__codelineno-462-16" href="#__codelineno-462-16"></a><span class="n">IEnumerator</span><span class="w"> </span><span class="n">e</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">Countdown</span><span class="p">();</span>
</span><span id="__span-462-17"><a id="__codelineno-462-17" name="__codelineno-462-17" href="#__codelineno-462-17"></a><span class="k">while</span><span class="w"> </span><span class="p">(</span><span class="n">e</span><span class="p">.</span><span class="n">MoveNext</span><span class="p">())</span>
</span><span id="__span-462-18"><a id="__codelineno-462-18" name="__codelineno-462-18" href="#__codelineno-462-18"></a><span class="w"> </span><span class="n">Console</span><span class="p">.</span><span class="n">Write</span><span class="w"> </span><span class="p">(</span><span class="n">e</span><span class="p">.</span><span class="n">Current</span><span class="p">);</span><span class="w"> </span><span class="c1">// 109876543210</span>
</span></code></pre></div>
<h3 id="extending-an-interface">Extending an Interface</h3>
<p>Interfaces may derive from other interfaces.</p>
<div class="language-csharp highlight"><pre><span></span><code><span id="__span-463-1"><a id="__codelineno-463-1" name="__codelineno-463-1" href="#__codelineno-463-1"></a><span class="k">public</span><span class="w"> </span><span class="k">interface</span><span class="w"> </span><span class="n">IUndoable</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">void</span><span class="w"> </span><span class="n">Undo</span><span class="p">();</span><span class="w"> </span><span class="p">}</span>
</span><span id="__span-463-2"><a id="__codelineno-463-2" name="__codelineno-463-2" href="#__codelineno-463-2"></a><span class="k">public</span><span class="w"> </span><span class="k">interface</span><span class="w"> </span><span class="n">IRedoable</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="n">IUndoable</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">void</span><span class="w"> </span><span class="n">Redo</span><span class="p">();</span><span class="w"> </span><span class="p">}</span>
</span><span id="__span-463-3"><a id="__codelineno-463-3" name="__codelineno-463-3" href="#__codelineno-463-3"></a><span class="c1">//IRedoable â€œinheritsâ€ all the members of IUndoable. I</span>
</span></code></pre></div>
<h3 id="explicit-interface-implementation">Explicit Interface Implementation</h3>
<p>Implementing multiple interfaces can sometimes result in a collision between member signatures. You can resolve such collisions by explicitly implementing an interface member.</p>
<div class="language-csharp highlight"><pre><span></span><code><span id="__span-464-1"><a id="__codelineno-464-1" name="__codelineno-464-1" href="#__codelineno-464-1"></a><span class="k">interface</span><span class="w"> </span><span class="n">I1</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">void</span><span class="w"> </span><span class="n">Foo</span><span class="p">();</span><span class="w"> </span><span class="p">}</span>
</span><span id="__span-464-2"><a id="__codelineno-464-2" name="__codelineno-464-2" href="#__codelineno-464-2"></a><span class="k">interface</span><span class="w"> </span><span class="n">I2</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">Foo</span><span class="p">();</span><span class="w"> </span><span class="p">}</span>
</span><span id="__span-464-3"><a id="__codelineno-464-3" name="__codelineno-464-3" href="#__codelineno-464-3"></a><span class="k">public</span><span class="w"> </span><span class="k">class</span><span class="w"> </span><span class="nc">Widget</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="n">I1</span><span class="p">,</span><span class="n">I2</span>
</span><span id="__span-464-4"><a id="__codelineno-464-4" name="__codelineno-464-4" href="#__codelineno-464-4"></a><span class="p">{</span>
</span><span id="__span-464-5"><a id="__codelineno-464-5" name="__codelineno-464-5" href="#__codelineno-464-5"></a><span class="w"> </span><span class="k">public</span><span class="w"> </span><span class="k">void</span><span class="w"> </span><span class="nf">Foo</span><span class="p">()</span>
</span><span id="__span-464-6"><a id="__codelineno-464-6" name="__codelineno-464-6" href="#__codelineno-464-6"></a><span class="w"> </span><span class="p">{</span>
</span><span id="__span-464-7"><a id="__codelineno-464-7" name="__codelineno-464-7" href="#__codelineno-464-7"></a><span class="w"> </span><span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="w"> </span><span class="p">(</span><span class="s">&quot;Widget&#39;s implementation of I1.Foo&quot;</span><span class="p">);</span>
</span><span id="__span-464-8"><a id="__codelineno-464-8" name="__codelineno-464-8" href="#__codelineno-464-8"></a><span class="w"> </span><span class="p">}</span>
</span><span id="__span-464-9"><a id="__codelineno-464-9" name="__codelineno-464-9" href="#__codelineno-464-9"></a><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">I2</span><span class="p">.</span><span class="n">Foo</span><span class="p">()</span>
</span><span id="__span-464-10"><a id="__codelineno-464-10" name="__codelineno-464-10" href="#__codelineno-464-10"></a><span class="w"> </span><span class="p">{</span>
</span><span id="__span-464-11"><a id="__codelineno-464-11" name="__codelineno-464-11" href="#__codelineno-464-11"></a><span class="w"> </span><span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="w"> </span><span class="p">(</span><span class="s">&quot;Widget&#39;s implementation of I2.Foo&quot;</span><span class="p">);</span>
</span><span id="__span-464-12"><a id="__codelineno-464-12" name="__codelineno-464-12" href="#__codelineno-464-12"></a><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="mi">42</span><span class="p">;</span>
</span><span id="__span-464-13"><a id="__codelineno-464-13" name="__codelineno-464-13" href="#__codelineno-464-13"></a><span class="w"> </span><span class="p">}</span>
</span><span id="__span-464-14"><a id="__codelineno-464-14" name="__codelineno-464-14" href="#__codelineno-464-14"></a><span class="p">}</span>
</span></code></pre></div>
<h3 id="reimplementing-an-interface-in-a-subclass">Reimplementing an Interface in a Subclass</h3>
<p>A subclass can reimplement any interface member already implemented by a base class. Reimplementation hijacks a member implementation (when called through the interface) and works whether or not the member is virtual in the base class.</p>
<div class="language-csharp highlight"><pre><span></span><code><span id="__span-465-1"><a id="__codelineno-465-1" name="__codelineno-465-1" href="#__codelineno-465-1"></a><span class="k">public</span><span class="w"> </span><span class="k">interface</span><span class="w"> </span><span class="n">IUndoable</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">void</span><span class="w"> </span><span class="n">Undo</span><span class="p">();</span><span class="w"> </span><span class="p">}</span>
</span><span id="__span-465-2"><a id="__codelineno-465-2" name="__codelineno-465-2" href="#__codelineno-465-2"></a><span class="k">public</span><span class="w"> </span><span class="k">class</span><span class="w"> </span><span class="nc">TextBox</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="n">IUndoable</span>
</span><span id="__span-465-3"><a id="__codelineno-465-3" name="__codelineno-465-3" href="#__codelineno-465-3"></a><span class="p">{</span>
</span><span id="__span-465-4"><a id="__codelineno-465-4" name="__codelineno-465-4" href="#__codelineno-465-4"></a><span class="w"> </span><span class="k">void</span><span class="w"> </span><span class="n">IUndoable</span><span class="p">.</span><span class="n">Undo</span><span class="p">()</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="w"> </span><span class="p">(</span><span class="s">&quot;TextBox.Undo&quot;</span><span class="p">);</span>
</span><span id="__span-465-5"><a id="__codelineno-465-5" name="__codelineno-465-5" href="#__codelineno-465-5"></a><span class="p">}</span>
</span><span id="__span-465-6"><a id="__codelineno-465-6" name="__codelineno-465-6" href="#__codelineno-465-6"></a><span class="k">public</span><span class="w"> </span><span class="k">class</span><span class="w"> </span><span class="nc">RichTextBox</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="n">TextBox</span><span class="p">,</span><span class="w"> </span><span class="n">IUndoable</span>
</span><span id="__span-465-7"><a id="__codelineno-465-7" name="__codelineno-465-7" href="#__codelineno-465-7"></a><span class="p">{</span>
</span><span id="__span-465-8"><a id="__codelineno-465-8" name="__codelineno-465-8" href="#__codelineno-465-8"></a><span class="w"> </span><span class="k">public</span><span class="w"> </span><span class="k">void</span><span class="w"> </span><span class="nf">Undo</span><span class="p">()</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="w"> </span><span class="p">(</span><span class="s">&quot;RichTextBox.Undo&quot;</span><span class="p">);</span>
</span><span id="__span-465-9"><a id="__codelineno-465-9" name="__codelineno-465-9" href="#__codelineno-465-9"></a><span class="p">}</span>
</span><span id="__span-465-10"><a id="__codelineno-465-10" name="__codelineno-465-10" href="#__codelineno-465-10"></a>
</span><span id="__span-465-11"><a id="__codelineno-465-11" name="__codelineno-465-11" href="#__codelineno-465-11"></a><span class="n">RichTextBox</span><span class="w"> </span><span class="n">r</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">RichTextBox</span><span class="p">();</span>
</span><span id="__span-465-12"><a id="__codelineno-465-12" name="__codelineno-465-12" href="#__codelineno-465-12"></a><span class="n">r</span><span class="p">.</span><span class="n">Undo</span><span class="p">();</span><span class="w"> </span><span class="c1">// RichTextBox.Undo Case 1</span>
</span><span id="__span-465-13"><a id="__codelineno-465-13" name="__codelineno-465-13" href="#__codelineno-465-13"></a><span class="p">((</span><span class="n">IUndoable</span><span class="p">)</span><span class="n">r</span><span class="p">).</span><span class="n">Undo</span><span class="p">();</span><span class="w"> </span><span class="c1">// RichTextBox.Undo Case 2</span>
</span></code></pre></div>
<h3 id="writing-a-class-versus-an-interface_1">Writing a Class Versus an Interface</h3>
<p>As a guideline</p>
<ul>
<li>Use classes and subclasses for types that naturally share an implementation</li>
<li>Use interfaces for types that have independent implementations</li>
</ul>
<div class="language-csharp highlight"><pre><span></span><code><span id="__span-466-1"><a id="__codelineno-466-1" name="__codelineno-466-1" href="#__codelineno-466-1"></a><span class="k">abstract</span><span class="w"> </span><span class="k">class</span><span class="w"> </span><span class="nc">Animal</span><span class="w"> </span><span class="p">{}</span>
</span><span id="__span-466-2"><a id="__codelineno-466-2" name="__codelineno-466-2" href="#__codelineno-466-2"></a><span class="k">abstract</span><span class="w"> </span><span class="k">class</span><span class="w"> </span><span class="nc">Bird</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="n">Animal</span><span class="w"> </span><span class="p">{}</span>
</span><span id="__span-466-3"><a id="__codelineno-466-3" name="__codelineno-466-3" href="#__codelineno-466-3"></a><span class="k">abstract</span><span class="w"> </span><span class="k">class</span><span class="w"> </span><span class="nc">Insect</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="n">Animal</span><span class="w"> </span><span class="p">{}</span>
</span><span id="__span-466-4"><a id="__codelineno-466-4" name="__codelineno-466-4" href="#__codelineno-466-4"></a><span class="k">abstract</span><span class="w"> </span><span class="k">class</span><span class="w"> </span><span class="nc">FlyingCreature</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="n">Animal</span><span class="w"> </span><span class="p">{}</span>
</span><span id="__span-466-5"><a id="__codelineno-466-5" name="__codelineno-466-5" href="#__codelineno-466-5"></a><span class="k">abstract</span><span class="w"> </span><span class="k">class</span><span class="w"> </span><span class="nc">Carnivore</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="n">Animal</span><span class="w"> </span><span class="p">{}</span>
</span><span id="__span-466-6"><a id="__codelineno-466-6" name="__codelineno-466-6" href="#__codelineno-466-6"></a>
</span><span id="__span-466-7"><a id="__codelineno-466-7" name="__codelineno-466-7" href="#__codelineno-466-7"></a><span class="c1">// Concrete classes:</span>
</span><span id="__span-466-8"><a id="__codelineno-466-8" name="__codelineno-466-8" href="#__codelineno-466-8"></a><span class="k">class</span><span class="w"> </span><span class="nc">Ostrich</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="n">Bird</span><span class="w"> </span><span class="p">{}</span>
</span><span id="__span-466-9"><a id="__codelineno-466-9" name="__codelineno-466-9" href="#__codelineno-466-9"></a><span class="k">class</span><span class="w"> </span><span class="nc">Eagle</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="n">Bird</span><span class="p">,</span><span class="w"> </span><span class="n">FlyingCreature</span><span class="p">,</span><span class="w"> </span><span class="n">Carnivore</span><span class="w"> </span><span class="p">{}</span><span class="w"> </span><span class="c1">// Illegal</span>
</span><span id="__span-466-10"><a id="__codelineno-466-10" name="__codelineno-466-10" href="#__codelineno-466-10"></a><span class="k">class</span><span class="w"> </span><span class="nc">Bee</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="n">Insect</span><span class="p">,</span><span class="w"> </span><span class="n">FlyingCreature</span><span class="w"> </span><span class="p">{}</span><span class="w"> </span><span class="c1">// Illegal</span>
</span><span id="__span-466-11"><a id="__codelineno-466-11" name="__codelineno-466-11" href="#__codelineno-466-11"></a><span class="k">class</span><span class="w"> </span><span class="nc">Flea</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="n">Insect</span><span class="p">,</span><span class="w"> </span><span class="n">Carnivore</span><span class="w"> </span><span class="p">{}</span><span class="w"> </span><span class="c1">// Illegal</span>
</span></code></pre></div>
<p>The Eagle, Bee, and Flea classes do not compile because inheriting from multiple classes is prohibited. To resolve this, we must convert some of the types to interfaces.</p>
<div class="language-csharp highlight"><pre><span></span><code><span id="__span-467-1"><a id="__codelineno-467-1" name="__codelineno-467-1" href="#__codelineno-467-1"></a><span class="k">abstract</span><span class="w"> </span><span class="k">class</span><span class="w"> </span><span class="nc">Animal</span><span class="w"> </span><span class="p">{}</span>
</span><span id="__span-467-2"><a id="__codelineno-467-2" name="__codelineno-467-2" href="#__codelineno-467-2"></a><span class="k">abstract</span><span class="w"> </span><span class="k">class</span><span class="w"> </span><span class="nc">Bird</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="n">Animal</span><span class="w"> </span><span class="p">{}</span>
</span><span id="__span-467-3"><a id="__codelineno-467-3" name="__codelineno-467-3" href="#__codelineno-467-3"></a><span class="k">abstract</span><span class="w"> </span><span class="k">class</span><span class="w"> </span><span class="nc">Insect</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="n">Animal</span><span class="w"> </span><span class="p">{}</span>
</span><span id="__span-467-4"><a id="__codelineno-467-4" name="__codelineno-467-4" href="#__codelineno-467-4"></a>
</span><span id="__span-467-5"><a id="__codelineno-467-5" name="__codelineno-467-5" href="#__codelineno-467-5"></a><span class="k">interface</span><span class="w"> </span><span class="n">IFlyingCreature</span><span class="w"> </span><span class="p">{}</span>
</span><span id="__span-467-6"><a id="__codelineno-467-6" name="__codelineno-467-6" href="#__codelineno-467-6"></a><span class="k">interface</span><span class="w"> </span><span class="n">ICarnivore</span><span class="w"> </span><span class="p">{}</span>
</span><span id="__span-467-7"><a id="__codelineno-467-7" name="__codelineno-467-7" href="#__codelineno-467-7"></a>
</span><span id="__span-467-8"><a id="__codelineno-467-8" name="__codelineno-467-8" href="#__codelineno-467-8"></a><span class="c1">// Concrete classes:</span>
</span><span id="__span-467-9"><a id="__codelineno-467-9" name="__codelineno-467-9" href="#__codelineno-467-9"></a><span class="k">class</span><span class="w"> </span><span class="nc">Ostrich</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="n">Bird</span><span class="w"> </span><span class="p">{}</span>
</span><span id="__span-467-10"><a id="__codelineno-467-10" name="__codelineno-467-10" href="#__codelineno-467-10"></a><span class="k">class</span><span class="w"> </span><span class="nc">Eagle</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="n">Bird</span><span class="p">,</span><span class="w"> </span><span class="n">IFlyingCreature</span><span class="p">,</span><span class="w"> </span><span class="n">ICarnivore</span><span class="w"> </span><span class="p">{}</span><span class="w"> </span>
</span><span id="__span-467-11"><a id="__codelineno-467-11" name="__codelineno-467-11" href="#__codelineno-467-11"></a><span class="k">class</span><span class="w"> </span><span class="nc">Bee</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="n">Insect</span><span class="p">,</span><span class="w"> </span><span class="n">IFlyingCreature</span><span class="w"> </span><span class="p">{}</span><span class="w">  </span>
</span><span id="__span-467-12"><a id="__codelineno-467-12" name="__codelineno-467-12" href="#__codelineno-467-12"></a><span class="k">class</span><span class="w"> </span><span class="nc">Flea</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="n">Insect</span><span class="p">,</span><span class="w"> </span><span class="n">ICarnivore</span><span class="w"> </span><span class="p">{}</span><span class="w">  </span>
</span></code></pre></div>
<h1 id="enums_1">Enums</h1>
<p>An enum is a special value type that lets you specify a group of named numeric constants.</p>
<div class="language-csharp highlight"><pre><span></span><code><span id="__span-468-1"><a id="__codelineno-468-1" name="__codelineno-468-1" href="#__codelineno-468-1"></a><span class="k">public</span><span class="w"> </span><span class="k">enum</span><span class="w"> </span><span class="n">BorderSide</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">Left</span><span class="p">,</span><span class="w"> </span><span class="n">Right</span><span class="p">,</span><span class="w"> </span><span class="n">Top</span><span class="p">,</span><span class="w"> </span><span class="n">Bottom</span><span class="w"> </span><span class="p">}</span>
</span><span id="__span-468-2"><a id="__codelineno-468-2" name="__codelineno-468-2" href="#__codelineno-468-2"></a>
</span><span id="__span-468-3"><a id="__codelineno-468-3" name="__codelineno-468-3" href="#__codelineno-468-3"></a><span class="c1">//We can use this enum type as follows:</span>
</span><span id="__span-468-4"><a id="__codelineno-468-4" name="__codelineno-468-4" href="#__codelineno-468-4"></a>
</span><span id="__span-468-5"><a id="__codelineno-468-5" name="__codelineno-468-5" href="#__codelineno-468-5"></a><span class="n">BorderSide</span><span class="w"> </span><span class="n">topSide</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">BorderSide</span><span class="p">.</span><span class="n">Top</span><span class="p">;</span>
</span><span id="__span-468-6"><a id="__codelineno-468-6" name="__codelineno-468-6" href="#__codelineno-468-6"></a><span class="kt">bool</span><span class="w"> </span><span class="n">isTop</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">topSide</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">BorderSide</span><span class="p">.</span><span class="n">Top</span><span class="p">);</span><span class="w"> </span><span class="c1">// true</span>
</span></code></pre></div>
<p>Each enum member has an underlying integral value. By default</p>
<ul>
<li>Underlying values are of type int.</li>
<li>The constants 0, 1, 2... are automatically assigned, in the declaration order of the enum members</li>
</ul>
<div class="language-csharp highlight"><pre><span></span><code><span id="__span-469-1"><a id="__codelineno-469-1" name="__codelineno-469-1" href="#__codelineno-469-1"></a><span class="c1">//You may specify an alternative integral type, as follows:</span>
</span><span id="__span-469-2"><a id="__codelineno-469-2" name="__codelineno-469-2" href="#__codelineno-469-2"></a><span class="k">public</span><span class="w"> </span><span class="k">enum</span><span class="w"> </span><span class="n">BorderSide</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="kt">byte</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">Left</span><span class="p">,</span><span class="w"> </span><span class="n">Right</span><span class="p">,</span><span class="w"> </span><span class="n">Top</span><span class="p">,</span><span class="w"> </span><span class="n">Bottom</span><span class="w"> </span><span class="p">}</span>
</span><span id="__span-469-3"><a id="__codelineno-469-3" name="__codelineno-469-3" href="#__codelineno-469-3"></a><span class="c1">//You may also specify an explicit underlying value for each enum member:</span>
</span><span id="__span-469-4"><a id="__codelineno-469-4" name="__codelineno-469-4" href="#__codelineno-469-4"></a><span class="k">public</span><span class="w"> </span><span class="k">enum</span><span class="w"> </span><span class="n">BorderSide</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="kt">byte</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">Left</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">Right</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="n">Top</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span><span class="w"> </span><span class="n">Bottom</span><span class="o">=</span><span class="mi">11</span><span class="w"> </span><span class="p">}</span>
</span></code></pre></div>
<h3 id="enum-conversions">Enum Conversions</h3>
<p>You can convert an enum instance to and from its underlying integral value with an explicit cast</p>
<div class="language-csharp highlight"><pre><span></span><code><span id="__span-470-1"><a id="__codelineno-470-1" name="__codelineno-470-1" href="#__codelineno-470-1"></a><span class="kt">int</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="p">)</span><span class="w"> </span><span class="n">BorderSide</span><span class="p">.</span><span class="n">Left</span><span class="p">;</span>
</span><span id="__span-470-2"><a id="__codelineno-470-2" name="__codelineno-470-2" href="#__codelineno-470-2"></a><span class="n">BorderSide</span><span class="w"> </span><span class="n">side</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">BorderSide</span><span class="p">)</span><span class="w"> </span><span class="n">i</span><span class="p">;</span>
</span><span id="__span-470-3"><a id="__codelineno-470-3" name="__codelineno-470-3" href="#__codelineno-470-3"></a><span class="kt">bool</span><span class="w"> </span><span class="n">leftOrRight</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="p">)</span><span class="w"> </span><span class="n">side</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="mi">2</span><span class="p">;</span>
</span></code></pre></div>
<p>The numeric literal 0 is treated specially by the compiler in an enum expression and
does not require an explicit cast</p>
<div class="language-csharp highlight"><pre><span></span><code><span id="__span-471-1"><a id="__codelineno-471-1" name="__codelineno-471-1" href="#__codelineno-471-1"></a><span class="n">BorderSide</span><span class="w"> </span><span class="n">b</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="c1">// No cast required</span>
</span><span id="__span-471-2"><a id="__codelineno-471-2" name="__codelineno-471-2" href="#__codelineno-471-2"></a><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">b</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="p">...</span>
</span></code></pre></div>
<p>There are two reasons for the special treatment of 0</p>
<ul>
<li>The first member of an enum is often used as the â€œdefaultâ€ value</li>
<li>For combined enum types, 0 means â€œno flags.â€</li>
</ul>
<h3 id="flags-enums">Flags Enums</h3>
<p>You can combine enum members. To prevent ambiguities, members of a combinable enum require explicitly assigned values, typically in powers of two.</p>
<div class="language-csharp highlight"><pre><span></span><code><span id="__span-472-1"><a id="__codelineno-472-1" name="__codelineno-472-1" href="#__codelineno-472-1"></a><span class="na">[Flags]</span>
</span><span id="__span-472-2"><a id="__codelineno-472-2" name="__codelineno-472-2" href="#__codelineno-472-2"></a><span class="k">public</span><span class="w"> </span><span class="k">enum</span><span class="w"> </span><span class="n">BorderSides</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">None</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="n">Left</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">Right</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="n">Top</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span><span class="w"> </span><span class="n">Bottom</span><span class="o">=</span><span class="mi">8</span><span class="w"> </span><span class="p">}</span>
</span></code></pre></div>
<p>To work with combined enum values, you use bitwise operators, such as | and &amp;.</p>
<div class="language-csharp highlight"><pre><span></span><code><span id="__span-473-1"><a id="__codelineno-473-1" name="__codelineno-473-1" href="#__codelineno-473-1"></a><span class="n">BorderSides</span><span class="w"> </span><span class="n">leftRight</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">BorderSides</span><span class="p">.</span><span class="n">Left</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">BorderSides</span><span class="p">.</span><span class="n">Right</span><span class="p">;</span>
</span><span id="__span-473-2"><a id="__codelineno-473-2" name="__codelineno-473-2" href="#__codelineno-473-2"></a>
</span><span id="__span-473-3"><a id="__codelineno-473-3" name="__codelineno-473-3" href="#__codelineno-473-3"></a><span class="k">if</span><span class="w"> </span><span class="p">((</span><span class="n">leftRight</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="n">BorderSides</span><span class="p">.</span><span class="n">Left</span><span class="p">)</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span>
</span><span id="__span-473-4"><a id="__codelineno-473-4" name="__codelineno-473-4" href="#__codelineno-473-4"></a><span class="w"> </span><span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="w"> </span><span class="p">(</span><span class="s">&quot;Includes Left&quot;</span><span class="p">);</span><span class="w"> </span><span class="c1">// Includes Left</span>
</span><span id="__span-473-5"><a id="__codelineno-473-5" name="__codelineno-473-5" href="#__codelineno-473-5"></a>
</span><span id="__span-473-6"><a id="__codelineno-473-6" name="__codelineno-473-6" href="#__codelineno-473-6"></a><span class="kt">string</span><span class="w"> </span><span class="n">formatted</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">leftRight</span><span class="p">.</span><span class="n">ToString</span><span class="p">();</span><span class="w"> </span><span class="c1">// &quot;Left, Right&quot;</span>
</span><span id="__span-473-7"><a id="__codelineno-473-7" name="__codelineno-473-7" href="#__codelineno-473-7"></a><span class="n">BorderSides</span><span class="w"> </span><span class="n">s</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">BorderSides</span><span class="p">.</span><span class="n">Left</span><span class="p">;</span>
</span><span id="__span-473-8"><a id="__codelineno-473-8" name="__codelineno-473-8" href="#__codelineno-473-8"></a><span class="n">s</span><span class="w"> </span><span class="o">|=</span><span class="w"> </span><span class="n">BorderSides</span><span class="p">.</span><span class="n">Right</span><span class="p">;</span>
</span><span id="__span-473-9"><a id="__codelineno-473-9" name="__codelineno-473-9" href="#__codelineno-473-9"></a><span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="w"> </span><span class="p">(</span><span class="n">s</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">leftRight</span><span class="p">);</span><span class="w"> </span><span class="c1">// True</span>
</span><span id="__span-473-10"><a id="__codelineno-473-10" name="__codelineno-473-10" href="#__codelineno-473-10"></a>
</span><span id="__span-473-11"><a id="__codelineno-473-11" name="__codelineno-473-11" href="#__codelineno-473-11"></a><span class="n">s</span><span class="w"> </span><span class="o">^=</span><span class="w"> </span><span class="n">BorderSides</span><span class="p">.</span><span class="n">Right</span><span class="p">;</span><span class="w"> </span><span class="c1">// Toggles BorderSides.Right</span>
</span><span id="__span-473-12"><a id="__codelineno-473-12" name="__codelineno-473-12" href="#__codelineno-473-12"></a><span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="w"> </span><span class="p">(</span><span class="n">s</span><span class="p">);</span><span class="w"> </span><span class="c1">// Left</span>
</span></code></pre></div>
<p>By convention, the Flags attribute should always be applied to an enum type when its members are combinable. If you declare such an enum without the Flags attribute, you can still combine members, but calling ToString on an enum instance will emit a number rather than a series of names.</p>
<p>By convention, a combinable enum type is given a plural rather than singular name.
For convenience, you can include combination members within an enum declaration itself</p>
<div class="language-csharp highlight"><pre><span></span><code><span id="__span-474-1"><a id="__codelineno-474-1" name="__codelineno-474-1" href="#__codelineno-474-1"></a><span class="na">[Flags]</span>
</span><span id="__span-474-2"><a id="__codelineno-474-2" name="__codelineno-474-2" href="#__codelineno-474-2"></a><span class="k">public</span><span class="w"> </span><span class="k">enum</span><span class="w"> </span><span class="n">BorderSides</span>
</span><span id="__span-474-3"><a id="__codelineno-474-3" name="__codelineno-474-3" href="#__codelineno-474-3"></a><span class="p">{</span>
</span><span id="__span-474-4"><a id="__codelineno-474-4" name="__codelineno-474-4" href="#__codelineno-474-4"></a><span class="w"> </span><span class="n">None</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
</span><span id="__span-474-5"><a id="__codelineno-474-5" name="__codelineno-474-5" href="#__codelineno-474-5"></a><span class="w"> </span><span class="n">Left</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">Right</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="n">Top</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span><span class="w"> </span><span class="n">Bottom</span><span class="o">=</span><span class="mi">8</span><span class="p">,</span>
</span><span id="__span-474-6"><a id="__codelineno-474-6" name="__codelineno-474-6" href="#__codelineno-474-6"></a><span class="w"> </span><span class="n">LeftRight</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Left</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">Right</span><span class="p">,</span>
</span><span id="__span-474-7"><a id="__codelineno-474-7" name="__codelineno-474-7" href="#__codelineno-474-7"></a><span class="w"> </span><span class="n">TopBottom</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Top</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">Bottom</span><span class="p">,</span>
</span><span id="__span-474-8"><a id="__codelineno-474-8" name="__codelineno-474-8" href="#__codelineno-474-8"></a><span class="w"> </span><span class="n">All</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">LeftRight</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">TopBottom</span>
</span><span id="__span-474-9"><a id="__codelineno-474-9" name="__codelineno-474-9" href="#__codelineno-474-9"></a><span class="p">}</span>
</span></code></pre></div>
<h1 id="nested-types">Nested Types</h1>
<p>A nested type is declared within the scope of another type.</p>
<div class="language-csharp highlight"><pre><span></span><code><span id="__span-475-1"><a id="__codelineno-475-1" name="__codelineno-475-1" href="#__codelineno-475-1"></a><span class="k">public</span><span class="w"> </span><span class="k">class</span><span class="w"> </span><span class="nc">TopLevel</span>
</span><span id="__span-475-2"><a id="__codelineno-475-2" name="__codelineno-475-2" href="#__codelineno-475-2"></a><span class="p">{</span>
</span><span id="__span-475-3"><a id="__codelineno-475-3" name="__codelineno-475-3" href="#__codelineno-475-3"></a><span class="w"> </span><span class="k">public</span><span class="w"> </span><span class="k">class</span><span class="w"> </span><span class="nc">Nested</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="c1">// Nested class</span>
</span><span id="__span-475-4"><a id="__codelineno-475-4" name="__codelineno-475-4" href="#__codelineno-475-4"></a><span class="w"> </span><span class="k">public</span><span class="w"> </span><span class="k">enum</span><span class="w"> </span><span class="n">Color</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">Red</span><span class="p">,</span><span class="w"> </span><span class="n">Blue</span><span class="p">,</span><span class="w"> </span><span class="n">Tan</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="c1">// Nested enum</span>
</span><span id="__span-475-5"><a id="__codelineno-475-5" name="__codelineno-475-5" href="#__codelineno-475-5"></a><span class="p">}</span>
</span></code></pre></div>
<p>A nested type has the following features</p>
<ul>
<li>It can access the enclosing typeâ€™s private members and everything else the enclosing type can access</li>
<li>It can be declared with the full range of access modifiers, rather than just public and internal.</li>
<li>The default accessibility for a nested type is private rather than internal.</li>
<li>Accessing a nested type from outside the enclosing type requires qualification with the enclosing typeâ€™s name (like when accessing static members).</li>
</ul>
<p>For example, to access <code>Color.Red</code> from outside our <code>TopLevel</code> class</p>
<div class="language-csharp highlight"><pre><span></span><code><span id="__span-476-1"><a id="__codelineno-476-1" name="__codelineno-476-1" href="#__codelineno-476-1"></a><span class="n">TopLevel</span><span class="p">.</span><span class="n">Color</span><span class="w"> </span><span class="n">color</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">TopLevel</span><span class="p">.</span><span class="n">Color</span><span class="p">.</span><span class="n">Red</span><span class="p">;</span>
</span></code></pre></div>
<p>All types (classes, structs, interfaces, delegates, and enums) can be nested inside
either a class or a struct.</p>
<aside>
ðŸ’¡ If the sole reason for using a nested type is to avoid cluttering a namespace with too many types, consider using a nested namespace instead. A nested type should be used because of its stronger access control restrictions, or when the nested class must access private members of the containing class.

</aside>

<h1 id="generics">Generics</h1>
<p>C# has two separate mechanisms for writing code that is reusable across different types: inheritance and generics. Whereas inheritance expresses reusability with a base type, generics express reusability with a template that contains placeholder types.</p>
<h3 id="generic-types">Generic Types</h3>
<p>A generic type declares type parametersâ€”placeholder types to be filled in by the consumer of the generic type, which supplies the type arguments. Here is a generic type Stack , designed to stack instances of type T. Stack declares a single type parameter T.</p>
<div class="language-csharp highlight"><pre><span></span><code><span id="__span-477-1"><a id="__codelineno-477-1" name="__codelineno-477-1" href="#__codelineno-477-1"></a><span class="k">public</span><span class="w"> </span><span class="k">class</span><span class="w"> </span><span class="nc">Stack</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span>
</span><span id="__span-477-2"><a id="__codelineno-477-2" name="__codelineno-477-2" href="#__codelineno-477-2"></a><span class="p">{</span>
</span><span id="__span-477-3"><a id="__codelineno-477-3" name="__codelineno-477-3" href="#__codelineno-477-3"></a><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">position</span><span class="p">;</span>
</span><span id="__span-477-4"><a id="__codelineno-477-4" name="__codelineno-477-4" href="#__codelineno-477-4"></a><span class="w"> </span><span class="n">T</span><span class="p">[]</span><span class="w"> </span><span class="n">data</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">T</span><span class="p">[</span><span class="mi">100</span><span class="p">];</span>
</span><span id="__span-477-5"><a id="__codelineno-477-5" name="__codelineno-477-5" href="#__codelineno-477-5"></a><span class="w"> </span><span class="k">public</span><span class="w"> </span><span class="k">void</span><span class="w"> </span><span class="nf">Push</span><span class="w"> </span><span class="p">(</span><span class="n">T</span><span class="w"> </span><span class="n">obj</span><span class="p">)</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="n">data</span><span class="p">[</span><span class="n">position</span><span class="o">++</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">obj</span><span class="p">;</span>
</span><span id="__span-477-6"><a id="__codelineno-477-6" name="__codelineno-477-6" href="#__codelineno-477-6"></a><span class="w"> </span><span class="k">public</span><span class="w"> </span><span class="n">T</span><span class="w"> </span><span class="nf">Pop</span><span class="p">()</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="n">data</span><span class="p">[</span><span class="o">--</span><span class="n">position</span><span class="p">];</span>
</span><span id="__span-477-7"><a id="__codelineno-477-7" name="__codelineno-477-7" href="#__codelineno-477-7"></a><span class="p">}</span>
</span><span id="__span-477-8"><a id="__codelineno-477-8" name="__codelineno-477-8" href="#__codelineno-477-8"></a>
</span><span id="__span-477-9"><a id="__codelineno-477-9" name="__codelineno-477-9" href="#__codelineno-477-9"></a><span class="kt">var</span><span class="w"> </span><span class="n">stack</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">Stack</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span><span class="p">();</span>
</span><span id="__span-477-10"><a id="__codelineno-477-10" name="__codelineno-477-10" href="#__codelineno-477-10"></a><span class="n">stack</span><span class="p">.</span><span class="n">Push</span><span class="w"> </span><span class="p">(</span><span class="mi">5</span><span class="p">);</span>
</span><span id="__span-477-11"><a id="__codelineno-477-11" name="__codelineno-477-11" href="#__codelineno-477-11"></a><span class="n">stack</span><span class="p">.</span><span class="n">Push</span><span class="w"> </span><span class="p">(</span><span class="mi">10</span><span class="p">);</span>
</span><span id="__span-477-12"><a id="__codelineno-477-12" name="__codelineno-477-12" href="#__codelineno-477-12"></a><span class="kt">int</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">stack</span><span class="p">.</span><span class="n">Pop</span><span class="p">();</span><span class="w"> </span><span class="c1">// x is 10</span>
</span><span id="__span-477-13"><a id="__codelineno-477-13" name="__codelineno-477-13" href="#__codelineno-477-13"></a><span class="kt">int</span><span class="w"> </span><span class="n">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">stack</span><span class="p">.</span><span class="n">Pop</span><span class="p">();</span><span class="w"> </span><span class="c1">// y is 5</span>
</span></code></pre></div>
<p>Stack <int>fills in the type parameter T with the type argument int, implicitly creating a type on the fly (the synthesis occurs at runtime). Attempting to push a string onto our Stack<int> would, however, produce a compile-time error. Stack<int> effectively has the following definition (substitutions appear in bold, with the class name hashed out to avoid confusion):</p>
<div class="language-csharp highlight"><pre><span></span><code><span id="__span-478-1"><a id="__codelineno-478-1" name="__codelineno-478-1" href="#__codelineno-478-1"></a><span class="k">public</span><span class="w"> </span><span class="k">class</span><span class="w"> </span><span class="err">###</span>
</span><span id="__span-478-2"><a id="__codelineno-478-2" name="__codelineno-478-2" href="#__codelineno-478-2"></a><span class="p">{</span>
</span><span id="__span-478-3"><a id="__codelineno-478-3" name="__codelineno-478-3" href="#__codelineno-478-3"></a><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">position</span><span class="p">;</span>
</span><span id="__span-478-4"><a id="__codelineno-478-4" name="__codelineno-478-4" href="#__codelineno-478-4"></a><span class="w"> </span><span class="kt">int</span><span class="p">[]</span><span class="w"> </span><span class="n">data</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="kt">int</span><span class="p">[</span><span class="mi">100</span><span class="p">];</span>
</span><span id="__span-478-5"><a id="__codelineno-478-5" name="__codelineno-478-5" href="#__codelineno-478-5"></a><span class="w"> </span><span class="k">public</span><span class="w"> </span><span class="k">void</span><span class="w"> </span><span class="nf">Push</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">obj</span><span class="p">)</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="n">data</span><span class="p">[</span><span class="n">position</span><span class="o">++</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">obj</span><span class="p">;</span>
</span><span id="__span-478-6"><a id="__codelineno-478-6" name="__codelineno-478-6" href="#__codelineno-478-6"></a><span class="w"> </span><span class="k">public</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="nf">Pop</span><span class="p">()</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="n">data</span><span class="p">[</span><span class="o">--</span><span class="n">position</span><span class="p">];</span>
</span><span id="__span-478-7"><a id="__codelineno-478-7" name="__codelineno-478-7" href="#__codelineno-478-7"></a><span class="p">}</span>
</span></code></pre></div>
<p>Technically, we say that Stack<T> is an open type, whereas Stack<int> is a closed type. At runtime, all generic type instances are closed with the placeholder typesfilled in. This means that the following statement is illegal.</p>
<div class="language-csharp highlight"><pre><span></span><code><span id="__span-479-1"><a id="__codelineno-479-1" name="__codelineno-479-1" href="#__codelineno-479-1"></a><span class="kt">var</span><span class="w"> </span><span class="n">stack</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">Stack</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span><span class="p">();</span><span class="w"> </span><span class="c1">// Illegal: What is T?</span>
</span></code></pre></div>
<h3 id="why-generics-exist">Why Generics Exist</h3>
<p>Generics exist to write code that is reusable across different types. Suppose that we needed a stack of integers, but we didnâ€™t have generic types. One solution would be to hardcode a separate version of the class for every required element type (e.g., IntStack, StringStack, etc.). Clearly, this would cause considerable code duplication. Another solution would be to write a stack that is generalized by using object as the element type:</p>
<div class="language-csharp highlight"><pre><span></span><code><span id="__span-480-1"><a id="__codelineno-480-1" name="__codelineno-480-1" href="#__codelineno-480-1"></a><span class="k">public</span><span class="w"> </span><span class="k">class</span><span class="w"> </span><span class="nc">ObjectStack</span>
</span><span id="__span-480-2"><a id="__codelineno-480-2" name="__codelineno-480-2" href="#__codelineno-480-2"></a><span class="p">{</span>
</span><span id="__span-480-3"><a id="__codelineno-480-3" name="__codelineno-480-3" href="#__codelineno-480-3"></a><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">position</span><span class="p">;</span>
</span><span id="__span-480-4"><a id="__codelineno-480-4" name="__codelineno-480-4" href="#__codelineno-480-4"></a><span class="w"> </span><span class="kt">object</span><span class="p">[]</span><span class="w"> </span><span class="n">data</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="kt">object</span><span class="p">[</span><span class="mi">10</span><span class="p">];</span>
</span><span id="__span-480-5"><a id="__codelineno-480-5" name="__codelineno-480-5" href="#__codelineno-480-5"></a><span class="w"> </span><span class="k">public</span><span class="w"> </span><span class="k">void</span><span class="w"> </span><span class="nf">Push</span><span class="w"> </span><span class="p">(</span><span class="kt">object</span><span class="w"> </span><span class="n">obj</span><span class="p">)</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="n">data</span><span class="p">[</span><span class="n">position</span><span class="o">++</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">obj</span><span class="p">;</span>
</span><span id="__span-480-6"><a id="__codelineno-480-6" name="__codelineno-480-6" href="#__codelineno-480-6"></a><span class="w"> </span><span class="k">public</span><span class="w"> </span><span class="kt">object</span><span class="w"> </span><span class="nf">Pop</span><span class="p">()</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="n">data</span><span class="p">[</span><span class="o">--</span><span class="n">position</span><span class="p">];</span>
</span><span id="__span-480-7"><a id="__codelineno-480-7" name="__codelineno-480-7" href="#__codelineno-480-7"></a><span class="p">}</span>
</span></code></pre></div>
<p>An ObjectStack, however, wouldnâ€™t work as well as a hardcoded IntStack for specifically stacking integers. An ObjectStack would require boxing and downcasting that could not be checked at compile time.</p>
<div class="language-csharp highlight"><pre><span></span><code><span id="__span-481-1"><a id="__codelineno-481-1" name="__codelineno-481-1" href="#__codelineno-481-1"></a><span class="c1">// Suppose we just want to store integers here:</span>
</span><span id="__span-481-2"><a id="__codelineno-481-2" name="__codelineno-481-2" href="#__codelineno-481-2"></a><span class="n">ObjectStack</span><span class="w"> </span><span class="n">stack</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">ObjectStack</span><span class="p">();</span>
</span><span id="__span-481-3"><a id="__codelineno-481-3" name="__codelineno-481-3" href="#__codelineno-481-3"></a><span class="n">stack</span><span class="p">.</span><span class="n">Push</span><span class="w"> </span><span class="p">(</span><span class="s">&quot;s&quot;</span><span class="p">);</span><span class="w"> </span><span class="c1">// Wrong type, but no error!</span>
</span><span id="__span-481-4"><a id="__codelineno-481-4" name="__codelineno-481-4" href="#__codelineno-481-4"></a><span class="kt">int</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="p">)</span><span class="n">stack</span><span class="p">.</span><span class="n">Pop</span><span class="p">();</span><span class="w"> </span><span class="c1">// Downcast - runtime error</span>
</span></code></pre></div>
<p>What we need is both a general implementation of a stack that works for all element types as well as a way to easily specialize that stack to a specific element type for increased type safety and reduced casting and boxing. Generics give us precisely this by allowing us to parameterize the element type.</p>
<p><strong>Stack<T> has the benefits of both ObjectStack and IntStack. Like ObjectStack, Stack<T> is written once to work generally across all types. Like IntStack, Stack<T> is specialized for a particular type the beauty is that this type is T, which we substitute on the fly.</strong></p>
<h3 id="generic-methods">Generic Methods</h3>
<p>A generic method declares type parameters within the signature of a method.</p>
<p>With generic methods, many fundamental algorithms can be implemented in a general-purpose way. Here is a generic method that swaps the contents of two variables of any type T.</p>
<div class="language-csharp highlight"><pre><span></span><code><span id="__span-482-1"><a id="__codelineno-482-1" name="__codelineno-482-1" href="#__codelineno-482-1"></a><span class="k">static</span><span class="w"> </span><span class="k">void</span><span class="w"> </span><span class="n">Swap</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span><span class="w"> </span><span class="p">(</span><span class="k">ref</span><span class="w"> </span><span class="n">T</span><span class="w"> </span><span class="n">a</span><span class="p">,</span><span class="w"> </span><span class="k">ref</span><span class="w"> </span><span class="n">T</span><span class="w"> </span><span class="n">b</span><span class="p">)</span>
</span><span id="__span-482-2"><a id="__codelineno-482-2" name="__codelineno-482-2" href="#__codelineno-482-2"></a><span class="p">{</span>
</span><span id="__span-482-3"><a id="__codelineno-482-3" name="__codelineno-482-3" href="#__codelineno-482-3"></a><span class="w">        </span><span class="n">T</span><span class="w"> </span><span class="n">temp</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">a</span><span class="p">;</span>
</span><span id="__span-482-4"><a id="__codelineno-482-4" name="__codelineno-482-4" href="#__codelineno-482-4"></a><span class="w">         </span><span class="n">a</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">b</span><span class="p">;</span>
</span><span id="__span-482-5"><a id="__codelineno-482-5" name="__codelineno-482-5" href="#__codelineno-482-5"></a><span class="w">         </span><span class="n">b</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">temp</span><span class="p">;</span>
</span><span id="__span-482-6"><a id="__codelineno-482-6" name="__codelineno-482-6" href="#__codelineno-482-6"></a><span class="p">}</span>
</span><span id="__span-482-7"><a id="__codelineno-482-7" name="__codelineno-482-7" href="#__codelineno-482-7"></a><span class="c1">//Swap&lt;T&gt; is called as follows:</span>
</span><span id="__span-482-8"><a id="__codelineno-482-8" name="__codelineno-482-8" href="#__codelineno-482-8"></a><span class="kt">int</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">5</span><span class="p">;</span>
</span><span id="__span-482-9"><a id="__codelineno-482-9" name="__codelineno-482-9" href="#__codelineno-482-9"></a><span class="kt">int</span><span class="w"> </span><span class="n">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">10</span><span class="p">;</span>
</span><span id="__span-482-10"><a id="__codelineno-482-10" name="__codelineno-482-10" href="#__codelineno-482-10"></a><span class="n">Swap</span><span class="w"> </span><span class="p">(</span><span class="k">ref</span><span class="w"> </span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="k">ref</span><span class="w"> </span><span class="n">y</span><span class="p">);</span>
</span></code></pre></div>
<p>Generally, there is no need to supply type arguments to a generic method, because
the compiler can implicitly infer the type. If there is ambiguity, generic methods can
be called with type arguments as follows</p>
<div class="language-csharp highlight"><pre><span></span><code><span id="__span-483-1"><a id="__codelineno-483-1" name="__codelineno-483-1" href="#__codelineno-483-1"></a><span class="n">Swap</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span><span class="w"> </span><span class="p">(</span><span class="k">ref</span><span class="w"> </span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="k">ref</span><span class="w"> </span><span class="n">y</span><span class="p">);</span>
</span></code></pre></div>
<h3 id="declaring-type-parameters">Declaring Type Parameters</h3>
<p>Type parameters can be introduced in the declaration of classes, structs, interfaces, delegates , and methods. Other constructs, such as properties, cannot introduce a type parameter, but they can use one. For example, the property Value uses T:</p>
<div class="language-csharp highlight"><pre><span></span><code><span id="__span-484-1"><a id="__codelineno-484-1" name="__codelineno-484-1" href="#__codelineno-484-1"></a><span class="k">public</span><span class="w"> </span><span class="k">struct</span><span class="w"> </span><span class="nc">Nullable</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span>
</span><span id="__span-484-2"><a id="__codelineno-484-2" name="__codelineno-484-2" href="#__codelineno-484-2"></a><span class="p">{</span>
</span><span id="__span-484-3"><a id="__codelineno-484-3" name="__codelineno-484-3" href="#__codelineno-484-3"></a><span class="w"> </span><span class="k">public</span><span class="w"> </span><span class="n">T</span><span class="w"> </span><span class="n">Value</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">get</span><span class="p">;</span><span class="w"> </span><span class="p">}</span>
</span><span id="__span-484-4"><a id="__codelineno-484-4" name="__codelineno-484-4" href="#__codelineno-484-4"></a><span class="p">}</span>
</span></code></pre></div>
<p>Generic type names and method names can be overloaded as long as the number of type parameters is different. For example, the following three type names do not conflict</p>
<div class="language-csharp highlight"><pre><span></span><code><span id="__span-485-1"><a id="__codelineno-485-1" name="__codelineno-485-1" href="#__codelineno-485-1"></a><span class="k">class</span><span class="w"> </span><span class="nc">A</span><span class="w"> </span><span class="p">{}</span>
</span><span id="__span-485-2"><a id="__codelineno-485-2" name="__codelineno-485-2" href="#__codelineno-485-2"></a><span class="k">class</span><span class="w"> </span><span class="nc">A</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span><span class="w"> </span><span class="p">{}</span>
</span><span id="__span-485-3"><a id="__codelineno-485-3" name="__codelineno-485-3" href="#__codelineno-485-3"></a><span class="k">class</span><span class="w"> </span><span class="nc">A</span><span class="o">&lt;</span><span class="n">T1</span><span class="p">,</span><span class="n">T2</span><span class="o">&gt;</span><span class="w"> </span><span class="p">{}</span>
</span></code></pre></div>
<h3 id="the-default-generic-value">The default Generic Value</h3>
<p>You can use the <code>default</code> keyword to get the default value for a generic type parameter. The default value for a reference type is <code>null</code>, and the default value for a value type is the result of bitwise-zeroing the value typeâ€™s fields:</p>
<div class="language-csharp highlight"><pre><span></span><code><span id="__span-486-1"><a id="__codelineno-486-1" name="__codelineno-486-1" href="#__codelineno-486-1"></a><span class="k">static</span><span class="w"> </span><span class="k">void</span><span class="w"> </span><span class="n">Zap</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span><span class="w"> </span><span class="p">(</span><span class="n">T</span><span class="p">[]</span><span class="w"> </span><span class="n">array</span><span class="p">)</span>
</span><span id="__span-486-2"><a id="__codelineno-486-2" name="__codelineno-486-2" href="#__codelineno-486-2"></a><span class="p">{</span>
</span><span id="__span-486-3"><a id="__codelineno-486-3" name="__codelineno-486-3" href="#__codelineno-486-3"></a><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">array</span><span class="p">.</span><span class="n">Length</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="o">++</span><span class="p">)</span>
</span><span id="__span-486-4"><a id="__codelineno-486-4" name="__codelineno-486-4" href="#__codelineno-486-4"></a><span class="w"> </span><span class="n">array</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">default</span><span class="p">(</span><span class="n">T</span><span class="p">);</span>
</span><span id="__span-486-5"><a id="__codelineno-486-5" name="__codelineno-486-5" href="#__codelineno-486-5"></a><span class="p">}</span>
</span></code></pre></div>
<h3 id="generic-constraints">Generic Constraints</h3>
<p>By default, you can substitute a type parameter with any type whatsoever. Constraints can be applied to a type parameter to require more specific type arguments.
These are the possible constraints:</p>
<div class="language-csharp highlight"><pre><span></span><code><span id="__span-487-1"><a id="__codelineno-487-1" name="__codelineno-487-1" href="#__codelineno-487-1"></a><span class="k">where</span><span class="w"> </span><span class="n">T</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="k">base</span><span class="o">-</span><span class="k">class</span><span class="w"> </span><span class="c1">// Base-class constraint</span>
</span><span id="__span-487-2"><a id="__codelineno-487-2" name="__codelineno-487-2" href="#__codelineno-487-2"></a><span class="k">where</span><span class="w"> </span><span class="n">T</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="k">interface</span><span class="w"> </span><span class="c1">// Interface constraint</span>
</span><span id="__span-487-3"><a id="__codelineno-487-3" name="__codelineno-487-3" href="#__codelineno-487-3"></a><span class="k">where</span><span class="w"> </span><span class="n">T</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="k">class</span><span class="w"> </span><span class="c1">// Reference-type constraint</span>
</span><span id="__span-487-4"><a id="__codelineno-487-4" name="__codelineno-487-4" href="#__codelineno-487-4"></a><span class="k">where</span><span class="w"> </span><span class="n">T</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="n">class</span><span class="o">?</span><span class="w"> </span><span class="c1">// (See &quot;Nullable reference types&quot;)</span>
</span><span id="__span-487-5"><a id="__codelineno-487-5" name="__codelineno-487-5" href="#__codelineno-487-5"></a><span class="k">where</span><span class="w"> </span><span class="n">T</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="k">struct</span><span class="w"> </span><span class="c1">// Value-type constraint (excludes Nullable types)</span>
</span><span id="__span-487-6"><a id="__codelineno-487-6" name="__codelineno-487-6" href="#__codelineno-487-6"></a><span class="k">where</span><span class="w"> </span><span class="n">T</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="k">unmanaged</span><span class="w"> </span><span class="c1">// Unmanaged constraint</span>
</span><span id="__span-487-7"><a id="__codelineno-487-7" name="__codelineno-487-7" href="#__codelineno-487-7"></a><span class="k">where</span><span class="w"> </span><span class="n">T</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="k">new</span><span class="p">()</span><span class="w"> </span><span class="c1">// Parameterless constructor constraint</span>
</span><span id="__span-487-8"><a id="__codelineno-487-8" name="__codelineno-487-8" href="#__codelineno-487-8"></a><span class="k">where</span><span class="w"> </span><span class="n">U</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="n">T</span><span class="w"> </span><span class="c1">// Naked type constraint</span>
</span><span id="__span-487-9"><a id="__codelineno-487-9" name="__codelineno-487-9" href="#__codelineno-487-9"></a><span class="k">where</span><span class="w"> </span><span class="n">T</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="k">notnull</span><span class="w"> </span><span class="c1">// Non-nullable value type, or from C# 8</span>
</span><span id="__span-487-10"><a id="__codelineno-487-10" name="__codelineno-487-10" href="#__codelineno-487-10"></a><span class="w"> </span><span class="c1">// a non-nullable reference type.</span>
</span></code></pre></div>
<div class="language-csharp highlight"><pre><span></span><code><span id="__span-488-1"><a id="__codelineno-488-1" name="__codelineno-488-1" href="#__codelineno-488-1"></a><span class="k">class</span><span class="w"> </span><span class="nc">SomeClass</span><span class="w"> </span><span class="p">{}</span>
</span><span id="__span-488-2"><a id="__codelineno-488-2" name="__codelineno-488-2" href="#__codelineno-488-2"></a><span class="k">interface</span><span class="w"> </span><span class="n">Interface1</span><span class="w"> </span><span class="p">{}</span>
</span><span id="__span-488-3"><a id="__codelineno-488-3" name="__codelineno-488-3" href="#__codelineno-488-3"></a><span class="k">class</span><span class="w"> </span><span class="nc">GenericClass</span><span class="o">&lt;</span><span class="n">T</span><span class="p">,</span><span class="n">U</span><span class="o">&gt;</span><span class="w"> </span><span class="k">where</span><span class="w"> </span><span class="n">T</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="n">SomeClass</span><span class="p">,</span><span class="w"> </span><span class="n">Interface1</span>
</span><span id="__span-488-4"><a id="__codelineno-488-4" name="__codelineno-488-4" href="#__codelineno-488-4"></a><span class="w"> </span><span class="k">where</span><span class="w"> </span><span class="n">U</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="k">new</span><span class="p">()</span>
</span><span id="__span-488-5"><a id="__codelineno-488-5" name="__codelineno-488-5" href="#__codelineno-488-5"></a><span class="p">{...}</span>
</span></code></pre></div>
<h3 id="subclassing-generic-types">Subclassing Generic Types</h3>
<p>A generic class can be subclassed just like a nongeneric class. The subclass can leave
the base classâ€™s type parameters open, as in the following example:</p>
<div class="language-csharp highlight"><pre><span></span><code><span id="__span-489-1"><a id="__codelineno-489-1" name="__codelineno-489-1" href="#__codelineno-489-1"></a><span class="k">class</span><span class="w"> </span><span class="nc">Stack</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span><span class="w"> </span><span class="p">{...}</span>
</span><span id="__span-489-2"><a id="__codelineno-489-2" name="__codelineno-489-2" href="#__codelineno-489-2"></a><span class="k">class</span><span class="w"> </span><span class="nc">SpecialStack</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="n">Stack</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span><span class="w"> </span><span class="p">{...}</span>
</span></code></pre></div>
<p>the subclass can close the generic type parameters with a concrete type:</p>
<div class="language-csharp highlight"><pre><span></span><code><span id="__span-490-1"><a id="__codelineno-490-1" name="__codelineno-490-1" href="#__codelineno-490-1"></a><span class="k">class</span><span class="w"> </span><span class="nc">IntStack</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="n">Stack</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span><span class="w"> </span><span class="p">{...}</span>
</span></code></pre></div>
<p>A subtype can also introduce fresh type arguments</p>
<div class="language-csharp highlight"><pre><span></span><code><span id="__span-491-1"><a id="__codelineno-491-1" name="__codelineno-491-1" href="#__codelineno-491-1"></a><span class="k">class</span><span class="w"> </span><span class="nc">List</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span><span class="w"> </span><span class="p">{...}</span>
</span><span id="__span-491-2"><a id="__codelineno-491-2" name="__codelineno-491-2" href="#__codelineno-491-2"></a><span class="k">class</span><span class="w"> </span><span class="nc">KeyedList</span><span class="o">&lt;</span><span class="n">T</span><span class="p">,</span><span class="n">TKey</span><span class="o">&gt;</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="n">List</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span><span class="w"> </span><span class="p">{...}</span>
</span></code></pre></div>
<h3 id="static-data">Static Data</h3>
<p>Static data is unique for each closed type</p>
<div class="language-csharp highlight"><pre><span></span><code><span id="__span-492-1"><a id="__codelineno-492-1" name="__codelineno-492-1" href="#__codelineno-492-1"></a><span class="k">class</span><span class="w"> </span><span class="nc">Bob</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">public</span><span class="w"> </span><span class="k">static</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">Count</span><span class="p">;</span><span class="w"> </span><span class="p">}</span>
</span><span id="__span-492-2"><a id="__codelineno-492-2" name="__codelineno-492-2" href="#__codelineno-492-2"></a><span class="k">class</span><span class="w"> </span><span class="nc">Test</span>
</span><span id="__span-492-3"><a id="__codelineno-492-3" name="__codelineno-492-3" href="#__codelineno-492-3"></a><span class="p">{</span>
</span><span id="__span-492-4"><a id="__codelineno-492-4" name="__codelineno-492-4" href="#__codelineno-492-4"></a><span class="w"> </span><span class="k">static</span><span class="w"> </span><span class="k">void</span><span class="w"> </span><span class="nf">Main</span><span class="p">()</span>
</span><span id="__span-492-5"><a id="__codelineno-492-5" name="__codelineno-492-5" href="#__codelineno-492-5"></a><span class="w"> </span><span class="p">{</span>
</span><span id="__span-492-6"><a id="__codelineno-492-6" name="__codelineno-492-6" href="#__codelineno-492-6"></a><span class="w"> </span><span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="w"> </span><span class="p">(</span><span class="o">++</span><span class="n">Bob</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span><span class="p">.</span><span class="n">Count</span><span class="p">);</span><span class="w"> </span><span class="c1">// 1</span>
</span><span id="__span-492-7"><a id="__codelineno-492-7" name="__codelineno-492-7" href="#__codelineno-492-7"></a><span class="w"> </span><span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="w"> </span><span class="p">(</span><span class="o">++</span><span class="n">Bob</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span><span class="p">.</span><span class="n">Count</span><span class="p">);</span><span class="w"> </span><span class="c1">// 2</span>
</span><span id="__span-492-8"><a id="__codelineno-492-8" name="__codelineno-492-8" href="#__codelineno-492-8"></a><span class="w"> </span><span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="w"> </span><span class="p">(</span><span class="o">++</span><span class="n">Bob</span><span class="o">&lt;</span><span class="kt">string</span><span class="o">&gt;</span><span class="p">.</span><span class="n">Count</span><span class="p">);</span><span class="w"> </span><span class="c1">// 1</span>
</span><span id="__span-492-9"><a id="__codelineno-492-9" name="__codelineno-492-9" href="#__codelineno-492-9"></a><span class="w"> </span><span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="w"> </span><span class="p">(</span><span class="o">++</span><span class="n">Bob</span><span class="o">&lt;</span><span class="kt">object</span><span class="o">&gt;</span><span class="p">.</span><span class="n">Count</span><span class="p">);</span><span class="w"> </span><span class="c1">// 1</span>
</span><span id="__span-492-10"><a id="__codelineno-492-10" name="__codelineno-492-10" href="#__codelineno-492-10"></a><span class="w"> </span><span class="p">}</span>
</span><span id="__span-492-11"><a id="__codelineno-492-11" name="__codelineno-492-11" href="#__codelineno-492-11"></a><span class="p">}</span>
</span><span id="__span-492-12"><a id="__codelineno-492-12" name="__codelineno-492-12" href="#__codelineno-492-12"></a><span class="err">```#</span><span class="w"> </span><span class="n">Chapter</span><span class="w"> </span><span class="mi">4</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="n">Advanced</span><span class="w"> </span><span class="n">C</span><span class="err">#</span>
</span><span id="__span-492-13"><a id="__codelineno-492-13" name="__codelineno-492-13" href="#__codelineno-492-13"></a>
</span><span id="__span-492-14"><a id="__codelineno-492-14" name="__codelineno-492-14" href="#__codelineno-492-14"></a><span class="n">ce</span><span class="w"> </span><span class="n">conversion</span><span class="w"> </span><span class="n">will</span><span class="w"> </span><span class="n">succeed</span><span class="p">:</span>
</span><span id="__span-492-15"><a id="__codelineno-492-15" name="__codelineno-492-15" href="#__codelineno-492-15"></a><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">obj</span><span class="w"> </span><span class="k">is</span><span class="w"> </span><span class="kt">string</span><span class="p">)</span><span class="w"> </span><span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="w"> </span><span class="p">(((</span><span class="kt">string</span><span class="p">)</span><span class="n">obj</span><span class="p">).</span><span class="n">Length</span><span class="p">);</span>
</span><span id="__span-492-16"><a id="__codelineno-492-16" name="__codelineno-492-16" href="#__codelineno-492-16"></a>
</span><span id="__span-492-17"><a id="__codelineno-492-17" name="__codelineno-492-17" href="#__codelineno-492-17"></a><span class="err">##</span><span class="w"> </span><span class="n">Delegates</span>
</span><span id="__span-492-18"><a id="__codelineno-492-18" name="__codelineno-492-18" href="#__codelineno-492-18"></a>
</span><span id="__span-492-19"><a id="__codelineno-492-19" name="__codelineno-492-19" href="#__codelineno-492-19"></a><span class="err">###</span><span class="w"> </span><span class="n">Overview</span>
</span><span id="__span-492-20"><a id="__codelineno-492-20" name="__codelineno-492-20" href="#__codelineno-492-20"></a>
</span><span id="__span-492-21"><a id="__codelineno-492-21" name="__codelineno-492-21" href="#__codelineno-492-21"></a><span class="n">A</span><span class="w"> </span><span class="k">delegate</span><span class="w"> </span><span class="k">is</span><span class="w"> </span><span class="n">an</span><span class="w"> </span><span class="kt">object</span><span class="w"> </span><span class="n">that</span><span class="w"> </span><span class="n">knows</span><span class="w"> </span><span class="n">how</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">call</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">method</span><span class="p">.</span>
</span><span id="__span-492-22"><a id="__codelineno-492-22" name="__codelineno-492-22" href="#__codelineno-492-22"></a>
</span><span id="__span-492-23"><a id="__codelineno-492-23" name="__codelineno-492-23" href="#__codelineno-492-23"></a><span class="o">&lt;</span><span class="n">aside</span><span class="o">&gt;</span>
</span><span id="__span-492-24"><a id="__codelineno-492-24" name="__codelineno-492-24" href="#__codelineno-492-24"></a><span class="err">ðŸ“–</span><span class="w"> </span><span class="n">Delegate</span><span class="w"> </span><span class="n">mean</span><span class="w"> </span><span class="n">entrust</span><span class="w"> </span><span class="p">(</span><span class="n">a</span><span class="w"> </span><span class="n">task</span><span class="w"> </span><span class="k">or</span><span class="w"> </span><span class="n">responsibility</span><span class="p">)</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">another</span><span class="w"> </span><span class="n">person</span><span class="w"> </span><span class="k">or</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">person</span><span class="w"> </span><span class="n">sent</span><span class="w"> </span><span class="k">or</span><span class="w"> </span><span class="n">authorized</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">represent</span><span class="w"> </span><span class="n">others</span>
</span><span id="__span-492-25"><a id="__codelineno-492-25" name="__codelineno-492-25" href="#__codelineno-492-25"></a>
</span><span id="__span-492-26"><a id="__codelineno-492-26" name="__codelineno-492-26" href="#__codelineno-492-26"></a><span class="o">&lt;/</span><span class="n">aside</span><span class="o">&gt;</span>
</span><span id="__span-492-27"><a id="__codelineno-492-27" name="__codelineno-492-27" href="#__codelineno-492-27"></a>
</span><span id="__span-492-28"><a id="__codelineno-492-28" name="__codelineno-492-28" href="#__codelineno-492-28"></a><span class="n">A</span><span class="w"> </span><span class="k">delegate</span><span class="w"> </span><span class="n">type</span><span class="w"> </span><span class="n">defines</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">kind</span><span class="w"> </span><span class="n">of</span><span class="w"> </span><span class="n">method</span><span class="w"> </span><span class="n">that</span><span class="w"> </span><span class="k">delegate</span><span class="w"> </span><span class="n">instances</span><span class="w"> </span><span class="n">can</span><span class="w"> </span><span class="n">call</span><span class="p">.</span><span class="w"> </span><span class="n">Specifically</span><span class="p">,</span><span class="w"> </span><span class="n">it</span><span class="w"> </span><span class="n">defines</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">method</span><span class="err">â€™</span><span class="n">s</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="n">type</span><span class="w"> </span><span class="k">and</span><span class="w"> </span><span class="n">its</span><span class="w"> </span><span class="n">parameter</span><span class="w"> </span><span class="n">types</span><span class="p">.</span><span class="w"> </span><span class="n">The</span><span class="w"> </span><span class="n">following</span><span class="w"> </span><span class="n">defines</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="k">delegate</span><span class="w"> </span><span class="n">type</span><span class="w"> </span><span class="n">called</span><span class="w"> </span><span class="o">**</span><span class="n">Transformer</span><span class="o">**</span><span class="p">:</span>
</span><span id="__span-492-29"><a id="__codelineno-492-29" name="__codelineno-492-29" href="#__codelineno-492-29"></a>
</span><span id="__span-492-30"><a id="__codelineno-492-30" name="__codelineno-492-30" href="#__codelineno-492-30"></a><span class="err">```</span><span class="n">csharp</span>
</span><span id="__span-492-31"><a id="__codelineno-492-31" name="__codelineno-492-31" href="#__codelineno-492-31"></a><span class="k">delegate</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="nf">Transformer</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">x</span><span class="p">);</span>
</span></code></pre></div>
<p>Transformer is compatible with any method with an int return type and a single int parameter, such as this:</p>
<div class="language-csharp highlight"><pre><span></span><code><span id="__span-493-1"><a id="__codelineno-493-1" name="__codelineno-493-1" href="#__codelineno-493-1"></a><span class="k">static</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="nf">Square</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">x</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">x</span><span class="p">;</span><span class="w"> </span><span class="p">}</span>
</span></code></pre></div>
<p>Assigning a method to a delegate variable creates a delegate instance</p>
<div class="language-csharp highlight"><pre><span></span><code><span id="__span-494-1"><a id="__codelineno-494-1" name="__codelineno-494-1" href="#__codelineno-494-1"></a><span class="n">Transformer</span><span class="w"> </span><span class="n">t</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Square</span><span class="p">;</span>
</span></code></pre></div>
<p>which can be invoked in the same way as a method:</p>
<div class="language-csharp highlight"><pre><span></span><code><span id="__span-495-1"><a id="__codelineno-495-1" name="__codelineno-495-1" href="#__codelineno-495-1"></a><span class="kt">int</span><span class="w"> </span><span class="n">answer</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">t</span><span class="p">(</span><span class="mi">3</span><span class="p">);</span><span class="w"> </span><span class="c1">// answer is 9</span>
</span></code></pre></div>
<h3 id="example"><strong>Example</strong></h3>
<div class="language-csharp highlight"><pre><span></span><code><span id="__span-496-1"><a id="__codelineno-496-1" name="__codelineno-496-1" href="#__codelineno-496-1"></a><span class="k">delegate</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="nf">Transformer</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">x</span><span class="p">);</span>
</span><span id="__span-496-2"><a id="__codelineno-496-2" name="__codelineno-496-2" href="#__codelineno-496-2"></a><span class="k">class</span><span class="w"> </span><span class="nc">Test</span>
</span><span id="__span-496-3"><a id="__codelineno-496-3" name="__codelineno-496-3" href="#__codelineno-496-3"></a><span class="p">{</span>
</span><span id="__span-496-4"><a id="__codelineno-496-4" name="__codelineno-496-4" href="#__codelineno-496-4"></a><span class="w"> </span><span class="k">static</span><span class="w"> </span><span class="k">void</span><span class="w"> </span><span class="nf">Main</span><span class="p">()</span>
</span><span id="__span-496-5"><a id="__codelineno-496-5" name="__codelineno-496-5" href="#__codelineno-496-5"></a><span class="w">  </span><span class="p">{</span>
</span><span id="__span-496-6"><a id="__codelineno-496-6" name="__codelineno-496-6" href="#__codelineno-496-6"></a><span class="w"> </span><span class="n">Transformer</span><span class="w"> </span><span class="n">t</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Square</span><span class="p">;</span><span class="w"> </span><span class="c1">// Create delegate instance</span>
</span><span id="__span-496-7"><a id="__codelineno-496-7" name="__codelineno-496-7" href="#__codelineno-496-7"></a><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">result</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">t</span><span class="p">(</span><span class="mi">3</span><span class="p">);</span><span class="w"> </span><span class="c1">// Invoke delegate</span>
</span><span id="__span-496-8"><a id="__codelineno-496-8" name="__codelineno-496-8" href="#__codelineno-496-8"></a><span class="w"> </span><span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="w"> </span><span class="p">(</span><span class="n">result</span><span class="p">);</span><span class="w"> </span><span class="c1">// 9</span>
</span><span id="__span-496-9"><a id="__codelineno-496-9" name="__codelineno-496-9" href="#__codelineno-496-9"></a><span class="w"> </span><span class="p">}</span>
</span><span id="__span-496-10"><a id="__codelineno-496-10" name="__codelineno-496-10" href="#__codelineno-496-10"></a><span class="w"> </span><span class="k">static</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="nf">Square</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">x</span><span class="p">)</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">x</span><span class="p">;</span>
</span><span id="__span-496-11"><a id="__codelineno-496-11" name="__codelineno-496-11" href="#__codelineno-496-11"></a><span class="p">}</span>
</span></code></pre></div>
<p>A delegate instance literally acts as a delegate for the caller: the caller invokes the delegate, and then the delegate calls the target method. This indirection decouples the caller from the target method.</p>
<p>The statement<code>Transformer t = Square;</code>is shorthand for:<code>Transformer t = new Transformer (Square);</code></p>
<blockquote>
<p>Technically, we are specifying a method group when we refer to Square without brackets or arguments. If the method is overloaded, C# will pick the correct overload based on the signature of the delegate to which itâ€™s being assigned.
</p>
</blockquote>
<p>The expression: <code>t(3)</code> is shorthand for: <code>t.Invoke(3)</code></p>
<h3 id="writing-plug-in-methods-with-delegates">Writing Plug-in Methods with Delegates</h3>
<p>A delegate variable is assigned a method at runtime. This is useful for writing plugin methods. In this example, we have a utility method named Transform that applies a transform to each element in an integer array. The Transform method has a delegate parameter, for specifying a plug-in transform.</p>
<div class="language-csharp highlight"><pre><span></span><code><span id="__span-497-1"><a id="__codelineno-497-1" name="__codelineno-497-1" href="#__codelineno-497-1"></a><span class="k">public</span><span class="w"> </span><span class="k">delegate</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="nf">Transformer</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">x</span><span class="p">);</span>
</span><span id="__span-497-2"><a id="__codelineno-497-2" name="__codelineno-497-2" href="#__codelineno-497-2"></a><span class="k">class</span><span class="w"> </span><span class="nc">Util</span>
</span><span id="__span-497-3"><a id="__codelineno-497-3" name="__codelineno-497-3" href="#__codelineno-497-3"></a><span class="p">{</span>
</span><span id="__span-497-4"><a id="__codelineno-497-4" name="__codelineno-497-4" href="#__codelineno-497-4"></a><span class="w"> </span><span class="k">public</span><span class="w"> </span><span class="k">static</span><span class="w"> </span><span class="k">void</span><span class="w"> </span><span class="nf">Transform</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="p">[]</span><span class="w"> </span><span class="n">values</span><span class="p">,</span><span class="w"> </span><span class="n">Transformer</span><span class="w"> </span><span class="n">t</span><span class="p">)</span>
</span><span id="__span-497-5"><a id="__codelineno-497-5" name="__codelineno-497-5" href="#__codelineno-497-5"></a><span class="w"> </span><span class="p">{</span>
</span><span id="__span-497-6"><a id="__codelineno-497-6" name="__codelineno-497-6" href="#__codelineno-497-6"></a><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">values</span><span class="p">.</span><span class="n">Length</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="o">++</span><span class="p">)</span>
</span><span id="__span-497-7"><a id="__codelineno-497-7" name="__codelineno-497-7" href="#__codelineno-497-7"></a><span class="w"> </span><span class="n">values</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">t</span><span class="w"> </span><span class="p">(</span><span class="n">values</span><span class="p">[</span><span class="n">i</span><span class="p">]);</span>
</span><span id="__span-497-8"><a id="__codelineno-497-8" name="__codelineno-497-8" href="#__codelineno-497-8"></a><span class="w"> </span><span class="p">}</span>
</span><span id="__span-497-9"><a id="__codelineno-497-9" name="__codelineno-497-9" href="#__codelineno-497-9"></a><span class="p">}</span>
</span><span id="__span-497-10"><a id="__codelineno-497-10" name="__codelineno-497-10" href="#__codelineno-497-10"></a><span class="k">class</span><span class="w"> </span><span class="nc">Test</span>
</span><span id="__span-497-11"><a id="__codelineno-497-11" name="__codelineno-497-11" href="#__codelineno-497-11"></a><span class="p">{</span>
</span><span id="__span-497-12"><a id="__codelineno-497-12" name="__codelineno-497-12" href="#__codelineno-497-12"></a><span class="w"> </span><span class="k">static</span><span class="w"> </span><span class="k">void</span><span class="w"> </span><span class="nf">Main</span><span class="p">()</span>
</span><span id="__span-497-13"><a id="__codelineno-497-13" name="__codelineno-497-13" href="#__codelineno-497-13"></a><span class="w"> </span><span class="p">{</span>
</span><span id="__span-497-14"><a id="__codelineno-497-14" name="__codelineno-497-14" href="#__codelineno-497-14"></a><span class="w"> </span><span class="kt">int</span><span class="p">[]</span><span class="w"> </span><span class="n">values</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="mi">3</span><span class="w"> </span><span class="p">};</span>
</span><span id="__span-497-15"><a id="__codelineno-497-15" name="__codelineno-497-15" href="#__codelineno-497-15"></a><span class="w"> </span><span class="n">Util</span><span class="p">.</span><span class="n">Transform</span><span class="w"> </span><span class="p">(</span><span class="n">values</span><span class="p">,</span><span class="w"> </span><span class="n">Square</span><span class="p">);</span><span class="w"> </span><span class="c1">// Hook in the Square method</span>
</span><span id="__span-497-16"><a id="__codelineno-497-16" name="__codelineno-497-16" href="#__codelineno-497-16"></a><span class="w"> </span><span class="k">foreach</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">values</span><span class="p">)</span>
</span><span id="__span-497-17"><a id="__codelineno-497-17" name="__codelineno-497-17" href="#__codelineno-497-17"></a><span class="w"> </span><span class="n">Console</span><span class="p">.</span><span class="n">Write</span><span class="w"> </span><span class="p">(</span><span class="n">i</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s">&quot; &quot;</span><span class="p">);</span><span class="w"> </span><span class="c1">// 1 4 9</span>
</span><span id="__span-497-18"><a id="__codelineno-497-18" name="__codelineno-497-18" href="#__codelineno-497-18"></a><span class="w"> </span><span class="p">}</span>
</span><span id="__span-497-19"><a id="__codelineno-497-19" name="__codelineno-497-19" href="#__codelineno-497-19"></a><span class="w"> </span><span class="k">static</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="nf">Square</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">x</span><span class="p">)</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">x</span><span class="p">;</span>
</span><span id="__span-497-20"><a id="__codelineno-497-20" name="__codelineno-497-20" href="#__codelineno-497-20"></a><span class="p">}</span>
</span></code></pre></div>
<p>Our Transform method is a higher-order function, because itâ€™s a function that takes a function as an argument. (A method that returns a delegate would also be a higher-order function.)</p>
<h3 id="multicast-delegates">Multicast Delegates</h3>
<p>All delegate instances have multicast capability. This means that a delegate instance can reference not just a single target method, but also a list of target methods. The + and += operators combine delegate instances. For example:</p>
<div class="language-csharp highlight"><pre><span></span><code><span id="__span-498-1"><a id="__codelineno-498-1" name="__codelineno-498-1" href="#__codelineno-498-1"></a><span class="n">SomeDelegate</span><span class="w"> </span><span class="n">d</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">SomeMethod1</span><span class="p">;</span>
</span><span id="__span-498-2"><a id="__codelineno-498-2" name="__codelineno-498-2" href="#__codelineno-498-2"></a><span class="n">d</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="n">SomeMethod2</span><span class="p">;</span>
</span></code></pre></div>
<p>The last line is functionally the same as:</p>
<div class="language-csharp highlight"><pre><span></span><code><span id="__span-499-1"><a id="__codelineno-499-1" name="__codelineno-499-1" href="#__codelineno-499-1"></a><span class="n">d</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">d</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">SomeMethod2</span><span class="p">;</span>
</span></code></pre></div>
<p>Invoking d will now call both SomeMethod1 and SomeMethod2. Delegates are invoked in the order they are added.</p>
<p>The - and -= operators remove the right delegate operand from the left delegate operand. For example:</p>
<div class="language-csharp highlight"><pre><span></span><code><span id="__span-500-1"><a id="__codelineno-500-1" name="__codelineno-500-1" href="#__codelineno-500-1"></a><span class="n">d</span><span class="w"> </span><span class="o">-=</span><span class="w"> </span><span class="n">SomeMethod1</span><span class="p">;</span>
</span></code></pre></div>
<p>Invoking d will now cause only SomeMethod2 to be invoked.</p>
<h3 id="multicast-delegate-example">Multicast delegate example</h3>
<p>Suppose you wrote a method that took a long time to execute. That method could regularly report progress to its caller by invoking a delegate. In this example, the HardWork method has a ProgressReporter delegate parameter, which it invokes to indicate progress:</p>
<div class="language-csharp highlight"><pre><span></span><code><span id="__span-501-1"><a id="__codelineno-501-1" name="__codelineno-501-1" href="#__codelineno-501-1"></a><span class="k">public</span><span class="w"> </span><span class="k">delegate</span><span class="w"> </span><span class="k">void</span><span class="w"> </span><span class="nf">ProgressReporter</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">percentComplete</span><span class="p">);</span>
</span><span id="__span-501-2"><a id="__codelineno-501-2" name="__codelineno-501-2" href="#__codelineno-501-2"></a><span class="k">public</span><span class="w"> </span><span class="k">class</span><span class="w"> </span><span class="nc">Util</span>
</span><span id="__span-501-3"><a id="__codelineno-501-3" name="__codelineno-501-3" href="#__codelineno-501-3"></a><span class="p">{</span>
</span><span id="__span-501-4"><a id="__codelineno-501-4" name="__codelineno-501-4" href="#__codelineno-501-4"></a><span class="w"> </span><span class="k">public</span><span class="w"> </span><span class="k">static</span><span class="w"> </span><span class="k">void</span><span class="w"> </span><span class="nf">HardWork</span><span class="w"> </span><span class="p">(</span><span class="n">ProgressReporter</span><span class="w"> </span><span class="n">p</span><span class="p">)</span>
</span><span id="__span-501-5"><a id="__codelineno-501-5" name="__codelineno-501-5" href="#__codelineno-501-5"></a><span class="w"> </span><span class="p">{</span>
</span><span id="__span-501-6"><a id="__codelineno-501-6" name="__codelineno-501-6" href="#__codelineno-501-6"></a><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mi">10</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="o">++</span><span class="p">)</span>
</span><span id="__span-501-7"><a id="__codelineno-501-7" name="__codelineno-501-7" href="#__codelineno-501-7"></a><span class="w"> </span><span class="p">{</span>
</span><span id="__span-501-8"><a id="__codelineno-501-8" name="__codelineno-501-8" href="#__codelineno-501-8"></a><span class="w"> </span><span class="n">p</span><span class="w"> </span><span class="p">(</span><span class="n">i</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mi">10</span><span class="p">);</span><span class="w"> </span><span class="c1">// Invoke delegate</span>
</span><span id="__span-501-9"><a id="__codelineno-501-9" name="__codelineno-501-9" href="#__codelineno-501-9"></a><span class="w"> </span><span class="n">System</span><span class="p">.</span><span class="n">Threading</span><span class="p">.</span><span class="n">Thread</span><span class="p">.</span><span class="n">Sleep</span><span class="w"> </span><span class="p">(</span><span class="mi">100</span><span class="p">);</span><span class="w"> </span><span class="c1">// Simulate hard work</span>
</span><span id="__span-501-10"><a id="__codelineno-501-10" name="__codelineno-501-10" href="#__codelineno-501-10"></a><span class="w"> </span><span class="p">}</span>
</span><span id="__span-501-11"><a id="__codelineno-501-11" name="__codelineno-501-11" href="#__codelineno-501-11"></a><span class="w"> </span><span class="p">}</span>
</span><span id="__span-501-12"><a id="__codelineno-501-12" name="__codelineno-501-12" href="#__codelineno-501-12"></a><span class="p">}</span>
</span><span id="__span-501-13"><a id="__codelineno-501-13" name="__codelineno-501-13" href="#__codelineno-501-13"></a><span class="k">class</span><span class="w"> </span><span class="nc">Test</span>
</span><span id="__span-501-14"><a id="__codelineno-501-14" name="__codelineno-501-14" href="#__codelineno-501-14"></a><span class="p">{</span>
</span><span id="__span-501-15"><a id="__codelineno-501-15" name="__codelineno-501-15" href="#__codelineno-501-15"></a><span class="w"> </span><span class="k">static</span><span class="w"> </span><span class="k">void</span><span class="w"> </span><span class="nf">Main</span><span class="p">()</span>
</span><span id="__span-501-16"><a id="__codelineno-501-16" name="__codelineno-501-16" href="#__codelineno-501-16"></a><span class="w"> </span><span class="p">{</span>
</span><span id="__span-501-17"><a id="__codelineno-501-17" name="__codelineno-501-17" href="#__codelineno-501-17"></a><span class="w"> </span><span class="n">ProgressReporter</span><span class="w"> </span><span class="n">p</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">WriteProgressToConsole</span><span class="p">;</span>
</span><span id="__span-501-18"><a id="__codelineno-501-18" name="__codelineno-501-18" href="#__codelineno-501-18"></a><span class="w"> </span><span class="n">p</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="n">WriteProgressToFile</span><span class="p">;</span>
</span><span id="__span-501-19"><a id="__codelineno-501-19" name="__codelineno-501-19" href="#__codelineno-501-19"></a><span class="w"> </span><span class="n">Util</span><span class="p">.</span><span class="n">HardWork</span><span class="w"> </span><span class="p">(</span><span class="n">p</span><span class="p">);</span>
</span><span id="__span-501-20"><a id="__codelineno-501-20" name="__codelineno-501-20" href="#__codelineno-501-20"></a><span class="w"> </span><span class="p">}</span>
</span><span id="__span-501-21"><a id="__codelineno-501-21" name="__codelineno-501-21" href="#__codelineno-501-21"></a><span class="w"> </span><span class="k">static</span><span class="w"> </span><span class="k">void</span><span class="w"> </span><span class="nf">WriteProgressToConsole</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">percentComplete</span><span class="p">)</span>
</span><span id="__span-501-22"><a id="__codelineno-501-22" name="__codelineno-501-22" href="#__codelineno-501-22"></a><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="w"> </span><span class="p">(</span><span class="n">percentComplete</span><span class="p">);</span>
</span><span id="__span-501-23"><a id="__codelineno-501-23" name="__codelineno-501-23" href="#__codelineno-501-23"></a><span class="w"> </span><span class="k">static</span><span class="w"> </span><span class="k">void</span><span class="w"> </span><span class="nf">WriteProgressToFile</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">percentComplete</span><span class="p">)</span>
</span><span id="__span-501-24"><a id="__codelineno-501-24" name="__codelineno-501-24" href="#__codelineno-501-24"></a><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="n">System</span><span class="p">.</span><span class="n">IO</span><span class="p">.</span><span class="n">File</span><span class="p">.</span><span class="n">WriteAllText</span><span class="w"> </span><span class="p">(</span><span class="s">&quot;progress.txt&quot;</span><span class="p">,</span>
</span><span id="__span-501-25"><a id="__codelineno-501-25" name="__codelineno-501-25" href="#__codelineno-501-25"></a><span class="w"> </span><span class="n">percentComplete</span><span class="p">.</span><span class="n">ToString</span><span class="p">());</span>
</span><span id="__span-501-26"><a id="__codelineno-501-26" name="__codelineno-501-26" href="#__codelineno-501-26"></a><span class="p">}</span>
</span></code></pre></div>
<h3 id="generic-delegate-types">Generic Delegate Types</h3>
<p>A delegate type can contain generic type parameters</p>
<div class="language-csharp highlight"><pre><span></span><code><span id="__span-502-1"><a id="__codelineno-502-1" name="__codelineno-502-1" href="#__codelineno-502-1"></a><span class="k">public</span><span class="w"> </span><span class="k">delegate</span><span class="w"> </span><span class="n">T</span><span class="w"> </span><span class="n">Transformer</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span><span class="w"> </span><span class="p">(</span><span class="n">T</span><span class="w"> </span><span class="n">arg</span><span class="p">);</span>
</span><span id="__span-502-2"><a id="__codelineno-502-2" name="__codelineno-502-2" href="#__codelineno-502-2"></a><span class="k">public</span><span class="w"> </span><span class="k">class</span><span class="w"> </span><span class="nc">Util</span>
</span><span id="__span-502-3"><a id="__codelineno-502-3" name="__codelineno-502-3" href="#__codelineno-502-3"></a><span class="p">{</span>
</span><span id="__span-502-4"><a id="__codelineno-502-4" name="__codelineno-502-4" href="#__codelineno-502-4"></a><span class="w"> </span><span class="k">public</span><span class="w"> </span><span class="k">static</span><span class="w"> </span><span class="k">void</span><span class="w"> </span><span class="n">Transform</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span><span class="w"> </span><span class="p">(</span><span class="n">T</span><span class="p">[]</span><span class="w"> </span><span class="n">values</span><span class="p">,</span><span class="w"> </span><span class="n">Transformer</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span><span class="w"> </span><span class="n">t</span><span class="p">)</span>
</span><span id="__span-502-5"><a id="__codelineno-502-5" name="__codelineno-502-5" href="#__codelineno-502-5"></a><span class="w"> </span><span class="p">{</span>
</span><span id="__span-502-6"><a id="__codelineno-502-6" name="__codelineno-502-6" href="#__codelineno-502-6"></a><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">values</span><span class="p">.</span><span class="n">Length</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="o">++</span><span class="p">)</span>
</span><span id="__span-502-7"><a id="__codelineno-502-7" name="__codelineno-502-7" href="#__codelineno-502-7"></a><span class="w"> </span><span class="n">values</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">t</span><span class="w"> </span><span class="p">(</span><span class="n">values</span><span class="p">[</span><span class="n">i</span><span class="p">]);</span>
</span><span id="__span-502-8"><a id="__codelineno-502-8" name="__codelineno-502-8" href="#__codelineno-502-8"></a><span class="w"> </span><span class="p">}</span>
</span><span id="__span-502-9"><a id="__codelineno-502-9" name="__codelineno-502-9" href="#__codelineno-502-9"></a><span class="p">}</span>
</span><span id="__span-502-10"><a id="__codelineno-502-10" name="__codelineno-502-10" href="#__codelineno-502-10"></a><span class="k">class</span><span class="w"> </span><span class="nc">Test</span>
</span><span id="__span-502-11"><a id="__codelineno-502-11" name="__codelineno-502-11" href="#__codelineno-502-11"></a><span class="p">{</span>
</span><span id="__span-502-12"><a id="__codelineno-502-12" name="__codelineno-502-12" href="#__codelineno-502-12"></a><span class="w"> </span><span class="k">static</span><span class="w"> </span><span class="k">void</span><span class="w"> </span><span class="nf">Main</span><span class="p">()</span>
</span><span id="__span-502-13"><a id="__codelineno-502-13" name="__codelineno-502-13" href="#__codelineno-502-13"></a><span class="w"> </span><span class="p">{</span>
</span><span id="__span-502-14"><a id="__codelineno-502-14" name="__codelineno-502-14" href="#__codelineno-502-14"></a><span class="w"> </span><span class="kt">int</span><span class="p">[]</span><span class="w"> </span><span class="n">values</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="mi">3</span><span class="w"> </span><span class="p">};</span>
</span><span id="__span-502-15"><a id="__codelineno-502-15" name="__codelineno-502-15" href="#__codelineno-502-15"></a><span class="w"> </span><span class="n">Util</span><span class="p">.</span><span class="n">Transform</span><span class="w"> </span><span class="p">(</span><span class="n">values</span><span class="p">,</span><span class="w"> </span><span class="n">Square</span><span class="p">);</span><span class="w"> </span><span class="c1">// Hook in Square</span>
</span><span id="__span-502-16"><a id="__codelineno-502-16" name="__codelineno-502-16" href="#__codelineno-502-16"></a><span class="w"> </span><span class="k">foreach</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">values</span><span class="p">)</span>
</span><span id="__span-502-17"><a id="__codelineno-502-17" name="__codelineno-502-17" href="#__codelineno-502-17"></a><span class="w"> </span><span class="n">Console</span><span class="p">.</span><span class="n">Write</span><span class="w"> </span><span class="p">(</span><span class="n">i</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s">&quot; &quot;</span><span class="p">);</span><span class="w"> </span><span class="c1">// 1 4 9</span>
</span><span id="__span-502-18"><a id="__codelineno-502-18" name="__codelineno-502-18" href="#__codelineno-502-18"></a><span class="w"> </span><span class="p">}</span>
</span><span id="__span-502-19"><a id="__codelineno-502-19" name="__codelineno-502-19" href="#__codelineno-502-19"></a><span class="w"> </span><span class="k">static</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="nf">Square</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">x</span><span class="p">)</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">x</span><span class="p">;</span>
</span><span id="__span-502-20"><a id="__codelineno-502-20" name="__codelineno-502-20" href="#__codelineno-502-20"></a><span class="p">}</span>
</span></code></pre></div>
<h3 id="the-func-and-action-delegates">The Func and Action Delegates</h3>
<p>With generic delegates, it becomes possible to write a small set of delegate types that
are so general they can work for methods of any return type and any (reasonable)
number of arguments. These delegates are the Func and Action delegates, defined in
the System namespace (the in and out annotations indicate variance, which we
cover in the context of delegates shortly):</p>
<div class="language-csharp highlight"><pre><span></span><code><span id="__span-503-1"><a id="__codelineno-503-1" name="__codelineno-503-1" href="#__codelineno-503-1"></a><span class="k">delegate</span><span class="w"> </span><span class="n">TResult</span><span class="w"> </span><span class="n">Func</span><span class="w"> </span><span class="o">&lt;</span><span class="k">out</span><span class="w"> </span><span class="n">TResult</span><span class="o">&gt;</span><span class="w"> </span><span class="p">();</span>
</span><span id="__span-503-2"><a id="__codelineno-503-2" name="__codelineno-503-2" href="#__codelineno-503-2"></a><span class="k">delegate</span><span class="w"> </span><span class="n">TResult</span><span class="w"> </span><span class="n">Func</span><span class="w"> </span><span class="o">&lt;</span><span class="k">in</span><span class="w"> </span><span class="n">T</span><span class="p">,</span><span class="w"> </span><span class="k">out</span><span class="w"> </span><span class="n">TResult</span><span class="o">&gt;</span><span class="w"> </span><span class="p">(</span><span class="n">T</span><span class="w"> </span><span class="n">arg</span><span class="p">);</span>
</span><span id="__span-503-3"><a id="__codelineno-503-3" name="__codelineno-503-3" href="#__codelineno-503-3"></a><span class="k">delegate</span><span class="w"> </span><span class="n">TResult</span><span class="w"> </span><span class="n">Func</span><span class="w"> </span><span class="o">&lt;</span><span class="k">in</span><span class="w"> </span><span class="n">T1</span><span class="p">,</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">T2</span><span class="p">,</span><span class="w"> </span><span class="k">out</span><span class="w"> </span><span class="n">TResult</span><span class="o">&gt;</span><span class="w"> </span><span class="p">(</span><span class="n">T1</span><span class="w"> </span><span class="n">arg1</span><span class="p">,</span><span class="w"> </span><span class="n">T2</span><span class="w"> </span><span class="n">arg2</span><span class="p">);</span>
</span><span id="__span-503-4"><a id="__codelineno-503-4" name="__codelineno-503-4" href="#__codelineno-503-4"></a><span class="p">...</span><span class="w"> </span><span class="k">and</span><span class="w"> </span><span class="n">so</span><span class="w"> </span><span class="k">on</span><span class="p">,</span><span class="w"> </span><span class="n">up</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">T16</span>
</span><span id="__span-503-5"><a id="__codelineno-503-5" name="__codelineno-503-5" href="#__codelineno-503-5"></a><span class="k">delegate</span><span class="w"> </span><span class="k">void</span><span class="w"> </span><span class="nf">Action</span><span class="w"> </span><span class="p">();</span>
</span><span id="__span-503-6"><a id="__codelineno-503-6" name="__codelineno-503-6" href="#__codelineno-503-6"></a><span class="k">delegate</span><span class="w"> </span><span class="k">void</span><span class="w"> </span><span class="n">Action</span><span class="w"> </span><span class="o">&lt;</span><span class="k">in</span><span class="w"> </span><span class="n">T</span><span class="o">&gt;</span><span class="w"> </span><span class="p">(</span><span class="n">T</span><span class="w"> </span><span class="n">arg</span><span class="p">);</span>
</span><span id="__span-503-7"><a id="__codelineno-503-7" name="__codelineno-503-7" href="#__codelineno-503-7"></a><span class="k">delegate</span><span class="w"> </span><span class="k">void</span><span class="w"> </span><span class="n">Action</span><span class="w"> </span><span class="o">&lt;</span><span class="k">in</span><span class="w"> </span><span class="n">T1</span><span class="p">,</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">T2</span><span class="o">&gt;</span><span class="w"> </span><span class="p">(</span><span class="n">T1</span><span class="w"> </span><span class="n">arg1</span><span class="p">,</span><span class="w"> </span><span class="n">T2</span><span class="w"> </span><span class="n">arg2</span><span class="p">);</span>
</span><span id="__span-503-8"><a id="__codelineno-503-8" name="__codelineno-503-8" href="#__codelineno-503-8"></a><span class="p">...</span><span class="w"> </span><span class="k">and</span><span class="w"> </span><span class="n">so</span><span class="w"> </span><span class="k">on</span><span class="p">,</span><span class="w"> </span><span class="n">up</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">T16</span>
</span><span id="__span-503-9"><a id="__codelineno-503-9" name="__codelineno-503-9" href="#__codelineno-503-9"></a>
</span><span id="__span-503-10"><a id="__codelineno-503-10" name="__codelineno-503-10" href="#__codelineno-503-10"></a><span class="k">public</span><span class="w"> </span><span class="k">static</span><span class="w"> </span><span class="k">void</span><span class="w"> </span><span class="n">Transform</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span><span class="w"> </span><span class="p">(</span><span class="n">T</span><span class="p">[]</span><span class="w"> </span><span class="n">values</span><span class="p">,</span><span class="w"> </span><span class="n">Func</span><span class="o">&lt;</span><span class="n">T</span><span class="p">,</span><span class="n">T</span><span class="o">&gt;</span><span class="w"> </span><span class="n">transformer</span><span class="p">)</span>
</span><span id="__span-503-11"><a id="__codelineno-503-11" name="__codelineno-503-11" href="#__codelineno-503-11"></a><span class="p">{</span>
</span><span id="__span-503-12"><a id="__codelineno-503-12" name="__codelineno-503-12" href="#__codelineno-503-12"></a><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">values</span><span class="p">.</span><span class="n">Length</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="o">++</span><span class="p">)</span>
</span><span id="__span-503-13"><a id="__codelineno-503-13" name="__codelineno-503-13" href="#__codelineno-503-13"></a><span class="w"> </span><span class="n">values</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">transformer</span><span class="w"> </span><span class="p">(</span><span class="n">values</span><span class="p">[</span><span class="n">i</span><span class="p">]);</span>
</span><span id="__span-503-14"><a id="__codelineno-503-14" name="__codelineno-503-14" href="#__codelineno-503-14"></a><span class="p">}</span>
</span></code></pre></div>
<h3 id="delegates-versus-interfaces">Delegates Versus Interfaces</h3>
<p>A problem that can be solved with a delegate can also be solved with an interface. For instance, we can rewrite our original example with an interface called ITrans former instead of a delegate:</p>
<div class="language-csharp highlight"><pre><span></span><code><span id="__span-504-1"><a id="__codelineno-504-1" name="__codelineno-504-1" href="#__codelineno-504-1"></a><span class="k">public</span><span class="w"> </span><span class="k">interface</span><span class="w"> </span><span class="n">ITransformer</span>
</span><span id="__span-504-2"><a id="__codelineno-504-2" name="__codelineno-504-2" href="#__codelineno-504-2"></a><span class="p">{</span>
</span><span id="__span-504-3"><a id="__codelineno-504-3" name="__codelineno-504-3" href="#__codelineno-504-3"></a><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="nf">Transform</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">x</span><span class="p">);</span>
</span><span id="__span-504-4"><a id="__codelineno-504-4" name="__codelineno-504-4" href="#__codelineno-504-4"></a><span class="p">}</span>
</span><span id="__span-504-5"><a id="__codelineno-504-5" name="__codelineno-504-5" href="#__codelineno-504-5"></a><span class="k">public</span><span class="w"> </span><span class="k">class</span><span class="w"> </span><span class="nc">Util</span>
</span><span id="__span-504-6"><a id="__codelineno-504-6" name="__codelineno-504-6" href="#__codelineno-504-6"></a><span class="p">{</span>
</span><span id="__span-504-7"><a id="__codelineno-504-7" name="__codelineno-504-7" href="#__codelineno-504-7"></a><span class="w"> </span><span class="k">public</span><span class="w"> </span><span class="k">static</span><span class="w"> </span><span class="k">void</span><span class="w"> </span><span class="nf">TransformAll</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="p">[]</span><span class="w"> </span><span class="n">values</span><span class="p">,</span><span class="w"> </span><span class="n">ITransformer</span><span class="w"> </span><span class="n">t</span><span class="p">)</span>
</span><span id="__span-504-8"><a id="__codelineno-504-8" name="__codelineno-504-8" href="#__codelineno-504-8"></a><span class="w"> </span><span class="p">{</span>
</span><span id="__span-504-9"><a id="__codelineno-504-9" name="__codelineno-504-9" href="#__codelineno-504-9"></a><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">values</span><span class="p">.</span><span class="n">Length</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="o">++</span><span class="p">)</span>
</span><span id="__span-504-10"><a id="__codelineno-504-10" name="__codelineno-504-10" href="#__codelineno-504-10"></a><span class="w"> </span><span class="n">values</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">t</span><span class="p">.</span><span class="n">Transform</span><span class="w"> </span><span class="p">(</span><span class="n">values</span><span class="p">[</span><span class="n">i</span><span class="p">]);</span>
</span><span id="__span-504-11"><a id="__codelineno-504-11" name="__codelineno-504-11" href="#__codelineno-504-11"></a><span class="w"> </span><span class="p">}</span>
</span><span id="__span-504-12"><a id="__codelineno-504-12" name="__codelineno-504-12" href="#__codelineno-504-12"></a><span class="w"> </span><span class="p">}</span>
</span><span id="__span-504-13"><a id="__codelineno-504-13" name="__codelineno-504-13" href="#__codelineno-504-13"></a><span class="k">class</span><span class="w"> </span><span class="nc">Squarer</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="n">ITransformer</span>
</span><span id="__span-504-14"><a id="__codelineno-504-14" name="__codelineno-504-14" href="#__codelineno-504-14"></a><span class="p">{</span>
</span><span id="__span-504-15"><a id="__codelineno-504-15" name="__codelineno-504-15" href="#__codelineno-504-15"></a><span class="w"> </span><span class="k">public</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="nf">Transform</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">x</span><span class="p">)</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">x</span><span class="p">;</span>
</span><span id="__span-504-16"><a id="__codelineno-504-16" name="__codelineno-504-16" href="#__codelineno-504-16"></a><span class="p">}</span>
</span><span id="__span-504-17"><a id="__codelineno-504-17" name="__codelineno-504-17" href="#__codelineno-504-17"></a><span class="p">...</span>
</span><span id="__span-504-18"><a id="__codelineno-504-18" name="__codelineno-504-18" href="#__codelineno-504-18"></a><span class="k">static</span><span class="w"> </span><span class="k">void</span><span class="w"> </span><span class="nf">Main</span><span class="p">()</span>
</span><span id="__span-504-19"><a id="__codelineno-504-19" name="__codelineno-504-19" href="#__codelineno-504-19"></a><span class="p">{</span>
</span><span id="__span-504-20"><a id="__codelineno-504-20" name="__codelineno-504-20" href="#__codelineno-504-20"></a><span class="w"> </span><span class="kt">int</span><span class="p">[]</span><span class="w"> </span><span class="n">values</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="mi">3</span><span class="w"> </span><span class="p">};</span>
</span><span id="__span-504-21"><a id="__codelineno-504-21" name="__codelineno-504-21" href="#__codelineno-504-21"></a><span class="w"> </span><span class="n">Util</span><span class="p">.</span><span class="n">TransformAll</span><span class="w"> </span><span class="p">(</span><span class="n">values</span><span class="p">,</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">Squarer</span><span class="p">());</span>
</span><span id="__span-504-22"><a id="__codelineno-504-22" name="__codelineno-504-22" href="#__codelineno-504-22"></a><span class="w"> </span><span class="k">foreach</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">values</span><span class="p">)</span>
</span><span id="__span-504-23"><a id="__codelineno-504-23" name="__codelineno-504-23" href="#__codelineno-504-23"></a><span class="w"> </span><span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="w"> </span><span class="p">(</span><span class="n">i</span><span class="p">);</span>
</span><span id="__span-504-24"><a id="__codelineno-504-24" name="__codelineno-504-24" href="#__codelineno-504-24"></a><span class="p">}</span><span class="w">   </span>
</span></code></pre></div>
<p>A delegate design may be a better choice than an interface design if one or more of these conditions are true:</p>
<ul>
<li>The interface defines only a single method.</li>
<li>Multicast capability is needed.</li>
<li>The subscriber needs to implement the interface multiple times</li>
</ul>
<p><em>In the ITransformer example, we donâ€™t need to multicast. However, the interface defines only a single method. Furthermore, our subscriber may need to implement ITransformer multiple times, to support different transforms, such as square or cube. With interfaces, weâ€™re forced into writing a separate type per transform, since Test can implement ITransformer only once. This is quite cumbersome:</em></p>
<div class="language-csharp highlight"><pre><span></span><code><span id="__span-505-1"><a id="__codelineno-505-1" name="__codelineno-505-1" href="#__codelineno-505-1"></a><span class="k">class</span><span class="w"> </span><span class="nc">Squarer</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="n">ITransformer</span>
</span><span id="__span-505-2"><a id="__codelineno-505-2" name="__codelineno-505-2" href="#__codelineno-505-2"></a><span class="p">{</span>
</span><span id="__span-505-3"><a id="__codelineno-505-3" name="__codelineno-505-3" href="#__codelineno-505-3"></a><span class="w"> </span><span class="k">public</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="nf">Transform</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">x</span><span class="p">)</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">x</span><span class="p">;</span>
</span><span id="__span-505-4"><a id="__codelineno-505-4" name="__codelineno-505-4" href="#__codelineno-505-4"></a><span class="p">}</span>
</span><span id="__span-505-5"><a id="__codelineno-505-5" name="__codelineno-505-5" href="#__codelineno-505-5"></a><span class="k">class</span><span class="w"> </span><span class="nc">Cuber</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="n">ITransformer</span>
</span><span id="__span-505-6"><a id="__codelineno-505-6" name="__codelineno-505-6" href="#__codelineno-505-6"></a><span class="p">{</span>
</span><span id="__span-505-7"><a id="__codelineno-505-7" name="__codelineno-505-7" href="#__codelineno-505-7"></a><span class="w"> </span><span class="k">public</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="nf">Transform</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">x</span><span class="p">)</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">x</span><span class="p">;</span>
</span><span id="__span-505-8"><a id="__codelineno-505-8" name="__codelineno-505-8" href="#__codelineno-505-8"></a><span class="p">}</span>
</span><span id="__span-505-9"><a id="__codelineno-505-9" name="__codelineno-505-9" href="#__codelineno-505-9"></a><span class="p">...</span>
</span><span id="__span-505-10"><a id="__codelineno-505-10" name="__codelineno-505-10" href="#__codelineno-505-10"></a><span class="k">static</span><span class="w"> </span><span class="k">void</span><span class="w"> </span><span class="nf">Main</span><span class="p">()</span>
</span><span id="__span-505-11"><a id="__codelineno-505-11" name="__codelineno-505-11" href="#__codelineno-505-11"></a><span class="p">{</span>
</span><span id="__span-505-12"><a id="__codelineno-505-12" name="__codelineno-505-12" href="#__codelineno-505-12"></a><span class="w"> </span><span class="kt">int</span><span class="p">[]</span><span class="w"> </span><span class="n">values</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="mi">3</span><span class="w"> </span><span class="p">};</span>
</span><span id="__span-505-13"><a id="__codelineno-505-13" name="__codelineno-505-13" href="#__codelineno-505-13"></a><span class="w"> </span><span class="n">Util</span><span class="p">.</span><span class="n">TransformAll</span><span class="w"> </span><span class="p">(</span><span class="n">values</span><span class="p">,</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">Cuber</span><span class="p">());</span>
</span><span id="__span-505-14"><a id="__codelineno-505-14" name="__codelineno-505-14" href="#__codelineno-505-14"></a><span class="w"> </span><span class="k">foreach</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">values</span><span class="p">)</span>
</span><span id="__span-505-15"><a id="__codelineno-505-15" name="__codelineno-505-15" href="#__codelineno-505-15"></a><span class="w"> </span><span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="w"> </span><span class="p">(</span><span class="n">i</span><span class="p">);</span>
</span><span id="__span-505-16"><a id="__codelineno-505-16" name="__codelineno-505-16" href="#__codelineno-505-16"></a><span class="p">}</span>
</span></code></pre></div>
<h3 id="delegate-compatibility">Delegate Compatibility</h3>
<p>Delegate types are all incompatible with one another, even if their signatures are the
same</p>
<div class="language-csharp highlight"><pre><span></span><code><span id="__span-506-1"><a id="__codelineno-506-1" name="__codelineno-506-1" href="#__codelineno-506-1"></a><span class="k">delegate</span><span class="w"> </span><span class="k">void</span><span class="w"> </span><span class="nf">D1</span><span class="p">();</span>
</span><span id="__span-506-2"><a id="__codelineno-506-2" name="__codelineno-506-2" href="#__codelineno-506-2"></a><span class="k">delegate</span><span class="w"> </span><span class="k">void</span><span class="w"> </span><span class="nf">D2</span><span class="p">();</span>
</span><span id="__span-506-3"><a id="__codelineno-506-3" name="__codelineno-506-3" href="#__codelineno-506-3"></a><span class="p">...</span>
</span><span id="__span-506-4"><a id="__codelineno-506-4" name="__codelineno-506-4" href="#__codelineno-506-4"></a><span class="n">D1</span><span class="w"> </span><span class="n">d1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Method1</span><span class="p">;</span>
</span><span id="__span-506-5"><a id="__codelineno-506-5" name="__codelineno-506-5" href="#__codelineno-506-5"></a><span class="n">D2</span><span class="w"> </span><span class="n">d2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">d1</span><span class="p">;</span><span class="w"> </span><span class="c1">// Compile-time error</span>
</span><span id="__span-506-6"><a id="__codelineno-506-6" name="__codelineno-506-6" href="#__codelineno-506-6"></a>
</span><span id="__span-506-7"><a id="__codelineno-506-7" name="__codelineno-506-7" href="#__codelineno-506-7"></a><span class="c1">//Delegate instances are considered equal if they have the same method targets</span>
</span><span id="__span-506-8"><a id="__codelineno-506-8" name="__codelineno-506-8" href="#__codelineno-506-8"></a><span class="k">delegate</span><span class="w"> </span><span class="k">void</span><span class="w"> </span><span class="nf">D</span><span class="p">();</span>
</span><span id="__span-506-9"><a id="__codelineno-506-9" name="__codelineno-506-9" href="#__codelineno-506-9"></a><span class="p">...</span>
</span><span id="__span-506-10"><a id="__codelineno-506-10" name="__codelineno-506-10" href="#__codelineno-506-10"></a><span class="n">D</span><span class="w"> </span><span class="n">d1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Method1</span><span class="p">;</span>
</span><span id="__span-506-11"><a id="__codelineno-506-11" name="__codelineno-506-11" href="#__codelineno-506-11"></a><span class="n">D</span><span class="w"> </span><span class="n">d2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Method1</span><span class="p">;</span>
</span><span id="__span-506-12"><a id="__codelineno-506-12" name="__codelineno-506-12" href="#__codelineno-506-12"></a><span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="w"> </span><span class="p">(</span><span class="n">d1</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">d2</span><span class="p">);</span><span class="w"> </span><span class="c1">// True</span>
</span></code></pre></div>
<p>Multicast delegates are considered equal if they reference the same methods in the same order. </p>
<h2 id="events">Events</h2>
<h3 id="overview_2">Overview</h3>
<p>When using delegates, two emergent roles commonly appear: broadcaster and subâ€ scriber. The broadcaster is a type that contains a delegate field. The broadcaster decides when to broadcast, by invoking the delegate. The subscribers are the method target recipients. A subscriber decides when to start and stop listening, by calling += and -= on the broadcasterâ€™s delegate. A subscriber does not know about, or interfere with, other subscribers.</p>
<p>Events are a language feature that formalizes this pattern. An event is a construct that exposes just the subset of delegate features required for the broadcaster/ subscriber model. The main purpose of events is to prevent subscribers from interfering with one another.</p>
<p>The easiest way to declare an event is to put the event keyword in front of a deleâ€ gate member:</p>
<div class="language-csharp highlight"><pre><span></span><code><span id="__span-507-1"><a id="__codelineno-507-1" name="__codelineno-507-1" href="#__codelineno-507-1"></a><span class="c1">// Delegate definition</span>
</span><span id="__span-507-2"><a id="__codelineno-507-2" name="__codelineno-507-2" href="#__codelineno-507-2"></a><span class="k">public</span><span class="w"> </span><span class="k">delegate</span><span class="w"> </span><span class="k">void</span><span class="w"> </span><span class="nf">PriceChangedHandler</span><span class="w"> </span><span class="p">(</span><span class="kt">decimal</span><span class="w"> </span><span class="n">oldPrice</span><span class="p">,</span>
</span><span id="__span-507-3"><a id="__codelineno-507-3" name="__codelineno-507-3" href="#__codelineno-507-3"></a><span class="w"> </span><span class="kt">decimal</span><span class="w"> </span><span class="n">newPrice</span><span class="p">);</span>
</span><span id="__span-507-4"><a id="__codelineno-507-4" name="__codelineno-507-4" href="#__codelineno-507-4"></a><span class="k">public</span><span class="w"> </span><span class="k">class</span><span class="w"> </span><span class="nc">Broadcaster</span>
</span><span id="__span-507-5"><a id="__codelineno-507-5" name="__codelineno-507-5" href="#__codelineno-507-5"></a><span class="p">{</span>
</span><span id="__span-507-6"><a id="__codelineno-507-6" name="__codelineno-507-6" href="#__codelineno-507-6"></a><span class="w"> </span><span class="c1">// Event declaration</span>
</span><span id="__span-507-7"><a id="__codelineno-507-7" name="__codelineno-507-7" href="#__codelineno-507-7"></a><span class="w"> </span><span class="k">public</span><span class="w"> </span><span class="k">event</span><span class="w"> </span><span class="n">PriceChangedHandler</span><span class="w"> </span><span class="n">PriceChanged</span><span class="p">;</span>
</span><span id="__span-507-8"><a id="__codelineno-507-8" name="__codelineno-507-8" href="#__codelineno-507-8"></a><span class="p">}</span>
</span></code></pre></div>
<p>Code within the Broadcaster type has full access to PriceChanged and can treat it as a delegate. Code outside of Broadcaster can only perform += and -= operations on the PriceChanged event.</p>
<p>Consider the following example. The Stock class fires its PriceChanged event every time the Price of the Stock changes:</p>
<div class="language-csharp highlight"><pre><span></span><code><span id="__span-508-1"><a id="__codelineno-508-1" name="__codelineno-508-1" href="#__codelineno-508-1"></a><span class="k">public</span><span class="w"> </span><span class="k">delegate</span><span class="w"> </span><span class="k">void</span><span class="w"> </span><span class="nf">PriceChangedHandler</span><span class="w"> </span><span class="p">(</span><span class="kt">decimal</span><span class="w"> </span><span class="n">oldPrice</span><span class="p">,</span>
</span><span id="__span-508-2"><a id="__codelineno-508-2" name="__codelineno-508-2" href="#__codelineno-508-2"></a><span class="w"> </span><span class="kt">decimal</span><span class="w"> </span><span class="n">newPrice</span><span class="p">);</span>
</span><span id="__span-508-3"><a id="__codelineno-508-3" name="__codelineno-508-3" href="#__codelineno-508-3"></a><span class="k">public</span><span class="w"> </span><span class="k">class</span><span class="w"> </span><span class="nc">Stock</span>
</span><span id="__span-508-4"><a id="__codelineno-508-4" name="__codelineno-508-4" href="#__codelineno-508-4"></a><span class="p">{</span>
</span><span id="__span-508-5"><a id="__codelineno-508-5" name="__codelineno-508-5" href="#__codelineno-508-5"></a><span class="w"> </span><span class="kt">string</span><span class="w"> </span><span class="n">symbol</span><span class="p">;</span>
</span><span id="__span-508-6"><a id="__codelineno-508-6" name="__codelineno-508-6" href="#__codelineno-508-6"></a><span class="w"> </span><span class="kt">decimal</span><span class="w"> </span><span class="n">price</span><span class="p">;</span>
</span><span id="__span-508-7"><a id="__codelineno-508-7" name="__codelineno-508-7" href="#__codelineno-508-7"></a><span class="w"> </span><span class="k">public</span><span class="w"> </span><span class="nf">Stock</span><span class="w"> </span><span class="p">(</span><span class="kt">string</span><span class="w"> </span><span class="n">symbol</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="n">symbol</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">symbol</span><span class="p">;</span><span class="w"> </span><span class="p">}</span>
</span><span id="__span-508-8"><a id="__codelineno-508-8" name="__codelineno-508-8" href="#__codelineno-508-8"></a><span class="w"> </span><span class="k">public</span><span class="w"> </span><span class="k">event</span><span class="w"> </span><span class="n">PriceChangedHandler</span><span class="w"> </span><span class="n">PriceChanged</span><span class="p">;</span>
</span><span id="__span-508-9"><a id="__codelineno-508-9" name="__codelineno-508-9" href="#__codelineno-508-9"></a><span class="w"> </span><span class="k">public</span><span class="w"> </span><span class="kt">decimal</span><span class="w"> </span><span class="n">Price</span>
</span><span id="__span-508-10"><a id="__codelineno-508-10" name="__codelineno-508-10" href="#__codelineno-508-10"></a><span class="w"> </span><span class="p">{</span>
</span><span id="__span-508-11"><a id="__codelineno-508-11" name="__codelineno-508-11" href="#__codelineno-508-11"></a><span class="w"> </span><span class="k">get</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="n">price</span><span class="p">;</span><span class="w"> </span><span class="p">}</span>
</span><span id="__span-508-12"><a id="__codelineno-508-12" name="__codelineno-508-12" href="#__codelineno-508-12"></a><span class="w"> </span><span class="k">set</span>
</span><span id="__span-508-13"><a id="__codelineno-508-13" name="__codelineno-508-13" href="#__codelineno-508-13"></a><span class="w"> </span><span class="p">{</span>
</span><span id="__span-508-14"><a id="__codelineno-508-14" name="__codelineno-508-14" href="#__codelineno-508-14"></a><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">price</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="k">value</span><span class="p">)</span><span class="w"> </span><span class="k">return</span><span class="p">;</span><span class="w"> </span><span class="c1">// Exit if nothing has changed</span>
</span><span id="__span-508-15"><a id="__codelineno-508-15" name="__codelineno-508-15" href="#__codelineno-508-15"></a><span class="w"> </span><span class="kt">decimal</span><span class="w"> </span><span class="n">oldPrice</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">price</span><span class="p">;</span>
</span><span id="__span-508-16"><a id="__codelineno-508-16" name="__codelineno-508-16" href="#__codelineno-508-16"></a><span class="w"> </span><span class="n">price</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">value</span><span class="p">;</span>
</span><span id="__span-508-17"><a id="__codelineno-508-17" name="__codelineno-508-17" href="#__codelineno-508-17"></a><span class="w">  </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">PriceChanged</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="k">null</span><span class="p">)</span><span class="w"> </span><span class="c1">// If invocation list not</span>
</span><span id="__span-508-18"><a id="__codelineno-508-18" name="__codelineno-508-18" href="#__codelineno-508-18"></a><span class="w"> </span><span class="n">PriceChanged</span><span class="w"> </span><span class="p">(</span><span class="n">oldPrice</span><span class="p">,</span><span class="w"> </span><span class="n">price</span><span class="p">);</span><span class="w"> </span><span class="c1">// empty, fire event.</span>
</span><span id="__span-508-19"><a id="__codelineno-508-19" name="__codelineno-508-19" href="#__codelineno-508-19"></a><span class="w"> </span><span class="p">}</span>
</span><span id="__span-508-20"><a id="__codelineno-508-20" name="__codelineno-508-20" href="#__codelineno-508-20"></a><span class="w"> </span><span class="p">}</span>
</span><span id="__span-508-21"><a id="__codelineno-508-21" name="__codelineno-508-21" href="#__codelineno-508-21"></a><span class="p">}</span>
</span></code></pre></div>
<p>If we remove the event keyword from our example so that PriceChanged becomes an ordinary delegate field, our example would give the same results. However, Stock would be less robust, in that subscribers could do the following things to interfere with each other:</p>
<ul>
<li>Replace other subscribers by reassigning PriceChanged (instead of using the += operator).</li>
<li>Clear all subscribers (by setting PriceChanged to null).</li>
<li>Broadcast to other subscribers by invoking the delegate</li>
</ul>
<h2 id="lambda-expressions">Lambda Expressions</h2>
<p>A lambda expression is an unnamed method written in place of a delegate instance. The compiler immediately converts the lambda expression to either:</p>
<ul>
<li>A delegate instance.</li>
<li>An expression tree, of type Expression, representing the code inside the lambda expression in a traversable object model. This allows the lambda expression to be interpreted later at runtime</li>
</ul>
<p>Given the following delegate type: <code>delegate int Transformer (int i);</code></p>
<p>e could assign and invoke the lambda expression x =&gt; x * x as follows:</p>
<div class="language-csharp highlight"><pre><span></span><code><span id="__span-509-1"><a id="__codelineno-509-1" name="__codelineno-509-1" href="#__codelineno-509-1"></a><span class="n">Transformer</span><span class="w"> </span><span class="n">sqr</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">x</span><span class="p">;</span>
</span><span id="__span-509-2"><a id="__codelineno-509-2" name="__codelineno-509-2" href="#__codelineno-509-2"></a><span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="w"> </span><span class="p">(</span><span class="n">sqr</span><span class="p">(</span><span class="mi">3</span><span class="p">));</span><span class="w"> </span><span class="c1">// 9</span>
</span></code></pre></div>
<blockquote>
<p>Internally, the compiler resolves lambda expressions of this type by writing a private method, and moving the expressionâ€™s code into that method.
</p>
</blockquote>
<p>A lambda expression has the following form:<code>(parameters) =&gt; expression-or-statement-block</code></p>
<div class="language-csharp highlight"><pre><span></span><code><span id="__span-510-1"><a id="__codelineno-510-1" name="__codelineno-510-1" href="#__codelineno-510-1"></a><span class="n">x</span><span class="o">=&gt;</span><span class="n">x</span><span class="o">*</span><span class="n">x</span><span class="p">;</span>
</span><span id="__span-510-2"><a id="__codelineno-510-2" name="__codelineno-510-2" href="#__codelineno-510-2"></a><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="o">=&gt;</span><span class="n">x</span><span class="o">*</span><span class="n">x</span><span class="p">;</span>
</span><span id="__span-510-3"><a id="__codelineno-510-3" name="__codelineno-510-3" href="#__codelineno-510-3"></a><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">x</span><span class="p">)</span><span class="o">=&gt;</span><span class="n">x</span><span class="o">*</span><span class="n">x</span><span class="p">;</span>
</span><span id="__span-510-4"><a id="__codelineno-510-4" name="__codelineno-510-4" href="#__codelineno-510-4"></a><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">x</span><span class="p">,</span><span class="kt">int</span><span class="w"> </span><span class="n">y</span><span class="p">)</span><span class="o">=&gt;</span><span class="n">x</span><span class="o">*</span><span class="n">y</span><span class="p">;</span>
</span><span id="__span-510-5"><a id="__codelineno-510-5" name="__codelineno-510-5" href="#__codelineno-510-5"></a><span class="n">x</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">x</span><span class="p">;</span><span class="w"> </span><span class="p">};</span>
</span></code></pre></div>
<div class="language-csharp highlight"><pre><span></span><code><span id="__span-511-1"><a id="__codelineno-511-1" name="__codelineno-511-1" href="#__codelineno-511-1"></a><span class="c1">// A lambda expression is an unnamed method written in place of a delegate instance.</span>
</span><span id="__span-511-2"><a id="__codelineno-511-2" name="__codelineno-511-2" href="#__codelineno-511-2"></a><span class="c1">// A lambda expression has the following form:</span>
</span><span id="__span-511-3"><a id="__codelineno-511-3" name="__codelineno-511-3" href="#__codelineno-511-3"></a><span class="c1">//   (parameters) =&gt; expression-or-statement-block</span>
</span><span id="__span-511-4"><a id="__codelineno-511-4" name="__codelineno-511-4" href="#__codelineno-511-4"></a>
</span><span id="__span-511-5"><a id="__codelineno-511-5" name="__codelineno-511-5" href="#__codelineno-511-5"></a><span class="k">delegate</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="nf">Transformer</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">i</span><span class="p">);</span>
</span><span id="__span-511-6"><a id="__codelineno-511-6" name="__codelineno-511-6" href="#__codelineno-511-6"></a>
</span><span id="__span-511-7"><a id="__codelineno-511-7" name="__codelineno-511-7" href="#__codelineno-511-7"></a><span class="k">static</span><span class="w"> </span><span class="k">void</span><span class="w"> </span><span class="nf">Main</span><span class="p">()</span>
</span><span id="__span-511-8"><a id="__codelineno-511-8" name="__codelineno-511-8" href="#__codelineno-511-8"></a><span class="p">{</span>
</span><span id="__span-511-9"><a id="__codelineno-511-9" name="__codelineno-511-9" href="#__codelineno-511-9"></a><span class="w">    </span><span class="n">Transformer</span><span class="w"> </span><span class="n">sqr</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">x</span><span class="p">;</span>
</span><span id="__span-511-10"><a id="__codelineno-511-10" name="__codelineno-511-10" href="#__codelineno-511-10"></a><span class="w">    </span><span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="w"> </span><span class="p">(</span><span class="n">sqr</span><span class="p">(</span><span class="mi">3</span><span class="p">));</span><span class="w">    </span><span class="c1">// 9</span>
</span><span id="__span-511-11"><a id="__codelineno-511-11" name="__codelineno-511-11" href="#__codelineno-511-11"></a>
</span><span id="__span-511-12"><a id="__codelineno-511-12" name="__codelineno-511-12" href="#__codelineno-511-12"></a><span class="w">    </span><span class="c1">// Using a statement block instead:</span>
</span><span id="__span-511-13"><a id="__codelineno-511-13" name="__codelineno-511-13" href="#__codelineno-511-13"></a><span class="w">    </span><span class="n">Transformer</span><span class="w"> </span><span class="n">sqrBlock</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">x</span><span class="p">;</span><span class="w"> </span><span class="p">};</span>
</span><span id="__span-511-14"><a id="__codelineno-511-14" name="__codelineno-511-14" href="#__codelineno-511-14"></a><span class="w">    </span><span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="w"> </span><span class="p">(</span><span class="n">sqr</span><span class="p">(</span><span class="mi">3</span><span class="p">));</span>
</span><span id="__span-511-15"><a id="__codelineno-511-15" name="__codelineno-511-15" href="#__codelineno-511-15"></a>
</span><span id="__span-511-16"><a id="__codelineno-511-16" name="__codelineno-511-16" href="#__codelineno-511-16"></a><span class="w">    </span><span class="c1">// Using a generic System.Func delegate:</span>
</span><span id="__span-511-17"><a id="__codelineno-511-17" name="__codelineno-511-17" href="#__codelineno-511-17"></a><span class="w">    </span><span class="n">Func</span><span class="o">&lt;</span><span class="kt">int</span><span class="p">,</span><span class="kt">int</span><span class="o">&gt;</span><span class="w"> </span><span class="n">sqrFunc</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">x</span><span class="p">;</span>
</span><span id="__span-511-18"><a id="__codelineno-511-18" name="__codelineno-511-18" href="#__codelineno-511-18"></a><span class="w">    </span><span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="w"> </span><span class="p">(</span><span class="n">sqrFunc</span><span class="p">(</span><span class="mi">3</span><span class="p">));</span>
</span><span id="__span-511-19"><a id="__codelineno-511-19" name="__codelineno-511-19" href="#__codelineno-511-19"></a>
</span><span id="__span-511-20"><a id="__codelineno-511-20" name="__codelineno-511-20" href="#__codelineno-511-20"></a><span class="w">    </span><span class="c1">// Using multiple arguments:</span>
</span><span id="__span-511-21"><a id="__codelineno-511-21" name="__codelineno-511-21" href="#__codelineno-511-21"></a><span class="w">    </span><span class="n">Func</span><span class="o">&lt;</span><span class="kt">string</span><span class="p">,</span><span class="kt">string</span><span class="p">,</span><span class="kt">int</span><span class="o">&gt;</span><span class="w"> </span><span class="n">totalLength</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">s1</span><span class="p">,</span><span class="w"> </span><span class="n">s2</span><span class="p">)</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="n">s1</span><span class="p">.</span><span class="n">Length</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">s2</span><span class="p">.</span><span class="n">Length</span><span class="p">;</span>
</span><span id="__span-511-22"><a id="__codelineno-511-22" name="__codelineno-511-22" href="#__codelineno-511-22"></a><span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">total</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">totalLength</span><span class="w"> </span><span class="p">(</span><span class="s">&quot;hello&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;world&quot;</span><span class="p">);</span>
</span><span id="__span-511-23"><a id="__codelineno-511-23" name="__codelineno-511-23" href="#__codelineno-511-23"></a><span class="w">    </span><span class="n">total</span><span class="p">.</span><span class="n">Dump</span><span class="w"> </span><span class="p">(</span><span class="s">&quot;total&quot;</span><span class="p">);</span>
</span><span id="__span-511-24"><a id="__codelineno-511-24" name="__codelineno-511-24" href="#__codelineno-511-24"></a>
</span><span id="__span-511-25"><a id="__codelineno-511-25" name="__codelineno-511-25" href="#__codelineno-511-25"></a><span class="w">    </span><span class="c1">// Explicitly specifying parameter types:</span>
</span><span id="__span-511-26"><a id="__codelineno-511-26" name="__codelineno-511-26" href="#__codelineno-511-26"></a><span class="w">    </span><span class="n">Func</span><span class="o">&lt;</span><span class="kt">int</span><span class="p">,</span><span class="kt">int</span><span class="o">&gt;</span><span class="w"> </span><span class="n">sqrExplicit</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">x</span><span class="p">)</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">x</span><span class="p">;</span>
</span><span id="__span-511-27"><a id="__codelineno-511-27" name="__codelineno-511-27" href="#__codelineno-511-27"></a><span class="w">    </span><span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="w"> </span><span class="p">(</span><span class="n">sqrFunc</span><span class="p">(</span><span class="mi">3</span><span class="p">));</span>
</span><span id="__span-511-28"><a id="__codelineno-511-28" name="__codelineno-511-28" href="#__codelineno-511-28"></a><span class="p">}</span>
</span></code></pre></div>
<h3 id="explicitly-specifying-lambda-parameter-types">Explicitly Specifying Lambda Parameter Types</h3>
<p>The compiler can usually infer the type of lambda parameters contextually. When this is not the case, you must specify the type of each parameter explicitly. Consider the following two methods:</p>
<div class="language-csharp highlight"><pre><span></span><code><span id="__span-512-1"><a id="__codelineno-512-1" name="__codelineno-512-1" href="#__codelineno-512-1"></a><span class="k">void</span><span class="w"> </span><span class="n">Foo</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span><span class="w"> </span><span class="p">(</span><span class="n">T</span><span class="w"> </span><span class="n">x</span><span class="p">)</span><span class="w"> </span><span class="p">{}</span>
</span><span id="__span-512-2"><a id="__codelineno-512-2" name="__codelineno-512-2" href="#__codelineno-512-2"></a><span class="k">void</span><span class="w"> </span><span class="n">Bar</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span><span class="w"> </span><span class="p">(</span><span class="n">Action</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span><span class="w"> </span><span class="n">a</span><span class="p">)</span><span class="w"> </span><span class="p">{}</span>
</span><span id="__span-512-3"><a id="__codelineno-512-3" name="__codelineno-512-3" href="#__codelineno-512-3"></a><span class="c1">//The following code will fail to compile, because the compiler cannot infer the type</span>
</span><span id="__span-512-4"><a id="__codelineno-512-4" name="__codelineno-512-4" href="#__codelineno-512-4"></a><span class="c1">//of x</span>
</span><span id="__span-512-5"><a id="__codelineno-512-5" name="__codelineno-512-5" href="#__codelineno-512-5"></a><span class="o">****</span><span class="n">Bar</span><span class="w"> </span><span class="p">(</span><span class="n">x</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="n">Foo</span><span class="w"> </span><span class="p">(</span><span class="n">x</span><span class="p">));</span>
</span><span id="__span-512-6"><a id="__codelineno-512-6" name="__codelineno-512-6" href="#__codelineno-512-6"></a><span class="c1">//We can fix this by explicitly specifying xâ€™s type as follows</span>
</span><span id="__span-512-7"><a id="__codelineno-512-7" name="__codelineno-512-7" href="#__codelineno-512-7"></a><span class="n">Bar</span><span class="w"> </span><span class="p">(</span><span class="n">x</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="n">Foo</span><span class="w"> </span><span class="p">(</span><span class="n">x</span><span class="p">));</span>
</span></code></pre></div>
<h3 id="capturing-outer-variables">Capturing Outer Variables</h3>
<p>A lambda expression can reference the local variables and parameters of the method
in which itâ€™s defined</p>
<div class="language-csharp highlight"><pre><span></span><code><span id="__span-513-1"><a id="__codelineno-513-1" name="__codelineno-513-1" href="#__codelineno-513-1"></a><span class="c1">// A lambda expression can reference the local variables and parameters of the method</span>
</span><span id="__span-513-2"><a id="__codelineno-513-2" name="__codelineno-513-2" href="#__codelineno-513-2"></a><span class="c1">// in which itâ€™s defined (outer variables)</span>
</span><span id="__span-513-3"><a id="__codelineno-513-3" name="__codelineno-513-3" href="#__codelineno-513-3"></a>
</span><span id="__span-513-4"><a id="__codelineno-513-4" name="__codelineno-513-4" href="#__codelineno-513-4"></a><span class="kt">int</span><span class="w"> </span><span class="n">factor</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">2</span><span class="p">;</span>
</span><span id="__span-513-5"><a id="__codelineno-513-5" name="__codelineno-513-5" href="#__codelineno-513-5"></a><span class="n">Func</span><span class="o">&lt;</span><span class="kt">int</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="o">&gt;</span><span class="w"> </span><span class="n">multiplier</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">n</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="n">n</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">factor</span><span class="p">;</span>
</span><span id="__span-513-6"><a id="__codelineno-513-6" name="__codelineno-513-6" href="#__codelineno-513-6"></a><span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="w"> </span><span class="p">(</span><span class="n">multiplier</span><span class="w"> </span><span class="p">(</span><span class="mi">3</span><span class="p">));</span><span class="w">           </span><span class="c1">// 6</span>
</span><span id="__span-513-7"><a id="__codelineno-513-7" name="__codelineno-513-7" href="#__codelineno-513-7"></a>
</span><span id="__span-513-8"><a id="__codelineno-513-8" name="__codelineno-513-8" href="#__codelineno-513-8"></a><span class="c1">// Captured variables are evaluated when the delegate is invoked, not when the variables were captured:</span>
</span><span id="__span-513-9"><a id="__codelineno-513-9" name="__codelineno-513-9" href="#__codelineno-513-9"></a>
</span><span id="__span-513-10"><a id="__codelineno-513-10" name="__codelineno-513-10" href="#__codelineno-513-10"></a><span class="n">factor</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">10</span><span class="p">;</span>
</span><span id="__span-513-11"><a id="__codelineno-513-11" name="__codelineno-513-11" href="#__codelineno-513-11"></a><span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="w"> </span><span class="p">(</span><span class="n">multiplier</span><span class="w"> </span><span class="p">(</span><span class="mi">3</span><span class="p">));</span><span class="w">           </span><span class="c1">// 30</span>
</span><span id="__span-513-12"><a id="__codelineno-513-12" name="__codelineno-513-12" href="#__codelineno-513-12"></a>
</span><span id="__span-513-13"><a id="__codelineno-513-13" name="__codelineno-513-13" href="#__codelineno-513-13"></a><span class="c1">// Lambda expressions can themselves update captured variables:</span>
</span><span id="__span-513-14"><a id="__codelineno-513-14" name="__codelineno-513-14" href="#__codelineno-513-14"></a>
</span><span id="__span-513-15"><a id="__codelineno-513-15" name="__codelineno-513-15" href="#__codelineno-513-15"></a><span class="kt">int</span><span class="w"> </span><span class="n">seed</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
</span><span id="__span-513-16"><a id="__codelineno-513-16" name="__codelineno-513-16" href="#__codelineno-513-16"></a><span class="n">Func</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span><span class="w"> </span><span class="n">natural</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="n">seed</span><span class="o">++</span><span class="p">;</span>
</span><span id="__span-513-17"><a id="__codelineno-513-17" name="__codelineno-513-17" href="#__codelineno-513-17"></a><span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="w"> </span><span class="p">(</span><span class="n">natural</span><span class="p">());</span><span class="w">           </span><span class="c1">// 0</span>
</span><span id="__span-513-18"><a id="__codelineno-513-18" name="__codelineno-513-18" href="#__codelineno-513-18"></a><span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="w"> </span><span class="p">(</span><span class="n">natural</span><span class="p">());</span><span class="w">           </span><span class="c1">// 1</span>
</span><span id="__span-513-19"><a id="__codelineno-513-19" name="__codelineno-513-19" href="#__codelineno-513-19"></a><span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="w"> </span><span class="p">(</span><span class="n">seed</span><span class="p">);</span><span class="w">                </span><span class="c1">// 2</span>
</span></code></pre></div>
<h3 id="lambda-expressions-versus-local-methods">Lambda Expressions Versus Local Methods</h3>
<p>The functionality of local methods overlaps with that of lambda expressions.</p>
<p>Local methods have the following three advantages</p>
<ul>
<li>They can be recursive (they can call themselves), without ugly hacks</li>
<li>They avoid the clutter of specifying a delegate type</li>
<li>They incur slightly less overhead</li>
</ul>
<p>Local methods are more efficient because they avoid the indirection of a delegate (which costs some CPU cycles and a memory allocation). They can also access local variables of the containing method without the compiler having to â€œhoistâ€ the captured variables into a hidden class.</p>
<h1 id="try-statements-and-exceptions">Try Statements and Exceptions</h1>
<p>A try statement specifies a code block subject to error-handling or cleanup code. The try block must be followed by one or more catch blocks, a finally block, or both. The catch block executes when an error is thrown in the try block. The finally block executes after execution leaves the try block (or if present, the catch block), to perform cleanup code, regardless of whether an exception was thrown.</p>
<p>A catch block has access to an Exception object that contains information about the error. You use a catch block to either compensate for the error or rethrow the exception. You rethrow an exception if you merely want to log the problem or if you want to rethrow a new, higher-level exception type.</p>
<div class="language-csharp highlight"><pre><span></span><code><span id="__span-514-1"><a id="__codelineno-514-1" name="__codelineno-514-1" href="#__codelineno-514-1"></a><span class="k">try</span>
</span><span id="__span-514-2"><a id="__codelineno-514-2" name="__codelineno-514-2" href="#__codelineno-514-2"></a><span class="p">{</span>
</span><span id="__span-514-3"><a id="__codelineno-514-3" name="__codelineno-514-3" href="#__codelineno-514-3"></a><span class="w"> </span><span class="p">...</span><span class="w"> </span><span class="c1">// exception may get thrown within execution of this block</span>
</span><span id="__span-514-4"><a id="__codelineno-514-4" name="__codelineno-514-4" href="#__codelineno-514-4"></a><span class="p">}</span>
</span><span id="__span-514-5"><a id="__codelineno-514-5" name="__codelineno-514-5" href="#__codelineno-514-5"></a><span class="k">catch</span><span class="w"> </span><span class="p">(</span><span class="n">ExceptionA</span><span class="w"> </span><span class="n">ex</span><span class="p">)</span>
</span><span id="__span-514-6"><a id="__codelineno-514-6" name="__codelineno-514-6" href="#__codelineno-514-6"></a><span class="p">{</span>
</span><span id="__span-514-7"><a id="__codelineno-514-7" name="__codelineno-514-7" href="#__codelineno-514-7"></a><span class="w"> </span><span class="p">...</span><span class="w"> </span><span class="c1">// handle exception of type ExceptionA</span>
</span><span id="__span-514-8"><a id="__codelineno-514-8" name="__codelineno-514-8" href="#__codelineno-514-8"></a><span class="p">}</span>
</span><span id="__span-514-9"><a id="__codelineno-514-9" name="__codelineno-514-9" href="#__codelineno-514-9"></a><span class="k">catch</span><span class="w"> </span><span class="p">(</span><span class="n">ExceptionB</span><span class="w"> </span><span class="n">ex</span><span class="p">)</span>
</span><span id="__span-514-10"><a id="__codelineno-514-10" name="__codelineno-514-10" href="#__codelineno-514-10"></a><span class="p">{</span>
</span><span id="__span-514-11"><a id="__codelineno-514-11" name="__codelineno-514-11" href="#__codelineno-514-11"></a><span class="w"> </span><span class="p">...</span><span class="w"> </span><span class="c1">// handle exception of type ExceptionB</span>
</span><span id="__span-514-12"><a id="__codelineno-514-12" name="__codelineno-514-12" href="#__codelineno-514-12"></a><span class="p">}</span>
</span><span id="__span-514-13"><a id="__codelineno-514-13" name="__codelineno-514-13" href="#__codelineno-514-13"></a><span class="k">finally</span>
</span><span id="__span-514-14"><a id="__codelineno-514-14" name="__codelineno-514-14" href="#__codelineno-514-14"></a><span class="p">{</span>
</span><span id="__span-514-15"><a id="__codelineno-514-15" name="__codelineno-514-15" href="#__codelineno-514-15"></a><span class="w"> </span><span class="p">...</span><span class="w"> </span><span class="c1">// cleanup code</span>
</span><span id="__span-514-16"><a id="__codelineno-514-16" name="__codelineno-514-16" href="#__codelineno-514-16"></a><span class="p">}</span>
</span></code></pre></div>
<div class="language-csharp highlight"><pre><span></span><code><span id="__span-515-1"><a id="__codelineno-515-1" name="__codelineno-515-1" href="#__codelineno-515-1"></a><span class="c1">// We can catch the DivideByZeroException as follows:</span>
</span><span id="__span-515-2"><a id="__codelineno-515-2" name="__codelineno-515-2" href="#__codelineno-515-2"></a>
</span><span id="__span-515-3"><a id="__codelineno-515-3" name="__codelineno-515-3" href="#__codelineno-515-3"></a><span class="k">static</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="nf">Calc</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">x</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="mi">10</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="n">x</span><span class="p">;</span><span class="w"> </span><span class="p">}</span>
</span><span id="__span-515-4"><a id="__codelineno-515-4" name="__codelineno-515-4" href="#__codelineno-515-4"></a>
</span><span id="__span-515-5"><a id="__codelineno-515-5" name="__codelineno-515-5" href="#__codelineno-515-5"></a><span class="k">static</span><span class="w"> </span><span class="k">void</span><span class="w"> </span><span class="nf">Main</span><span class="p">()</span>
</span><span id="__span-515-6"><a id="__codelineno-515-6" name="__codelineno-515-6" href="#__codelineno-515-6"></a><span class="p">{</span>
</span><span id="__span-515-7"><a id="__codelineno-515-7" name="__codelineno-515-7" href="#__codelineno-515-7"></a><span class="w">    </span><span class="k">try</span>
</span><span id="__span-515-8"><a id="__codelineno-515-8" name="__codelineno-515-8" href="#__codelineno-515-8"></a><span class="w">    </span><span class="p">{</span>
</span><span id="__span-515-9"><a id="__codelineno-515-9" name="__codelineno-515-9" href="#__codelineno-515-9"></a><span class="w">        </span><span class="kt">int</span><span class="w"> </span><span class="n">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Calc</span><span class="w"> </span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>
</span><span id="__span-515-10"><a id="__codelineno-515-10" name="__codelineno-515-10" href="#__codelineno-515-10"></a><span class="w">        </span><span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="w"> </span><span class="p">(</span><span class="n">y</span><span class="p">);</span>
</span><span id="__span-515-11"><a id="__codelineno-515-11" name="__codelineno-515-11" href="#__codelineno-515-11"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-515-12"><a id="__codelineno-515-12" name="__codelineno-515-12" href="#__codelineno-515-12"></a><span class="w">    </span><span class="k">catch</span><span class="w"> </span><span class="p">(</span><span class="n">DivideByZeroException</span><span class="w"> </span><span class="n">ex</span><span class="p">)</span>
</span><span id="__span-515-13"><a id="__codelineno-515-13" name="__codelineno-515-13" href="#__codelineno-515-13"></a><span class="w">    </span><span class="p">{</span>
</span><span id="__span-515-14"><a id="__codelineno-515-14" name="__codelineno-515-14" href="#__codelineno-515-14"></a><span class="w">        </span><span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="w"> </span><span class="p">(</span><span class="s">&quot;x cannot be zero&quot;</span><span class="p">);</span>
</span><span id="__span-515-15"><a id="__codelineno-515-15" name="__codelineno-515-15" href="#__codelineno-515-15"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-515-16"><a id="__codelineno-515-16" name="__codelineno-515-16" href="#__codelineno-515-16"></a><span class="w">    </span><span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="w"> </span><span class="p">(</span><span class="s">&quot;program completed&quot;</span><span class="p">);</span>
</span><span id="__span-515-17"><a id="__codelineno-515-17" name="__codelineno-515-17" href="#__codelineno-515-17"></a><span class="p">}</span>
</span></code></pre></div>
<p>When an exception is thrown within a try statement, the CLR performs a test:</p>
<p>Does the try statement have any compatible catch blocks?</p>
<ul>
<li>If so, execution jumps to the compatible catch block, followed by the finally block (if present), and then execution continues normally.</li>
<li>If not, execution jumps directly to the finally block (if present), then the CLR looks up the call stack for other try blocks; if found, it repeats the test.</li>
</ul>
<h3 id="exception-filters">Exception filters</h3>
<p>You can specify an exception filter in a catch clause by adding a when clause</p>
<div class="language-csharp highlight"><pre><span></span><code><span id="__span-516-1"><a id="__codelineno-516-1" name="__codelineno-516-1" href="#__codelineno-516-1"></a><span class="k">catch</span><span class="w"> </span><span class="p">(</span><span class="n">WebException</span><span class="w"> </span><span class="n">ex</span><span class="p">)</span><span class="w"> </span><span class="k">when</span><span class="w"> </span><span class="p">(</span><span class="n">ex</span><span class="p">.</span><span class="n">Status</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">WebExceptionStatus</span><span class="p">.</span><span class="n">Timeout</span><span class="p">)</span>
</span><span id="__span-516-2"><a id="__codelineno-516-2" name="__codelineno-516-2" href="#__codelineno-516-2"></a><span class="p">{</span>
</span><span id="__span-516-3"><a id="__codelineno-516-3" name="__codelineno-516-3" href="#__codelineno-516-3"></a><span class="w"> </span><span class="p">...</span>
</span><span id="__span-516-4"><a id="__codelineno-516-4" name="__codelineno-516-4" href="#__codelineno-516-4"></a><span class="p">}</span>
</span></code></pre></div>
<p>If a WebException is thrown in this example, the Boolean expression following the when keyword is then evaluated. If the result is false, the catch block in question is ignored and any subsequent catch clauses are considered. </p>
<h3 id="the-using-statement">The using statement</h3>
<p>The using statement provides an elegant syntax for calling Dispose on  an IDisposable object within a finally block:</p>
<div class="language-csharp highlight"><pre><span></span><code><span id="__span-517-1"><a id="__codelineno-517-1" name="__codelineno-517-1" href="#__codelineno-517-1"></a><span class="k">static</span><span class="w"> </span><span class="k">void</span><span class="w"> </span><span class="nf">ReadFile</span><span class="p">()</span>
</span><span id="__span-517-2"><a id="__codelineno-517-2" name="__codelineno-517-2" href="#__codelineno-517-2"></a><span class="p">{</span>
</span><span id="__span-517-3"><a id="__codelineno-517-3" name="__codelineno-517-3" href="#__codelineno-517-3"></a><span class="w">    </span><span class="k">using</span><span class="w"> </span><span class="p">(</span><span class="n">StreamReader</span><span class="w"> </span><span class="n">reader</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">File</span><span class="p">.</span><span class="n">OpenText</span><span class="w"> </span><span class="p">(</span><span class="s">&quot;file.txt&quot;</span><span class="p">))</span>
</span><span id="__span-517-4"><a id="__codelineno-517-4" name="__codelineno-517-4" href="#__codelineno-517-4"></a><span class="w">    </span><span class="p">{</span>
</span><span id="__span-517-5"><a id="__codelineno-517-5" name="__codelineno-517-5" href="#__codelineno-517-5"></a><span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">reader</span><span class="p">.</span><span class="n">EndOfStream</span><span class="p">)</span><span class="w"> </span><span class="k">return</span><span class="p">;</span>
</span><span id="__span-517-6"><a id="__codelineno-517-6" name="__codelineno-517-6" href="#__codelineno-517-6"></a><span class="w">        </span><span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="w"> </span><span class="p">(</span><span class="n">reader</span><span class="p">.</span><span class="n">ReadToEnd</span><span class="p">());</span>
</span><span id="__span-517-7"><a id="__codelineno-517-7" name="__codelineno-517-7" href="#__codelineno-517-7"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-517-8"><a id="__codelineno-517-8" name="__codelineno-517-8" href="#__codelineno-517-8"></a><span class="p">}</span>
</span><span id="__span-517-9"><a id="__codelineno-517-9" name="__codelineno-517-9" href="#__codelineno-517-9"></a>
</span><span id="__span-517-10"><a id="__codelineno-517-10" name="__codelineno-517-10" href="#__codelineno-517-10"></a><span class="k">static</span><span class="w"> </span><span class="k">void</span><span class="w"> </span><span class="nf">Main</span><span class="p">()</span>
</span><span id="__span-517-11"><a id="__codelineno-517-11" name="__codelineno-517-11" href="#__codelineno-517-11"></a><span class="p">{</span>
</span><span id="__span-517-12"><a id="__codelineno-517-12" name="__codelineno-517-12" href="#__codelineno-517-12"></a><span class="w">    </span><span class="n">File</span><span class="p">.</span><span class="n">WriteAllText</span><span class="w"> </span><span class="p">(</span><span class="s">&quot;file.txt&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;test&quot;</span><span class="p">);</span>
</span><span id="__span-517-13"><a id="__codelineno-517-13" name="__codelineno-517-13" href="#__codelineno-517-13"></a><span class="w">    </span><span class="n">ReadFile</span><span class="w"> </span><span class="p">();</span>
</span><span id="__span-517-14"><a id="__codelineno-517-14" name="__codelineno-517-14" href="#__codelineno-517-14"></a><span class="p">}</span>
</span></code></pre></div>
<h3 id="using-declarations_1">Using declarations</h3>
<p>If you omit the brackets and statement block following a using statement, it
becomes a using declaration. The resource is then disposed when execution falls outâ€
side the enclosing statement block</p>
<div class="language-csharp highlight"><pre><span></span><code><span id="__span-518-1"><a id="__codelineno-518-1" name="__codelineno-518-1" href="#__codelineno-518-1"></a><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">File</span><span class="p">.</span><span class="n">Exists</span><span class="w"> </span><span class="p">(</span><span class="s">&quot;file.txt&quot;</span><span class="p">))</span>
</span><span id="__span-518-2"><a id="__codelineno-518-2" name="__codelineno-518-2" href="#__codelineno-518-2"></a><span class="p">{</span>
</span><span id="__span-518-3"><a id="__codelineno-518-3" name="__codelineno-518-3" href="#__codelineno-518-3"></a><span class="w">    </span><span class="k">using</span><span class="w"> </span><span class="nn">var</span><span class="w"> </span><span class="n">reader</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">File</span><span class="p">.</span><span class="n">OpenText</span><span class="w"> </span><span class="p">(</span><span class="s">&quot;file.txt&quot;</span><span class="p">);</span>
</span><span id="__span-518-4"><a id="__codelineno-518-4" name="__codelineno-518-4" href="#__codelineno-518-4"></a><span class="w">    </span><span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="w"> </span><span class="p">(</span><span class="n">reader</span><span class="p">.</span><span class="n">ReadLine</span><span class="p">());</span>
</span><span id="__span-518-5"><a id="__codelineno-518-5" name="__codelineno-518-5" href="#__codelineno-518-5"></a><span class="p">}</span>
</span></code></pre></div>
<h3 id="throwing-exceptions">Throwing Exceptions</h3>
<ul>
<li>Exceptions can be thrown either by the runtime or in user code:</li>
</ul>
<div class="language-csharp highlight"><pre><span></span><code><span id="__span-519-1"><a id="__codelineno-519-1" name="__codelineno-519-1" href="#__codelineno-519-1"></a><span class="k">static</span><span class="w"> </span><span class="k">void</span><span class="w"> </span><span class="nf">Display</span><span class="w"> </span><span class="p">(</span><span class="kt">string</span><span class="w"> </span><span class="n">name</span><span class="p">)</span>
</span><span id="__span-519-2"><a id="__codelineno-519-2" name="__codelineno-519-2" href="#__codelineno-519-2"></a><span class="p">{</span>
</span><span id="__span-519-3"><a id="__codelineno-519-3" name="__codelineno-519-3" href="#__codelineno-519-3"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">name</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="k">null</span><span class="p">)</span>
</span><span id="__span-519-4"><a id="__codelineno-519-4" name="__codelineno-519-4" href="#__codelineno-519-4"></a><span class="w">        </span><span class="k">throw</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="nf">ArgumentNullException</span><span class="w"> </span><span class="p">(</span><span class="k">nameof</span><span class="w"> </span><span class="p">(</span><span class="n">name</span><span class="p">));</span>
</span><span id="__span-519-5"><a id="__codelineno-519-5" name="__codelineno-519-5" href="#__codelineno-519-5"></a>
</span><span id="__span-519-6"><a id="__codelineno-519-6" name="__codelineno-519-6" href="#__codelineno-519-6"></a><span class="w">    </span><span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="w"> </span><span class="p">(</span><span class="n">name</span><span class="p">);</span>
</span><span id="__span-519-7"><a id="__codelineno-519-7" name="__codelineno-519-7" href="#__codelineno-519-7"></a><span class="p">}</span>
</span><span id="__span-519-8"><a id="__codelineno-519-8" name="__codelineno-519-8" href="#__codelineno-519-8"></a>
</span><span id="__span-519-9"><a id="__codelineno-519-9" name="__codelineno-519-9" href="#__codelineno-519-9"></a><span class="k">static</span><span class="w"> </span><span class="k">void</span><span class="w"> </span><span class="nf">Main</span><span class="p">()</span>
</span><span id="__span-519-10"><a id="__codelineno-519-10" name="__codelineno-519-10" href="#__codelineno-519-10"></a><span class="p">{</span>
</span><span id="__span-519-11"><a id="__codelineno-519-11" name="__codelineno-519-11" href="#__codelineno-519-11"></a><span class="w">    </span><span class="k">try</span>
</span><span id="__span-519-12"><a id="__codelineno-519-12" name="__codelineno-519-12" href="#__codelineno-519-12"></a><span class="w">    </span><span class="p">{</span>
</span><span id="__span-519-13"><a id="__codelineno-519-13" name="__codelineno-519-13" href="#__codelineno-519-13"></a><span class="w">        </span><span class="n">Display</span><span class="w"> </span><span class="p">(</span><span class="k">null</span><span class="p">);</span>
</span><span id="__span-519-14"><a id="__codelineno-519-14" name="__codelineno-519-14" href="#__codelineno-519-14"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-519-15"><a id="__codelineno-519-15" name="__codelineno-519-15" href="#__codelineno-519-15"></a><span class="w">    </span><span class="k">catch</span><span class="w"> </span><span class="p">(</span><span class="n">ArgumentNullException</span><span class="w"> </span><span class="n">ex</span><span class="p">)</span>
</span><span id="__span-519-16"><a id="__codelineno-519-16" name="__codelineno-519-16" href="#__codelineno-519-16"></a><span class="w">    </span><span class="p">{</span>
</span><span id="__span-519-17"><a id="__codelineno-519-17" name="__codelineno-519-17" href="#__codelineno-519-17"></a><span class="w">        </span><span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="w"> </span><span class="p">(</span><span class="s">&quot;Caught the exception&quot;</span><span class="p">);</span>
</span><span id="__span-519-18"><a id="__codelineno-519-18" name="__codelineno-519-18" href="#__codelineno-519-18"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-519-19"><a id="__codelineno-519-19" name="__codelineno-519-19" href="#__codelineno-519-19"></a><span class="p">}</span>
</span></code></pre></div>
<h3 id="throw-expressions">Throw expressions</h3>
<div class="language-csharp highlight"><pre><span></span><code><span id="__span-520-1"><a id="__codelineno-520-1" name="__codelineno-520-1" href="#__codelineno-520-1"></a><span class="c1">// Prior to C# 7, throw was always a statement. Now it can also appear as an expression in</span>
</span><span id="__span-520-2"><a id="__codelineno-520-2" name="__codelineno-520-2" href="#__codelineno-520-2"></a><span class="c1">// expression-bodied functions:</span>
</span><span id="__span-520-3"><a id="__codelineno-520-3" name="__codelineno-520-3" href="#__codelineno-520-3"></a>
</span><span id="__span-520-4"><a id="__codelineno-520-4" name="__codelineno-520-4" href="#__codelineno-520-4"></a><span class="k">public</span><span class="w"> </span><span class="kt">string</span><span class="w"> </span><span class="nf">Foo</span><span class="p">()</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="k">throw</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">NotImplementedException</span><span class="p">();</span>
</span><span id="__span-520-5"><a id="__codelineno-520-5" name="__codelineno-520-5" href="#__codelineno-520-5"></a>
</span><span id="__span-520-6"><a id="__codelineno-520-6" name="__codelineno-520-6" href="#__codelineno-520-6"></a><span class="c1">// A throw expression can also appear in a ternary conditional expression:</span>
</span><span id="__span-520-7"><a id="__codelineno-520-7" name="__codelineno-520-7" href="#__codelineno-520-7"></a>
</span><span id="__span-520-8"><a id="__codelineno-520-8" name="__codelineno-520-8" href="#__codelineno-520-8"></a><span class="kt">string</span><span class="w"> </span><span class="nf">ProperCase</span><span class="w"> </span><span class="p">(</span><span class="kt">string</span><span class="w"> </span><span class="k">value</span><span class="p">)</span><span class="w"> </span><span class="o">=&gt;</span>
</span><span id="__span-520-9"><a id="__codelineno-520-9" name="__codelineno-520-9" href="#__codelineno-520-9"></a><span class="w">    </span><span class="k">value</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="k">null</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="k">throw</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">ArgumentException</span><span class="w"> </span><span class="p">(</span><span class="s">&quot;value&quot;</span><span class="p">)</span><span class="w"> </span><span class="p">:</span>
</span><span id="__span-520-10"><a id="__codelineno-520-10" name="__codelineno-520-10" href="#__codelineno-520-10"></a><span class="w">    </span><span class="k">value</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s">&quot;&quot;</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="s">&quot;&quot;</span><span class="w"> </span><span class="p">:</span>
</span><span id="__span-520-11"><a id="__codelineno-520-11" name="__codelineno-520-11" href="#__codelineno-520-11"></a><span class="w">    </span><span class="kt">char</span><span class="p">.</span><span class="n">ToUpper</span><span class="w"> </span><span class="p">(</span><span class="k">value</span><span class="w"> </span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="k">value</span><span class="p">.</span><span class="n">Substring</span><span class="w"> </span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>
</span><span id="__span-520-12"><a id="__codelineno-520-12" name="__codelineno-520-12" href="#__codelineno-520-12"></a>
</span><span id="__span-520-13"><a id="__codelineno-520-13" name="__codelineno-520-13" href="#__codelineno-520-13"></a><span class="k">void</span><span class="w"> </span><span class="nf">Main</span><span class="p">()</span>
</span><span id="__span-520-14"><a id="__codelineno-520-14" name="__codelineno-520-14" href="#__codelineno-520-14"></a><span class="p">{</span>
</span><span id="__span-520-15"><a id="__codelineno-520-15" name="__codelineno-520-15" href="#__codelineno-520-15"></a><span class="w">    </span><span class="n">ProperCase</span><span class="w"> </span><span class="p">(</span><span class="s">&quot;test&quot;</span><span class="p">).</span><span class="n">Dump</span><span class="p">();</span>
</span><span id="__span-520-16"><a id="__codelineno-520-16" name="__codelineno-520-16" href="#__codelineno-520-16"></a><span class="w">    </span><span class="n">ProperCase</span><span class="w"> </span><span class="p">(</span><span class="k">null</span><span class="p">).</span><span class="n">Dump</span><span class="p">();</span><span class="w">     </span><span class="c1">// throws an ArgumentException</span>
</span><span id="__span-520-17"><a id="__codelineno-520-17" name="__codelineno-520-17" href="#__codelineno-520-17"></a><span class="p">}</span>
</span></code></pre></div>
<h3 id="rethrowing-an-exception">Rethrowing an exception</h3>
<div class="language-csharp highlight"><pre><span></span><code><span id="__span-521-1"><a id="__codelineno-521-1" name="__codelineno-521-1" href="#__codelineno-521-1"></a><span class="c1">// Rethrowing lets you back out of handling an exception should circumstances turn out to be</span>
</span><span id="__span-521-2"><a id="__codelineno-521-2" name="__codelineno-521-2" href="#__codelineno-521-2"></a><span class="c1">// outside what you expected:</span>
</span><span id="__span-521-3"><a id="__codelineno-521-3" name="__codelineno-521-3" href="#__codelineno-521-3"></a>
</span><span id="__span-521-4"><a id="__codelineno-521-4" name="__codelineno-521-4" href="#__codelineno-521-4"></a><span class="kt">string</span><span class="w"> </span><span class="n">s</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">null</span><span class="p">;</span>
</span><span id="__span-521-5"><a id="__codelineno-521-5" name="__codelineno-521-5" href="#__codelineno-521-5"></a>
</span><span id="__span-521-6"><a id="__codelineno-521-6" name="__codelineno-521-6" href="#__codelineno-521-6"></a><span class="k">using</span><span class="w"> </span><span class="p">(</span><span class="n">WebClient</span><span class="w"> </span><span class="n">wc</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">WebClient</span><span class="p">())</span>
</span><span id="__span-521-7"><a id="__codelineno-521-7" name="__codelineno-521-7" href="#__codelineno-521-7"></a><span class="w">    </span><span class="k">try</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">s</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">wc</span><span class="p">.</span><span class="n">DownloadString</span><span class="w"> </span><span class="p">(</span><span class="s">&quot;http://www.albahari.com/nutshell/&quot;</span><span class="p">);</span><span class="w">  </span><span class="p">}</span>
</span><span id="__span-521-8"><a id="__codelineno-521-8" name="__codelineno-521-8" href="#__codelineno-521-8"></a><span class="w">    </span><span class="k">catch</span><span class="w"> </span><span class="p">(</span><span class="n">WebException</span><span class="w"> </span><span class="n">ex</span><span class="p">)</span>
</span><span id="__span-521-9"><a id="__codelineno-521-9" name="__codelineno-521-9" href="#__codelineno-521-9"></a><span class="w">    </span><span class="p">{</span>
</span><span id="__span-521-10"><a id="__codelineno-521-10" name="__codelineno-521-10" href="#__codelineno-521-10"></a><span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">ex</span><span class="p">.</span><span class="n">Status</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">WebExceptionStatus</span><span class="p">.</span><span class="n">NameResolutionFailure</span><span class="p">)</span>
</span><span id="__span-521-11"><a id="__codelineno-521-11" name="__codelineno-521-11" href="#__codelineno-521-11"></a><span class="w">            </span><span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="w"> </span><span class="p">(</span><span class="s">&quot;Bad domain name&quot;</span><span class="p">);</span>
</span><span id="__span-521-12"><a id="__codelineno-521-12" name="__codelineno-521-12" href="#__codelineno-521-12"></a><span class="w">        </span><span class="k">else</span>
</span><span id="__span-521-13"><a id="__codelineno-521-13" name="__codelineno-521-13" href="#__codelineno-521-13"></a><span class="w">            </span><span class="k">throw</span><span class="p">;</span><span class="w">     </span><span class="c1">// Canâ€™t handle other sorts of WebException, so rethrow</span>
</span><span id="__span-521-14"><a id="__codelineno-521-14" name="__codelineno-521-14" href="#__codelineno-521-14"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-521-15"><a id="__codelineno-521-15" name="__codelineno-521-15" href="#__codelineno-521-15"></a>
</span><span id="__span-521-16"><a id="__codelineno-521-16" name="__codelineno-521-16" href="#__codelineno-521-16"></a><span class="n">s</span><span class="p">.</span><span class="n">Dump</span><span class="p">();</span>
</span></code></pre></div>
<h3 id="key-properties-of-systemexception">Key Properties of System.Exception</h3>
<p>StackTrace</p>
<ul>
<li>A string representing all the methods that are called from the origin of the exception to the catch block.</li>
</ul>
<p>Message</p>
<ul>
<li>A string with a description of the error.</li>
</ul>
<h3 id="common-exception-types">Common Exception Types</h3>
<p><strong>System.ArgumentException</strong>
Thrown when a function is called with a bogus argument. This generally indicates a program bug</p>
<p><strong>System.ArgumentNullException</strong>
Subclass of ArgumentException thatâ€™s thrown when a function argument is (unexpectedly) null.</p>
<p><strong>System.ArgumentOutOfRangeException</strong>
Subclass of ArgumentException thatâ€™s thrown when a (usually numeric) argument is too big or too small. For example, this is thrown when passing a negative number into a function that accepts only positive values.</p>
<p><strong>System.InvalidOperationException</strong>
Thrown when the state of an object is unsuitable for a method to successfully execute, regardless of any particular argument values. Examples include reading an unopened file or getting the next element from an enumerator for which the underlying list has been modified partway through the iteration.</p>
<p><strong>System.NotSupportedException</strong>
Thrown to indicate that a particular functionality is not supported. A good example is calling the Add method on a collection for which IsReadOnly returns true.</p>
<p><strong>System.NotImplementedException</strong>
Thrown to indicate that a function has not yet been implemented.</p>
<p><strong>System.ObjectDisposedException</strong>
Thrown when the object upon which the function is called has been disposed.</p>
<h1 id="enumeration-and-iterators">Enumeration and Iterators</h1>
<h3 id="enumeration">Enumeration</h3>
<p>An enumerator is a read-only, forward-only cursor over a sequence of values. C# treats a type as an enumerator if it does any of the following</p>
<ul>
<li>Implements <code>System.Collections.IEnumerator</code></li>
<li>Implements <code>System.Collections.Generic.IEnumerator</code></li>
<li>Has a public parameterless method named <code>MoveNext</code> and property called
<code>Current</code></li>
</ul>
<p>The foreach statement iterates over an enumerable object. An enumerable object is the logical representation of a sequence.</p>
<div class="language-csharp highlight"><pre><span></span><code><span id="__span-522-1"><a id="__codelineno-522-1" name="__codelineno-522-1" href="#__codelineno-522-1"></a><span class="c1">// High-level way of iterating through the characters in the word â€œbeerâ€:</span>
</span><span id="__span-522-2"><a id="__codelineno-522-2" name="__codelineno-522-2" href="#__codelineno-522-2"></a>
</span><span id="__span-522-3"><a id="__codelineno-522-3" name="__codelineno-522-3" href="#__codelineno-522-3"></a><span class="k">foreach</span><span class="w"> </span><span class="p">(</span><span class="kt">char</span><span class="w"> </span><span class="n">c</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="s">&quot;beer&quot;</span><span class="p">)</span>
</span><span id="__span-522-4"><a id="__codelineno-522-4" name="__codelineno-522-4" href="#__codelineno-522-4"></a><span class="w">    </span><span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="w"> </span><span class="p">(</span><span class="n">c</span><span class="p">);</span>
</span><span id="__span-522-5"><a id="__codelineno-522-5" name="__codelineno-522-5" href="#__codelineno-522-5"></a>
</span><span id="__span-522-6"><a id="__codelineno-522-6" name="__codelineno-522-6" href="#__codelineno-522-6"></a><span class="c1">// Low-level way of iterating through the same characters:</span>
</span><span id="__span-522-7"><a id="__codelineno-522-7" name="__codelineno-522-7" href="#__codelineno-522-7"></a>
</span><span id="__span-522-8"><a id="__codelineno-522-8" name="__codelineno-522-8" href="#__codelineno-522-8"></a><span class="k">using</span><span class="w"> </span><span class="p">(</span><span class="kt">var</span><span class="w"> </span><span class="n">enumerator</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;beer&quot;</span><span class="p">.</span><span class="n">GetEnumerator</span><span class="p">())</span>
</span><span id="__span-522-9"><a id="__codelineno-522-9" name="__codelineno-522-9" href="#__codelineno-522-9"></a><span class="w">    </span><span class="k">while</span><span class="w"> </span><span class="p">(</span><span class="n">enumerator</span><span class="p">.</span><span class="n">MoveNext</span><span class="p">())</span>
</span><span id="__span-522-10"><a id="__codelineno-522-10" name="__codelineno-522-10" href="#__codelineno-522-10"></a><span class="w">    </span><span class="p">{</span>
</span><span id="__span-522-11"><a id="__codelineno-522-11" name="__codelineno-522-11" href="#__codelineno-522-11"></a><span class="w">        </span><span class="kt">var</span><span class="w"> </span><span class="n">element</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">enumerator</span><span class="p">.</span><span class="n">Current</span><span class="p">;</span>
</span><span id="__span-522-12"><a id="__codelineno-522-12" name="__codelineno-522-12" href="#__codelineno-522-12"></a><span class="w">        </span><span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="w"> </span><span class="p">(</span><span class="n">element</span><span class="p">);</span>
</span><span id="__span-522-13"><a id="__codelineno-522-13" name="__codelineno-522-13" href="#__codelineno-522-13"></a><span class="w">    </span><span class="p">}</span>
</span></code></pre></div>
<h3 id="collection-initializers"><strong>Collection Initializers</strong></h3>
<div class="language-csharp highlight"><pre><span></span><code><span id="__span-523-1"><a id="__codelineno-523-1" name="__codelineno-523-1" href="#__codelineno-523-1"></a><span class="c1">// You can instantiate and populate an enumerable object in a single step with collection initializers:</span>
</span><span id="__span-523-2"><a id="__codelineno-523-2" name="__codelineno-523-2" href="#__codelineno-523-2"></a><span class="p">{</span>
</span><span id="__span-523-3"><a id="__codelineno-523-3" name="__codelineno-523-3" href="#__codelineno-523-3"></a><span class="w">    </span><span class="n">List</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span><span class="w"> </span><span class="n">list</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">List</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span><span class="w"> </span><span class="p">{</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="mi">3</span><span class="p">};</span><span class="w">   </span>
</span><span id="__span-523-4"><a id="__codelineno-523-4" name="__codelineno-523-4" href="#__codelineno-523-4"></a><span class="w">    </span><span class="n">list</span><span class="p">.</span><span class="n">Dump</span><span class="p">();</span>
</span><span id="__span-523-5"><a id="__codelineno-523-5" name="__codelineno-523-5" href="#__codelineno-523-5"></a><span class="p">}</span>
</span><span id="__span-523-6"><a id="__codelineno-523-6" name="__codelineno-523-6" href="#__codelineno-523-6"></a>
</span><span id="__span-523-7"><a id="__codelineno-523-7" name="__codelineno-523-7" href="#__codelineno-523-7"></a><span class="c1">// Equivalent to:</span>
</span><span id="__span-523-8"><a id="__codelineno-523-8" name="__codelineno-523-8" href="#__codelineno-523-8"></a><span class="p">{</span>
</span><span id="__span-523-9"><a id="__codelineno-523-9" name="__codelineno-523-9" href="#__codelineno-523-9"></a><span class="w">    </span><span class="n">List</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span><span class="w"> </span><span class="n">list</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">List</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span><span class="p">();</span>
</span><span id="__span-523-10"><a id="__codelineno-523-10" name="__codelineno-523-10" href="#__codelineno-523-10"></a><span class="w">    </span><span class="n">list</span><span class="p">.</span><span class="n">Add</span><span class="w"> </span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>
</span><span id="__span-523-11"><a id="__codelineno-523-11" name="__codelineno-523-11" href="#__codelineno-523-11"></a><span class="w">    </span><span class="n">list</span><span class="p">.</span><span class="n">Add</span><span class="w"> </span><span class="p">(</span><span class="mi">2</span><span class="p">);</span>
</span><span id="__span-523-12"><a id="__codelineno-523-12" name="__codelineno-523-12" href="#__codelineno-523-12"></a><span class="w">    </span><span class="n">list</span><span class="p">.</span><span class="n">Add</span><span class="w"> </span><span class="p">(</span><span class="mi">3</span><span class="p">);</span><span class="w">   </span>
</span><span id="__span-523-13"><a id="__codelineno-523-13" name="__codelineno-523-13" href="#__codelineno-523-13"></a><span class="w">    </span><span class="n">list</span><span class="p">.</span><span class="n">Dump</span><span class="p">();</span>
</span><span id="__span-523-14"><a id="__codelineno-523-14" name="__codelineno-523-14" href="#__codelineno-523-14"></a><span class="p">}</span>
</span></code></pre></div>
<h3 id="iterators">Iterators</h3>
<p>Whereas a foreach statement is a consumer of an enumerator, an iterator is a producer of an enumerator</p>
<div class="language-csharp highlight"><pre><span></span><code><span id="__span-524-1"><a id="__codelineno-524-1" name="__codelineno-524-1" href="#__codelineno-524-1"></a><span class="k">static</span><span class="w"> </span><span class="k">void</span><span class="w"> </span><span class="nf">Main</span><span class="p">()</span>
</span><span id="__span-524-2"><a id="__codelineno-524-2" name="__codelineno-524-2" href="#__codelineno-524-2"></a><span class="p">{</span>
</span><span id="__span-524-3"><a id="__codelineno-524-3" name="__codelineno-524-3" href="#__codelineno-524-3"></a><span class="w">    </span><span class="k">foreach</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">fib</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">Fibs</span><span class="p">(</span><span class="mi">6</span><span class="p">))</span>
</span><span id="__span-524-4"><a id="__codelineno-524-4" name="__codelineno-524-4" href="#__codelineno-524-4"></a><span class="w">        </span><span class="n">Console</span><span class="p">.</span><span class="n">Write</span><span class="w"> </span><span class="p">(</span><span class="n">fib</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s">&quot;  &quot;</span><span class="p">);</span>
</span><span id="__span-524-5"><a id="__codelineno-524-5" name="__codelineno-524-5" href="#__codelineno-524-5"></a><span class="p">}</span>
</span><span id="__span-524-6"><a id="__codelineno-524-6" name="__codelineno-524-6" href="#__codelineno-524-6"></a>
</span><span id="__span-524-7"><a id="__codelineno-524-7" name="__codelineno-524-7" href="#__codelineno-524-7"></a><span class="k">static</span><span class="w"> </span><span class="n">IEnumerable</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span><span class="w"> </span><span class="n">Fibs</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">fibCount</span><span class="p">)</span>
</span><span id="__span-524-8"><a id="__codelineno-524-8" name="__codelineno-524-8" href="#__codelineno-524-8"></a><span class="p">{</span>
</span><span id="__span-524-9"><a id="__codelineno-524-9" name="__codelineno-524-9" href="#__codelineno-524-9"></a><span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="n">prevFib</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">curFib</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">fibCount</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="o">++</span><span class="p">)</span>
</span><span id="__span-524-10"><a id="__codelineno-524-10" name="__codelineno-524-10" href="#__codelineno-524-10"></a><span class="w">    </span><span class="p">{</span>
</span><span id="__span-524-11"><a id="__codelineno-524-11" name="__codelineno-524-11" href="#__codelineno-524-11"></a><span class="w">        </span><span class="k">yield</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="n">prevFib</span><span class="p">;</span>
</span><span id="__span-524-12"><a id="__codelineno-524-12" name="__codelineno-524-12" href="#__codelineno-524-12"></a><span class="w">        </span><span class="kt">int</span><span class="w"> </span><span class="n">newFib</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">prevFib</span><span class="o">+</span><span class="n">curFib</span><span class="p">;</span>
</span><span id="__span-524-13"><a id="__codelineno-524-13" name="__codelineno-524-13" href="#__codelineno-524-13"></a><span class="w">        </span><span class="n">prevFib</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">curFib</span><span class="p">;</span>
</span><span id="__span-524-14"><a id="__codelineno-524-14" name="__codelineno-524-14" href="#__codelineno-524-14"></a><span class="w">        </span><span class="n">curFib</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">newFib</span><span class="p">;</span>
</span><span id="__span-524-15"><a id="__codelineno-524-15" name="__codelineno-524-15" href="#__codelineno-524-15"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-524-16"><a id="__codelineno-524-16" name="__codelineno-524-16" href="#__codelineno-524-16"></a><span class="p">}</span>
</span><span id="__span-524-17"><a id="__codelineno-524-17" name="__codelineno-524-17" href="#__codelineno-524-17"></a><span class="c1">//1  1  2  3  5  8</span>
</span></code></pre></div>
<p>Whereas a return statement expresses <strong>â€œHereâ€™s the value you asked me to return from this method,â€</strong> a yield return statement expresses <strong>â€œHereâ€™s the next element you asked me to yield from this enumerator.â€</strong> On each yield statement, control is returned to the caller, but the calleeâ€™s state is maintained so that the method can continue executing as soon as the caller enumerates the next element. The lifetime of this state is bound to the enumerator such that the state can be released when the caller has finished enumerating.</p>
<h3 id="iterator-semantics">Iterator Semantics</h3>
<p>An iterator is a method, property, or indexer that contains one or more yield statements. An iterator must return one of the following four interfaces (otherwise, the compiler will generate an error):</p>
<div class="language-csharp highlight"><pre><span></span><code><span id="__span-525-1"><a id="__codelineno-525-1" name="__codelineno-525-1" href="#__codelineno-525-1"></a><span class="c1">// Enumerable interfaces</span>
</span><span id="__span-525-2"><a id="__codelineno-525-2" name="__codelineno-525-2" href="#__codelineno-525-2"></a><span class="n">System</span><span class="p">.</span><span class="n">Collections</span><span class="p">.</span><span class="n">IEnumerable</span>
</span><span id="__span-525-3"><a id="__codelineno-525-3" name="__codelineno-525-3" href="#__codelineno-525-3"></a><span class="n">System</span><span class="p">.</span><span class="n">Collections</span><span class="p">.</span><span class="n">Generic</span><span class="p">.</span><span class="n">IEnumerable</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span>
</span><span id="__span-525-4"><a id="__codelineno-525-4" name="__codelineno-525-4" href="#__codelineno-525-4"></a><span class="c1">// Enumerator interfaces</span>
</span><span id="__span-525-5"><a id="__codelineno-525-5" name="__codelineno-525-5" href="#__codelineno-525-5"></a><span class="n">System</span><span class="p">.</span><span class="n">Collections</span><span class="p">.</span><span class="n">IEnumerator</span>
</span><span id="__span-525-6"><a id="__codelineno-525-6" name="__codelineno-525-6" href="#__codelineno-525-6"></a><span class="n">System</span><span class="p">.</span><span class="n">Collections</span><span class="p">.</span><span class="n">Generic</span><span class="p">.</span><span class="n">IEnumerator</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span>
</span></code></pre></div>
<p>Multiple yield statements are permitted</p>
<div class="language-csharp highlight"><pre><span></span><code><span id="__span-526-1"><a id="__codelineno-526-1" name="__codelineno-526-1" href="#__codelineno-526-1"></a><span class="k">class</span><span class="w"> </span><span class="nc">Test</span>
</span><span id="__span-526-2"><a id="__codelineno-526-2" name="__codelineno-526-2" href="#__codelineno-526-2"></a><span class="p">{</span>
</span><span id="__span-526-3"><a id="__codelineno-526-3" name="__codelineno-526-3" href="#__codelineno-526-3"></a><span class="w"> </span><span class="k">static</span><span class="w"> </span><span class="k">void</span><span class="w"> </span><span class="nf">Main</span><span class="p">()</span>
</span><span id="__span-526-4"><a id="__codelineno-526-4" name="__codelineno-526-4" href="#__codelineno-526-4"></a><span class="w"> </span><span class="p">{</span>
</span><span id="__span-526-5"><a id="__codelineno-526-5" name="__codelineno-526-5" href="#__codelineno-526-5"></a><span class="w"> </span><span class="k">foreach</span><span class="w"> </span><span class="p">(</span><span class="kt">string</span><span class="w"> </span><span class="n">s</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">Foo</span><span class="p">())</span>
</span><span id="__span-526-6"><a id="__codelineno-526-6" name="__codelineno-526-6" href="#__codelineno-526-6"></a><span class="w"> </span><span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="p">(</span><span class="n">s</span><span class="p">);</span><span class="w"> </span><span class="c1">// Prints &quot;One&quot;,&quot;Two&quot;,&quot;Three&quot;</span>
</span><span id="__span-526-7"><a id="__codelineno-526-7" name="__codelineno-526-7" href="#__codelineno-526-7"></a><span class="w"> </span><span class="p">}</span>
</span><span id="__span-526-8"><a id="__codelineno-526-8" name="__codelineno-526-8" href="#__codelineno-526-8"></a><span class="w"> </span><span class="k">static</span><span class="w"> </span><span class="n">IEnumerable</span><span class="o">&lt;</span><span class="kt">string</span><span class="o">&gt;</span><span class="w"> </span><span class="n">Foo</span><span class="p">()</span>
</span><span id="__span-526-9"><a id="__codelineno-526-9" name="__codelineno-526-9" href="#__codelineno-526-9"></a><span class="w"> </span><span class="p">{</span>
</span><span id="__span-526-10"><a id="__codelineno-526-10" name="__codelineno-526-10" href="#__codelineno-526-10"></a><span class="w"> </span><span class="k">yield</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="s">&quot;One&quot;</span><span class="p">;</span>
</span><span id="__span-526-11"><a id="__codelineno-526-11" name="__codelineno-526-11" href="#__codelineno-526-11"></a><span class="w"> </span><span class="k">yield</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="s">&quot;Two&quot;</span><span class="p">;</span>
</span><span id="__span-526-12"><a id="__codelineno-526-12" name="__codelineno-526-12" href="#__codelineno-526-12"></a><span class="w"> </span><span class="k">yield</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="s">&quot;Three&quot;</span><span class="p">;</span>
</span><span id="__span-526-13"><a id="__codelineno-526-13" name="__codelineno-526-13" href="#__codelineno-526-13"></a><span class="w"> </span><span class="p">}</span>
</span><span id="__span-526-14"><a id="__codelineno-526-14" name="__codelineno-526-14" href="#__codelineno-526-14"></a><span class="p">}</span>
</span></code></pre></div>
<h3 id="yield-break">yield break</h3>
<p>A return statement is illegal in an iterator block; instead you must use the yield break statement to indicate that the iterator block should exit early, without returning more elements.</p>
<div class="language-csharp highlight"><pre><span></span><code><span id="__span-527-1"><a id="__codelineno-527-1" name="__codelineno-527-1" href="#__codelineno-527-1"></a><span class="c1">// The yield break statement indicates that the iterator block should exit early,</span>
</span><span id="__span-527-2"><a id="__codelineno-527-2" name="__codelineno-527-2" href="#__codelineno-527-2"></a><span class="c1">// without returning more elements:</span>
</span><span id="__span-527-3"><a id="__codelineno-527-3" name="__codelineno-527-3" href="#__codelineno-527-3"></a>
</span><span id="__span-527-4"><a id="__codelineno-527-4" name="__codelineno-527-4" href="#__codelineno-527-4"></a><span class="k">static</span><span class="w"> </span><span class="k">void</span><span class="w"> </span><span class="nf">Main</span><span class="p">()</span>
</span><span id="__span-527-5"><a id="__codelineno-527-5" name="__codelineno-527-5" href="#__codelineno-527-5"></a><span class="p">{</span>
</span><span id="__span-527-6"><a id="__codelineno-527-6" name="__codelineno-527-6" href="#__codelineno-527-6"></a><span class="w">    </span><span class="k">foreach</span><span class="w"> </span><span class="p">(</span><span class="kt">string</span><span class="w"> </span><span class="n">s</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">Foo</span><span class="w"> </span><span class="p">(</span><span class="k">true</span><span class="p">))</span>
</span><span id="__span-527-7"><a id="__codelineno-527-7" name="__codelineno-527-7" href="#__codelineno-527-7"></a><span class="w">        </span><span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="p">(</span><span class="n">s</span><span class="p">);</span>
</span><span id="__span-527-8"><a id="__codelineno-527-8" name="__codelineno-527-8" href="#__codelineno-527-8"></a><span class="p">}</span>
</span><span id="__span-527-9"><a id="__codelineno-527-9" name="__codelineno-527-9" href="#__codelineno-527-9"></a>
</span><span id="__span-527-10"><a id="__codelineno-527-10" name="__codelineno-527-10" href="#__codelineno-527-10"></a><span class="k">static</span><span class="w"> </span><span class="n">IEnumerable</span><span class="o">&lt;</span><span class="kt">string</span><span class="o">&gt;</span><span class="w"> </span><span class="n">Foo</span><span class="w"> </span><span class="p">(</span><span class="kt">bool</span><span class="w"> </span><span class="n">breakEarly</span><span class="p">)</span>
</span><span id="__span-527-11"><a id="__codelineno-527-11" name="__codelineno-527-11" href="#__codelineno-527-11"></a><span class="p">{</span>
</span><span id="__span-527-12"><a id="__codelineno-527-12" name="__codelineno-527-12" href="#__codelineno-527-12"></a><span class="w">    </span><span class="k">yield</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="s">&quot;One&quot;</span><span class="p">;</span>
</span><span id="__span-527-13"><a id="__codelineno-527-13" name="__codelineno-527-13" href="#__codelineno-527-13"></a><span class="w">    </span><span class="k">yield</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="s">&quot;Two&quot;</span><span class="p">;</span>
</span><span id="__span-527-14"><a id="__codelineno-527-14" name="__codelineno-527-14" href="#__codelineno-527-14"></a>
</span><span id="__span-527-15"><a id="__codelineno-527-15" name="__codelineno-527-15" href="#__codelineno-527-15"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">breakEarly</span><span class="p">)</span>
</span><span id="__span-527-16"><a id="__codelineno-527-16" name="__codelineno-527-16" href="#__codelineno-527-16"></a><span class="w">        </span><span class="k">yield</span><span class="w"> </span><span class="k">break</span><span class="p">;</span>
</span><span id="__span-527-17"><a id="__codelineno-527-17" name="__codelineno-527-17" href="#__codelineno-527-17"></a>
</span><span id="__span-527-18"><a id="__codelineno-527-18" name="__codelineno-527-18" href="#__codelineno-527-18"></a><span class="w">    </span><span class="k">yield</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="s">&quot;Three&quot;</span><span class="p">;</span>
</span><span id="__span-527-19"><a id="__codelineno-527-19" name="__codelineno-527-19" href="#__codelineno-527-19"></a><span class="p">}</span>
</span></code></pre></div>
<h3 id="iterators-and-trycatchfinally-blocks">Iterators and try/catch/finally blocks</h3>
<div class="language-csharp highlight"><pre><span></span><code><span id="__span-528-1"><a id="__codelineno-528-1" name="__codelineno-528-1" href="#__codelineno-528-1"></a><span class="c1">// A yield return statement cannot appear in a try block that has a catch clause:</span>
</span><span id="__span-528-2"><a id="__codelineno-528-2" name="__codelineno-528-2" href="#__codelineno-528-2"></a>
</span><span id="__span-528-3"><a id="__codelineno-528-3" name="__codelineno-528-3" href="#__codelineno-528-3"></a><span class="k">static</span><span class="w"> </span><span class="k">void</span><span class="w"> </span><span class="nf">Main</span><span class="p">()</span>
</span><span id="__span-528-4"><a id="__codelineno-528-4" name="__codelineno-528-4" href="#__codelineno-528-4"></a><span class="p">{</span>
</span><span id="__span-528-5"><a id="__codelineno-528-5" name="__codelineno-528-5" href="#__codelineno-528-5"></a><span class="w">    </span><span class="k">foreach</span><span class="w"> </span><span class="p">(</span><span class="kt">string</span><span class="w"> </span><span class="n">s</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">Foo</span><span class="p">())</span>
</span><span id="__span-528-6"><a id="__codelineno-528-6" name="__codelineno-528-6" href="#__codelineno-528-6"></a><span class="w">        </span><span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="p">(</span><span class="n">s</span><span class="p">);</span>
</span><span id="__span-528-7"><a id="__codelineno-528-7" name="__codelineno-528-7" href="#__codelineno-528-7"></a><span class="p">}</span>
</span><span id="__span-528-8"><a id="__codelineno-528-8" name="__codelineno-528-8" href="#__codelineno-528-8"></a>
</span><span id="__span-528-9"><a id="__codelineno-528-9" name="__codelineno-528-9" href="#__codelineno-528-9"></a><span class="k">static</span><span class="w"> </span><span class="n">IEnumerable</span><span class="o">&lt;</span><span class="kt">string</span><span class="o">&gt;</span><span class="w"> </span><span class="n">Foo</span><span class="p">()</span>
</span><span id="__span-528-10"><a id="__codelineno-528-10" name="__codelineno-528-10" href="#__codelineno-528-10"></a><span class="p">{</span>
</span><span id="__span-528-11"><a id="__codelineno-528-11" name="__codelineno-528-11" href="#__codelineno-528-11"></a><span class="w">    </span><span class="k">try</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">yield</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="s">&quot;One&quot;</span><span class="p">;</span><span class="w"> </span><span class="p">}</span><span class="w">     </span><span class="c1">// Illegal</span>
</span><span id="__span-528-12"><a id="__codelineno-528-12" name="__codelineno-528-12" href="#__codelineno-528-12"></a><span class="w">    </span><span class="k">catch</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="cm">/*...*/</span><span class="w"> </span><span class="p">}</span>
</span><span id="__span-528-13"><a id="__codelineno-528-13" name="__codelineno-528-13" href="#__codelineno-528-13"></a><span class="p">}</span>
</span></code></pre></div>
<div class="language-csharp highlight"><pre><span></span><code><span id="__span-529-1"><a id="__codelineno-529-1" name="__codelineno-529-1" href="#__codelineno-529-1"></a><span class="c1">// You can, however, yield within a try block that has (only) a finally block:</span>
</span><span id="__span-529-2"><a id="__codelineno-529-2" name="__codelineno-529-2" href="#__codelineno-529-2"></a>
</span><span id="__span-529-3"><a id="__codelineno-529-3" name="__codelineno-529-3" href="#__codelineno-529-3"></a><span class="k">static</span><span class="w"> </span><span class="k">void</span><span class="w"> </span><span class="nf">Main</span><span class="p">()</span>
</span><span id="__span-529-4"><a id="__codelineno-529-4" name="__codelineno-529-4" href="#__codelineno-529-4"></a><span class="p">{</span>
</span><span id="__span-529-5"><a id="__codelineno-529-5" name="__codelineno-529-5" href="#__codelineno-529-5"></a><span class="w">    </span><span class="k">foreach</span><span class="w"> </span><span class="p">(</span><span class="kt">string</span><span class="w"> </span><span class="n">s</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">Foo</span><span class="p">())</span><span class="w"> </span><span class="n">s</span><span class="p">.</span><span class="n">Dump</span><span class="p">();</span><span class="w">   </span>
</span><span id="__span-529-6"><a id="__codelineno-529-6" name="__codelineno-529-6" href="#__codelineno-529-6"></a><span class="w">    </span><span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="p">();</span><span class="w">        </span>
</span><span id="__span-529-7"><a id="__codelineno-529-7" name="__codelineno-529-7" href="#__codelineno-529-7"></a><span class="w">    </span><span class="k">foreach</span><span class="w"> </span><span class="p">(</span><span class="kt">string</span><span class="w"> </span><span class="n">s</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">Foo</span><span class="p">())</span>
</span><span id="__span-529-8"><a id="__codelineno-529-8" name="__codelineno-529-8" href="#__codelineno-529-8"></a><span class="w">    </span><span class="p">{</span>
</span><span id="__span-529-9"><a id="__codelineno-529-9" name="__codelineno-529-9" href="#__codelineno-529-9"></a><span class="w">        </span><span class="p">(</span><span class="s">&quot;First element is &quot;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">s</span><span class="p">).</span><span class="n">Dump</span><span class="p">();</span>
</span><span id="__span-529-10"><a id="__codelineno-529-10" name="__codelineno-529-10" href="#__codelineno-529-10"></a><span class="w">        </span><span class="k">break</span><span class="p">;</span>
</span><span id="__span-529-11"><a id="__codelineno-529-11" name="__codelineno-529-11" href="#__codelineno-529-11"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-529-12"><a id="__codelineno-529-12" name="__codelineno-529-12" href="#__codelineno-529-12"></a><span class="p">}</span>
</span><span id="__span-529-13"><a id="__codelineno-529-13" name="__codelineno-529-13" href="#__codelineno-529-13"></a>
</span><span id="__span-529-14"><a id="__codelineno-529-14" name="__codelineno-529-14" href="#__codelineno-529-14"></a><span class="k">static</span><span class="w"> </span><span class="n">IEnumerable</span><span class="o">&lt;</span><span class="kt">string</span><span class="o">&gt;</span><span class="w"> </span><span class="n">Foo</span><span class="p">()</span>
</span><span id="__span-529-15"><a id="__codelineno-529-15" name="__codelineno-529-15" href="#__codelineno-529-15"></a><span class="p">{</span>
</span><span id="__span-529-16"><a id="__codelineno-529-16" name="__codelineno-529-16" href="#__codelineno-529-16"></a><span class="w">    </span><span class="k">try</span><span class="w"> </span>
</span><span id="__span-529-17"><a id="__codelineno-529-17" name="__codelineno-529-17" href="#__codelineno-529-17"></a><span class="w">    </span><span class="p">{</span>
</span><span id="__span-529-18"><a id="__codelineno-529-18" name="__codelineno-529-18" href="#__codelineno-529-18"></a><span class="w">        </span><span class="k">yield</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="s">&quot;One&quot;</span><span class="p">;</span>
</span><span id="__span-529-19"><a id="__codelineno-529-19" name="__codelineno-529-19" href="#__codelineno-529-19"></a><span class="w">        </span><span class="k">yield</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="s">&quot;Two&quot;</span><span class="p">;</span>
</span><span id="__span-529-20"><a id="__codelineno-529-20" name="__codelineno-529-20" href="#__codelineno-529-20"></a><span class="w">        </span><span class="k">yield</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="s">&quot;Three&quot;</span><span class="p">;</span>
</span><span id="__span-529-21"><a id="__codelineno-529-21" name="__codelineno-529-21" href="#__codelineno-529-21"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-529-22"><a id="__codelineno-529-22" name="__codelineno-529-22" href="#__codelineno-529-22"></a><span class="w">    </span><span class="k">finally</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="s">&quot;Finally&quot;</span><span class="p">.</span><span class="n">Dump</span><span class="p">();</span><span class="w"> </span><span class="p">}</span>
</span><span id="__span-529-23"><a id="__codelineno-529-23" name="__codelineno-529-23" href="#__codelineno-529-23"></a><span class="p">}</span>
</span></code></pre></div>
<h3 id="composing-sequences">Composing Sequences</h3>
<div class="language-csharp highlight"><pre><span></span><code><span id="__span-530-1"><a id="__codelineno-530-1" name="__codelineno-530-1" href="#__codelineno-530-1"></a><span class="c1">// Iterators are highly composable:</span>
</span><span id="__span-530-2"><a id="__codelineno-530-2" name="__codelineno-530-2" href="#__codelineno-530-2"></a>
</span><span id="__span-530-3"><a id="__codelineno-530-3" name="__codelineno-530-3" href="#__codelineno-530-3"></a><span class="k">static</span><span class="w"> </span><span class="k">void</span><span class="w"> </span><span class="nf">Main</span><span class="p">()</span>
</span><span id="__span-530-4"><a id="__codelineno-530-4" name="__codelineno-530-4" href="#__codelineno-530-4"></a><span class="p">{</span>
</span><span id="__span-530-5"><a id="__codelineno-530-5" name="__codelineno-530-5" href="#__codelineno-530-5"></a><span class="w">    </span><span class="k">foreach</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">fib</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">EvenNumbersOnly</span><span class="w"> </span><span class="p">(</span><span class="n">Fibs</span><span class="p">(</span><span class="mi">6</span><span class="p">)))</span>
</span><span id="__span-530-6"><a id="__codelineno-530-6" name="__codelineno-530-6" href="#__codelineno-530-6"></a><span class="w">        </span><span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="w"> </span><span class="p">(</span><span class="n">fib</span><span class="p">);</span>
</span><span id="__span-530-7"><a id="__codelineno-530-7" name="__codelineno-530-7" href="#__codelineno-530-7"></a><span class="p">}</span>
</span><span id="__span-530-8"><a id="__codelineno-530-8" name="__codelineno-530-8" href="#__codelineno-530-8"></a>
</span><span id="__span-530-9"><a id="__codelineno-530-9" name="__codelineno-530-9" href="#__codelineno-530-9"></a><span class="k">static</span><span class="w"> </span><span class="n">IEnumerable</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span><span class="w"> </span><span class="n">Fibs</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">fibCount</span><span class="p">)</span>
</span><span id="__span-530-10"><a id="__codelineno-530-10" name="__codelineno-530-10" href="#__codelineno-530-10"></a><span class="p">{</span>
</span><span id="__span-530-11"><a id="__codelineno-530-11" name="__codelineno-530-11" href="#__codelineno-530-11"></a><span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="n">prevFib</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">curFib</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">fibCount</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="o">++</span><span class="p">)</span>
</span><span id="__span-530-12"><a id="__codelineno-530-12" name="__codelineno-530-12" href="#__codelineno-530-12"></a><span class="w">    </span><span class="p">{</span>
</span><span id="__span-530-13"><a id="__codelineno-530-13" name="__codelineno-530-13" href="#__codelineno-530-13"></a><span class="w">        </span><span class="k">yield</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="n">prevFib</span><span class="p">;</span>
</span><span id="__span-530-14"><a id="__codelineno-530-14" name="__codelineno-530-14" href="#__codelineno-530-14"></a><span class="w">        </span><span class="kt">int</span><span class="w"> </span><span class="n">newFib</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">prevFib</span><span class="o">+</span><span class="n">curFib</span><span class="p">;</span>
</span><span id="__span-530-15"><a id="__codelineno-530-15" name="__codelineno-530-15" href="#__codelineno-530-15"></a><span class="w">        </span><span class="n">prevFib</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">curFib</span><span class="p">;</span>
</span><span id="__span-530-16"><a id="__codelineno-530-16" name="__codelineno-530-16" href="#__codelineno-530-16"></a><span class="w">        </span><span class="n">curFib</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">newFib</span><span class="p">;</span>
</span><span id="__span-530-17"><a id="__codelineno-530-17" name="__codelineno-530-17" href="#__codelineno-530-17"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-530-18"><a id="__codelineno-530-18" name="__codelineno-530-18" href="#__codelineno-530-18"></a><span class="p">}</span>
</span><span id="__span-530-19"><a id="__codelineno-530-19" name="__codelineno-530-19" href="#__codelineno-530-19"></a>
</span><span id="__span-530-20"><a id="__codelineno-530-20" name="__codelineno-530-20" href="#__codelineno-530-20"></a><span class="k">static</span><span class="w"> </span><span class="n">IEnumerable</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span><span class="w"> </span><span class="n">EvenNumbersOnly</span><span class="w"> </span><span class="p">(</span><span class="n">IEnumerable</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span><span class="w"> </span><span class="n">sequence</span><span class="p">)</span>
</span><span id="__span-530-21"><a id="__codelineno-530-21" name="__codelineno-530-21" href="#__codelineno-530-21"></a><span class="p">{</span>
</span><span id="__span-530-22"><a id="__codelineno-530-22" name="__codelineno-530-22" href="#__codelineno-530-22"></a><span class="w">    </span><span class="k">foreach</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">sequence</span><span class="p">)</span>
</span><span id="__span-530-23"><a id="__codelineno-530-23" name="__codelineno-530-23" href="#__codelineno-530-23"></a><span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">((</span><span class="n">x</span><span class="w"> </span><span class="o">%</span><span class="w"> </span><span class="mi">2</span><span class="p">)</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span>
</span><span id="__span-530-24"><a id="__codelineno-530-24" name="__codelineno-530-24" href="#__codelineno-530-24"></a><span class="w">            </span><span class="k">yield</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="n">x</span><span class="p">;</span>
</span><span id="__span-530-25"><a id="__codelineno-530-25" name="__codelineno-530-25" href="#__codelineno-530-25"></a><span class="p">}</span>
</span></code></pre></div>
<h1 id="nullable-types">Nullable Types</h1>
<p>Reference types can represent a nonexistent value with a null reference. Value types, however, cannot ordinarily represent null values. For example:</p>
<div class="language-csharp highlight"><pre><span></span><code><span id="__span-531-1"><a id="__codelineno-531-1" name="__codelineno-531-1" href="#__codelineno-531-1"></a><span class="kt">string</span><span class="w"> </span><span class="n">s</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">null</span><span class="p">;</span><span class="w"> </span><span class="c1">// OK, Reference Type</span>
</span><span id="__span-531-2"><a id="__codelineno-531-2" name="__codelineno-531-2" href="#__codelineno-531-2"></a><span class="kt">int</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">null</span><span class="p">;</span><span class="w"> </span><span class="c1">// Compile Error, Value Type cannot be null</span>
</span></code></pre></div>
<p>To represent null in a value type, you must use a special construct called a nullable type. A nullable type is denoted with a value type followed by the ? symbol:</p>
<div class="language-csharp highlight"><pre><span></span><code><span id="__span-532-1"><a id="__codelineno-532-1" name="__codelineno-532-1" href="#__codelineno-532-1"></a><span class="kt">int?</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">null</span><span class="p">;</span><span class="w"> </span><span class="c1">// OK, Nullable Type</span>
</span><span id="__span-532-2"><a id="__codelineno-532-2" name="__codelineno-532-2" href="#__codelineno-532-2"></a><span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="w"> </span><span class="p">(</span><span class="n">i</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="k">null</span><span class="p">);</span><span class="w"> </span><span class="c1">// True</span>
</span></code></pre></div>
<h3 id="nullable-struct">Nullable<T> Struct</h3>
<p>T? translates into System.Nullable, which is a lightweight immutable structure, having only two fields, to represent Value and HasValue. The essence of System .Nullable is very simple:</p>
<div class="language-csharp highlight"><pre><span></span><code><span id="__span-533-1"><a id="__codelineno-533-1" name="__codelineno-533-1" href="#__codelineno-533-1"></a><span class="k">public</span><span class="w"> </span><span class="k">struct</span><span class="w"> </span><span class="nc">Nullable</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span><span class="w"> </span><span class="k">where</span><span class="w"> </span><span class="n">T</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="k">struct</span>
</span><span id="__span-533-2"><a id="__codelineno-533-2" name="__codelineno-533-2" href="#__codelineno-533-2"></a><span class="p">{</span>
</span><span id="__span-533-3"><a id="__codelineno-533-3" name="__codelineno-533-3" href="#__codelineno-533-3"></a><span class="w"> </span><span class="k">public</span><span class="w"> </span><span class="n">T</span><span class="w"> </span><span class="n">Value</span><span class="w"> </span><span class="p">{</span><span class="k">get</span><span class="p">;}</span>
</span><span id="__span-533-4"><a id="__codelineno-533-4" name="__codelineno-533-4" href="#__codelineno-533-4"></a><span class="w"> </span><span class="k">public</span><span class="w"> </span><span class="kt">bool</span><span class="w"> </span><span class="n">HasValue</span><span class="w"> </span><span class="p">{</span><span class="k">get</span><span class="p">;}</span>
</span><span id="__span-533-5"><a id="__codelineno-533-5" name="__codelineno-533-5" href="#__codelineno-533-5"></a><span class="w">  </span><span class="k">public</span><span class="w"> </span><span class="n">T</span><span class="w"> </span><span class="nf">GetValueOrDefault</span><span class="p">();</span>
</span><span id="__span-533-6"><a id="__codelineno-533-6" name="__codelineno-533-6" href="#__codelineno-533-6"></a><span class="w"> </span><span class="k">public</span><span class="w"> </span><span class="n">T</span><span class="w"> </span><span class="nf">GetValueOrDefault</span><span class="w"> </span><span class="p">(</span><span class="n">T</span><span class="w"> </span><span class="n">defaultValue</span><span class="p">);</span>
</span><span id="__span-533-7"><a id="__codelineno-533-7" name="__codelineno-533-7" href="#__codelineno-533-7"></a><span class="w"> </span><span class="p">...</span>
</span><span id="__span-533-8"><a id="__codelineno-533-8" name="__codelineno-533-8" href="#__codelineno-533-8"></a><span class="p">}</span>
</span><span id="__span-533-9"><a id="__codelineno-533-9" name="__codelineno-533-9" href="#__codelineno-533-9"></a><span class="c1">//The code:</span>
</span><span id="__span-533-10"><a id="__codelineno-533-10" name="__codelineno-533-10" href="#__codelineno-533-10"></a><span class="kt">int?</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">null</span><span class="p">;</span>
</span><span id="__span-533-11"><a id="__codelineno-533-11" name="__codelineno-533-11" href="#__codelineno-533-11"></a><span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="w"> </span><span class="p">(</span><span class="n">i</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="k">null</span><span class="p">);</span><span class="w"> </span><span class="c1">// True</span>
</span><span id="__span-533-12"><a id="__codelineno-533-12" name="__codelineno-533-12" href="#__codelineno-533-12"></a><span class="c1">//translates to:</span>
</span><span id="__span-533-13"><a id="__codelineno-533-13" name="__codelineno-533-13" href="#__codelineno-533-13"></a><span class="n">Nullable</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">Nullable</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span><span class="p">();</span>
</span><span id="__span-533-14"><a id="__codelineno-533-14" name="__codelineno-533-14" href="#__codelineno-533-14"></a><span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="w"> </span><span class="n">i</span><span class="p">.</span><span class="n">HasValue</span><span class="p">);</span><span class="w"> </span><span class="c1">// True</span>
</span></code></pre></div>
<h3 id="scenarios-for-nullable-value-types">Scenarios for Nullable Value Types</h3>
<p>One of the most common scenarios for nullable value types is to represent unknown values. This frequently occurs in database programming, where a class is mapped to a table with nullable columns. If these columns are strings (e.g., an EmailAddress column on a Customer table), there is no problem because string is a reference type in the CLR, which can be null. </p>
<h1 id="extension-methods">Extension Methods</h1>
<p>Extension methods allow an existing type to be extended with new methods without altering the definition of the original type. An extension method is a static method of a static class, where the this modifier is applied to the first parameter. The type of the first parameter will be the type that is extended. For example:</p>
<div class="language-csharp highlight"><pre><span></span><code><span id="__span-534-1"><a id="__codelineno-534-1" name="__codelineno-534-1" href="#__codelineno-534-1"></a><span class="k">public</span><span class="w"> </span><span class="k">static</span><span class="w"> </span><span class="k">class</span><span class="w"> </span><span class="nc">StringHelper</span>
</span><span id="__span-534-2"><a id="__codelineno-534-2" name="__codelineno-534-2" href="#__codelineno-534-2"></a><span class="p">{</span>
</span><span id="__span-534-3"><a id="__codelineno-534-3" name="__codelineno-534-3" href="#__codelineno-534-3"></a><span class="w"> </span><span class="k">public</span><span class="w"> </span><span class="k">static</span><span class="w"> </span><span class="kt">bool</span><span class="w"> </span><span class="nf">IsCapitalized</span><span class="w"> </span><span class="p">(</span><span class="k">this</span><span class="w"> </span><span class="kt">string</span><span class="w"> </span><span class="n">s</span><span class="p">)</span>
</span><span id="__span-534-4"><a id="__codelineno-534-4" name="__codelineno-534-4" href="#__codelineno-534-4"></a><span class="w"> </span><span class="p">{</span>
</span><span id="__span-534-5"><a id="__codelineno-534-5" name="__codelineno-534-5" href="#__codelineno-534-5"></a><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="kt">string</span><span class="p">.</span><span class="n">IsNullOrEmpty</span><span class="p">(</span><span class="n">s</span><span class="p">))</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="k">false</span><span class="p">;</span>
</span><span id="__span-534-6"><a id="__codelineno-534-6" name="__codelineno-534-6" href="#__codelineno-534-6"></a><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="kt">char</span><span class="p">.</span><span class="n">IsUpper</span><span class="w"> </span><span class="p">(</span><span class="n">s</span><span class="p">[</span><span class="mi">0</span><span class="p">]);</span>
</span><span id="__span-534-7"><a id="__codelineno-534-7" name="__codelineno-534-7" href="#__codelineno-534-7"></a><span class="w"> </span><span class="p">}</span>
</span><span id="__span-534-8"><a id="__codelineno-534-8" name="__codelineno-534-8" href="#__codelineno-534-8"></a><span class="p">}</span>
</span></code></pre></div>
<p>The IsCapitalized extension method can be called as though it were an instance method on a string, as follows:</p>
<div class="language-csharp highlight"><pre><span></span><code><span id="__span-535-1"><a id="__codelineno-535-1" name="__codelineno-535-1" href="#__codelineno-535-1"></a><span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="w"> </span><span class="p">(</span><span class="s">&quot;Perth&quot;</span><span class="p">.</span><span class="n">IsCapitalized</span><span class="p">());</span>
</span></code></pre></div>
<p>An extension method call, when compiled, is translated back into an ordinary static method call:</p>
<div class="language-csharp highlight"><pre><span></span><code><span id="__span-536-1"><a id="__codelineno-536-1" name="__codelineno-536-1" href="#__codelineno-536-1"></a><span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="w"> </span><span class="p">(</span><span class="n">StringHelper</span><span class="p">.</span><span class="n">IsCapitalized</span><span class="w"> </span><span class="p">(</span><span class="s">&quot;Perth&quot;</span><span class="p">));</span>
</span></code></pre></div>
<h3 id="extension-method-chaining">Extension Method Chaining</h3>
<p>Extension methods, like instance methods, provide a tidy way to chain functions. Consider the following two functions:</p>
<div class="language-csharp highlight"><pre><span></span><code><span id="__span-537-1"><a id="__codelineno-537-1" name="__codelineno-537-1" href="#__codelineno-537-1"></a><span class="k">public</span><span class="w"> </span><span class="k">static</span><span class="w"> </span><span class="k">class</span><span class="w"> </span><span class="nc">StringHelper</span>
</span><span id="__span-537-2"><a id="__codelineno-537-2" name="__codelineno-537-2" href="#__codelineno-537-2"></a><span class="p">{</span>
</span><span id="__span-537-3"><a id="__codelineno-537-3" name="__codelineno-537-3" href="#__codelineno-537-3"></a><span class="w"> </span><span class="k">public</span><span class="w"> </span><span class="k">static</span><span class="w"> </span><span class="kt">string</span><span class="w"> </span><span class="nf">Pluralize</span><span class="w"> </span><span class="p">(</span><span class="k">this</span><span class="w"> </span><span class="kt">string</span><span class="w"> </span><span class="n">s</span><span class="p">)</span><span class="w"> </span><span class="p">{...}</span>
</span><span id="__span-537-4"><a id="__codelineno-537-4" name="__codelineno-537-4" href="#__codelineno-537-4"></a><span class="w"> </span><span class="k">public</span><span class="w"> </span><span class="k">static</span><span class="w"> </span><span class="kt">string</span><span class="w"> </span><span class="nf">Capitalize</span><span class="w"> </span><span class="p">(</span><span class="k">this</span><span class="w"> </span><span class="kt">string</span><span class="w"> </span><span class="n">s</span><span class="p">)</span><span class="w"> </span><span class="p">{...}</span>
</span><span id="__span-537-5"><a id="__codelineno-537-5" name="__codelineno-537-5" href="#__codelineno-537-5"></a><span class="p">}</span>
</span><span id="__span-537-6"><a id="__codelineno-537-6" name="__codelineno-537-6" href="#__codelineno-537-6"></a><span class="c1">//x and y are equivalent and both evaluate to &quot;Sausages&quot;, but x uses extension methâ€</span>
</span><span id="__span-537-7"><a id="__codelineno-537-7" name="__codelineno-537-7" href="#__codelineno-537-7"></a><span class="c1">//ods, whereas y uses static methods:</span>
</span><span id="__span-537-8"><a id="__codelineno-537-8" name="__codelineno-537-8" href="#__codelineno-537-8"></a><span class="kt">string</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;sausage&quot;</span><span class="p">.</span><span class="n">Pluralize</span><span class="p">().</span><span class="n">Capitalize</span><span class="p">();</span>
</span><span id="__span-537-9"><a id="__codelineno-537-9" name="__codelineno-537-9" href="#__codelineno-537-9"></a><span class="kt">string</span><span class="w"> </span><span class="n">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">StringHelper</span><span class="p">.</span><span class="n">Capitalize</span><span class="w"> </span><span class="p">(</span><span class="n">StringHelper</span><span class="p">.</span><span class="n">Pluralize</span><span class="w"> </span><span class="p">(</span><span class="s">&quot;sausage&quot;</span><span class="p">));</span>
</span></code></pre></div>
<h3 id="extension-method-namespaces">Extension Method Namespaces</h3>
<p>An extension method cannot be accessed unless its class is in scope, typically by its namespace being imported.</p>
<div class="language-csharp highlight"><pre><span></span><code><span id="__span-538-1"><a id="__codelineno-538-1" name="__codelineno-538-1" href="#__codelineno-538-1"></a><span class="k">using</span><span class="w"> </span><span class="nn">System</span><span class="p">;</span>
</span><span id="__span-538-2"><a id="__codelineno-538-2" name="__codelineno-538-2" href="#__codelineno-538-2"></a><span class="k">namespace</span><span class="w"> </span><span class="nn">Utils</span>
</span><span id="__span-538-3"><a id="__codelineno-538-3" name="__codelineno-538-3" href="#__codelineno-538-3"></a><span class="p">{</span>
</span><span id="__span-538-4"><a id="__codelineno-538-4" name="__codelineno-538-4" href="#__codelineno-538-4"></a><span class="w"> </span><span class="k">public</span><span class="w"> </span><span class="k">static</span><span class="w"> </span><span class="k">class</span><span class="w"> </span><span class="nc">StringHelper</span>
</span><span id="__span-538-5"><a id="__codelineno-538-5" name="__codelineno-538-5" href="#__codelineno-538-5"></a><span class="w"> </span><span class="p">{</span>
</span><span id="__span-538-6"><a id="__codelineno-538-6" name="__codelineno-538-6" href="#__codelineno-538-6"></a><span class="w"> </span><span class="k">public</span><span class="w"> </span><span class="k">static</span><span class="w"> </span><span class="kt">bool</span><span class="w"> </span><span class="nf">IsCapitalized</span><span class="w"> </span><span class="p">(</span><span class="k">this</span><span class="w"> </span><span class="kt">string</span><span class="w"> </span><span class="n">s</span><span class="p">)</span>
</span><span id="__span-538-7"><a id="__codelineno-538-7" name="__codelineno-538-7" href="#__codelineno-538-7"></a><span class="w"> </span><span class="p">{</span>
</span><span id="__span-538-8"><a id="__codelineno-538-8" name="__codelineno-538-8" href="#__codelineno-538-8"></a><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="kt">string</span><span class="p">.</span><span class="n">IsNullOrEmpty</span><span class="p">(</span><span class="n">s</span><span class="p">))</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="k">false</span><span class="p">;</span>
</span><span id="__span-538-9"><a id="__codelineno-538-9" name="__codelineno-538-9" href="#__codelineno-538-9"></a><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="kt">char</span><span class="p">.</span><span class="n">IsUpper</span><span class="w"> </span><span class="p">(</span><span class="n">s</span><span class="p">[</span><span class="mi">0</span><span class="p">]);</span>
</span><span id="__span-538-10"><a id="__codelineno-538-10" name="__codelineno-538-10" href="#__codelineno-538-10"></a><span class="w"> </span><span class="p">}</span>
</span><span id="__span-538-11"><a id="__codelineno-538-11" name="__codelineno-538-11" href="#__codelineno-538-11"></a><span class="w"> </span><span class="p">}</span>
</span><span id="__span-538-12"><a id="__codelineno-538-12" name="__codelineno-538-12" href="#__codelineno-538-12"></a><span class="p">}</span>
</span><span id="__span-538-13"><a id="__codelineno-538-13" name="__codelineno-538-13" href="#__codelineno-538-13"></a>
</span><span id="__span-538-14"><a id="__codelineno-538-14" name="__codelineno-538-14" href="#__codelineno-538-14"></a><span class="k">namespace</span><span class="w"> </span><span class="nn">MyApp</span>
</span><span id="__span-538-15"><a id="__codelineno-538-15" name="__codelineno-538-15" href="#__codelineno-538-15"></a><span class="p">{</span>
</span><span id="__span-538-16"><a id="__codelineno-538-16" name="__codelineno-538-16" href="#__codelineno-538-16"></a><span class="w"> </span><span class="k">using</span><span class="w"> </span><span class="nn">Utils</span><span class="p">;</span>
</span><span id="__span-538-17"><a id="__codelineno-538-17" name="__codelineno-538-17" href="#__codelineno-538-17"></a><span class="w"> </span><span class="k">class</span><span class="w"> </span><span class="nc">Test</span>
</span><span id="__span-538-18"><a id="__codelineno-538-18" name="__codelineno-538-18" href="#__codelineno-538-18"></a><span class="w"> </span><span class="p">{</span>
</span><span id="__span-538-19"><a id="__codelineno-538-19" name="__codelineno-538-19" href="#__codelineno-538-19"></a><span class="k">static</span><span class="w"> </span><span class="k">void</span><span class="w"> </span><span class="nf">Main</span><span class="p">()</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="w"> </span><span class="p">(</span><span class="s">&quot;Perth&quot;</span><span class="p">.</span><span class="n">IsCapitalized</span><span class="p">());</span>
</span><span id="__span-538-20"><a id="__codelineno-538-20" name="__codelineno-538-20" href="#__codelineno-538-20"></a><span class="w"> </span><span class="p">}</span>
</span><span id="__span-538-21"><a id="__codelineno-538-21" name="__codelineno-538-21" href="#__codelineno-538-21"></a><span class="p">}</span>
</span></code></pre></div>
<h1 id="anonymous-types">Anonymous Types</h1>
<p>An anonymous type is a simple class created by the compiler on the fly to store a set
of values. To create an anonymous type, use the <code>new</code> keyword followed by an object
initializer, specifying the properties and values the type will contain.</p>
<div class="language-csharp highlight"><pre><span></span><code><span id="__span-539-1"><a id="__codelineno-539-1" name="__codelineno-539-1" href="#__codelineno-539-1"></a><span class="c1">//You must use the var keyword to reference an anonymous type because it doesnâ€™t</span>
</span><span id="__span-539-2"><a id="__codelineno-539-2" name="__codelineno-539-2" href="#__codelineno-539-2"></a><span class="c1">//have a name</span>
</span><span id="__span-539-3"><a id="__codelineno-539-3" name="__codelineno-539-3" href="#__codelineno-539-3"></a><span class="kt">var</span><span class="w"> </span><span class="n">dude</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">Name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;Bob&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">Age</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">23</span><span class="w"> </span><span class="p">};</span>
</span><span id="__span-539-4"><a id="__codelineno-539-4" name="__codelineno-539-4" href="#__codelineno-539-4"></a>
</span><span id="__span-539-5"><a id="__codelineno-539-5" name="__codelineno-539-5" href="#__codelineno-539-5"></a><span class="c1">//The compiler translates this to (approximately) the following</span>
</span><span id="__span-539-6"><a id="__codelineno-539-6" name="__codelineno-539-6" href="#__codelineno-539-6"></a>
</span><span id="__span-539-7"><a id="__codelineno-539-7" name="__codelineno-539-7" href="#__codelineno-539-7"></a><span class="k">internal</span><span class="w"> </span><span class="k">class</span><span class="w"> </span><span class="nc">AnonymousGeneratedTypeName</span>
</span><span id="__span-539-8"><a id="__codelineno-539-8" name="__codelineno-539-8" href="#__codelineno-539-8"></a><span class="p">{</span>
</span><span id="__span-539-9"><a id="__codelineno-539-9" name="__codelineno-539-9" href="#__codelineno-539-9"></a><span class="w"> </span><span class="k">private</span><span class="w"> </span><span class="kt">string</span><span class="w"> </span><span class="n">name</span><span class="p">;</span><span class="w"> </span><span class="c1">// Actual field name is irrelevant</span>
</span><span id="__span-539-10"><a id="__codelineno-539-10" name="__codelineno-539-10" href="#__codelineno-539-10"></a><span class="w"> </span><span class="k">private</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">age</span><span class="p">;</span><span class="w"> </span><span class="c1">// Actual field name is irrelevant</span>
</span><span id="__span-539-11"><a id="__codelineno-539-11" name="__codelineno-539-11" href="#__codelineno-539-11"></a><span class="w"> </span><span class="k">public</span><span class="w"> </span><span class="nf">AnonymousGeneratedTypeName</span><span class="w"> </span><span class="p">(</span><span class="kt">string</span><span class="w"> </span><span class="n">name</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">age</span><span class="p">)</span>
</span><span id="__span-539-12"><a id="__codelineno-539-12" name="__codelineno-539-12" href="#__codelineno-539-12"></a><span class="w"> </span><span class="p">{</span>
</span><span id="__span-539-13"><a id="__codelineno-539-13" name="__codelineno-539-13" href="#__codelineno-539-13"></a><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="n">name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">name</span><span class="p">;</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="n">age</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">age</span><span class="p">;</span>
</span><span id="__span-539-14"><a id="__codelineno-539-14" name="__codelineno-539-14" href="#__codelineno-539-14"></a><span class="w"> </span><span class="p">}</span>
</span><span id="__span-539-15"><a id="__codelineno-539-15" name="__codelineno-539-15" href="#__codelineno-539-15"></a><span class="w"> </span><span class="k">public</span><span class="w"> </span><span class="kt">string</span><span class="w"> </span><span class="n">Name</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">get</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="n">name</span><span class="p">;</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="p">}</span>
</span><span id="__span-539-16"><a id="__codelineno-539-16" name="__codelineno-539-16" href="#__codelineno-539-16"></a><span class="w"> </span><span class="k">public</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">Age</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">get</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="n">age</span><span class="p">;</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="p">}</span>
</span><span id="__span-539-17"><a id="__codelineno-539-17" name="__codelineno-539-17" href="#__codelineno-539-17"></a><span class="w"> </span><span class="c1">// The Equals and GetHashCode methods are overridden (see Chapter 6).</span>
</span><span id="__span-539-18"><a id="__codelineno-539-18" name="__codelineno-539-18" href="#__codelineno-539-18"></a><span class="w"> </span><span class="c1">// The ToString method is also overridden.</span>
</span><span id="__span-539-19"><a id="__codelineno-539-19" name="__codelineno-539-19" href="#__codelineno-539-19"></a><span class="p">}</span>
</span><span id="__span-539-20"><a id="__codelineno-539-20" name="__codelineno-539-20" href="#__codelineno-539-20"></a><span class="p">...</span>
</span><span id="__span-539-21"><a id="__codelineno-539-21" name="__codelineno-539-21" href="#__codelineno-539-21"></a><span class="kt">var</span><span class="w"> </span><span class="n">dude</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">AnonymousGeneratedTypeName</span><span class="w"> </span><span class="p">(</span><span class="s">&quot;Bob&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">23</span><span class="p">);</span>
</span></code></pre></div>
<h2 id="tuples_1">Tuples</h2>
<p><strong>Like anonymous types, tuples provide a simple way to store a set of values. The main purpose of tuples is to safely return multiple values from a method without resorting to out parameters</strong></p>
<p>The simplest way to create a tuple literal is to list the desired values in parentheses. This creates a tuple with unnamed elements, which you refer to as Item1, Item2, and so on:</p>
<div class="language-csharp highlight"><pre><span></span><code><span id="__span-540-1"><a id="__codelineno-540-1" name="__codelineno-540-1" href="#__codelineno-540-1"></a><span class="kt">var</span><span class="w"> </span><span class="n">bob</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="s">&quot;Bob&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">23</span><span class="p">);</span><span class="w"> </span><span class="c1">// Allow compiler to infer the element types</span>
</span><span id="__span-540-2"><a id="__codelineno-540-2" name="__codelineno-540-2" href="#__codelineno-540-2"></a><span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="w"> </span><span class="p">(</span><span class="n">bob</span><span class="p">.</span><span class="n">Item1</span><span class="p">);</span><span class="w"> </span><span class="c1">// Bob</span>
</span><span id="__span-540-3"><a id="__codelineno-540-3" name="__codelineno-540-3" href="#__codelineno-540-3"></a><span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="w"> </span><span class="p">(</span><span class="n">bob</span><span class="p">.</span><span class="n">Item2</span><span class="p">);</span><span class="w"> </span><span class="c1">// 23</span>
</span><span id="__span-540-4"><a id="__codelineno-540-4" name="__codelineno-540-4" href="#__codelineno-540-4"></a>
</span><span id="__span-540-5"><a id="__codelineno-540-5" name="__codelineno-540-5" href="#__codelineno-540-5"></a><span class="c1">//Tuples are value types, with mutable (read/write) elements:</span>
</span><span id="__span-540-6"><a id="__codelineno-540-6" name="__codelineno-540-6" href="#__codelineno-540-6"></a><span class="kt">var</span><span class="w"> </span><span class="n">joe</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">bob</span><span class="p">;</span><span class="w"> </span><span class="c1">// joe is a *copy* of job</span>
</span><span id="__span-540-7"><a id="__codelineno-540-7" name="__codelineno-540-7" href="#__codelineno-540-7"></a><span class="n">joe</span><span class="p">.</span><span class="n">Item1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;Joe&quot;</span><span class="p">;</span><span class="w"> </span><span class="c1">// Change joe&#39;s Item1 from Bob to Joe</span>
</span><span id="__span-540-8"><a id="__codelineno-540-8" name="__codelineno-540-8" href="#__codelineno-540-8"></a><span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="w"> </span><span class="p">(</span><span class="n">bob</span><span class="p">);</span><span class="w"> </span><span class="c1">// (Bob, 23)</span>
</span><span id="__span-540-9"><a id="__codelineno-540-9" name="__codelineno-540-9" href="#__codelineno-540-9"></a><span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="w"> </span><span class="p">(</span><span class="n">joe</span><span class="p">);</span><span class="w"> </span><span class="c1">// (Joe, 23)</span>
</span><span id="__span-540-10"><a id="__codelineno-540-10" name="__codelineno-540-10" href="#__codelineno-540-10"></a>
</span><span id="__span-540-11"><a id="__codelineno-540-11" name="__codelineno-540-11" href="#__codelineno-540-11"></a><span class="c1">//Unlike with anonymous types, you can specify a tuple type explicitly. Just list each</span>
</span><span id="__span-540-12"><a id="__codelineno-540-12" name="__codelineno-540-12" href="#__codelineno-540-12"></a><span class="c1">//of the element types in parentheses:</span>
</span><span id="__span-540-13"><a id="__codelineno-540-13" name="__codelineno-540-13" href="#__codelineno-540-13"></a><span class="p">(</span><span class="kt">string</span><span class="p">,</span><span class="kt">int</span><span class="p">)</span><span class="w"> </span><span class="n">bob</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="s">&quot;Bob&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">23</span><span class="p">);</span><span class="w"> </span><span class="c1">// var is not compulsory with tuples!</span>
</span><span id="__span-540-14"><a id="__codelineno-540-14" name="__codelineno-540-14" href="#__codelineno-540-14"></a>
</span><span id="__span-540-15"><a id="__codelineno-540-15" name="__codelineno-540-15" href="#__codelineno-540-15"></a><span class="c1">//This means that you can usefully return a tuple from a method:</span>
</span><span id="__span-540-16"><a id="__codelineno-540-16" name="__codelineno-540-16" href="#__codelineno-540-16"></a><span class="k">static</span><span class="w"> </span><span class="p">(</span><span class="kt">string</span><span class="p">,</span><span class="kt">int</span><span class="p">)</span><span class="w"> </span><span class="n">GetPerson</span><span class="p">()</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="p">(</span><span class="s">&quot;Bob&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">23</span><span class="p">);</span>
</span><span id="__span-540-17"><a id="__codelineno-540-17" name="__codelineno-540-17" href="#__codelineno-540-17"></a><span class="k">static</span><span class="w"> </span><span class="k">void</span><span class="w"> </span><span class="nf">Main</span><span class="p">()</span>
</span><span id="__span-540-18"><a id="__codelineno-540-18" name="__codelineno-540-18" href="#__codelineno-540-18"></a><span class="p">{</span>
</span><span id="__span-540-19"><a id="__codelineno-540-19" name="__codelineno-540-19" href="#__codelineno-540-19"></a><span class="w"> </span><span class="p">(</span><span class="kt">string</span><span class="p">,</span><span class="kt">int</span><span class="p">)</span><span class="w"> </span><span class="n">person</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">GetPerson</span><span class="p">();</span><span class="w"> </span><span class="c1">// Could use &#39;var&#39; here if we want</span>
</span><span id="__span-540-20"><a id="__codelineno-540-20" name="__codelineno-540-20" href="#__codelineno-540-20"></a><span class="w"> </span><span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="w"> </span><span class="p">(</span><span class="n">person</span><span class="p">.</span><span class="n">Item1</span><span class="p">);</span><span class="w"> </span><span class="c1">// Bob</span>
</span><span id="__span-540-21"><a id="__codelineno-540-21" name="__codelineno-540-21" href="#__codelineno-540-21"></a><span class="w"> </span><span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="w"> </span><span class="p">(</span><span class="n">person</span><span class="p">.</span><span class="n">Item2</span><span class="p">);</span><span class="w"> </span><span class="c1">// 23</span>
</span><span id="__span-540-22"><a id="__codelineno-540-22" name="__codelineno-540-22" href="#__codelineno-540-22"></a><span class="p">}</span>
</span></code></pre></div>
<h3 id="naming-tuple-elements">Naming Tuple Elements</h3>
<p>You can optionally give meaningful names to elements when creating tuple literals:</p>
<div class="language-csharp highlight"><pre><span></span><code><span id="__span-541-1"><a id="__codelineno-541-1" name="__codelineno-541-1" href="#__codelineno-541-1"></a><span class="kt">var</span><span class="w"> </span><span class="n">tuple</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">Name</span><span class="p">:</span><span class="s">&quot;Bob&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">Age</span><span class="p">:</span><span class="mi">23</span><span class="p">);</span>
</span><span id="__span-541-2"><a id="__codelineno-541-2" name="__codelineno-541-2" href="#__codelineno-541-2"></a><span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="w"> </span><span class="p">(</span><span class="n">tuple</span><span class="p">.</span><span class="n">Name</span><span class="p">);</span><span class="w"> </span><span class="c1">// Bob</span>
</span><span id="__span-541-3"><a id="__codelineno-541-3" name="__codelineno-541-3" href="#__codelineno-541-3"></a><span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="w"> </span><span class="p">(</span><span class="n">tuple</span><span class="p">.</span><span class="n">Age</span><span class="p">);</span><span class="w"> </span><span class="c1">// 23</span>
</span></code></pre></div>
<p>You can do the same when specifying tuple types:</p>
<div class="language-csharp highlight"><pre><span></span><code><span id="__span-542-1"><a id="__codelineno-542-1" name="__codelineno-542-1" href="#__codelineno-542-1"></a><span class="k">static</span><span class="w"> </span><span class="p">(</span><span class="kt">string</span><span class="w"> </span><span class="n">Name</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">Age</span><span class="p">)</span><span class="w"> </span><span class="n">GetPerson</span><span class="p">()</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="p">(</span><span class="s">&quot;Bob&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">23</span><span class="p">);</span>
</span><span id="__span-542-2"><a id="__codelineno-542-2" name="__codelineno-542-2" href="#__codelineno-542-2"></a><span class="k">static</span><span class="w"> </span><span class="k">void</span><span class="w"> </span><span class="nf">Main</span><span class="p">()</span>
</span><span id="__span-542-3"><a id="__codelineno-542-3" name="__codelineno-542-3" href="#__codelineno-542-3"></a><span class="p">{</span>
</span><span id="__span-542-4"><a id="__codelineno-542-4" name="__codelineno-542-4" href="#__codelineno-542-4"></a><span class="w"> </span><span class="kt">var</span><span class="w"> </span><span class="n">person</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">GetPerson</span><span class="p">();</span>
</span><span id="__span-542-5"><a id="__codelineno-542-5" name="__codelineno-542-5" href="#__codelineno-542-5"></a><span class="w"> </span><span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="w"> </span><span class="p">(</span><span class="n">person</span><span class="p">.</span><span class="n">Name</span><span class="p">);</span><span class="w"> </span><span class="c1">// Bob</span>
</span><span id="__span-542-6"><a id="__codelineno-542-6" name="__codelineno-542-6" href="#__codelineno-542-6"></a><span class="w"> </span><span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="w"> </span><span class="p">(</span><span class="n">person</span><span class="p">.</span><span class="n">Age</span><span class="p">);</span><span class="w"> </span><span class="c1">// 23</span>
</span><span id="__span-542-7"><a id="__codelineno-542-7" name="__codelineno-542-7" href="#__codelineno-542-7"></a><span class="p">}</span>
</span></code></pre></div>
<h3 id="deconstructing-tuples">Deconstructing Tuples</h3>
<div class="language-csharp highlight"><pre><span></span><code><span id="__span-543-1"><a id="__codelineno-543-1" name="__codelineno-543-1" href="#__codelineno-543-1"></a><span class="kt">var</span><span class="w"> </span><span class="n">bob</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="s">&quot;Bob&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">23</span><span class="p">);</span>
</span><span id="__span-543-2"><a id="__codelineno-543-2" name="__codelineno-543-2" href="#__codelineno-543-2"></a>
</span><span id="__span-543-3"><a id="__codelineno-543-3" name="__codelineno-543-3" href="#__codelineno-543-3"></a><span class="p">(</span><span class="kt">string</span><span class="w"> </span><span class="n">name</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">age</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">bob</span><span class="p">;</span><span class="w">   </span><span class="c1">// Deconstruct the bob tuple into</span>
</span><span id="__span-543-4"><a id="__codelineno-543-4" name="__codelineno-543-4" href="#__codelineno-543-4"></a><span class="w">                                </span><span class="c1">// separate variables (name and age).</span>
</span><span id="__span-543-5"><a id="__codelineno-543-5" name="__codelineno-543-5" href="#__codelineno-543-5"></a><span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="w"> </span><span class="p">(</span><span class="n">name</span><span class="p">);</span>
</span><span id="__span-543-6"><a id="__codelineno-543-6" name="__codelineno-543-6" href="#__codelineno-543-6"></a><span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="w"> </span><span class="p">(</span><span class="n">age</span><span class="p">);</span>
</span></code></pre></div>
<h1 id="patterns_1">Patterns</h1>
<p>In Chapter 3, we demonstrated how to use the is operator to test whether a referâ€
ence conversion will succeed:</p>
<div class="language-csharp highlight"><pre><span></span><code><span id="__span-544-1"><a id="__codelineno-544-1" name="__codelineno-544-1" href="#__codelineno-544-1"></a><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">obj</span><span class="w"> </span><span class="k">is</span><span class="w"> </span><span class="kt">string</span><span class="p">)</span>
</span><span id="__span-544-2"><a id="__codelineno-544-2" name="__codelineno-544-2" href="#__codelineno-544-2"></a><span class="w"> </span><span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="w"> </span><span class="p">(((</span><span class="kt">string</span><span class="p">)</span><span class="n">obj</span><span class="p">).</span><span class="n">Length</span><span class="p">);</span>
</span><span id="__span-544-3"><a id="__codelineno-544-3" name="__codelineno-544-3" href="#__codelineno-544-3"></a>
</span><span id="__span-544-4"><a id="__codelineno-544-4" name="__codelineno-544-4" href="#__codelineno-544-4"></a><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">obj</span><span class="w"> </span><span class="k">is</span><span class="w"> </span><span class="kt">string</span><span class="w"> </span><span class="n">s</span><span class="p">)</span>
</span><span id="__span-544-5"><a id="__codelineno-544-5" name="__codelineno-544-5" href="#__codelineno-544-5"></a><span class="w"> </span><span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="w"> </span><span class="p">(</span><span class="n">s</span><span class="p">.</span><span class="n">Length</span><span class="p">);</span>
</span></code></pre></div>
<p>This employs one kind of pattern called a type pattern.</p>
<p>Patterns are supported in the following contexts</p>
<ul>
<li>After the is operator (variable is pattern)</li>
<li>In switch statements</li>
<li>In switch expressions</li>
</ul>
<p><strong>Most of these patterns are intended for use in switch statements/expressions, where they do the following:</strong></p>
<ul>
<li><strong>Reduce the need for when clauses</strong></li>
<li><strong>Let you use switches where you couldnâ€™t previously</strong></li>
</ul>
<h3 id="tuple-patterns">Tuple Patterns</h3>
<p>Tuple patterns provide a simple mechanism for switching on multiple values</p>
<div class="language-csharp highlight"><pre><span></span><code><span id="__span-545-1"><a id="__codelineno-545-1" name="__codelineno-545-1" href="#__codelineno-545-1"></a><span class="k">enum</span><span class="w"> </span><span class="n">Season</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">Spring</span><span class="p">,</span><span class="w"> </span><span class="n">Summer</span><span class="p">,</span><span class="w"> </span><span class="n">Fall</span><span class="p">,</span><span class="w"> </span><span class="n">Winter</span><span class="w"> </span><span class="p">};</span>
</span><span id="__span-545-2"><a id="__codelineno-545-2" name="__codelineno-545-2" href="#__codelineno-545-2"></a><span class="kt">int</span><span class="w"> </span><span class="nf">AverageCelsiusTemperature</span><span class="w"> </span><span class="p">(</span><span class="n">Season</span><span class="w"> </span><span class="n">season</span><span class="p">,</span><span class="w"> </span><span class="kt">bool</span><span class="w"> </span><span class="n">daytime</span><span class="p">)</span><span class="w"> </span><span class="o">=&gt;</span>
</span><span id="__span-545-3"><a id="__codelineno-545-3" name="__codelineno-545-3" href="#__codelineno-545-3"></a><span class="w"> </span><span class="p">(</span><span class="n">season</span><span class="p">,</span><span class="w"> </span><span class="n">daytime</span><span class="p">)</span><span class="w"> </span><span class="k">switch</span>
</span><span id="__span-545-4"><a id="__codelineno-545-4" name="__codelineno-545-4" href="#__codelineno-545-4"></a><span class="w"> </span><span class="p">{</span>
</span><span id="__span-545-5"><a id="__codelineno-545-5" name="__codelineno-545-5" href="#__codelineno-545-5"></a><span class="w"> </span><span class="p">(</span><span class="n">Season</span><span class="p">.</span><span class="n">Spring</span><span class="p">,</span><span class="w"> </span><span class="k">true</span><span class="p">)</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="mi">20</span><span class="p">,</span>
</span><span id="__span-545-6"><a id="__codelineno-545-6" name="__codelineno-545-6" href="#__codelineno-545-6"></a><span class="w"> </span><span class="p">(</span><span class="n">Season</span><span class="p">.</span><span class="n">Spring</span><span class="p">,</span><span class="w"> </span><span class="k">false</span><span class="p">)</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="mi">16</span><span class="p">,</span>
</span><span id="__span-545-7"><a id="__codelineno-545-7" name="__codelineno-545-7" href="#__codelineno-545-7"></a><span class="w"> </span><span class="p">(</span><span class="n">Season</span><span class="p">.</span><span class="n">Summer</span><span class="p">,</span><span class="w"> </span><span class="k">true</span><span class="p">)</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="mi">27</span><span class="p">,</span>
</span><span id="__span-545-8"><a id="__codelineno-545-8" name="__codelineno-545-8" href="#__codelineno-545-8"></a><span class="w"> </span><span class="p">(</span><span class="n">Season</span><span class="p">.</span><span class="n">Summer</span><span class="p">,</span><span class="w"> </span><span class="k">false</span><span class="p">)</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="mi">22</span><span class="p">,</span>
</span><span id="__span-545-9"><a id="__codelineno-545-9" name="__codelineno-545-9" href="#__codelineno-545-9"></a><span class="w"> </span><span class="p">(</span><span class="n">Season</span><span class="p">.</span><span class="n">Fall</span><span class="p">,</span><span class="w"> </span><span class="k">true</span><span class="p">)</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="mi">18</span><span class="p">,</span>
</span><span id="__span-545-10"><a id="__codelineno-545-10" name="__codelineno-545-10" href="#__codelineno-545-10"></a><span class="w"> </span><span class="p">(</span><span class="n">Season</span><span class="p">.</span><span class="n">Fall</span><span class="p">,</span><span class="w"> </span><span class="k">false</span><span class="p">)</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="mi">12</span><span class="p">,</span>
</span><span id="__span-545-11"><a id="__codelineno-545-11" name="__codelineno-545-11" href="#__codelineno-545-11"></a><span class="w"> </span><span class="p">(</span><span class="n">Season</span><span class="p">.</span><span class="n">Winter</span><span class="p">,</span><span class="w"> </span><span class="k">true</span><span class="p">)</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="mi">10</span><span class="p">,</span>
</span><span id="__span-545-12"><a id="__codelineno-545-12" name="__codelineno-545-12" href="#__codelineno-545-12"></a><span class="w"> </span><span class="p">(</span><span class="n">Season</span><span class="p">.</span><span class="n">Winter</span><span class="p">,</span><span class="w"> </span><span class="k">false</span><span class="p">)</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="o">-</span><span class="mi">2</span><span class="p">,</span>
</span><span id="__span-545-13"><a id="__codelineno-545-13" name="__codelineno-545-13" href="#__codelineno-545-13"></a><span class="w"> </span><span class="n">_</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="k">throw</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">Exception</span><span class="w"> </span><span class="p">(</span><span class="s">&quot;Unexpected combination&quot;</span><span class="p">)</span>
</span><span id="__span-545-14"><a id="__codelineno-545-14" name="__codelineno-545-14" href="#__codelineno-545-14"></a><span class="p">};</span>
</span></code></pre></div>
<h3 id="positional-patterns">Positional Patterns</h3>
<p>For types that define a Deconstruct method</p>
<div class="language-csharp highlight"><pre><span></span><code><span id="__span-546-1"><a id="__codelineno-546-1" name="__codelineno-546-1" href="#__codelineno-546-1"></a><span class="k">class</span><span class="w"> </span><span class="nc">Point</span>
</span><span id="__span-546-2"><a id="__codelineno-546-2" name="__codelineno-546-2" href="#__codelineno-546-2"></a><span class="p">{</span>
</span><span id="__span-546-3"><a id="__codelineno-546-3" name="__codelineno-546-3" href="#__codelineno-546-3"></a><span class="w"> </span><span class="k">public</span><span class="w"> </span><span class="k">readonly</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">X</span><span class="p">,</span><span class="w"> </span><span class="n">Y</span><span class="p">;</span>
</span><span id="__span-546-4"><a id="__codelineno-546-4" name="__codelineno-546-4" href="#__codelineno-546-4"></a><span class="w"> </span><span class="k">public</span><span class="w"> </span><span class="nf">Point</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">y</span><span class="p">)</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="p">(</span><span class="n">X</span><span class="p">,</span><span class="w"> </span><span class="n">Y</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="p">);</span>
</span><span id="__span-546-5"><a id="__codelineno-546-5" name="__codelineno-546-5" href="#__codelineno-546-5"></a><span class="w"> </span><span class="k">public</span><span class="w"> </span><span class="k">void</span><span class="w"> </span><span class="nf">Deconstruct</span><span class="w"> </span><span class="p">(</span><span class="k">out</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="k">out</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">y</span><span class="p">)</span>
</span><span id="__span-546-6"><a id="__codelineno-546-6" name="__codelineno-546-6" href="#__codelineno-546-6"></a><span class="w"> </span><span class="p">{</span>
</span><span id="__span-546-7"><a id="__codelineno-546-7" name="__codelineno-546-7" href="#__codelineno-546-7"></a><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">X</span><span class="p">;</span><span class="w"> </span><span class="n">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Y</span><span class="p">;</span>
</span><span id="__span-546-8"><a id="__codelineno-546-8" name="__codelineno-546-8" href="#__codelineno-546-8"></a><span class="w"> </span><span class="p">}</span>
</span><span id="__span-546-9"><a id="__codelineno-546-9" name="__codelineno-546-9" href="#__codelineno-546-9"></a><span class="p">}</span>
</span></code></pre></div>
<p>you can use the objectâ€™s positional properties for pattern matching</p>
<div class="language-csharp highlight"><pre><span></span><code><span id="__span-547-1"><a id="__codelineno-547-1" name="__codelineno-547-1" href="#__codelineno-547-1"></a><span class="kt">var</span><span class="w"> </span><span class="n">p</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">Point</span><span class="w"> </span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="mi">3</span><span class="p">);</span>
</span><span id="__span-547-2"><a id="__codelineno-547-2" name="__codelineno-547-2" href="#__codelineno-547-2"></a><span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="w"> </span><span class="p">(</span><span class="n">p</span><span class="w"> </span><span class="k">is</span><span class="w"> </span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="mi">3</span><span class="p">));</span><span class="w"> </span><span class="c1">// true</span>
</span></code></pre></div>
<p>With a switch:</p>
<div class="language-csharp highlight"><pre><span></span><code><span id="__span-548-1"><a id="__codelineno-548-1" name="__codelineno-548-1" href="#__codelineno-548-1"></a><span class="kt">string</span><span class="w"> </span><span class="nf">Print</span><span class="w"> </span><span class="p">(</span><span class="kt">object</span><span class="w"> </span><span class="n">obj</span><span class="p">)</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="n">obj</span><span class="w"> </span><span class="k">switch</span>
</span><span id="__span-548-2"><a id="__codelineno-548-2" name="__codelineno-548-2" href="#__codelineno-548-2"></a><span class="p">{</span>
</span><span id="__span-548-3"><a id="__codelineno-548-3" name="__codelineno-548-3" href="#__codelineno-548-3"></a><span class="w"> </span><span class="n">Point</span><span class="w"> </span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="s">&quot;Empty point&quot;</span><span class="p">,</span>
</span><span id="__span-548-4"><a id="__codelineno-548-4" name="__codelineno-548-4" href="#__codelineno-548-4"></a><span class="w"> </span><span class="n">Point</span><span class="w"> </span><span class="p">(</span><span class="kt">var</span><span class="w"> </span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="kt">var</span><span class="w"> </span><span class="n">y</span><span class="p">)</span><span class="w"> </span><span class="k">when</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">y</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="s">&quot;Diagonal&quot;</span>
</span><span id="__span-548-5"><a id="__codelineno-548-5" name="__codelineno-548-5" href="#__codelineno-548-5"></a><span class="w"> </span><span class="p">...</span>
</span><span id="__span-548-6"><a id="__codelineno-548-6" name="__codelineno-548-6" href="#__codelineno-548-6"></a><span class="p">};</span>
</span></code></pre></div>
<h2 id="operator-overloading">Operator Overloading</h2>
<p>Operators can be overloaded to provide more natural syntax for custom types. Operator overloading is most appropriately used for implementing custom structs that represent fairly primitive data types. For example, a custom numeric type is an excellent candidate for operator overloading.</p>
<p>The following symbolic operators can be overloaded:</p>
<div class="language-csharp highlight"><pre><span></span><code><span id="__span-549-1"><a id="__codelineno-549-1" name="__codelineno-549-1" href="#__codelineno-549-1"></a><span class="o">+</span><span class="w"> </span><span class="p">(</span><span class="n">unary</span><span class="p">)</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="p">(</span><span class="n">unary</span><span class="p">)</span><span class="w"> </span><span class="o">!</span><span class="w"> </span><span class="err">Ëœ</span><span class="w"> </span><span class="o">++</span>
</span><span id="__span-549-2"><a id="__codelineno-549-2" name="__codelineno-549-2" href="#__codelineno-549-2"></a><span class="o">--</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="o">/</span>
</span><span id="__span-549-3"><a id="__codelineno-549-3" name="__codelineno-549-3" href="#__codelineno-549-3"></a><span class="o">%</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="o">^</span><span class="w"> </span><span class="o">&lt;&lt;</span>
</span><span id="__span-549-4"><a id="__codelineno-549-4" name="__codelineno-549-4" href="#__codelineno-549-4"></a><span class="o">&gt;&gt;</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="o">&lt;</span>
</span><span id="__span-549-5"><a id="__codelineno-549-5" name="__codelineno-549-5" href="#__codelineno-549-5"></a><span class="o">&gt;=</span><span class="w"> </span><span class="o">&lt;=</span>
</span></code></pre></div>
<h3 id="operator-functions">Operator Functions</h3>
<p>An operator is overloaded by declaring an operator function. An operator function has the following rules:</p>
<ul>
<li>The name of the function is specified with the operator keyword followed by an operator symbol</li>
<li>The operator function must be marked static and public.</li>
<li>The parameters of the operator function represent the operands.</li>
<li>The return type of an operator function represents the result of an expression.</li>
<li>At least one of the operands must be the type in which the operator function is declared.</li>
</ul>
<p>In the following example, we define a struct called Note representing a musical note, and then overload the + operator:</p>
<div class="language-csharp highlight"><pre><span></span><code><span id="__span-550-1"><a id="__codelineno-550-1" name="__codelineno-550-1" href="#__codelineno-550-1"></a><span class="k">public</span><span class="w"> </span><span class="k">struct</span><span class="w"> </span><span class="nc">Note</span>
</span><span id="__span-550-2"><a id="__codelineno-550-2" name="__codelineno-550-2" href="#__codelineno-550-2"></a><span class="p">{</span>
</span><span id="__span-550-3"><a id="__codelineno-550-3" name="__codelineno-550-3" href="#__codelineno-550-3"></a><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="k">value</span><span class="p">;</span>
</span><span id="__span-550-4"><a id="__codelineno-550-4" name="__codelineno-550-4" href="#__codelineno-550-4"></a><span class="w"> </span><span class="k">public</span><span class="w"> </span><span class="nf">Note</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">semitonesFromA</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">value</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">semitonesFromA</span><span class="p">;</span><span class="w"> </span><span class="p">}</span>
</span><span id="__span-550-5"><a id="__codelineno-550-5" name="__codelineno-550-5" href="#__codelineno-550-5"></a><span class="w"> </span><span class="k">public</span><span class="w"> </span><span class="k">static</span><span class="w"> </span><span class="n">Note</span><span class="w"> </span><span class="k">operator</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="p">(</span><span class="n">Note</span><span class="w"> </span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">semitones</span><span class="p">)</span>
</span><span id="__span-550-6"><a id="__codelineno-550-6" name="__codelineno-550-6" href="#__codelineno-550-6"></a><span class="w"> </span><span class="p">{</span>
</span><span id="__span-550-7"><a id="__codelineno-550-7" name="__codelineno-550-7" href="#__codelineno-550-7"></a><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="nf">Note</span><span class="w"> </span><span class="p">(</span><span class="n">x</span><span class="p">.</span><span class="k">value</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">semitones</span><span class="p">);</span>
</span><span id="__span-550-8"><a id="__codelineno-550-8" name="__codelineno-550-8" href="#__codelineno-550-8"></a><span class="w"> </span><span class="p">}</span>
</span><span id="__span-550-9"><a id="__codelineno-550-9" name="__codelineno-550-9" href="#__codelineno-550-9"></a><span class="p">}</span>
</span><span id="__span-550-10"><a id="__codelineno-550-10" name="__codelineno-550-10" href="#__codelineno-550-10"></a><span class="c1">//This overload allows us to add an int to a Note:</span>
</span><span id="__span-550-11"><a id="__codelineno-550-11" name="__codelineno-550-11" href="#__codelineno-550-11"></a><span class="n">Note</span><span class="w"> </span><span class="n">B</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">Note</span><span class="w"> </span><span class="p">(</span><span class="mi">2</span><span class="p">);</span>
</span><span id="__span-550-12"><a id="__codelineno-550-12" name="__codelineno-550-12" href="#__codelineno-550-12"></a><span class="n">Note</span><span class="w"> </span><span class="n">CSharp</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">B</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">2</span><span class="p">;</span>
</span></code></pre></div>
<h3 id="overloading-true-and-false">Overloading true and false</h3>
<div class="language-csharp highlight"><pre><span></span><code><span id="__span-551-1"><a id="__codelineno-551-1" name="__codelineno-551-1" href="#__codelineno-551-1"></a><span class="n">SqlBoolean</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">SqlBoolean</span><span class="p">.</span><span class="n">Null</span><span class="p">;</span>
</span><span id="__span-551-2"><a id="__codelineno-551-2" name="__codelineno-551-2" href="#__codelineno-551-2"></a><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">a</span><span class="p">)</span>
</span><span id="__span-551-3"><a id="__codelineno-551-3" name="__codelineno-551-3" href="#__codelineno-551-3"></a><span class="w"> </span><span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="w"> </span><span class="p">(</span><span class="s">&quot;True&quot;</span><span class="p">);</span>
</span><span id="__span-551-4"><a id="__codelineno-551-4" name="__codelineno-551-4" href="#__codelineno-551-4"></a><span class="k">else</span><span class="w"> </span><span class="nf">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="n">a</span><span class="p">)</span>
</span><span id="__span-551-5"><a id="__codelineno-551-5" name="__codelineno-551-5" href="#__codelineno-551-5"></a><span class="w"> </span><span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="w"> </span><span class="p">(</span><span class="s">&quot;False&quot;</span><span class="p">);</span>
</span><span id="__span-551-6"><a id="__codelineno-551-6" name="__codelineno-551-6" href="#__codelineno-551-6"></a><span class="k">else</span>
</span><span id="__span-551-7"><a id="__codelineno-551-7" name="__codelineno-551-7" href="#__codelineno-551-7"></a><span class="w"> </span><span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="w"> </span><span class="p">(</span><span class="s">&quot;Null&quot;</span><span class="p">);</span>
</span><span id="__span-551-8"><a id="__codelineno-551-8" name="__codelineno-551-8" href="#__codelineno-551-8"></a><span class="n">OUTPUT</span><span class="p">:</span>
</span><span id="__span-551-9"><a id="__codelineno-551-9" name="__codelineno-551-9" href="#__codelineno-551-9"></a><span class="n">Null</span>
</span><span id="__span-551-10"><a id="__codelineno-551-10" name="__codelineno-551-10" href="#__codelineno-551-10"></a>
</span><span id="__span-551-11"><a id="__codelineno-551-11" name="__codelineno-551-11" href="#__codelineno-551-11"></a><span class="k">public</span><span class="w"> </span><span class="k">struct</span><span class="w"> </span><span class="nc">SqlBoolean</span>
</span><span id="__span-551-12"><a id="__codelineno-551-12" name="__codelineno-551-12" href="#__codelineno-551-12"></a><span class="p">{</span>
</span><span id="__span-551-13"><a id="__codelineno-551-13" name="__codelineno-551-13" href="#__codelineno-551-13"></a><span class="w"> </span><span class="k">public</span><span class="w"> </span><span class="k">static</span><span class="w"> </span><span class="kt">bool</span><span class="w"> </span><span class="k">operator</span><span class="w"> </span><span class="nf">true</span><span class="w"> </span><span class="p">(</span><span class="n">SqlBoolean</span><span class="w"> </span><span class="n">x</span><span class="p">)</span>
</span><span id="__span-551-14"><a id="__codelineno-551-14" name="__codelineno-551-14" href="#__codelineno-551-14"></a><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="n">x</span><span class="p">.</span><span class="n">m_value</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">True</span><span class="p">.</span><span class="n">m_value</span><span class="p">;</span>
</span><span id="__span-551-15"><a id="__codelineno-551-15" name="__codelineno-551-15" href="#__codelineno-551-15"></a><span class="w"> </span><span class="k">public</span><span class="w"> </span><span class="k">static</span><span class="w"> </span><span class="kt">bool</span><span class="w"> </span><span class="k">operator</span><span class="w"> </span><span class="nf">false</span><span class="w"> </span><span class="p">(</span><span class="n">SqlBoolean</span><span class="w"> </span><span class="n">x</span><span class="p">)</span>
</span><span id="__span-551-16"><a id="__codelineno-551-16" name="__codelineno-551-16" href="#__codelineno-551-16"></a><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="n">x</span><span class="p">.</span><span class="n">m_value</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">False</span><span class="p">.</span><span class="n">m_value</span><span class="p">;</span>
</span><span id="__span-551-17"><a id="__codelineno-551-17" name="__codelineno-551-17" href="#__codelineno-551-17"></a><span class="w"> </span><span class="k">public</span><span class="w"> </span><span class="k">static</span><span class="w"> </span><span class="n">SqlBoolean</span><span class="w"> </span><span class="k">operator</span><span class="w"> </span><span class="o">!</span><span class="w"> </span><span class="p">(</span><span class="n">SqlBoolean</span><span class="w"> </span><span class="n">x</span><span class="p">)</span>
</span><span id="__span-551-18"><a id="__codelineno-551-18" name="__codelineno-551-18" href="#__codelineno-551-18"></a><span class="w"> </span><span class="p">{</span>
</span><span id="__span-551-19"><a id="__codelineno-551-19" name="__codelineno-551-19" href="#__codelineno-551-19"></a><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">x</span><span class="p">.</span><span class="n">m_value</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">Null</span><span class="p">.</span><span class="n">m_value</span><span class="p">)</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="n">Null</span><span class="p">;</span>
</span><span id="__span-551-20"><a id="__codelineno-551-20" name="__codelineno-551-20" href="#__codelineno-551-20"></a><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">x</span><span class="p">.</span><span class="n">m_value</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">False</span><span class="p">.</span><span class="n">m_value</span><span class="p">)</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="n">True</span><span class="p">;</span>
</span><span id="__span-551-21"><a id="__codelineno-551-21" name="__codelineno-551-21" href="#__codelineno-551-21"></a><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="n">False</span><span class="p">;</span>
</span><span id="__span-551-22"><a id="__codelineno-551-22" name="__codelineno-551-22" href="#__codelineno-551-22"></a><span class="w"> </span><span class="p">}</span>
</span><span id="__span-551-23"><a id="__codelineno-551-23" name="__codelineno-551-23" href="#__codelineno-551-23"></a><span class="w"> </span><span class="k">public</span><span class="w"> </span><span class="k">static</span><span class="w"> </span><span class="k">readonly</span><span class="w"> </span><span class="n">SqlBoolean</span><span class="w"> </span><span class="n">Null</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">SqlBoolean</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>
</span><span id="__span-551-24"><a id="__codelineno-551-24" name="__codelineno-551-24" href="#__codelineno-551-24"></a><span class="w"> </span><span class="k">public</span><span class="w"> </span><span class="k">static</span><span class="w"> </span><span class="k">readonly</span><span class="w"> </span><span class="n">SqlBoolean</span><span class="w"> </span><span class="n">False</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">SqlBoolean</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>
</span><span id="__span-551-25"><a id="__codelineno-551-25" name="__codelineno-551-25" href="#__codelineno-551-25"></a><span class="w"> </span><span class="k">public</span><span class="w"> </span><span class="k">static</span><span class="w"> </span><span class="k">readonly</span><span class="w"> </span><span class="n">SqlBoolean</span><span class="w"> </span><span class="n">True</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">SqlBoolean</span><span class="p">(</span><span class="mi">2</span><span class="p">);</span>
</span><span id="__span-551-26"><a id="__codelineno-551-26" name="__codelineno-551-26" href="#__codelineno-551-26"></a><span class="w"> </span><span class="k">private</span><span class="w"> </span><span class="nf">SqlBoolean</span><span class="w"> </span><span class="p">(</span><span class="kt">byte</span><span class="w"> </span><span class="k">value</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">m_value</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">value</span><span class="p">;</span><span class="w"> </span><span class="p">}</span>
</span><span id="__span-551-27"><a id="__codelineno-551-27" name="__codelineno-551-27" href="#__codelineno-551-27"></a><span class="w"> </span><span class="k">private</span><span class="w"> </span><span class="kt">byte</span><span class="w"> </span><span class="n">m_value</span><span class="p">;</span>
</span><span id="__span-551-28"><a id="__codelineno-551-28" name="__codelineno-551-28" href="#__codelineno-551-28"></a><span class="p">}</span>
</span></code></pre></div>
<h2 id="preprocessor-directives">Preprocessor Directives</h2>
<p>Preprocessor directives supply the compiler with additional information about regions of code. The most common preprocessor directives are the conditional directives, which provide a way to include or exclude regions of code from compilation. For example:</p>
<div class="language-csharp highlight"><pre><span></span><code><span id="__span-552-1"><a id="__codelineno-552-1" name="__codelineno-552-1" href="#__codelineno-552-1"></a><span class="cp">#define DEBUG</span>
</span><span id="__span-552-2"><a id="__codelineno-552-2" name="__codelineno-552-2" href="#__codelineno-552-2"></a><span class="k">class</span><span class="w"> </span><span class="nc">MyClass</span>
</span><span id="__span-552-3"><a id="__codelineno-552-3" name="__codelineno-552-3" href="#__codelineno-552-3"></a><span class="p">{</span>
</span><span id="__span-552-4"><a id="__codelineno-552-4" name="__codelineno-552-4" href="#__codelineno-552-4"></a><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">x</span><span class="p">;</span>
</span><span id="__span-552-5"><a id="__codelineno-552-5" name="__codelineno-552-5" href="#__codelineno-552-5"></a><span class="w"> </span><span class="k">void</span><span class="w"> </span><span class="nf">Foo</span><span class="p">()</span>
</span><span id="__span-552-6"><a id="__codelineno-552-6" name="__codelineno-552-6" href="#__codelineno-552-6"></a><span class="w"> </span><span class="p">{</span>
</span><span id="__span-552-7"><a id="__codelineno-552-7" name="__codelineno-552-7" href="#__codelineno-552-7"></a><span class="w"> </span><span class="cp">#if DEBUG</span>
</span><span id="__span-552-8"><a id="__codelineno-552-8" name="__codelineno-552-8" href="#__codelineno-552-8"></a><span class="w"> </span><span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="w"> </span><span class="p">(</span><span class="s">&quot;Testing: x = {0}&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">x</span><span class="p">);</span>
</span><span id="__span-552-9"><a id="__codelineno-552-9" name="__codelineno-552-9" href="#__codelineno-552-9"></a><span class="w"> </span><span class="cp">#endif</span>
</span><span id="__span-552-10"><a id="__codelineno-552-10" name="__codelineno-552-10" href="#__codelineno-552-10"></a><span class="w"> </span><span class="p">}</span>
</span><span id="__span-552-11"><a id="__codelineno-552-11" name="__codelineno-552-11" href="#__codelineno-552-11"></a><span class="w"> </span><span class="p">...</span>
</span><span id="__span-552-12"><a id="__codelineno-552-12" name="__codelineno-552-12" href="#__codelineno-552-12"></a><span class="p">}</span>
</span></code></pre></div>
<p>In this class, the statement in Foo is compiled as conditionally dependent upon the
presence of the DEBUG symbol. If we remove the DEBUG symbol, the statement is not
compiled. <strong>You can define preprocessor symbols within a source file (as we have
done), or at a project level in the .csproj file:</strong></p>
<div class="language-csharp highlight"><pre><span></span><code><span id="__span-553-1"><a id="__codelineno-553-1" name="__codelineno-553-1" href="#__codelineno-553-1"></a><span class="o">&lt;</span><span class="n">PropertyGroup</span><span class="o">&gt;</span>
</span><span id="__span-553-2"><a id="__codelineno-553-2" name="__codelineno-553-2" href="#__codelineno-553-2"></a><span class="w"> </span><span class="o">&lt;</span><span class="n">DefineConstants</span><span class="o">&gt;</span><span class="n">DEBUG</span><span class="p">;</span><span class="n">ANOTHERSYMBOL</span><span class="o">&lt;/</span><span class="n">DefineConstants</span><span class="o">&gt;</span>
</span><span id="__span-553-3"><a id="__codelineno-553-3" name="__codelineno-553-3" href="#__codelineno-553-3"></a><span class="o">&lt;/</span><span class="n">PropertyGroup</span><span class="o">&gt;</span>
</span></code></pre></div>
<p>Preprocessor directives</p>
<ul>
<li>#define symbol - Defines symbol</li>
<li>#if symbol [operator sym bol2]...-symbol to test</li>
<li>#else - Executes code to subsequent #endif</li>
<li>#endif - Ends conditional directives</li>
<li>#warning text - text of the warning to appear in compiler output</li>
<li>#error text - text of the error to appear in compiler output</li>
</ul>
<h2 id="xml-documentation">XML Documentation</h2>
<p>A documentation comment is a piece of embedded XML that documents a type or member. A documentation comment comes immediately before a type or member declaration, and starts with three slashes:</p>
<div class="language-csharp highlight"><pre><span></span><code><span id="__span-554-1"><a id="__codelineno-554-1" name="__codelineno-554-1" href="#__codelineno-554-1"></a><span class="c1">/// &lt;summary&gt;Cancels a running query.&lt;/summary&gt;</span>
</span><span id="__span-554-2"><a id="__codelineno-554-2" name="__codelineno-554-2" href="#__codelineno-554-2"></a><span class="k">public</span><span class="w"> </span><span class="k">void</span><span class="w"> </span><span class="nf">Cancel</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="p">...</span><span class="w"> </span><span class="p">}</span>
</span><span id="__span-554-3"><a id="__codelineno-554-3" name="__codelineno-554-3" href="#__codelineno-554-3"></a>
</span><span id="__span-554-4"><a id="__codelineno-554-4" name="__codelineno-554-4" href="#__codelineno-554-4"></a><span class="c1">//Multiline comments can be done either like this:</span>
</span><span id="__span-554-5"><a id="__codelineno-554-5" name="__codelineno-554-5" href="#__codelineno-554-5"></a><span class="c1">/// &lt;summary&gt;</span>
</span><span id="__span-554-6"><a id="__codelineno-554-6" name="__codelineno-554-6" href="#__codelineno-554-6"></a><span class="c1">/// Cancels a running query</span>
</span><span id="__span-554-7"><a id="__codelineno-554-7" name="__codelineno-554-7" href="#__codelineno-554-7"></a><span class="c1">/// &lt;/summary&gt;</span>
</span><span id="__span-554-8"><a id="__codelineno-554-8" name="__codelineno-554-8" href="#__codelineno-554-8"></a><span class="k">public</span><span class="w"> </span><span class="k">void</span><span class="w"> </span><span class="nf">Cancel</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="p">...</span><span class="w"> </span><span class="p">}</span>
</span><span id="__span-554-9"><a id="__codelineno-554-9" name="__codelineno-554-9" href="#__codelineno-554-9"></a>
</span><span id="__span-554-10"><a id="__codelineno-554-10" name="__codelineno-554-10" href="#__codelineno-554-10"></a><span class="c1">//or like this (notice the extra star at the start):</span>
</span><span id="__span-554-11"><a id="__codelineno-554-11" name="__codelineno-554-11" href="#__codelineno-554-11"></a><span class="cm">/**</span>
</span><span id="__span-554-12"><a id="__codelineno-554-12" name="__codelineno-554-12" href="#__codelineno-554-12"></a><span class="cm"> &lt;summary&gt; Cancels a running query. &lt;/summary&gt;</span>
</span><span id="__span-554-13"><a id="__codelineno-554-13" name="__codelineno-554-13" href="#__codelineno-554-13"></a><span class="cm">*/</span>
</span><span id="__span-554-14"><a id="__codelineno-554-14" name="__codelineno-554-14" href="#__codelineno-554-14"></a><span class="k">public</span><span class="w"> </span><span class="k">void</span><span class="w"> </span><span class="nf">Cancel</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="p">...</span><span class="w"> </span><span class="p">}</span>
</span></code></pre></div>
<p>If you compile with the /doc directive (in Visual Studio, go to the Build tab of Project Properties), the compiler extracts and collates documentation comments into a single XML file. This has two main uses:</p>
<ul>
<li>If placed in the same folder as the compiled assembly, Visual Studio (and LINQPad) automatically read the XML file and use the information to provide IntelliSense member listings to consumers of the assembly of the same name.</li>
<li>Third-party tools (such as Sandcastle and NDoc) can transform the XML file into an HTML help file.# Chapter 5 : Framework Overview</li>
</ul>
<h1 id="whats-new-in-net-core-3">Whatâ€™s New in .NET Core 3</h1>
<p>The new core features of .NET Core 3 include a built-in high-performance JSON reader/writer and serializer (see Chapter 11), and support for C# 8 and .NET Standard 2.1.</p>
<p>Note that .NET Core 3 succeeds both .NET Core 2.2 and .NET Framework. If youâ€™re
coming from .NET Framework, the following features are all new</p>
<ul>
<li>Built-in immutable collections (see â€œImmutable Collectionsâ€ on page 357 in
Chapter 7)</li>
<li>AssemblyLoadContext: a new API for loading, resolving, and isolating assemâ€
blies that significantly improves on Assembly.LoadFile and Assembly.LoadFrom
(see â€œLoading, Resolving, and Isolating Assembliesâ€ on page 775 in Chapter 18)</li>
<li>The Span and Memory structs, which help reduce memory allocations in
performance hotspots (see Chapter 24)</li>
<li>Array and memory pooling to reduce the load on the garbage collector (see
â€œArray Poolingâ€ on page 541 in Chapter 12)</li>
<li>A new EventCounter API for performance monitoring (see Chapter 13)</li>
<li>Startup hooks for injecting code into an applicationâ€™s Main method at runtime</li>
</ul>
<p>As well as general performance improvements to the CLR and garbage collecâ€
tor, .NET Core 3â€™s CLR includes an improvement to Just-In-Time (JIT) compilation,
called tiered compilation, whereby the CLR automatically identifies performance
hotspots as a program is running and then selectively re-JITs the Intermediate Lanâ€
guage to higher-quality native code.</p>
<p>.NET Core 3 also has new deployment features</p>
<ul>
<li>An Ahead-Of-Time (AOT) compilation option, allowing an application to be
compiled to native code before being deployed (in lieu of .NET Frameworkâ€™s
client-side native image generation tool)</li>
<li>Support for single-file executables with assembly linking to trim unused
assemblies</li>
<li>Support for MSIX, a new Windows deployment format</li>
</ul>
<h1 id="net-standard-20">NET Standard 2.0</h1>
<p>A library that targets .NET Standard 2.0 instead of a specific framework is usefully portable. The same assembly will run without modification on most of todayâ€™s popular frameworks, including the following</p>
<ul>
<li>.NET Core 2.0+</li>
<li>UWP 10.0.16299+</li>
<li>Mono 5.4+</li>
<li>.NET Framework 4.6.1+</li>
</ul>
<p>To target .NET Standard 2.0, add the following to your .csproj file:</p>
<div class="language-csharp highlight"><pre><span></span><code><span id="__span-555-1"><a id="__codelineno-555-1" name="__codelineno-555-1" href="#__codelineno-555-1"></a><span class="o">&lt;</span><span class="n">PropertyGroup</span><span class="o">&gt;</span>
</span><span id="__span-555-2"><a id="__codelineno-555-2" name="__codelineno-555-2" href="#__codelineno-555-2"></a><span class="w"> </span><span class="o">&lt;</span><span class="n">TargetFramework</span><span class="o">&gt;</span><span class="n">netstandard2</span><span class="mf">.0</span><span class="o">&lt;/</span><span class="n">TargetFramework</span><span class="o">&gt;</span>
</span><span id="__span-555-3"><a id="__codelineno-555-3" name="__codelineno-555-3" href="#__codelineno-555-3"></a><span class="w"> </span><span class="o">&lt;</span><span class="n">PropertyGroup</span><span class="o">&gt;</span>
</span></code></pre></div>
<aside>
ðŸ“¢ .NET Standard is not a framework; itâ€™s merely a specification describing a minimum baseline of functionality (types and members) that guarantees compatibility with a certain set of frameworks. The concept is similar to C# interfaces: .NET Standard is like an interface that concrete types (frameworks) can implement.

</aside>

<h3 id="net-framework-and-net-core-compatibility">.NET Framework and .NET Core Compatibility</h3>
<p>Because .NET Framework has existed for so long, itâ€™s not uncommon to encounter libraries that are available only for .NET Framework (with no .NET Standard or .NET Core equivalent). To help mitigate this situation, .NET Core projects are permitted to reference .NET Framework assemblies, with the following provisos</p>
<ul>
<li>An exception is thrown should the .NET Framework assembly call an API thatâ€™s not supported in .NET Core.</li>
<li>Nontrivial dependencies might fail to resolve.</li>
</ul>
<p>In practice, itâ€™s most likely to work with assemblies that perform a simple function, such as wrapping an unmanaged DLL, or that rely on a single well-supported API, such as WPF or Windows Forms.</p>
<h3 id="framework-and-c-language-versions">Framework and C# Language Versions</h3>
<p>The C# compiler chooses a language version automatically based on the framework
that your project targets</p>
<ul>
<li>For .NET Core 3.x and .NET Standard 2.1, it chooses C# 8.</li>
<li>For .NET Core 2.x, .NET Framework, and .NET Standard 2.0 and below, it
chooses C# 7.3.</li>
</ul>
<h1 id="reference-assemblies">Reference Assemblies</h1>
<p>When you target .NET Standard, your project implicitly references an assembly called netstandard.dll, which contains all of the allowable types and members for your chosen version of .NET Standard. This is called a reference assembly because it exists only for the benefit of the compiler and contains no compiled code. At runtime, the â€œrealâ€ assemblies are identified through assembly redirection attributes (the choice of assemblies will depend on which framework and platform the assembly eventually runs on).</p>
<p>Interestingly, a similar thing happens when you target .NET Core. Your project implicitly references a set of reference assemblies whose types mirror whatâ€™s in the runtime assemblies for the chosen .NET Core version. This helps with versioning and cross-platform compatibility, and also allows you to target a different .NET Core version than what is installed on your machine. For instance, if youâ€™ve
installed .NET Core 3, your project can still target .NET Core 2.2, and thanks to a set of reference assemblies, the compiler will see only the types and members available to .NET Core 2.2.</p>
<h1 id="the-clr-and-bcl">The CLR and BCL</h1>
<h3 id="system-types">System Types</h3>
<p>The most fundamental types live directly in the System namespace. These include C#â€™s built-in types, the Exception base class, the Enum, Array, and Delegate base classes, and Nullable, Type, DateTime, TimeSpan, and Guid.</p>
<p>The System namespace also includes types for performing mathematical functions (Math), generating random numbers (Random), and converting between various types (Convert and
BitConverter).</p>
<p>The System namespace also defines the IDisposable interface and the GC class for interacting with the garbage collector</p>
<h3 id="text-processing">Text Processing</h3>
<p>The System.Text namespace contains the StringBuilder class (the editable or mutable cousin of string) and the types for working with text encodings, such as UTF-8 (Encoding and its subtypes).</p>
<p>The System.Text.RegularExpressions namespace contains types that perform advanced pattern-based search-and-replace operations</p>
<h3 id="collections">Collections</h3>
<p>.NET Core offers a variety of classes for managing collections of items. These include both list- and dictionary-based structures; they work in conjunction with a set of standard interfaces that unify their common characteristics.</p>
<div class="language-csharp highlight"><pre><span></span><code><span id="__span-556-1"><a id="__codelineno-556-1" name="__codelineno-556-1" href="#__codelineno-556-1"></a><span class="n">System</span><span class="p">.</span><span class="n">Collections</span><span class="w"> </span><span class="c1">// Nongeneric collections</span>
</span><span id="__span-556-2"><a id="__codelineno-556-2" name="__codelineno-556-2" href="#__codelineno-556-2"></a><span class="n">System</span><span class="p">.</span><span class="n">Collections</span><span class="p">.</span><span class="n">Generic</span><span class="w"> </span><span class="c1">// Generic collections</span>
</span><span id="__span-556-3"><a id="__codelineno-556-3" name="__codelineno-556-3" href="#__codelineno-556-3"></a><span class="n">System</span><span class="p">.</span><span class="n">Collections</span><span class="p">.</span><span class="n">Specialized</span><span class="w"> </span><span class="c1">// Strongly typed collections</span>
</span><span id="__span-556-4"><a id="__codelineno-556-4" name="__codelineno-556-4" href="#__codelineno-556-4"></a><span class="n">System</span><span class="p">.</span><span class="n">Collections</span><span class="p">.</span><span class="n">ObjectModel</span><span class="w"> </span><span class="c1">// Bases for your own collections</span>
</span><span id="__span-556-5"><a id="__codelineno-556-5" name="__codelineno-556-5" href="#__codelineno-556-5"></a><span class="n">System</span><span class="p">.</span><span class="n">Collections</span><span class="p">.</span><span class="n">Concurrent</span><span class="w"> </span><span class="c1">// Thread-safe collection (Chapter 23)</span>
</span></code></pre></div>
<h3 id="querying">Querying</h3>
<p>LINQ allows you to perform type-safe queries over local and remote collections. A big advantage
of LINQ is that it presents a consistent querying API across a variety of domains.</p>
<div class="language-csharp highlight"><pre><span></span><code><span id="__span-557-1"><a id="__codelineno-557-1" name="__codelineno-557-1" href="#__codelineno-557-1"></a><span class="n">System</span><span class="p">.</span><span class="n">Linq</span><span class="w"> </span><span class="c1">// LINQ to Objects and PLINQ</span>
</span><span id="__span-557-2"><a id="__codelineno-557-2" name="__codelineno-557-2" href="#__codelineno-557-2"></a><span class="n">System</span><span class="p">.</span><span class="n">Linq</span><span class="p">.</span><span class="n">Expressions</span><span class="w"> </span><span class="c1">// For building expressions manually</span>
</span><span id="__span-557-3"><a id="__codelineno-557-3" name="__codelineno-557-3" href="#__codelineno-557-3"></a><span class="n">System</span><span class="p">.</span><span class="n">Xml</span><span class="p">.</span><span class="n">Linq</span><span class="w"> </span><span class="c1">// LINQ to XML</span>
</span></code></pre></div>
<h3 id="xml-and-json">XML and JSON</h3>
<p>XML and JSON are widely supported in .NET Core.</p>
<div class="language-csharp highlight"><pre><span></span><code><span id="__span-558-1"><a id="__codelineno-558-1" name="__codelineno-558-1" href="#__codelineno-558-1"></a><span class="n">System</span><span class="p">.</span><span class="n">Xml</span><span class="w"> </span><span class="c1">// XmlReader, XmlWriter</span>
</span><span id="__span-558-2"><a id="__codelineno-558-2" name="__codelineno-558-2" href="#__codelineno-558-2"></a><span class="n">System</span><span class="p">.</span><span class="n">Xml</span><span class="p">.</span><span class="n">Linq</span><span class="w"> </span><span class="c1">// The LINQ to XML DOM</span>
</span><span id="__span-558-3"><a id="__codelineno-558-3" name="__codelineno-558-3" href="#__codelineno-558-3"></a><span class="n">System</span><span class="p">.</span><span class="n">Xml</span><span class="p">.</span><span class="n">Schema</span><span class="w"> </span><span class="c1">// Support for XSD</span>
</span><span id="__span-558-4"><a id="__codelineno-558-4" name="__codelineno-558-4" href="#__codelineno-558-4"></a><span class="n">System</span><span class="p">.</span><span class="n">Xml</span><span class="p">.</span><span class="n">Serialization</span><span class="w"> </span><span class="c1">// Declarative XML serialization for .NET types</span>
</span><span id="__span-558-5"><a id="__codelineno-558-5" name="__codelineno-558-5" href="#__codelineno-558-5"></a><span class="n">System</span><span class="p">.</span><span class="n">Xml</span><span class="p">.</span><span class="n">XPath</span><span class="w"> </span><span class="c1">// XPath query language</span>
</span><span id="__span-558-6"><a id="__codelineno-558-6" name="__codelineno-558-6" href="#__codelineno-558-6"></a><span class="n">System</span><span class="p">.</span><span class="n">Xml</span><span class="p">.</span><span class="n">Xsl</span><span class="w"> </span><span class="c1">// Stylesheet support</span>
</span><span id="__span-558-7"><a id="__codelineno-558-7" name="__codelineno-558-7" href="#__codelineno-558-7"></a><span class="n">System</span><span class="p">.</span><span class="n">Text</span><span class="p">.</span><span class="n">Json</span><span class="w"> </span><span class="c1">// JSON reader/writer and document object model</span>
</span></code></pre></div>
<h3 id="diagnostics">Diagnostics</h3>
<p>we cover logging and assertion and describe how to interact with other processes, write to the Windows event log, and handle performance monitoring. The types for this are defined in and under <code>System.Diagnostics</code>.</p>
<h3 id="concurrency-and-asynchrony">Concurrency and Asynchrony</h3>
<p>Many modern applications need to deal with more than one thing happening at a time. Since C# 5.0, this has become easier through asynchronous functions and high-level constructs such as tasks and task combinators.</p>
<p>Types for working with threads and asynchronous operations are in the <code>System.Threading</code> and
<code>System.Threading.Tasks</code> namespaces.</p>
<h3 id="streams-and-io">Streams and I/O</h3>
<p>.NET Core provides a stream-based model for low-level I/O. Streams are typically used to read and write directly to files and network connections, and can be chained or wrapped in decorator streams to add compression or encryption functionality. The Stream and I/O types are defined in and under the  <a href="http://system.io/"><code>System.IO</code></a> namespace</p>
<h3 id="networking">Networking</h3>
<p>You can directly access standard network protocols such as HTTP, FTP, TCP/IP, and
SMTP via the types in <code>System.Net</code>.</p>
<div class="language-csharp highlight"><pre><span></span><code><span id="__span-559-1"><a id="__codelineno-559-1" name="__codelineno-559-1" href="#__codelineno-559-1"></a><span class="n">System</span><span class="p">.</span><span class="n">Net</span>
</span><span id="__span-559-2"><a id="__codelineno-559-2" name="__codelineno-559-2" href="#__codelineno-559-2"></a><span class="n">System</span><span class="p">.</span><span class="n">Net</span><span class="p">.</span><span class="n">Http</span><span class="w"> </span><span class="c1">// HttpClient</span>
</span><span id="__span-559-3"><a id="__codelineno-559-3" name="__codelineno-559-3" href="#__codelineno-559-3"></a><span class="n">System</span><span class="p">.</span><span class="n">Net</span><span class="p">.</span><span class="n">Mail</span><span class="w"> </span><span class="c1">// For sending mail via SMTP</span>
</span><span id="__span-559-4"><a id="__codelineno-559-4" name="__codelineno-559-4" href="#__codelineno-559-4"></a><span class="n">System</span><span class="p">.</span><span class="n">Net</span><span class="p">.</span><span class="n">Sockets</span><span class="w"> </span><span class="c1">// TCP, UDP, and IP</span>
</span></code></pre></div>
<h3 id="serialization">Serialization</h3>
<p>The Framework provides several systems for saving and restoring objects to a binary or text representation. Such systems can be required for communication as well as saving and restoring objects to a file.</p>
<p>we cover the three major serialization engines: the binary serializer, the JSON serializer, and the XML serializer. The types for serialization reside in the following namespaces.</p>
<div class="language-csharp highlight"><pre><span></span><code><span id="__span-560-1"><a id="__codelineno-560-1" name="__codelineno-560-1" href="#__codelineno-560-1"></a><span class="n">System</span><span class="p">.</span><span class="n">Runtime</span><span class="p">.</span><span class="n">Serialization</span>
</span><span id="__span-560-2"><a id="__codelineno-560-2" name="__codelineno-560-2" href="#__codelineno-560-2"></a><span class="n">System</span><span class="p">.</span><span class="n">Xml</span><span class="p">.</span><span class="n">Serialization</span>
</span><span id="__span-560-3"><a id="__codelineno-560-3" name="__codelineno-560-3" href="#__codelineno-560-3"></a><span class="n">System</span><span class="p">.</span><span class="n">Text</span><span class="p">.</span><span class="n">Json</span>
</span></code></pre></div>
<h3 id="assemblies-reflection-and-attributes">Assemblies, Reflection, and Attributes</h3>
<p>The assemblies into which C# programs compile comprise executable instructions
(stored as IL) and metadata, which describes the programâ€™s types, members, and
attributes. Through reflection, you can inspect this metadata at runtime and do such
things as dynamically invoke methods. With Reflection.Emit, you can construct
new code on the fly.</p>
<div class="language-csharp highlight"><pre><span></span><code><span id="__span-561-1"><a id="__codelineno-561-1" name="__codelineno-561-1" href="#__codelineno-561-1"></a><span class="n">System</span>
</span><span id="__span-561-2"><a id="__codelineno-561-2" name="__codelineno-561-2" href="#__codelineno-561-2"></a><span class="n">System</span><span class="p">.</span><span class="n">Reflection</span>
</span><span id="__span-561-3"><a id="__codelineno-561-3" name="__codelineno-561-3" href="#__codelineno-561-3"></a><span class="n">System</span><span class="p">.</span><span class="n">Reflection</span><span class="p">.</span><span class="n">Emit</span>
</span></code></pre></div>
<h3 id="dynamic-programming">Dynamic Programming</h3>
<p>we look at some of the patterns for dynamic programming and utilizing the Dynamic Language Runtime (DLR). We describe how to implement the Visitor pattern, write custom dynamic objects, and interoperate with IronPython. The types for dynamic programming are in <code>System.Dynamic</code>.</p>
<h3 id="cryptography">Cryptography</h3>
<p>.NET Core provides extensive support for popular hashing and encryption protocols.</p>
<div class="language-csharp highlight"><pre><span></span><code><span id="__span-562-1"><a id="__codelineno-562-1" name="__codelineno-562-1" href="#__codelineno-562-1"></a><span class="n">System</span><span class="p">.</span><span class="n">Security</span>
</span><span id="__span-562-2"><a id="__codelineno-562-2" name="__codelineno-562-2" href="#__codelineno-562-2"></a><span class="n">System</span><span class="p">.</span><span class="n">Security</span><span class="p">.</span><span class="n">Cryptography</span>
</span></code></pre></div>
<h3 id="advanced-threading">Advanced Threading</h3>
<p>C#â€™s asynchronous functions make concurrent programming significantly easier because they lessen the need for lower-level techniques. However, there are still times when you need signaling constructs, thread-local storage, reader/writer locks, and so on. Threading types are in the
<code>System.Threading</code> namespace.</p>
<h3 id="parallel-programming">Parallel Programming</h3>
<p>we cover in detail the libraries and types for leveraging multicore processors, including APIs for task parallelism, imperative data parallelism, and functional parallelism (PLINQ).</p>
<h3 id="native-and-com-interoperability">Native and COM Interoperability</h3>
<p>You can interoperate with both native and Component Object Model (COM) code. Native interoperability allows you to call functions in unmanaged DLLs, register callbacks, map data structures, and interoperate with native data types. COM interoperability allows you to call COM types (on Windows machines), and expose .NET Core types to COM. The types that support these functions are in <code>System.Runtime.InteropServices</code></p>
<h3 id="the-roslyn-compiler">The Roslyn Compiler</h3>
<p>The C# compiler itself is written in C#â€”the project is called â€œRoslyn,â€ and the libraries are available as NuGet packages. With these libraries, you can utilize the compilerâ€™s functionality in many ways besides compiling source code to an assembly, such as writing code analysis and refactoring tools. </p>
<h1 id="application-frameworks">Application Frameworks</h1>
<p>UIâ€“based applications can be divided into two categories: thin client, which amounts to a website, and rich client, which is a program the end user must download and install on a computer or mobile device.</p>
<p>For writing thin-client applications in C#, thereâ€™s ASP.NET Core, which runs on Windows, Linux, and macOS. ASP.NET Core is also designed for writing web APIs.</p>
<p>For rich-client applications, there are a choice of APIs</p>
<ul>
<li>The Windows Desktop framework includes the WPF and Windows Forms APIs, and runs on Windows 7/8/10 desktop</li>
<li>UWP runs on Windows 10 desktop and devices</li>
<li>Xamarin runs on iOS and Android mobile devices</li>
</ul>
<h3 id="aspnet-core"><a href="http://asp.net/">ASP.NET</a> Core</h3>
<p>ASP.NET Core is a lightweight modular successor to ASP.NET, with support for the popular Model-View-Controller (MVC) pattern. ASP.NET Core is suitable for creating websites, REST-based web APIs, and microservices. It can also run in conjunction with two popular single-page-application frameworks: React and Angular.</p>
<p>ASP.NET Core runs on Windows, Linux, and macOS and can self-host in a custom process. Unlike its predecessor (ASP.NET), ASP.NET Core is not dependent on <code>System.Web</code> and the historical baggage of web forms</p>
<p>As with any thin-client architecture, ASP.NET Core offers the following general advantages over rich clients:</p>
<ul>
<li>There is zero deployment at the client end</li>
<li>The client can run on any platform that supports a web browser</li>
<li>Updates are easily deployed</li>
</ul>
<h2 id="windows-desktop">Windows Desktop</h2>
<p>The Windows Desktop application framework offers a choice of two UI APIs for writing rich-client applications: WPF and Windows Forms. Both APIs run on Windows Desktop/Server 7 through 10.</p>
<h3 id="wpf">WPF</h3>
<p>WPF was introduced in 2006, and has been enhanced ever since. Unlike its predecessor, Windows Forms, WPF explicitly renders controls using DirectX, with the following benefits</p>
<ul>
<li>It supports sophisticated graphics, such as arbitrary transformations, <strong>3D rendering</strong>, multimedia, and <strong>true transparency</strong>. Skinning is supported through styles and templates.</li>
<li>Its primary <strong>measurement unit is not pixel-based, so applications display correctly at any DPI setting</strong>.</li>
<li>It has extensive and flexible layout support, which means that you can <strong>localize an application without danger of elements overlapping</strong>.</li>
<li>Its use of <strong>DirectX makes rendering fast and able to take advantage of graphics hardware acceleration.</strong></li>
<li>It offers <strong>reliable data binding</strong>.</li>
<li>UIs can be described declaratively in <strong>XAML files that can be maintained independent of the â€œcode-behindâ€ files</strong>â€”this helps to separate appearance from functionality.</li>
</ul>
<aside>
ðŸ”¥ WPF takes some time to learn due to its size and complexity. The types for writing
WPF applications are in the `System.Windows` namespace and all subnamespaces
except for `System.Windows.Forms`.

</aside>

<h3 id="windows-forms">Windows Forms</h3>
<p>Windows Forms is a rich-client API that shipped with the first version of .NET Framework in 2000. <strong>Compared to WPF, Windows Forms is a relatively simple technology that provides most of the features you need in writing a typical Windows application</strong>. It also has significant relevancy in maintaining legacy applications.</p>
<ul>
<li>Although it provides mechanisms for DPI awareness, itâ€™s still too easy to write applications that break on clients whose DPI settings differ from the developerâ€™s.</li>
<li>The API for drawing nonstandard controls is GDI+, which, although reasonably flexible, is slow in rendering large areas (and, without double buffering,might flicker).</li>
<li>Controls <strong>lack true transparency</strong>.</li>
<li><strong>Most controls are noncompositional. For instance, you canâ€™t put an image control inside a tab control header. Customizing list views, combo boxes, and tab controls in a way that would be trivial with WPF is time consuming and painful in Windows Forms.</strong></li>
<li>Dynamic layout is difficult to correctly implement.</li>
</ul>
<aside>
ðŸ“¢ The last point is an excellent reason to favor WPF over Windows Formsâ€”even if youâ€™re writing a business application that needs just a UI and not a â€œuser experience.â€ The layout elements in WPF, such as Grid, make it easy to assemble labels and text boxes such that they always alignâ€”even after language-changing localizationâ€”without messy logic and without any flickering. Further, you donâ€™t need to bow to the lowest common denominator in screen resolutionâ€”WPF layout elements have been designed from the outset to adapt properly to resizing. On the positive side, Windows Forms is relatively simple to learn and still has a good number of third-party controls.

</aside>

<p>The Windows Forms types are in the <code>System.Windows.Forms</code> (in <code>System.Windows.Forms.dll</code>) and <code>System.Drawing</code> (in <code>System.Drawing.dll</code>) namespaces. The latter also contains the GDI+ types for drawing custom controls.</p>
<h3 id="uwp">UWP</h3>
<p>UWP is a rich-client API for writing touch-first UIs that target Windows 10 desktop and devices. The word â€œUniversalâ€ refers to its ability to run on a range of Windows</p>
<p>10 devices, including Xbox, Surface Hub, and Hololens. However, itâ€™s not compatible with earlier versions of Windows, including Windows 7 and Windows 8/8.1.</p>
<p>The UWP API uses XAML and is somewhat similar to WPF. Here are its key
differences</p>
<ul>
<li>The primary mode of distribution for UWP apps is the Windows Store.</li>
<li>UWP apps run in a sandbox to lessen the threat of malware, which means that
they cannot perform tasks such as reading or writing arbitrary files, and they
cannot run with administrative elevation.</li>
<li>UWP relies on WinRT types that are part of the operating system (Windows),
not the managed framework. This means that when writing apps, you must
nominate a Windows 10 version range (such as Windows 10 build 17763 to
Windows 10 build 18362). This means that you either need to target an old
API, or require that your customers install the latest Windows update.</li>
</ul>
<aside>
âš ï¸ To address the last point, Microsoft is introducing WinUI 3, which transfers the
WinRT APIs from the operating system to the framework. WinUI 3 will also help to
bridge the divide between Windows Desktop and UWP: rather than having to
choose one or the other, youâ€™ll be able to mix and match components from each.

</aside>

<p>The namespaces in UWP are <code>Windows.UI</code> and <code>Windows.UI.Xaml</code>.</p>
<h3 id="xamarin">Xamarin</h3>
<p>Xamarin lets you write mobile apps in C# that target iOS and Android. Xamarin doesnâ€™t run on .NET Core, but on Mono (a derivation of the open source Mono framework).# Chapter 6 : Framework Fundamentals</p>
<h1 id="string-and-text-handling">String and Text Handling</h1>
<h2 id="char">char</h2>
<p>A C# char represents a single Unicode character and aliases the System.</p>
<div class="language-csharp highlight"><pre><span></span><code><span id="__span-563-1"><a id="__codelineno-563-1" name="__codelineno-563-1" href="#__codelineno-563-1"></a><span class="kt">char</span><span class="w"> </span><span class="n">c</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="sc">&#39;A&#39;</span><span class="p">;</span>
</span><span id="__span-563-2"><a id="__codelineno-563-2" name="__codelineno-563-2" href="#__codelineno-563-2"></a><span class="kt">char</span><span class="w"> </span><span class="n">newLine</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="sc">&#39;\n&#39;</span><span class="p">;</span>
</span><span id="__span-563-3"><a id="__codelineno-563-3" name="__codelineno-563-3" href="#__codelineno-563-3"></a>
</span><span id="__span-563-4"><a id="__codelineno-563-4" name="__codelineno-563-4" href="#__codelineno-563-4"></a><span class="c1">// System.Char defines a range of static methods for working with characters:</span>
</span><span id="__span-563-5"><a id="__codelineno-563-5" name="__codelineno-563-5" href="#__codelineno-563-5"></a><span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="w"> </span><span class="p">(</span><span class="kt">char</span><span class="p">.</span><span class="n">ToUpper</span><span class="w"> </span><span class="p">(</span><span class="sc">&#39;c&#39;</span><span class="p">));</span><span class="w">             </span><span class="c1">// C</span>
</span><span id="__span-563-6"><a id="__codelineno-563-6" name="__codelineno-563-6" href="#__codelineno-563-6"></a><span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="w"> </span><span class="p">(</span><span class="kt">char</span><span class="p">.</span><span class="n">IsWhiteSpace</span><span class="w"> </span><span class="p">(</span><span class="sc">&#39;\t&#39;</span><span class="p">));</span><span class="w">       </span><span class="c1">// True</span>
</span><span id="__span-563-7"><a id="__codelineno-563-7" name="__codelineno-563-7" href="#__codelineno-563-7"></a><span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="w"> </span><span class="p">(</span><span class="kt">char</span><span class="p">.</span><span class="n">IsLetter</span><span class="w"> </span><span class="p">(</span><span class="sc">&#39;x&#39;</span><span class="p">));</span><span class="w">            </span><span class="c1">// True</span>
</span><span id="__span-563-8"><a id="__codelineno-563-8" name="__codelineno-563-8" href="#__codelineno-563-8"></a><span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="w"> </span><span class="p">(</span><span class="kt">char</span><span class="p">.</span><span class="n">GetUnicodeCategory</span><span class="w"> </span><span class="p">(</span><span class="sc">&#39;x&#39;</span><span class="p">));</span><span class="w">  </span><span class="c1">// LowercaseLetter</span>
</span></code></pre></div>
<p><code>System.Char</code> defines a range of static methods for working with characters, such as
<code>ToUpper</code>, <code>ToLower</code>, and <code>IsWhiteSpace</code>. </p>
<h2 id="string">string</h2>
<p>A C# string (== System.String) is an <strong>immutable</strong> (unchangeable) sequence of characters.</p>
<h3 id="constructing-strings">Constructing strings</h3>
<div class="language-csharp highlight"><pre><span></span><code><span id="__span-564-1"><a id="__codelineno-564-1" name="__codelineno-564-1" href="#__codelineno-564-1"></a><span class="c1">// String literals:</span>
</span><span id="__span-564-2"><a id="__codelineno-564-2" name="__codelineno-564-2" href="#__codelineno-564-2"></a><span class="kt">string</span><span class="w"> </span><span class="n">s1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;Hello&quot;</span><span class="p">;</span>
</span><span id="__span-564-3"><a id="__codelineno-564-3" name="__codelineno-564-3" href="#__codelineno-564-3"></a><span class="kt">string</span><span class="w"> </span><span class="n">s2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;First Line\r\nSecond Line&quot;</span><span class="p">;</span>
</span><span id="__span-564-4"><a id="__codelineno-564-4" name="__codelineno-564-4" href="#__codelineno-564-4"></a><span class="kt">string</span><span class="w"> </span><span class="n">s3</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">@&quot;\\server\fileshare\helloworld.cs&quot;</span><span class="p">;</span>
</span><span id="__span-564-5"><a id="__codelineno-564-5" name="__codelineno-564-5" href="#__codelineno-564-5"></a>
</span><span id="__span-564-6"><a id="__codelineno-564-6" name="__codelineno-564-6" href="#__codelineno-564-6"></a><span class="c1">// To create a repeating sequence of characters you can use stringâ€™s constructor:</span>
</span><span id="__span-564-7"><a id="__codelineno-564-7" name="__codelineno-564-7" href="#__codelineno-564-7"></a><span class="n">Console</span><span class="p">.</span><span class="n">Write</span><span class="w"> </span><span class="p">(</span><span class="k">new</span><span class="w"> </span><span class="kt">string</span><span class="w"> </span><span class="p">(</span><span class="sc">&#39;*&#39;</span><span class="p">,</span><span class="w"> </span><span class="mi">10</span><span class="p">));</span><span class="w">    </span><span class="c1">// **********</span>
</span><span id="__span-564-8"><a id="__codelineno-564-8" name="__codelineno-564-8" href="#__codelineno-564-8"></a>
</span><span id="__span-564-9"><a id="__codelineno-564-9" name="__codelineno-564-9" href="#__codelineno-564-9"></a><span class="c1">// You can also construct a string from a char array. ToCharArray does the reverse:</span>
</span><span id="__span-564-10"><a id="__codelineno-564-10" name="__codelineno-564-10" href="#__codelineno-564-10"></a><span class="kt">char</span><span class="p">[]</span><span class="w"> </span><span class="n">ca</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;Hello&quot;</span><span class="p">.</span><span class="n">ToCharArray</span><span class="p">();</span>
</span><span id="__span-564-11"><a id="__codelineno-564-11" name="__codelineno-564-11" href="#__codelineno-564-11"></a><span class="kt">string</span><span class="w"> </span><span class="n">s</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="kt">string</span><span class="w"> </span><span class="p">(</span><span class="n">ca</span><span class="p">);</span><span class="w">              </span><span class="c1">// s = &quot;Hello&quot;</span>
</span><span id="__span-564-12"><a id="__codelineno-564-12" name="__codelineno-564-12" href="#__codelineno-564-12"></a><span class="n">s</span><span class="p">.</span><span class="n">Dump</span><span class="p">();</span>
</span></code></pre></div>
<h3 id="null-and-empty-strings">Null and empty strings</h3>
<p>An empty string has a length of zero. To create an empty string, you can use either a literal or the static string.Empty field; to test for an empty string, you can either perform an equality comparison or test its Length property</p>
<div class="language-csharp highlight"><pre><span></span><code><span id="__span-565-1"><a id="__codelineno-565-1" name="__codelineno-565-1" href="#__codelineno-565-1"></a><span class="c1">// An empty string has a length of zero:</span>
</span><span id="__span-565-2"><a id="__codelineno-565-2" name="__codelineno-565-2" href="#__codelineno-565-2"></a><span class="kt">string</span><span class="w"> </span><span class="n">empty</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;&quot;</span><span class="p">;</span>
</span><span id="__span-565-3"><a id="__codelineno-565-3" name="__codelineno-565-3" href="#__codelineno-565-3"></a><span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="w"> </span><span class="p">(</span><span class="n">empty</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s">&quot;&quot;</span><span class="p">);</span><span class="w">              </span><span class="c1">// True</span>
</span><span id="__span-565-4"><a id="__codelineno-565-4" name="__codelineno-565-4" href="#__codelineno-565-4"></a><span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="w"> </span><span class="p">(</span><span class="n">empty</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="kt">string</span><span class="p">.</span><span class="n">Empty</span><span class="p">);</span><span class="w">    </span><span class="c1">// True</span>
</span><span id="__span-565-5"><a id="__codelineno-565-5" name="__codelineno-565-5" href="#__codelineno-565-5"></a><span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="w"> </span><span class="p">(</span><span class="n">empty</span><span class="p">.</span><span class="n">Length</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">0</span><span class="p">);</span><span class="w">        </span><span class="c1">// True</span>
</span><span id="__span-565-6"><a id="__codelineno-565-6" name="__codelineno-565-6" href="#__codelineno-565-6"></a>
</span><span id="__span-565-7"><a id="__codelineno-565-7" name="__codelineno-565-7" href="#__codelineno-565-7"></a><span class="c1">//Because strings are reference types, they can also be null:</span>
</span><span id="__span-565-8"><a id="__codelineno-565-8" name="__codelineno-565-8" href="#__codelineno-565-8"></a><span class="kt">string</span><span class="w"> </span><span class="n">nullString</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">null</span><span class="p">;</span>
</span><span id="__span-565-9"><a id="__codelineno-565-9" name="__codelineno-565-9" href="#__codelineno-565-9"></a><span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="w"> </span><span class="p">(</span><span class="n">nullString</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="k">null</span><span class="p">);</span><span class="w">        </span><span class="c1">// True</span>
</span><span id="__span-565-10"><a id="__codelineno-565-10" name="__codelineno-565-10" href="#__codelineno-565-10"></a><span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="w"> </span><span class="p">(</span><span class="n">nullString</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s">&quot;&quot;</span><span class="p">);</span><span class="w">          </span><span class="c1">// False</span>
</span><span id="__span-565-11"><a id="__codelineno-565-11" name="__codelineno-565-11" href="#__codelineno-565-11"></a><span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="w"> </span><span class="p">(</span><span class="kt">string</span><span class="p">.</span><span class="n">IsNullOrEmpty</span><span class="w"> </span><span class="p">(</span><span class="n">nullString</span><span class="p">));</span><span class="w">  </span><span class="c1">// True</span>
</span><span id="__span-565-12"><a id="__codelineno-565-12" name="__codelineno-565-12" href="#__codelineno-565-12"></a><span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="w"> </span><span class="p">(</span><span class="n">nullString</span><span class="p">.</span><span class="n">Length</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">0</span><span class="p">);</span><span class="w">             </span><span class="c1">// NullReferenceException</span>
</span></code></pre></div>
<h3 id="accessing-characters-within-a-string">Accessing characters within a string</h3>
<p>A stringâ€™s indexer returns a single character at the given index. As with all functions that operate on strings, this is zero-indexed</p>
<div class="language-csharp highlight"><pre><span></span><code><span id="__span-566-1"><a id="__codelineno-566-1" name="__codelineno-566-1" href="#__codelineno-566-1"></a><span class="kt">string</span><span class="w"> </span><span class="n">str</span><span class="w">  </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;abcde&quot;</span><span class="p">;</span>
</span><span id="__span-566-2"><a id="__codelineno-566-2" name="__codelineno-566-2" href="#__codelineno-566-2"></a><span class="kt">char</span><span class="w"> </span><span class="n">letter</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">str</span><span class="p">[</span><span class="mi">1</span><span class="p">];</span><span class="w">        </span><span class="c1">// letter == &#39;b&#39;</span>
</span><span id="__span-566-3"><a id="__codelineno-566-3" name="__codelineno-566-3" href="#__codelineno-566-3"></a>
</span><span id="__span-566-4"><a id="__codelineno-566-4" name="__codelineno-566-4" href="#__codelineno-566-4"></a><span class="c1">// string also implements IEnumerable&lt;char&gt;, so you can foreach over its characters:</span>
</span><span id="__span-566-5"><a id="__codelineno-566-5" name="__codelineno-566-5" href="#__codelineno-566-5"></a><span class="k">foreach</span><span class="w"> </span><span class="p">(</span><span class="kt">char</span><span class="w"> </span><span class="n">c</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="s">&quot;123&quot;</span><span class="p">)</span><span class="w"> </span><span class="n">Console</span><span class="p">.</span><span class="n">Write</span><span class="w"> </span><span class="p">(</span><span class="n">c</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s">&quot;,&quot;</span><span class="p">);</span><span class="w">    </span><span class="c1">// 1,2,3,</span>
</span></code></pre></div>
<h3 id="searching-within-strings">Searching within strings</h3>
<p>The simplest methods for searching within strings are StartsWith, EndsWith, and Contains. These all return true or false</p>
<div class="language-csharp highlight"><pre><span></span><code><span id="__span-567-1"><a id="__codelineno-567-1" name="__codelineno-567-1" href="#__codelineno-567-1"></a><span class="c1">// The simplest search methods are Contains, StartsWith, and EndsWith:</span>
</span><span id="__span-567-2"><a id="__codelineno-567-2" name="__codelineno-567-2" href="#__codelineno-567-2"></a><span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="w"> </span><span class="p">(</span><span class="s">&quot;quick brown fox&quot;</span><span class="p">.</span><span class="n">Contains</span><span class="w"> </span><span class="p">(</span><span class="s">&quot;brown&quot;</span><span class="p">));</span><span class="w">    </span><span class="c1">// True</span>
</span><span id="__span-567-3"><a id="__codelineno-567-3" name="__codelineno-567-3" href="#__codelineno-567-3"></a><span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="w"> </span><span class="p">(</span><span class="s">&quot;quick brown fox&quot;</span><span class="p">.</span><span class="n">EndsWith</span><span class="w"> </span><span class="p">(</span><span class="s">&quot;fox&quot;</span><span class="p">));</span><span class="w">      </span><span class="c1">// True</span>
</span><span id="__span-567-4"><a id="__codelineno-567-4" name="__codelineno-567-4" href="#__codelineno-567-4"></a>
</span><span id="__span-567-5"><a id="__codelineno-567-5" name="__codelineno-567-5" href="#__codelineno-567-5"></a><span class="c1">// IndexOf returns the first position of a given character or substring:</span>
</span><span id="__span-567-6"><a id="__codelineno-567-6" name="__codelineno-567-6" href="#__codelineno-567-6"></a><span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="w"> </span><span class="p">(</span><span class="s">&quot;abcde&quot;</span><span class="p">.</span><span class="n">IndexOf</span><span class="w"> </span><span class="p">(</span><span class="s">&quot;cd&quot;</span><span class="p">));</span><span class="w">   </span><span class="c1">// 2</span>
</span><span id="__span-567-7"><a id="__codelineno-567-7" name="__codelineno-567-7" href="#__codelineno-567-7"></a><span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="w"> </span><span class="p">(</span><span class="s">&quot;abcde&quot;</span><span class="p">.</span><span class="n">IndexOf</span><span class="w"> </span><span class="p">(</span><span class="s">&quot;xx&quot;</span><span class="p">));</span><span class="w">   </span><span class="c1">// -1</span>
</span><span id="__span-567-8"><a id="__codelineno-567-8" name="__codelineno-567-8" href="#__codelineno-567-8"></a>
</span><span id="__span-567-9"><a id="__codelineno-567-9" name="__codelineno-567-9" href="#__codelineno-567-9"></a><span class="c1">// IndexOf is overloaded to accept a startPosition StringComparison enum, which enables case-insensitive searches:</span>
</span><span id="__span-567-10"><a id="__codelineno-567-10" name="__codelineno-567-10" href="#__codelineno-567-10"></a><span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="w"> </span><span class="p">(</span><span class="s">&quot;abcde&quot;</span><span class="p">.</span><span class="n">IndexOf</span><span class="w"> </span><span class="p">(</span><span class="s">&quot;CD&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">StringComparison</span><span class="p">.</span><span class="n">CurrentCultureIgnoreCase</span><span class="p">));</span><span class="w">    </span><span class="c1">// 2</span>
</span><span id="__span-567-11"><a id="__codelineno-567-11" name="__codelineno-567-11" href="#__codelineno-567-11"></a>
</span><span id="__span-567-12"><a id="__codelineno-567-12" name="__codelineno-567-12" href="#__codelineno-567-12"></a><span class="c1">// LastIndexOf is like IndexOf, but works backward through the string.</span>
</span><span id="__span-567-13"><a id="__codelineno-567-13" name="__codelineno-567-13" href="#__codelineno-567-13"></a><span class="c1">// IndexOfAny returns the first matching position of any one of a set of characters:</span>
</span><span id="__span-567-14"><a id="__codelineno-567-14" name="__codelineno-567-14" href="#__codelineno-567-14"></a><span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="w"> </span><span class="p">(</span><span class="s">&quot;ab,cd ef&quot;</span><span class="p">.</span><span class="n">IndexOfAny</span><span class="w"> </span><span class="p">(</span><span class="k">new</span><span class="w"> </span><span class="kt">char</span><span class="p">[]</span><span class="w"> </span><span class="p">{</span><span class="sc">&#39; &#39;</span><span class="p">,</span><span class="w"> </span><span class="sc">&#39;,&#39;</span><span class="p">}</span><span class="w"> </span><span class="p">));</span><span class="w">       </span><span class="c1">// 2</span>
</span><span id="__span-567-15"><a id="__codelineno-567-15" name="__codelineno-567-15" href="#__codelineno-567-15"></a><span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="w"> </span><span class="p">(</span><span class="s">&quot;pas5w0rd&quot;</span><span class="p">.</span><span class="n">IndexOfAny</span><span class="w"> </span><span class="p">(</span><span class="s">&quot;0123456789&quot;</span><span class="p">.</span><span class="n">ToCharArray</span><span class="p">()</span><span class="w"> </span><span class="p">));</span><span class="w">  </span><span class="c1">// 3</span>
</span><span id="__span-567-16"><a id="__codelineno-567-16" name="__codelineno-567-16" href="#__codelineno-567-16"></a>
</span><span id="__span-567-17"><a id="__codelineno-567-17" name="__codelineno-567-17" href="#__codelineno-567-17"></a><span class="c1">// LastIndexOfAny does the same in the reverse direction.</span>
</span></code></pre></div>
<h3 id="manipulating-strings">Manipulating strings</h3>
<p>Because string is immutable, all the methods that manipulate a string return a new one, leaving the original untouched (the same goes for when you reassign a string variable).</p>
<div class="language-csharp highlight"><pre><span></span><code><span id="__span-568-1"><a id="__codelineno-568-1" name="__codelineno-568-1" href="#__codelineno-568-1"></a><span class="c1">// Because String is immutable, all the methods below return a new string, leaving the original untouched.</span>
</span><span id="__span-568-2"><a id="__codelineno-568-2" name="__codelineno-568-2" href="#__codelineno-568-2"></a>
</span><span id="__span-568-3"><a id="__codelineno-568-3" name="__codelineno-568-3" href="#__codelineno-568-3"></a><span class="c1">// Substring extracts a portion of a string:</span>
</span><span id="__span-568-4"><a id="__codelineno-568-4" name="__codelineno-568-4" href="#__codelineno-568-4"></a><span class="kt">string</span><span class="w"> </span><span class="n">left3</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;12345&quot;</span><span class="p">.</span><span class="n">Substring</span><span class="w"> </span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">3</span><span class="p">);</span><span class="w">     </span><span class="c1">// left3 = &quot;123&quot;;</span>
</span><span id="__span-568-5"><a id="__codelineno-568-5" name="__codelineno-568-5" href="#__codelineno-568-5"></a><span class="kt">string</span><span class="w"> </span><span class="n">mid3</span><span class="w">  </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;12345&quot;</span><span class="p">.</span><span class="n">Substring</span><span class="w"> </span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">3</span><span class="p">);</span><span class="w">     </span><span class="c1">// mid3 = &quot;234&quot;;</span>
</span><span id="__span-568-6"><a id="__codelineno-568-6" name="__codelineno-568-6" href="#__codelineno-568-6"></a>
</span><span id="__span-568-7"><a id="__codelineno-568-7" name="__codelineno-568-7" href="#__codelineno-568-7"></a><span class="c1">// If you omit the length, you get the remainder of the string:</span>
</span><span id="__span-568-8"><a id="__codelineno-568-8" name="__codelineno-568-8" href="#__codelineno-568-8"></a><span class="kt">string</span><span class="w"> </span><span class="n">end3</span><span class="w">  </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;12345&quot;</span><span class="p">.</span><span class="n">Substring</span><span class="w"> </span><span class="p">(</span><span class="mi">2</span><span class="p">);</span><span class="w">        </span><span class="c1">// end3 = &quot;345&quot;;</span>
</span><span id="__span-568-9"><a id="__codelineno-568-9" name="__codelineno-568-9" href="#__codelineno-568-9"></a>
</span><span id="__span-568-10"><a id="__codelineno-568-10" name="__codelineno-568-10" href="#__codelineno-568-10"></a><span class="c1">// Insert and Remove insert or remove characters at a specified position:</span>
</span><span id="__span-568-11"><a id="__codelineno-568-11" name="__codelineno-568-11" href="#__codelineno-568-11"></a><span class="kt">string</span><span class="w"> </span><span class="n">s1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;helloworld&quot;</span><span class="p">.</span><span class="n">Insert</span><span class="w"> </span><span class="p">(</span><span class="mi">5</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;, &quot;</span><span class="p">);</span><span class="w">    </span><span class="c1">// s1 = &quot;hello, world&quot;</span>
</span><span id="__span-568-12"><a id="__codelineno-568-12" name="__codelineno-568-12" href="#__codelineno-568-12"></a><span class="kt">string</span><span class="w"> </span><span class="n">s2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">s1</span><span class="p">.</span><span class="n">Remove</span><span class="w"> </span><span class="p">(</span><span class="mi">5</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">);</span><span class="w">                 </span><span class="c1">// s2 = &quot;helloworld&quot;;</span>
</span><span id="__span-568-13"><a id="__codelineno-568-13" name="__codelineno-568-13" href="#__codelineno-568-13"></a>
</span><span id="__span-568-14"><a id="__codelineno-568-14" name="__codelineno-568-14" href="#__codelineno-568-14"></a><span class="c1">// PadLeft and PadRight pad a string to a given length with a specified character (or a space if unspecified):</span>
</span><span id="__span-568-15"><a id="__codelineno-568-15" name="__codelineno-568-15" href="#__codelineno-568-15"></a><span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="w"> </span><span class="p">(</span><span class="s">&quot;12345&quot;</span><span class="p">.</span><span class="n">PadLeft</span><span class="w"> </span><span class="p">(</span><span class="mi">9</span><span class="p">,</span><span class="w"> </span><span class="sc">&#39;*&#39;</span><span class="p">));</span><span class="w">  </span><span class="c1">// ****12345</span>
</span><span id="__span-568-16"><a id="__codelineno-568-16" name="__codelineno-568-16" href="#__codelineno-568-16"></a><span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="w"> </span><span class="p">(</span><span class="s">&quot;12345&quot;</span><span class="p">.</span><span class="n">PadLeft</span><span class="w"> </span><span class="p">(</span><span class="mi">9</span><span class="p">));</span><span class="w">       </span><span class="c1">//     12345</span>
</span><span id="__span-568-17"><a id="__codelineno-568-17" name="__codelineno-568-17" href="#__codelineno-568-17"></a>
</span><span id="__span-568-18"><a id="__codelineno-568-18" name="__codelineno-568-18" href="#__codelineno-568-18"></a><span class="c1">// TrimStart, TrimEnd and Trim remove specified characters (whitespace, by default) from the string:</span>
</span><span id="__span-568-19"><a id="__codelineno-568-19" name="__codelineno-568-19" href="#__codelineno-568-19"></a><span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="w"> </span><span class="p">(</span><span class="s">&quot;  abc \t\r\n &quot;</span><span class="p">.</span><span class="n">Trim</span><span class="p">().</span><span class="n">Length</span><span class="p">);</span><span class="w">   </span><span class="c1">// 3</span>
</span><span id="__span-568-20"><a id="__codelineno-568-20" name="__codelineno-568-20" href="#__codelineno-568-20"></a>
</span><span id="__span-568-21"><a id="__codelineno-568-21" name="__codelineno-568-21" href="#__codelineno-568-21"></a><span class="c1">// Replace replaces all occurrences of a particular character or substring:</span>
</span><span id="__span-568-22"><a id="__codelineno-568-22" name="__codelineno-568-22" href="#__codelineno-568-22"></a><span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="w"> </span><span class="p">(</span><span class="s">&quot;to be done&quot;</span><span class="p">.</span><span class="n">Replace</span><span class="w"> </span><span class="p">(</span><span class="s">&quot; &quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot; | &quot;</span><span class="p">)</span><span class="w"> </span><span class="p">);</span><span class="w">  </span><span class="c1">// to | be | done</span>
</span><span id="__span-568-23"><a id="__codelineno-568-23" name="__codelineno-568-23" href="#__codelineno-568-23"></a><span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="w"> </span><span class="p">(</span><span class="s">&quot;to be done&quot;</span><span class="p">.</span><span class="n">Replace</span><span class="w"> </span><span class="p">(</span><span class="s">&quot; &quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;&quot;</span><span class="p">)</span><span class="w">    </span><span class="p">);</span><span class="w">  </span><span class="c1">// tobedone</span>
</span></code></pre></div>
<h3 id="splitting-and-joining-strings">Splitting and joining strings</h3>
<div class="language-csharp highlight"><pre><span></span><code><span id="__span-569-1"><a id="__codelineno-569-1" name="__codelineno-569-1" href="#__codelineno-569-1"></a><span class="c1">// Split takes a sentence and returns an array of words (default delimiters = whitespace):</span>
</span><span id="__span-569-2"><a id="__codelineno-569-2" name="__codelineno-569-2" href="#__codelineno-569-2"></a><span class="kt">string</span><span class="p">[]</span><span class="w"> </span><span class="n">words</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;The quick brown fox&quot;</span><span class="p">.</span><span class="n">Split</span><span class="p">();</span>
</span><span id="__span-569-3"><a id="__codelineno-569-3" name="__codelineno-569-3" href="#__codelineno-569-3"></a><span class="k">foreach</span><span class="w"> </span><span class="p">(</span><span class="kt">string</span><span class="w"> </span><span class="n">word</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">words</span><span class="p">)</span>
</span><span id="__span-569-4"><a id="__codelineno-569-4" name="__codelineno-569-4" href="#__codelineno-569-4"></a><span class="w"> </span><span class="n">Console</span><span class="p">.</span><span class="n">Write</span><span class="w"> </span><span class="p">(</span><span class="n">word</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s">&quot;|&quot;</span><span class="p">);</span><span class="w"> </span><span class="c1">// The|quick|brown|fox|</span>
</span><span id="__span-569-5"><a id="__codelineno-569-5" name="__codelineno-569-5" href="#__codelineno-569-5"></a>
</span><span id="__span-569-6"><a id="__codelineno-569-6" name="__codelineno-569-6" href="#__codelineno-569-6"></a><span class="c1">//The static Join method does the reverse of Split</span>
</span><span id="__span-569-7"><a id="__codelineno-569-7" name="__codelineno-569-7" href="#__codelineno-569-7"></a><span class="kt">string</span><span class="p">[]</span><span class="w"> </span><span class="n">words</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;The quick brown fox&quot;</span><span class="p">.</span><span class="n">Split</span><span class="p">();</span>
</span><span id="__span-569-8"><a id="__codelineno-569-8" name="__codelineno-569-8" href="#__codelineno-569-8"></a><span class="kt">string</span><span class="w"> </span><span class="n">together</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kt">string</span><span class="p">.</span><span class="n">Join</span><span class="w"> </span><span class="p">(</span><span class="s">&quot; &quot;</span><span class="p">,</span><span class="w"> </span><span class="n">words</span><span class="p">);</span><span class="w"> </span><span class="c1">// The quick brown fox</span>
</span><span id="__span-569-9"><a id="__codelineno-569-9" name="__codelineno-569-9" href="#__codelineno-569-9"></a>
</span><span id="__span-569-10"><a id="__codelineno-569-10" name="__codelineno-569-10" href="#__codelineno-569-10"></a><span class="c1">//The static Concat method is similar to Join but accepts only a params string array</span>
</span><span id="__span-569-11"><a id="__codelineno-569-11" name="__codelineno-569-11" href="#__codelineno-569-11"></a><span class="c1">//and applies no separator. Concat is exactly equivalent to the + operator (the comâ€</span>
</span><span id="__span-569-12"><a id="__codelineno-569-12" name="__codelineno-569-12" href="#__codelineno-569-12"></a><span class="c1">//piler, in fact, translates + to Concat)</span>
</span><span id="__span-569-13"><a id="__codelineno-569-13" name="__codelineno-569-13" href="#__codelineno-569-13"></a><span class="kt">string</span><span class="w"> </span><span class="n">sentence</span><span class="w">     </span><span class="o">=</span><span class="w"> </span><span class="kt">string</span><span class="p">.</span><span class="n">Concat</span><span class="w"> </span><span class="p">(</span><span class="s">&quot;The&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot; quick&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot; brown&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot; fox&quot;</span><span class="p">);</span>
</span><span id="__span-569-14"><a id="__codelineno-569-14" name="__codelineno-569-14" href="#__codelineno-569-14"></a><span class="kt">string</span><span class="w"> </span><span class="n">sameSentence</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;The&quot;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s">&quot; quick&quot;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s">&quot; brown&quot;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s">&quot; fox&quot;</span><span class="p">;</span>
</span></code></pre></div>
<h3 id="stringformat-and-composite-format-strings">string.Format and composite format strings</h3>
<p>The static Format method provides a convenient way to build strings that embed variables. The embedded variables (or values) can be of any type; the Format simply calls ToString on them.</p>
<p>Each number in curly braces is called a format item. The number corresponds to the
argument position and is optionally followed by</p>
<ul>
<li>A comma and a minimum width to apply</li>
<li>A colon and a format string</li>
</ul>
<div class="language-csharp highlight"><pre><span></span><code><span id="__span-570-1"><a id="__codelineno-570-1" name="__codelineno-570-1" href="#__codelineno-570-1"></a><span class="c1">// When calling String.Format, provide a composite format string followed by each of the embedded variables</span>
</span><span id="__span-570-2"><a id="__codelineno-570-2" name="__codelineno-570-2" href="#__codelineno-570-2"></a><span class="kt">string</span><span class="w"> </span><span class="n">composite</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;It&#39;s {0} degrees in {1} on this {2} morning&quot;</span><span class="p">;</span>
</span><span id="__span-570-3"><a id="__codelineno-570-3" name="__codelineno-570-3" href="#__codelineno-570-3"></a><span class="kt">string</span><span class="w"> </span><span class="n">s</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kt">string</span><span class="p">.</span><span class="n">Format</span><span class="w"> </span><span class="p">(</span><span class="n">composite</span><span class="p">,</span><span class="w"> </span><span class="mi">35</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Perth&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">DateTime</span><span class="p">.</span><span class="n">Now</span><span class="p">.</span><span class="n">DayOfWeek</span><span class="p">);</span>
</span><span id="__span-570-4"><a id="__codelineno-570-4" name="__codelineno-570-4" href="#__codelineno-570-4"></a><span class="c1">// s == &quot;It&#39;s 35 degrees in Perth on this Friday morning&quot;</span>
</span><span id="__span-570-5"><a id="__codelineno-570-5" name="__codelineno-570-5" href="#__codelineno-570-5"></a>
</span><span id="__span-570-6"><a id="__codelineno-570-6" name="__codelineno-570-6" href="#__codelineno-570-6"></a><span class="c1">//We can use interpolated string literals to the same effect</span>
</span><span id="__span-570-7"><a id="__codelineno-570-7" name="__codelineno-570-7" href="#__codelineno-570-7"></a><span class="kt">string</span><span class="w"> </span><span class="n">s</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">$&quot;It&#39;s hot this {DateTime.Now.DayOfWeek} morning&quot;</span><span class="p">;</span>
</span><span id="__span-570-8"><a id="__codelineno-570-8" name="__codelineno-570-8" href="#__codelineno-570-8"></a>
</span><span id="__span-570-9"><a id="__codelineno-570-9" name="__codelineno-570-9" href="#__codelineno-570-9"></a><span class="c1">// The minimum width in a format string is useful for aligning columns.</span>
</span><span id="__span-570-10"><a id="__codelineno-570-10" name="__codelineno-570-10" href="#__codelineno-570-10"></a><span class="c1">// If the value is negative, the data is left-aligned; otherwise, itâ€™s right-aligned:</span>
</span><span id="__span-570-11"><a id="__codelineno-570-11" name="__codelineno-570-11" href="#__codelineno-570-11"></a><span class="n">composite</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;Name={0,-20} Credit Limit={1,15:C}&quot;</span><span class="p">;</span>
</span><span id="__span-570-12"><a id="__codelineno-570-12" name="__codelineno-570-12" href="#__codelineno-570-12"></a><span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="w"> </span><span class="p">(</span><span class="kt">string</span><span class="p">.</span><span class="n">Format</span><span class="w"> </span><span class="p">(</span><span class="n">composite</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Mary&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">500</span><span class="p">));</span>
</span><span id="__span-570-13"><a id="__codelineno-570-13" name="__codelineno-570-13" href="#__codelineno-570-13"></a><span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="w"> </span><span class="p">(</span><span class="kt">string</span><span class="p">.</span><span class="n">Format</span><span class="w"> </span><span class="p">(</span><span class="n">composite</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Elizabeth&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">20000</span><span class="p">));</span>
</span><span id="__span-570-14"><a id="__codelineno-570-14" name="__codelineno-570-14" href="#__codelineno-570-14"></a>
</span><span id="__span-570-15"><a id="__codelineno-570-15" name="__codelineno-570-15" href="#__codelineno-570-15"></a><span class="c1">//Name=Mary Credit Limit= $500.00</span>
</span><span id="__span-570-16"><a id="__codelineno-570-16" name="__codelineno-570-16" href="#__codelineno-570-16"></a><span class="c1">//Name=Elizabeth Credit Limit= $20,000.00</span>
</span><span id="__span-570-17"><a id="__codelineno-570-17" name="__codelineno-570-17" href="#__codelineno-570-17"></a>
</span><span id="__span-570-18"><a id="__codelineno-570-18" name="__codelineno-570-18" href="#__codelineno-570-18"></a><span class="c1">// The equivalent without using string.Format:</span>
</span><span id="__span-570-19"><a id="__codelineno-570-19" name="__codelineno-570-19" href="#__codelineno-570-19"></a><span class="n">s</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;Name=&quot;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s">&quot;Mary&quot;</span><span class="p">.</span><span class="n">PadRight</span><span class="w"> </span><span class="p">(</span><span class="mi">20</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s">&quot; Credit Limit=&quot;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">500</span><span class="p">.</span><span class="n">ToString</span><span class="w"> </span><span class="p">(</span><span class="s">&quot;C&quot;</span><span class="p">).</span><span class="n">PadLeft</span><span class="w"> </span><span class="p">(</span><span class="mi">15</span><span class="p">);</span>
</span></code></pre></div>
<h3 id="comparing-strings">Comparing Strings</h3>
<p>In comparing two values, .NET Core differentiates the concepts of equality compariâ€
son and order comparison. Equality comparison tests whether two instances are
semantically the same; order comparison tests which of two (if any) instances comes
first when arranging them in ascending or descending sequence.</p>
<p>For string equality comparison, you can use the == operator or one of stringâ€™s
Equals methods. The latter are more versatile because they allow you to specify
options such as case insensitivity.</p>
<p>Another difference is that == does not work reliably on strings if the variables are cast to the object type. </p>
<div class="language-csharp highlight"><pre><span></span><code><span id="__span-571-1"><a id="__codelineno-571-1" name="__codelineno-571-1" href="#__codelineno-571-1"></a><span class="c1">// String comparisons can be ordinal vs culture-sensitive; case-sensitive vs case-insensitive.</span>
</span><span id="__span-571-2"><a id="__codelineno-571-2" name="__codelineno-571-2" href="#__codelineno-571-2"></a>
</span><span id="__span-571-3"><a id="__codelineno-571-3" name="__codelineno-571-3" href="#__codelineno-571-3"></a><span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="w"> </span><span class="p">(</span><span class="kt">string</span><span class="p">.</span><span class="n">Equals</span><span class="w"> </span><span class="p">(</span><span class="s">&quot;foo&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;FOO&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">StringComparison</span><span class="p">.</span><span class="n">OrdinalIgnoreCase</span><span class="p">));</span><span class="w">   </span><span class="c1">// True</span>
</span><span id="__span-571-4"><a id="__codelineno-571-4" name="__codelineno-571-4" href="#__codelineno-571-4"></a>
</span><span id="__span-571-5"><a id="__codelineno-571-5" name="__codelineno-571-5" href="#__codelineno-571-5"></a><span class="c1">// (The following symbols may not be displayed correctly, depending on your font):</span>
</span><span id="__span-571-6"><a id="__codelineno-571-6" name="__codelineno-571-6" href="#__codelineno-571-6"></a><span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="w"> </span><span class="p">(</span><span class="s">&quot;á¹»&quot;</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s">&quot;Ç–&quot;</span><span class="p">);</span><span class="w">   </span><span class="c1">// False</span>
</span><span id="__span-571-7"><a id="__codelineno-571-7" name="__codelineno-571-7" href="#__codelineno-571-7"></a>
</span><span id="__span-571-8"><a id="__codelineno-571-8" name="__codelineno-571-8" href="#__codelineno-571-8"></a><span class="c1">// The order comparison methods return a positive number, a negative number, or zero, depending</span>
</span><span id="__span-571-9"><a id="__codelineno-571-9" name="__codelineno-571-9" href="#__codelineno-571-9"></a><span class="c1">// on whether the first value comes after, before, or alongside the second value:</span>
</span><span id="__span-571-10"><a id="__codelineno-571-10" name="__codelineno-571-10" href="#__codelineno-571-10"></a><span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="w"> </span><span class="p">(</span><span class="s">&quot;Boston&quot;</span><span class="p">.</span><span class="n">CompareTo</span><span class="w"> </span><span class="p">(</span><span class="s">&quot;Austin&quot;</span><span class="p">));</span><span class="w">    </span><span class="c1">// 1</span>
</span><span id="__span-571-11"><a id="__codelineno-571-11" name="__codelineno-571-11" href="#__codelineno-571-11"></a><span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="w"> </span><span class="p">(</span><span class="s">&quot;Boston&quot;</span><span class="p">.</span><span class="n">CompareTo</span><span class="w"> </span><span class="p">(</span><span class="s">&quot;Boston&quot;</span><span class="p">));</span><span class="w">    </span><span class="c1">// 0</span>
</span><span id="__span-571-12"><a id="__codelineno-571-12" name="__codelineno-571-12" href="#__codelineno-571-12"></a><span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="w"> </span><span class="p">(</span><span class="s">&quot;Boston&quot;</span><span class="p">.</span><span class="n">CompareTo</span><span class="w"> </span><span class="p">(</span><span class="s">&quot;Chicago&quot;</span><span class="p">));</span><span class="w">   </span><span class="c1">// -1</span>
</span><span id="__span-571-13"><a id="__codelineno-571-13" name="__codelineno-571-13" href="#__codelineno-571-13"></a><span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="w"> </span><span class="p">(</span><span class="s">&quot;á¹»&quot;</span><span class="p">.</span><span class="n">CompareTo</span><span class="w"> </span><span class="p">(</span><span class="s">&quot;Ç–&quot;</span><span class="p">));</span><span class="w">              </span><span class="c1">// 0</span>
</span><span id="__span-571-14"><a id="__codelineno-571-14" name="__codelineno-571-14" href="#__codelineno-571-14"></a><span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="w"> </span><span class="p">(</span><span class="s">&quot;foo&quot;</span><span class="p">.</span><span class="n">CompareTo</span><span class="w"> </span><span class="p">(</span><span class="s">&quot;FOO&quot;</span><span class="p">));</span><span class="w">          </span><span class="c1">// -1</span>
</span></code></pre></div>
<h3 id="stringbuilder">StringBuilder</h3>
<p>The StringBuilder class (System.Text namespace) represents a mutable (editable) string. With a StringBuilder, you can Append, Insert, Remove, and Replace substrings without replacing the whole StringBuilder.</p>
<p>StringBuilderâ€™s constructor optionally accepts an initial string value as well as a starting size for its internal capacity (default is 16 characters). If you go beyond this, StringBuilder automatically resizes its internal structures to accommodate (at a slight performance cost) up to its maximum capacity (default is int.MaxValue).</p>
<p>A popular use of StringBuilder is to build up a long string by repeatedly calling Append. This approach is much more efficient than repeatedly concatenating ordinary string types</p>
<div class="language-csharp highlight"><pre><span></span><code><span id="__span-572-1"><a id="__codelineno-572-1" name="__codelineno-572-1" href="#__codelineno-572-1"></a><span class="c1">// Unlike string, StringBuilder is mutable.</span>
</span><span id="__span-572-2"><a id="__codelineno-572-2" name="__codelineno-572-2" href="#__codelineno-572-2"></a>
</span><span id="__span-572-3"><a id="__codelineno-572-3" name="__codelineno-572-3" href="#__codelineno-572-3"></a><span class="c1">// The following is more efficient than repeatedly concatenating ordinary string types:</span>
</span><span id="__span-572-4"><a id="__codelineno-572-4" name="__codelineno-572-4" href="#__codelineno-572-4"></a>
</span><span id="__span-572-5"><a id="__codelineno-572-5" name="__codelineno-572-5" href="#__codelineno-572-5"></a><span class="n">StringBuilder</span><span class="w"> </span><span class="n">sb</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">StringBuilder</span><span class="p">();</span>
</span><span id="__span-572-6"><a id="__codelineno-572-6" name="__codelineno-572-6" href="#__codelineno-572-6"></a>
</span><span id="__span-572-7"><a id="__codelineno-572-7" name="__codelineno-572-7" href="#__codelineno-572-7"></a><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mi">50</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="o">++</span><span class="p">)</span><span class="w"> </span><span class="n">sb</span><span class="p">.</span><span class="n">Append</span><span class="w"> </span><span class="p">(</span><span class="n">i</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s">&quot;,&quot;</span><span class="p">);</span>
</span><span id="__span-572-8"><a id="__codelineno-572-8" name="__codelineno-572-8" href="#__codelineno-572-8"></a>
</span><span id="__span-572-9"><a id="__codelineno-572-9" name="__codelineno-572-9" href="#__codelineno-572-9"></a><span class="c1">// To get the final result, call ToString():</span>
</span><span id="__span-572-10"><a id="__codelineno-572-10" name="__codelineno-572-10" href="#__codelineno-572-10"></a><span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="w"> </span><span class="p">(</span><span class="n">sb</span><span class="p">.</span><span class="n">ToString</span><span class="p">());</span>
</span><span id="__span-572-11"><a id="__codelineno-572-11" name="__codelineno-572-11" href="#__codelineno-572-11"></a><span class="c1">//0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,</span>
</span><span id="__span-572-12"><a id="__codelineno-572-12" name="__codelineno-572-12" href="#__codelineno-572-12"></a><span class="c1">//27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,</span>
</span><span id="__span-572-13"><a id="__codelineno-572-13" name="__codelineno-572-13" href="#__codelineno-572-13"></a>
</span><span id="__span-572-14"><a id="__codelineno-572-14" name="__codelineno-572-14" href="#__codelineno-572-14"></a><span class="n">sb</span><span class="p">.</span><span class="n">Remove</span><span class="w"> </span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">60</span><span class="p">);</span><span class="w">      </span><span class="c1">// Remove first 50 characters</span>
</span><span id="__span-572-15"><a id="__codelineno-572-15" name="__codelineno-572-15" href="#__codelineno-572-15"></a><span class="n">sb</span><span class="p">.</span><span class="n">Length</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">10</span><span class="p">;</span><span class="w">         </span><span class="c1">// Truncate to 10 characters</span>
</span><span id="__span-572-16"><a id="__codelineno-572-16" name="__codelineno-572-16" href="#__codelineno-572-16"></a><span class="n">sb</span><span class="p">.</span><span class="n">Replace</span><span class="w"> </span><span class="p">(</span><span class="s">&quot;,&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;+&quot;</span><span class="p">);</span><span class="w">  </span><span class="c1">// Replace comma with +</span>
</span><span id="__span-572-17"><a id="__codelineno-572-17" name="__codelineno-572-17" href="#__codelineno-572-17"></a><span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="w"> </span><span class="p">(</span><span class="n">sb</span><span class="p">.</span><span class="n">ToString</span><span class="p">());</span>
</span><span id="__span-572-18"><a id="__codelineno-572-18" name="__codelineno-572-18" href="#__codelineno-572-18"></a>
</span><span id="__span-572-19"><a id="__codelineno-572-19" name="__codelineno-572-19" href="#__codelineno-572-19"></a><span class="n">sb</span><span class="p">.</span><span class="n">Length</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
</span></code></pre></div>
<p>AppendLine performs an Append that adds a newline sequence ("\r\n" in Windows). AppendFormat accepts a composite format string, just like string.Format.</p>
<aside>
ðŸ“¢ Setting a StringBuilderâ€™s Length to zero doesnâ€™t shrink its internal capacity. So, if the StringBuilder previously contained one million characters, it will continue to occupy
around two megabytes of memory after zeroing its Length. If you want to release the memory, you must create a new StringBuilder and allow the old one to drop out of scope
(and be garbage-collected).

</aside>

<h1 id="dates-and-times">Dates and Times</h1>
<p>Three immutable structs in the System namespace do the job of representing dates
and times: DateTime, DateTimeOffset, and TimeSpan.</p>
<h3 id="timespan">TimeSpan</h3>
<p>A TimeSpan represents an interval of timeâ€”or a time of the day. In the latter role, itâ€™s simply the â€œclockâ€ time (without the date), which is equivalent to the time since midnight, assuming no daylight saving transition. A TimeSpan has a resolution of 100 ns, has a maximum value of about 10 million days, and can be positive or negative.</p>
<div class="language-csharp highlight"><pre><span></span><code><span id="__span-573-1"><a id="__codelineno-573-1" name="__codelineno-573-1" href="#__codelineno-573-1"></a><span class="c1">// There are three ways to construct a TimeSpan:</span>
</span><span id="__span-573-2"><a id="__codelineno-573-2" name="__codelineno-573-2" href="#__codelineno-573-2"></a><span class="c1">//  â€¢ Through one of the constructors</span>
</span><span id="__span-573-3"><a id="__codelineno-573-3" name="__codelineno-573-3" href="#__codelineno-573-3"></a><span class="c1">//  â€¢ By calling one of the static From . . . methods</span>
</span><span id="__span-573-4"><a id="__codelineno-573-4" name="__codelineno-573-4" href="#__codelineno-573-4"></a><span class="c1">//  â€¢ By subtracting one DateTime from another</span>
</span><span id="__span-573-5"><a id="__codelineno-573-5" name="__codelineno-573-5" href="#__codelineno-573-5"></a>
</span><span id="__span-573-6"><a id="__codelineno-573-6" name="__codelineno-573-6" href="#__codelineno-573-6"></a><span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="w"> </span><span class="p">(</span><span class="k">new</span><span class="w"> </span><span class="n">TimeSpan</span><span class="w"> </span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="mi">30</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">));</span><span class="w">     </span><span class="c1">// 02:30:00</span>
</span><span id="__span-573-7"><a id="__codelineno-573-7" name="__codelineno-573-7" href="#__codelineno-573-7"></a><span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="w"> </span><span class="p">(</span><span class="n">TimeSpan</span><span class="p">.</span><span class="n">FromHours</span><span class="w"> </span><span class="p">(</span><span class="mf">2.5</span><span class="p">));</span><span class="w">    </span><span class="c1">// 02:30:00</span>
</span><span id="__span-573-8"><a id="__codelineno-573-8" name="__codelineno-573-8" href="#__codelineno-573-8"></a><span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="w"> </span><span class="p">(</span><span class="n">TimeSpan</span><span class="p">.</span><span class="n">FromHours</span><span class="w"> </span><span class="p">(</span><span class="o">-</span><span class="mf">2.5</span><span class="p">));</span><span class="w">   </span><span class="c1">// -02:30:00</span>
</span><span id="__span-573-9"><a id="__codelineno-573-9" name="__codelineno-573-9" href="#__codelineno-573-9"></a><span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="w"> </span><span class="p">(</span><span class="n">DateTime</span><span class="p">.</span><span class="n">MaxValue</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">DateTime</span><span class="p">.</span><span class="n">MinValue</span><span class="p">);</span>
</span><span id="__span-573-10"><a id="__codelineno-573-10" name="__codelineno-573-10" href="#__codelineno-573-10"></a>
</span><span id="__span-573-11"><a id="__codelineno-573-11" name="__codelineno-573-11" href="#__codelineno-573-11"></a><span class="c1">// TimeSpan overloads the &lt; and &gt; operators, as well as the + and - operators:</span>
</span><span id="__span-573-12"><a id="__codelineno-573-12" name="__codelineno-573-12" href="#__codelineno-573-12"></a>
</span><span id="__span-573-13"><a id="__codelineno-573-13" name="__codelineno-573-13" href="#__codelineno-573-13"></a><span class="p">(</span><span class="n">TimeSpan</span><span class="p">.</span><span class="n">FromHours</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">TimeSpan</span><span class="p">.</span><span class="n">FromMinutes</span><span class="p">(</span><span class="mi">30</span><span class="p">)).</span><span class="n">Dump</span><span class="w"> </span><span class="p">(</span><span class="s">&quot;2.5 hours&quot;</span><span class="p">);</span>
</span><span id="__span-573-14"><a id="__codelineno-573-14" name="__codelineno-573-14" href="#__codelineno-573-14"></a><span class="p">(</span><span class="n">TimeSpan</span><span class="p">.</span><span class="n">FromDays</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">TimeSpan</span><span class="p">.</span><span class="n">FromSeconds</span><span class="p">(</span><span class="mi">1</span><span class="p">)).</span><span class="n">Dump</span><span class="w"> </span><span class="p">(</span><span class="s">&quot;One second short of 10 days&quot;</span><span class="p">);</span>
</span></code></pre></div>
<div class="language-csharp highlight"><pre><span></span><code><span id="__span-574-1"><a id="__codelineno-574-1" name="__codelineno-574-1" href="#__codelineno-574-1"></a><span class="c1">//constructors for Time Span</span>
</span><span id="__span-574-2"><a id="__codelineno-574-2" name="__codelineno-574-2" href="#__codelineno-574-2"></a><span class="k">public</span><span class="w"> </span><span class="nf">TimeSpan</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">hours</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">minutes</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">seconds</span><span class="p">);</span>
</span><span id="__span-574-3"><a id="__codelineno-574-3" name="__codelineno-574-3" href="#__codelineno-574-3"></a><span class="k">public</span><span class="w"> </span><span class="nf">TimeSpan</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">days</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">hours</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">minutes</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">seconds</span><span class="p">);</span>
</span><span id="__span-574-4"><a id="__codelineno-574-4" name="__codelineno-574-4" href="#__codelineno-574-4"></a><span class="k">public</span><span class="w"> </span><span class="nf">TimeSpan</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">days</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">hours</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">minutes</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">seconds</span><span class="p">,</span>
</span><span id="__span-574-5"><a id="__codelineno-574-5" name="__codelineno-574-5" href="#__codelineno-574-5"></a><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">milliseconds</span><span class="p">);</span>
</span><span id="__span-574-6"><a id="__codelineno-574-6" name="__codelineno-574-6" href="#__codelineno-574-6"></a><span class="k">public</span><span class="w"> </span><span class="nf">TimeSpan</span><span class="w"> </span><span class="p">(</span><span class="kt">long</span><span class="w"> </span><span class="n">ticks</span><span class="p">);</span><span class="w"> </span><span class="c1">// Each tick = 100ns</span>
</span><span id="__span-574-7"><a id="__codelineno-574-7" name="__codelineno-574-7" href="#__codelineno-574-7"></a>
</span><span id="__span-574-8"><a id="__codelineno-574-8" name="__codelineno-574-8" href="#__codelineno-574-8"></a><span class="c1">//Methods</span>
</span><span id="__span-574-9"><a id="__codelineno-574-9" name="__codelineno-574-9" href="#__codelineno-574-9"></a><span class="k">public</span><span class="w"> </span><span class="k">static</span><span class="w"> </span><span class="n">TimeSpan</span><span class="w"> </span><span class="nf">FromDays</span><span class="w"> </span><span class="p">(</span><span class="kt">double</span><span class="w"> </span><span class="k">value</span><span class="p">);</span>
</span><span id="__span-574-10"><a id="__codelineno-574-10" name="__codelineno-574-10" href="#__codelineno-574-10"></a><span class="k">public</span><span class="w"> </span><span class="k">static</span><span class="w"> </span><span class="n">TimeSpan</span><span class="w"> </span><span class="nf">FromHours</span><span class="w"> </span><span class="p">(</span><span class="kt">double</span><span class="w"> </span><span class="k">value</span><span class="p">);</span>
</span><span id="__span-574-11"><a id="__codelineno-574-11" name="__codelineno-574-11" href="#__codelineno-574-11"></a><span class="k">public</span><span class="w"> </span><span class="k">static</span><span class="w"> </span><span class="n">TimeSpan</span><span class="w"> </span><span class="nf">FromMinutes</span><span class="w"> </span><span class="p">(</span><span class="kt">double</span><span class="w"> </span><span class="k">value</span><span class="p">);</span>
</span><span id="__span-574-12"><a id="__codelineno-574-12" name="__codelineno-574-12" href="#__codelineno-574-12"></a><span class="k">public</span><span class="w"> </span><span class="k">static</span><span class="w"> </span><span class="n">TimeSpan</span><span class="w"> </span><span class="nf">FromSeconds</span><span class="w"> </span><span class="p">(</span><span class="kt">double</span><span class="w"> </span><span class="k">value</span><span class="p">);</span>
</span><span id="__span-574-13"><a id="__codelineno-574-13" name="__codelineno-574-13" href="#__codelineno-574-13"></a><span class="k">public</span><span class="w"> </span><span class="k">static</span><span class="w"> </span><span class="n">TimeSpan</span><span class="w"> </span><span class="nf">FromMilliseconds</span><span class="w"> </span><span class="p">(</span><span class="kt">double</span><span class="w"> </span><span class="k">value</span><span class="p">);</span>
</span></code></pre></div>
<h3 id="constructing-a-datetime">Constructing a DateTime</h3>
<p>DateTime defines constructors that accept integers for the year, month, and dayâ€”
and optionally, the hour, minute, second, and millisecond</p>
<div class="language-csharp highlight"><pre><span></span><code><span id="__span-575-1"><a id="__codelineno-575-1" name="__codelineno-575-1" href="#__codelineno-575-1"></a><span class="k">public</span><span class="w"> </span><span class="nf">DateTime</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">year</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">month</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">day</span><span class="p">);</span>
</span><span id="__span-575-2"><a id="__codelineno-575-2" name="__codelineno-575-2" href="#__codelineno-575-2"></a><span class="k">public</span><span class="w"> </span><span class="nf">DateTime</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">year</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">month</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">day</span><span class="p">,</span>
</span><span id="__span-575-3"><a id="__codelineno-575-3" name="__codelineno-575-3" href="#__codelineno-575-3"></a><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">hour</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">minute</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">second</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">millisecond</span><span class="p">);</span>
</span></code></pre></div>
<h3 id="the-current-datetimedatetimeoset">The current DateTime/DateTimeOÂ†set</h3>
<div class="language-csharp highlight"><pre><span></span><code><span id="__span-576-1"><a id="__codelineno-576-1" name="__codelineno-576-1" href="#__codelineno-576-1"></a><span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="w"> </span><span class="p">(</span><span class="n">DateTime</span><span class="p">.</span><span class="n">Now</span><span class="p">);</span>
</span><span id="__span-576-2"><a id="__codelineno-576-2" name="__codelineno-576-2" href="#__codelineno-576-2"></a><span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="w"> </span><span class="p">(</span><span class="n">DateTimeOffset</span><span class="p">.</span><span class="n">Now</span><span class="p">);</span>
</span><span id="__span-576-3"><a id="__codelineno-576-3" name="__codelineno-576-3" href="#__codelineno-576-3"></a>
</span><span id="__span-576-4"><a id="__codelineno-576-4" name="__codelineno-576-4" href="#__codelineno-576-4"></a><span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="w"> </span><span class="p">(</span><span class="n">DateTime</span><span class="p">.</span><span class="n">Today</span><span class="p">);</span><span class="w">     </span><span class="c1">// No time portion</span>
</span><span id="__span-576-5"><a id="__codelineno-576-5" name="__codelineno-576-5" href="#__codelineno-576-5"></a>
</span><span id="__span-576-6"><a id="__codelineno-576-6" name="__codelineno-576-6" href="#__codelineno-576-6"></a><span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="w"> </span><span class="p">(</span><span class="n">DateTime</span><span class="p">.</span><span class="n">UtcNow</span><span class="p">);</span>
</span><span id="__span-576-7"><a id="__codelineno-576-7" name="__codelineno-576-7" href="#__codelineno-576-7"></a><span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="w"> </span><span class="p">(</span><span class="n">DateTimeOffset</span><span class="p">.</span><span class="n">UtcNow</span><span class="p">);</span>
</span><span id="__span-576-8"><a id="__codelineno-576-8" name="__codelineno-576-8" href="#__codelineno-576-8"></a>
</span><span id="__span-576-9"><a id="__codelineno-576-9" name="__codelineno-576-9" href="#__codelineno-576-9"></a><span class="cm">/*</span>
</span><span id="__span-576-10"><a id="__codelineno-576-10" name="__codelineno-576-10" href="#__codelineno-576-10"></a><span class="cm">18-6-20 01:45:55 PM</span>
</span><span id="__span-576-11"><a id="__codelineno-576-11" name="__codelineno-576-11" href="#__codelineno-576-11"></a><span class="cm">18-6-20 01:45:55 PM +05:30</span>
</span><span id="__span-576-12"><a id="__codelineno-576-12" name="__codelineno-576-12" href="#__codelineno-576-12"></a><span class="cm">18-6-20 12:00:00 AM</span>
</span><span id="__span-576-13"><a id="__codelineno-576-13" name="__codelineno-576-13" href="#__codelineno-576-13"></a><span class="cm">18-6-20 08:15:55 AM</span>
</span><span id="__span-576-14"><a id="__codelineno-576-14" name="__codelineno-576-14" href="#__codelineno-576-14"></a><span class="cm">18-6-20 08:15:55 AM +00:00</span>
</span><span id="__span-576-15"><a id="__codelineno-576-15" name="__codelineno-576-15" href="#__codelineno-576-15"></a><span class="cm">*/</span>
</span></code></pre></div>
<h3 id="working-with-dates-and-times">Working with dates and times</h3>
<div class="language-csharp highlight"><pre><span></span><code><span id="__span-577-1"><a id="__codelineno-577-1" name="__codelineno-577-1" href="#__codelineno-577-1"></a><span class="n">DateTime</span><span class="w"> </span><span class="n">dt</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">DateTime</span><span class="w"> </span><span class="p">(</span><span class="mi">2000</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="mi">3</span><span class="p">,</span>
</span><span id="__span-577-2"><a id="__codelineno-577-2" name="__codelineno-577-2" href="#__codelineno-577-2"></a><span class="w">                            </span><span class="mi">10</span><span class="p">,</span><span class="w"> </span><span class="mi">20</span><span class="p">,</span><span class="w"> </span><span class="mi">30</span><span class="p">);</span>
</span><span id="__span-577-3"><a id="__codelineno-577-3" name="__codelineno-577-3" href="#__codelineno-577-3"></a>
</span><span id="__span-577-4"><a id="__codelineno-577-4" name="__codelineno-577-4" href="#__codelineno-577-4"></a><span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="w"> </span><span class="p">(</span><span class="n">dt</span><span class="p">.</span><span class="n">Year</span><span class="p">);</span><span class="w">         </span><span class="c1">// 2000</span>
</span><span id="__span-577-5"><a id="__codelineno-577-5" name="__codelineno-577-5" href="#__codelineno-577-5"></a><span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="w"> </span><span class="p">(</span><span class="n">dt</span><span class="p">.</span><span class="n">Month</span><span class="p">);</span><span class="w">        </span><span class="c1">// 2</span>
</span><span id="__span-577-6"><a id="__codelineno-577-6" name="__codelineno-577-6" href="#__codelineno-577-6"></a><span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="w"> </span><span class="p">(</span><span class="n">dt</span><span class="p">.</span><span class="n">Day</span><span class="p">);</span><span class="w">          </span><span class="c1">// 3</span>
</span><span id="__span-577-7"><a id="__codelineno-577-7" name="__codelineno-577-7" href="#__codelineno-577-7"></a><span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="w"> </span><span class="p">(</span><span class="n">dt</span><span class="p">.</span><span class="n">DayOfWeek</span><span class="p">);</span><span class="w">    </span><span class="c1">// Thursday</span>
</span><span id="__span-577-8"><a id="__codelineno-577-8" name="__codelineno-577-8" href="#__codelineno-577-8"></a><span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="w"> </span><span class="p">(</span><span class="n">dt</span><span class="p">.</span><span class="n">DayOfYear</span><span class="p">);</span><span class="w">    </span><span class="c1">// 34</span>
</span><span id="__span-577-9"><a id="__codelineno-577-9" name="__codelineno-577-9" href="#__codelineno-577-9"></a>
</span><span id="__span-577-10"><a id="__codelineno-577-10" name="__codelineno-577-10" href="#__codelineno-577-10"></a><span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="w"> </span><span class="p">(</span><span class="n">dt</span><span class="p">.</span><span class="n">Hour</span><span class="p">);</span><span class="w">         </span><span class="c1">// 10</span>
</span><span id="__span-577-11"><a id="__codelineno-577-11" name="__codelineno-577-11" href="#__codelineno-577-11"></a><span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="w"> </span><span class="p">(</span><span class="n">dt</span><span class="p">.</span><span class="n">Minute</span><span class="p">);</span><span class="w">       </span><span class="c1">// 20</span>
</span><span id="__span-577-12"><a id="__codelineno-577-12" name="__codelineno-577-12" href="#__codelineno-577-12"></a><span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="w"> </span><span class="p">(</span><span class="n">dt</span><span class="p">.</span><span class="n">Second</span><span class="p">);</span><span class="w">       </span><span class="c1">// 30</span>
</span><span id="__span-577-13"><a id="__codelineno-577-13" name="__codelineno-577-13" href="#__codelineno-577-13"></a><span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="w"> </span><span class="p">(</span><span class="n">dt</span><span class="p">.</span><span class="n">Millisecond</span><span class="p">);</span><span class="w">  </span><span class="c1">// 0</span>
</span><span id="__span-577-14"><a id="__codelineno-577-14" name="__codelineno-577-14" href="#__codelineno-577-14"></a><span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="w"> </span><span class="p">(</span><span class="n">dt</span><span class="p">.</span><span class="n">Ticks</span><span class="p">);</span><span class="w">        </span><span class="c1">// 630851700300000000</span>
</span><span id="__span-577-15"><a id="__codelineno-577-15" name="__codelineno-577-15" href="#__codelineno-577-15"></a><span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="w"> </span><span class="p">(</span><span class="n">dt</span><span class="p">.</span><span class="n">TimeOfDay</span><span class="p">);</span><span class="w">    </span><span class="c1">// 10:20:30  (returns a TimeSpan)</span>
</span><span id="__span-577-16"><a id="__codelineno-577-16" name="__codelineno-577-16" href="#__codelineno-577-16"></a>
</span><span id="__span-577-17"><a id="__codelineno-577-17" name="__codelineno-577-17" href="#__codelineno-577-17"></a><span class="n">TimeSpan</span><span class="w"> </span><span class="n">ts</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">TimeSpan</span><span class="p">.</span><span class="n">FromMinutes</span><span class="w"> </span><span class="p">(</span><span class="mi">90</span><span class="p">);</span>
</span><span id="__span-577-18"><a id="__codelineno-577-18" name="__codelineno-577-18" href="#__codelineno-577-18"></a><span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="w"> </span><span class="p">(</span><span class="n">dt</span><span class="p">.</span><span class="n">Add</span><span class="w"> </span><span class="p">(</span><span class="n">ts</span><span class="p">));</span><span class="w">         </span><span class="c1">// 3/02/2000 11:50:30 AM</span>
</span><span id="__span-577-19"><a id="__codelineno-577-19" name="__codelineno-577-19" href="#__codelineno-577-19"></a><span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="w"> </span><span class="p">(</span><span class="n">dt</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">ts</span><span class="p">);</span><span class="w">             </span><span class="c1">// 3/02/2000 11:50:30 AM</span>
</span><span id="__span-577-20"><a id="__codelineno-577-20" name="__codelineno-577-20" href="#__codelineno-577-20"></a>
</span><span id="__span-577-21"><a id="__codelineno-577-21" name="__codelineno-577-21" href="#__codelineno-577-21"></a><span class="n">DateTime</span><span class="w"> </span><span class="n">thisYear</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">DateTime</span><span class="w"> </span><span class="p">(</span><span class="mi">2007</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">);</span>
</span><span id="__span-577-22"><a id="__codelineno-577-22" name="__codelineno-577-22" href="#__codelineno-577-22"></a><span class="n">DateTime</span><span class="w"> </span><span class="n">nextYear</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">thisYear</span><span class="p">.</span><span class="n">AddYears</span><span class="w"> </span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>
</span><span id="__span-577-23"><a id="__codelineno-577-23" name="__codelineno-577-23" href="#__codelineno-577-23"></a><span class="n">TimeSpan</span><span class="w"> </span><span class="n">oneYear</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">nextYear</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">thisYear</span><span class="p">;</span>
</span></code></pre></div>
<h1 id="formatting-and-parsing">Formatting and Parsing</h1>
<p>Formatting means converting to a string; parsing means converting from a string.
The need to format or parse arises frequently in programming, in a variety of situaâ€
tions.</p>
<p>ToString and Parse</p>
<ul>
<li>These methods provide default functionality for many types</li>
</ul>
<p>Format providers</p>
<ul>
<li>These manifest as additional ToString (and Parse) methods that accept a forâ€
mat string and/or a format provider. Format providers are highly flexible and
culture-aware.</li>
</ul>
<p>XmlConvert</p>
<ul>
<li>This is a static class with methods that format and parse while honoring XML
standards. XmlConvert is also useful for general-purpose conversion when you
need culture independence or you want to preempt misparsing. XmlConvert
supports the numeric types, bool, DateTime, DateTimeOffset, TimeSpan, and
Guid.</li>
</ul>
<p>Type converters</p>
<ul>
<li>These target designers and XAML parsers.</li>
</ul>
<h3 id="tostring-and-parse">ToString and Parse</h3>
<p>The simplest formatting mechanism is the ToString method. It gives meaningful output on all simple value types. For the reverse operation, each of these types defines a static Parse method</p>
<div class="language-csharp highlight"><pre><span></span><code><span id="__span-578-1"><a id="__codelineno-578-1" name="__codelineno-578-1" href="#__codelineno-578-1"></a><span class="kt">string</span><span class="w"> </span><span class="n">s</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">true</span><span class="p">.</span><span class="n">ToString</span><span class="p">();</span><span class="w"> </span><span class="c1">// s = &quot;True&quot;</span>
</span><span id="__span-578-2"><a id="__codelineno-578-2" name="__codelineno-578-2" href="#__codelineno-578-2"></a><span class="kt">bool</span><span class="w"> </span><span class="n">b</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kt">bool</span><span class="p">.</span><span class="n">Parse</span><span class="w"> </span><span class="p">(</span><span class="n">s</span><span class="p">);</span><span class="w"> </span><span class="c1">// b = true</span>
</span></code></pre></div>
<p>If the parsing fails, a FormatException is thrown. Many types also define a TryParse method, which returns false if the conversion fails rather than throwing an exception</p>
<div class="language-csharp highlight"><pre><span></span><code><span id="__span-579-1"><a id="__codelineno-579-1" name="__codelineno-579-1" href="#__codelineno-579-1"></a><span class="kt">bool</span><span class="w"> </span><span class="n">failure</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kt">int</span><span class="p">.</span><span class="n">TryParse</span><span class="w"> </span><span class="p">(</span><span class="s">&quot;qwerty&quot;</span><span class="p">,</span><span class="w"> </span><span class="k">out</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">i1</span><span class="p">);</span>
</span><span id="__span-579-2"><a id="__codelineno-579-2" name="__codelineno-579-2" href="#__codelineno-579-2"></a><span class="kt">bool</span><span class="w"> </span><span class="n">success</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kt">int</span><span class="p">.</span><span class="n">TryParse</span><span class="w"> </span><span class="p">(</span><span class="s">&quot;123&quot;</span><span class="p">,</span><span class="w"> </span><span class="k">out</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">i2</span><span class="p">);</span>
</span></code></pre></div>
<p>If you donâ€™t care about the output and want to test only whether parsing would sucâ€
ceed, you can use a discard:</p>
<div class="language-csharp highlight"><pre><span></span><code><span id="__span-580-1"><a id="__codelineno-580-1" name="__codelineno-580-1" href="#__codelineno-580-1"></a><span class="kt">bool</span><span class="w"> </span><span class="n">success</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kt">int</span><span class="p">.</span><span class="n">TryParse</span><span class="w"> </span><span class="p">(</span><span class="s">&quot;123&quot;</span><span class="p">,</span><span class="w"> </span><span class="k">out</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">_</span><span class="p">);</span>
</span></code></pre></div>
<h3 id="format-providers">Format Providers</h3>
<div class="language-csharp highlight"><pre><span></span><code><span id="__span-581-1"><a id="__codelineno-581-1" name="__codelineno-581-1" href="#__codelineno-581-1"></a><span class="c1">// The format string provides instructions; the format provider determines how the instructions are translated:</span>
</span><span id="__span-581-2"><a id="__codelineno-581-2" name="__codelineno-581-2" href="#__codelineno-581-2"></a><span class="n">NumberFormatInfo</span><span class="w"> </span><span class="n">f</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">NumberFormatInfo</span><span class="p">();</span>
</span><span id="__span-581-3"><a id="__codelineno-581-3" name="__codelineno-581-3" href="#__codelineno-581-3"></a><span class="n">f</span><span class="p">.</span><span class="n">CurrencySymbol</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;$$&quot;</span><span class="p">;</span>
</span><span id="__span-581-4"><a id="__codelineno-581-4" name="__codelineno-581-4" href="#__codelineno-581-4"></a><span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="w"> </span><span class="p">(</span><span class="mi">3</span><span class="p">.</span><span class="n">ToString</span><span class="w"> </span><span class="p">(</span><span class="s">&quot;C&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">f</span><span class="p">));</span><span class="w">          </span><span class="c1">// $$ 3.00</span>
</span><span id="__span-581-5"><a id="__codelineno-581-5" name="__codelineno-581-5" href="#__codelineno-581-5"></a>
</span><span id="__span-581-6"><a id="__codelineno-581-6" name="__codelineno-581-6" href="#__codelineno-581-6"></a><span class="c1">// The default format provider is CultureInfo.CurrentCulture:</span>
</span><span id="__span-581-7"><a id="__codelineno-581-7" name="__codelineno-581-7" href="#__codelineno-581-7"></a><span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="w"> </span><span class="p">(</span><span class="mf">10.3</span><span class="p">.</span><span class="n">ToString</span><span class="w"> </span><span class="p">(</span><span class="s">&quot;C&quot;</span><span class="p">,</span><span class="w"> </span><span class="k">null</span><span class="p">));</span>
</span><span id="__span-581-8"><a id="__codelineno-581-8" name="__codelineno-581-8" href="#__codelineno-581-8"></a>
</span><span id="__span-581-9"><a id="__codelineno-581-9" name="__codelineno-581-9" href="#__codelineno-581-9"></a><span class="c1">// For convenience, most types overload ToString such that you can omit a null provider:</span>
</span><span id="__span-581-10"><a id="__codelineno-581-10" name="__codelineno-581-10" href="#__codelineno-581-10"></a><span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="w"> </span><span class="p">(</span><span class="mf">10.3</span><span class="p">.</span><span class="n">ToString</span><span class="w"> </span><span class="p">(</span><span class="s">&quot;C&quot;</span><span class="p">));</span>
</span><span id="__span-581-11"><a id="__codelineno-581-11" name="__codelineno-581-11" href="#__codelineno-581-11"></a><span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="w"> </span><span class="p">(</span><span class="mf">10.3</span><span class="p">.</span><span class="n">ToString</span><span class="w"> </span><span class="p">(</span><span class="s">&quot;F4&quot;</span><span class="p">));</span><span class="w">       </span><span class="c1">// (Fix to 4 D.P.)</span>
</span></code></pre></div>
<h3 id="composite-formatting">Composite formatting</h3>
<p>Composite format strings allow you to combine variable substitution with format
strings. The static string.Format method accepts a composite format string</p>
<div class="language-csharp highlight"><pre><span></span><code><span id="__span-582-1"><a id="__codelineno-582-1" name="__codelineno-582-1" href="#__codelineno-582-1"></a><span class="kt">string</span><span class="w"> </span><span class="n">composite</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;Credit={0:C}&quot;</span><span class="p">;</span>
</span><span id="__span-582-2"><a id="__codelineno-582-2" name="__codelineno-582-2" href="#__codelineno-582-2"></a><span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="w"> </span><span class="p">(</span><span class="kt">string</span><span class="p">.</span><span class="n">Format</span><span class="w"> </span><span class="p">(</span><span class="n">composite</span><span class="p">,</span><span class="w"> </span><span class="mi">500</span><span class="p">));</span><span class="w">   </span><span class="c1">// Credit=$500.00</span>
</span><span id="__span-582-3"><a id="__codelineno-582-3" name="__codelineno-582-3" href="#__codelineno-582-3"></a>
</span><span id="__span-582-4"><a id="__codelineno-582-4" name="__codelineno-582-4" href="#__codelineno-582-4"></a><span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="w"> </span><span class="p">(</span><span class="s">&quot;Credit={0:C}&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">500</span><span class="p">);</span><span class="w">   </span><span class="c1">// Credit=$500.00</span>
</span></code></pre></div>
<h3 id="standard-format-strings">Standard Format Strings</h3>
<div class="language-csharp highlight"><pre><span></span><code><span id="__span-583-1"><a id="__codelineno-583-1" name="__codelineno-583-1" href="#__codelineno-583-1"></a><span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="w"> </span><span class="p">(</span><span class="mf">12.345</span><span class="p">.</span><span class="n">ToString</span><span class="w"> </span><span class="p">(</span><span class="s">&quot;F4&quot;</span><span class="p">));</span><span class="c1">//F=Fix 4=Decimal</span>
</span><span id="__span-583-2"><a id="__codelineno-583-2" name="__codelineno-583-2" href="#__codelineno-583-2"></a><span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="w"> </span><span class="p">(</span><span class="mf">121.345</span><span class="p">.</span><span class="n">ToString</span><span class="w"> </span><span class="p">(</span><span class="s">&quot;E4&quot;</span><span class="p">));</span><span class="w"> </span>
</span><span id="__span-583-3"><a id="__codelineno-583-3" name="__codelineno-583-3" href="#__codelineno-583-3"></a><span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="w"> </span><span class="p">(</span><span class="mf">121.345</span><span class="p">.</span><span class="n">ToString</span><span class="w"> </span><span class="p">(</span><span class="s">&quot;C4&quot;</span><span class="p">));</span><span class="w"> </span>
</span><span id="__span-583-4"><a id="__codelineno-583-4" name="__codelineno-583-4" href="#__codelineno-583-4"></a><span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="w"> </span><span class="p">(</span><span class="mf">12.345</span><span class="p">.</span><span class="n">ToString</span><span class="w"> </span><span class="p">(</span><span class="s">&quot;.##&quot;</span><span class="p">));</span><span class="w"> </span>
</span><span id="__span-583-5"><a id="__codelineno-583-5" name="__codelineno-583-5" href="#__codelineno-583-5"></a><span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="w"> </span><span class="p">(</span><span class="mf">12.345</span><span class="p">.</span><span class="n">ToString</span><span class="w"> </span><span class="p">(</span><span class="s">&quot;.####&quot;</span><span class="p">));</span><span class="w"> </span>
</span><span id="__span-583-6"><a id="__codelineno-583-6" name="__codelineno-583-6" href="#__codelineno-583-6"></a><span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="w"> </span><span class="p">(</span><span class="mf">12.345</span><span class="p">.</span><span class="n">ToString</span><span class="w"> </span><span class="p">(</span><span class="s">&quot;.0000&quot;</span><span class="p">));</span><span class="w"> </span>
</span><span id="__span-583-7"><a id="__codelineno-583-7" name="__codelineno-583-7" href="#__codelineno-583-7"></a><span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="w"> </span><span class="p">(</span><span class="mf">1234.5</span><span class="p">.</span><span class="n">ToString</span><span class="w"> </span><span class="p">(</span><span class="s">&quot;#,###,###.00&quot;</span><span class="p">));</span><span class="w"> </span>
</span><span id="__span-583-8"><a id="__codelineno-583-8" name="__codelineno-583-8" href="#__codelineno-583-8"></a><span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="w"> </span><span class="p">(</span><span class="mf">1234.5</span><span class="p">.</span><span class="n">ToString</span><span class="w"> </span><span class="p">(</span><span class="s">&quot;0,000,000&quot;</span><span class="p">));</span><span class="w"> </span>
</span><span id="__span-583-9"><a id="__codelineno-583-9" name="__codelineno-583-9" href="#__codelineno-583-9"></a><span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="w"> </span><span class="p">(</span><span class="mf">0.6</span><span class="p">.</span><span class="n">ToString</span><span class="w"> </span><span class="p">(</span><span class="s">&quot;00%&quot;</span><span class="p">));</span><span class="w"> </span>
</span><span id="__span-583-10"><a id="__codelineno-583-10" name="__codelineno-583-10" href="#__codelineno-583-10"></a><span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="w"> </span><span class="p">(</span><span class="mf">12.345</span><span class="p">.</span><span class="n">ToString</span><span class="w"> </span><span class="p">(</span><span class="s">&quot;0E0&quot;</span><span class="p">));</span>
</span><span id="__span-583-11"><a id="__codelineno-583-11" name="__codelineno-583-11" href="#__codelineno-583-11"></a>
</span><span id="__span-583-12"><a id="__codelineno-583-12" name="__codelineno-583-12" href="#__codelineno-583-12"></a><span class="cm">/*</span>
</span><span id="__span-583-13"><a id="__codelineno-583-13" name="__codelineno-583-13" href="#__codelineno-583-13"></a><span class="cm">12.3450</span>
</span><span id="__span-583-14"><a id="__codelineno-583-14" name="__codelineno-583-14" href="#__codelineno-583-14"></a><span class="cm">1.2134E+002</span>
</span><span id="__span-583-15"><a id="__codelineno-583-15" name="__codelineno-583-15" href="#__codelineno-583-15"></a><span class="cm">â‚¹ 121.3450</span>
</span><span id="__span-583-16"><a id="__codelineno-583-16" name="__codelineno-583-16" href="#__codelineno-583-16"></a><span class="cm">121.345</span>
</span><span id="__span-583-17"><a id="__codelineno-583-17" name="__codelineno-583-17" href="#__codelineno-583-17"></a><span class="cm">12.35</span>
</span><span id="__span-583-18"><a id="__codelineno-583-18" name="__codelineno-583-18" href="#__codelineno-583-18"></a><span class="cm">12.345</span>
</span><span id="__span-583-19"><a id="__codelineno-583-19" name="__codelineno-583-19" href="#__codelineno-583-19"></a><span class="cm">12.3450</span>
</span><span id="__span-583-20"><a id="__codelineno-583-20" name="__codelineno-583-20" href="#__codelineno-583-20"></a><span class="cm">1,234.50</span>
</span><span id="__span-583-21"><a id="__codelineno-583-21" name="__codelineno-583-21" href="#__codelineno-583-21"></a><span class="cm">00,01,235</span>
</span><span id="__span-583-22"><a id="__codelineno-583-22" name="__codelineno-583-22" href="#__codelineno-583-22"></a><span class="cm">60%</span>
</span><span id="__span-583-23"><a id="__codelineno-583-23" name="__codelineno-583-23" href="#__codelineno-583-23"></a><span class="cm">1E1</span>
</span><span id="__span-583-24"><a id="__codelineno-583-24" name="__codelineno-583-24" href="#__codelineno-583-24"></a><span class="cm">*/</span>
</span></code></pre></div>
<h1 id="globalization">Globalization</h1>
<p>There are two aspects to internationalizing an application: globalization and localization.</p>
<p>Globalization is concerned with three tasks (in decreasing order of importance)</p>
<ul>
<li>Making sure that your program doesnâ€™t break when run in another culture</li>
<li>Respecting a local cultureâ€™s formatting rules; for instance, when displaying
dates</li>
<li>Designing your program so that it picks up culture-specific data and strings
from satellite assemblies that you can later write and deploy</li>
</ul>
<h3 id="globalization-checklist">Globalization Checklist</h3>
<ul>
<li>Understand Unicode and text encodings</li>
<li>Be mindful that methods such as ToUpper and ToLower on char and string are
culture sensitive: use ToUpperInvariant/ToLowerInvariant unless you want
culture sensitivity</li>
<li>Favor culture-independent formatting and parsing mechanisms for DateTime
and DateTimeOffsets such as ToString("o") and XmlConvert</li>
<li>Otherwise, specify a culture when formatting/parsing numbers or date/times
(unless you want local-culture behavior).</li>
</ul>
<h1 id="the-iequatable-interface">The IEquatable<T> interface</h1>
<h3 id="overriding-equals">Overriding Equals</h3>
<p>In addition to overriding Equals, you can optionally overload the equality and inequality operators. This is nearly always done with structs because the consequence of not doing so is that the == and != operators will simply not work on your type.</p>
<p>With classes, there are two ways to proceed:</p>
<ul>
<li>Leave == and != aloneâ€”so that they apply referential equality</li>
<li>Overload == and != in line with Equals.</li>
</ul>
<p>The first approach is most common with custom typesâ€”especially mutable types. It ensures that your type follows the expectation that == and != should exhibit referential equality with reference types and this avoids confusing consumers.</p>
<div class="language-csharp highlight"><pre><span></span><code><span id="__span-584-1"><a id="__codelineno-584-1" name="__codelineno-584-1" href="#__codelineno-584-1"></a><span class="kt">var</span><span class="w"> </span><span class="n">sb1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">StringBuilder</span><span class="w"> </span><span class="p">(</span><span class="s">&quot;foo&quot;</span><span class="p">);</span>
</span><span id="__span-584-2"><a id="__codelineno-584-2" name="__codelineno-584-2" href="#__codelineno-584-2"></a><span class="kt">var</span><span class="w"> </span><span class="n">sb2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">StringBuilder</span><span class="w"> </span><span class="p">(</span><span class="s">&quot;foo&quot;</span><span class="p">);</span>
</span><span id="__span-584-3"><a id="__codelineno-584-3" name="__codelineno-584-3" href="#__codelineno-584-3"></a><span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="w"> </span><span class="p">(</span><span class="n">sb1</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">sb2</span><span class="p">);</span><span class="w"> </span><span class="c1">// False (referential equality)</span>
</span><span id="__span-584-4"><a id="__codelineno-584-4" name="__codelineno-584-4" href="#__codelineno-584-4"></a><span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="w"> </span><span class="p">(</span><span class="n">sb1</span><span class="p">.</span><span class="n">Equals</span><span class="w"> </span><span class="p">(</span><span class="n">sb2</span><span class="p">));</span><span class="w"> </span><span class="c1">// True (value equality)</span>
</span></code></pre></div>
<h3 id="implementing-iequatable">Implementing IEquatable<T></h3>
<p>Imagine that we need a struct to represent an area whose width and height are interâ€
changeable. In other words, 5 Ã— 10 is equal to 10 Ã— 5.</p>
<div class="language-csharp highlight"><pre><span></span><code><span id="__span-585-1"><a id="__codelineno-585-1" name="__codelineno-585-1" href="#__codelineno-585-1"></a><span class="k">public</span><span class="w"> </span><span class="k">struct</span><span class="w"> </span><span class="nc">Area</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="n">IEquatable</span><span class="w"> </span><span class="o">&lt;</span><span class="n">Area</span><span class="o">&gt;</span>
</span><span id="__span-585-2"><a id="__codelineno-585-2" name="__codelineno-585-2" href="#__codelineno-585-2"></a><span class="p">{</span>
</span><span id="__span-585-3"><a id="__codelineno-585-3" name="__codelineno-585-3" href="#__codelineno-585-3"></a><span class="w"> </span><span class="k">public</span><span class="w"> </span><span class="k">readonly</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">Measure1</span><span class="p">;</span>
</span><span id="__span-585-4"><a id="__codelineno-585-4" name="__codelineno-585-4" href="#__codelineno-585-4"></a><span class="w"> </span><span class="k">public</span><span class="w"> </span><span class="k">readonly</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">Measure2</span><span class="p">;</span>
</span><span id="__span-585-5"><a id="__codelineno-585-5" name="__codelineno-585-5" href="#__codelineno-585-5"></a><span class="w"> </span><span class="k">public</span><span class="w"> </span><span class="nf">Area</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">m1</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">m2</span><span class="p">)</span>
</span><span id="__span-585-6"><a id="__codelineno-585-6" name="__codelineno-585-6" href="#__codelineno-585-6"></a><span class="w"> </span><span class="p">{</span>
</span><span id="__span-585-7"><a id="__codelineno-585-7" name="__codelineno-585-7" href="#__codelineno-585-7"></a><span class="w"> </span><span class="n">Measure1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Math</span><span class="p">.</span><span class="n">Min</span><span class="w"> </span><span class="p">(</span><span class="n">m1</span><span class="p">,</span><span class="w"> </span><span class="n">m2</span><span class="p">);</span>
</span><span id="__span-585-8"><a id="__codelineno-585-8" name="__codelineno-585-8" href="#__codelineno-585-8"></a><span class="w"> </span><span class="n">Measure2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Math</span><span class="p">.</span><span class="n">Max</span><span class="w"> </span><span class="p">(</span><span class="n">m1</span><span class="p">,</span><span class="w"> </span><span class="n">m2</span><span class="p">);</span>
</span><span id="__span-585-9"><a id="__codelineno-585-9" name="__codelineno-585-9" href="#__codelineno-585-9"></a><span class="w"> </span><span class="p">}</span>
</span><span id="__span-585-10"><a id="__codelineno-585-10" name="__codelineno-585-10" href="#__codelineno-585-10"></a><span class="w"> </span><span class="k">public</span><span class="w"> </span><span class="k">override</span><span class="w"> </span><span class="kt">bool</span><span class="w"> </span><span class="nf">Equals</span><span class="w"> </span><span class="p">(</span><span class="kt">object</span><span class="w"> </span><span class="n">other</span><span class="p">)</span>
</span><span id="__span-585-11"><a id="__codelineno-585-11" name="__codelineno-585-11" href="#__codelineno-585-11"></a><span class="w"> </span><span class="p">{</span>
</span><span id="__span-585-12"><a id="__codelineno-585-12" name="__codelineno-585-12" href="#__codelineno-585-12"></a><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="p">(</span><span class="n">other</span><span class="w"> </span><span class="k">is</span><span class="w"> </span><span class="n">Area</span><span class="p">))</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="k">false</span><span class="p">;</span>
</span><span id="__span-585-13"><a id="__codelineno-585-13" name="__codelineno-585-13" href="#__codelineno-585-13"></a><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="nf">Equals</span><span class="w"> </span><span class="p">((</span><span class="n">Area</span><span class="p">)</span><span class="w"> </span><span class="n">other</span><span class="p">);</span><span class="w"> </span><span class="c1">// Calls method below</span>
</span><span id="__span-585-14"><a id="__codelineno-585-14" name="__codelineno-585-14" href="#__codelineno-585-14"></a><span class="w"> </span><span class="p">}</span>
</span><span id="__span-585-15"><a id="__codelineno-585-15" name="__codelineno-585-15" href="#__codelineno-585-15"></a><span class="w"> </span><span class="k">public</span><span class="w"> </span><span class="kt">bool</span><span class="w"> </span><span class="nf">Equals</span><span class="w"> </span><span class="p">(</span><span class="n">Area</span><span class="w"> </span><span class="n">other</span><span class="p">)</span><span class="w"> </span><span class="c1">// Implements IEquatable&lt;Area&gt;</span>
</span><span id="__span-585-16"><a id="__codelineno-585-16" name="__codelineno-585-16" href="#__codelineno-585-16"></a><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="n">Measure1</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">other</span><span class="p">.</span><span class="n">Measure1</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">Measure2</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">other</span><span class="p">.</span><span class="n">Measure2</span><span class="p">;</span>
</span><span id="__span-585-17"><a id="__codelineno-585-17" name="__codelineno-585-17" href="#__codelineno-585-17"></a><span class="w"> </span><span class="k">public</span><span class="w"> </span><span class="k">override</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="nf">GetHashCode</span><span class="p">()</span>
</span><span id="__span-585-18"><a id="__codelineno-585-18" name="__codelineno-585-18" href="#__codelineno-585-18"></a><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="n">HashCode</span><span class="p">.</span><span class="n">Combine</span><span class="w"> </span><span class="p">(</span><span class="n">Measure1</span><span class="p">,</span><span class="w"> </span><span class="n">Measure2</span><span class="p">);</span>
</span><span id="__span-585-19"><a id="__codelineno-585-19" name="__codelineno-585-19" href="#__codelineno-585-19"></a><span class="w"> </span><span class="k">public</span><span class="w"> </span><span class="k">static</span><span class="w"> </span><span class="kt">bool</span><span class="w"> </span><span class="k">operator</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="p">(</span><span class="n">Area</span><span class="w"> </span><span class="n">a1</span><span class="p">,</span><span class="w"> </span><span class="n">Area</span><span class="w"> </span><span class="n">a2</span><span class="p">)</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="n">a1</span><span class="p">.</span><span class="n">Equals</span><span class="w"> </span><span class="p">(</span><span class="n">a2</span><span class="p">);</span>
</span><span id="__span-585-20"><a id="__codelineno-585-20" name="__codelineno-585-20" href="#__codelineno-585-20"></a><span class="w"> </span><span class="k">public</span><span class="w"> </span><span class="k">static</span><span class="w"> </span><span class="kt">bool</span><span class="w"> </span><span class="k">operator</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="p">(</span><span class="n">Area</span><span class="w"> </span><span class="n">a1</span><span class="p">,</span><span class="w"> </span><span class="n">Area</span><span class="w"> </span><span class="n">a2</span><span class="p">)</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="o">!</span><span class="n">a1</span><span class="p">.</span><span class="n">Equals</span><span class="w"> </span><span class="p">(</span><span class="n">a2</span><span class="p">);</span>
</span><span id="__span-585-21"><a id="__codelineno-585-21" name="__codelineno-585-21" href="#__codelineno-585-21"></a><span class="p">}</span>
</span><span id="__span-585-22"><a id="__codelineno-585-22" name="__codelineno-585-22" href="#__codelineno-585-22"></a>
</span><span id="__span-585-23"><a id="__codelineno-585-23" name="__codelineno-585-23" href="#__codelineno-585-23"></a><span class="n">Area</span><span class="w"> </span><span class="n">a1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">Area</span><span class="w"> </span><span class="p">(</span><span class="mi">5</span><span class="p">,</span><span class="w"> </span><span class="mi">10</span><span class="p">);</span>
</span><span id="__span-585-24"><a id="__codelineno-585-24" name="__codelineno-585-24" href="#__codelineno-585-24"></a><span class="n">Area</span><span class="w"> </span><span class="n">a2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">Area</span><span class="w"> </span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="w"> </span><span class="mi">5</span><span class="p">);</span>
</span><span id="__span-585-25"><a id="__codelineno-585-25" name="__codelineno-585-25" href="#__codelineno-585-25"></a><span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="w"> </span><span class="p">(</span><span class="n">a1</span><span class="p">.</span><span class="n">Equals</span><span class="w"> </span><span class="p">(</span><span class="n">a2</span><span class="p">));</span><span class="w"> </span><span class="c1">// True</span>
</span><span id="__span-585-26"><a id="__codelineno-585-26" name="__codelineno-585-26" href="#__codelineno-585-26"></a><span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="w"> </span><span class="p">(</span><span class="n">a1</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">a2</span><span class="p">);</span><span class="w"> </span><span class="c1">// True</span>
</span></code></pre></div>
<h1 id="utility-classes">Utility Classes</h1>
<h3 id="console">Console</h3>
<p>The static Console class handles standard input/output for console-based applications. In a command-line (Console) application, the input comes from the keyboard via Read, ReadKey, and ReadLine, and the output goes to the text window via Write and WriteLine.</p>
<div class="language-csharp highlight"><pre><span></span><code><span id="__span-586-1"><a id="__codelineno-586-1" name="__codelineno-586-1" href="#__codelineno-586-1"></a><span class="n">Console</span><span class="p">.</span><span class="n">WindowWidth</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Console</span><span class="p">.</span><span class="n">LargestWindowWidth</span><span class="p">;</span>
</span><span id="__span-586-2"><a id="__codelineno-586-2" name="__codelineno-586-2" href="#__codelineno-586-2"></a><span class="n">Console</span><span class="p">.</span><span class="n">ForegroundColor</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ConsoleColor</span><span class="p">.</span><span class="n">Green</span><span class="p">;</span>
</span><span id="__span-586-3"><a id="__codelineno-586-3" name="__codelineno-586-3" href="#__codelineno-586-3"></a><span class="n">Console</span><span class="p">.</span><span class="n">Write</span><span class="w"> </span><span class="p">(</span><span class="s">&quot;test... 50%&quot;</span><span class="p">);</span>
</span><span id="__span-586-4"><a id="__codelineno-586-4" name="__codelineno-586-4" href="#__codelineno-586-4"></a><span class="n">Console</span><span class="p">.</span><span class="n">CursorLeft</span><span class="w"> </span><span class="o">-=</span><span class="w"> </span><span class="mi">3</span><span class="p">;</span>
</span><span id="__span-586-5"><a id="__codelineno-586-5" name="__codelineno-586-5" href="#__codelineno-586-5"></a><span class="n">Console</span><span class="p">.</span><span class="n">Write</span><span class="w"> </span><span class="p">(</span><span class="s">&quot;90%&quot;</span><span class="p">);</span><span class="w"> </span><span class="c1">// test... 90%</span>
</span></code></pre></div>
<p>The Write and WriteLine methods are overloaded to accept a composite format string</p>
<p>The Console.Out property returns a TextWriter. Passing Console.Out to a method
that expects a TextWriter is a useful way to get that method to write to the Console
for diagnostic purposes.</p>
<h3 id="environment">Environment</h3>
<p>The static System.Environment class provides a range of useful properties:</p>
<p>Files and folders</p>
<ul>
<li>CurrentDirectory, SystemDirectory, CommandLine</li>
</ul>
<p>Computer and operating system</p>
<ul>
<li>MachineName, ProcessorCount, OSVersion, NewLine</li>
</ul>
<p>User logon</p>
<ul>
<li>UserName, UserInteractive, UserDomainName</li>
</ul>
<p>Diagnostics</p>
<ul>
<li>TickCount, StackTrace, WorkingSet, Version</li>
</ul>
<h3 id="process">Process</h3>
<p>The Process class in System.Diagnostics allows you to launch a new process</p>
<div class="language-csharp highlight"><pre><span></span><code><span id="__span-587-1"><a id="__codelineno-587-1" name="__codelineno-587-1" href="#__codelineno-587-1"></a><span class="n">Process</span><span class="p">.</span><span class="n">Start</span><span class="w"> </span><span class="p">(</span><span class="s">&quot;notepad.exe&quot;</span><span class="p">);</span>
</span><span id="__span-587-2"><a id="__codelineno-587-2" name="__codelineno-587-2" href="#__codelineno-587-2"></a><span class="n">Process</span><span class="p">.</span><span class="n">Start</span><span class="w"> </span><span class="p">(</span><span class="s">&quot;notepad.exe&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;e:\\file.txt&quot;</span><span class="p">);</span>
</span></code></pre></div>
<p>The most flexible overload accepts a ProcessStartInfo instance. With this, you can capture and redirect the launched processâ€™s input, output, and error output (if you leave UseShellExecute as false).</p>
<div class="language-csharp highlight"><pre><span></span><code><span id="__span-588-1"><a id="__codelineno-588-1" name="__codelineno-588-1" href="#__codelineno-588-1"></a><span class="n">ProcessStartInfo</span><span class="w"> </span><span class="n">psi</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">ProcessStartInfo</span>
</span><span id="__span-588-2"><a id="__codelineno-588-2" name="__codelineno-588-2" href="#__codelineno-588-2"></a><span class="p">{</span>
</span><span id="__span-588-3"><a id="__codelineno-588-3" name="__codelineno-588-3" href="#__codelineno-588-3"></a><span class="w"> </span><span class="n">FileName</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;cmd.exe&quot;</span><span class="p">,</span>
</span><span id="__span-588-4"><a id="__codelineno-588-4" name="__codelineno-588-4" href="#__codelineno-588-4"></a><span class="w"> </span><span class="n">Arguments</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;/c ipconfig /all&quot;</span><span class="p">,</span>
</span><span id="__span-588-5"><a id="__codelineno-588-5" name="__codelineno-588-5" href="#__codelineno-588-5"></a><span class="w"> </span><span class="n">RedirectStandardOutput</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">true</span><span class="p">,</span>
</span><span id="__span-588-6"><a id="__codelineno-588-6" name="__codelineno-588-6" href="#__codelineno-588-6"></a><span class="w"> </span><span class="n">UseShellExecute</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">false</span>
</span><span id="__span-588-7"><a id="__codelineno-588-7" name="__codelineno-588-7" href="#__codelineno-588-7"></a><span class="p">};</span>
</span><span id="__span-588-8"><a id="__codelineno-588-8" name="__codelineno-588-8" href="#__codelineno-588-8"></a><span class="n">Process</span><span class="w"> </span><span class="n">p</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Process</span><span class="p">.</span><span class="n">Start</span><span class="w"> </span><span class="p">(</span><span class="n">psi</span><span class="p">);</span>
</span><span id="__span-588-9"><a id="__codelineno-588-9" name="__codelineno-588-9" href="#__codelineno-588-9"></a><span class="kt">string</span><span class="w"> </span><span class="n">result</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">p</span><span class="p">.</span><span class="n">StandardOutput</span><span class="p">.</span><span class="n">ReadToEnd</span><span class="p">();</span>
</span><span id="__span-588-10"><a id="__codelineno-588-10" name="__codelineno-588-10" href="#__codelineno-588-10"></a><span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="w"> </span><span class="p">(</span><span class="n">result</span><span class="p">);</span>
</span></code></pre></div>
<h3 id="useshellexecute">UseShellExecute</h3>
<p>The UseShellExecute flag changes how the CLR starts the process. With Use ShellExecute true, you can do the following:</p>
<ul>
<li>Specify a path to a file or document rather than an executable (resulting in the operating system opening the file or document with its associated application)</li>
<li>Specify a URL (resulting in the operating system navigating to that URL in the default web browser)</li>
<li>(Windows only) Specify a Verb (such as runas, to run the process with administrative elevation)</li>
</ul>
<div class="language-csharp highlight"><pre><span></span><code><span id="__span-589-1"><a id="__codelineno-589-1" name="__codelineno-589-1" href="#__codelineno-589-1"></a><span class="k">void</span><span class="w"> </span><span class="nf">Main</span><span class="p">()</span>
</span><span id="__span-589-2"><a id="__codelineno-589-2" name="__codelineno-589-2" href="#__codelineno-589-2"></a><span class="p">{</span>
</span><span id="__span-589-3"><a id="__codelineno-589-3" name="__codelineno-589-3" href="#__codelineno-589-3"></a><span class="w">    </span><span class="n">LaunchFileOrUrl</span><span class="w"> </span><span class="p">(</span><span class="s">&quot;http://www.albahari.com/nutshell&quot;</span><span class="p">);</span>
</span><span id="__span-589-4"><a id="__codelineno-589-4" name="__codelineno-589-4" href="#__codelineno-589-4"></a><span class="p">}</span>
</span><span id="__span-589-5"><a id="__codelineno-589-5" name="__codelineno-589-5" href="#__codelineno-589-5"></a>
</span><span id="__span-589-6"><a id="__codelineno-589-6" name="__codelineno-589-6" href="#__codelineno-589-6"></a><span class="k">void</span><span class="w"> </span><span class="nf">LaunchFileOrUrl</span><span class="w"> </span><span class="p">(</span><span class="kt">string</span><span class="w"> </span><span class="n">url</span><span class="p">)</span>
</span><span id="__span-589-7"><a id="__codelineno-589-7" name="__codelineno-589-7" href="#__codelineno-589-7"></a><span class="p">{</span>
</span><span id="__span-589-8"><a id="__codelineno-589-8" name="__codelineno-589-8" href="#__codelineno-589-8"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">RuntimeInformation</span><span class="p">.</span><span class="n">IsOSPlatform</span><span class="w"> </span><span class="p">(</span><span class="n">OSPlatform</span><span class="p">.</span><span class="n">Linux</span><span class="p">))</span>
</span><span id="__span-589-9"><a id="__codelineno-589-9" name="__codelineno-589-9" href="#__codelineno-589-9"></a><span class="w">        </span><span class="n">Process</span><span class="p">.</span><span class="n">Start</span><span class="w"> </span><span class="p">(</span><span class="s">&quot;xdg-open&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">url</span><span class="p">);</span>
</span><span id="__span-589-10"><a id="__codelineno-589-10" name="__codelineno-589-10" href="#__codelineno-589-10"></a><span class="w">    </span><span class="k">else</span><span class="w"> </span><span class="nf">if</span><span class="w"> </span><span class="p">(</span><span class="n">RuntimeInformation</span><span class="p">.</span><span class="n">IsOSPlatform</span><span class="w"> </span><span class="p">(</span><span class="n">OSPlatform</span><span class="p">.</span><span class="n">Windows</span><span class="p">))</span>
</span><span id="__span-589-11"><a id="__codelineno-589-11" name="__codelineno-589-11" href="#__codelineno-589-11"></a><span class="w">        </span><span class="n">Process</span><span class="p">.</span><span class="n">Start</span><span class="w"> </span><span class="p">(</span><span class="k">new</span><span class="w"> </span><span class="n">ProcessStartInfo</span><span class="w"> </span><span class="p">(</span><span class="n">url</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">UseShellExecute</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">true</span><span class="w"> </span><span class="p">});</span>
</span><span id="__span-589-12"><a id="__codelineno-589-12" name="__codelineno-589-12" href="#__codelineno-589-12"></a><span class="w">    </span><span class="k">else</span>
</span><span id="__span-589-13"><a id="__codelineno-589-13" name="__codelineno-589-13" href="#__codelineno-589-13"></a><span class="w">        </span><span class="k">throw</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="nf">NotSupportedException</span><span class="w"> </span><span class="p">(</span><span class="s">&quot;Platform unsupported.&quot;</span><span class="p">);</span>
</span><span id="__span-589-14"><a id="__codelineno-589-14" name="__codelineno-589-14" href="#__codelineno-589-14"></a><span class="p">}</span>
</span><span id="__span-589-15"><a id="__codelineno-589-15" name="__codelineno-589-15" href="#__codelineno-589-15"></a><span class="err">```#</span><span class="w"> </span><span class="n">Chapter</span><span class="w"> </span><span class="mi">7</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="n">Collections</span>
</span><span id="__span-589-16"><a id="__codelineno-589-16" name="__codelineno-589-16" href="#__codelineno-589-16"></a>
</span><span id="__span-589-17"><a id="__codelineno-589-17" name="__codelineno-589-17" href="#__codelineno-589-17"></a><span class="err">#</span><span class="w"> </span><span class="n">Overview</span>
</span><span id="__span-589-18"><a id="__codelineno-589-18" name="__codelineno-589-18" href="#__codelineno-589-18"></a>
</span><span id="__span-589-19"><a id="__codelineno-589-19" name="__codelineno-589-19" href="#__codelineno-589-19"></a><span class="p">.</span><span class="n">NET</span><span class="w"> </span><span class="n">Core</span><span class="w"> </span><span class="n">provides</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">standard</span><span class="w"> </span><span class="k">set</span><span class="w"> </span><span class="n">of</span><span class="w"> </span><span class="n">types</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">storing</span><span class="w"> </span><span class="k">and</span><span class="w"> </span><span class="n">managing</span><span class="w"> </span><span class="n">collections</span><span class="w"> </span><span class="n">of</span><span class="w"> </span><span class="n">objects</span><span class="p">.</span><span class="w"> </span><span class="n">These</span><span class="w"> </span><span class="n">include</span><span class="w"> </span><span class="n">resizable</span><span class="w"> </span><span class="n">lists</span><span class="p">,</span><span class="w"> </span><span class="n">linked</span><span class="w"> </span><span class="n">lists</span><span class="p">,</span><span class="w"> </span><span class="n">sorted</span><span class="w"> </span><span class="k">and</span><span class="w"> </span><span class="n">unsorted</span><span class="w"> </span><span class="n">dictionaries</span><span class="p">,</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">well</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">arrays</span><span class="p">.</span><span class="w"> </span><span class="n">Of</span><span class="w"> </span><span class="n">these</span><span class="p">,</span><span class="w"> </span><span class="n">only</span><span class="w"> </span><span class="n">arrays</span><span class="w"> </span><span class="n">form</span><span class="w"> </span><span class="n">part</span><span class="w"> </span><span class="n">of</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">C</span><span class="err">#</span><span class="w"> </span><span class="n">language</span><span class="p">;</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">remaining</span><span class="w"> </span><span class="n">collections</span><span class="w"> </span><span class="n">are</span><span class="w"> </span><span class="n">just</span><span class="w"> </span><span class="n">classes</span><span class="w"> </span><span class="n">you</span><span class="w"> </span><span class="n">instantiate</span><span class="w"> </span><span class="n">like</span><span class="w"> </span><span class="n">any</span><span class="w"> </span><span class="n">other</span>
</span><span id="__span-589-20"><a id="__codelineno-589-20" name="__codelineno-589-20" href="#__codelineno-589-20"></a>
</span><span id="__span-589-21"><a id="__codelineno-589-21" name="__codelineno-589-21" href="#__codelineno-589-21"></a><span class="n">We</span><span class="w"> </span><span class="n">can</span><span class="w"> </span><span class="n">divide</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">types</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">Framework</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">collections</span><span class="w"> </span><span class="k">into</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">following</span><span class="w"> </span><span class="n">categories</span>
</span><span id="__span-589-22"><a id="__codelineno-589-22" name="__codelineno-589-22" href="#__codelineno-589-22"></a>
</span><span id="__span-589-23"><a id="__codelineno-589-23" name="__codelineno-589-23" href="#__codelineno-589-23"></a><span class="o">-</span><span class="w"> </span><span class="n">Interfaces</span><span class="w"> </span><span class="n">that</span><span class="w"> </span><span class="n">define</span><span class="w"> </span><span class="n">standard</span><span class="w"> </span><span class="n">collection</span><span class="w"> </span><span class="n">protocols</span>
</span><span id="__span-589-24"><a id="__codelineno-589-24" name="__codelineno-589-24" href="#__codelineno-589-24"></a><span class="o">-</span><span class="w"> </span><span class="n">Ready</span><span class="o">-</span><span class="n">to</span><span class="o">-</span><span class="n">use</span><span class="w"> </span><span class="n">collection</span><span class="w"> </span><span class="n">classes</span><span class="w"> </span><span class="p">(</span><span class="n">lists</span><span class="p">,</span><span class="w"> </span><span class="n">dictionaries</span><span class="p">,</span><span class="w"> </span><span class="n">etc</span><span class="p">.)</span>
</span><span id="__span-589-25"><a id="__codelineno-589-25" name="__codelineno-589-25" href="#__codelineno-589-25"></a><span class="o">-</span><span class="w"> </span><span class="n">Base</span><span class="w"> </span><span class="n">classes</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">writing</span><span class="w"> </span><span class="n">application</span><span class="o">-</span><span class="n">specific</span><span class="w"> </span><span class="n">collections</span>
</span><span id="__span-589-26"><a id="__codelineno-589-26" name="__codelineno-589-26" href="#__codelineno-589-26"></a>
</span><span id="__span-589-27"><a id="__codelineno-589-27" name="__codelineno-589-27" href="#__codelineno-589-27"></a><span class="n">The</span><span class="w"> </span><span class="n">collection</span><span class="w"> </span><span class="n">namespaces</span><span class="w"> </span><span class="n">are</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">follows</span>
</span><span id="__span-589-28"><a id="__codelineno-589-28" name="__codelineno-589-28" href="#__codelineno-589-28"></a>
</span><span id="__span-589-29"><a id="__codelineno-589-29" name="__codelineno-589-29" href="#__codelineno-589-29"></a><span class="o">-</span><span class="w"> </span><span class="err">`</span><span class="n">System</span><span class="p">.</span><span class="n">Collections</span><span class="err">`</span><span class="w"> </span><span class="n">Nongeneric</span><span class="w"> </span><span class="n">collection</span><span class="w"> </span><span class="n">classes</span><span class="w"> </span><span class="k">and</span><span class="w"> </span><span class="n">interfaces</span>
</span><span id="__span-589-30"><a id="__codelineno-589-30" name="__codelineno-589-30" href="#__codelineno-589-30"></a><span class="o">-</span><span class="w"> </span><span class="err">`</span><span class="n">System</span><span class="p">.</span><span class="n">Collections</span><span class="p">.</span><span class="n">Specialized</span><span class="err">`</span><span class="w"> </span><span class="n">Strongly</span><span class="w"> </span><span class="n">typed</span><span class="w"> </span><span class="n">nongeneric</span><span class="w"> </span><span class="n">collection</span><span class="w"> </span><span class="n">classes</span>
</span><span id="__span-589-31"><a id="__codelineno-589-31" name="__codelineno-589-31" href="#__codelineno-589-31"></a><span class="o">-</span><span class="w"> </span><span class="err">`</span><span class="n">System</span><span class="p">.</span><span class="n">Collections</span><span class="p">.</span><span class="n">Generic</span><span class="err">`</span><span class="w"> </span><span class="n">Generic</span><span class="w"> </span><span class="n">collection</span><span class="w"> </span><span class="n">classes</span><span class="w"> </span><span class="k">and</span><span class="w"> </span><span class="n">interfaces</span>
</span><span id="__span-589-32"><a id="__codelineno-589-32" name="__codelineno-589-32" href="#__codelineno-589-32"></a><span class="o">-</span><span class="w"> </span><span class="err">`</span><span class="n">System</span><span class="p">.</span><span class="n">Collections</span><span class="p">.</span><span class="n">ObjectModel</span><span class="err">`</span><span class="w"> </span><span class="n">Proxies</span><span class="w"> </span><span class="k">and</span><span class="w"> </span><span class="n">bases</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">custom</span><span class="w"> </span><span class="n">collections</span>
</span><span id="__span-589-33"><a id="__codelineno-589-33" name="__codelineno-589-33" href="#__codelineno-589-33"></a><span class="o">-</span><span class="w"> </span><span class="err">`</span><span class="n">System</span><span class="p">.</span><span class="n">Collections</span><span class="p">.</span><span class="n">Concurrent</span><span class="err">`</span><span class="w"> </span><span class="n">Thread</span><span class="o">-</span><span class="n">safe</span><span class="w"> </span><span class="n">collections</span><span class="w"> </span><span class="p">(</span><span class="n">see</span><span class="w"> </span><span class="n">Chapter</span><span class="w"> </span><span class="mi">23</span><span class="p">)</span>
</span><span id="__span-589-34"><a id="__codelineno-589-34" name="__codelineno-589-34" href="#__codelineno-589-34"></a>
</span><span id="__span-589-35"><a id="__codelineno-589-35" name="__codelineno-589-35" href="#__codelineno-589-35"></a><span class="err">#</span><span class="w"> </span><span class="n">Enumeration</span>
</span><span id="__span-589-36"><a id="__codelineno-589-36" name="__codelineno-589-36" href="#__codelineno-589-36"></a>
</span><span id="__span-589-37"><a id="__codelineno-589-37" name="__codelineno-589-37" href="#__codelineno-589-37"></a><span class="n">In</span><span class="w"> </span><span class="n">computing</span><span class="p">,</span><span class="w"> </span><span class="n">there</span><span class="w"> </span><span class="n">are</span><span class="w"> </span><span class="n">many</span><span class="w"> </span><span class="n">different</span><span class="w"> </span><span class="n">kinds</span><span class="w"> </span><span class="n">of</span><span class="w"> </span><span class="n">collections</span><span class="p">,</span><span class="w"> </span><span class="n">ranging</span><span class="w"> </span><span class="k">from</span><span class="w"> </span><span class="n">simple</span><span class="w"> </span><span class="n">data</span><span class="w"> </span><span class="n">structures</span><span class="w"> </span><span class="n">such</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">arrays</span><span class="w"> </span><span class="k">or</span><span class="w"> </span><span class="n">linked</span><span class="w"> </span><span class="n">lists</span><span class="p">,</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">more</span><span class="w"> </span><span class="n">complex</span><span class="w"> </span><span class="n">ones</span><span class="w"> </span><span class="n">such</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">red</span><span class="o">/</span><span class="n">black</span><span class="w"> </span><span class="n">trees</span><span class="w"> </span><span class="k">and</span><span class="w"> </span><span class="n">hashtables</span><span class="p">.</span><span class="w"> </span><span class="n">Although</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="k">internal</span><span class="w"> </span><span class="n">implementation</span><span class="w"> </span><span class="k">and</span><span class="w"> </span><span class="n">external</span>
</span><span id="__span-589-38"><a id="__codelineno-589-38" name="__codelineno-589-38" href="#__codelineno-589-38"></a>
</span><span id="__span-589-39"><a id="__codelineno-589-39" name="__codelineno-589-39" href="#__codelineno-589-39"></a><span class="n">characteristics</span><span class="w"> </span><span class="n">of</span><span class="w"> </span><span class="n">these</span><span class="w"> </span><span class="n">data</span><span class="w"> </span><span class="n">structures</span><span class="w"> </span><span class="n">vary</span><span class="w"> </span><span class="n">widely</span><span class="p">,</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">ability</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">traverse</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">contents</span><span class="w"> </span><span class="n">of</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">collection</span><span class="w"> </span><span class="k">is</span><span class="w"> </span><span class="n">an</span><span class="w"> </span><span class="n">almost</span><span class="w"> </span><span class="n">universal</span><span class="w"> </span><span class="n">need</span><span class="p">.</span><span class="w"> </span><span class="n">The</span><span class="w"> </span><span class="n">Framework</span><span class="w"> </span><span class="n">supports</span><span class="w"> </span><span class="k">this</span><span class="w"> </span><span class="n">need</span><span class="w"> </span><span class="n">via</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">pair</span><span class="w"> </span><span class="n">of</span><span class="w"> </span><span class="n">interfaces</span><span class="w"> </span><span class="p">(</span><span class="n">IEnumerable</span><span class="p">,</span><span class="w"> </span><span class="n">IEnumerator</span><span class="p">,</span><span class="w"> </span><span class="k">and</span><span class="w"> </span><span class="n">their</span><span class="w"> </span><span class="n">generic</span><span class="w"> </span><span class="n">counterparts</span><span class="p">)</span><span class="w"> </span><span class="n">that</span><span class="w"> </span><span class="n">allow</span><span class="w"> </span><span class="n">different</span><span class="w"> </span><span class="n">data</span><span class="w"> </span><span class="n">structures</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">expose</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">common</span><span class="w"> </span><span class="n">traversal</span><span class="w"> </span><span class="n">API</span><span class="p">.</span>
</span><span id="__span-589-40"><a id="__codelineno-589-40" name="__codelineno-589-40" href="#__codelineno-589-40"></a>
</span><span id="__span-589-41"><a id="__codelineno-589-41" name="__codelineno-589-41" href="#__codelineno-589-41"></a><span class="n">The</span><span class="w"> </span><span class="n">IEnumerator</span><span class="w"> </span><span class="k">interface</span><span class="w"> </span><span class="n">defines</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">basic</span><span class="w"> </span><span class="n">low</span><span class="o">-</span><span class="n">level</span><span class="w"> </span><span class="n">protocol</span><span class="w"> </span><span class="k">by</span><span class="w"> </span><span class="n">which</span><span class="w"> </span><span class="n">elements</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">collection</span><span class="w"> </span><span class="n">are</span><span class="w"> </span><span class="n">traversed</span><span class="err">â€”</span><span class="k">or</span><span class="w"> </span><span class="n">enumerated</span><span class="err">â€”</span><span class="k">in</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">forward</span><span class="o">-</span><span class="n">only</span><span class="w"> </span><span class="n">manner</span><span class="p">.</span><span class="w"> </span>
</span><span id="__span-589-42"><a id="__codelineno-589-42" name="__codelineno-589-42" href="#__codelineno-589-42"></a>
</span><span id="__span-589-43"><a id="__codelineno-589-43" name="__codelineno-589-43" href="#__codelineno-589-43"></a><span class="err">```</span><span class="n">csharp</span>
</span><span id="__span-589-44"><a id="__codelineno-589-44" name="__codelineno-589-44" href="#__codelineno-589-44"></a><span class="k">public</span><span class="w"> </span><span class="k">interface</span><span class="w"> </span><span class="n">IEnumerator</span>
</span><span id="__span-589-45"><a id="__codelineno-589-45" name="__codelineno-589-45" href="#__codelineno-589-45"></a><span class="p">{</span>
</span><span id="__span-589-46"><a id="__codelineno-589-46" name="__codelineno-589-46" href="#__codelineno-589-46"></a><span class="w"> </span><span class="kt">bool</span><span class="w"> </span><span class="nf">MoveNext</span><span class="p">();</span>
</span><span id="__span-589-47"><a id="__codelineno-589-47" name="__codelineno-589-47" href="#__codelineno-589-47"></a><span class="w"> </span><span class="kt">object</span><span class="w"> </span><span class="n">Current</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">get</span><span class="p">;</span><span class="w"> </span><span class="p">}</span>
</span><span id="__span-589-48"><a id="__codelineno-589-48" name="__codelineno-589-48" href="#__codelineno-589-48"></a><span class="w"> </span><span class="k">void</span><span class="w"> </span><span class="nf">Reset</span><span class="p">();</span>
</span><span id="__span-589-49"><a id="__codelineno-589-49" name="__codelineno-589-49" href="#__codelineno-589-49"></a><span class="p">}</span>
</span></code></pre></div>
<p>MoveNext advances the current element or â€œcursorâ€ to the next position, returning false if there are no more elements in the collection. Current returns the element at the current position (usually cast from object to a more specific type). MoveNext must be called before retrieving the first elementâ€”this is to allow for an empty collection. The Reset method, if implemented, moves back to the start, allowing the collection to be enumerated again. Reset exists mainly for Component Object Model (COM) interoperability; calling it directly is generally avoided because itâ€™s not universally supported (and is unnecessary in that itâ€™s usually just as easy to instantiate a new enumerator.)</p>
<p>Collections do not usually implement enumerators; instead, they provide enumeraâ€
tors, via the interface IEnumerable</p>
<div class="language-csharp highlight"><pre><span></span><code><span id="__span-590-1"><a id="__codelineno-590-1" name="__codelineno-590-1" href="#__codelineno-590-1"></a><span class="k">public</span><span class="w"> </span><span class="k">interface</span><span class="w"> </span><span class="n">IEnumerable</span>
</span><span id="__span-590-2"><a id="__codelineno-590-2" name="__codelineno-590-2" href="#__codelineno-590-2"></a><span class="p">{</span>
</span><span id="__span-590-3"><a id="__codelineno-590-3" name="__codelineno-590-3" href="#__codelineno-590-3"></a><span class="w"> </span><span class="n">IEnumerator</span><span class="w"> </span><span class="nf">GetEnumerator</span><span class="p">();</span>
</span><span id="__span-590-4"><a id="__codelineno-590-4" name="__codelineno-590-4" href="#__codelineno-590-4"></a><span class="p">}</span>
</span></code></pre></div>
<div class="language-csharp highlight"><pre><span></span><code><span id="__span-591-1"><a id="__codelineno-591-1" name="__codelineno-591-1" href="#__codelineno-591-1"></a><span class="kt">string</span><span class="w"> </span><span class="n">s</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;Hello&quot;</span><span class="p">;</span>
</span><span id="__span-591-2"><a id="__codelineno-591-2" name="__codelineno-591-2" href="#__codelineno-591-2"></a>
</span><span id="__span-591-3"><a id="__codelineno-591-3" name="__codelineno-591-3" href="#__codelineno-591-3"></a><span class="c1">// Because string implements IEnumerable, we can call GetEnumerator():</span>
</span><span id="__span-591-4"><a id="__codelineno-591-4" name="__codelineno-591-4" href="#__codelineno-591-4"></a><span class="n">IEnumerator</span><span class="w"> </span><span class="n">rator</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">s</span><span class="p">.</span><span class="n">GetEnumerator</span><span class="p">();</span>
</span><span id="__span-591-5"><a id="__codelineno-591-5" name="__codelineno-591-5" href="#__codelineno-591-5"></a>
</span><span id="__span-591-6"><a id="__codelineno-591-6" name="__codelineno-591-6" href="#__codelineno-591-6"></a><span class="k">while</span><span class="w"> </span><span class="p">(</span><span class="n">rator</span><span class="p">.</span><span class="n">MoveNext</span><span class="p">())</span>
</span><span id="__span-591-7"><a id="__codelineno-591-7" name="__codelineno-591-7" href="#__codelineno-591-7"></a><span class="p">{</span>
</span><span id="__span-591-8"><a id="__codelineno-591-8" name="__codelineno-591-8" href="#__codelineno-591-8"></a><span class="w">    </span><span class="kt">char</span><span class="w"> </span><span class="n">c</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="kt">char</span><span class="p">)</span><span class="w"> </span><span class="n">rator</span><span class="p">.</span><span class="n">Current</span><span class="p">;</span>
</span><span id="__span-591-9"><a id="__codelineno-591-9" name="__codelineno-591-9" href="#__codelineno-591-9"></a><span class="w">    </span><span class="n">Console</span><span class="p">.</span><span class="n">Write</span><span class="w"> </span><span class="p">(</span><span class="n">c</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s">&quot;.&quot;</span><span class="p">);</span>
</span><span id="__span-591-10"><a id="__codelineno-591-10" name="__codelineno-591-10" href="#__codelineno-591-10"></a><span class="p">}</span>
</span><span id="__span-591-11"><a id="__codelineno-591-11" name="__codelineno-591-11" href="#__codelineno-591-11"></a>
</span><span id="__span-591-12"><a id="__codelineno-591-12" name="__codelineno-591-12" href="#__codelineno-591-12"></a><span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="p">();</span>
</span><span id="__span-591-13"><a id="__codelineno-591-13" name="__codelineno-591-13" href="#__codelineno-591-13"></a>
</span><span id="__span-591-14"><a id="__codelineno-591-14" name="__codelineno-591-14" href="#__codelineno-591-14"></a><span class="c1">// Equivalent to:</span>
</span><span id="__span-591-15"><a id="__codelineno-591-15" name="__codelineno-591-15" href="#__codelineno-591-15"></a>
</span><span id="__span-591-16"><a id="__codelineno-591-16" name="__codelineno-591-16" href="#__codelineno-591-16"></a><span class="k">foreach</span><span class="w"> </span><span class="p">(</span><span class="kt">char</span><span class="w"> </span><span class="n">c</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">s</span><span class="p">)</span>
</span><span id="__span-591-17"><a id="__codelineno-591-17" name="__codelineno-591-17" href="#__codelineno-591-17"></a><span class="w">    </span><span class="n">Console</span><span class="p">.</span><span class="n">Write</span><span class="w"> </span><span class="p">(</span><span class="n">c</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s">&quot;.&quot;</span><span class="p">);</span>
</span></code></pre></div>
<h3 id="ienumerable-and-ienumerator">IEnumerable<T> and IEnumerator<T></h3>
<p>IEnumerator and IEnumerable are nearly always implemented in conjunction with their extended generic versions</p>
<div class="language-csharp highlight"><pre><span></span><code><span id="__span-592-1"><a id="__codelineno-592-1" name="__codelineno-592-1" href="#__codelineno-592-1"></a><span class="k">public</span><span class="w"> </span><span class="k">interface</span><span class="w"> </span><span class="n">IEnumerator</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="n">IEnumerator</span><span class="p">,</span><span class="w"> </span><span class="n">IDisposable</span>
</span><span id="__span-592-2"><a id="__codelineno-592-2" name="__codelineno-592-2" href="#__codelineno-592-2"></a><span class="p">{</span>
</span><span id="__span-592-3"><a id="__codelineno-592-3" name="__codelineno-592-3" href="#__codelineno-592-3"></a><span class="w"> </span><span class="n">T</span><span class="w"> </span><span class="n">Current</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">get</span><span class="p">;</span><span class="w"> </span><span class="p">}</span>
</span><span id="__span-592-4"><a id="__codelineno-592-4" name="__codelineno-592-4" href="#__codelineno-592-4"></a><span class="p">}</span>
</span><span id="__span-592-5"><a id="__codelineno-592-5" name="__codelineno-592-5" href="#__codelineno-592-5"></a><span class="k">public</span><span class="w"> </span><span class="k">interface</span><span class="w"> </span><span class="n">IEnumerable</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="n">IEnumerable</span>
</span><span id="__span-592-6"><a id="__codelineno-592-6" name="__codelineno-592-6" href="#__codelineno-592-6"></a><span class="p">{</span>
</span><span id="__span-592-7"><a id="__codelineno-592-7" name="__codelineno-592-7" href="#__codelineno-592-7"></a><span class="w"> </span><span class="n">IEnumerator</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span><span class="w"> </span><span class="n">GetEnumerator</span><span class="p">();</span>
</span><span id="__span-592-8"><a id="__codelineno-592-8" name="__codelineno-592-8" href="#__codelineno-592-8"></a><span class="p">}</span>
</span></code></pre></div>
<p>By defining a typed version of Current and GetEnumerator, these interfaces strengthen static type safety, avoid the overhead of boxing with value-type elements, and are more convenient to the consumer. Arrays automatically implement IEnumerable (where T is the member type of the array).</p>
<h3 id="implementing-the-enumeration-interfaces">Implementing the Enumeration Interfaces</h3>
<p>You might want to implement IEnumerable or IEnumerable for one or more of the following reasons</p>
<ul>
<li>To support the foreach statement</li>
<li>To interoperate with anything expecting a standard collection</li>
<li>To meet the requirements of a more sophisticated collection interface</li>
<li>To support collection initializers</li>
</ul>
<h1 id="the-icollection-and-ilist-interfaces">The ICollection and IList Interfaces</h1>
<p>Although the enumeration interfaces provide a protocol for forward-only iteration over a collection, they donâ€™t provide a mechanism to determine the size of the collection, access a member by index, search, or modify the collection. For such functionality, the .NET Framework defines the ICollection, IList, and IDictionary interfaces. Each comes in both generic and nongeneric versions; however, the <strong>nonâ€generic versions exist mostly for legacy support.</strong></p>
<ul>
<li>IEnumerable<T>(and IEnumerable) : Provides minimum functionality (enumeration only)</li>
<li>ICollection<T> (and ICollection) : Provides medium functionality (e.g., the Count property)</li>
<li>IList<T>/IDictionary<K,V> and their nongeneric versions :Provide maximum functionality (including â€œrandomâ€ access by index/key)</li>
</ul>
<p>Itâ€™s rare that youâ€™ll need to implement any of these interfaces. In nearly all cases when you need to write a collection class, you can instead subclass Collection<T>. LINQ provides yet another option that covers many scenarios.</p>
<p>The generic and nongeneric versions differ in ways over and above what you might expect, particularly in the case of ICollection. The reasons for this are mostly historical: because generics came later, the generic interfaces were developed with the benefit of hindsight, leading to a different (and better) choice of members. For this reason, ICollection does not extend ICollection, IList does not extend IList, and IDictionary does not extend IDictionary.</p>
<h3 id="icollection-and-icollection">ICollection<T> and ICollection</h3>
<p>ICollection<T> is the standard interface for countable collections of objects. It provides the ability to determine the size of a collection (Count), determine whether an item exists in the collection (Contains), copy the collection into an array (ToArray), and determine whether the collection is read-only (IsReadOnly). For writable collections, you can also Add, Remove, and Clear items from the collection. And because it extends IEnumerable, it can also be traversed via the foreach statement</p>
<div class="language-csharp highlight"><pre><span></span><code><span id="__span-593-1"><a id="__codelineno-593-1" name="__codelineno-593-1" href="#__codelineno-593-1"></a><span class="k">public</span><span class="w"> </span><span class="k">interface</span><span class="w"> </span><span class="n">ICollection</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="n">IEnumerable</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span><span class="p">,</span><span class="w"> </span><span class="n">IEnumerable</span>
</span><span id="__span-593-2"><a id="__codelineno-593-2" name="__codelineno-593-2" href="#__codelineno-593-2"></a><span class="p">{</span>
</span><span id="__span-593-3"><a id="__codelineno-593-3" name="__codelineno-593-3" href="#__codelineno-593-3"></a><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">Count</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">get</span><span class="p">;</span><span class="w"> </span><span class="p">}</span>
</span><span id="__span-593-4"><a id="__codelineno-593-4" name="__codelineno-593-4" href="#__codelineno-593-4"></a><span class="w"> </span><span class="kt">bool</span><span class="w"> </span><span class="nf">Contains</span><span class="p">(</span><span class="n">T</span><span class="w"> </span><span class="n">item</span><span class="p">);</span>
</span><span id="__span-593-5"><a id="__codelineno-593-5" name="__codelineno-593-5" href="#__codelineno-593-5"></a><span class="w"> </span><span class="k">void</span><span class="w"> </span><span class="nf">CopyTo</span><span class="p">(</span><span class="n">T</span><span class="p">[]</span><span class="w"> </span><span class="n">array</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">arrayIndex</span><span class="p">);</span>
</span><span id="__span-593-6"><a id="__codelineno-593-6" name="__codelineno-593-6" href="#__codelineno-593-6"></a><span class="w"> </span><span class="kt">bool</span><span class="w"> </span><span class="n">IsReadOnly</span><span class="p">{</span><span class="w"> </span><span class="k">get</span><span class="p">;</span><span class="w"> </span><span class="p">}</span>
</span><span id="__span-593-7"><a id="__codelineno-593-7" name="__codelineno-593-7" href="#__codelineno-593-7"></a><span class="w"> </span><span class="k">void</span><span class="w"> </span><span class="nf">Add</span><span class="p">(</span><span class="n">T</span><span class="w"> </span><span class="n">item</span><span class="p">);</span>
</span><span id="__span-593-8"><a id="__codelineno-593-8" name="__codelineno-593-8" href="#__codelineno-593-8"></a><span class="w"> </span><span class="kt">bool</span><span class="w"> </span><span class="nf">Remove</span><span class="p">(</span><span class="n">T</span><span class="w"> </span><span class="n">item</span><span class="p">);</span>
</span><span id="__span-593-9"><a id="__codelineno-593-9" name="__codelineno-593-9" href="#__codelineno-593-9"></a><span class="w"> </span><span class="k">void</span><span class="w"> </span><span class="nf">Clear</span><span class="p">();</span>
</span><span id="__span-593-10"><a id="__codelineno-593-10" name="__codelineno-593-10" href="#__codelineno-593-10"></a><span class="p">}</span>
</span></code></pre></div>
<h3 id="ilist-and-ilist">IList<T> and IList</h3>
<p>IList<T> is the standard interface for collections indexable by position. In addition to the functionality inherited from ICollection and IEnumerable, it provides the ability to read or write an element by position (via an indexer) and insert/remove by position</p>
<div class="language-csharp highlight"><pre><span></span><code><span id="__span-594-1"><a id="__codelineno-594-1" name="__codelineno-594-1" href="#__codelineno-594-1"></a><span class="k">public</span><span class="w"> </span><span class="k">interface</span><span class="w"> </span><span class="n">IList</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="n">ICollection</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span><span class="p">,</span><span class="w"> </span><span class="n">IEnumerable</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span><span class="p">,</span><span class="w"> </span><span class="n">IEnumerable</span>
</span><span id="__span-594-2"><a id="__codelineno-594-2" name="__codelineno-594-2" href="#__codelineno-594-2"></a><span class="p">{</span>
</span><span id="__span-594-3"><a id="__codelineno-594-3" name="__codelineno-594-3" href="#__codelineno-594-3"></a><span class="w"> </span><span class="n">T</span><span class="w"> </span><span class="k">this</span><span class="w"> </span><span class="p">[</span><span class="kt">int</span><span class="w"> </span><span class="n">index</span><span class="p">]</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">get</span><span class="p">;</span><span class="w"> </span><span class="k">set</span><span class="p">;</span><span class="w"> </span><span class="p">}</span>
</span><span id="__span-594-4"><a id="__codelineno-594-4" name="__codelineno-594-4" href="#__codelineno-594-4"></a><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="nf">IndexOf</span><span class="w"> </span><span class="p">(</span><span class="n">T</span><span class="w"> </span><span class="n">item</span><span class="p">);</span>
</span><span id="__span-594-5"><a id="__codelineno-594-5" name="__codelineno-594-5" href="#__codelineno-594-5"></a><span class="w"> </span><span class="k">void</span><span class="w"> </span><span class="nf">Insert</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">index</span><span class="p">,</span><span class="w"> </span><span class="n">T</span><span class="w"> </span><span class="n">item</span><span class="p">);</span>
</span><span id="__span-594-6"><a id="__codelineno-594-6" name="__codelineno-594-6" href="#__codelineno-594-6"></a><span class="w"> </span><span class="k">void</span><span class="w"> </span><span class="nf">RemoveAt</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">index</span><span class="p">);</span>
</span><span id="__span-594-7"><a id="__codelineno-594-7" name="__codelineno-594-7" href="#__codelineno-594-7"></a><span class="p">}</span>
</span></code></pre></div>
<h1 id="the-array-class">The Array Class</h1>
<p>Array implements the collection interfaces up to IList<T> in both their generic and nongeneric forms. IList<T> itself is implemented explicitly, though, to keep Arrayâ€™s public interface clean of methods such as Add or Remove, which throw an exception on fixed-length collections such as arrays. The Array class does actually offer a static Resize method, although this works by creating a new array and then copying over each element. As well as being inefficient, references to the array elsewhere in the program will still point to the original version. A better solution for resizable collections is to use the List class</p>
<p>An array can contain value-type or reference-type elements. Value-type elements are stored in place in the array, so an array of three long integers (each 8 bytes) will occupy 24 bytes of contiguous memory. A reference-type element, however, occupies only as much space in the array as a reference</p>
<div class="language-csharp highlight"><pre><span></span><code><span id="__span-595-1"><a id="__codelineno-595-1" name="__codelineno-595-1" href="#__codelineno-595-1"></a><span class="n">StringBuilder</span><span class="p">[]</span><span class="w"> </span><span class="n">builders</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">StringBuilder</span><span class="w"> </span><span class="p">[</span><span class="mi">5</span><span class="p">];</span>
</span><span id="__span-595-2"><a id="__codelineno-595-2" name="__codelineno-595-2" href="#__codelineno-595-2"></a><span class="n">builders</span><span class="w"> </span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">StringBuilder</span><span class="w"> </span><span class="p">(</span><span class="s">&quot;builder1&quot;</span><span class="p">);</span>
</span><span id="__span-595-3"><a id="__codelineno-595-3" name="__codelineno-595-3" href="#__codelineno-595-3"></a><span class="n">builders</span><span class="w"> </span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">StringBuilder</span><span class="w"> </span><span class="p">(</span><span class="s">&quot;builder2&quot;</span><span class="p">);</span>
</span><span id="__span-595-4"><a id="__codelineno-595-4" name="__codelineno-595-4" href="#__codelineno-595-4"></a><span class="n">builders</span><span class="w"> </span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">StringBuilder</span><span class="w"> </span><span class="p">(</span><span class="s">&quot;builder3&quot;</span><span class="p">);</span>
</span><span id="__span-595-5"><a id="__codelineno-595-5" name="__codelineno-595-5" href="#__codelineno-595-5"></a><span class="kt">long</span><span class="p">[]</span><span class="w"> </span><span class="n">numbers</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="kt">long</span><span class="w"> </span><span class="p">[</span><span class="mi">3</span><span class="p">];</span>
</span><span id="__span-595-6"><a id="__codelineno-595-6" name="__codelineno-595-6" href="#__codelineno-595-6"></a><span class="n">numbers</span><span class="w"> </span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">12345</span><span class="p">;</span>
</span><span id="__span-595-7"><a id="__codelineno-595-7" name="__codelineno-595-7" href="#__codelineno-595-7"></a><span class="n">numbers</span><span class="w"> </span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">54321</span><span class="p">;</span>
</span></code></pre></div>
<p>Because Array is a class, arrays are always (themselves) reference typesâ€”regardless of the arrayâ€™s element type. This means that the statement arrayB = arrayA results in two variables that reference the same array. Similarly, two distinct arrays will always fail an equality test, unless you employ a structural equality comparer, which compares every element of the array</p>
<div class="language-csharp highlight"><pre><span></span><code><span id="__span-596-1"><a id="__codelineno-596-1" name="__codelineno-596-1" href="#__codelineno-596-1"></a><span class="kt">object</span><span class="p">[]</span><span class="w"> </span><span class="n">a1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="s">&quot;string&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">123</span><span class="p">,</span><span class="w"> </span><span class="k">true</span><span class="w"> </span><span class="p">};</span>
</span><span id="__span-596-2"><a id="__codelineno-596-2" name="__codelineno-596-2" href="#__codelineno-596-2"></a><span class="kt">object</span><span class="p">[]</span><span class="w"> </span><span class="n">a2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="s">&quot;string&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">123</span><span class="p">,</span><span class="w"> </span><span class="k">true</span><span class="w"> </span><span class="p">};</span>
</span><span id="__span-596-3"><a id="__codelineno-596-3" name="__codelineno-596-3" href="#__codelineno-596-3"></a><span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="w"> </span><span class="p">(</span><span class="n">a1</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">a2</span><span class="p">);</span><span class="w"> </span><span class="c1">// False</span>
</span><span id="__span-596-4"><a id="__codelineno-596-4" name="__codelineno-596-4" href="#__codelineno-596-4"></a><span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="w"> </span><span class="p">(</span><span class="n">a1</span><span class="p">.</span><span class="n">Equals</span><span class="w"> </span><span class="p">(</span><span class="n">a2</span><span class="p">));</span><span class="w"> </span><span class="c1">// False</span>
</span><span id="__span-596-5"><a id="__codelineno-596-5" name="__codelineno-596-5" href="#__codelineno-596-5"></a><span class="n">IStructuralEquatable</span><span class="w"> </span><span class="n">se1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">a1</span><span class="p">;</span>
</span><span id="__span-596-6"><a id="__codelineno-596-6" name="__codelineno-596-6" href="#__codelineno-596-6"></a><span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="w"> </span><span class="p">(</span><span class="n">se1</span><span class="p">.</span><span class="n">Equals</span><span class="w"> </span><span class="p">(</span><span class="n">a2</span><span class="p">,</span>
</span><span id="__span-596-7"><a id="__codelineno-596-7" name="__codelineno-596-7" href="#__codelineno-596-7"></a><span class="n">StructuralComparisons</span><span class="p">.</span><span class="n">StructuralEqualityComparer</span><span class="p">));</span><span class="w"> </span><span class="c1">// True</span>
</span></code></pre></div>
<p>Arrays can be duplicated by calling the Clone method: arrayB = arrayA.Clone(). However, this results in a shallow clone, meaning that only the memory represented by the array itself is copied. If the array contains value-type objects, the values themselves are copied; if the array contains reference-type objects, just the references are copied (resulting in two arrays whose members reference the same objects).</p>
<div class="language-csharp highlight"><pre><span></span><code><span id="__span-597-1"><a id="__codelineno-597-1" name="__codelineno-597-1" href="#__codelineno-597-1"></a><span class="n">StringBuilder</span><span class="p">[]</span><span class="w"> </span><span class="n">builders2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">builders</span><span class="p">;</span>
</span><span id="__span-597-2"><a id="__codelineno-597-2" name="__codelineno-597-2" href="#__codelineno-597-2"></a><span class="n">StringBuilder</span><span class="p">[]</span><span class="w"> </span><span class="n">shallowClone</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">StringBuilder</span><span class="p">[])</span><span class="w"> </span><span class="n">builders</span><span class="p">.</span><span class="n">Clone</span><span class="p">();</span>
</span></code></pre></div>
<p>To create a deep copyâ€”for which reference type subobjects are duplicatedâ€”you must loop through the array and clone each element manually. The same rules apply to other .NET collection types.</p>
<p>Many of the methods on the Array class that you expect to be instance methods are in fact static methods. This is an odd design decision, and means that you should check for both static and instance methods when looking for a method on Array.</p>
<h3 id="construction-and-indexing">Construction and Indexing</h3>
<div class="language-csharp highlight"><pre><span></span><code><span id="__span-598-1"><a id="__codelineno-598-1" name="__codelineno-598-1" href="#__codelineno-598-1"></a><span class="kt">int</span><span class="p">[]</span><span class="w"> </span><span class="n">myArray</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="mi">3</span><span class="w"> </span><span class="p">};</span>
</span><span id="__span-598-2"><a id="__codelineno-598-2" name="__codelineno-598-2" href="#__codelineno-598-2"></a><span class="kt">int</span><span class="w"> </span><span class="n">first</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">myArray</span><span class="w"> </span><span class="p">[</span><span class="mi">0</span><span class="p">];</span>
</span><span id="__span-598-3"><a id="__codelineno-598-3" name="__codelineno-598-3" href="#__codelineno-598-3"></a><span class="kt">int</span><span class="w"> </span><span class="n">last</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">myArray</span><span class="w"> </span><span class="p">[</span><span class="n">myArray</span><span class="p">.</span><span class="n">Length</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">1</span><span class="p">];</span>
</span></code></pre></div>
<p>Alternatively, you can instantiate an array dynamically by calling <code>Array.Create</code> Instance. This allows you to specify element type and rank (number of dimensions) at runtime as well as allowing nonzero-based arrays through specifying a lower bound. Nonzero-based arrays are not compatible with the .NET Common Language Specification (CLS) and should not be exposed as public members in a library that might be consumed by a program written in F# or Visual Basic.</p>
<div class="language-csharp highlight"><pre><span></span><code><span id="__span-599-1"><a id="__codelineno-599-1" name="__codelineno-599-1" href="#__codelineno-599-1"></a><span class="c1">// Create a string array 2 elements in length:</span>
</span><span id="__span-599-2"><a id="__codelineno-599-2" name="__codelineno-599-2" href="#__codelineno-599-2"></a><span class="w"> </span><span class="n">Array</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Array</span><span class="p">.</span><span class="n">CreateInstance</span><span class="w"> </span><span class="p">(</span><span class="k">typeof</span><span class="p">(</span><span class="kt">string</span><span class="p">),</span><span class="w"> </span><span class="mi">2</span><span class="p">);</span>
</span><span id="__span-599-3"><a id="__codelineno-599-3" name="__codelineno-599-3" href="#__codelineno-599-3"></a><span class="w"> </span><span class="n">a</span><span class="p">.</span><span class="n">SetValue</span><span class="w"> </span><span class="p">(</span><span class="s">&quot;hi&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">);</span><span class="w"> </span><span class="c1">// â†’ a[0] = &quot;hi&quot;;</span>
</span><span id="__span-599-4"><a id="__codelineno-599-4" name="__codelineno-599-4" href="#__codelineno-599-4"></a><span class="w"> </span><span class="n">a</span><span class="p">.</span><span class="n">SetValue</span><span class="w"> </span><span class="p">(</span><span class="s">&quot;there&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">);</span><span class="w"> </span><span class="c1">// â†’ a[1] = &quot;there&quot;;</span>
</span><span id="__span-599-5"><a id="__codelineno-599-5" name="__codelineno-599-5" href="#__codelineno-599-5"></a><span class="w"> </span><span class="kt">string</span><span class="w"> </span><span class="n">s</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="kt">string</span><span class="p">)</span><span class="w"> </span><span class="n">a</span><span class="p">.</span><span class="n">GetValue</span><span class="w"> </span><span class="p">(</span><span class="mi">0</span><span class="p">);</span><span class="w"> </span><span class="c1">// â†’ s = a[0];</span>
</span><span id="__span-599-6"><a id="__codelineno-599-6" name="__codelineno-599-6" href="#__codelineno-599-6"></a><span class="w"> </span><span class="c1">// We can also cast to a C# array as follows:</span>
</span><span id="__span-599-7"><a id="__codelineno-599-7" name="__codelineno-599-7" href="#__codelineno-599-7"></a><span class="w"> </span><span class="kt">string</span><span class="p">[]</span><span class="w"> </span><span class="n">cSharpArray</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="kt">string</span><span class="p">[])</span><span class="w"> </span><span class="n">a</span><span class="p">;</span>
</span><span id="__span-599-8"><a id="__codelineno-599-8" name="__codelineno-599-8" href="#__codelineno-599-8"></a><span class="w"> </span><span class="kt">string</span><span class="w"> </span><span class="n">s2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">cSharpArray</span><span class="w"> </span><span class="p">[</span><span class="mi">0</span><span class="p">];</span>
</span></code></pre></div>
<div class="language-csharp highlight"><pre><span></span><code><span id="__span-600-1"><a id="__codelineno-600-1" name="__codelineno-600-1" href="#__codelineno-600-1"></a><span class="k">void</span><span class="w"> </span><span class="nf">WriteFirstValue</span><span class="w"> </span><span class="p">(</span><span class="n">Array</span><span class="w"> </span><span class="n">a</span><span class="p">)</span>
</span><span id="__span-600-2"><a id="__codelineno-600-2" name="__codelineno-600-2" href="#__codelineno-600-2"></a><span class="w"> </span><span class="p">{</span>
</span><span id="__span-600-3"><a id="__codelineno-600-3" name="__codelineno-600-3" href="#__codelineno-600-3"></a><span class="w"> </span><span class="n">Console</span><span class="p">.</span><span class="n">Write</span><span class="w"> </span><span class="p">(</span><span class="n">a</span><span class="p">.</span><span class="n">Rank</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s">&quot;-dimensional; &quot;</span><span class="p">);</span>
</span><span id="__span-600-4"><a id="__codelineno-600-4" name="__codelineno-600-4" href="#__codelineno-600-4"></a><span class="w"> </span><span class="c1">// The indexers array will automatically initialize to all zeros, so</span>
</span><span id="__span-600-5"><a id="__codelineno-600-5" name="__codelineno-600-5" href="#__codelineno-600-5"></a><span class="w"> </span><span class="c1">// passing it into GetValue or SetValue will get/set the zero-based</span>
</span><span id="__span-600-6"><a id="__codelineno-600-6" name="__codelineno-600-6" href="#__codelineno-600-6"></a><span class="w"> </span><span class="c1">// (i.e., first) element in the array.</span>
</span><span id="__span-600-7"><a id="__codelineno-600-7" name="__codelineno-600-7" href="#__codelineno-600-7"></a><span class="w"> </span><span class="kt">int</span><span class="p">[]</span><span class="w"> </span><span class="n">indexers</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="kt">int</span><span class="p">[</span><span class="n">a</span><span class="p">.</span><span class="n">Rank</span><span class="p">];</span>
</span><span id="__span-600-8"><a id="__codelineno-600-8" name="__codelineno-600-8" href="#__codelineno-600-8"></a><span class="w"> </span><span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="w"> </span><span class="p">(</span><span class="s">&quot;First value is &quot;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">a</span><span class="p">.</span><span class="n">GetValue</span><span class="w"> </span><span class="p">(</span><span class="n">indexers</span><span class="p">));</span>
</span><span id="__span-600-9"><a id="__codelineno-600-9" name="__codelineno-600-9" href="#__codelineno-600-9"></a><span class="w"> </span><span class="p">}</span>
</span><span id="__span-600-10"><a id="__codelineno-600-10" name="__codelineno-600-10" href="#__codelineno-600-10"></a><span class="w"> </span><span class="k">void</span><span class="w"> </span><span class="nf">Demo</span><span class="p">()</span>
</span><span id="__span-600-11"><a id="__codelineno-600-11" name="__codelineno-600-11" href="#__codelineno-600-11"></a><span class="w"> </span><span class="p">{</span>
</span><span id="__span-600-12"><a id="__codelineno-600-12" name="__codelineno-600-12" href="#__codelineno-600-12"></a><span class="w"> </span><span class="kt">int</span><span class="p">[]</span><span class="w"> </span><span class="n">oneD</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="mi">3</span><span class="w"> </span><span class="p">};</span>
</span><span id="__span-600-13"><a id="__codelineno-600-13" name="__codelineno-600-13" href="#__codelineno-600-13"></a><span class="w"> </span><span class="kt">int</span><span class="p">[,]</span><span class="w"> </span><span class="n">twoD</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="p">{</span><span class="mi">5</span><span class="p">,</span><span class="mi">6</span><span class="p">},</span><span class="w"> </span><span class="p">{</span><span class="mi">8</span><span class="p">,</span><span class="mi">9</span><span class="p">}</span><span class="w"> </span><span class="p">};</span>
</span><span id="__span-600-14"><a id="__codelineno-600-14" name="__codelineno-600-14" href="#__codelineno-600-14"></a><span class="w"> </span><span class="n">WriteFirstValue</span><span class="w"> </span><span class="p">(</span><span class="n">oneD</span><span class="p">);</span><span class="w"> </span><span class="c1">// 1-dimensional; first value is 1</span>
</span><span id="__span-600-15"><a id="__codelineno-600-15" name="__codelineno-600-15" href="#__codelineno-600-15"></a><span class="w"> </span><span class="n">WriteFirstValue</span><span class="w"> </span><span class="p">(</span><span class="n">twoD</span><span class="p">);</span><span class="w"> </span><span class="c1">// 2-dimensional; first value is 5</span>
</span><span id="__span-600-16"><a id="__codelineno-600-16" name="__codelineno-600-16" href="#__codelineno-600-16"></a><span class="w"> </span><span class="p">}</span>
</span></code></pre></div>
<h3 id="enumeration_1">Enumeration</h3>
<div class="language-csharp highlight"><pre><span></span><code><span id="__span-601-1"><a id="__codelineno-601-1" name="__codelineno-601-1" href="#__codelineno-601-1"></a><span class="kt">int</span><span class="p">[]</span><span class="w"> </span><span class="n">myArray</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="mi">3</span><span class="w"> </span><span class="p">};</span>
</span><span id="__span-601-2"><a id="__codelineno-601-2" name="__codelineno-601-2" href="#__codelineno-601-2"></a><span class="k">foreach</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">val</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">myArray</span><span class="p">)</span>
</span><span id="__span-601-3"><a id="__codelineno-601-3" name="__codelineno-601-3" href="#__codelineno-601-3"></a><span class="w"> </span><span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="w"> </span><span class="p">(</span><span class="n">val</span><span class="p">);</span>
</span></code></pre></div>
<p>You can also enumerate using the static Array.ForEach method</p>
<div class="language-csharp highlight"><pre><span></span><code><span id="__span-602-1"><a id="__codelineno-602-1" name="__codelineno-602-1" href="#__codelineno-602-1"></a><span class="k">public</span><span class="w"> </span><span class="k">static</span><span class="w"> </span><span class="k">void</span><span class="w"> </span><span class="n">ForEach</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span><span class="w"> </span><span class="p">(</span><span class="n">T</span><span class="p">[]</span><span class="w"> </span><span class="n">array</span><span class="p">,</span><span class="w"> </span><span class="n">Action</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span><span class="w"> </span><span class="n">action</span><span class="p">);</span>
</span><span id="__span-602-2"><a id="__codelineno-602-2" name="__codelineno-602-2" href="#__codelineno-602-2"></a><span class="n">Array</span><span class="p">.</span><span class="n">ForEach</span><span class="w"> </span><span class="p">(</span><span class="k">new</span><span class="p">[]</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="mi">3</span><span class="w"> </span><span class="p">},</span><span class="w"> </span><span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="p">);</span>
</span></code></pre></div>
<h3 id="length-and-rank">Length and Rank</h3>
<p>Array provides the following methods and properties for querying length and rank:</p>
<div class="language-csharp highlight"><pre><span></span><code><span id="__span-603-1"><a id="__codelineno-603-1" name="__codelineno-603-1" href="#__codelineno-603-1"></a><span class="c1">//GetLength and GetLongLength return the length for a given dimension</span>
</span><span id="__span-603-2"><a id="__codelineno-603-2" name="__codelineno-603-2" href="#__codelineno-603-2"></a><span class="k">public</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="nf">GetLength</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">dimension</span><span class="p">);</span>
</span><span id="__span-603-3"><a id="__codelineno-603-3" name="__codelineno-603-3" href="#__codelineno-603-3"></a><span class="k">public</span><span class="w"> </span><span class="kt">long</span><span class="w"> </span><span class="nf">GetLongLength</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">dimension</span><span class="p">);</span>
</span><span id="__span-603-4"><a id="__codelineno-603-4" name="__codelineno-603-4" href="#__codelineno-603-4"></a><span class="k">public</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">Length</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">get</span><span class="p">;</span><span class="w"> </span><span class="p">}</span>
</span><span id="__span-603-5"><a id="__codelineno-603-5" name="__codelineno-603-5" href="#__codelineno-603-5"></a><span class="k">public</span><span class="w"> </span><span class="kt">long</span><span class="w"> </span><span class="n">LongLength</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">get</span><span class="p">;</span><span class="w"> </span><span class="p">}</span>
</span><span id="__span-603-6"><a id="__codelineno-603-6" name="__codelineno-603-6" href="#__codelineno-603-6"></a><span class="c1">//GetLowerBound and GetUpperBound are useful with nonzero-indexed arrays.</span>
</span><span id="__span-603-7"><a id="__codelineno-603-7" name="__codelineno-603-7" href="#__codelineno-603-7"></a><span class="k">public</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="nf">GetLowerBound</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">dimension</span><span class="p">);</span>
</span><span id="__span-603-8"><a id="__codelineno-603-8" name="__codelineno-603-8" href="#__codelineno-603-8"></a><span class="k">public</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="nf">GetUpperBound</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">dimension</span><span class="p">);</span>
</span><span id="__span-603-9"><a id="__codelineno-603-9" name="__codelineno-603-9" href="#__codelineno-603-9"></a><span class="k">public</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">Rank</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">get</span><span class="p">;</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="c1">// Returns number of dimensions in array</span>
</span></code></pre></div>
<h3 id="searching">Searching</h3>
<p>The Array class offers a range of methods for finding elements within a onedimensional array</p>
<ul>
<li>BinarySearch methods : For rapidly searching a sorted array for a particular item</li>
<li>IndexOf/LastIndex methods : For searching unsorted arrays for a particular item</li>
<li>Find/FindLast/FindIndex/FindLastIndex/FindAll/Exists/TrueForAll : For searching unsorted arrays for item(s) that satisfy a given Predicate<T></li>
</ul>
<p>None of the array-searching methods throws an exception if the specified value is not found. Instead, if an item is not found, methods returning an integer return âˆ’1 (assuming a zero-indexed array), and methods returning a generic type return the typeâ€™s default value (e.g., 0 for an int, or null for a string).</p>
<div class="language-csharp highlight"><pre><span></span><code><span id="__span-604-1"><a id="__codelineno-604-1" name="__codelineno-604-1" href="#__codelineno-604-1"></a><span class="k">static</span><span class="w"> </span><span class="k">void</span><span class="w"> </span><span class="nf">Main</span><span class="p">()</span>
</span><span id="__span-604-2"><a id="__codelineno-604-2" name="__codelineno-604-2" href="#__codelineno-604-2"></a><span class="p">{</span>
</span><span id="__span-604-3"><a id="__codelineno-604-3" name="__codelineno-604-3" href="#__codelineno-604-3"></a><span class="w"> </span><span class="kt">string</span><span class="p">[]</span><span class="w"> </span><span class="n">names</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="s">&quot;Rodney&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Jack&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Jill&quot;</span><span class="w"> </span><span class="p">};</span>
</span><span id="__span-604-4"><a id="__codelineno-604-4" name="__codelineno-604-4" href="#__codelineno-604-4"></a><span class="w"> </span><span class="kt">string</span><span class="w"> </span><span class="n">match</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Array</span><span class="p">.</span><span class="n">Find</span><span class="w"> </span><span class="p">(</span><span class="n">names</span><span class="p">,</span><span class="w"> </span><span class="n">ContainsA</span><span class="p">);</span>
</span><span id="__span-604-5"><a id="__codelineno-604-5" name="__codelineno-604-5" href="#__codelineno-604-5"></a><span class="w"> </span><span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="w"> </span><span class="p">(</span><span class="n">match</span><span class="p">);</span><span class="w"> </span><span class="c1">// Jack</span>
</span><span id="__span-604-6"><a id="__codelineno-604-6" name="__codelineno-604-6" href="#__codelineno-604-6"></a><span class="p">}</span>
</span><span id="__span-604-7"><a id="__codelineno-604-7" name="__codelineno-604-7" href="#__codelineno-604-7"></a><span class="k">static</span><span class="w"> </span><span class="kt">bool</span><span class="w"> </span><span class="nf">ContainsA</span><span class="w"> </span><span class="p">(</span><span class="kt">string</span><span class="w"> </span><span class="n">name</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="n">name</span><span class="p">.</span><span class="n">Contains</span><span class="w"> </span><span class="p">(</span><span class="s">&quot;a&quot;</span><span class="p">);</span><span class="w"> </span><span class="p">}</span>
</span></code></pre></div>
<div class="language-csharp highlight"><pre><span></span><code><span id="__span-605-1"><a id="__codelineno-605-1" name="__codelineno-605-1" href="#__codelineno-605-1"></a><span class="c1">//Hereâ€™s the same code shortened with an anonymous method:</span>
</span><span id="__span-605-2"><a id="__codelineno-605-2" name="__codelineno-605-2" href="#__codelineno-605-2"></a><span class="kt">string</span><span class="p">[]</span><span class="w"> </span><span class="n">names</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="s">&quot;Rodney&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Jack&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Jill&quot;</span><span class="w"> </span><span class="p">};</span>
</span><span id="__span-605-3"><a id="__codelineno-605-3" name="__codelineno-605-3" href="#__codelineno-605-3"></a><span class="kt">string</span><span class="w"> </span><span class="n">match</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Array</span><span class="p">.</span><span class="n">Find</span><span class="w"> </span><span class="p">(</span><span class="n">names</span><span class="p">,</span><span class="w"> </span><span class="k">delegate</span><span class="w"> </span><span class="p">(</span><span class="kt">string</span><span class="w"> </span><span class="n">name</span><span class="p">)</span>
</span><span id="__span-605-4"><a id="__codelineno-605-4" name="__codelineno-605-4" href="#__codelineno-605-4"></a><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="n">name</span><span class="p">.</span><span class="n">Contains</span><span class="w"> </span><span class="p">(</span><span class="s">&quot;a&quot;</span><span class="p">);</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="p">);</span>
</span></code></pre></div>
<div class="language-csharp highlight"><pre><span></span><code><span id="__span-606-1"><a id="__codelineno-606-1" name="__codelineno-606-1" href="#__codelineno-606-1"></a><span class="c1">//A lambda expression shortens it further:</span>
</span><span id="__span-606-2"><a id="__codelineno-606-2" name="__codelineno-606-2" href="#__codelineno-606-2"></a><span class="kt">string</span><span class="p">[]</span><span class="w"> </span><span class="n">names</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="s">&quot;Rodney&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Jack&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Jill&quot;</span><span class="w"> </span><span class="p">};</span>
</span><span id="__span-606-3"><a id="__codelineno-606-3" name="__codelineno-606-3" href="#__codelineno-606-3"></a><span class="kt">string</span><span class="w"> </span><span class="n">match</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Array</span><span class="p">.</span><span class="n">Find</span><span class="w"> </span><span class="p">(</span><span class="n">names</span><span class="p">,</span><span class="w"> </span><span class="n">n</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="n">n</span><span class="p">.</span><span class="n">Contains</span><span class="w"> </span><span class="p">(</span><span class="s">&quot;a&quot;</span><span class="p">));</span><span class="w"> </span><span class="c1">// Jack</span>
</span><span id="__span-606-4"><a id="__codelineno-606-4" name="__codelineno-606-4" href="#__codelineno-606-4"></a><span class="kt">string</span><span class="p">[]</span><span class="w"> </span><span class="n">match</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Array</span><span class="p">.</span><span class="n">FindAll</span><span class="w"> </span><span class="p">(</span><span class="n">names</span><span class="p">,</span><span class="w"> </span><span class="n">n</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="n">n</span><span class="p">.</span><span class="n">Contains</span><span class="w"> </span><span class="p">(</span><span class="s">&quot;a&quot;</span><span class="p">))</span>
</span></code></pre></div>
<h3 id="sorting">Sorting</h3>
<div class="language-csharp highlight"><pre><span></span><code><span id="__span-607-1"><a id="__codelineno-607-1" name="__codelineno-607-1" href="#__codelineno-607-1"></a><span class="c1">// For sorting a single array:</span>
</span><span id="__span-607-2"><a id="__codelineno-607-2" name="__codelineno-607-2" href="#__codelineno-607-2"></a><span class="kt">int</span><span class="p">[]</span><span class="w"> </span><span class="n">numbers</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="mi">3</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="p">};</span>
</span><span id="__span-607-3"><a id="__codelineno-607-3" name="__codelineno-607-3" href="#__codelineno-607-3"></a><span class="n">Array</span><span class="p">.</span><span class="n">Sort</span><span class="w"> </span><span class="p">(</span><span class="n">numbers</span><span class="p">);</span><span class="w"> </span><span class="c1">// Array is now { 1, 2, 3 }</span>
</span><span id="__span-607-4"><a id="__codelineno-607-4" name="__codelineno-607-4" href="#__codelineno-607-4"></a>
</span><span id="__span-607-5"><a id="__codelineno-607-5" name="__codelineno-607-5" href="#__codelineno-607-5"></a><span class="c1">// For sorting a pair of arrays:</span>
</span><span id="__span-607-6"><a id="__codelineno-607-6" name="__codelineno-607-6" href="#__codelineno-607-6"></a><span class="kt">int</span><span class="p">[]</span><span class="w"> </span><span class="n">numbers</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="mi">3</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="p">};</span>
</span><span id="__span-607-7"><a id="__codelineno-607-7" name="__codelineno-607-7" href="#__codelineno-607-7"></a><span class="kt">string</span><span class="p">[]</span><span class="w"> </span><span class="n">words</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="s">&quot;three&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;two&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;one&quot;</span><span class="w"> </span><span class="p">};</span>
</span><span id="__span-607-8"><a id="__codelineno-607-8" name="__codelineno-607-8" href="#__codelineno-607-8"></a><span class="n">Array</span><span class="p">.</span><span class="n">Sort</span><span class="w"> </span><span class="p">(</span><span class="n">numbers</span><span class="p">,</span><span class="w"> </span><span class="n">words</span><span class="p">);</span>
</span><span id="__span-607-9"><a id="__codelineno-607-9" name="__codelineno-607-9" href="#__codelineno-607-9"></a>
</span><span id="__span-607-10"><a id="__codelineno-607-10" name="__codelineno-607-10" href="#__codelineno-607-10"></a><span class="c1">// numbers array is now { 1, 2, 3 }</span>
</span><span id="__span-607-11"><a id="__codelineno-607-11" name="__codelineno-607-11" href="#__codelineno-607-11"></a><span class="c1">// words array is now { &quot;one&quot;, &quot;two&quot;, &quot;three&quot; }</span>
</span><span id="__span-607-12"><a id="__codelineno-607-12" name="__codelineno-607-12" href="#__codelineno-607-12"></a>
</span><span id="__span-607-13"><a id="__codelineno-607-13" name="__codelineno-607-13" href="#__codelineno-607-13"></a><span class="c1">// Sort such that odd numbers come first:</span>
</span><span id="__span-607-14"><a id="__codelineno-607-14" name="__codelineno-607-14" href="#__codelineno-607-14"></a><span class="kt">int</span><span class="p">[]</span><span class="w"> </span><span class="n">numbers</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="mi">3</span><span class="p">,</span><span class="w"> </span><span class="mi">4</span><span class="p">,</span><span class="w"> </span><span class="mi">5</span><span class="w"> </span><span class="p">};</span>
</span><span id="__span-607-15"><a id="__codelineno-607-15" name="__codelineno-607-15" href="#__codelineno-607-15"></a><span class="n">Array</span><span class="p">.</span><span class="n">Sort</span><span class="w"> </span><span class="p">(</span><span class="n">numbers</span><span class="p">,</span><span class="w"> </span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="p">)</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">%</span><span class="w"> </span><span class="mi">2</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">y</span><span class="w"> </span><span class="o">%</span><span class="w"> </span><span class="mi">2</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">%</span><span class="w"> </span><span class="mi">2</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="o">-</span><span class="mi">1</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="p">);</span>
</span></code></pre></div>
<h3 id="reversing-elements">Reversing Elements</h3>
<div class="language-csharp highlight"><pre><span></span><code><span id="__span-608-1"><a id="__codelineno-608-1" name="__codelineno-608-1" href="#__codelineno-608-1"></a><span class="k">public</span><span class="w"> </span><span class="k">static</span><span class="w"> </span><span class="k">void</span><span class="w"> </span><span class="nf">Reverse</span><span class="w"> </span><span class="p">(</span><span class="n">Array</span><span class="w"> </span><span class="n">array</span><span class="p">);</span>
</span><span id="__span-608-2"><a id="__codelineno-608-2" name="__codelineno-608-2" href="#__codelineno-608-2"></a><span class="k">public</span><span class="w"> </span><span class="k">static</span><span class="w"> </span><span class="k">void</span><span class="w"> </span><span class="nf">Reverse</span><span class="w"> </span><span class="p">(</span><span class="n">Array</span><span class="w"> </span><span class="n">array</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">index</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">length</span><span class="p">);</span>
</span></code></pre></div>
<h3 id="copying">Copying</h3>
<ul>
<li>Clone<ul>
<li>returns a whole new (shallow-copied) array</li>
</ul>
</li>
<li>CopyTo and Copy<ul>
<li>copy a contiguous subset of the array</li>
<li>Copying a multidimensional rectangular array requires you to map the multidimensional index to a linear index.</li>
</ul>
</li>
<li>ConstrainedCopy<ul>
<li>performs an atomic operation: if all of the requested elements
cannot be successfully copied (due to a type error, for instance), the operation is rolled back</li>
</ul>
</li>
</ul>
<h3 id="converting-and-resizing">Converting and Resizing</h3>
<p>Array.ConvertAll creates and returns a new array of element type TOutput, calling the supplied Converter delegate to copy over the elements. Converter is defined as follows</p>
<div class="language-csharp highlight"><pre><span></span><code><span id="__span-609-1"><a id="__codelineno-609-1" name="__codelineno-609-1" href="#__codelineno-609-1"></a><span class="kt">float</span><span class="p">[]</span><span class="w"> </span><span class="n">reals</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="mf">1.3f</span><span class="p">,</span><span class="w"> </span><span class="mf">1.5f</span><span class="p">,</span><span class="w"> </span><span class="mf">1.8f</span><span class="w"> </span><span class="p">};</span>
</span><span id="__span-609-2"><a id="__codelineno-609-2" name="__codelineno-609-2" href="#__codelineno-609-2"></a><span class="kt">int</span><span class="p">[]</span><span class="w"> </span><span class="n">wholes</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Array</span><span class="p">.</span><span class="n">ConvertAll</span><span class="w"> </span><span class="p">(</span><span class="n">reals</span><span class="p">,</span><span class="w"> </span><span class="n">r</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="n">Convert</span><span class="p">.</span><span class="n">ToInt32</span><span class="w"> </span><span class="p">(</span><span class="n">r</span><span class="p">));</span>
</span><span id="__span-609-3"><a id="__codelineno-609-3" name="__codelineno-609-3" href="#__codelineno-609-3"></a><span class="c1">// wholes array is { 1, 2, 2 }</span>
</span></code></pre></div>
<h1 id="lists-queues-stacks-and-sets">Lists, Queues, Stacks, and Sets</h1>
<p>.NET Core provides a basic set of concrete collection classes that implement the interfaces described in this chapter. This section concentrates on the list-like collections.</p>
<h3 id="list-and-arraylist">List<T> and ArrayList</h3>
<p>The generic List and nongeneric ArrayList classes provide a dynamically sized array of objects and are among the most commonly used of the collection classes. ArrayList implements IList, whereas List implements both IList and IList<T> . All interfaces are implemented publicly, and methods such as Add and Remove are exposed and work as you would expect.</p>
<p>Internally, List and ArrayList work by maintaining an internal array of objects, replaced with a larger array upon reaching capacity. Appending elements is efficient (because there is usually a free slot at the end), but inserting elements can be slow (because all elements after the insertion point must be shifted to make a free slot), as can removing elements (especially near the start). As with arrays, searching is efficient if the BinarySearch method is used on a list that has been sorted, but it is
otherwise inefficient because each item must be individually checked.</p>
<p>List is up to several times faster than ArrayList if T is a value type, because List avoids the overhead of boxing and unboxing elements.</p>
<div class="language-csharp highlight"><pre><span></span><code><span id="__span-610-1"><a id="__codelineno-610-1" name="__codelineno-610-1" href="#__codelineno-610-1"></a><span class="n">List</span><span class="o">&lt;</span><span class="kt">string</span><span class="o">&gt;</span><span class="w"> </span><span class="n">words</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">List</span><span class="o">&lt;</span><span class="kt">string</span><span class="o">&gt;</span><span class="p">();</span><span class="w">    </span><span class="c1">// New string-typed list</span>
</span><span id="__span-610-2"><a id="__codelineno-610-2" name="__codelineno-610-2" href="#__codelineno-610-2"></a>
</span><span id="__span-610-3"><a id="__codelineno-610-3" name="__codelineno-610-3" href="#__codelineno-610-3"></a><span class="n">words</span><span class="p">.</span><span class="n">Add</span><span class="w"> </span><span class="p">(</span><span class="s">&quot;melon&quot;</span><span class="p">);</span>
</span><span id="__span-610-4"><a id="__codelineno-610-4" name="__codelineno-610-4" href="#__codelineno-610-4"></a><span class="n">words</span><span class="p">.</span><span class="n">Add</span><span class="w"> </span><span class="p">(</span><span class="s">&quot;avocado&quot;</span><span class="p">);</span>
</span><span id="__span-610-5"><a id="__codelineno-610-5" name="__codelineno-610-5" href="#__codelineno-610-5"></a><span class="n">words</span><span class="p">.</span><span class="n">AddRange</span><span class="w"> </span><span class="p">(</span><span class="k">new</span><span class="p">[]</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="s">&quot;banana&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;plum&quot;</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="p">);</span>
</span><span id="__span-610-6"><a id="__codelineno-610-6" name="__codelineno-610-6" href="#__codelineno-610-6"></a><span class="n">words</span><span class="p">.</span><span class="n">Insert</span><span class="w"> </span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;lemon&quot;</span><span class="p">);</span><span class="w">                           </span><span class="c1">// Insert at start</span>
</span><span id="__span-610-7"><a id="__codelineno-610-7" name="__codelineno-610-7" href="#__codelineno-610-7"></a><span class="n">words</span><span class="p">.</span><span class="n">InsertRange</span><span class="w"> </span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="k">new</span><span class="p">[]</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="s">&quot;peach&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;nashi&quot;</span><span class="w"> </span><span class="p">});</span><span class="w">   </span><span class="c1">// Insert at start</span>
</span><span id="__span-610-8"><a id="__codelineno-610-8" name="__codelineno-610-8" href="#__codelineno-610-8"></a>
</span><span id="__span-610-9"><a id="__codelineno-610-9" name="__codelineno-610-9" href="#__codelineno-610-9"></a><span class="n">words</span><span class="p">.</span><span class="n">Remove</span><span class="w"> </span><span class="p">(</span><span class="s">&quot;melon&quot;</span><span class="p">);</span>
</span><span id="__span-610-10"><a id="__codelineno-610-10" name="__codelineno-610-10" href="#__codelineno-610-10"></a><span class="n">words</span><span class="p">.</span><span class="n">RemoveAt</span><span class="w"> </span><span class="p">(</span><span class="mi">3</span><span class="p">);</span><span class="w">                         </span><span class="c1">// Remove the 4th element</span>
</span><span id="__span-610-11"><a id="__codelineno-610-11" name="__codelineno-610-11" href="#__codelineno-610-11"></a><span class="n">words</span><span class="p">.</span><span class="n">RemoveRange</span><span class="w"> </span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">);</span><span class="w">                   </span><span class="c1">// Remove first 2 elements</span>
</span><span id="__span-610-12"><a id="__codelineno-610-12" name="__codelineno-610-12" href="#__codelineno-610-12"></a>
</span><span id="__span-610-13"><a id="__codelineno-610-13" name="__codelineno-610-13" href="#__codelineno-610-13"></a><span class="c1">// Remove all strings starting in &#39;n&#39;:</span>
</span><span id="__span-610-14"><a id="__codelineno-610-14" name="__codelineno-610-14" href="#__codelineno-610-14"></a><span class="n">words</span><span class="p">.</span><span class="n">RemoveAll</span><span class="w"> </span><span class="p">(</span><span class="n">s</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="n">s</span><span class="p">.</span><span class="n">StartsWith</span><span class="w"> </span><span class="p">(</span><span class="s">&quot;n&quot;</span><span class="p">));</span>
</span><span id="__span-610-15"><a id="__codelineno-610-15" name="__codelineno-610-15" href="#__codelineno-610-15"></a>
</span><span id="__span-610-16"><a id="__codelineno-610-16" name="__codelineno-610-16" href="#__codelineno-610-16"></a><span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="w"> </span><span class="p">(</span><span class="n">words</span><span class="w"> </span><span class="p">[</span><span class="mi">0</span><span class="p">]);</span><span class="w">                          </span><span class="c1">// first word</span>
</span><span id="__span-610-17"><a id="__codelineno-610-17" name="__codelineno-610-17" href="#__codelineno-610-17"></a><span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="w"> </span><span class="p">(</span><span class="n">words</span><span class="w"> </span><span class="p">[</span><span class="n">words</span><span class="p">.</span><span class="n">Count</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">1</span><span class="p">]);</span><span class="w">            </span><span class="c1">// last word</span>
</span><span id="__span-610-18"><a id="__codelineno-610-18" name="__codelineno-610-18" href="#__codelineno-610-18"></a><span class="k">foreach</span><span class="w"> </span><span class="p">(</span><span class="kt">string</span><span class="w"> </span><span class="n">s</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">words</span><span class="p">)</span><span class="w"> </span><span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="w"> </span><span class="p">(</span><span class="n">s</span><span class="p">);</span><span class="w">      </span><span class="c1">// all words</span>
</span><span id="__span-610-19"><a id="__codelineno-610-19" name="__codelineno-610-19" href="#__codelineno-610-19"></a><span class="n">List</span><span class="o">&lt;</span><span class="kt">string</span><span class="o">&gt;</span><span class="w"> </span><span class="n">subset</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">words</span><span class="p">.</span><span class="n">GetRange</span><span class="w"> </span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">);</span><span class="w">            </span><span class="c1">// 2nd-&gt;3rd words</span>
</span><span id="__span-610-20"><a id="__codelineno-610-20" name="__codelineno-610-20" href="#__codelineno-610-20"></a>
</span><span id="__span-610-21"><a id="__codelineno-610-21" name="__codelineno-610-21" href="#__codelineno-610-21"></a><span class="kt">string</span><span class="p">[]</span><span class="w"> </span><span class="n">wordsArray</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">words</span><span class="p">.</span><span class="n">ToArray</span><span class="p">();</span><span class="w">    </span><span class="c1">// Creates a new typed array</span>
</span><span id="__span-610-22"><a id="__codelineno-610-22" name="__codelineno-610-22" href="#__codelineno-610-22"></a>
</span><span id="__span-610-23"><a id="__codelineno-610-23" name="__codelineno-610-23" href="#__codelineno-610-23"></a><span class="c1">// Copy first two elements to the end of an existing array:</span>
</span><span id="__span-610-24"><a id="__codelineno-610-24" name="__codelineno-610-24" href="#__codelineno-610-24"></a><span class="kt">string</span><span class="p">[]</span><span class="w"> </span><span class="n">existing</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="kt">string</span><span class="w"> </span><span class="p">[</span><span class="mi">1000</span><span class="p">];</span>
</span><span id="__span-610-25"><a id="__codelineno-610-25" name="__codelineno-610-25" href="#__codelineno-610-25"></a><span class="n">words</span><span class="p">.</span><span class="n">CopyTo</span><span class="w"> </span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="n">existing</span><span class="p">,</span><span class="w"> </span><span class="mi">998</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">);</span>
</span><span id="__span-610-26"><a id="__codelineno-610-26" name="__codelineno-610-26" href="#__codelineno-610-26"></a>
</span><span id="__span-610-27"><a id="__codelineno-610-27" name="__codelineno-610-27" href="#__codelineno-610-27"></a><span class="n">List</span><span class="o">&lt;</span><span class="kt">string</span><span class="o">&gt;</span><span class="w"> </span><span class="n">upperCaseWords</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">words</span><span class="p">.</span><span class="n">ConvertAll</span><span class="w"> </span><span class="p">(</span><span class="n">s</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="n">s</span><span class="p">.</span><span class="n">ToUpper</span><span class="p">());</span>
</span><span id="__span-610-28"><a id="__codelineno-610-28" name="__codelineno-610-28" href="#__codelineno-610-28"></a><span class="n">List</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span><span class="w"> </span><span class="n">lengths</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">words</span><span class="p">.</span><span class="n">ConvertAll</span><span class="w"> </span><span class="p">(</span><span class="n">s</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="n">s</span><span class="p">.</span><span class="n">Length</span><span class="p">);</span>
</span></code></pre></div>
<h3 id="linkedlist">LinkedList<T></h3>
<p>LinkedList<T> is a generic doubly linked list. A doubly linked list is a chain of nodes in which each references the node before, the node after, and the actual element. Its main benefit is that an element can always be inserted efficiently anywhere in the list because it just involves creating a new node and updating a few references. However, finding where to insert the node in the first place can be slow because thereâ€™s no intrinsic mechanism to index directly into a linked list; each node must be traversed, and binary-chop searches are not possible.</p>
<div class="language-csharp highlight"><pre><span></span><code><span id="__span-611-1"><a id="__codelineno-611-1" name="__codelineno-611-1" href="#__codelineno-611-1"></a><span class="kt">var</span><span class="w"> </span><span class="n">tune</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">LinkedList</span><span class="o">&lt;</span><span class="kt">string</span><span class="o">&gt;</span><span class="p">();</span>
</span><span id="__span-611-2"><a id="__codelineno-611-2" name="__codelineno-611-2" href="#__codelineno-611-2"></a><span class="n">tune</span><span class="p">.</span><span class="n">AddFirst</span><span class="w"> </span><span class="p">(</span><span class="s">&quot;do&quot;</span><span class="p">);</span><span class="w">                           </span><span class="n">tune</span><span class="p">.</span><span class="n">Dump</span><span class="p">();</span><span class="w"> </span><span class="c1">// do</span>
</span><span id="__span-611-3"><a id="__codelineno-611-3" name="__codelineno-611-3" href="#__codelineno-611-3"></a><span class="n">tune</span><span class="p">.</span><span class="n">AddLast</span><span class="w"> </span><span class="p">(</span><span class="s">&quot;so&quot;</span><span class="p">);</span><span class="w">                            </span><span class="n">tune</span><span class="p">.</span><span class="n">Dump</span><span class="p">();</span><span class="w"> </span><span class="c1">// do - so</span>
</span><span id="__span-611-4"><a id="__codelineno-611-4" name="__codelineno-611-4" href="#__codelineno-611-4"></a>
</span><span id="__span-611-5"><a id="__codelineno-611-5" name="__codelineno-611-5" href="#__codelineno-611-5"></a><span class="n">tune</span><span class="p">.</span><span class="n">AddAfter</span><span class="w"> </span><span class="p">(</span><span class="n">tune</span><span class="p">.</span><span class="n">First</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;re&quot;</span><span class="p">);</span><span class="w">               </span><span class="n">tune</span><span class="p">.</span><span class="n">Dump</span><span class="p">();</span><span class="w"> </span><span class="c1">// do - re- so</span>
</span><span id="__span-611-6"><a id="__codelineno-611-6" name="__codelineno-611-6" href="#__codelineno-611-6"></a><span class="n">tune</span><span class="p">.</span><span class="n">AddAfter</span><span class="w"> </span><span class="p">(</span><span class="n">tune</span><span class="p">.</span><span class="n">First</span><span class="p">.</span><span class="n">Next</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;mi&quot;</span><span class="p">);</span><span class="w">          </span><span class="n">tune</span><span class="p">.</span><span class="n">Dump</span><span class="p">();</span><span class="w"> </span><span class="c1">// do - re - mi- so</span>
</span><span id="__span-611-7"><a id="__codelineno-611-7" name="__codelineno-611-7" href="#__codelineno-611-7"></a><span class="n">tune</span><span class="p">.</span><span class="n">AddBefore</span><span class="w"> </span><span class="p">(</span><span class="n">tune</span><span class="p">.</span><span class="n">Last</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;fa&quot;</span><span class="p">);</span><span class="w">               </span><span class="n">tune</span><span class="p">.</span><span class="n">Dump</span><span class="p">();</span><span class="w"> </span><span class="c1">// do - re - mi - fa- so</span>
</span><span id="__span-611-8"><a id="__codelineno-611-8" name="__codelineno-611-8" href="#__codelineno-611-8"></a>
</span><span id="__span-611-9"><a id="__codelineno-611-9" name="__codelineno-611-9" href="#__codelineno-611-9"></a><span class="n">tune</span><span class="p">.</span><span class="n">RemoveFirst</span><span class="p">();</span><span class="w">                             </span><span class="n">tune</span><span class="p">.</span><span class="n">Dump</span><span class="p">();</span><span class="w"> </span><span class="c1">// re - mi - fa - so</span>
</span><span id="__span-611-10"><a id="__codelineno-611-10" name="__codelineno-611-10" href="#__codelineno-611-10"></a><span class="n">tune</span><span class="p">.</span><span class="n">RemoveLast</span><span class="p">();</span><span class="w">                              </span><span class="n">tune</span><span class="p">.</span><span class="n">Dump</span><span class="p">();</span><span class="w"> </span><span class="c1">// re - mi - fa</span>
</span><span id="__span-611-11"><a id="__codelineno-611-11" name="__codelineno-611-11" href="#__codelineno-611-11"></a>
</span><span id="__span-611-12"><a id="__codelineno-611-12" name="__codelineno-611-12" href="#__codelineno-611-12"></a><span class="n">LinkedListNode</span><span class="o">&lt;</span><span class="kt">string</span><span class="o">&gt;</span><span class="w"> </span><span class="n">miNode</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">tune</span><span class="p">.</span><span class="n">Find</span><span class="w"> </span><span class="p">(</span><span class="s">&quot;mi&quot;</span><span class="p">);</span>
</span><span id="__span-611-13"><a id="__codelineno-611-13" name="__codelineno-611-13" href="#__codelineno-611-13"></a><span class="n">tune</span><span class="p">.</span><span class="n">Remove</span><span class="w"> </span><span class="p">(</span><span class="n">miNode</span><span class="p">);</span><span class="w">                           </span><span class="n">tune</span><span class="p">.</span><span class="n">Dump</span><span class="p">();</span><span class="w"> </span><span class="c1">// re - fa</span>
</span><span id="__span-611-14"><a id="__codelineno-611-14" name="__codelineno-611-14" href="#__codelineno-611-14"></a><span class="n">tune</span><span class="p">.</span><span class="n">AddFirst</span><span class="w"> </span><span class="p">(</span><span class="n">miNode</span><span class="p">);</span><span class="w">                         </span><span class="n">tune</span><span class="p">.</span><span class="n">Dump</span><span class="p">();</span><span class="w"> </span><span class="c1">// mi- re - fa</span>
</span></code></pre></div>
<h1 id="queue-and-queue">Queue<T> and Queue</h1>
<p>Queue and Queue are first-in, first-out (FIFO) data structures, providing methods to Enqueue (add an item to the tail of the queue) and Dequeue (retrieve and remove the item at the head of the queue). A Peek method is also provided to return the element at the head of the queue without removing it, and there is a Count property (useful in checking that elements are present before dequeuing).</p>
<div class="language-csharp highlight"><pre><span></span><code><span id="__span-612-1"><a id="__codelineno-612-1" name="__codelineno-612-1" href="#__codelineno-612-1"></a><span class="kt">var</span><span class="w"> </span><span class="n">q</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">Queue</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span><span class="p">();</span>
</span><span id="__span-612-2"><a id="__codelineno-612-2" name="__codelineno-612-2" href="#__codelineno-612-2"></a><span class="n">q</span><span class="p">.</span><span class="n">Enqueue</span><span class="w"> </span><span class="p">(</span><span class="mi">10</span><span class="p">);</span>
</span><span id="__span-612-3"><a id="__codelineno-612-3" name="__codelineno-612-3" href="#__codelineno-612-3"></a><span class="n">q</span><span class="p">.</span><span class="n">Enqueue</span><span class="w"> </span><span class="p">(</span><span class="mi">20</span><span class="p">);</span>
</span><span id="__span-612-4"><a id="__codelineno-612-4" name="__codelineno-612-4" href="#__codelineno-612-4"></a><span class="kt">int</span><span class="p">[]</span><span class="w"> </span><span class="n">data</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">q</span><span class="p">.</span><span class="n">ToArray</span><span class="p">();</span><span class="w">         </span><span class="c1">// Exports to an array</span>
</span><span id="__span-612-5"><a id="__codelineno-612-5" name="__codelineno-612-5" href="#__codelineno-612-5"></a><span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="w"> </span><span class="p">(</span><span class="n">q</span><span class="p">.</span><span class="n">Count</span><span class="p">);</span><span class="w">      </span><span class="c1">// &quot;2&quot;</span>
</span><span id="__span-612-6"><a id="__codelineno-612-6" name="__codelineno-612-6" href="#__codelineno-612-6"></a><span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="w"> </span><span class="p">(</span><span class="n">q</span><span class="p">.</span><span class="n">Peek</span><span class="p">());</span><span class="w">     </span><span class="c1">// &quot;10&quot;</span>
</span><span id="__span-612-7"><a id="__codelineno-612-7" name="__codelineno-612-7" href="#__codelineno-612-7"></a><span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="w"> </span><span class="p">(</span><span class="n">q</span><span class="p">.</span><span class="n">Dequeue</span><span class="p">());</span><span class="w">  </span><span class="c1">// &quot;10&quot;</span>
</span><span id="__span-612-8"><a id="__codelineno-612-8" name="__codelineno-612-8" href="#__codelineno-612-8"></a><span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="w"> </span><span class="p">(</span><span class="n">q</span><span class="p">.</span><span class="n">Dequeue</span><span class="p">());</span><span class="w">  </span><span class="c1">// &quot;20&quot;</span>
</span><span id="__span-612-9"><a id="__codelineno-612-9" name="__codelineno-612-9" href="#__codelineno-612-9"></a><span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="w"> </span><span class="p">(</span><span class="n">q</span><span class="p">.</span><span class="n">Dequeue</span><span class="p">());</span><span class="w">  </span><span class="c1">// throws an exception (queue empty)</span>
</span></code></pre></div>
<h1 id="stack-and-stack">Stack<T> and Stack</h1>
<p>Stack<T> and Stack are last-in, first-out (LIFO) data structures, providing methods to Push (add an item to the top of the stack) and Pop (retrieve and remove an element from the top of the stack). A nondestructive Peek method is also provided, as is a Count property and a ToArray method for exporting the data for random access:</p>
<div class="language-csharp highlight"><pre><span></span><code><span id="__span-613-1"><a id="__codelineno-613-1" name="__codelineno-613-1" href="#__codelineno-613-1"></a><span class="c1">//The following example demonstrates Stack&lt;int&gt;:</span>
</span><span id="__span-613-2"><a id="__codelineno-613-2" name="__codelineno-613-2" href="#__codelineno-613-2"></a><span class="kt">var</span><span class="w"> </span><span class="n">s</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">Stack</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span><span class="p">();</span>
</span><span id="__span-613-3"><a id="__codelineno-613-3" name="__codelineno-613-3" href="#__codelineno-613-3"></a><span class="n">s</span><span class="p">.</span><span class="n">Push</span><span class="w"> </span><span class="p">(</span><span class="mi">1</span><span class="p">);</span><span class="w"> </span><span class="c1">// Stack = 1</span>
</span><span id="__span-613-4"><a id="__codelineno-613-4" name="__codelineno-613-4" href="#__codelineno-613-4"></a><span class="n">s</span><span class="p">.</span><span class="n">Push</span><span class="w"> </span><span class="p">(</span><span class="mi">2</span><span class="p">);</span><span class="w"> </span><span class="c1">// Stack = 1,2</span>
</span><span id="__span-613-5"><a id="__codelineno-613-5" name="__codelineno-613-5" href="#__codelineno-613-5"></a><span class="n">s</span><span class="p">.</span><span class="n">Push</span><span class="w"> </span><span class="p">(</span><span class="mi">3</span><span class="p">);</span><span class="w"> </span><span class="c1">// Stack = 1,2,3</span>
</span><span id="__span-613-6"><a id="__codelineno-613-6" name="__codelineno-613-6" href="#__codelineno-613-6"></a><span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="w"> </span><span class="p">(</span><span class="n">s</span><span class="p">.</span><span class="n">Count</span><span class="p">);</span><span class="w"> </span><span class="c1">// Prints 3</span>
</span><span id="__span-613-7"><a id="__codelineno-613-7" name="__codelineno-613-7" href="#__codelineno-613-7"></a><span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="w"> </span><span class="p">(</span><span class="n">s</span><span class="p">.</span><span class="n">Peek</span><span class="p">());</span><span class="w"> </span><span class="c1">// Prints 3, Stack = 1,2,3</span>
</span><span id="__span-613-8"><a id="__codelineno-613-8" name="__codelineno-613-8" href="#__codelineno-613-8"></a><span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="w"> </span><span class="p">(</span><span class="n">s</span><span class="p">.</span><span class="n">Pop</span><span class="p">());</span><span class="w"> </span><span class="c1">// Prints 3, Stack = 1,2</span>
</span><span id="__span-613-9"><a id="__codelineno-613-9" name="__codelineno-613-9" href="#__codelineno-613-9"></a><span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="w"> </span><span class="p">(</span><span class="n">s</span><span class="p">.</span><span class="n">Pop</span><span class="p">());</span><span class="w"> </span><span class="c1">// Prints 2, Stack = 1</span>
</span><span id="__span-613-10"><a id="__codelineno-613-10" name="__codelineno-613-10" href="#__codelineno-613-10"></a><span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="w"> </span><span class="p">(</span><span class="n">s</span><span class="p">.</span><span class="n">Pop</span><span class="p">());</span><span class="w"> </span><span class="c1">// Prints 1, Stack = &lt;empty&gt;</span>
</span><span id="__span-613-11"><a id="__codelineno-613-11" name="__codelineno-613-11" href="#__codelineno-613-11"></a><span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="w"> </span><span class="p">(</span><span class="n">s</span><span class="p">.</span><span class="n">Pop</span><span class="p">());</span><span class="w"> </span><span class="c1">// Throws exception</span>
</span></code></pre></div>
<h1 id="bitarray">BitArray</h1>
<p>A BitArray is a dynamically sized collection of compacted bool values. It is more memory efficient than both a simple array of bool and a generic List of bool because it uses only one bit for each value, whereas the bool type otherwise occupies one byte for each value.</p>
<div class="language-csharp highlight"><pre><span></span><code><span id="__span-614-1"><a id="__codelineno-614-1" name="__codelineno-614-1" href="#__codelineno-614-1"></a><span class="kt">var</span><span class="w"> </span><span class="n">bits</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">BitArray</span><span class="p">(</span><span class="mi">2</span><span class="p">);</span>
</span><span id="__span-614-2"><a id="__codelineno-614-2" name="__codelineno-614-2" href="#__codelineno-614-2"></a><span class="n">bits</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">true</span><span class="p">;</span>
</span><span id="__span-614-3"><a id="__codelineno-614-3" name="__codelineno-614-3" href="#__codelineno-614-3"></a><span class="n">bits</span><span class="p">.</span><span class="n">Xor</span><span class="w"> </span><span class="p">(</span><span class="n">bits</span><span class="p">);</span><span class="w">               </span><span class="c1">// Bitwise exclusive-OR bits with itself</span>
</span><span id="__span-614-4"><a id="__codelineno-614-4" name="__codelineno-614-4" href="#__codelineno-614-4"></a><span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="w"> </span><span class="p">(</span><span class="n">bits</span><span class="p">[</span><span class="mi">1</span><span class="p">]);</span><span class="w">   </span><span class="c1">// False</span>
</span></code></pre></div>
<h1 id="hashset-and-sortedset">HashSet<T> and SortedSet<T></h1>
<p>HashSet and SortedSet are generic collections new to Framework 3.5 and 4.0, respectively. Both have the following distinguishing features</p>
<ul>
<li>Their Contains methods execute quickly using a hash-based lookup.</li>
<li>They do not store duplicate elements and silently ignore requests to add duplicates.</li>
<li>You cannot access an element by position.</li>
</ul>
<p>SortedSet<T> keeps elements in order, whereas HashSet<T> does not.</p>
<div class="language-csharp highlight"><pre><span></span><code><span id="__span-615-1"><a id="__codelineno-615-1" name="__codelineno-615-1" href="#__codelineno-615-1"></a><span class="p">{</span>
</span><span id="__span-615-2"><a id="__codelineno-615-2" name="__codelineno-615-2" href="#__codelineno-615-2"></a><span class="w">    </span><span class="kt">var</span><span class="w"> </span><span class="n">letters</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">HashSet</span><span class="o">&lt;</span><span class="kt">char</span><span class="o">&gt;</span><span class="w"> </span><span class="p">(</span><span class="s">&quot;the quick brown fox&quot;</span><span class="p">);</span>
</span><span id="__span-615-3"><a id="__codelineno-615-3" name="__codelineno-615-3" href="#__codelineno-615-3"></a>
</span><span id="__span-615-4"><a id="__codelineno-615-4" name="__codelineno-615-4" href="#__codelineno-615-4"></a><span class="w">    </span><span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="w"> </span><span class="p">(</span><span class="n">letters</span><span class="p">.</span><span class="n">Contains</span><span class="w"> </span><span class="p">(</span><span class="sc">&#39;t&#39;</span><span class="p">));</span><span class="w">      </span><span class="c1">// true</span>
</span><span id="__span-615-5"><a id="__codelineno-615-5" name="__codelineno-615-5" href="#__codelineno-615-5"></a><span class="w">    </span><span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="w"> </span><span class="p">(</span><span class="n">letters</span><span class="p">.</span><span class="n">Contains</span><span class="w"> </span><span class="p">(</span><span class="sc">&#39;j&#39;</span><span class="p">));</span><span class="w">      </span><span class="c1">// false</span>
</span><span id="__span-615-6"><a id="__codelineno-615-6" name="__codelineno-615-6" href="#__codelineno-615-6"></a>
</span><span id="__span-615-7"><a id="__codelineno-615-7" name="__codelineno-615-7" href="#__codelineno-615-7"></a><span class="w">    </span><span class="k">foreach</span><span class="w"> </span><span class="p">(</span><span class="kt">char</span><span class="w"> </span><span class="n">c</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">letters</span><span class="p">)</span><span class="w"> </span><span class="n">Console</span><span class="p">.</span><span class="n">Write</span><span class="w"> </span><span class="p">(</span><span class="n">c</span><span class="p">);</span><span class="w">   </span><span class="c1">// the quickbrownfx</span>
</span><span id="__span-615-8"><a id="__codelineno-615-8" name="__codelineno-615-8" href="#__codelineno-615-8"></a><span class="p">}</span>
</span><span id="__span-615-9"><a id="__codelineno-615-9" name="__codelineno-615-9" href="#__codelineno-615-9"></a><span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="p">();</span>
</span><span id="__span-615-10"><a id="__codelineno-615-10" name="__codelineno-615-10" href="#__codelineno-615-10"></a><span class="p">{</span>
</span><span id="__span-615-11"><a id="__codelineno-615-11" name="__codelineno-615-11" href="#__codelineno-615-11"></a><span class="w">    </span><span class="kt">var</span><span class="w"> </span><span class="n">letters</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">SortedSet</span><span class="o">&lt;</span><span class="kt">char</span><span class="o">&gt;</span><span class="w"> </span><span class="p">(</span><span class="s">&quot;the quick brown fox&quot;</span><span class="p">);</span>
</span><span id="__span-615-12"><a id="__codelineno-615-12" name="__codelineno-615-12" href="#__codelineno-615-12"></a>
</span><span id="__span-615-13"><a id="__codelineno-615-13" name="__codelineno-615-13" href="#__codelineno-615-13"></a><span class="w">    </span><span class="k">foreach</span><span class="w"> </span><span class="p">(</span><span class="kt">char</span><span class="w"> </span><span class="n">c</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">letters</span><span class="p">)</span><span class="w"> </span>
</span><span id="__span-615-14"><a id="__codelineno-615-14" name="__codelineno-615-14" href="#__codelineno-615-14"></a><span class="w">        </span><span class="n">Console</span><span class="p">.</span><span class="n">Write</span><span class="w"> </span><span class="p">(</span><span class="n">c</span><span class="p">);</span><span class="w">                                    </span><span class="c1">//  bcefhiknoqrtuwx</span>
</span><span id="__span-615-15"><a id="__codelineno-615-15" name="__codelineno-615-15" href="#__codelineno-615-15"></a>
</span><span id="__span-615-16"><a id="__codelineno-615-16" name="__codelineno-615-16" href="#__codelineno-615-16"></a><span class="w">    </span><span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="p">();</span>
</span><span id="__span-615-17"><a id="__codelineno-615-17" name="__codelineno-615-17" href="#__codelineno-615-17"></a>
</span><span id="__span-615-18"><a id="__codelineno-615-18" name="__codelineno-615-18" href="#__codelineno-615-18"></a><span class="w">    </span><span class="k">foreach</span><span class="w"> </span><span class="p">(</span><span class="kt">char</span><span class="w"> </span><span class="n">c</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">letters</span><span class="p">.</span><span class="n">GetViewBetween</span><span class="w"> </span><span class="p">(</span><span class="sc">&#39;f&#39;</span><span class="p">,</span><span class="w"> </span><span class="sc">&#39;i&#39;</span><span class="p">))</span>
</span><span id="__span-615-19"><a id="__codelineno-615-19" name="__codelineno-615-19" href="#__codelineno-615-19"></a><span class="w">        </span><span class="n">Console</span><span class="p">.</span><span class="n">Write</span><span class="w"> </span><span class="p">(</span><span class="n">c</span><span class="p">);</span><span class="w">                                    </span><span class="c1">//  fhi</span>
</span><span id="__span-615-20"><a id="__codelineno-615-20" name="__codelineno-615-20" href="#__codelineno-615-20"></a><span class="p">}</span>
</span></code></pre></div>
<div class="language-csharp highlight"><pre><span></span><code><span id="__span-616-1"><a id="__codelineno-616-1" name="__codelineno-616-1" href="#__codelineno-616-1"></a><span class="p">{</span>
</span><span id="__span-616-2"><a id="__codelineno-616-2" name="__codelineno-616-2" href="#__codelineno-616-2"></a><span class="w">    </span><span class="kt">var</span><span class="w"> </span><span class="n">letters</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">HashSet</span><span class="o">&lt;</span><span class="kt">char</span><span class="o">&gt;</span><span class="w"> </span><span class="p">(</span><span class="s">&quot;the quick brown fox&quot;</span><span class="p">);</span>
</span><span id="__span-616-3"><a id="__codelineno-616-3" name="__codelineno-616-3" href="#__codelineno-616-3"></a><span class="w">    </span><span class="n">letters</span><span class="p">.</span><span class="n">IntersectWith</span><span class="w"> </span><span class="p">(</span><span class="s">&quot;aeiou&quot;</span><span class="p">);</span>
</span><span id="__span-616-4"><a id="__codelineno-616-4" name="__codelineno-616-4" href="#__codelineno-616-4"></a><span class="w">    </span><span class="k">foreach</span><span class="w"> </span><span class="p">(</span><span class="kt">char</span><span class="w"> </span><span class="n">c</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">letters</span><span class="p">)</span><span class="w"> </span><span class="n">Console</span><span class="p">.</span><span class="n">Write</span><span class="w"> </span><span class="p">(</span><span class="n">c</span><span class="p">);</span><span class="w">     </span><span class="c1">// euio</span>
</span><span id="__span-616-5"><a id="__codelineno-616-5" name="__codelineno-616-5" href="#__codelineno-616-5"></a><span class="p">}</span>
</span><span id="__span-616-6"><a id="__codelineno-616-6" name="__codelineno-616-6" href="#__codelineno-616-6"></a><span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="p">();</span>
</span><span id="__span-616-7"><a id="__codelineno-616-7" name="__codelineno-616-7" href="#__codelineno-616-7"></a><span class="p">{</span>
</span><span id="__span-616-8"><a id="__codelineno-616-8" name="__codelineno-616-8" href="#__codelineno-616-8"></a><span class="w">    </span><span class="kt">var</span><span class="w"> </span><span class="n">letters</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">HashSet</span><span class="o">&lt;</span><span class="kt">char</span><span class="o">&gt;</span><span class="w"> </span><span class="p">(</span><span class="s">&quot;the quick brown fox&quot;</span><span class="p">);</span>
</span><span id="__span-616-9"><a id="__codelineno-616-9" name="__codelineno-616-9" href="#__codelineno-616-9"></a><span class="w">    </span><span class="n">letters</span><span class="p">.</span><span class="n">ExceptWith</span><span class="w"> </span><span class="p">(</span><span class="s">&quot;aeiou&quot;</span><span class="p">);</span>
</span><span id="__span-616-10"><a id="__codelineno-616-10" name="__codelineno-616-10" href="#__codelineno-616-10"></a><span class="w">    </span><span class="k">foreach</span><span class="w"> </span><span class="p">(</span><span class="kt">char</span><span class="w"> </span><span class="n">c</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">letters</span><span class="p">)</span><span class="w"> </span><span class="n">Console</span><span class="p">.</span><span class="n">Write</span><span class="w"> </span><span class="p">(</span><span class="n">c</span><span class="p">);</span><span class="w">     </span><span class="c1">// th qckbrwnfx</span>
</span><span id="__span-616-11"><a id="__codelineno-616-11" name="__codelineno-616-11" href="#__codelineno-616-11"></a><span class="p">}</span>
</span><span id="__span-616-12"><a id="__codelineno-616-12" name="__codelineno-616-12" href="#__codelineno-616-12"></a><span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="p">();</span>
</span><span id="__span-616-13"><a id="__codelineno-616-13" name="__codelineno-616-13" href="#__codelineno-616-13"></a><span class="p">{</span>
</span><span id="__span-616-14"><a id="__codelineno-616-14" name="__codelineno-616-14" href="#__codelineno-616-14"></a><span class="w">    </span><span class="kt">var</span><span class="w"> </span><span class="n">letters</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">HashSet</span><span class="o">&lt;</span><span class="kt">char</span><span class="o">&gt;</span><span class="w"> </span><span class="p">(</span><span class="s">&quot;the quick brown fox&quot;</span><span class="p">);</span>
</span><span id="__span-616-15"><a id="__codelineno-616-15" name="__codelineno-616-15" href="#__codelineno-616-15"></a><span class="w">    </span><span class="n">letters</span><span class="p">.</span><span class="n">SymmetricExceptWith</span><span class="w"> </span><span class="p">(</span><span class="s">&quot;the lazy brown fox&quot;</span><span class="p">);</span>
</span><span id="__span-616-16"><a id="__codelineno-616-16" name="__codelineno-616-16" href="#__codelineno-616-16"></a><span class="w">    </span><span class="k">foreach</span><span class="w"> </span><span class="p">(</span><span class="kt">char</span><span class="w"> </span><span class="n">c</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">letters</span><span class="p">)</span><span class="w"> </span><span class="n">Console</span><span class="p">.</span><span class="n">Write</span><span class="w"> </span><span class="p">(</span><span class="n">c</span><span class="p">);</span><span class="w">     </span><span class="c1">// quicklazy</span>
</span><span id="__span-616-17"><a id="__codelineno-616-17" name="__codelineno-616-17" href="#__codelineno-616-17"></a><span class="p">}</span>
</span></code></pre></div>
<h1 id="dictionaries">Dictionaries</h1>
<p>A dictionary is a collection in which each element is a key/value pair. Dictionaries are most commonly used for lookups and sorted lists.</p>
<p>The Framework defines a standard protocol for dictionaries, via the interfaces IDictionary and IDictionary as well as a set of general-purpose dictionary classes.</p>
<p>The classes each differ in the following regard</p>
<ul>
<li>Whether or not items are stored in sorted sequence</li>
<li>Whether or not items can be accessed by position (index) as well as by key</li>
<li>Whether generic or nongeneric</li>
<li>Whether itâ€™s fast or slow to retrieve items by key from a large dictionary</li>
</ul>
<h3 id="idictionary">IDictionary<TKey,TValue></h3>
<p>Dictionary defines the standard protocol for all key/value-based collections. It extends ICollection by adding methods and properties to access elements based on a key of arbitrary type:</p>
<div class="language-csharp highlight"><pre><span></span><code><span id="__span-617-1"><a id="__codelineno-617-1" name="__codelineno-617-1" href="#__codelineno-617-1"></a><span class="k">public</span><span class="w"> </span><span class="k">interface</span><span class="w"> </span><span class="n">IDictionary</span><span class="w"> </span><span class="o">&lt;</span><span class="n">TKey</span><span class="p">,</span><span class="w"> </span><span class="n">TValue</span><span class="o">&gt;</span><span class="w"> </span><span class="p">:</span>
</span><span id="__span-617-2"><a id="__codelineno-617-2" name="__codelineno-617-2" href="#__codelineno-617-2"></a><span class="w"> </span><span class="n">ICollection</span><span class="w"> </span><span class="o">&lt;</span><span class="n">KeyValuePair</span><span class="w"> </span><span class="o">&lt;</span><span class="n">TKey</span><span class="p">,</span><span class="w"> </span><span class="n">TValue</span><span class="o">&gt;&gt;</span><span class="p">,</span><span class="w"> </span><span class="n">IEnumerable</span>
</span><span id="__span-617-3"><a id="__codelineno-617-3" name="__codelineno-617-3" href="#__codelineno-617-3"></a><span class="p">{</span>
</span><span id="__span-617-4"><a id="__codelineno-617-4" name="__codelineno-617-4" href="#__codelineno-617-4"></a><span class="w"> </span><span class="kt">bool</span><span class="w"> </span><span class="nf">ContainsKey</span><span class="w"> </span><span class="p">(</span><span class="n">TKey</span><span class="w"> </span><span class="n">key</span><span class="p">);</span>
</span><span id="__span-617-5"><a id="__codelineno-617-5" name="__codelineno-617-5" href="#__codelineno-617-5"></a><span class="w"> </span><span class="kt">bool</span><span class="w"> </span><span class="nf">TryGetValue</span><span class="w"> </span><span class="p">(</span><span class="n">TKey</span><span class="w"> </span><span class="n">key</span><span class="p">,</span><span class="w"> </span><span class="k">out</span><span class="w"> </span><span class="n">TValue</span><span class="w"> </span><span class="k">value</span><span class="p">);</span>
</span><span id="__span-617-6"><a id="__codelineno-617-6" name="__codelineno-617-6" href="#__codelineno-617-6"></a><span class="w"> </span><span class="k">void</span><span class="w"> </span><span class="nf">Add</span><span class="w"> </span><span class="p">(</span><span class="n">TKey</span><span class="w"> </span><span class="n">key</span><span class="p">,</span><span class="w"> </span><span class="n">TValue</span><span class="w"> </span><span class="k">value</span><span class="p">);</span>
</span><span id="__span-617-7"><a id="__codelineno-617-7" name="__codelineno-617-7" href="#__codelineno-617-7"></a><span class="w"> </span><span class="kt">bool</span><span class="w"> </span><span class="nf">Remove</span><span class="w"> </span><span class="p">(</span><span class="n">TKey</span><span class="w"> </span><span class="n">key</span><span class="p">);</span>
</span><span id="__span-617-8"><a id="__codelineno-617-8" name="__codelineno-617-8" href="#__codelineno-617-8"></a><span class="w"> </span><span class="n">TValue</span><span class="w"> </span><span class="k">this</span><span class="w"> </span><span class="p">[</span><span class="n">TKey</span><span class="w"> </span><span class="n">key</span><span class="p">]</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">get</span><span class="p">;</span><span class="w"> </span><span class="k">set</span><span class="p">;</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="c1">// Main indexer - by key</span>
</span><span id="__span-617-9"><a id="__codelineno-617-9" name="__codelineno-617-9" href="#__codelineno-617-9"></a><span class="w"> </span><span class="n">ICollection</span><span class="w"> </span><span class="o">&lt;</span><span class="n">TKey</span><span class="o">&gt;</span><span class="w"> </span><span class="n">Keys</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">get</span><span class="p">;</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="c1">// Returns just keys</span>
</span><span id="__span-617-10"><a id="__codelineno-617-10" name="__codelineno-617-10" href="#__codelineno-617-10"></a><span class="w"> </span><span class="n">ICollection</span><span class="w"> </span><span class="o">&lt;</span><span class="n">TValue</span><span class="o">&gt;</span><span class="w"> </span><span class="n">Values</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">get</span><span class="p">;</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="c1">// Returns just values</span>
</span><span id="__span-617-11"><a id="__codelineno-617-11" name="__codelineno-617-11" href="#__codelineno-617-11"></a><span class="p">}</span>
</span></code></pre></div>
<p>To add an item to a dictionary, you either call Add or use the indexâ€™s set accessor the latter adds an item to the dictionary if the key is not already present (or updates the item if it is present). Duplicate keys are forbidden in all dictionary implementations, so calling Add twice with the same key throws an exception.</p>
<p>To retrieve an item from a dictionary, use either the indexer or the TryGetValue method. If the key doesnâ€™t exist, the indexer throws an exception, whereas TryGetValue returns false. You can test for membership explicitly by calling Contains Key; however, this incurs the cost of two lookups if you subsequently retrieve the item.</p>
<h3 id="dictionary-and-hashtable">Dictionary<TKey,TValue> and Hashtable</h3>
<p>The generic Dictionary class is one of the most commonly used collections (along with the List collection). It uses a hashtable data structure to store keys and values, and it is fast and efficient.</p>
<div class="language-csharp highlight"><pre><span></span><code><span id="__span-618-1"><a id="__codelineno-618-1" name="__codelineno-618-1" href="#__codelineno-618-1"></a><span class="kt">var</span><span class="w"> </span><span class="n">d</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">Dictionary</span><span class="o">&lt;</span><span class="kt">string</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="o">&gt;</span><span class="p">();</span>
</span><span id="__span-618-2"><a id="__codelineno-618-2" name="__codelineno-618-2" href="#__codelineno-618-2"></a>
</span><span id="__span-618-3"><a id="__codelineno-618-3" name="__codelineno-618-3" href="#__codelineno-618-3"></a><span class="n">d</span><span class="p">.</span><span class="n">Add</span><span class="p">(</span><span class="s">&quot;One&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">);</span>
</span><span id="__span-618-4"><a id="__codelineno-618-4" name="__codelineno-618-4" href="#__codelineno-618-4"></a><span class="n">d</span><span class="p">[</span><span class="s">&quot;Two&quot;</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">2</span><span class="p">;</span><span class="w">     </span><span class="c1">// adds to dictionary because &quot;two&quot; not already present</span>
</span><span id="__span-618-5"><a id="__codelineno-618-5" name="__codelineno-618-5" href="#__codelineno-618-5"></a><span class="n">d</span><span class="p">[</span><span class="s">&quot;Two&quot;</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">22</span><span class="p">;</span><span class="w">    </span><span class="c1">// updates dictionary because &quot;two&quot; is now present</span>
</span><span id="__span-618-6"><a id="__codelineno-618-6" name="__codelineno-618-6" href="#__codelineno-618-6"></a><span class="n">d</span><span class="p">[</span><span class="s">&quot;Three&quot;</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">3</span><span class="p">;</span>
</span><span id="__span-618-7"><a id="__codelineno-618-7" name="__codelineno-618-7" href="#__codelineno-618-7"></a>
</span><span id="__span-618-8"><a id="__codelineno-618-8" name="__codelineno-618-8" href="#__codelineno-618-8"></a><span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="w"> </span><span class="p">(</span><span class="n">d</span><span class="p">[</span><span class="s">&quot;Two&quot;</span><span class="p">]);</span><span class="w">                </span><span class="c1">// Prints &quot;22&quot;</span>
</span><span id="__span-618-9"><a id="__codelineno-618-9" name="__codelineno-618-9" href="#__codelineno-618-9"></a><span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="w"> </span><span class="p">(</span><span class="n">d</span><span class="p">.</span><span class="n">ContainsKey</span><span class="w"> </span><span class="p">(</span><span class="s">&quot;One&quot;</span><span class="p">));</span><span class="w">   </span><span class="c1">// true (fast operation)</span>
</span><span id="__span-618-10"><a id="__codelineno-618-10" name="__codelineno-618-10" href="#__codelineno-618-10"></a><span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="w"> </span><span class="p">(</span><span class="n">d</span><span class="p">.</span><span class="n">ContainsValue</span><span class="w"> </span><span class="p">(</span><span class="mi">3</span><span class="p">));</span><span class="w">     </span><span class="c1">// true (slow operation)</span>
</span><span id="__span-618-11"><a id="__codelineno-618-11" name="__codelineno-618-11" href="#__codelineno-618-11"></a><span class="kt">int</span><span class="w"> </span><span class="n">val</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
</span><span id="__span-618-12"><a id="__codelineno-618-12" name="__codelineno-618-12" href="#__codelineno-618-12"></a><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="n">d</span><span class="p">.</span><span class="n">TryGetValue</span><span class="w"> </span><span class="p">(</span><span class="s">&quot;onE&quot;</span><span class="p">,</span><span class="w"> </span><span class="k">out</span><span class="w"> </span><span class="n">val</span><span class="p">))</span>
</span><span id="__span-618-13"><a id="__codelineno-618-13" name="__codelineno-618-13" href="#__codelineno-618-13"></a><span class="w">    </span><span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="w"> </span><span class="p">(</span><span class="s">&quot;No val&quot;</span><span class="p">);</span><span class="w">            </span><span class="c1">// &quot;No val&quot; (case sensitive)</span>
</span><span id="__span-618-14"><a id="__codelineno-618-14" name="__codelineno-618-14" href="#__codelineno-618-14"></a>
</span><span id="__span-618-15"><a id="__codelineno-618-15" name="__codelineno-618-15" href="#__codelineno-618-15"></a><span class="c1">// Three different ways to enumerate the dictionary:</span>
</span><span id="__span-618-16"><a id="__codelineno-618-16" name="__codelineno-618-16" href="#__codelineno-618-16"></a>
</span><span id="__span-618-17"><a id="__codelineno-618-17" name="__codelineno-618-17" href="#__codelineno-618-17"></a><span class="k">foreach</span><span class="w"> </span><span class="p">(</span><span class="n">KeyValuePair</span><span class="o">&lt;</span><span class="kt">string</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="o">&gt;</span><span class="w"> </span><span class="n">kv</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">d</span><span class="p">)</span><span class="w">          </span><span class="c1">//  One; 1</span>
</span><span id="__span-618-18"><a id="__codelineno-618-18" name="__codelineno-618-18" href="#__codelineno-618-18"></a><span class="w">    </span><span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="w"> </span><span class="p">(</span><span class="n">kv</span><span class="p">.</span><span class="n">Key</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s">&quot;; &quot;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">kv</span><span class="p">.</span><span class="n">Value</span><span class="p">);</span><span class="w">    </span><span class="c1">//  Two; 22</span>
</span><span id="__span-618-19"><a id="__codelineno-618-19" name="__codelineno-618-19" href="#__codelineno-618-19"></a><span class="w">                                                                                                         </span><span class="c1">//  Three; 3</span>
</span><span id="__span-618-20"><a id="__codelineno-618-20" name="__codelineno-618-20" href="#__codelineno-618-20"></a>
</span><span id="__span-618-21"><a id="__codelineno-618-21" name="__codelineno-618-21" href="#__codelineno-618-21"></a><span class="k">foreach</span><span class="w"> </span><span class="p">(</span><span class="kt">string</span><span class="w"> </span><span class="n">s</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">d</span><span class="p">.</span><span class="n">Keys</span><span class="p">)</span><span class="w"> </span><span class="n">Console</span><span class="p">.</span><span class="n">Write</span><span class="w"> </span><span class="p">(</span><span class="n">s</span><span class="p">);</span><span class="w">      </span><span class="c1">// OneTwoThree</span>
</span><span id="__span-618-22"><a id="__codelineno-618-22" name="__codelineno-618-22" href="#__codelineno-618-22"></a><span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="p">();</span>
</span><span id="__span-618-23"><a id="__codelineno-618-23" name="__codelineno-618-23" href="#__codelineno-618-23"></a><span class="k">foreach</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">d</span><span class="p">.</span><span class="n">Values</span><span class="p">)</span><span class="w"> </span><span class="n">Console</span><span class="p">.</span><span class="n">Write</span><span class="w"> </span><span class="p">(</span><span class="n">i</span><span class="p">);</span><span class="w">       </span><span class="c1">// 1223</span>
</span><span id="__span-618-24"><a id="__codelineno-618-24" name="__codelineno-618-24" href="#__codelineno-618-24"></a>
</span><span id="__span-618-25"><a id="__codelineno-618-25" name="__codelineno-618-25" href="#__codelineno-618-25"></a><span class="kt">var</span><span class="w"> </span><span class="n">dIgnoreCase</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">Dictionary</span><span class="o">&lt;</span><span class="kt">string</span><span class="p">,</span><span class="w"> </span><span class="kt">bool</span><span class="o">&gt;</span><span class="w"> </span><span class="p">(</span><span class="n">StringComparer</span><span class="p">.</span><span class="n">OrdinalIgnoreCase</span><span class="p">);</span>
</span><span id="__span-618-26"><a id="__codelineno-618-26" name="__codelineno-618-26" href="#__codelineno-618-26"></a><span class="n">dIgnoreCase</span><span class="p">[</span><span class="s">&quot;foo&quot;</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">true</span><span class="p">;</span>
</span><span id="__span-618-27"><a id="__codelineno-618-27" name="__codelineno-618-27" href="#__codelineno-618-27"></a><span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="p">(</span><span class="n">dIgnoreCase</span><span class="p">[</span><span class="s">&quot;FOO&quot;</span><span class="p">]);</span>
</span></code></pre></div>
<h3 id="sorted-dictionaries">Sorted Dictionaries</h3>
<p>The Framework provides two dictionary classes internally structured such that their content is always sorted by key:</p>
<ul>
<li>SortedDictionary</li>
<li>SortedList1</li>
</ul>
<p>SortedDictionary&lt;,&gt; is much faster than SortedList&lt;,&gt; at inserting elements in a random sequence (particularly with large lists). SortedList&lt;,&gt;, however, has an extra ability: to access items by index as well as by key. With a sorted list, you can go directly to the nth element in the sorting sequence (via the indexer on the Keys/ Values properties). To do the same with a SortedDictionary&lt;,&gt;, you must manually enumerate over n items.</p>
<div class="language-csharp highlight"><pre><span></span><code><span id="__span-619-1"><a id="__codelineno-619-1" name="__codelineno-619-1" href="#__codelineno-619-1"></a><span class="c1">// MethodInfo is in the System.Reflection namespace</span>
</span><span id="__span-619-2"><a id="__codelineno-619-2" name="__codelineno-619-2" href="#__codelineno-619-2"></a>
</span><span id="__span-619-3"><a id="__codelineno-619-3" name="__codelineno-619-3" href="#__codelineno-619-3"></a><span class="kt">var</span><span class="w"> </span><span class="n">sorted</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">SortedList</span><span class="w"> </span><span class="o">&lt;</span><span class="kt">string</span><span class="p">,</span><span class="w"> </span><span class="n">MethodInfo</span><span class="o">&gt;</span><span class="p">();</span>
</span><span id="__span-619-4"><a id="__codelineno-619-4" name="__codelineno-619-4" href="#__codelineno-619-4"></a>
</span><span id="__span-619-5"><a id="__codelineno-619-5" name="__codelineno-619-5" href="#__codelineno-619-5"></a><span class="k">foreach</span><span class="w"> </span><span class="p">(</span><span class="n">MethodInfo</span><span class="w"> </span><span class="n">m</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="k">typeof</span><span class="w"> </span><span class="p">(</span><span class="kt">object</span><span class="p">).</span><span class="n">GetMethods</span><span class="p">())</span>
</span><span id="__span-619-6"><a id="__codelineno-619-6" name="__codelineno-619-6" href="#__codelineno-619-6"></a><span class="w">    </span><span class="n">sorted</span><span class="w"> </span><span class="p">[</span><span class="n">m</span><span class="p">.</span><span class="n">Name</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">m</span><span class="p">;</span>
</span><span id="__span-619-7"><a id="__codelineno-619-7" name="__codelineno-619-7" href="#__codelineno-619-7"></a>
</span><span id="__span-619-8"><a id="__codelineno-619-8" name="__codelineno-619-8" href="#__codelineno-619-8"></a><span class="n">sorted</span><span class="p">.</span><span class="n">Keys</span><span class="p">.</span><span class="n">Dump</span><span class="w"> </span><span class="p">(</span><span class="s">&quot;keys&quot;</span><span class="p">);</span>
</span><span id="__span-619-9"><a id="__codelineno-619-9" name="__codelineno-619-9" href="#__codelineno-619-9"></a><span class="n">sorted</span><span class="p">.</span><span class="n">Values</span><span class="p">.</span><span class="n">Dump</span><span class="w"> </span><span class="p">(</span><span class="s">&quot;values&quot;</span><span class="p">);</span>
</span><span id="__span-619-10"><a id="__codelineno-619-10" name="__codelineno-619-10" href="#__codelineno-619-10"></a>
</span><span id="__span-619-11"><a id="__codelineno-619-11" name="__codelineno-619-11" href="#__codelineno-619-11"></a><span class="k">foreach</span><span class="w"> </span><span class="p">(</span><span class="n">MethodInfo</span><span class="w"> </span><span class="n">m</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">sorted</span><span class="p">.</span><span class="n">Values</span><span class="p">)</span>
</span><span id="__span-619-12"><a id="__codelineno-619-12" name="__codelineno-619-12" href="#__codelineno-619-12"></a><span class="w">    </span><span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="w"> </span><span class="p">(</span><span class="n">m</span><span class="p">.</span><span class="n">Name</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s">&quot; returns a &quot;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">m</span><span class="p">.</span><span class="n">ReturnType</span><span class="p">);</span>
</span><span id="__span-619-13"><a id="__codelineno-619-13" name="__codelineno-619-13" href="#__codelineno-619-13"></a>
</span><span id="__span-619-14"><a id="__codelineno-619-14" name="__codelineno-619-14" href="#__codelineno-619-14"></a><span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="w"> </span><span class="p">(</span><span class="n">sorted</span><span class="w"> </span><span class="p">[</span><span class="s">&quot;GetHashCode&quot;</span><span class="p">]);</span><span class="w">      </span><span class="c1">// Int32 GetHashCode()</span>
</span><span id="__span-619-15"><a id="__codelineno-619-15" name="__codelineno-619-15" href="#__codelineno-619-15"></a>
</span><span id="__span-619-16"><a id="__codelineno-619-16" name="__codelineno-619-16" href="#__codelineno-619-16"></a><span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="w"> </span><span class="p">(</span><span class="n">sorted</span><span class="p">.</span><span class="n">Keys</span><span class="w">  </span><span class="p">[</span><span class="n">sorted</span><span class="p">.</span><span class="n">Count</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">1</span><span class="p">]);</span><span class="w">            </span><span class="c1">// ToString</span>
</span><span id="__span-619-17"><a id="__codelineno-619-17" name="__codelineno-619-17" href="#__codelineno-619-17"></a><span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="w"> </span><span class="p">(</span><span class="n">sorted</span><span class="p">.</span><span class="n">Values</span><span class="p">[</span><span class="n">sorted</span><span class="p">.</span><span class="n">Count</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">1</span><span class="p">].</span><span class="n">IsVirtual</span><span class="p">);</span><span class="w">  </span><span class="c1">// True</span>
</span></code></pre></div>
<h1 id="customizable-collections-and-proxies">Customizable Collections and Proxies</h1>
<p>The collection classes discussed in previous sections are convenient in that you can directly instantiate them, but they donâ€™t allow you to control what happens when an item is added to or removed from the collection. With strongly typed collections in an application, you sometimes need this control.</p>
<ul>
<li>To fire an event when an item is added or removed</li>
<li>To update properties because of the added or removed item</li>
<li>To detect an â€œillegalâ€ add/remove operation and throw an exception (for example, if the operation violates a business rule)</li>
</ul>
<p>The .NET Framework provides collection classes for this exact purpose, in the System.Collections.ObjectModel namespace. These are essentially proxies or wrappers that implement IList or IDictionary&lt;,&gt; by forwarding the methods through to an underlying collection. Each Add, Remove, or Clear operation is routed via a virtual method that acts as a â€œgatewayâ€ when overridden.</p>
<div class="language-csharp highlight"><pre><span></span><code><span id="__span-620-1"><a id="__codelineno-620-1" name="__codelineno-620-1" href="#__codelineno-620-1"></a><span class="k">public</span><span class="w"> </span><span class="k">class</span><span class="w"> </span><span class="nc">Animal</span>
</span><span id="__span-620-2"><a id="__codelineno-620-2" name="__codelineno-620-2" href="#__codelineno-620-2"></a><span class="p">{</span>
</span><span id="__span-620-3"><a id="__codelineno-620-3" name="__codelineno-620-3" href="#__codelineno-620-3"></a><span class="w">    </span><span class="k">public</span><span class="w"> </span><span class="kt">string</span><span class="w"> </span><span class="n">Name</span><span class="p">;</span>
</span><span id="__span-620-4"><a id="__codelineno-620-4" name="__codelineno-620-4" href="#__codelineno-620-4"></a><span class="w">    </span><span class="k">public</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">Popularity</span><span class="p">;</span>
</span><span id="__span-620-5"><a id="__codelineno-620-5" name="__codelineno-620-5" href="#__codelineno-620-5"></a>
</span><span id="__span-620-6"><a id="__codelineno-620-6" name="__codelineno-620-6" href="#__codelineno-620-6"></a><span class="w">    </span><span class="k">public</span><span class="w"> </span><span class="nf">Animal</span><span class="w"> </span><span class="p">(</span><span class="kt">string</span><span class="w"> </span><span class="n">name</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">popularity</span><span class="p">)</span>
</span><span id="__span-620-7"><a id="__codelineno-620-7" name="__codelineno-620-7" href="#__codelineno-620-7"></a><span class="w">    </span><span class="p">{</span>
</span><span id="__span-620-8"><a id="__codelineno-620-8" name="__codelineno-620-8" href="#__codelineno-620-8"></a><span class="w">        </span><span class="n">Name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">name</span><span class="p">;</span><span class="w"> </span><span class="n">Popularity</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">popularity</span><span class="p">;</span>
</span><span id="__span-620-9"><a id="__codelineno-620-9" name="__codelineno-620-9" href="#__codelineno-620-9"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-620-10"><a id="__codelineno-620-10" name="__codelineno-620-10" href="#__codelineno-620-10"></a><span class="p">}</span>
</span><span id="__span-620-11"><a id="__codelineno-620-11" name="__codelineno-620-11" href="#__codelineno-620-11"></a>
</span><span id="__span-620-12"><a id="__codelineno-620-12" name="__codelineno-620-12" href="#__codelineno-620-12"></a><span class="k">public</span><span class="w"> </span><span class="k">class</span><span class="w"> </span><span class="nc">AnimalCollection</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="n">Collection</span><span class="w"> </span><span class="o">&lt;</span><span class="n">Animal</span><span class="o">&gt;</span>
</span><span id="__span-620-13"><a id="__codelineno-620-13" name="__codelineno-620-13" href="#__codelineno-620-13"></a><span class="p">{</span>
</span><span id="__span-620-14"><a id="__codelineno-620-14" name="__codelineno-620-14" href="#__codelineno-620-14"></a><span class="w">    </span><span class="c1">// AnimalCollection is already a fully functioning list of animals.</span>
</span><span id="__span-620-15"><a id="__codelineno-620-15" name="__codelineno-620-15" href="#__codelineno-620-15"></a><span class="w">    </span><span class="c1">// No extra code is required.</span>
</span><span id="__span-620-16"><a id="__codelineno-620-16" name="__codelineno-620-16" href="#__codelineno-620-16"></a><span class="p">}</span>
</span><span id="__span-620-17"><a id="__codelineno-620-17" name="__codelineno-620-17" href="#__codelineno-620-17"></a>
</span><span id="__span-620-18"><a id="__codelineno-620-18" name="__codelineno-620-18" href="#__codelineno-620-18"></a><span class="k">public</span><span class="w"> </span><span class="k">class</span><span class="w"> </span><span class="nc">Zoo</span><span class="w">   </span><span class="c1">// The class that will expose AnimalCollection.</span>
</span><span id="__span-620-19"><a id="__codelineno-620-19" name="__codelineno-620-19" href="#__codelineno-620-19"></a><span class="p">{</span><span class="w">                  </span><span class="c1">// This would typically have additional members.</span>
</span><span id="__span-620-20"><a id="__codelineno-620-20" name="__codelineno-620-20" href="#__codelineno-620-20"></a>
</span><span id="__span-620-21"><a id="__codelineno-620-21" name="__codelineno-620-21" href="#__codelineno-620-21"></a><span class="w">    </span><span class="k">public</span><span class="w"> </span><span class="k">readonly</span><span class="w"> </span><span class="n">AnimalCollection</span><span class="w"> </span><span class="n">Animals</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">AnimalCollection</span><span class="p">();</span>
</span><span id="__span-620-22"><a id="__codelineno-620-22" name="__codelineno-620-22" href="#__codelineno-620-22"></a><span class="p">}</span>
</span><span id="__span-620-23"><a id="__codelineno-620-23" name="__codelineno-620-23" href="#__codelineno-620-23"></a>
</span><span id="__span-620-24"><a id="__codelineno-620-24" name="__codelineno-620-24" href="#__codelineno-620-24"></a><span class="k">static</span><span class="w"> </span><span class="k">void</span><span class="w"> </span><span class="nf">Main</span><span class="p">()</span>
</span><span id="__span-620-25"><a id="__codelineno-620-25" name="__codelineno-620-25" href="#__codelineno-620-25"></a><span class="p">{</span>
</span><span id="__span-620-26"><a id="__codelineno-620-26" name="__codelineno-620-26" href="#__codelineno-620-26"></a><span class="w">    </span><span class="n">Zoo</span><span class="w"> </span><span class="n">zoo</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">Zoo</span><span class="p">();</span>
</span><span id="__span-620-27"><a id="__codelineno-620-27" name="__codelineno-620-27" href="#__codelineno-620-27"></a><span class="w">    </span><span class="n">zoo</span><span class="p">.</span><span class="n">Animals</span><span class="p">.</span><span class="n">Add</span><span class="w"> </span><span class="p">(</span><span class="k">new</span><span class="w"> </span><span class="n">Animal</span><span class="w"> </span><span class="p">(</span><span class="s">&quot;Kangaroo&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">10</span><span class="p">));</span>
</span><span id="__span-620-28"><a id="__codelineno-620-28" name="__codelineno-620-28" href="#__codelineno-620-28"></a><span class="w">    </span><span class="n">zoo</span><span class="p">.</span><span class="n">Animals</span><span class="p">.</span><span class="n">Add</span><span class="w"> </span><span class="p">(</span><span class="k">new</span><span class="w"> </span><span class="n">Animal</span><span class="w"> </span><span class="p">(</span><span class="s">&quot;Mr Sea Lion&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">20</span><span class="p">));</span>
</span><span id="__span-620-29"><a id="__codelineno-620-29" name="__codelineno-620-29" href="#__codelineno-620-29"></a><span class="w">    </span><span class="k">foreach</span><span class="w"> </span><span class="p">(</span><span class="n">Animal</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">zoo</span><span class="p">.</span><span class="n">Animals</span><span class="p">)</span><span class="w"> </span><span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="w"> </span><span class="p">(</span><span class="n">a</span><span class="p">.</span><span class="n">Name</span><span class="p">);</span>
</span><span id="__span-620-30"><a id="__codelineno-620-30" name="__codelineno-620-30" href="#__codelineno-620-30"></a><span class="p">}</span>
</span></code></pre></div>
<p>As it stands, AnimalCollection is no more functional than a simple List<Animal>; its role is to provide a base for future extension. To illustrate, letâ€™s now add a Zoo property to Animal so that it can reference the Zoo in which it lives and override each of the virtual methods in Collection to maintain that property automatically:</p>
<div class="language-csharp highlight"><pre><span></span><code><span id="__span-621-1"><a id="__codelineno-621-1" name="__codelineno-621-1" href="#__codelineno-621-1"></a><span class="k">public</span><span class="w"> </span><span class="k">class</span><span class="w"> </span><span class="nc">Animal</span>
</span><span id="__span-621-2"><a id="__codelineno-621-2" name="__codelineno-621-2" href="#__codelineno-621-2"></a><span class="p">{</span>
</span><span id="__span-621-3"><a id="__codelineno-621-3" name="__codelineno-621-3" href="#__codelineno-621-3"></a><span class="w">    </span><span class="k">public</span><span class="w"> </span><span class="kt">string</span><span class="w"> </span><span class="n">Name</span><span class="p">;</span>
</span><span id="__span-621-4"><a id="__codelineno-621-4" name="__codelineno-621-4" href="#__codelineno-621-4"></a><span class="w">    </span><span class="k">public</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">Popularity</span><span class="p">;</span>
</span><span id="__span-621-5"><a id="__codelineno-621-5" name="__codelineno-621-5" href="#__codelineno-621-5"></a>
</span><span id="__span-621-6"><a id="__codelineno-621-6" name="__codelineno-621-6" href="#__codelineno-621-6"></a><span class="w">    </span><span class="k">public</span><span class="w"> </span><span class="n">Zoo</span><span class="w"> </span><span class="n">Zoo</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">get</span><span class="p">;</span><span class="w"> </span><span class="k">internal</span><span class="w"> </span><span class="k">set</span><span class="p">;</span><span class="w"> </span><span class="p">}</span>
</span><span id="__span-621-7"><a id="__codelineno-621-7" name="__codelineno-621-7" href="#__codelineno-621-7"></a>
</span><span id="__span-621-8"><a id="__codelineno-621-8" name="__codelineno-621-8" href="#__codelineno-621-8"></a><span class="w">    </span><span class="k">public</span><span class="w"> </span><span class="nf">Animal</span><span class="w"> </span><span class="p">(</span><span class="kt">string</span><span class="w"> </span><span class="n">name</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">popularity</span><span class="p">)</span>
</span><span id="__span-621-9"><a id="__codelineno-621-9" name="__codelineno-621-9" href="#__codelineno-621-9"></a><span class="w">    </span><span class="p">{</span>
</span><span id="__span-621-10"><a id="__codelineno-621-10" name="__codelineno-621-10" href="#__codelineno-621-10"></a><span class="w">        </span><span class="n">Name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">name</span><span class="p">;</span><span class="w"> </span><span class="n">Popularity</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">popularity</span><span class="p">;</span>
</span><span id="__span-621-11"><a id="__codelineno-621-11" name="__codelineno-621-11" href="#__codelineno-621-11"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-621-12"><a id="__codelineno-621-12" name="__codelineno-621-12" href="#__codelineno-621-12"></a><span class="p">}</span>
</span><span id="__span-621-13"><a id="__codelineno-621-13" name="__codelineno-621-13" href="#__codelineno-621-13"></a>
</span><span id="__span-621-14"><a id="__codelineno-621-14" name="__codelineno-621-14" href="#__codelineno-621-14"></a><span class="k">public</span><span class="w"> </span><span class="k">class</span><span class="w"> </span><span class="nc">AnimalCollection</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="n">Collection</span><span class="w"> </span><span class="o">&lt;</span><span class="n">Animal</span><span class="o">&gt;</span>
</span><span id="__span-621-15"><a id="__codelineno-621-15" name="__codelineno-621-15" href="#__codelineno-621-15"></a><span class="p">{</span>
</span><span id="__span-621-16"><a id="__codelineno-621-16" name="__codelineno-621-16" href="#__codelineno-621-16"></a><span class="w">    </span><span class="n">Zoo</span><span class="w"> </span><span class="n">zoo</span><span class="p">;</span>
</span><span id="__span-621-17"><a id="__codelineno-621-17" name="__codelineno-621-17" href="#__codelineno-621-17"></a><span class="w">    </span><span class="k">public</span><span class="w"> </span><span class="nf">AnimalCollection</span><span class="w"> </span><span class="p">(</span><span class="n">Zoo</span><span class="w"> </span><span class="n">zoo</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="n">zoo</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">zoo</span><span class="p">;</span><span class="w"> </span><span class="p">}</span>
</span><span id="__span-621-18"><a id="__codelineno-621-18" name="__codelineno-621-18" href="#__codelineno-621-18"></a>
</span><span id="__span-621-19"><a id="__codelineno-621-19" name="__codelineno-621-19" href="#__codelineno-621-19"></a><span class="w">    </span><span class="k">protected</span><span class="w"> </span><span class="k">override</span><span class="w"> </span><span class="k">void</span><span class="w"> </span><span class="nf">InsertItem</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">index</span><span class="p">,</span><span class="w"> </span><span class="n">Animal</span><span class="w"> </span><span class="n">item</span><span class="p">)</span>
</span><span id="__span-621-20"><a id="__codelineno-621-20" name="__codelineno-621-20" href="#__codelineno-621-20"></a><span class="w">    </span><span class="p">{</span>
</span><span id="__span-621-21"><a id="__codelineno-621-21" name="__codelineno-621-21" href="#__codelineno-621-21"></a><span class="w">        </span><span class="k">base</span><span class="p">.</span><span class="n">InsertItem</span><span class="w"> </span><span class="p">(</span><span class="n">index</span><span class="p">,</span><span class="w"> </span><span class="n">item</span><span class="p">);</span>
</span><span id="__span-621-22"><a id="__codelineno-621-22" name="__codelineno-621-22" href="#__codelineno-621-22"></a><span class="w">        </span><span class="n">item</span><span class="p">.</span><span class="n">Zoo</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">zoo</span><span class="p">;</span>
</span><span id="__span-621-23"><a id="__codelineno-621-23" name="__codelineno-621-23" href="#__codelineno-621-23"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-621-24"><a id="__codelineno-621-24" name="__codelineno-621-24" href="#__codelineno-621-24"></a><span class="w">    </span><span class="k">protected</span><span class="w"> </span><span class="k">override</span><span class="w"> </span><span class="k">void</span><span class="w"> </span><span class="nf">SetItem</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">index</span><span class="p">,</span><span class="w"> </span><span class="n">Animal</span><span class="w"> </span><span class="n">item</span><span class="p">)</span>
</span><span id="__span-621-25"><a id="__codelineno-621-25" name="__codelineno-621-25" href="#__codelineno-621-25"></a><span class="w">    </span><span class="p">{</span>
</span><span id="__span-621-26"><a id="__codelineno-621-26" name="__codelineno-621-26" href="#__codelineno-621-26"></a><span class="w">        </span><span class="k">base</span><span class="p">.</span><span class="n">SetItem</span><span class="w"> </span><span class="p">(</span><span class="n">index</span><span class="p">,</span><span class="w"> </span><span class="n">item</span><span class="p">);</span>
</span><span id="__span-621-27"><a id="__codelineno-621-27" name="__codelineno-621-27" href="#__codelineno-621-27"></a><span class="w">        </span><span class="n">item</span><span class="p">.</span><span class="n">Zoo</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">zoo</span><span class="p">;</span>
</span><span id="__span-621-28"><a id="__codelineno-621-28" name="__codelineno-621-28" href="#__codelineno-621-28"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-621-29"><a id="__codelineno-621-29" name="__codelineno-621-29" href="#__codelineno-621-29"></a><span class="w">    </span><span class="k">protected</span><span class="w"> </span><span class="k">override</span><span class="w"> </span><span class="k">void</span><span class="w"> </span><span class="nf">RemoveItem</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">index</span><span class="p">)</span>
</span><span id="__span-621-30"><a id="__codelineno-621-30" name="__codelineno-621-30" href="#__codelineno-621-30"></a><span class="w">    </span><span class="p">{</span>
</span><span id="__span-621-31"><a id="__codelineno-621-31" name="__codelineno-621-31" href="#__codelineno-621-31"></a><span class="w">        </span><span class="k">this</span><span class="w"> </span><span class="p">[</span><span class="n">index</span><span class="p">].</span><span class="n">Zoo</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">null</span><span class="p">;</span>
</span><span id="__span-621-32"><a id="__codelineno-621-32" name="__codelineno-621-32" href="#__codelineno-621-32"></a><span class="w">        </span><span class="k">base</span><span class="p">.</span><span class="n">RemoveItem</span><span class="w"> </span><span class="p">(</span><span class="n">index</span><span class="p">);</span>
</span><span id="__span-621-33"><a id="__codelineno-621-33" name="__codelineno-621-33" href="#__codelineno-621-33"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-621-34"><a id="__codelineno-621-34" name="__codelineno-621-34" href="#__codelineno-621-34"></a><span class="w">    </span><span class="k">protected</span><span class="w"> </span><span class="k">override</span><span class="w"> </span><span class="k">void</span><span class="w"> </span><span class="nf">ClearItems</span><span class="p">()</span>
</span><span id="__span-621-35"><a id="__codelineno-621-35" name="__codelineno-621-35" href="#__codelineno-621-35"></a><span class="w">    </span><span class="p">{</span>
</span><span id="__span-621-36"><a id="__codelineno-621-36" name="__codelineno-621-36" href="#__codelineno-621-36"></a><span class="w">        </span><span class="k">foreach</span><span class="w"> </span><span class="p">(</span><span class="n">Animal</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="k">this</span><span class="p">)</span><span class="w"> </span><span class="n">a</span><span class="p">.</span><span class="n">Zoo</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">null</span><span class="p">;</span>
</span><span id="__span-621-37"><a id="__codelineno-621-37" name="__codelineno-621-37" href="#__codelineno-621-37"></a><span class="w">        </span><span class="k">base</span><span class="p">.</span><span class="n">ClearItems</span><span class="p">();</span>
</span><span id="__span-621-38"><a id="__codelineno-621-38" name="__codelineno-621-38" href="#__codelineno-621-38"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-621-39"><a id="__codelineno-621-39" name="__codelineno-621-39" href="#__codelineno-621-39"></a><span class="p">}</span>
</span><span id="__span-621-40"><a id="__codelineno-621-40" name="__codelineno-621-40" href="#__codelineno-621-40"></a>
</span><span id="__span-621-41"><a id="__codelineno-621-41" name="__codelineno-621-41" href="#__codelineno-621-41"></a><span class="k">public</span><span class="w"> </span><span class="k">class</span><span class="w"> </span><span class="nc">Zoo</span>
</span><span id="__span-621-42"><a id="__codelineno-621-42" name="__codelineno-621-42" href="#__codelineno-621-42"></a><span class="p">{</span>
</span><span id="__span-621-43"><a id="__codelineno-621-43" name="__codelineno-621-43" href="#__codelineno-621-43"></a><span class="w">    </span><span class="k">public</span><span class="w"> </span><span class="k">readonly</span><span class="w"> </span><span class="n">AnimalCollection</span><span class="w"> </span><span class="n">Animals</span><span class="p">;</span>
</span><span id="__span-621-44"><a id="__codelineno-621-44" name="__codelineno-621-44" href="#__codelineno-621-44"></a><span class="w">    </span><span class="k">public</span><span class="w"> </span><span class="nf">Zoo</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">Animals</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">AnimalCollection</span><span class="w"> </span><span class="p">(</span><span class="k">this</span><span class="p">);</span><span class="w"> </span><span class="p">}</span>
</span><span id="__span-621-45"><a id="__codelineno-621-45" name="__codelineno-621-45" href="#__codelineno-621-45"></a><span class="p">}</span>
</span><span id="__span-621-46"><a id="__codelineno-621-46" name="__codelineno-621-46" href="#__codelineno-621-46"></a>
</span><span id="__span-621-47"><a id="__codelineno-621-47" name="__codelineno-621-47" href="#__codelineno-621-47"></a><span class="k">static</span><span class="w"> </span><span class="k">void</span><span class="w"> </span><span class="nf">Main</span><span class="p">()</span>
</span><span id="__span-621-48"><a id="__codelineno-621-48" name="__codelineno-621-48" href="#__codelineno-621-48"></a><span class="p">{</span>
</span><span id="__span-621-49"><a id="__codelineno-621-49" name="__codelineno-621-49" href="#__codelineno-621-49"></a><span class="w">    </span><span class="n">Zoo</span><span class="w"> </span><span class="n">zoo</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">Zoo</span><span class="p">();</span>
</span><span id="__span-621-50"><a id="__codelineno-621-50" name="__codelineno-621-50" href="#__codelineno-621-50"></a><span class="w">    </span><span class="n">zoo</span><span class="p">.</span><span class="n">Animals</span><span class="p">.</span><span class="n">Add</span><span class="w"> </span><span class="p">(</span><span class="k">new</span><span class="w"> </span><span class="n">Animal</span><span class="w"> </span><span class="p">(</span><span class="s">&quot;Kangaroo&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">10</span><span class="p">));</span>
</span><span id="__span-621-51"><a id="__codelineno-621-51" name="__codelineno-621-51" href="#__codelineno-621-51"></a><span class="w">    </span><span class="n">zoo</span><span class="p">.</span><span class="n">Animals</span><span class="p">.</span><span class="n">Add</span><span class="w"> </span><span class="p">(</span><span class="k">new</span><span class="w"> </span><span class="n">Animal</span><span class="w"> </span><span class="p">(</span><span class="s">&quot;Mr Sea Lion&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">20</span><span class="p">));</span>
</span><span id="__span-621-52"><a id="__codelineno-621-52" name="__codelineno-621-52" href="#__codelineno-621-52"></a><span class="w">    </span><span class="k">foreach</span><span class="w"> </span><span class="p">(</span><span class="n">Animal</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">zoo</span><span class="p">.</span><span class="n">Animals</span><span class="p">)</span><span class="w"> </span><span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="w"> </span><span class="p">(</span><span class="n">a</span><span class="p">.</span><span class="n">Name</span><span class="p">);</span>
</span><span id="__span-621-53"><a id="__codelineno-621-53" name="__codelineno-621-53" href="#__codelineno-621-53"></a><span class="p">}</span>
</span></code></pre></div>
<h3 id="keyedcollection-and-dictionarybase">KeyedCollection<TKey,TItem> and DictionaryBase</h3>
<p>It both adds and subtracts functionality. What it adds is the ability to access items by key, much like
with a dictionary. What it subtracts is the ability to proxy your own inner list.</p>
<div class="language-csharp highlight"><pre><span></span><code><span id="__span-622-1"><a id="__codelineno-622-1" name="__codelineno-622-1" href="#__codelineno-622-1"></a><span class="k">public</span><span class="w"> </span><span class="k">class</span><span class="w"> </span><span class="nc">Animal</span>
</span><span id="__span-622-2"><a id="__codelineno-622-2" name="__codelineno-622-2" href="#__codelineno-622-2"></a><span class="p">{</span>
</span><span id="__span-622-3"><a id="__codelineno-622-3" name="__codelineno-622-3" href="#__codelineno-622-3"></a><span class="w">    </span><span class="kt">string</span><span class="w"> </span><span class="n">name</span><span class="p">;</span>
</span><span id="__span-622-4"><a id="__codelineno-622-4" name="__codelineno-622-4" href="#__codelineno-622-4"></a><span class="w">    </span><span class="k">public</span><span class="w"> </span><span class="kt">string</span><span class="w"> </span><span class="n">Name</span>
</span><span id="__span-622-5"><a id="__codelineno-622-5" name="__codelineno-622-5" href="#__codelineno-622-5"></a><span class="w">    </span><span class="p">{</span>
</span><span id="__span-622-6"><a id="__codelineno-622-6" name="__codelineno-622-6" href="#__codelineno-622-6"></a><span class="w">        </span><span class="k">get</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="n">name</span><span class="p">;</span><span class="w"> </span><span class="p">}</span>
</span><span id="__span-622-7"><a id="__codelineno-622-7" name="__codelineno-622-7" href="#__codelineno-622-7"></a><span class="w">        </span><span class="k">set</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-622-8"><a id="__codelineno-622-8" name="__codelineno-622-8" href="#__codelineno-622-8"></a><span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">Zoo</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="k">null</span><span class="p">)</span><span class="w"> </span><span class="n">Zoo</span><span class="p">.</span><span class="n">Animals</span><span class="p">.</span><span class="n">NotifyNameChange</span><span class="w"> </span><span class="p">(</span><span class="k">this</span><span class="p">,</span><span class="w"> </span><span class="k">value</span><span class="p">);</span>
</span><span id="__span-622-9"><a id="__codelineno-622-9" name="__codelineno-622-9" href="#__codelineno-622-9"></a><span class="w">            </span><span class="n">name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">value</span><span class="p">;</span>
</span><span id="__span-622-10"><a id="__codelineno-622-10" name="__codelineno-622-10" href="#__codelineno-622-10"></a><span class="w">        </span><span class="p">}</span>
</span><span id="__span-622-11"><a id="__codelineno-622-11" name="__codelineno-622-11" href="#__codelineno-622-11"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-622-12"><a id="__codelineno-622-12" name="__codelineno-622-12" href="#__codelineno-622-12"></a><span class="w">    </span><span class="k">public</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">Popularity</span><span class="p">;</span>
</span><span id="__span-622-13"><a id="__codelineno-622-13" name="__codelineno-622-13" href="#__codelineno-622-13"></a><span class="w">    </span><span class="k">public</span><span class="w"> </span><span class="n">Zoo</span><span class="w"> </span><span class="n">Zoo</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">get</span><span class="p">;</span><span class="w"> </span><span class="k">internal</span><span class="w"> </span><span class="k">set</span><span class="p">;</span><span class="w"> </span><span class="p">}</span>
</span><span id="__span-622-14"><a id="__codelineno-622-14" name="__codelineno-622-14" href="#__codelineno-622-14"></a>
</span><span id="__span-622-15"><a id="__codelineno-622-15" name="__codelineno-622-15" href="#__codelineno-622-15"></a><span class="w">    </span><span class="k">public</span><span class="w"> </span><span class="nf">Animal</span><span class="w"> </span><span class="p">(</span><span class="kt">string</span><span class="w"> </span><span class="n">name</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">popularity</span><span class="p">)</span>
</span><span id="__span-622-16"><a id="__codelineno-622-16" name="__codelineno-622-16" href="#__codelineno-622-16"></a><span class="w">    </span><span class="p">{</span>
</span><span id="__span-622-17"><a id="__codelineno-622-17" name="__codelineno-622-17" href="#__codelineno-622-17"></a><span class="w">        </span><span class="n">Name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">name</span><span class="p">;</span><span class="w"> </span><span class="n">Popularity</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">popularity</span><span class="p">;</span>
</span><span id="__span-622-18"><a id="__codelineno-622-18" name="__codelineno-622-18" href="#__codelineno-622-18"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-622-19"><a id="__codelineno-622-19" name="__codelineno-622-19" href="#__codelineno-622-19"></a><span class="p">}</span>
</span><span id="__span-622-20"><a id="__codelineno-622-20" name="__codelineno-622-20" href="#__codelineno-622-20"></a>
</span><span id="__span-622-21"><a id="__codelineno-622-21" name="__codelineno-622-21" href="#__codelineno-622-21"></a><span class="k">public</span><span class="w"> </span><span class="k">class</span><span class="w"> </span><span class="nc">AnimalCollection</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="n">KeyedCollection</span><span class="w"> </span><span class="o">&lt;</span><span class="kt">string</span><span class="p">,</span><span class="w"> </span><span class="n">Animal</span><span class="o">&gt;</span>
</span><span id="__span-622-22"><a id="__codelineno-622-22" name="__codelineno-622-22" href="#__codelineno-622-22"></a><span class="p">{</span>
</span><span id="__span-622-23"><a id="__codelineno-622-23" name="__codelineno-622-23" href="#__codelineno-622-23"></a><span class="w">    </span><span class="n">Zoo</span><span class="w"> </span><span class="n">zoo</span><span class="p">;</span>
</span><span id="__span-622-24"><a id="__codelineno-622-24" name="__codelineno-622-24" href="#__codelineno-622-24"></a><span class="w">    </span><span class="k">public</span><span class="w"> </span><span class="nf">AnimalCollection</span><span class="w"> </span><span class="p">(</span><span class="n">Zoo</span><span class="w"> </span><span class="n">zoo</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="n">zoo</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">zoo</span><span class="p">;</span><span class="w"> </span><span class="p">}</span>
</span><span id="__span-622-25"><a id="__codelineno-622-25" name="__codelineno-622-25" href="#__codelineno-622-25"></a>
</span><span id="__span-622-26"><a id="__codelineno-622-26" name="__codelineno-622-26" href="#__codelineno-622-26"></a><span class="w">    </span><span class="k">internal</span><span class="w"> </span><span class="k">void</span><span class="w"> </span><span class="nf">NotifyNameChange</span><span class="w"> </span><span class="p">(</span><span class="n">Animal</span><span class="w"> </span><span class="n">a</span><span class="p">,</span><span class="w"> </span><span class="kt">string</span><span class="w"> </span><span class="n">newName</span><span class="p">)</span>
</span><span id="__span-622-27"><a id="__codelineno-622-27" name="__codelineno-622-27" href="#__codelineno-622-27"></a><span class="w">    </span><span class="p">{</span>
</span><span id="__span-622-28"><a id="__codelineno-622-28" name="__codelineno-622-28" href="#__codelineno-622-28"></a><span class="w">        </span><span class="k">this</span><span class="p">.</span><span class="n">ChangeItemKey</span><span class="w"> </span><span class="p">(</span><span class="n">a</span><span class="p">,</span><span class="w"> </span><span class="n">newName</span><span class="p">);</span>
</span><span id="__span-622-29"><a id="__codelineno-622-29" name="__codelineno-622-29" href="#__codelineno-622-29"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-622-30"><a id="__codelineno-622-30" name="__codelineno-622-30" href="#__codelineno-622-30"></a>
</span><span id="__span-622-31"><a id="__codelineno-622-31" name="__codelineno-622-31" href="#__codelineno-622-31"></a><span class="w">    </span><span class="k">protected</span><span class="w"> </span><span class="k">override</span><span class="w"> </span><span class="kt">string</span><span class="w"> </span><span class="nf">GetKeyForItem</span><span class="w"> </span><span class="p">(</span><span class="n">Animal</span><span class="w"> </span><span class="n">item</span><span class="p">)</span>
</span><span id="__span-622-32"><a id="__codelineno-622-32" name="__codelineno-622-32" href="#__codelineno-622-32"></a><span class="w">    </span><span class="p">{</span>
</span><span id="__span-622-33"><a id="__codelineno-622-33" name="__codelineno-622-33" href="#__codelineno-622-33"></a><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">item</span><span class="p">.</span><span class="n">Name</span><span class="p">;</span>
</span><span id="__span-622-34"><a id="__codelineno-622-34" name="__codelineno-622-34" href="#__codelineno-622-34"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-622-35"><a id="__codelineno-622-35" name="__codelineno-622-35" href="#__codelineno-622-35"></a>
</span><span id="__span-622-36"><a id="__codelineno-622-36" name="__codelineno-622-36" href="#__codelineno-622-36"></a><span class="w">    </span><span class="k">protected</span><span class="w"> </span><span class="k">override</span><span class="w"> </span><span class="k">void</span><span class="w"> </span><span class="nf">InsertItem</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">index</span><span class="p">,</span><span class="w"> </span><span class="n">Animal</span><span class="w"> </span><span class="n">item</span><span class="p">)</span>
</span><span id="__span-622-37"><a id="__codelineno-622-37" name="__codelineno-622-37" href="#__codelineno-622-37"></a><span class="w">    </span><span class="p">{</span>
</span><span id="__span-622-38"><a id="__codelineno-622-38" name="__codelineno-622-38" href="#__codelineno-622-38"></a><span class="w">        </span><span class="k">base</span><span class="p">.</span><span class="n">InsertItem</span><span class="w"> </span><span class="p">(</span><span class="n">index</span><span class="p">,</span><span class="w"> </span><span class="n">item</span><span class="p">);</span>
</span><span id="__span-622-39"><a id="__codelineno-622-39" name="__codelineno-622-39" href="#__codelineno-622-39"></a><span class="w">        </span><span class="n">item</span><span class="p">.</span><span class="n">Zoo</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">zoo</span><span class="p">;</span>
</span><span id="__span-622-40"><a id="__codelineno-622-40" name="__codelineno-622-40" href="#__codelineno-622-40"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-622-41"><a id="__codelineno-622-41" name="__codelineno-622-41" href="#__codelineno-622-41"></a><span class="w">    </span><span class="k">protected</span><span class="w"> </span><span class="k">override</span><span class="w"> </span><span class="k">void</span><span class="w"> </span><span class="nf">SetItem</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">index</span><span class="p">,</span><span class="w"> </span><span class="n">Animal</span><span class="w"> </span><span class="n">item</span><span class="p">)</span>
</span><span id="__span-622-42"><a id="__codelineno-622-42" name="__codelineno-622-42" href="#__codelineno-622-42"></a><span class="w">    </span><span class="p">{</span>
</span><span id="__span-622-43"><a id="__codelineno-622-43" name="__codelineno-622-43" href="#__codelineno-622-43"></a><span class="w">        </span><span class="k">base</span><span class="p">.</span><span class="n">SetItem</span><span class="w"> </span><span class="p">(</span><span class="n">index</span><span class="p">,</span><span class="w"> </span><span class="n">item</span><span class="p">);</span>
</span><span id="__span-622-44"><a id="__codelineno-622-44" name="__codelineno-622-44" href="#__codelineno-622-44"></a><span class="w">        </span><span class="n">item</span><span class="p">.</span><span class="n">Zoo</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">zoo</span><span class="p">;</span>
</span><span id="__span-622-45"><a id="__codelineno-622-45" name="__codelineno-622-45" href="#__codelineno-622-45"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-622-46"><a id="__codelineno-622-46" name="__codelineno-622-46" href="#__codelineno-622-46"></a><span class="w">    </span><span class="k">protected</span><span class="w"> </span><span class="k">override</span><span class="w"> </span><span class="k">void</span><span class="w"> </span><span class="nf">RemoveItem</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">index</span><span class="p">)</span>
</span><span id="__span-622-47"><a id="__codelineno-622-47" name="__codelineno-622-47" href="#__codelineno-622-47"></a><span class="w">    </span><span class="p">{</span>
</span><span id="__span-622-48"><a id="__codelineno-622-48" name="__codelineno-622-48" href="#__codelineno-622-48"></a><span class="w">        </span><span class="k">this</span><span class="w"> </span><span class="p">[</span><span class="n">index</span><span class="p">].</span><span class="n">Zoo</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">null</span><span class="p">;</span>
</span><span id="__span-622-49"><a id="__codelineno-622-49" name="__codelineno-622-49" href="#__codelineno-622-49"></a><span class="w">        </span><span class="k">base</span><span class="p">.</span><span class="n">RemoveItem</span><span class="w"> </span><span class="p">(</span><span class="n">index</span><span class="p">);</span>
</span><span id="__span-622-50"><a id="__codelineno-622-50" name="__codelineno-622-50" href="#__codelineno-622-50"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-622-51"><a id="__codelineno-622-51" name="__codelineno-622-51" href="#__codelineno-622-51"></a><span class="w">    </span><span class="k">protected</span><span class="w"> </span><span class="k">override</span><span class="w"> </span><span class="k">void</span><span class="w"> </span><span class="nf">ClearItems</span><span class="p">()</span>
</span><span id="__span-622-52"><a id="__codelineno-622-52" name="__codelineno-622-52" href="#__codelineno-622-52"></a><span class="w">    </span><span class="p">{</span>
</span><span id="__span-622-53"><a id="__codelineno-622-53" name="__codelineno-622-53" href="#__codelineno-622-53"></a><span class="w">        </span><span class="k">foreach</span><span class="w"> </span><span class="p">(</span><span class="n">Animal</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="k">this</span><span class="p">)</span><span class="w"> </span><span class="n">a</span><span class="p">.</span><span class="n">Zoo</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">null</span><span class="p">;</span>
</span><span id="__span-622-54"><a id="__codelineno-622-54" name="__codelineno-622-54" href="#__codelineno-622-54"></a><span class="w">        </span><span class="k">base</span><span class="p">.</span><span class="n">ClearItems</span><span class="p">();</span>
</span><span id="__span-622-55"><a id="__codelineno-622-55" name="__codelineno-622-55" href="#__codelineno-622-55"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-622-56"><a id="__codelineno-622-56" name="__codelineno-622-56" href="#__codelineno-622-56"></a><span class="p">}</span>
</span><span id="__span-622-57"><a id="__codelineno-622-57" name="__codelineno-622-57" href="#__codelineno-622-57"></a>
</span><span id="__span-622-58"><a id="__codelineno-622-58" name="__codelineno-622-58" href="#__codelineno-622-58"></a><span class="k">public</span><span class="w"> </span><span class="k">class</span><span class="w"> </span><span class="nc">Zoo</span>
</span><span id="__span-622-59"><a id="__codelineno-622-59" name="__codelineno-622-59" href="#__codelineno-622-59"></a><span class="p">{</span>
</span><span id="__span-622-60"><a id="__codelineno-622-60" name="__codelineno-622-60" href="#__codelineno-622-60"></a><span class="w">    </span><span class="k">public</span><span class="w"> </span><span class="k">readonly</span><span class="w"> </span><span class="n">AnimalCollection</span><span class="w"> </span><span class="n">Animals</span><span class="p">;</span>
</span><span id="__span-622-61"><a id="__codelineno-622-61" name="__codelineno-622-61" href="#__codelineno-622-61"></a><span class="w">    </span><span class="k">public</span><span class="w"> </span><span class="nf">Zoo</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">Animals</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">AnimalCollection</span><span class="w"> </span><span class="p">(</span><span class="k">this</span><span class="p">);</span><span class="w"> </span><span class="p">}</span>
</span><span id="__span-622-62"><a id="__codelineno-622-62" name="__codelineno-622-62" href="#__codelineno-622-62"></a><span class="p">}</span>
</span><span id="__span-622-63"><a id="__codelineno-622-63" name="__codelineno-622-63" href="#__codelineno-622-63"></a>
</span><span id="__span-622-64"><a id="__codelineno-622-64" name="__codelineno-622-64" href="#__codelineno-622-64"></a><span class="k">static</span><span class="w"> </span><span class="k">void</span><span class="w"> </span><span class="nf">Main</span><span class="p">()</span>
</span><span id="__span-622-65"><a id="__codelineno-622-65" name="__codelineno-622-65" href="#__codelineno-622-65"></a><span class="p">{</span>
</span><span id="__span-622-66"><a id="__codelineno-622-66" name="__codelineno-622-66" href="#__codelineno-622-66"></a><span class="w">    </span><span class="n">Zoo</span><span class="w"> </span><span class="n">zoo</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">Zoo</span><span class="p">();</span>
</span><span id="__span-622-67"><a id="__codelineno-622-67" name="__codelineno-622-67" href="#__codelineno-622-67"></a><span class="w">    </span><span class="n">zoo</span><span class="p">.</span><span class="n">Animals</span><span class="p">.</span><span class="n">Add</span><span class="w"> </span><span class="p">(</span><span class="k">new</span><span class="w"> </span><span class="n">Animal</span><span class="w"> </span><span class="p">(</span><span class="s">&quot;Kangaroo&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">10</span><span class="p">));</span>
</span><span id="__span-622-68"><a id="__codelineno-622-68" name="__codelineno-622-68" href="#__codelineno-622-68"></a><span class="w">    </span><span class="n">zoo</span><span class="p">.</span><span class="n">Animals</span><span class="p">.</span><span class="n">Add</span><span class="w"> </span><span class="p">(</span><span class="k">new</span><span class="w"> </span><span class="n">Animal</span><span class="w"> </span><span class="p">(</span><span class="s">&quot;Mr Sea Lion&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">20</span><span class="p">));</span>
</span><span id="__span-622-69"><a id="__codelineno-622-69" name="__codelineno-622-69" href="#__codelineno-622-69"></a><span class="w">    </span><span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="w"> </span><span class="p">(</span><span class="n">zoo</span><span class="p">.</span><span class="n">Animals</span><span class="w"> </span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="n">Popularity</span><span class="p">);</span><span class="w">               </span><span class="c1">// 10</span>
</span><span id="__span-622-70"><a id="__codelineno-622-70" name="__codelineno-622-70" href="#__codelineno-622-70"></a><span class="w">    </span><span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="w"> </span><span class="p">(</span><span class="n">zoo</span><span class="p">.</span><span class="n">Animals</span><span class="w"> </span><span class="p">[</span><span class="s">&quot;Mr Sea Lion&quot;</span><span class="p">].</span><span class="n">Popularity</span><span class="p">);</span><span class="w">   </span><span class="c1">// 20</span>
</span><span id="__span-622-71"><a id="__codelineno-622-71" name="__codelineno-622-71" href="#__codelineno-622-71"></a><span class="w">    </span><span class="n">zoo</span><span class="p">.</span><span class="n">Animals</span><span class="w"> </span><span class="p">[</span><span class="s">&quot;Kangaroo&quot;</span><span class="p">].</span><span class="n">Name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;Mr Roo&quot;</span><span class="p">;</span>
</span><span id="__span-622-72"><a id="__codelineno-622-72" name="__codelineno-622-72" href="#__codelineno-622-72"></a><span class="w">    </span><span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="w"> </span><span class="p">(</span><span class="n">zoo</span><span class="p">.</span><span class="n">Animals</span><span class="w"> </span><span class="p">[</span><span class="s">&quot;Mr Roo&quot;</span><span class="p">].</span><span class="n">Popularity</span><span class="p">);</span><span class="w">        </span><span class="c1">// 10</span>
</span><span id="__span-622-73"><a id="__codelineno-622-73" name="__codelineno-622-73" href="#__codelineno-622-73"></a><span class="p">}</span>
</span></code></pre></div>
<h3 id="readonlycollection">ReadOnlyCollection<T></h3>
<p>ReadOnlyCollection is a wrapper, or proxy, that provides a read-only view of a collection. This is 
useful in allowing a class to publicly expose read-only access to a collection that the class can still update internally. 
A read-only collection accepts the input collection in its constructor, to which it maintains a permanent reference. It doesnâ€™t take a static copy of the input collection, so subsequent changes to the input collection are visible through the read-only wrapper.</p>
<div class="language-csharp highlight"><pre><span></span><code><span id="__span-623-1"><a id="__codelineno-623-1" name="__codelineno-623-1" href="#__codelineno-623-1"></a><span class="k">public</span><span class="w"> </span><span class="k">class</span><span class="w"> </span><span class="nc">Test</span>
</span><span id="__span-623-2"><a id="__codelineno-623-2" name="__codelineno-623-2" href="#__codelineno-623-2"></a><span class="p">{</span>
</span><span id="__span-623-3"><a id="__codelineno-623-3" name="__codelineno-623-3" href="#__codelineno-623-3"></a><span class="w">    </span><span class="n">List</span><span class="o">&lt;</span><span class="kt">string</span><span class="o">&gt;</span><span class="w"> </span><span class="n">names</span><span class="p">;</span>
</span><span id="__span-623-4"><a id="__codelineno-623-4" name="__codelineno-623-4" href="#__codelineno-623-4"></a><span class="w">    </span><span class="k">public</span><span class="w"> </span><span class="n">ReadOnlyCollection</span><span class="o">&lt;</span><span class="kt">string</span><span class="o">&gt;</span><span class="w"> </span><span class="n">Names</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">get</span><span class="p">;</span><span class="w"> </span><span class="k">private</span><span class="w"> </span><span class="k">set</span><span class="p">;</span><span class="w"> </span><span class="p">}</span>
</span><span id="__span-623-5"><a id="__codelineno-623-5" name="__codelineno-623-5" href="#__codelineno-623-5"></a>
</span><span id="__span-623-6"><a id="__codelineno-623-6" name="__codelineno-623-6" href="#__codelineno-623-6"></a><span class="w">    </span><span class="k">public</span><span class="w"> </span><span class="nf">Test</span><span class="p">()</span>
</span><span id="__span-623-7"><a id="__codelineno-623-7" name="__codelineno-623-7" href="#__codelineno-623-7"></a><span class="w">    </span><span class="p">{</span>
</span><span id="__span-623-8"><a id="__codelineno-623-8" name="__codelineno-623-8" href="#__codelineno-623-8"></a><span class="w">        </span><span class="n">names</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">List</span><span class="o">&lt;</span><span class="kt">string</span><span class="o">&gt;</span><span class="p">();</span>
</span><span id="__span-623-9"><a id="__codelineno-623-9" name="__codelineno-623-9" href="#__codelineno-623-9"></a><span class="w">        </span><span class="n">Names</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">ReadOnlyCollection</span><span class="o">&lt;</span><span class="kt">string</span><span class="o">&gt;</span><span class="w"> </span><span class="p">(</span><span class="n">names</span><span class="p">);</span>
</span><span id="__span-623-10"><a id="__codelineno-623-10" name="__codelineno-623-10" href="#__codelineno-623-10"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-623-11"><a id="__codelineno-623-11" name="__codelineno-623-11" href="#__codelineno-623-11"></a>
</span><span id="__span-623-12"><a id="__codelineno-623-12" name="__codelineno-623-12" href="#__codelineno-623-12"></a><span class="w">    </span><span class="k">public</span><span class="w"> </span><span class="k">void</span><span class="w"> </span><span class="nf">AddInternally</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">names</span><span class="p">.</span><span class="n">Add</span><span class="w"> </span><span class="p">(</span><span class="s">&quot;test&quot;</span><span class="p">);</span><span class="w"> </span><span class="p">}</span>
</span><span id="__span-623-13"><a id="__codelineno-623-13" name="__codelineno-623-13" href="#__codelineno-623-13"></a><span class="p">}</span>
</span><span id="__span-623-14"><a id="__codelineno-623-14" name="__codelineno-623-14" href="#__codelineno-623-14"></a>
</span><span id="__span-623-15"><a id="__codelineno-623-15" name="__codelineno-623-15" href="#__codelineno-623-15"></a><span class="k">void</span><span class="w"> </span><span class="nf">Main</span><span class="p">()</span>
</span><span id="__span-623-16"><a id="__codelineno-623-16" name="__codelineno-623-16" href="#__codelineno-623-16"></a><span class="p">{</span>
</span><span id="__span-623-17"><a id="__codelineno-623-17" name="__codelineno-623-17" href="#__codelineno-623-17"></a><span class="w">    </span><span class="n">Test</span><span class="w"> </span><span class="n">t</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">Test</span><span class="p">();</span>
</span><span id="__span-623-18"><a id="__codelineno-623-18" name="__codelineno-623-18" href="#__codelineno-623-18"></a>
</span><span id="__span-623-19"><a id="__codelineno-623-19" name="__codelineno-623-19" href="#__codelineno-623-19"></a><span class="w">    </span><span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="w"> </span><span class="p">(</span><span class="n">t</span><span class="p">.</span><span class="n">Names</span><span class="p">.</span><span class="n">Count</span><span class="p">);</span><span class="w">       </span><span class="c1">// 0</span>
</span><span id="__span-623-20"><a id="__codelineno-623-20" name="__codelineno-623-20" href="#__codelineno-623-20"></a><span class="w">    </span><span class="n">t</span><span class="p">.</span><span class="n">AddInternally</span><span class="p">();</span>
</span><span id="__span-623-21"><a id="__codelineno-623-21" name="__codelineno-623-21" href="#__codelineno-623-21"></a><span class="w">    </span><span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="w"> </span><span class="p">(</span><span class="n">t</span><span class="p">.</span><span class="n">Names</span><span class="p">.</span><span class="n">Count</span><span class="p">);</span><span class="w">       </span><span class="c1">// 1</span>
</span><span id="__span-623-22"><a id="__codelineno-623-22" name="__codelineno-623-22" href="#__codelineno-623-22"></a>
</span><span id="__span-623-23"><a id="__codelineno-623-23" name="__codelineno-623-23" href="#__codelineno-623-23"></a><span class="w">    </span><span class="n">t</span><span class="p">.</span><span class="n">Names</span><span class="p">.</span><span class="n">Add</span><span class="w"> </span><span class="p">(</span><span class="s">&quot;test&quot;</span><span class="p">);</span><span class="w">                    </span><span class="c1">// Compiler error</span>
</span><span id="__span-623-24"><a id="__codelineno-623-24" name="__codelineno-623-24" href="#__codelineno-623-24"></a><span class="w">    </span><span class="p">((</span><span class="n">IList</span><span class="o">&lt;</span><span class="kt">string</span><span class="o">&gt;</span><span class="p">)</span><span class="w"> </span><span class="n">t</span><span class="p">.</span><span class="n">Names</span><span class="p">).</span><span class="n">Add</span><span class="w"> </span><span class="p">(</span><span class="s">&quot;test&quot;</span><span class="p">);</span><span class="w">  </span><span class="c1">// NotSupportedException</span>
</span><span id="__span-623-25"><a id="__codelineno-623-25" name="__codelineno-623-25" href="#__codelineno-623-25"></a><span class="p">}</span>
</span></code></pre></div>
<h1 id="immutable-collections">Immutable Collections</h1>
<p>The immutable collections extend this principle, by providing collections that cannot be modified at all after initialization. Should you need to add an item to an immutable collection, you must instantiate a new collection, leaving the old one untouched.</p>
<p>Immutability is a hallmark of functional programming and has the following benefits</p>
<ul>
<li>It eliminates a large class of bugs associated with changing state.</li>
<li>It vastly simplifies parallelism and multithreading, by avoiding most of the thread-safety problems</li>
<li>It makes code easier to reason about.</li>
</ul>
<p>The disadvantage of immutability is that when you need to make a change, you must create a whole new object. This incurs a performance hit, although there are mitigating strategies that we discuss in this section, including the ability to reuse portions of the original structure.</p>
<h3 id="creating-immutable-collections">Creating Immutable Collections</h3>
<p>Each immutable collection type offers a Create() method, which accepts optional initial values and returns an initialized immutable collection</p>
<div class="language-csharp highlight"><pre><span></span><code><span id="__span-624-1"><a id="__codelineno-624-1" name="__codelineno-624-1" href="#__codelineno-624-1"></a><span class="n">ImmutableArray</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span><span class="w"> </span><span class="n">array</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ImmutableArray</span><span class="p">.</span><span class="n">Create</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span><span class="w"> </span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="mi">3</span><span class="p">);</span>
</span><span id="__span-624-2"><a id="__codelineno-624-2" name="__codelineno-624-2" href="#__codelineno-624-2"></a><span class="kt">var</span><span class="w"> </span><span class="n">list</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="p">[]</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="mi">3</span><span class="w"> </span><span class="p">}.</span><span class="n">ToImmutableList</span><span class="p">();</span>
</span></code></pre></div>
<h3 id="manipulating-immutable-collections">Manipulating Immutable Collections</h3>
<div class="language-csharp highlight"><pre><span></span><code><span id="__span-625-1"><a id="__codelineno-625-1" name="__codelineno-625-1" href="#__codelineno-625-1"></a><span class="kt">var</span><span class="w"> </span><span class="n">oldList</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ImmutableList</span><span class="p">.</span><span class="n">Create</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span><span class="w"> </span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="mi">3</span><span class="p">);</span>
</span><span id="__span-625-2"><a id="__codelineno-625-2" name="__codelineno-625-2" href="#__codelineno-625-2"></a>
</span><span id="__span-625-3"><a id="__codelineno-625-3" name="__codelineno-625-3" href="#__codelineno-625-3"></a><span class="n">ImmutableList</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span><span class="w"> </span><span class="n">newList</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">oldList</span><span class="p">.</span><span class="n">Add</span><span class="w"> </span><span class="p">(</span><span class="mi">4</span><span class="p">);</span>
</span><span id="__span-625-4"><a id="__codelineno-625-4" name="__codelineno-625-4" href="#__codelineno-625-4"></a>
</span><span id="__span-625-5"><a id="__codelineno-625-5" name="__codelineno-625-5" href="#__codelineno-625-5"></a><span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="w"> </span><span class="p">(</span><span class="n">oldList</span><span class="p">.</span><span class="n">Count</span><span class="p">);</span><span class="w">     </span><span class="c1">// 3  (unaltered)</span>
</span><span id="__span-625-6"><a id="__codelineno-625-6" name="__codelineno-625-6" href="#__codelineno-625-6"></a><span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="w"> </span><span class="p">(</span><span class="n">newList</span><span class="p">.</span><span class="n">Count</span><span class="p">);</span><span class="w">     </span><span class="c1">// 4</span>
</span><span id="__span-625-7"><a id="__codelineno-625-7" name="__codelineno-625-7" href="#__codelineno-625-7"></a>
</span><span id="__span-625-8"><a id="__codelineno-625-8" name="__codelineno-625-8" href="#__codelineno-625-8"></a><span class="kt">var</span><span class="w"> </span><span class="n">anotherList</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">oldList</span><span class="p">.</span><span class="n">AddRange</span><span class="w"> </span><span class="p">(</span><span class="k">new</span><span class="p">[]</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="mi">4</span><span class="p">,</span><span class="w"> </span><span class="mi">5</span><span class="p">,</span><span class="w"> </span><span class="mi">6</span><span class="w"> </span><span class="p">});</span>
</span></code></pre></div>
<h3 id="builders">Builders</h3>
<div class="language-csharp highlight"><pre><span></span><code><span id="__span-626-1"><a id="__codelineno-626-1" name="__codelineno-626-1" href="#__codelineno-626-1"></a><span class="n">ImmutableArray</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span><span class="p">.</span><span class="n">Builder</span><span class="w"> </span><span class="n">builder</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ImmutableArray</span><span class="p">.</span><span class="n">CreateBuilder</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span><span class="p">();</span>
</span><span id="__span-626-2"><a id="__codelineno-626-2" name="__codelineno-626-2" href="#__codelineno-626-2"></a><span class="n">builder</span><span class="p">.</span><span class="n">Add</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>
</span><span id="__span-626-3"><a id="__codelineno-626-3" name="__codelineno-626-3" href="#__codelineno-626-3"></a><span class="n">builder</span><span class="p">.</span><span class="n">Add</span><span class="p">(</span><span class="mi">2</span><span class="p">);</span>
</span><span id="__span-626-4"><a id="__codelineno-626-4" name="__codelineno-626-4" href="#__codelineno-626-4"></a><span class="n">builder</span><span class="p">.</span><span class="n">Add</span><span class="p">(</span><span class="mi">3</span><span class="p">);</span>
</span><span id="__span-626-5"><a id="__codelineno-626-5" name="__codelineno-626-5" href="#__codelineno-626-5"></a><span class="n">builder</span><span class="p">.</span><span class="n">RemoveAt</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>
</span><span id="__span-626-6"><a id="__codelineno-626-6" name="__codelineno-626-6" href="#__codelineno-626-6"></a><span class="n">ImmutableArray</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span><span class="w"> </span><span class="n">myImmutable</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">builder</span><span class="p">.</span><span class="n">ToImmutable</span><span class="p">();</span>
</span><span id="__span-626-7"><a id="__codelineno-626-7" name="__codelineno-626-7" href="#__codelineno-626-7"></a>
</span><span id="__span-626-8"><a id="__codelineno-626-8" name="__codelineno-626-8" href="#__codelineno-626-8"></a><span class="n">myImmutable</span><span class="p">.</span><span class="n">Dump</span><span class="p">();</span>
</span><span id="__span-626-9"><a id="__codelineno-626-9" name="__codelineno-626-9" href="#__codelineno-626-9"></a>
</span><span id="__span-626-10"><a id="__codelineno-626-10" name="__codelineno-626-10" href="#__codelineno-626-10"></a><span class="kt">var</span><span class="w"> </span><span class="n">builder2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">myImmutable</span><span class="p">.</span><span class="n">ToBuilder</span><span class="p">();</span>
</span><span id="__span-626-11"><a id="__codelineno-626-11" name="__codelineno-626-11" href="#__codelineno-626-11"></a><span class="n">builder2</span><span class="p">.</span><span class="n">Add</span><span class="w"> </span><span class="p">(</span><span class="mi">4</span><span class="p">);</span><span class="w">      </span><span class="c1">// Efficient</span>
</span><span id="__span-626-12"><a id="__codelineno-626-12" name="__codelineno-626-12" href="#__codelineno-626-12"></a><span class="n">builder2</span><span class="p">.</span><span class="n">Remove</span><span class="w"> </span><span class="p">(</span><span class="mi">2</span><span class="p">);</span><span class="w">   </span><span class="c1">// Efficient</span>
</span><span id="__span-626-13"><a id="__codelineno-626-13" name="__codelineno-626-13" href="#__codelineno-626-13"></a><span class="c1">// ...                  // More changes to builder...</span>
</span><span id="__span-626-14"><a id="__codelineno-626-14" name="__codelineno-626-14" href="#__codelineno-626-14"></a><span class="c1">// Return a new immutable collection with all the changes applied:</span>
</span><span id="__span-626-15"><a id="__codelineno-626-15" name="__codelineno-626-15" href="#__codelineno-626-15"></a><span class="n">ImmutableArray</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span><span class="w"> </span><span class="n">myImmutable2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">builder2</span><span class="p">.</span><span class="n">ToImmutable</span><span class="p">().</span><span class="n">Dump</span><span class="p">();</span>
</span></code></pre></div>
<h3 id="immutable-collections-and-performance">Immutable Collections and Performance</h3>
<p>Most of the immutable collections use an AVL tree internally, which allows the add/remove operations to reuse portions of the original internal structure rather than having to re-create the entire thing from scratch. This reduces the overhead of add/remove operations from potentially huge (with large collections) to just moderately large, but it comes at the cost of making read operations slower. The end result is that most immutable collections are slower than their mutable counterparts for both reading and writing.</p>
<p>The most seriously affected is ImmutableList , which for both read and add operations is 10 to 200 times slower than List (depending on the size of the list). This is why ImmutableArray exists: by using an array inside, it avoids the overhead for read operations (for which itâ€™s comparable in performance to an ordinary mutable array). The flip side is that itâ€™s much slower than (even) Immutable List for add operations because none of the original structure can be reused.</p>
<p>Calling Remove on an ImmutableArray is more expensive than calling Remove on a List even in the worst-case scenario of removing the first elementâ€”because allocating the new collection places additional load on the garbage collector.</p>
<p>Although the immutable collections as a whole incur a potentially significant performance cost, itâ€™s important to keep the overall magnitude in perspective. An Add operation on an ImmutableList with a million elements is still likely to occur in less than a microsecond on a typical laptop, and a read operation, in less than 100 nanoseconds. And, if you need to perform write operations in a loop, you can avoid the accumulated cost with a builder.</p>
<p>The following factors also work to mitigate the costs</p>
<ul>
<li>Immutability allows for easy concurrency and parallelization (Chapter 23), so you can employ all available cores. Parallelizing with mutable state easily leads to errors, and requires the use of locks or concurrent collections, both of which hurt performance.</li>
<li>With immutability, you donâ€™t need to â€œdefensively copyâ€ collections or data structures to guard against unexpected change. This was a factor in favoring the use of immutable collections in writing recent portions of Visual Studio.</li>
<li>In most typical programs, few collections have enough items for the difference to matter</li>
</ul>
<h1 id="plugging-in-equality-and-order">Plugging in Equality and Order</h1>
<p>IEqualityComparer and IEqualityComparer<T></p>
<ul>
<li>Performs plug-in equality comparison and hashing</li>
<li>Recognized by Hashtable and Dictionary</li>
</ul>
<p>IComparer and IComparer<T></p>
<ul>
<li>Performs plug-in order comparison</li>
<li>Recognized by the sorted dictionaries and collections; also, <code>Array.Sort</code></li>
</ul>
<div class="language-csharp highlight"><pre><span></span><code><span id="__span-627-1"><a id="__codelineno-627-1" name="__codelineno-627-1" href="#__codelineno-627-1"></a><span class="k">public</span><span class="w"> </span><span class="k">class</span><span class="w"> </span><span class="nc">Customer</span>
</span><span id="__span-627-2"><a id="__codelineno-627-2" name="__codelineno-627-2" href="#__codelineno-627-2"></a><span class="p">{</span>
</span><span id="__span-627-3"><a id="__codelineno-627-3" name="__codelineno-627-3" href="#__codelineno-627-3"></a><span class="w">    </span><span class="k">public</span><span class="w"> </span><span class="kt">string</span><span class="w"> </span><span class="n">LastName</span><span class="p">;</span>
</span><span id="__span-627-4"><a id="__codelineno-627-4" name="__codelineno-627-4" href="#__codelineno-627-4"></a><span class="w">    </span><span class="k">public</span><span class="w"> </span><span class="kt">string</span><span class="w"> </span><span class="n">FirstName</span><span class="p">;</span>
</span><span id="__span-627-5"><a id="__codelineno-627-5" name="__codelineno-627-5" href="#__codelineno-627-5"></a>
</span><span id="__span-627-6"><a id="__codelineno-627-6" name="__codelineno-627-6" href="#__codelineno-627-6"></a><span class="w">    </span><span class="k">public</span><span class="w"> </span><span class="nf">Customer</span><span class="w"> </span><span class="p">(</span><span class="kt">string</span><span class="w"> </span><span class="n">last</span><span class="p">,</span><span class="w"> </span><span class="kt">string</span><span class="w"> </span><span class="n">first</span><span class="p">)</span>
</span><span id="__span-627-7"><a id="__codelineno-627-7" name="__codelineno-627-7" href="#__codelineno-627-7"></a><span class="w">    </span><span class="p">{</span>
</span><span id="__span-627-8"><a id="__codelineno-627-8" name="__codelineno-627-8" href="#__codelineno-627-8"></a><span class="w">        </span><span class="n">LastName</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">last</span><span class="p">;</span>
</span><span id="__span-627-9"><a id="__codelineno-627-9" name="__codelineno-627-9" href="#__codelineno-627-9"></a><span class="w">        </span><span class="n">FirstName</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">first</span><span class="p">;</span>
</span><span id="__span-627-10"><a id="__codelineno-627-10" name="__codelineno-627-10" href="#__codelineno-627-10"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-627-11"><a id="__codelineno-627-11" name="__codelineno-627-11" href="#__codelineno-627-11"></a><span class="p">}</span>
</span><span id="__span-627-12"><a id="__codelineno-627-12" name="__codelineno-627-12" href="#__codelineno-627-12"></a><span class="k">public</span><span class="w"> </span><span class="k">class</span><span class="w"> </span><span class="nc">LastFirstEqComparer</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="n">EqualityComparer</span><span class="w"> </span><span class="o">&lt;</span><span class="n">Customer</span><span class="o">&gt;</span>
</span><span id="__span-627-13"><a id="__codelineno-627-13" name="__codelineno-627-13" href="#__codelineno-627-13"></a><span class="p">{</span>
</span><span id="__span-627-14"><a id="__codelineno-627-14" name="__codelineno-627-14" href="#__codelineno-627-14"></a><span class="w">    </span><span class="k">public</span><span class="w"> </span><span class="k">override</span><span class="w"> </span><span class="kt">bool</span><span class="w"> </span><span class="nf">Equals</span><span class="w"> </span><span class="p">(</span><span class="n">Customer</span><span class="w"> </span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="n">Customer</span><span class="w"> </span><span class="n">y</span><span class="p">)</span>
</span><span id="__span-627-15"><a id="__codelineno-627-15" name="__codelineno-627-15" href="#__codelineno-627-15"></a><span class="w">        </span><span class="o">=&gt;</span><span class="w"> </span><span class="n">x</span><span class="p">.</span><span class="n">LastName</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">y</span><span class="p">.</span><span class="n">LastName</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">x</span><span class="p">.</span><span class="n">FirstName</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">y</span><span class="p">.</span><span class="n">FirstName</span><span class="p">;</span>
</span><span id="__span-627-16"><a id="__codelineno-627-16" name="__codelineno-627-16" href="#__codelineno-627-16"></a>
</span><span id="__span-627-17"><a id="__codelineno-627-17" name="__codelineno-627-17" href="#__codelineno-627-17"></a><span class="w">    </span><span class="k">public</span><span class="w"> </span><span class="k">override</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="nf">GetHashCode</span><span class="w"> </span><span class="p">(</span><span class="n">Customer</span><span class="w"> </span><span class="n">obj</span><span class="p">)</span>
</span><span id="__span-627-18"><a id="__codelineno-627-18" name="__codelineno-627-18" href="#__codelineno-627-18"></a><span class="w">        </span><span class="o">=&gt;</span><span class="w"> </span><span class="p">(</span><span class="n">obj</span><span class="p">.</span><span class="n">LastName</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s">&quot;;&quot;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">obj</span><span class="p">.</span><span class="n">FirstName</span><span class="p">).</span><span class="n">GetHashCode</span><span class="p">();</span>
</span><span id="__span-627-19"><a id="__codelineno-627-19" name="__codelineno-627-19" href="#__codelineno-627-19"></a><span class="p">}</span>
</span><span id="__span-627-20"><a id="__codelineno-627-20" name="__codelineno-627-20" href="#__codelineno-627-20"></a>
</span><span id="__span-627-21"><a id="__codelineno-627-21" name="__codelineno-627-21" href="#__codelineno-627-21"></a><span class="k">void</span><span class="w"> </span><span class="nf">Main</span><span class="p">()</span>
</span><span id="__span-627-22"><a id="__codelineno-627-22" name="__codelineno-627-22" href="#__codelineno-627-22"></a><span class="p">{</span>
</span><span id="__span-627-23"><a id="__codelineno-627-23" name="__codelineno-627-23" href="#__codelineno-627-23"></a><span class="w">    </span><span class="n">Customer</span><span class="w"> </span><span class="n">c1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">Customer</span><span class="w"> </span><span class="p">(</span><span class="s">&quot;Bloggs&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Joe&quot;</span><span class="p">);</span>
</span><span id="__span-627-24"><a id="__codelineno-627-24" name="__codelineno-627-24" href="#__codelineno-627-24"></a><span class="w">    </span><span class="n">Customer</span><span class="w"> </span><span class="n">c2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">Customer</span><span class="w"> </span><span class="p">(</span><span class="s">&quot;Bloggs&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Joe&quot;</span><span class="p">);</span>
</span><span id="__span-627-25"><a id="__codelineno-627-25" name="__codelineno-627-25" href="#__codelineno-627-25"></a>
</span><span id="__span-627-26"><a id="__codelineno-627-26" name="__codelineno-627-26" href="#__codelineno-627-26"></a><span class="w">    </span><span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="w"> </span><span class="p">(</span><span class="n">c1</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">c2</span><span class="p">);</span><span class="w">               </span><span class="c1">// False</span>
</span><span id="__span-627-27"><a id="__codelineno-627-27" name="__codelineno-627-27" href="#__codelineno-627-27"></a><span class="w">    </span><span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="w"> </span><span class="p">(</span><span class="n">c1</span><span class="p">.</span><span class="n">Equals</span><span class="w"> </span><span class="p">(</span><span class="n">c2</span><span class="p">));</span><span class="w">         </span><span class="c1">// False</span>
</span><span id="__span-627-28"><a id="__codelineno-627-28" name="__codelineno-627-28" href="#__codelineno-627-28"></a>
</span><span id="__span-627-29"><a id="__codelineno-627-29" name="__codelineno-627-29" href="#__codelineno-627-29"></a><span class="w">    </span><span class="kt">var</span><span class="w"> </span><span class="n">d</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">Dictionary</span><span class="o">&lt;</span><span class="n">Customer</span><span class="p">,</span><span class="w"> </span><span class="kt">string</span><span class="o">&gt;</span><span class="p">();</span>
</span><span id="__span-627-30"><a id="__codelineno-627-30" name="__codelineno-627-30" href="#__codelineno-627-30"></a><span class="w">    </span><span class="n">d</span><span class="w"> </span><span class="p">[</span><span class="n">c1</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;Joe&quot;</span><span class="p">;</span>
</span><span id="__span-627-31"><a id="__codelineno-627-31" name="__codelineno-627-31" href="#__codelineno-627-31"></a><span class="w">    </span><span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="w"> </span><span class="p">(</span><span class="n">d</span><span class="p">.</span><span class="n">ContainsKey</span><span class="w"> </span><span class="p">(</span><span class="n">c2</span><span class="p">));</span><span class="w">         </span><span class="c1">// False</span>
</span><span id="__span-627-32"><a id="__codelineno-627-32" name="__codelineno-627-32" href="#__codelineno-627-32"></a>
</span><span id="__span-627-33"><a id="__codelineno-627-33" name="__codelineno-627-33" href="#__codelineno-627-33"></a><span class="w">    </span><span class="kt">var</span><span class="w"> </span><span class="n">eqComparer</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">LastFirstEqComparer</span><span class="p">();</span>
</span><span id="__span-627-34"><a id="__codelineno-627-34" name="__codelineno-627-34" href="#__codelineno-627-34"></a><span class="w">    </span><span class="n">d</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">Dictionary</span><span class="o">&lt;</span><span class="n">Customer</span><span class="p">,</span><span class="w"> </span><span class="kt">string</span><span class="o">&gt;</span><span class="w"> </span><span class="p">(</span><span class="n">eqComparer</span><span class="p">);</span>
</span><span id="__span-627-35"><a id="__codelineno-627-35" name="__codelineno-627-35" href="#__codelineno-627-35"></a><span class="w">    </span><span class="n">d</span><span class="w"> </span><span class="p">[</span><span class="n">c1</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;Joe&quot;</span><span class="p">;</span>
</span><span id="__span-627-36"><a id="__codelineno-627-36" name="__codelineno-627-36" href="#__codelineno-627-36"></a><span class="w">    </span><span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="w"> </span><span class="p">(</span><span class="n">d</span><span class="p">.</span><span class="n">ContainsKey</span><span class="w"> </span><span class="p">(</span><span class="n">c2</span><span class="p">));</span><span class="w">         </span><span class="c1">// True</span>
</span><span id="__span-627-37"><a id="__codelineno-627-37" name="__codelineno-627-37" href="#__codelineno-627-37"></a><span class="p">}</span>
</span></code></pre></div>
<h3 id="icomparer-and-comparer">IComparer and Comparer</h3>
<p>Comparers are used to switch in custom ordering logic for sorted dictionaries and
collections</p>
<div class="language-csharp highlight"><pre><span></span><code><span id="__span-628-1"><a id="__codelineno-628-1" name="__codelineno-628-1" href="#__codelineno-628-1"></a><span class="k">class</span><span class="w"> </span><span class="nc">Wish</span>
</span><span id="__span-628-2"><a id="__codelineno-628-2" name="__codelineno-628-2" href="#__codelineno-628-2"></a><span class="p">{</span>
</span><span id="__span-628-3"><a id="__codelineno-628-3" name="__codelineno-628-3" href="#__codelineno-628-3"></a><span class="w">    </span><span class="k">public</span><span class="w"> </span><span class="kt">string</span><span class="w"> </span><span class="n">Name</span><span class="p">;</span>
</span><span id="__span-628-4"><a id="__codelineno-628-4" name="__codelineno-628-4" href="#__codelineno-628-4"></a><span class="w">    </span><span class="k">public</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">Priority</span><span class="p">;</span>
</span><span id="__span-628-5"><a id="__codelineno-628-5" name="__codelineno-628-5" href="#__codelineno-628-5"></a>
</span><span id="__span-628-6"><a id="__codelineno-628-6" name="__codelineno-628-6" href="#__codelineno-628-6"></a><span class="w">    </span><span class="k">public</span><span class="w"> </span><span class="nf">Wish</span><span class="w"> </span><span class="p">(</span><span class="kt">string</span><span class="w"> </span><span class="n">name</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">priority</span><span class="p">)</span>
</span><span id="__span-628-7"><a id="__codelineno-628-7" name="__codelineno-628-7" href="#__codelineno-628-7"></a><span class="w">    </span><span class="p">{</span>
</span><span id="__span-628-8"><a id="__codelineno-628-8" name="__codelineno-628-8" href="#__codelineno-628-8"></a><span class="w">        </span><span class="n">Name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">name</span><span class="p">;</span>
</span><span id="__span-628-9"><a id="__codelineno-628-9" name="__codelineno-628-9" href="#__codelineno-628-9"></a><span class="w">        </span><span class="n">Priority</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">priority</span><span class="p">;</span>
</span><span id="__span-628-10"><a id="__codelineno-628-10" name="__codelineno-628-10" href="#__codelineno-628-10"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-628-11"><a id="__codelineno-628-11" name="__codelineno-628-11" href="#__codelineno-628-11"></a><span class="p">}</span>
</span><span id="__span-628-12"><a id="__codelineno-628-12" name="__codelineno-628-12" href="#__codelineno-628-12"></a>
</span><span id="__span-628-13"><a id="__codelineno-628-13" name="__codelineno-628-13" href="#__codelineno-628-13"></a><span class="k">class</span><span class="w"> </span><span class="nc">PriorityComparer</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="n">Comparer</span><span class="w"> </span><span class="o">&lt;</span><span class="n">Wish</span><span class="o">&gt;</span>
</span><span id="__span-628-14"><a id="__codelineno-628-14" name="__codelineno-628-14" href="#__codelineno-628-14"></a><span class="p">{</span>
</span><span id="__span-628-15"><a id="__codelineno-628-15" name="__codelineno-628-15" href="#__codelineno-628-15"></a><span class="w">    </span><span class="k">public</span><span class="w"> </span><span class="k">override</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="nf">Compare</span><span class="w"> </span><span class="p">(</span><span class="n">Wish</span><span class="w"> </span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="n">Wish</span><span class="w"> </span><span class="n">y</span><span class="p">)</span>
</span><span id="__span-628-16"><a id="__codelineno-628-16" name="__codelineno-628-16" href="#__codelineno-628-16"></a><span class="w">    </span><span class="p">{</span>
</span><span id="__span-628-17"><a id="__codelineno-628-17" name="__codelineno-628-17" href="#__codelineno-628-17"></a><span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="kt">object</span><span class="p">.</span><span class="n">Equals</span><span class="w"> </span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="p">))</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w">          </span><span class="c1">// Fail-safe check</span>
</span><span id="__span-628-18"><a id="__codelineno-628-18" name="__codelineno-628-18" href="#__codelineno-628-18"></a><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">x</span><span class="p">.</span><span class="n">Priority</span><span class="p">.</span><span class="n">CompareTo</span><span class="w"> </span><span class="p">(</span><span class="n">y</span><span class="p">.</span><span class="n">Priority</span><span class="p">);</span>
</span><span id="__span-628-19"><a id="__codelineno-628-19" name="__codelineno-628-19" href="#__codelineno-628-19"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-628-20"><a id="__codelineno-628-20" name="__codelineno-628-20" href="#__codelineno-628-20"></a><span class="p">}</span>
</span><span id="__span-628-21"><a id="__codelineno-628-21" name="__codelineno-628-21" href="#__codelineno-628-21"></a>
</span><span id="__span-628-22"><a id="__codelineno-628-22" name="__codelineno-628-22" href="#__codelineno-628-22"></a><span class="k">void</span><span class="w"> </span><span class="nf">Main</span><span class="p">()</span>
</span><span id="__span-628-23"><a id="__codelineno-628-23" name="__codelineno-628-23" href="#__codelineno-628-23"></a><span class="p">{</span>
</span><span id="__span-628-24"><a id="__codelineno-628-24" name="__codelineno-628-24" href="#__codelineno-628-24"></a><span class="w">    </span><span class="kt">var</span><span class="w"> </span><span class="n">wishList</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">List</span><span class="o">&lt;</span><span class="n">Wish</span><span class="o">&gt;</span><span class="p">();</span>
</span><span id="__span-628-25"><a id="__codelineno-628-25" name="__codelineno-628-25" href="#__codelineno-628-25"></a><span class="w">    </span><span class="n">wishList</span><span class="p">.</span><span class="n">Add</span><span class="w"> </span><span class="p">(</span><span class="k">new</span><span class="w"> </span><span class="n">Wish</span><span class="w"> </span><span class="p">(</span><span class="s">&quot;Peace&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">));</span>
</span><span id="__span-628-26"><a id="__codelineno-628-26" name="__codelineno-628-26" href="#__codelineno-628-26"></a><span class="w">    </span><span class="n">wishList</span><span class="p">.</span><span class="n">Add</span><span class="w"> </span><span class="p">(</span><span class="k">new</span><span class="w"> </span><span class="n">Wish</span><span class="w"> </span><span class="p">(</span><span class="s">&quot;Wealth&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">3</span><span class="p">));</span>
</span><span id="__span-628-27"><a id="__codelineno-628-27" name="__codelineno-628-27" href="#__codelineno-628-27"></a><span class="w">    </span><span class="n">wishList</span><span class="p">.</span><span class="n">Add</span><span class="w"> </span><span class="p">(</span><span class="k">new</span><span class="w"> </span><span class="n">Wish</span><span class="w"> </span><span class="p">(</span><span class="s">&quot;Love&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">));</span>
</span><span id="__span-628-28"><a id="__codelineno-628-28" name="__codelineno-628-28" href="#__codelineno-628-28"></a><span class="w">    </span><span class="n">wishList</span><span class="p">.</span><span class="n">Add</span><span class="w"> </span><span class="p">(</span><span class="k">new</span><span class="w"> </span><span class="n">Wish</span><span class="w"> </span><span class="p">(</span><span class="s">&quot;3 more wishes&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">));</span>
</span><span id="__span-628-29"><a id="__codelineno-628-29" name="__codelineno-628-29" href="#__codelineno-628-29"></a>
</span><span id="__span-628-30"><a id="__codelineno-628-30" name="__codelineno-628-30" href="#__codelineno-628-30"></a><span class="w">    </span><span class="n">wishList</span><span class="p">.</span><span class="n">Sort</span><span class="w"> </span><span class="p">(</span><span class="k">new</span><span class="w"> </span><span class="n">PriorityComparer</span><span class="p">());</span>
</span><span id="__span-628-31"><a id="__codelineno-628-31" name="__codelineno-628-31" href="#__codelineno-628-31"></a><span class="w">    </span><span class="n">wishList</span><span class="p">.</span><span class="n">Dump</span><span class="p">();</span>
</span><span id="__span-628-32"><a id="__codelineno-628-32" name="__codelineno-628-32" href="#__codelineno-628-32"></a><span class="p">}</span>
</span></code></pre></div>
<h3 id="stringcomparer">StringComparer</h3>
<p><code>StringCompare</code>is a predefined plug-in class for equating and comparing strings, allowing you to specify language and case sensitivity. <code>StringComparer</code> implements both <code>IEqualityComparer</code> and <code>IComparer</code> (and their generic versions), so you can use it with any type of dictionary or sorted collection.</p>
<div class="language-csharp highlight"><pre><span></span><code><span id="__span-629-1"><a id="__codelineno-629-1" name="__codelineno-629-1" href="#__codelineno-629-1"></a><span class="kt">var</span><span class="w"> </span><span class="n">dict</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">Dictionary</span><span class="o">&lt;</span><span class="kt">string</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="o">&gt;</span><span class="w"> </span><span class="p">(</span><span class="n">StringComparer</span><span class="p">.</span><span class="n">OrdinalIgnoreCase</span><span class="p">);</span>
</span><span id="__span-629-2"><a id="__codelineno-629-2" name="__codelineno-629-2" href="#__codelineno-629-2"></a><span class="n">dict</span><span class="p">[</span><span class="s">&quot;joe&quot;</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">12345</span><span class="p">;</span>
</span><span id="__span-629-3"><a id="__codelineno-629-3" name="__codelineno-629-3" href="#__codelineno-629-3"></a><span class="n">dict</span><span class="p">[</span><span class="s">&quot;JOE&quot;</span><span class="p">].</span><span class="n">Dump</span><span class="p">();</span>
</span><span id="__span-629-4"><a id="__codelineno-629-4" name="__codelineno-629-4" href="#__codelineno-629-4"></a>
</span><span id="__span-629-5"><a id="__codelineno-629-5" name="__codelineno-629-5" href="#__codelineno-629-5"></a><span class="kt">string</span><span class="p">[]</span><span class="w"> </span><span class="n">names</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="s">&quot;Tom&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;HARRY&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;sheila&quot;</span><span class="w"> </span><span class="p">};</span>
</span><span id="__span-629-6"><a id="__codelineno-629-6" name="__codelineno-629-6" href="#__codelineno-629-6"></a><span class="n">CultureInfo</span><span class="w"> </span><span class="n">ci</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">CultureInfo</span><span class="w"> </span><span class="p">(</span><span class="s">&quot;en-AU&quot;</span><span class="p">);</span>
</span><span id="__span-629-7"><a id="__codelineno-629-7" name="__codelineno-629-7" href="#__codelineno-629-7"></a><span class="n">Array</span><span class="p">.</span><span class="n">Sort</span><span class="o">&lt;</span><span class="kt">string</span><span class="o">&gt;</span><span class="w"> </span><span class="p">(</span><span class="n">names</span><span class="p">,</span><span class="w"> </span><span class="n">StringComparer</span><span class="p">.</span><span class="n">Create</span><span class="w"> </span><span class="p">(</span><span class="n">ci</span><span class="p">,</span><span class="w"> </span><span class="k">false</span><span class="p">));</span>
</span><span id="__span-629-8"><a id="__codelineno-629-8" name="__codelineno-629-8" href="#__codelineno-629-8"></a><span class="n">names</span><span class="p">.</span><span class="n">Dump</span><span class="p">();</span>
</span></code></pre></div>
<h3 id="istructuralequatable-and-istructuralcomparable">IStructuralEquatable and IStructuralComparable</h3>
<p>Structs implement structural comparison by default: two structs are equal if all of their fields are equal. Sometimes, however, structural equality and order comparison are useful as plug-in options on other types, as wellâ€”such as arrays.</p>
<div class="language-csharp highlight"><pre><span></span><code><span id="__span-630-1"><a id="__codelineno-630-1" name="__codelineno-630-1" href="#__codelineno-630-1"></a><span class="p">{</span>
</span><span id="__span-630-2"><a id="__codelineno-630-2" name="__codelineno-630-2" href="#__codelineno-630-2"></a><span class="w">    </span><span class="kt">int</span><span class="p">[]</span><span class="w"> </span><span class="n">a1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="mi">3</span><span class="w"> </span><span class="p">};</span>
</span><span id="__span-630-3"><a id="__codelineno-630-3" name="__codelineno-630-3" href="#__codelineno-630-3"></a><span class="w">    </span><span class="kt">int</span><span class="p">[]</span><span class="w"> </span><span class="n">a2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="mi">3</span><span class="w"> </span><span class="p">};</span>
</span><span id="__span-630-4"><a id="__codelineno-630-4" name="__codelineno-630-4" href="#__codelineno-630-4"></a><span class="w">    </span><span class="n">IStructuralEquatable</span><span class="w"> </span><span class="n">se1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">a1</span><span class="p">;</span>
</span><span id="__span-630-5"><a id="__codelineno-630-5" name="__codelineno-630-5" href="#__codelineno-630-5"></a><span class="w">    </span><span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="w"> </span><span class="p">(</span><span class="n">a1</span><span class="p">.</span><span class="n">Equals</span><span class="w"> </span><span class="p">(</span><span class="n">a2</span><span class="p">));</span><span class="w">                                  </span><span class="c1">// False</span>
</span><span id="__span-630-6"><a id="__codelineno-630-6" name="__codelineno-630-6" href="#__codelineno-630-6"></a><span class="w">    </span><span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="w"> </span><span class="p">(</span><span class="n">se1</span><span class="p">.</span><span class="n">Equals</span><span class="w"> </span><span class="p">(</span><span class="n">a2</span><span class="p">,</span><span class="w"> </span><span class="n">EqualityComparer</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span><span class="p">.</span><span class="n">Default</span><span class="p">));</span><span class="w">  </span><span class="c1">// True</span>
</span><span id="__span-630-7"><a id="__codelineno-630-7" name="__codelineno-630-7" href="#__codelineno-630-7"></a><span class="p">}</span>
</span><span id="__span-630-8"><a id="__codelineno-630-8" name="__codelineno-630-8" href="#__codelineno-630-8"></a><span class="p">{</span>
</span><span id="__span-630-9"><a id="__codelineno-630-9" name="__codelineno-630-9" href="#__codelineno-630-9"></a><span class="w">    </span><span class="kt">string</span><span class="p">[]</span><span class="w"> </span><span class="n">a1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;the quick brown fox&quot;</span><span class="p">.</span><span class="n">Split</span><span class="p">();</span>
</span><span id="__span-630-10"><a id="__codelineno-630-10" name="__codelineno-630-10" href="#__codelineno-630-10"></a><span class="w">    </span><span class="kt">string</span><span class="p">[]</span><span class="w"> </span><span class="n">a2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;THE QUICK BROWN FOX&quot;</span><span class="p">.</span><span class="n">Split</span><span class="p">();</span>
</span><span id="__span-630-11"><a id="__codelineno-630-11" name="__codelineno-630-11" href="#__codelineno-630-11"></a><span class="w">    </span><span class="n">IStructuralEquatable</span><span class="w"> </span><span class="n">se1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">a1</span><span class="p">;</span>
</span><span id="__span-630-12"><a id="__codelineno-630-12" name="__codelineno-630-12" href="#__codelineno-630-12"></a><span class="w">    </span><span class="kt">bool</span><span class="w"> </span><span class="n">isTrue</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">se1</span><span class="p">.</span><span class="n">Equals</span><span class="w"> </span><span class="p">(</span><span class="n">a2</span><span class="p">,</span><span class="w"> </span><span class="n">StringComparer</span><span class="p">.</span><span class="n">InvariantCultureIgnoreCase</span><span class="p">);</span>
</span><span id="__span-630-13"><a id="__codelineno-630-13" name="__codelineno-630-13" href="#__codelineno-630-13"></a><span class="p">}</span>
</span><span id="__span-630-14"><a id="__codelineno-630-14" name="__codelineno-630-14" href="#__codelineno-630-14"></a><span class="p">{</span>
</span><span id="__span-630-15"><a id="__codelineno-630-15" name="__codelineno-630-15" href="#__codelineno-630-15"></a><span class="w">    </span><span class="kt">var</span><span class="w"> </span><span class="n">t1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Tuple</span><span class="p">.</span><span class="n">Create</span><span class="w"> </span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;foo&quot;</span><span class="p">);</span>
</span><span id="__span-630-16"><a id="__codelineno-630-16" name="__codelineno-630-16" href="#__codelineno-630-16"></a><span class="w">    </span><span class="kt">var</span><span class="w"> </span><span class="n">t2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Tuple</span><span class="p">.</span><span class="n">Create</span><span class="w"> </span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;FOO&quot;</span><span class="p">);</span>
</span><span id="__span-630-17"><a id="__codelineno-630-17" name="__codelineno-630-17" href="#__codelineno-630-17"></a><span class="w">    </span><span class="n">IStructuralEquatable</span><span class="w"> </span><span class="n">se1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">t1</span><span class="p">;</span>
</span><span id="__span-630-18"><a id="__codelineno-630-18" name="__codelineno-630-18" href="#__codelineno-630-18"></a><span class="w">    </span><span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="w"> </span><span class="p">(</span><span class="n">se1</span><span class="p">.</span><span class="n">Equals</span><span class="w"> </span><span class="p">(</span><span class="n">t2</span><span class="p">,</span><span class="w"> </span><span class="n">StringComparer</span><span class="p">.</span><span class="n">InvariantCultureIgnoreCase</span><span class="p">));</span><span class="w">     </span><span class="c1">// True</span>
</span><span id="__span-630-19"><a id="__codelineno-630-19" name="__codelineno-630-19" href="#__codelineno-630-19"></a><span class="w">    </span><span class="n">IStructuralComparable</span><span class="w"> </span><span class="n">sc1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">t1</span><span class="p">;</span>
</span><span id="__span-630-20"><a id="__codelineno-630-20" name="__codelineno-630-20" href="#__codelineno-630-20"></a><span class="w">    </span><span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="w"> </span><span class="p">(</span><span class="n">sc1</span><span class="p">.</span><span class="n">CompareTo</span><span class="w"> </span><span class="p">(</span><span class="n">t2</span><span class="p">,</span><span class="w"> </span><span class="n">StringComparer</span><span class="p">.</span><span class="n">InvariantCultureIgnoreCase</span><span class="p">));</span><span class="w">  </span><span class="c1">// 0</span>
</span><span id="__span-630-21"><a id="__codelineno-630-21" name="__codelineno-630-21" href="#__codelineno-630-21"></a><span class="p">}</span>
</span><span id="__span-630-22"><a id="__codelineno-630-22" name="__codelineno-630-22" href="#__codelineno-630-22"></a><span class="p">{</span>
</span><span id="__span-630-23"><a id="__codelineno-630-23" name="__codelineno-630-23" href="#__codelineno-630-23"></a><span class="w">    </span><span class="kt">var</span><span class="w"> </span><span class="n">t1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Tuple</span><span class="p">.</span><span class="n">Create</span><span class="w"> </span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;FOO&quot;</span><span class="p">);</span>
</span><span id="__span-630-24"><a id="__codelineno-630-24" name="__codelineno-630-24" href="#__codelineno-630-24"></a><span class="w">    </span><span class="kt">var</span><span class="w"> </span><span class="n">t2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Tuple</span><span class="p">.</span><span class="n">Create</span><span class="w"> </span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;FOO&quot;</span><span class="p">);</span>
</span><span id="__span-630-25"><a id="__codelineno-630-25" name="__codelineno-630-25" href="#__codelineno-630-25"></a><span class="w">    </span><span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="w"> </span><span class="p">(</span><span class="n">t1</span><span class="p">.</span><span class="n">Equals</span><span class="w"> </span><span class="p">(</span><span class="n">t2</span><span class="p">));</span><span class="w">   </span><span class="c1">// True</span>
</span><span id="__span-630-26"><a id="__codelineno-630-26" name="__codelineno-630-26" href="#__codelineno-630-26"></a><span class="p">}</span>
</span><span id="__span-630-27"><a id="__codelineno-630-27" name="__codelineno-630-27" href="#__codelineno-630-27"></a><span class="err">```#</span><span class="w"> </span><span class="n">Chapter</span><span class="w"> </span><span class="mi">8</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="n">LINQ</span><span class="w"> </span><span class="n">Queries</span>
</span><span id="__span-630-28"><a id="__codelineno-630-28" name="__codelineno-630-28" href="#__codelineno-630-28"></a>
</span><span id="__span-630-29"><a id="__codelineno-630-29" name="__codelineno-630-29" href="#__codelineno-630-29"></a><span class="err">#</span><span class="w"> </span><span class="n">Overview</span>
</span><span id="__span-630-30"><a id="__codelineno-630-30" name="__codelineno-630-30" href="#__codelineno-630-30"></a>
</span><span id="__span-630-31"><a id="__codelineno-630-31" name="__codelineno-630-31" href="#__codelineno-630-31"></a><span class="err">`</span><span class="n">LINQ</span><span class="err">`</span><span class="p">,</span><span class="w"> </span><span class="k">or</span><span class="w"> </span><span class="n">Language</span><span class="o">-</span><span class="n">Integrated</span><span class="w"> </span><span class="n">Query</span><span class="p">,</span><span class="w"> </span><span class="k">is</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="k">set</span><span class="w"> </span><span class="n">of</span><span class="w"> </span><span class="n">language</span><span class="w"> </span><span class="k">and</span><span class="w"> </span><span class="n">framework</span><span class="w"> </span><span class="n">features</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">writing</span><span class="w"> </span><span class="n">structured</span><span class="w"> </span><span class="n">type</span><span class="o">-</span><span class="n">safe</span><span class="w"> </span><span class="n">queries</span><span class="w"> </span><span class="n">over</span><span class="w"> </span><span class="n">local</span><span class="w"> </span><span class="kt">object</span><span class="w"> </span><span class="n">collections</span><span class="w"> </span><span class="k">and</span><span class="w"> </span><span class="n">remote</span><span class="w"> </span><span class="n">data</span><span class="w"> </span><span class="n">sources</span><span class="p">.</span>
</span><span id="__span-630-32"><a id="__codelineno-630-32" name="__codelineno-630-32" href="#__codelineno-630-32"></a>
</span><span id="__span-630-33"><a id="__codelineno-630-33" name="__codelineno-630-33" href="#__codelineno-630-33"></a><span class="o">**</span><span class="n">LINQ</span><span class="w"> </span><span class="n">enables</span><span class="w"> </span><span class="n">you</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">query</span><span class="w"> </span><span class="n">any</span><span class="w"> </span><span class="n">collection</span><span class="w"> </span><span class="n">implementing</span><span class="w"> </span><span class="err">`</span><span class="n">IEnumerable</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span><span class="err">`</span><span class="p">,</span><span class="w"> </span><span class="n">whether</span><span class="w"> </span><span class="n">an</span><span class="w"> </span><span class="n">array</span><span class="p">,</span><span class="w"> </span><span class="n">list</span><span class="p">,</span><span class="w"> </span><span class="k">or</span><span class="w"> </span><span class="n">XML</span><span class="w"> </span><span class="n">DOM</span><span class="p">,</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">well</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">remote</span><span class="w"> </span><span class="n">data</span><span class="w"> </span><span class="n">sources</span><span class="p">,</span><span class="w"> </span><span class="n">such</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">tables</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">SQL</span><span class="w"> </span><span class="n">Server</span><span class="w"> </span><span class="n">database</span><span class="p">.</span><span class="o">**</span><span class="w"> </span><span class="n">LINQ</span><span class="w"> </span><span class="n">offers</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">benefits</span><span class="w"> </span><span class="n">of</span><span class="w"> </span><span class="n">both</span><span class="w"> </span><span class="n">compile</span><span class="o">-</span><span class="n">time</span><span class="w"> </span><span class="n">type</span><span class="w"> </span><span class="n">checking</span><span class="w"> </span><span class="k">and</span><span class="w"> </span><span class="kt">dynamic</span><span class="w"> </span><span class="n">query</span><span class="w"> </span><span class="n">composition</span><span class="p">.</span>
</span><span id="__span-630-34"><a id="__codelineno-630-34" name="__codelineno-630-34" href="#__codelineno-630-34"></a>
</span><span id="__span-630-35"><a id="__codelineno-630-35" name="__codelineno-630-35" href="#__codelineno-630-35"></a><span class="n">All</span><span class="w"> </span><span class="n">core</span><span class="w"> </span><span class="n">types</span><span class="w"> </span><span class="n">are</span><span class="w"> </span><span class="n">defined</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="err">`</span><span class="n">System</span><span class="p">.</span><span class="n">Linq</span><span class="err">`</span><span class="w"> </span><span class="k">and</span><span class="w"> </span><span class="err">`</span><span class="n">System</span><span class="p">.</span><span class="n">Linq</span><span class="p">.</span><span class="n">Expressions</span><span class="err">`</span><span class="w"> </span><span class="n">namespaces</span><span class="p">.</span>
</span><span id="__span-630-36"><a id="__codelineno-630-36" name="__codelineno-630-36" href="#__codelineno-630-36"></a>
</span><span id="__span-630-37"><a id="__codelineno-630-37" name="__codelineno-630-37" href="#__codelineno-630-37"></a><span class="err">#</span><span class="w"> </span><span class="n">Getting</span><span class="w"> </span><span class="n">Started</span>
</span><span id="__span-630-38"><a id="__codelineno-630-38" name="__codelineno-630-38" href="#__codelineno-630-38"></a>
</span><span id="__span-630-39"><a id="__codelineno-630-39" name="__codelineno-630-39" href="#__codelineno-630-39"></a><span class="n">The</span><span class="w"> </span><span class="n">basic</span><span class="w"> </span><span class="n">units</span><span class="w"> </span><span class="n">of</span><span class="w"> </span><span class="n">data</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">LINQ</span><span class="w"> </span><span class="n">are</span><span class="w"> </span><span class="n">sequences</span><span class="w"> </span><span class="k">and</span><span class="w"> </span><span class="n">elements</span><span class="p">.</span><span class="w"> </span><span class="n">A</span><span class="w"> </span><span class="n">sequence</span><span class="w"> </span><span class="k">is</span><span class="w"> </span><span class="n">any</span><span class="w"> </span><span class="kt">object</span>
</span><span id="__span-630-40"><a id="__codelineno-630-40" name="__codelineno-630-40" href="#__codelineno-630-40"></a><span class="n">that</span><span class="w"> </span><span class="n">implements</span><span class="w"> </span><span class="err">`</span><span class="n">IEnumerable</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span><span class="err">`</span><span class="p">,</span><span class="w"> </span><span class="k">and</span><span class="w"> </span><span class="n">an</span><span class="w"> </span><span class="n">element</span><span class="w"> </span><span class="k">is</span><span class="w"> </span><span class="n">each</span><span class="w"> </span><span class="n">item</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">sequence</span><span class="p">.</span>
</span><span id="__span-630-41"><a id="__codelineno-630-41" name="__codelineno-630-41" href="#__codelineno-630-41"></a>
</span><span id="__span-630-42"><a id="__codelineno-630-42" name="__codelineno-630-42" href="#__codelineno-630-42"></a><span class="err">```</span><span class="n">csharp</span>
</span><span id="__span-630-43"><a id="__codelineno-630-43" name="__codelineno-630-43" href="#__codelineno-630-43"></a><span class="k">using</span><span class="w"> </span><span class="nn">System</span><span class="p">;</span>
</span><span id="__span-630-44"><a id="__codelineno-630-44" name="__codelineno-630-44" href="#__codelineno-630-44"></a><span class="k">using</span><span class="w"> </span><span class="nn">System.Collections.Generic</span><span class="p">;</span>
</span><span id="__span-630-45"><a id="__codelineno-630-45" name="__codelineno-630-45" href="#__codelineno-630-45"></a><span class="k">using</span><span class="w"> </span><span class="nn">System.Linq</span><span class="p">;</span>
</span><span id="__span-630-46"><a id="__codelineno-630-46" name="__codelineno-630-46" href="#__codelineno-630-46"></a><span class="k">class</span><span class="w"> </span><span class="nc">LinqDemo</span>
</span><span id="__span-630-47"><a id="__codelineno-630-47" name="__codelineno-630-47" href="#__codelineno-630-47"></a><span class="p">{</span>
</span><span id="__span-630-48"><a id="__codelineno-630-48" name="__codelineno-630-48" href="#__codelineno-630-48"></a><span class="w"> </span><span class="k">static</span><span class="w"> </span><span class="k">void</span><span class="w"> </span><span class="nf">Main</span><span class="p">()</span>
</span><span id="__span-630-49"><a id="__codelineno-630-49" name="__codelineno-630-49" href="#__codelineno-630-49"></a><span class="w"> </span><span class="p">{</span>
</span><span id="__span-630-50"><a id="__codelineno-630-50" name="__codelineno-630-50" href="#__codelineno-630-50"></a><span class="w"> </span><span class="kt">string</span><span class="p">[]</span><span class="w"> </span><span class="n">names</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="s">&quot;Tom&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Dick&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Harry&quot;</span><span class="w"> </span><span class="p">};</span>
</span><span id="__span-630-51"><a id="__codelineno-630-51" name="__codelineno-630-51" href="#__codelineno-630-51"></a><span class="w"> </span><span class="n">IEnumerable</span><span class="o">&lt;</span><span class="kt">string</span><span class="o">&gt;</span><span class="w"> </span><span class="n">filteredNames</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">names</span><span class="p">.</span><span class="n">Where</span><span class="w"> </span><span class="p">(</span><span class="n">n</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="n">n</span><span class="p">.</span><span class="n">Length</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="mi">4</span><span class="p">);</span>
</span><span id="__span-630-52"><a id="__codelineno-630-52" name="__codelineno-630-52" href="#__codelineno-630-52"></a><span class="w"> </span><span class="k">foreach</span><span class="w"> </span><span class="p">(</span><span class="kt">string</span><span class="w"> </span><span class="n">name</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">filteredNames</span><span class="p">)</span><span class="w"> </span><span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="w"> </span><span class="p">(</span><span class="n">name</span><span class="p">);</span>
</span><span id="__span-630-53"><a id="__codelineno-630-53" name="__codelineno-630-53" href="#__codelineno-630-53"></a><span class="w"> </span><span class="p">}</span>
</span><span id="__span-630-54"><a id="__codelineno-630-54" name="__codelineno-630-54" href="#__codelineno-630-54"></a><span class="p">}</span>
</span><span id="__span-630-55"><a id="__codelineno-630-55" name="__codelineno-630-55" href="#__codelineno-630-55"></a>
</span><span id="__span-630-56"><a id="__codelineno-630-56" name="__codelineno-630-56" href="#__codelineno-630-56"></a><span class="cm">/*</span>
</span><span id="__span-630-57"><a id="__codelineno-630-57" name="__codelineno-630-57" href="#__codelineno-630-57"></a><span class="cm">OUTPUT:</span>
</span><span id="__span-630-58"><a id="__codelineno-630-58" name="__codelineno-630-58" href="#__codelineno-630-58"></a><span class="cm">Dick</span>
</span><span id="__span-630-59"><a id="__codelineno-630-59" name="__codelineno-630-59" href="#__codelineno-630-59"></a><span class="cm">Harry</span>
</span><span id="__span-630-60"><a id="__codelineno-630-60" name="__codelineno-630-60" href="#__codelineno-630-60"></a><span class="cm">*/</span>
</span></code></pre></div>
<p>We could further shorten our code by implicitly typing filteredNames:</p>
<div class="language-csharp highlight"><pre><span></span><code><span id="__span-631-1"><a id="__codelineno-631-1" name="__codelineno-631-1" href="#__codelineno-631-1"></a><span class="kt">var</span><span class="w"> </span><span class="n">filteredNames</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">names</span><span class="p">.</span><span class="n">Where</span><span class="w"> </span><span class="p">(</span><span class="n">n</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="n">n</span><span class="p">.</span><span class="n">Length</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="mi">4</span><span class="p">);</span>
</span><span id="__span-631-2"><a id="__codelineno-631-2" name="__codelineno-631-2" href="#__codelineno-631-2"></a>
</span><span id="__span-631-3"><a id="__codelineno-631-3" name="__codelineno-631-3" href="#__codelineno-631-3"></a><span class="c1">//fluent syntax</span>
</span><span id="__span-631-4"><a id="__codelineno-631-4" name="__codelineno-631-4" href="#__codelineno-631-4"></a><span class="n">IEnumerable</span><span class="o">&lt;</span><span class="kt">string</span><span class="o">&gt;</span><span class="w"> </span><span class="n">filteredNames</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">names</span><span class="p">.</span><span class="n">Where</span><span class="w"> </span><span class="p">(</span><span class="n">n</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="n">n</span><span class="p">.</span><span class="n">Contains</span><span class="w"> </span><span class="p">(</span><span class="s">&quot;a&quot;</span><span class="p">));</span>
</span><span id="__span-631-5"><a id="__codelineno-631-5" name="__codelineno-631-5" href="#__codelineno-631-5"></a>
</span><span id="__span-631-6"><a id="__codelineno-631-6" name="__codelineno-631-6" href="#__codelineno-631-6"></a><span class="c1">//query expression syntax</span>
</span><span id="__span-631-7"><a id="__codelineno-631-7" name="__codelineno-631-7" href="#__codelineno-631-7"></a><span class="n">IEnumerable</span><span class="o">&lt;</span><span class="kt">string</span><span class="o">&gt;</span><span class="w"> </span><span class="n">filteredNames</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">from</span><span class="w"> </span><span class="n">n</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">names</span>
</span><span id="__span-631-8"><a id="__codelineno-631-8" name="__codelineno-631-8" href="#__codelineno-631-8"></a><span class="w"> </span><span class="k">where</span><span class="w"> </span><span class="n">n</span><span class="p">.</span><span class="n">Contains</span><span class="w"> </span><span class="p">(</span><span class="s">&quot;a&quot;</span><span class="p">)</span>
</span><span id="__span-631-9"><a id="__codelineno-631-9" name="__codelineno-631-9" href="#__codelineno-631-9"></a><span class="w"> </span><span class="k">select</span><span class="w"> </span><span class="n">n</span><span class="p">;</span>
</span></code></pre></div>
<h1 id="fluent-syntax">Fluent Syntax</h1>
<p>Fluent syntax is the most flexible and fundamental.</p>
<div class="language-csharp highlight"><pre><span></span><code><span id="__span-632-1"><a id="__codelineno-632-1" name="__codelineno-632-1" href="#__codelineno-632-1"></a><span class="n">IEnumerable</span><span class="o">&lt;</span><span class="kt">string</span><span class="o">&gt;</span><span class="w"> </span><span class="n">filteredNames</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">names</span><span class="p">.</span><span class="n">Where</span><span class="w"> </span><span class="p">(</span><span class="n">n</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="n">n</span><span class="p">.</span><span class="n">Contains</span><span class="w"> </span><span class="p">(</span><span class="s">&quot;a&quot;</span><span class="p">));</span>
</span><span id="__span-632-2"><a id="__codelineno-632-2" name="__codelineno-632-2" href="#__codelineno-632-2"></a><span class="k">foreach</span><span class="w"> </span><span class="p">(</span><span class="kt">string</span><span class="w"> </span><span class="n">name</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">filteredNames</span><span class="p">)</span>
</span><span id="__span-632-3"><a id="__codelineno-632-3" name="__codelineno-632-3" href="#__codelineno-632-3"></a><span class="w"> </span><span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="w"> </span><span class="p">(</span><span class="n">name</span><span class="p">);</span><span class="w"> </span><span class="c1">// Harry</span>
</span></code></pre></div>
<h3 id="chaining-query-operators">Chaining Query Operators</h3>
<div class="language-csharp highlight"><pre><span></span><code><span id="__span-633-1"><a id="__codelineno-633-1" name="__codelineno-633-1" href="#__codelineno-633-1"></a><span class="kt">string</span><span class="p">[]</span><span class="w"> </span><span class="n">names</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="s">&quot;Tom&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Dick&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Harry&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Mary&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Jay&quot;</span><span class="w"> </span><span class="p">};</span>
</span><span id="__span-633-2"><a id="__codelineno-633-2" name="__codelineno-633-2" href="#__codelineno-633-2"></a><span class="w">            </span><span class="n">IEnumerable</span><span class="o">&lt;</span><span class="kt">string</span><span class="o">&gt;</span><span class="w"> </span><span class="n">query</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">names</span>
</span><span id="__span-633-3"><a id="__codelineno-633-3" name="__codelineno-633-3" href="#__codelineno-633-3"></a><span class="w">            </span><span class="p">.</span><span class="n">Where</span><span class="p">(</span><span class="n">n</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="n">n</span><span class="p">.</span><span class="n">Contains</span><span class="p">(</span><span class="s">&quot;a&quot;</span><span class="p">))</span>
</span><span id="__span-633-4"><a id="__codelineno-633-4" name="__codelineno-633-4" href="#__codelineno-633-4"></a><span class="w">            </span><span class="p">.</span><span class="n">OrderBy</span><span class="p">(</span><span class="n">n</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="n">n</span><span class="p">.</span><span class="n">Length</span><span class="p">)</span>
</span><span id="__span-633-5"><a id="__codelineno-633-5" name="__codelineno-633-5" href="#__codelineno-633-5"></a><span class="w">            </span><span class="p">.</span><span class="n">Select</span><span class="p">(</span><span class="n">n</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="n">n</span><span class="p">.</span><span class="n">ToUpper</span><span class="p">());</span>
</span><span id="__span-633-6"><a id="__codelineno-633-6" name="__codelineno-633-6" href="#__codelineno-633-6"></a><span class="w">            </span><span class="k">foreach</span><span class="w"> </span><span class="p">(</span><span class="kt">string</span><span class="w"> </span><span class="n">name</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">query</span><span class="p">)</span><span class="w"> </span><span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="p">(</span><span class="n">name</span><span class="p">);</span>
</span><span id="__span-633-7"><a id="__codelineno-633-7" name="__codelineno-633-7" href="#__codelineno-633-7"></a><span class="w">            </span><span class="n">Console</span><span class="p">.</span><span class="n">ReadLine</span><span class="p">();</span>
</span><span id="__span-633-8"><a id="__codelineno-633-8" name="__codelineno-633-8" href="#__codelineno-633-8"></a><span class="w">            </span><span class="cm">/*</span>
</span><span id="__span-633-9"><a id="__codelineno-633-9" name="__codelineno-633-9" href="#__codelineno-633-9"></a><span class="cm">                JAY</span>
</span><span id="__span-633-10"><a id="__codelineno-633-10" name="__codelineno-633-10" href="#__codelineno-633-10"></a><span class="cm">                MARY</span>
</span><span id="__span-633-11"><a id="__codelineno-633-11" name="__codelineno-633-11" href="#__codelineno-633-11"></a><span class="cm">                HARRY</span>
</span><span id="__span-633-12"><a id="__codelineno-633-12" name="__codelineno-633-12" href="#__codelineno-633-12"></a><span class="cm">            */</span>
</span></code></pre></div>
<ul>
<li>Where operator, which emits a filtered version of the input sequence.</li>
<li>The OrderBy operator emits a sorted version of its input sequence</li>
<li>the Select method emits a sequence in which each input element is transformed or projected with a given lambda expression</li>
</ul>
<div class="language-csharp highlight"><pre><span></span><code><span id="__span-634-1"><a id="__codelineno-634-1" name="__codelineno-634-1" href="#__codelineno-634-1"></a><span class="c1">// The same query constructed progressively:</span>
</span><span id="__span-634-2"><a id="__codelineno-634-2" name="__codelineno-634-2" href="#__codelineno-634-2"></a>
</span><span id="__span-634-3"><a id="__codelineno-634-3" name="__codelineno-634-3" href="#__codelineno-634-3"></a><span class="n">IEnumerable</span><span class="o">&lt;</span><span class="kt">string</span><span class="o">&gt;</span><span class="w"> </span><span class="n">filtered</span><span class="w">   </span><span class="o">=</span><span class="w"> </span><span class="n">names</span><span class="p">.</span><span class="n">Where</span><span class="w">      </span><span class="p">(</span><span class="n">n</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="n">n</span><span class="p">.</span><span class="n">Contains</span><span class="w"> </span><span class="p">(</span><span class="s">&quot;a&quot;</span><span class="p">));</span>
</span><span id="__span-634-4"><a id="__codelineno-634-4" name="__codelineno-634-4" href="#__codelineno-634-4"></a><span class="n">IEnumerable</span><span class="o">&lt;</span><span class="kt">string</span><span class="o">&gt;</span><span class="w"> </span><span class="n">sorted</span><span class="w">     </span><span class="o">=</span><span class="w"> </span><span class="n">filtered</span><span class="p">.</span><span class="n">OrderBy</span><span class="w"> </span><span class="p">(</span><span class="n">n</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="n">n</span><span class="p">.</span><span class="n">Length</span><span class="p">);</span>
</span><span id="__span-634-5"><a id="__codelineno-634-5" name="__codelineno-634-5" href="#__codelineno-634-5"></a><span class="n">IEnumerable</span><span class="o">&lt;</span><span class="kt">string</span><span class="o">&gt;</span><span class="w"> </span><span class="n">finalQuery</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">sorted</span><span class="p">.</span><span class="n">Select</span><span class="w">    </span><span class="p">(</span><span class="n">n</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="n">n</span><span class="p">.</span><span class="n">ToUpper</span><span class="p">());</span>
</span><span id="__span-634-6"><a id="__codelineno-634-6" name="__codelineno-634-6" href="#__codelineno-634-6"></a>
</span><span id="__span-634-7"><a id="__codelineno-634-7" name="__codelineno-634-7" href="#__codelineno-634-7"></a><span class="n">filtered</span><span class="p">.</span><span class="n">Dump</span><span class="w">   </span><span class="p">(</span><span class="s">&quot;Filtered&quot;</span><span class="p">);</span>
</span><span id="__span-634-8"><a id="__codelineno-634-8" name="__codelineno-634-8" href="#__codelineno-634-8"></a><span class="n">sorted</span><span class="p">.</span><span class="n">Dump</span><span class="w">     </span><span class="p">(</span><span class="s">&quot;Sorted&quot;</span><span class="p">);</span>
</span><span id="__span-634-9"><a id="__codelineno-634-9" name="__codelineno-634-9" href="#__codelineno-634-9"></a><span class="n">finalQuery</span><span class="p">.</span><span class="n">Dump</span><span class="w"> </span><span class="p">(</span><span class="s">&quot;FinalQuery&quot;</span><span class="p">);</span>
</span></code></pre></div>
<h3 id="why-extension-methods-are-important">Why extension methods are important</h3>
<p>Instead of using extension method syntax, you can use conventional static method syntax to call the query operators</p>
<div class="language-csharp highlight"><pre><span></span><code><span id="__span-635-1"><a id="__codelineno-635-1" name="__codelineno-635-1" href="#__codelineno-635-1"></a><span class="n">IEnumerable</span><span class="o">&lt;</span><span class="kt">string</span><span class="o">&gt;</span><span class="w"> </span><span class="n">filtered</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Enumerable</span><span class="p">.</span><span class="n">Where</span><span class="w"> </span><span class="p">(</span><span class="n">names</span><span class="p">,</span>
</span><span id="__span-635-2"><a id="__codelineno-635-2" name="__codelineno-635-2" href="#__codelineno-635-2"></a><span class="w"> </span><span class="n">n</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="n">n</span><span class="p">.</span><span class="n">Contains</span><span class="w"> </span><span class="p">(</span><span class="s">&quot;a&quot;</span><span class="p">));</span>
</span><span id="__span-635-3"><a id="__codelineno-635-3" name="__codelineno-635-3" href="#__codelineno-635-3"></a><span class="n">IEnumerable</span><span class="o">&lt;</span><span class="kt">string</span><span class="o">&gt;</span><span class="w"> </span><span class="n">sorted</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Enumerable</span><span class="p">.</span><span class="n">OrderBy</span><span class="w"> </span><span class="p">(</span><span class="n">filtered</span><span class="p">,</span><span class="w"> </span><span class="n">n</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="n">n</span><span class="p">.</span><span class="n">Length</span><span class="p">);</span>
</span><span id="__span-635-4"><a id="__codelineno-635-4" name="__codelineno-635-4" href="#__codelineno-635-4"></a><span class="n">IEnumerable</span><span class="o">&lt;</span><span class="kt">string</span><span class="o">&gt;</span><span class="w"> </span><span class="n">finalQuery</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Enumerable</span><span class="p">.</span><span class="n">Select</span><span class="w"> </span><span class="p">(</span><span class="n">sorted</span><span class="p">,</span>
</span><span id="__span-635-5"><a id="__codelineno-635-5" name="__codelineno-635-5" href="#__codelineno-635-5"></a><span class="w"> </span><span class="n">n</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="n">n</span><span class="p">.</span><span class="n">ToUpper</span><span class="p">());</span>
</span></code></pre></div>
<p>This is, in fact, how the compiler translates extension method calls. Shunning extension methods comes at a cost, however, if you want to write a query in a single statement as we did earlier.</p>
<div class="language-csharp highlight"><pre><span></span><code><span id="__span-636-1"><a id="__codelineno-636-1" name="__codelineno-636-1" href="#__codelineno-636-1"></a><span class="n">IEnumerable</span><span class="o">&lt;</span><span class="kt">string</span><span class="o">&gt;</span><span class="w"> </span><span class="n">query</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">names</span><span class="p">.</span><span class="n">Where</span><span class="w"> </span><span class="p">(</span><span class="n">n</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="n">n</span><span class="p">.</span><span class="n">Contains</span><span class="w"> </span><span class="p">(</span><span class="s">&quot;a&quot;</span><span class="p">))</span>
</span><span id="__span-636-2"><a id="__codelineno-636-2" name="__codelineno-636-2" href="#__codelineno-636-2"></a><span class="w"> </span><span class="p">.</span><span class="n">OrderBy</span><span class="w"> </span><span class="p">(</span><span class="n">n</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="n">n</span><span class="p">.</span><span class="n">Length</span><span class="p">)</span>
</span><span id="__span-636-3"><a id="__codelineno-636-3" name="__codelineno-636-3" href="#__codelineno-636-3"></a><span class="w"> </span><span class="p">.</span><span class="n">Select</span><span class="w"> </span><span class="p">(</span><span class="n">n</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="n">n</span><span class="p">.</span><span class="n">ToUpper</span><span class="p">());</span>
</span></code></pre></div>
<p>Its natural linear shape reflects the left-to-right flow of data and keeps lambda expressions alongside their query operators (infix notation). Without extension methods, the query loses its fluency:</p>
<div class="language-csharp highlight"><pre><span></span><code><span id="__span-637-1"><a id="__codelineno-637-1" name="__codelineno-637-1" href="#__codelineno-637-1"></a><span class="n">IEnumerable</span><span class="o">&lt;</span><span class="kt">string</span><span class="o">&gt;</span><span class="w"> </span><span class="n">query</span><span class="w"> </span><span class="o">=</span>
</span><span id="__span-637-2"><a id="__codelineno-637-2" name="__codelineno-637-2" href="#__codelineno-637-2"></a><span class="w"> </span><span class="n">Enumerable</span><span class="p">.</span><span class="n">Select</span><span class="w"> </span><span class="p">(</span>
</span><span id="__span-637-3"><a id="__codelineno-637-3" name="__codelineno-637-3" href="#__codelineno-637-3"></a><span class="w"> </span><span class="n">Enumerable</span><span class="p">.</span><span class="n">OrderBy</span><span class="w"> </span><span class="p">(</span>
</span><span id="__span-637-4"><a id="__codelineno-637-4" name="__codelineno-637-4" href="#__codelineno-637-4"></a><span class="w"> </span><span class="n">Enumerable</span><span class="p">.</span><span class="n">Where</span><span class="w"> </span><span class="p">(</span>
</span><span id="__span-637-5"><a id="__codelineno-637-5" name="__codelineno-637-5" href="#__codelineno-637-5"></a><span class="w"> </span><span class="n">names</span><span class="p">,</span><span class="w"> </span><span class="n">n</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="n">n</span><span class="p">.</span><span class="n">Contains</span><span class="w"> </span><span class="p">(</span><span class="s">&quot;a&quot;</span><span class="p">)</span>
</span><span id="__span-637-6"><a id="__codelineno-637-6" name="__codelineno-637-6" href="#__codelineno-637-6"></a><span class="w"> </span><span class="p">),</span><span class="w"> </span><span class="n">n</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="n">n</span><span class="p">.</span><span class="n">Length</span>
</span><span id="__span-637-7"><a id="__codelineno-637-7" name="__codelineno-637-7" href="#__codelineno-637-7"></a><span class="w"> </span><span class="p">),</span><span class="w"> </span><span class="n">n</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="n">n</span><span class="p">.</span><span class="n">ToUpper</span><span class="p">()</span>
</span><span id="__span-637-8"><a id="__codelineno-637-8" name="__codelineno-637-8" href="#__codelineno-637-8"></a><span class="w"> </span><span class="p">);</span>
</span></code></pre></div>
<h3 id="composing-lambda-expressions">Composing Lambda Expressions</h3>
<p>The purpose of the lambda expression depends on the particular query operator. With the Where operator, it indicates whether an element should be included in the output sequence. In the case of the OrderBy operator, the lambda expression maps each element in the input sequence to its sorting key. With the Select operator, the lambda expression determines how each element in the input sequence is transformed before being fed to the output sequence.</p>
<p><strong>A lambda expression that takes a value and returns a bool is called a predicate</strong></p>
<p>A lambda expression in a query operator always works on individual elements in the input sequence not the sequence as a whole</p>
<h3 id="natural-ordering">Natural Ordering</h3>
<p>The original ordering of elements within an input sequence is significant in LINQ. Some query operators rely on this ordering, such as <code>Take</code>, <code>Skip</code>, and <code>Reverse</code>.</p>
<p>The Take operator outputs the first x elements, discarding the rest</p>
<div class="language-csharp highlight"><pre><span></span><code><span id="__span-638-1"><a id="__codelineno-638-1" name="__codelineno-638-1" href="#__codelineno-638-1"></a><span class="c1">//The Take operator outputs the first x elements, discarding the rest:</span>
</span><span id="__span-638-2"><a id="__codelineno-638-2" name="__codelineno-638-2" href="#__codelineno-638-2"></a><span class="kt">int</span><span class="p">[]</span><span class="w"> </span><span class="n">numbers</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="mi">10</span><span class="p">,</span><span class="w"> </span><span class="mi">9</span><span class="p">,</span><span class="w"> </span><span class="mi">8</span><span class="p">,</span><span class="w"> </span><span class="mi">7</span><span class="p">,</span><span class="w"> </span><span class="mi">6</span><span class="w"> </span><span class="p">};</span>
</span><span id="__span-638-3"><a id="__codelineno-638-3" name="__codelineno-638-3" href="#__codelineno-638-3"></a><span class="n">IEnumerable</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span><span class="w"> </span><span class="n">firstThree</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">numbers</span><span class="p">.</span><span class="n">Take</span><span class="w"> </span><span class="p">(</span><span class="mi">3</span><span class="p">);</span><span class="w"> </span><span class="c1">// { 10, 9, 8 }</span>
</span><span id="__span-638-4"><a id="__codelineno-638-4" name="__codelineno-638-4" href="#__codelineno-638-4"></a>
</span><span id="__span-638-5"><a id="__codelineno-638-5" name="__codelineno-638-5" href="#__codelineno-638-5"></a><span class="c1">//The Skip operator ignores the first x elements and outputs the rest:</span>
</span><span id="__span-638-6"><a id="__codelineno-638-6" name="__codelineno-638-6" href="#__codelineno-638-6"></a><span class="n">IEnumerable</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span><span class="w"> </span><span class="n">lastTwo</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">numbers</span><span class="p">.</span><span class="n">Skip</span><span class="w"> </span><span class="p">(</span><span class="mi">3</span><span class="p">);</span><span class="w"> </span><span class="c1">// { 7, 6 }</span>
</span><span id="__span-638-7"><a id="__codelineno-638-7" name="__codelineno-638-7" href="#__codelineno-638-7"></a>
</span><span id="__span-638-8"><a id="__codelineno-638-8" name="__codelineno-638-8" href="#__codelineno-638-8"></a><span class="c1">//Reverse does exactly as it says:</span>
</span><span id="__span-638-9"><a id="__codelineno-638-9" name="__codelineno-638-9" href="#__codelineno-638-9"></a><span class="n">IEnumerable</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span><span class="w"> </span><span class="n">reversed</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">numbers</span><span class="p">.</span><span class="n">Reverse</span><span class="p">();</span><span class="w"> </span><span class="c1">// { 6, 7, 8, 9, 10 }</span>
</span></code></pre></div>
<h3 id="other-operators">Other Operators</h3>
<p>Not all query operators return a sequence. The element operators extract one element from the input sequence</p>
<div class="language-csharp highlight"><pre><span></span><code><span id="__span-639-1"><a id="__codelineno-639-1" name="__codelineno-639-1" href="#__codelineno-639-1"></a><span class="kt">int</span><span class="p">[]</span><span class="w"> </span><span class="n">numbers</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="mi">10</span><span class="p">,</span><span class="w"> </span><span class="mi">9</span><span class="p">,</span><span class="w"> </span><span class="mi">8</span><span class="p">,</span><span class="w"> </span><span class="mi">7</span><span class="p">,</span><span class="w"> </span><span class="mi">6</span><span class="w"> </span><span class="p">};</span>
</span><span id="__span-639-2"><a id="__codelineno-639-2" name="__codelineno-639-2" href="#__codelineno-639-2"></a><span class="kt">int</span><span class="w"> </span><span class="n">firstNumber</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">numbers</span><span class="p">.</span><span class="n">First</span><span class="p">();</span><span class="w"> </span><span class="c1">// 10</span>
</span><span id="__span-639-3"><a id="__codelineno-639-3" name="__codelineno-639-3" href="#__codelineno-639-3"></a><span class="kt">int</span><span class="w"> </span><span class="n">lastNumber</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">numbers</span><span class="p">.</span><span class="n">Last</span><span class="p">();</span><span class="w"> </span><span class="c1">// 6</span>
</span><span id="__span-639-4"><a id="__codelineno-639-4" name="__codelineno-639-4" href="#__codelineno-639-4"></a><span class="kt">int</span><span class="w"> </span><span class="n">secondNumber</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">numbers</span><span class="p">.</span><span class="n">ElementAt</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span><span class="w"> </span><span class="c1">// 9</span>
</span><span id="__span-639-5"><a id="__codelineno-639-5" name="__codelineno-639-5" href="#__codelineno-639-5"></a><span class="kt">int</span><span class="w"> </span><span class="n">secondLowest</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">numbers</span><span class="p">.</span><span class="n">OrderBy</span><span class="p">(</span><span class="n">n</span><span class="o">=&gt;</span><span class="n">n</span><span class="p">).</span><span class="n">Skip</span><span class="p">(</span><span class="mi">1</span><span class="p">).</span><span class="n">First</span><span class="p">();</span><span class="w"> </span><span class="c1">// 7</span>
</span></code></pre></div>
<div class="language-csharp highlight"><pre><span></span><code><span id="__span-640-1"><a id="__codelineno-640-1" name="__codelineno-640-1" href="#__codelineno-640-1"></a><span class="c1">//The aggregation operators return a scalar value, usually of numeric type:</span>
</span><span id="__span-640-2"><a id="__codelineno-640-2" name="__codelineno-640-2" href="#__codelineno-640-2"></a><span class="kt">int</span><span class="w"> </span><span class="n">count</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">numbers</span><span class="p">.</span><span class="n">Count</span><span class="p">();</span><span class="w"> </span><span class="c1">// 5;</span>
</span><span id="__span-640-3"><a id="__codelineno-640-3" name="__codelineno-640-3" href="#__codelineno-640-3"></a><span class="kt">int</span><span class="w"> </span><span class="n">min</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">numbers</span><span class="p">.</span><span class="n">Min</span><span class="p">();</span><span class="w"> </span><span class="c1">// 6;</span>
</span><span id="__span-640-4"><a id="__codelineno-640-4" name="__codelineno-640-4" href="#__codelineno-640-4"></a>
</span><span id="__span-640-5"><a id="__codelineno-640-5" name="__codelineno-640-5" href="#__codelineno-640-5"></a><span class="c1">//The quantifiers return a bool value:</span>
</span><span id="__span-640-6"><a id="__codelineno-640-6" name="__codelineno-640-6" href="#__codelineno-640-6"></a><span class="kt">bool</span><span class="w"> </span><span class="n">hasTheNumberNine</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">numbers</span><span class="p">.</span><span class="n">Contains</span><span class="w"> </span><span class="p">(</span><span class="mi">9</span><span class="p">);</span><span class="w"> </span><span class="c1">// true</span>
</span><span id="__span-640-7"><a id="__codelineno-640-7" name="__codelineno-640-7" href="#__codelineno-640-7"></a><span class="kt">bool</span><span class="w"> </span><span class="n">hasMoreThanZeroElements</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">numbers</span><span class="p">.</span><span class="n">Any</span><span class="p">();</span><span class="w"> </span><span class="c1">// true</span>
</span><span id="__span-640-8"><a id="__codelineno-640-8" name="__codelineno-640-8" href="#__codelineno-640-8"></a><span class="kt">bool</span><span class="w"> </span><span class="n">hasAnOddElement</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">numbers</span><span class="p">.</span><span class="n">Any</span><span class="w"> </span><span class="p">(</span><span class="n">n</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="n">n</span><span class="w"> </span><span class="o">%</span><span class="w"> </span><span class="mi">2</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="mi">0</span><span class="p">);</span><span class="w"> </span><span class="c1">// true</span>
</span></code></pre></div>
<p>Some query operators accept two input sequences. Examples are Concat, which appends one sequence to another, and Union, which does the same but with duplicates removed</p>
<div class="language-csharp highlight"><pre><span></span><code><span id="__span-641-1"><a id="__codelineno-641-1" name="__codelineno-641-1" href="#__codelineno-641-1"></a><span class="kt">int</span><span class="p">[]</span><span class="w"> </span><span class="n">seq1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="mi">3</span><span class="w"> </span><span class="p">};</span>
</span><span id="__span-641-2"><a id="__codelineno-641-2" name="__codelineno-641-2" href="#__codelineno-641-2"></a><span class="kt">int</span><span class="p">[]</span><span class="w"> </span><span class="n">seq2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="mi">3</span><span class="p">,</span><span class="w"> </span><span class="mi">4</span><span class="p">,</span><span class="w"> </span><span class="mi">5</span><span class="w"> </span><span class="p">};</span>
</span><span id="__span-641-3"><a id="__codelineno-641-3" name="__codelineno-641-3" href="#__codelineno-641-3"></a><span class="n">IEnumerable</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span><span class="w"> </span><span class="n">concat</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">seq1</span><span class="p">.</span><span class="n">Concat</span><span class="w"> </span><span class="p">(</span><span class="n">seq2</span><span class="p">);</span><span class="w"> </span><span class="c1">// { 1, 2, 3, 3, 4, 5 }</span>
</span><span id="__span-641-4"><a id="__codelineno-641-4" name="__codelineno-641-4" href="#__codelineno-641-4"></a><span class="n">IEnumerable</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span><span class="w"> </span><span class="n">union</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">seq1</span><span class="p">.</span><span class="n">Union</span><span class="w"> </span><span class="p">(</span><span class="n">seq2</span><span class="p">);</span><span class="w"> </span><span class="c1">// { 1, 2, 3, 4, 5 }</span>
</span></code></pre></div>
<h1 id="query-expressions">Query Expressions</h1>
<p>C# provides a syntactic shortcut for writing LINQ queries, called query expressions.</p>
<p>Contrary to popular belief, a query expression is not a means of embedding SQL into C#. In fact, the design of query expressions was inspired primarily by list comprehensions from functional programming languages such as LISP and Haskell, although SQL had a cosmetic influence.</p>
<div class="language-csharp highlight"><pre><span></span><code><span id="__span-642-1"><a id="__codelineno-642-1" name="__codelineno-642-1" href="#__codelineno-642-1"></a><span class="kt">string</span><span class="p">[]</span><span class="w"> </span><span class="n">names</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="s">&quot;Tom&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Dick&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Harry&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Mary&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Jay&quot;</span><span class="w"> </span><span class="p">};</span>
</span><span id="__span-642-2"><a id="__codelineno-642-2" name="__codelineno-642-2" href="#__codelineno-642-2"></a>
</span><span id="__span-642-3"><a id="__codelineno-642-3" name="__codelineno-642-3" href="#__codelineno-642-3"></a><span class="n">IEnumerable</span><span class="o">&lt;</span><span class="kt">string</span><span class="o">&gt;</span><span class="w"> </span><span class="n">query</span><span class="w"> </span><span class="o">=</span>
</span><span id="__span-642-4"><a id="__codelineno-642-4" name="__codelineno-642-4" href="#__codelineno-642-4"></a><span class="w">    </span><span class="k">from</span><span class="w">     </span><span class="n">n</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">names</span>
</span><span id="__span-642-5"><a id="__codelineno-642-5" name="__codelineno-642-5" href="#__codelineno-642-5"></a><span class="w">    </span><span class="k">where</span><span class="w">    </span><span class="n">n</span><span class="p">.</span><span class="n">Contains</span><span class="w"> </span><span class="p">(</span><span class="s">&quot;a&quot;</span><span class="p">)</span><span class="w">   </span><span class="c1">// Filter elements</span>
</span><span id="__span-642-6"><a id="__codelineno-642-6" name="__codelineno-642-6" href="#__codelineno-642-6"></a><span class="w">    </span><span class="k">orderby</span><span class="w">  </span><span class="n">n</span><span class="p">.</span><span class="n">Length</span><span class="w">           </span><span class="c1">// Sort elements</span>
</span><span id="__span-642-7"><a id="__codelineno-642-7" name="__codelineno-642-7" href="#__codelineno-642-7"></a><span class="w">    </span><span class="k">select</span><span class="w">   </span><span class="n">n</span><span class="p">.</span><span class="n">ToUpper</span><span class="p">();</span><span class="w">       </span><span class="c1">// Translate each element (project)</span>
</span><span id="__span-642-8"><a id="__codelineno-642-8" name="__codelineno-642-8" href="#__codelineno-642-8"></a>
</span><span id="__span-642-9"><a id="__codelineno-642-9" name="__codelineno-642-9" href="#__codelineno-642-9"></a><span class="k">foreach</span><span class="w"> </span><span class="p">(</span><span class="kt">string</span><span class="w"> </span><span class="n">name</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">query</span><span class="p">)</span><span class="w"> </span><span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="w"> </span><span class="p">(</span><span class="n">name</span><span class="p">);</span>
</span><span id="__span-642-10"><a id="__codelineno-642-10" name="__codelineno-642-10" href="#__codelineno-642-10"></a><span class="cm">/*</span>
</span><span id="__span-642-11"><a id="__codelineno-642-11" name="__codelineno-642-11" href="#__codelineno-642-11"></a><span class="cm">                JAY</span>
</span><span id="__span-642-12"><a id="__codelineno-642-12" name="__codelineno-642-12" href="#__codelineno-642-12"></a><span class="cm">                MARY</span>
</span><span id="__span-642-13"><a id="__codelineno-642-13" name="__codelineno-642-13" href="#__codelineno-642-13"></a><span class="cm">                HARRY</span>
</span><span id="__span-642-14"><a id="__codelineno-642-14" name="__codelineno-642-14" href="#__codelineno-642-14"></a><span class="cm">            */</span>
</span></code></pre></div>
<p>Query expressions always start with a from clause and end with either a select or a group clause. The from clause declares a range variable (in this case, n), which you can think of as traversing the input sequence rather like foreach.</p>
<p>The compiler processes a query expression by translating it into fluent syntax. It does this in a fairly mechanical fashionâ€”much like it translates foreach statements into calls to GetEnumerator and MoveNext. This means that anything you can write in query syntax you can also write in fluent syntax. The compiler (initially) translates our example query into the following:</p>
<div class="language-csharp highlight"><pre><span></span><code><span id="__span-643-1"><a id="__codelineno-643-1" name="__codelineno-643-1" href="#__codelineno-643-1"></a><span class="n">IEnumerable</span><span class="o">&lt;</span><span class="kt">string</span><span class="o">&gt;</span><span class="w"> </span><span class="n">query</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">names</span><span class="p">.</span><span class="n">Where</span><span class="w"> </span><span class="p">(</span><span class="n">n</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="n">n</span><span class="p">.</span><span class="n">Contains</span><span class="w"> </span><span class="p">(</span><span class="s">&quot;a&quot;</span><span class="p">))</span>
</span><span id="__span-643-2"><a id="__codelineno-643-2" name="__codelineno-643-2" href="#__codelineno-643-2"></a><span class="w"> </span><span class="p">.</span><span class="n">OrderBy</span><span class="w"> </span><span class="p">(</span><span class="n">n</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="n">n</span><span class="p">.</span><span class="n">Length</span><span class="p">)</span>
</span><span id="__span-643-3"><a id="__codelineno-643-3" name="__codelineno-643-3" href="#__codelineno-643-3"></a><span class="w"> </span><span class="p">.</span><span class="n">Select</span><span class="w"> </span><span class="p">(</span><span class="n">n</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="n">n</span><span class="p">.</span><span class="n">ToUpper</span><span class="p">());</span>
</span></code></pre></div>
<h3 id="range-variables">Range Variables</h3>
<p>The identifier immediately following the from keyword syntax is called the range variable. A range variable refers to the current element in the sequence on which the operation is to be performed.</p>
<p>In our examples, the range variable n appears in every clause in the query. And yet, the variable actually enumerates over a different sequence with each clause:</p>
<div class="language-csharp highlight"><pre><span></span><code><span id="__span-644-1"><a id="__codelineno-644-1" name="__codelineno-644-1" href="#__codelineno-644-1"></a><span class="k">from</span><span class="w"> </span><span class="n">n</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">names</span><span class="w"> </span><span class="c1">// n is our range variable</span>
</span><span id="__span-644-2"><a id="__codelineno-644-2" name="__codelineno-644-2" href="#__codelineno-644-2"></a><span class="k">where</span><span class="w"> </span><span class="n">n</span><span class="p">.</span><span class="n">Contains</span><span class="w"> </span><span class="p">(</span><span class="s">&quot;a&quot;</span><span class="p">)</span><span class="w"> </span><span class="c1">// n = directly from the array</span>
</span><span id="__span-644-3"><a id="__codelineno-644-3" name="__codelineno-644-3" href="#__codelineno-644-3"></a><span class="k">orderby</span><span class="w"> </span><span class="n">n</span><span class="p">.</span><span class="n">Length</span><span class="w"> </span><span class="c1">// n = subsequent to being filtered</span>
</span><span id="__span-644-4"><a id="__codelineno-644-4" name="__codelineno-644-4" href="#__codelineno-644-4"></a><span class="k">select</span><span class="w"> </span><span class="n">n</span><span class="p">.</span><span class="n">ToUpper</span><span class="p">()</span><span class="w"> </span><span class="c1">// n = subsequent to being sorted</span>
</span></code></pre></div>
<p>This becomes clear when we examine the compilerâ€™s mechanical translation to fluent syntax:</p>
<div class="language-csharp highlight"><pre><span></span><code><span id="__span-645-1"><a id="__codelineno-645-1" name="__codelineno-645-1" href="#__codelineno-645-1"></a><span class="n">names</span><span class="p">.</span><span class="n">Where</span><span class="w"> </span><span class="p">(</span><span class="n">n</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="n">n</span><span class="p">.</span><span class="n">Contains</span><span class="w"> </span><span class="p">(</span><span class="s">&quot;a&quot;</span><span class="p">))</span><span class="w"> </span><span class="c1">// Locally scoped n</span>
</span><span id="__span-645-2"><a id="__codelineno-645-2" name="__codelineno-645-2" href="#__codelineno-645-2"></a><span class="w"> </span><span class="p">.</span><span class="n">OrderBy</span><span class="w"> </span><span class="p">(</span><span class="n">n</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="n">n</span><span class="p">.</span><span class="n">Length</span><span class="p">)</span><span class="w"> </span><span class="c1">// Locally scoped n</span>
</span><span id="__span-645-3"><a id="__codelineno-645-3" name="__codelineno-645-3" href="#__codelineno-645-3"></a><span class="w"> </span><span class="p">.</span><span class="n">Select</span><span class="w"> </span><span class="p">(</span><span class="n">n</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="n">n</span><span class="p">.</span><span class="n">ToUpper</span><span class="p">())</span><span class="w"> </span><span class="c1">// Locally scoped n</span>
</span></code></pre></div>
<h3 id="mixed-syntax-queries">Mixed-Syntax Queries</h3>
<p>If a query operator has no query-syntax support, you can mix query syntax and fluent syntax. The only restriction is that each query-syntax component must be complete</p>
<div class="language-csharp highlight"><pre><span></span><code><span id="__span-646-1"><a id="__codelineno-646-1" name="__codelineno-646-1" href="#__codelineno-646-1"></a><span class="kt">string</span><span class="p">[]</span><span class="w"> </span><span class="n">names</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="s">&quot;Tom&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Dick&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Harry&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Mary&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Jay&quot;</span><span class="w"> </span><span class="p">};</span>
</span><span id="__span-646-2"><a id="__codelineno-646-2" name="__codelineno-646-2" href="#__codelineno-646-2"></a>
</span><span id="__span-646-3"><a id="__codelineno-646-3" name="__codelineno-646-3" href="#__codelineno-646-3"></a><span class="p">(</span><span class="k">from</span><span class="w"> </span><span class="n">n</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">names</span><span class="w"> </span><span class="k">where</span><span class="w"> </span><span class="n">n</span><span class="p">.</span><span class="n">Contains</span><span class="w"> </span><span class="p">(</span><span class="s">&quot;a&quot;</span><span class="p">)</span><span class="w"> </span><span class="k">select</span><span class="w"> </span><span class="n">n</span><span class="p">).</span><span class="n">Count</span><span class="p">()</span>
</span><span id="__span-646-4"><a id="__codelineno-646-4" name="__codelineno-646-4" href="#__codelineno-646-4"></a><span class="w">    </span><span class="p">.</span><span class="n">Dump</span><span class="w"> </span><span class="p">(</span><span class="s">&quot;Names containing the letter &#39;a&#39;&quot;</span><span class="p">);</span>
</span><span id="__span-646-5"><a id="__codelineno-646-5" name="__codelineno-646-5" href="#__codelineno-646-5"></a>
</span><span id="__span-646-6"><a id="__codelineno-646-6" name="__codelineno-646-6" href="#__codelineno-646-6"></a><span class="kt">string</span><span class="w"> </span><span class="n">first</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="k">from</span><span class="w"> </span><span class="n">n</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">names</span><span class="w"> </span><span class="k">orderby</span><span class="w"> </span><span class="n">n</span><span class="w"> </span><span class="k">select</span><span class="w"> </span><span class="n">n</span><span class="p">).</span><span class="n">First</span><span class="p">()</span>
</span><span id="__span-646-7"><a id="__codelineno-646-7" name="__codelineno-646-7" href="#__codelineno-646-7"></a><span class="w">    </span><span class="p">.</span><span class="n">Dump</span><span class="w"> </span><span class="p">(</span><span class="s">&quot;First name, alphabetically&quot;</span><span class="p">);</span>
</span><span id="__span-646-8"><a id="__codelineno-646-8" name="__codelineno-646-8" href="#__codelineno-646-8"></a>
</span><span id="__span-646-9"><a id="__codelineno-646-9" name="__codelineno-646-9" href="#__codelineno-646-9"></a><span class="n">names</span><span class="p">.</span><span class="n">Where</span><span class="w"> </span><span class="p">(</span><span class="n">n</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="n">n</span><span class="p">.</span><span class="n">Contains</span><span class="w"> </span><span class="p">(</span><span class="s">&quot;a&quot;</span><span class="p">)).</span><span class="n">Count</span><span class="p">()</span>
</span><span id="__span-646-10"><a id="__codelineno-646-10" name="__codelineno-646-10" href="#__codelineno-646-10"></a><span class="w">    </span><span class="p">.</span><span class="n">Dump</span><span class="w"> </span><span class="p">(</span><span class="s">&quot;Original query, entirely in fluent syntax&quot;</span><span class="p">);</span>
</span><span id="__span-646-11"><a id="__codelineno-646-11" name="__codelineno-646-11" href="#__codelineno-646-11"></a>
</span><span id="__span-646-12"><a id="__codelineno-646-12" name="__codelineno-646-12" href="#__codelineno-646-12"></a><span class="n">names</span><span class="p">.</span><span class="n">OrderBy</span><span class="w"> </span><span class="p">(</span><span class="n">n</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="n">n</span><span class="p">).</span><span class="n">First</span><span class="p">()</span>
</span><span id="__span-646-13"><a id="__codelineno-646-13" name="__codelineno-646-13" href="#__codelineno-646-13"></a><span class="w">    </span><span class="p">.</span><span class="n">Dump</span><span class="w"> </span><span class="p">(</span><span class="s">&quot;Second query, entirely in fluent syntax&quot;</span><span class="p">);</span>
</span></code></pre></div>
<h1 id="deferred-execution">Deferred Execution</h1>
<p>An important feature of most query operators is that they execute not when constructed, but when enumerated (in other words, when MoveNext is called on its enumerator).</p>
<div class="language-csharp highlight"><pre><span></span><code><span id="__span-647-1"><a id="__codelineno-647-1" name="__codelineno-647-1" href="#__codelineno-647-1"></a><span class="kt">var</span><span class="w"> </span><span class="n">numbers</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">List</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="p">};</span>
</span><span id="__span-647-2"><a id="__codelineno-647-2" name="__codelineno-647-2" href="#__codelineno-647-2"></a><span class="n">IEnumerable</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span><span class="w"> </span><span class="n">query</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">numbers</span><span class="p">.</span><span class="n">Select</span><span class="w"> </span><span class="p">(</span><span class="n">n</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="n">n</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mi">10</span><span class="p">);</span><span class="w"> </span><span class="c1">// Build query</span>
</span><span id="__span-647-3"><a id="__codelineno-647-3" name="__codelineno-647-3" href="#__codelineno-647-3"></a><span class="n">numbers</span><span class="p">.</span><span class="n">Add</span><span class="w"> </span><span class="p">(</span><span class="mi">2</span><span class="p">);</span><span class="w"> </span><span class="c1">// Sneak in an extra element</span>
</span><span id="__span-647-4"><a id="__codelineno-647-4" name="__codelineno-647-4" href="#__codelineno-647-4"></a><span class="k">foreach</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">n</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">query</span><span class="p">)</span>
</span><span id="__span-647-5"><a id="__codelineno-647-5" name="__codelineno-647-5" href="#__codelineno-647-5"></a><span class="n">Console</span><span class="p">.</span><span class="n">Write</span><span class="w"> </span><span class="p">(</span><span class="n">n</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s">&quot;|&quot;</span><span class="p">);</span><span class="w"> </span><span class="c1">// 10|20|</span>
</span></code></pre></div>
<p>The extra number that we sneaked into the list after constructing the query is included in the result because itâ€™s not until the foreach statement runs that any filtering or sorting takes place. This is called deferred or lazy execution and is the same as what happens with delegates.</p>
<p>All standard query operators provide deferred execution, with the following exceptions</p>
<ul>
<li>Operators that return a single element or scalar value, such as First or Count</li>
<li>The following conversion operators:ToArray, ToList, ToDictionary, ToLookup, ToHashSet</li>
</ul>
<p>These operators cause immediate query execution because their result types have no mechanism to provide deferred execution. The Count method, for instance, returns a simple integer, which doesnâ€™t then get enumerated. The following query is executed immediately:</p>
<div class="language-csharp highlight"><pre><span></span><code><span id="__span-648-1"><a id="__codelineno-648-1" name="__codelineno-648-1" href="#__codelineno-648-1"></a><span class="kt">int</span><span class="w"> </span><span class="n">matches</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">numbers</span><span class="p">.</span><span class="n">Where</span><span class="w"> </span><span class="p">(</span><span class="n">n</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="n">n</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="mi">2</span><span class="p">).</span><span class="n">Count</span><span class="p">();</span><span class="w"> </span><span class="c1">// 1</span>
</span></code></pre></div>
<p>Deferred execution is important because it decouples query construction from query execution. This allows you to construct a query in several steps, and makes database queries possible.</p>
<h3 id="reevaluation">Reevaluation</h3>
<p>Deferred execution has another consequence: a deferred execution query is reevaluated when you reenumerate:</p>
<div class="language-csharp highlight"><pre><span></span><code><span id="__span-649-1"><a id="__codelineno-649-1" name="__codelineno-649-1" href="#__codelineno-649-1"></a><span class="kt">var</span><span class="w"> </span><span class="n">numbers</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">List</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="w"> </span><span class="p">};</span>
</span><span id="__span-649-2"><a id="__codelineno-649-2" name="__codelineno-649-2" href="#__codelineno-649-2"></a><span class="n">IEnumerable</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span><span class="w"> </span><span class="n">query</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">numbers</span><span class="p">.</span><span class="n">Select</span><span class="w"> </span><span class="p">(</span><span class="n">n</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="n">n</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mi">10</span><span class="p">);</span>
</span><span id="__span-649-3"><a id="__codelineno-649-3" name="__codelineno-649-3" href="#__codelineno-649-3"></a><span class="k">foreach</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">n</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">query</span><span class="p">)</span><span class="w"> </span><span class="n">Console</span><span class="p">.</span><span class="n">Write</span><span class="w"> </span><span class="p">(</span><span class="n">n</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s">&quot;|&quot;</span><span class="p">);</span><span class="w"> </span><span class="c1">// 10|20|</span>
</span><span id="__span-649-4"><a id="__codelineno-649-4" name="__codelineno-649-4" href="#__codelineno-649-4"></a><span class="n">numbers</span><span class="p">.</span><span class="n">Clear</span><span class="p">();</span>
</span><span id="__span-649-5"><a id="__codelineno-649-5" name="__codelineno-649-5" href="#__codelineno-649-5"></a><span class="k">foreach</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">n</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">query</span><span class="p">)</span><span class="w"> </span><span class="n">Console</span><span class="p">.</span><span class="n">Write</span><span class="w"> </span><span class="p">(</span><span class="n">n</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s">&quot;|&quot;</span><span class="p">);</span><span class="w"> </span><span class="c1">// &lt;nothing&gt;</span>
</span></code></pre></div>
<p>There are a couple of reasons why reevaluation is sometimes disadvantageous</p>
<ul>
<li>Sometimes, you want to â€œfreezeâ€ or cache the results at a certain point in time.</li>
<li>Some queries are computationally intensive (or rely on querying a remote dataâ€
base), so you donâ€™t want to unnecessarily repeat them</li>
</ul>
<p>You can defeat reevaluation by calling a conversion operator such as ToArray or ToList.</p>
<div class="language-csharp highlight"><pre><span></span><code><span id="__span-650-1"><a id="__codelineno-650-1" name="__codelineno-650-1" href="#__codelineno-650-1"></a><span class="kt">var</span><span class="w"> </span><span class="n">numbers</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">List</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="w"> </span><span class="p">};</span>
</span><span id="__span-650-2"><a id="__codelineno-650-2" name="__codelineno-650-2" href="#__codelineno-650-2"></a><span class="n">List</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span><span class="w"> </span><span class="n">timesTen</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">numbers</span>
</span><span id="__span-650-3"><a id="__codelineno-650-3" name="__codelineno-650-3" href="#__codelineno-650-3"></a><span class="w"> </span><span class="p">.</span><span class="n">Select</span><span class="w"> </span><span class="p">(</span><span class="n">n</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="n">n</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mi">10</span><span class="p">)</span>
</span><span id="__span-650-4"><a id="__codelineno-650-4" name="__codelineno-650-4" href="#__codelineno-650-4"></a><span class="w"> </span><span class="p">.</span><span class="n">ToList</span><span class="p">();</span><span class="w"> </span><span class="c1">// Executes immediately into a List&lt;int&gt;</span>
</span><span id="__span-650-5"><a id="__codelineno-650-5" name="__codelineno-650-5" href="#__codelineno-650-5"></a><span class="n">numbers</span><span class="p">.</span><span class="n">Clear</span><span class="p">();</span>
</span><span id="__span-650-6"><a id="__codelineno-650-6" name="__codelineno-650-6" href="#__codelineno-650-6"></a><span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="w"> </span><span class="p">(</span><span class="n">timesTen</span><span class="p">.</span><span class="n">Count</span><span class="p">);</span><span class="w"> </span><span class="c1">// Still 2</span>
</span></code></pre></div>
<h3 id="captured-variables">Captured Variables</h3>
<p>If your queryâ€™s lambda expressions capture outer variables, the query will honor the
value of those variables at the time the query runs:</p>
<div class="language-csharp highlight"><pre><span></span><code><span id="__span-651-1"><a id="__codelineno-651-1" name="__codelineno-651-1" href="#__codelineno-651-1"></a><span class="kt">int</span><span class="p">[]</span><span class="w"> </span><span class="n">numbers</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="w"> </span><span class="p">};</span>
</span><span id="__span-651-2"><a id="__codelineno-651-2" name="__codelineno-651-2" href="#__codelineno-651-2"></a><span class="kt">int</span><span class="w"> </span><span class="n">factor</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">10</span><span class="p">;</span>
</span><span id="__span-651-3"><a id="__codelineno-651-3" name="__codelineno-651-3" href="#__codelineno-651-3"></a><span class="n">IEnumerable</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span><span class="w"> </span><span class="n">query</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">numbers</span><span class="p">.</span><span class="n">Select</span><span class="w"> </span><span class="p">(</span><span class="n">n</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="n">n</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">factor</span><span class="p">);</span>
</span><span id="__span-651-4"><a id="__codelineno-651-4" name="__codelineno-651-4" href="#__codelineno-651-4"></a><span class="n">factor</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">20</span><span class="p">;</span>
</span><span id="__span-651-5"><a id="__codelineno-651-5" name="__codelineno-651-5" href="#__codelineno-651-5"></a><span class="k">foreach</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">n</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">query</span><span class="p">)</span><span class="w"> </span><span class="n">Console</span><span class="p">.</span><span class="n">Write</span><span class="w"> </span><span class="p">(</span><span class="n">n</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s">&quot;|&quot;</span><span class="p">);</span><span class="w"> </span><span class="c1">// 20|40|</span>
</span></code></pre></div>
<p>This can be a trap when building up a query within a for loop. F</p>
<div class="language-csharp highlight"><pre><span></span><code><span id="__span-652-1"><a id="__codelineno-652-1" name="__codelineno-652-1" href="#__codelineno-652-1"></a><span class="n">IEnumerable</span><span class="o">&lt;</span><span class="kt">char</span><span class="o">&gt;</span><span class="w"> </span><span class="n">query</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;Not what you might expect&quot;</span><span class="p">;</span>
</span><span id="__span-652-2"><a id="__codelineno-652-2" name="__codelineno-652-2" href="#__codelineno-652-2"></a><span class="n">query</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">query</span><span class="p">.</span><span class="n">Where</span><span class="w"> </span><span class="p">(</span><span class="n">c</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="n">c</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="sc">&#39;a&#39;</span><span class="p">);</span>
</span><span id="__span-652-3"><a id="__codelineno-652-3" name="__codelineno-652-3" href="#__codelineno-652-3"></a><span class="n">query</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">query</span><span class="p">.</span><span class="n">Where</span><span class="w"> </span><span class="p">(</span><span class="n">c</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="n">c</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="sc">&#39;e&#39;</span><span class="p">);</span>
</span><span id="__span-652-4"><a id="__codelineno-652-4" name="__codelineno-652-4" href="#__codelineno-652-4"></a><span class="n">query</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">query</span><span class="p">.</span><span class="n">Where</span><span class="w"> </span><span class="p">(</span><span class="n">c</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="n">c</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="sc">&#39;i&#39;</span><span class="p">);</span>
</span><span id="__span-652-5"><a id="__codelineno-652-5" name="__codelineno-652-5" href="#__codelineno-652-5"></a><span class="n">query</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">query</span><span class="p">.</span><span class="n">Where</span><span class="w"> </span><span class="p">(</span><span class="n">c</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="n">c</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="sc">&#39;o&#39;</span><span class="p">);</span>
</span><span id="__span-652-6"><a id="__codelineno-652-6" name="__codelineno-652-6" href="#__codelineno-652-6"></a><span class="n">query</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">query</span><span class="p">.</span><span class="n">Where</span><span class="w"> </span><span class="p">(</span><span class="n">c</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="n">c</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="sc">&#39;u&#39;</span><span class="p">);</span>
</span><span id="__span-652-7"><a id="__codelineno-652-7" name="__codelineno-652-7" href="#__codelineno-652-7"></a><span class="k">foreach</span><span class="w"> </span><span class="p">(</span><span class="kt">char</span><span class="w"> </span><span class="n">c</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">query</span><span class="p">)</span><span class="w"> </span><span class="n">Console</span><span class="p">.</span><span class="n">Write</span><span class="w"> </span><span class="p">(</span><span class="n">c</span><span class="p">);</span><span class="w"> </span><span class="c1">// Nt wht y mght xpct</span>
</span><span id="__span-652-8"><a id="__codelineno-652-8" name="__codelineno-652-8" href="#__codelineno-652-8"></a>
</span><span id="__span-652-9"><a id="__codelineno-652-9" name="__codelineno-652-9" href="#__codelineno-652-9"></a><span class="n">IEnumerable</span><span class="o">&lt;</span><span class="kt">char</span><span class="o">&gt;</span><span class="w"> </span><span class="n">query</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;Not what you might expect&quot;</span><span class="p">;</span>
</span><span id="__span-652-10"><a id="__codelineno-652-10" name="__codelineno-652-10" href="#__codelineno-652-10"></a><span class="kt">string</span><span class="w"> </span><span class="n">vowels</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;aeiou&quot;</span><span class="p">;</span>
</span><span id="__span-652-11"><a id="__codelineno-652-11" name="__codelineno-652-11" href="#__codelineno-652-11"></a><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">vowels</span><span class="p">.</span><span class="n">Length</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="o">++</span><span class="p">)</span>
</span><span id="__span-652-12"><a id="__codelineno-652-12" name="__codelineno-652-12" href="#__codelineno-652-12"></a><span class="w"> </span><span class="n">query</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">query</span><span class="p">.</span><span class="n">Where</span><span class="w"> </span><span class="p">(</span><span class="n">c</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="n">c</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="n">vowels</span><span class="p">[</span><span class="n">i</span><span class="p">]);</span><span class="c1">// IndexOutOfRangeException</span>
</span><span id="__span-652-13"><a id="__codelineno-652-13" name="__codelineno-652-13" href="#__codelineno-652-13"></a><span class="k">foreach</span><span class="w"> </span><span class="p">(</span><span class="kt">char</span><span class="w"> </span><span class="n">c</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">query</span><span class="p">)</span><span class="w"> </span><span class="n">Console</span><span class="p">.</span><span class="n">Write</span><span class="w"> </span><span class="p">(</span><span class="n">c</span><span class="p">);</span>
</span><span id="__span-652-14"><a id="__codelineno-652-14" name="__codelineno-652-14" href="#__codelineno-652-14"></a><span class="c1">// An IndexOutOfRangeException is thrown! This is because, as we saw in Chapter 4 </span>
</span><span id="__span-652-15"><a id="__codelineno-652-15" name="__codelineno-652-15" href="#__codelineno-652-15"></a><span class="c1">// (see &quot;Capturing Outer Variables&quot;), the compiler scopes the iteration variable </span>
</span><span id="__span-652-16"><a id="__codelineno-652-16" name="__codelineno-652-16" href="#__codelineno-652-16"></a><span class="c1">// in the for loop as if it was declared outside the loop. Hence each closure captures</span>
</span><span id="__span-652-17"><a id="__codelineno-652-17" name="__codelineno-652-17" href="#__codelineno-652-17"></a><span class="c1">// the same variable (i) whose value is 5 when the query is enumerated.</span>
</span></code></pre></div>
<p>To solve this, you must assign the loop variable to another variable declared inside the statement block</p>
<div class="language-csharp highlight"><pre><span></span><code><span id="__span-653-1"><a id="__codelineno-653-1" name="__codelineno-653-1" href="#__codelineno-653-1"></a><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">vowels</span><span class="p">.</span><span class="n">Length</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="o">++</span><span class="p">)</span>
</span><span id="__span-653-2"><a id="__codelineno-653-2" name="__codelineno-653-2" href="#__codelineno-653-2"></a><span class="p">{</span>
</span><span id="__span-653-3"><a id="__codelineno-653-3" name="__codelineno-653-3" href="#__codelineno-653-3"></a><span class="w"> </span><span class="kt">char</span><span class="w"> </span><span class="n">vowel</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">vowels</span><span class="p">[</span><span class="n">i</span><span class="p">];</span>
</span><span id="__span-653-4"><a id="__codelineno-653-4" name="__codelineno-653-4" href="#__codelineno-653-4"></a><span class="w"> </span><span class="n">query</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">query</span><span class="p">.</span><span class="n">Where</span><span class="w"> </span><span class="p">(</span><span class="n">c</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="n">c</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="n">vowel</span><span class="p">);</span>
</span><span id="__span-653-5"><a id="__codelineno-653-5" name="__codelineno-653-5" href="#__codelineno-653-5"></a><span class="p">}</span>
</span></code></pre></div>
<h1 id="subqueries">Subqueries</h1>
<p>A subquery is a query contained within another queryâ€™s lambda expression. The following example uses a subquery to sort musicians by their last name:</p>
<div class="language-csharp highlight"><pre><span></span><code><span id="__span-654-1"><a id="__codelineno-654-1" name="__codelineno-654-1" href="#__codelineno-654-1"></a><span class="kt">string</span><span class="p">[]</span><span class="w"> </span><span class="n">musos</span><span class="w"> </span><span class="o">=</span>
</span><span id="__span-654-2"><a id="__codelineno-654-2" name="__codelineno-654-2" href="#__codelineno-654-2"></a><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="s">&quot;David Gilmour&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Roger Waters&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Rick Wright&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Nick Mason&quot;</span><span class="w"> </span><span class="p">};</span>
</span><span id="__span-654-3"><a id="__codelineno-654-3" name="__codelineno-654-3" href="#__codelineno-654-3"></a><span class="n">IEnumerable</span><span class="o">&lt;</span><span class="kt">string</span><span class="o">&gt;</span><span class="w"> </span><span class="n">query</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">musos</span><span class="p">.</span><span class="n">OrderBy</span><span class="w"> </span><span class="p">(</span><span class="n">m</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="n">m</span><span class="p">.</span><span class="n">Split</span><span class="p">().</span><span class="n">Last</span><span class="p">());</span>
</span></code></pre></div>
<p><code>m.Split</code> converts each string into a collection of words, upon which we then call the Last query operator. <code>m.Split().Last</code> is the subquery</p>
<div class="language-csharp highlight"><pre><span></span><code><span id="__span-655-1"><a id="__codelineno-655-1" name="__codelineno-655-1" href="#__codelineno-655-1"></a><span class="kt">string</span><span class="p">[]</span><span class="w"> </span><span class="n">names</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="s">&quot;Tom&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Dick&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Harry&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Mary&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Jay&quot;</span><span class="w"> </span><span class="p">};</span>
</span><span id="__span-655-2"><a id="__codelineno-655-2" name="__codelineno-655-2" href="#__codelineno-655-2"></a><span class="n">IEnumerable</span><span class="o">&lt;</span><span class="kt">string</span><span class="o">&gt;</span><span class="w"> </span><span class="n">outerQuery</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">names</span>
</span><span id="__span-655-3"><a id="__codelineno-655-3" name="__codelineno-655-3" href="#__codelineno-655-3"></a><span class="w"> </span><span class="p">.</span><span class="n">Where</span><span class="w"> </span><span class="p">(</span><span class="n">n</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="n">n</span><span class="p">.</span><span class="n">Length</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">names</span><span class="p">.</span><span class="n">OrderBy</span><span class="w"> </span><span class="p">(</span><span class="n">n2</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="n">n2</span><span class="p">.</span><span class="n">Length</span><span class="p">)</span>
</span><span id="__span-655-4"><a id="__codelineno-655-4" name="__codelineno-655-4" href="#__codelineno-655-4"></a><span class="w"> </span><span class="p">.</span><span class="n">Select</span><span class="w"> </span><span class="p">(</span><span class="n">n2</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="n">n2</span><span class="p">.</span><span class="n">Length</span><span class="p">).</span><span class="n">First</span><span class="p">());</span>
</span><span id="__span-655-5"><a id="__codelineno-655-5" name="__codelineno-655-5" href="#__codelineno-655-5"></a><span class="c1">// Tom, Jay</span>
</span></code></pre></div>
<p>Hereâ€™s the same thing as a query expression:</p>
<div class="language-csharp highlight"><pre><span></span><code><span id="__span-656-1"><a id="__codelineno-656-1" name="__codelineno-656-1" href="#__codelineno-656-1"></a><span class="n">IEnumerable</span><span class="o">&lt;</span><span class="kt">string</span><span class="o">&gt;</span><span class="w"> </span><span class="n">outerQuery</span><span class="w"> </span><span class="o">=</span>
</span><span id="__span-656-2"><a id="__codelineno-656-2" name="__codelineno-656-2" href="#__codelineno-656-2"></a><span class="w"> </span><span class="k">from</span><span class="w"> </span><span class="n">n</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">names</span>
</span><span id="__span-656-3"><a id="__codelineno-656-3" name="__codelineno-656-3" href="#__codelineno-656-3"></a><span class="w"> </span><span class="k">where</span><span class="w"> </span><span class="n">n</span><span class="p">.</span><span class="n">Length</span><span class="w"> </span><span class="o">==</span>
</span><span id="__span-656-4"><a id="__codelineno-656-4" name="__codelineno-656-4" href="#__codelineno-656-4"></a><span class="w"> </span><span class="p">(</span><span class="k">from</span><span class="w"> </span><span class="n">n2</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">names</span><span class="w"> </span><span class="k">orderby</span><span class="w"> </span><span class="n">n2</span><span class="p">.</span><span class="n">Length</span><span class="w"> </span><span class="k">select</span><span class="w"> </span><span class="n">n2</span><span class="p">.</span><span class="n">Length</span><span class="p">).</span><span class="n">First</span><span class="p">()</span>
</span><span id="__span-656-5"><a id="__codelineno-656-5" name="__codelineno-656-5" href="#__codelineno-656-5"></a><span class="w"> </span><span class="k">select</span><span class="w"> </span><span class="n">n</span><span class="p">;</span>
</span></code></pre></div>
<p>Because the outer range variable (n) is in scope for a subquery, we cannot reuse n as the subqueryâ€™s range variable.
A subquery is executed whenever the enclosing lambda expression is evaluated. This means that a subquery is executed upon demand, at the discretion of the outer query. You could say that execution proceeds from the outside in. Local queries follow this model literally; interpreted queries (e.g., database queries) follow this model conceptually.</p>
<p>We can express our preceding subquery more succinctly as follows:</p>
<div class="language-csharp highlight"><pre><span></span><code><span id="__span-657-1"><a id="__codelineno-657-1" name="__codelineno-657-1" href="#__codelineno-657-1"></a><span class="n">IEnumerable</span><span class="o">&lt;</span><span class="kt">string</span><span class="o">&gt;</span><span class="w"> </span><span class="n">query</span><span class="w"> </span><span class="o">=</span>
</span><span id="__span-657-2"><a id="__codelineno-657-2" name="__codelineno-657-2" href="#__codelineno-657-2"></a><span class="w"> </span><span class="k">from</span><span class="w"> </span><span class="n">n</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">names</span>
</span><span id="__span-657-3"><a id="__codelineno-657-3" name="__codelineno-657-3" href="#__codelineno-657-3"></a><span class="w"> </span><span class="k">where</span><span class="w"> </span><span class="n">n</span><span class="p">.</span><span class="n">Length</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">names</span><span class="p">.</span><span class="n">OrderBy</span><span class="w"> </span><span class="p">(</span><span class="n">n2</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="n">n2</span><span class="p">.</span><span class="n">Length</span><span class="p">).</span><span class="n">First</span><span class="p">().</span><span class="n">Length</span>
</span><span id="__span-657-4"><a id="__codelineno-657-4" name="__codelineno-657-4" href="#__codelineno-657-4"></a><span class="w"> </span><span class="k">select</span><span class="w"> </span><span class="n">n</span><span class="p">;</span>
</span></code></pre></div>
<p>With the Min aggregation function, we can simplify the query further</p>
<div class="language-csharp highlight"><pre><span></span><code><span id="__span-658-1"><a id="__codelineno-658-1" name="__codelineno-658-1" href="#__codelineno-658-1"></a><span class="n">IEnumerable</span><span class="o">&lt;</span><span class="kt">string</span><span class="o">&gt;</span><span class="w"> </span><span class="n">query</span><span class="w"> </span><span class="o">=</span>
</span><span id="__span-658-2"><a id="__codelineno-658-2" name="__codelineno-658-2" href="#__codelineno-658-2"></a><span class="w"> </span><span class="k">from</span><span class="w"> </span><span class="n">n</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">names</span>
</span><span id="__span-658-3"><a id="__codelineno-658-3" name="__codelineno-658-3" href="#__codelineno-658-3"></a><span class="w"> </span><span class="k">where</span><span class="w"> </span><span class="n">n</span><span class="p">.</span><span class="n">Length</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">names</span><span class="p">.</span><span class="n">Min</span><span class="w"> </span><span class="p">(</span><span class="n">n2</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="n">n2</span><span class="p">.</span><span class="n">Length</span><span class="p">)</span>
</span><span id="__span-658-4"><a id="__codelineno-658-4" name="__codelineno-658-4" href="#__codelineno-658-4"></a><span class="w"> </span><span class="k">select</span><span class="w"> </span><span class="n">n</span><span class="p">;</span>
</span></code></pre></div>
<p>we describe how remote sources such as SQL tables can be queried. Our example makes an ideal database query because it would be processed as a unit, requiring only one round trip to the database server. This query, however, is inefficient for a local collection because the subquery is recalculated on each outer loop iteration. We can avoid this inefficiency by running the subquery separately (so that itâ€™s no longer a subquery):</p>
<div class="language-csharp highlight"><pre><span></span><code><span id="__span-659-1"><a id="__codelineno-659-1" name="__codelineno-659-1" href="#__codelineno-659-1"></a><span class="kt">int</span><span class="w"> </span><span class="n">shortest</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">names</span><span class="p">.</span><span class="n">Min</span><span class="w"> </span><span class="p">(</span><span class="n">n</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="n">n</span><span class="p">.</span><span class="n">Length</span><span class="p">);</span>
</span><span id="__span-659-2"><a id="__codelineno-659-2" name="__codelineno-659-2" href="#__codelineno-659-2"></a><span class="n">IEnumerable</span><span class="o">&lt;</span><span class="kt">string</span><span class="o">&gt;</span><span class="w"> </span><span class="n">query</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">from</span><span class="w"> </span><span class="n">n</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">names</span>
</span><span id="__span-659-3"><a id="__codelineno-659-3" name="__codelineno-659-3" href="#__codelineno-659-3"></a><span class="w"> </span><span class="k">where</span><span class="w"> </span><span class="n">n</span><span class="p">.</span><span class="n">Length</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">shortest</span>
</span><span id="__span-659-4"><a id="__codelineno-659-4" name="__codelineno-659-4" href="#__codelineno-659-4"></a><span class="w"> </span><span class="k">select</span><span class="w"> </span><span class="n">n</span><span class="p">;</span>
</span></code></pre></div>
<h1 id="composition-strategies">Composition Strategies</h1>
<p>In this section, we describe three strategies for building more complex queries</p>
<ul>
<li>Progressive query construction</li>
<li>Using the into keyword</li>
<li>Wrapping queries</li>
</ul>
<h3 id="progressive-query-building">Progressive Query Building</h3>
<p>At the start of the chapter, we demonstrated how you could build a fluent query progressively</p>
<div class="language-csharp highlight"><pre><span></span><code><span id="__span-660-1"><a id="__codelineno-660-1" name="__codelineno-660-1" href="#__codelineno-660-1"></a><span class="kt">var</span><span class="w"> </span><span class="n">filtered</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">names</span><span class="w"> </span><span class="p">.</span><span class="n">Where</span><span class="w"> </span><span class="p">(</span><span class="n">n</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="n">n</span><span class="p">.</span><span class="n">Contains</span><span class="w"> </span><span class="p">(</span><span class="s">&quot;a&quot;</span><span class="p">));</span>
</span><span id="__span-660-2"><a id="__codelineno-660-2" name="__codelineno-660-2" href="#__codelineno-660-2"></a><span class="kt">var</span><span class="w"> </span><span class="n">sorted</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">filtered</span><span class="w"> </span><span class="p">.</span><span class="n">OrderBy</span><span class="w"> </span><span class="p">(</span><span class="n">n</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="n">n</span><span class="p">);</span>
</span><span id="__span-660-3"><a id="__codelineno-660-3" name="__codelineno-660-3" href="#__codelineno-660-3"></a><span class="kt">var</span><span class="w"> </span><span class="n">query</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">sorted</span><span class="w"> </span><span class="p">.</span><span class="n">Select</span><span class="w"> </span><span class="p">(</span><span class="n">n</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="n">n</span><span class="p">.</span><span class="n">ToUpper</span><span class="p">());</span>
</span></code></pre></div>
<p>Because each of the participating query operators returns a decorator sequence, the resultant query is the same chain or layering of decorators that you would get from a single-expression query. There are a couple of potential benefits, however, to building queries progressively</p>
<ul>
<li>It can make queries easier to write.</li>
<li>You can add query operators conditionally.</li>
</ul>
<div class="language-csharp highlight"><pre><span></span><code><span id="__span-661-1"><a id="__codelineno-661-1" name="__codelineno-661-1" href="#__codelineno-661-1"></a><span class="kt">string</span><span class="p">[]</span><span class="w"> </span><span class="n">names</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="s">&quot;Tom&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Dick&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Harry&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Mary&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Jay&quot;</span><span class="w"> </span><span class="p">};</span>
</span><span id="__span-661-2"><a id="__codelineno-661-2" name="__codelineno-661-2" href="#__codelineno-661-2"></a><span class="n">IEnumerable</span><span class="o">&lt;</span><span class="kt">string</span><span class="o">&gt;</span><span class="w"> </span><span class="n">query</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">names</span>
</span><span id="__span-661-3"><a id="__codelineno-661-3" name="__codelineno-661-3" href="#__codelineno-661-3"></a><span class="w"> </span><span class="p">.</span><span class="n">Select</span><span class="w"> </span><span class="p">(</span><span class="n">n</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="n">n</span><span class="p">.</span><span class="n">Replace</span><span class="w"> </span><span class="p">(</span><span class="s">&quot;a&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;&quot;</span><span class="p">).</span><span class="n">Replace</span><span class="w"> </span><span class="p">(</span><span class="s">&quot;e&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;&quot;</span><span class="p">).</span><span class="n">Replace</span><span class="w"> </span><span class="p">(</span><span class="s">&quot;i&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;&quot;</span><span class="p">)</span>
</span><span id="__span-661-4"><a id="__codelineno-661-4" name="__codelineno-661-4" href="#__codelineno-661-4"></a><span class="w"> </span><span class="p">.</span><span class="n">Replace</span><span class="w"> </span><span class="p">(</span><span class="s">&quot;o&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;&quot;</span><span class="p">).</span><span class="n">Replace</span><span class="w"> </span><span class="p">(</span><span class="s">&quot;u&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;&quot;</span><span class="p">))</span>
</span><span id="__span-661-5"><a id="__codelineno-661-5" name="__codelineno-661-5" href="#__codelineno-661-5"></a><span class="w"> </span><span class="p">.</span><span class="n">Where</span><span class="w"> </span><span class="p">(</span><span class="n">n</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="n">n</span><span class="p">.</span><span class="n">Length</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">2</span><span class="p">)</span>
</span><span id="__span-661-6"><a id="__codelineno-661-6" name="__codelineno-661-6" href="#__codelineno-661-6"></a><span class="w"> </span><span class="p">.</span><span class="n">OrderBy</span><span class="w"> </span><span class="p">(</span><span class="n">n</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="n">n</span><span class="p">);</span>
</span><span id="__span-661-7"><a id="__codelineno-661-7" name="__codelineno-661-7" href="#__codelineno-661-7"></a><span class="c1">// Dck</span>
</span><span id="__span-661-8"><a id="__codelineno-661-8" name="__codelineno-661-8" href="#__codelineno-661-8"></a><span class="c1">// Hrry</span>
</span><span id="__span-661-9"><a id="__codelineno-661-9" name="__codelineno-661-9" href="#__codelineno-661-9"></a><span class="c1">// Mry</span>
</span></code></pre></div>
<p>Translating this directly into a query expression is troublesome because the select clause must come after the where and orderby clauses. And if we rearrange the query so as to project last, the result would be different:</p>
<div class="language-csharp highlight"><pre><span></span><code><span id="__span-662-1"><a id="__codelineno-662-1" name="__codelineno-662-1" href="#__codelineno-662-1"></a><span class="kt">string</span><span class="p">[]</span><span class="w"> </span><span class="n">names</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="s">&quot;Tom&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Dick&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Harry&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Mary&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Jay&quot;</span><span class="w"> </span><span class="p">};</span>
</span><span id="__span-662-2"><a id="__codelineno-662-2" name="__codelineno-662-2" href="#__codelineno-662-2"></a><span class="n">IEnumerable</span><span class="o">&lt;</span><span class="kt">string</span><span class="o">&gt;</span><span class="w"> </span><span class="n">query</span><span class="w"> </span><span class="o">=</span>
</span><span id="__span-662-3"><a id="__codelineno-662-3" name="__codelineno-662-3" href="#__codelineno-662-3"></a><span class="w"> </span><span class="k">from</span><span class="w"> </span><span class="n">n</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">names</span>
</span><span id="__span-662-4"><a id="__codelineno-662-4" name="__codelineno-662-4" href="#__codelineno-662-4"></a><span class="w"> </span><span class="k">where</span><span class="w"> </span><span class="n">n</span><span class="p">.</span><span class="n">Length</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">2</span>
</span><span id="__span-662-5"><a id="__codelineno-662-5" name="__codelineno-662-5" href="#__codelineno-662-5"></a><span class="w"> </span><span class="k">orderby</span><span class="w"> </span><span class="n">n</span>
</span><span id="__span-662-6"><a id="__codelineno-662-6" name="__codelineno-662-6" href="#__codelineno-662-6"></a><span class="w"> </span><span class="k">select</span><span class="w"> </span><span class="n">n</span><span class="p">.</span><span class="n">Replace</span><span class="w"> </span><span class="p">(</span><span class="s">&quot;a&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;&quot;</span><span class="p">).</span><span class="n">Replace</span><span class="w"> </span><span class="p">(</span><span class="s">&quot;e&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;&quot;</span><span class="p">).</span><span class="n">Replace</span><span class="w"> </span><span class="p">(</span><span class="s">&quot;i&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;&quot;</span><span class="p">)</span>
</span><span id="__span-662-7"><a id="__codelineno-662-7" name="__codelineno-662-7" href="#__codelineno-662-7"></a><span class="w"> </span><span class="p">.</span><span class="n">Replace</span><span class="w"> </span><span class="p">(</span><span class="s">&quot;o&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;&quot;</span><span class="p">).</span><span class="n">Replace</span><span class="w"> </span><span class="p">(</span><span class="s">&quot;u&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;&quot;</span><span class="p">);</span>
</span><span id="__span-662-8"><a id="__codelineno-662-8" name="__codelineno-662-8" href="#__codelineno-662-8"></a><span class="c1">// Dck</span>
</span><span id="__span-662-9"><a id="__codelineno-662-9" name="__codelineno-662-9" href="#__codelineno-662-9"></a><span class="c1">// Hrry</span>
</span><span id="__span-662-10"><a id="__codelineno-662-10" name="__codelineno-662-10" href="#__codelineno-662-10"></a><span class="c1">// Jy</span>
</span><span id="__span-662-11"><a id="__codelineno-662-11" name="__codelineno-662-11" href="#__codelineno-662-11"></a><span class="c1">// Mry</span>
</span><span id="__span-662-12"><a id="__codelineno-662-12" name="__codelineno-662-12" href="#__codelineno-662-12"></a><span class="c1">// Tm</span>
</span></code></pre></div>
<p>Fortunately, there are a number of ways to get the original result in query syntax</p>
<div class="language-csharp highlight"><pre><span></span><code><span id="__span-663-1"><a id="__codelineno-663-1" name="__codelineno-663-1" href="#__codelineno-663-1"></a><span class="kt">string</span><span class="p">[]</span><span class="w"> </span><span class="n">names</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="s">&quot;Tom&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Dick&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Harry&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Mary&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Jay&quot;</span><span class="w"> </span><span class="p">};</span>
</span><span id="__span-663-2"><a id="__codelineno-663-2" name="__codelineno-663-2" href="#__codelineno-663-2"></a><span class="n">IEnumerable</span><span class="o">&lt;</span><span class="kt">string</span><span class="o">&gt;</span><span class="w"> </span><span class="n">query</span><span class="w"> </span><span class="o">=</span>
</span><span id="__span-663-3"><a id="__codelineno-663-3" name="__codelineno-663-3" href="#__codelineno-663-3"></a><span class="w"> </span><span class="k">from</span><span class="w"> </span><span class="n">n</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">names</span>
</span><span id="__span-663-4"><a id="__codelineno-663-4" name="__codelineno-663-4" href="#__codelineno-663-4"></a><span class="w"> </span><span class="k">select</span><span class="w"> </span><span class="n">n</span><span class="p">.</span><span class="n">Replace</span><span class="w"> </span><span class="p">(</span><span class="s">&quot;a&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;&quot;</span><span class="p">).</span><span class="n">Replace</span><span class="w"> </span><span class="p">(</span><span class="s">&quot;e&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;&quot;</span><span class="p">).</span><span class="n">Replace</span><span class="w"> </span><span class="p">(</span><span class="s">&quot;i&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;&quot;</span><span class="p">)</span>
</span><span id="__span-663-5"><a id="__codelineno-663-5" name="__codelineno-663-5" href="#__codelineno-663-5"></a><span class="w"> </span><span class="p">.</span><span class="n">Replace</span><span class="w"> </span><span class="p">(</span><span class="s">&quot;o&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;&quot;</span><span class="p">).</span><span class="n">Replace</span><span class="w"> </span><span class="p">(</span><span class="s">&quot;u&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;&quot;</span><span class="p">);</span>
</span><span id="__span-663-6"><a id="__codelineno-663-6" name="__codelineno-663-6" href="#__codelineno-663-6"></a><span class="n">query</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">from</span><span class="w"> </span><span class="n">n</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">query</span><span class="w"> </span><span class="k">where</span><span class="w"> </span><span class="n">n</span><span class="p">.</span><span class="n">Length</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">2</span><span class="w"> </span><span class="k">orderby</span><span class="w"> </span><span class="n">n</span><span class="w"> </span><span class="k">select</span><span class="w"> </span><span class="n">n</span><span class="p">;</span>
</span><span id="__span-663-7"><a id="__codelineno-663-7" name="__codelineno-663-7" href="#__codelineno-663-7"></a><span class="c1">// Dck</span>
</span><span id="__span-663-8"><a id="__codelineno-663-8" name="__codelineno-663-8" href="#__codelineno-663-8"></a><span class="c1">// Hrry</span>
</span><span id="__span-663-9"><a id="__codelineno-663-9" name="__codelineno-663-9" href="#__codelineno-663-9"></a><span class="c1">// Mry</span>
</span></code></pre></div>
<h3 id="the-into-keyword">The into Keyword</h3>
<p>The into keyword is interpreted in two very different ways by query expressions, depending on context. The meaning weâ€™re describing now is for signaling query continuation (the other is
for signaling a GroupJoin). </p>
<div class="language-csharp highlight"><pre><span></span><code><span id="__span-664-1"><a id="__codelineno-664-1" name="__codelineno-664-1" href="#__codelineno-664-1"></a><span class="kt">string</span><span class="p">[]</span><span class="w"> </span><span class="n">names</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="s">&quot;Tom&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Dick&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Harry&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Mary&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Jay&quot;</span><span class="w"> </span><span class="p">};</span>
</span><span id="__span-664-2"><a id="__codelineno-664-2" name="__codelineno-664-2" href="#__codelineno-664-2"></a><span class="n">IEnumerable</span><span class="o">&lt;</span><span class="kt">string</span><span class="o">&gt;</span><span class="w"> </span><span class="n">query</span><span class="w"> </span><span class="o">=</span>
</span><span id="__span-664-3"><a id="__codelineno-664-3" name="__codelineno-664-3" href="#__codelineno-664-3"></a><span class="w"> </span><span class="k">from</span><span class="w"> </span><span class="n">n</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">names</span>
</span><span id="__span-664-4"><a id="__codelineno-664-4" name="__codelineno-664-4" href="#__codelineno-664-4"></a><span class="w"> </span><span class="k">select</span><span class="w"> </span><span class="n">n</span><span class="p">.</span><span class="n">Replace</span><span class="w"> </span><span class="p">(</span><span class="s">&quot;a&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;&quot;</span><span class="p">).</span><span class="n">Replace</span><span class="w"> </span><span class="p">(</span><span class="s">&quot;e&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;&quot;</span><span class="p">).</span><span class="n">Replace</span><span class="w"> </span><span class="p">(</span><span class="s">&quot;i&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;&quot;</span><span class="p">)</span>
</span><span id="__span-664-5"><a id="__codelineno-664-5" name="__codelineno-664-5" href="#__codelineno-664-5"></a><span class="w"> </span><span class="p">.</span><span class="n">Replace</span><span class="w"> </span><span class="p">(</span><span class="s">&quot;o&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;&quot;</span><span class="p">).</span><span class="n">Replace</span><span class="w"> </span><span class="p">(</span><span class="s">&quot;u&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;&quot;</span><span class="p">)</span>
</span><span id="__span-664-6"><a id="__codelineno-664-6" name="__codelineno-664-6" href="#__codelineno-664-6"></a><span class="w"> </span><span class="o">**</span><span class="k">into</span><span class="w"> </span><span class="n">noVowel</span><span class="o">**</span>
</span><span id="__span-664-7"><a id="__codelineno-664-7" name="__codelineno-664-7" href="#__codelineno-664-7"></a><span class="w"> </span><span class="k">where</span><span class="w"> </span><span class="n">noVowel</span><span class="p">.</span><span class="n">Length</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">2</span><span class="w"> </span><span class="k">orderby</span><span class="w"> </span><span class="n">noVowel</span><span class="w"> </span><span class="k">select</span><span class="w"> </span><span class="n">noVowel</span><span class="p">;</span>
</span></code></pre></div>
<p><strong>The only place you can use into is after a select or group clause. into restarts a query, allowing you to introduce fresh where, orderby, and select clauses.</strong></p>
<p>Although itâ€™s easiest to think of into as restarting a query from the perspective of a query expression, itâ€™s all one query when translated to its final fluent form. Hence, thereâ€™s no
intrinsic performance hit with into. Nor do you lose any points for its use!</p>
<p><strong>All range variables are out of scope following an into keyword. The following will not compile:</strong></p>
<div class="language-csharp highlight"><pre><span></span><code><span id="__span-665-1"><a id="__codelineno-665-1" name="__codelineno-665-1" href="#__codelineno-665-1"></a><span class="kt">var</span><span class="w"> </span><span class="n">query</span><span class="w"> </span><span class="o">=</span>
</span><span id="__span-665-2"><a id="__codelineno-665-2" name="__codelineno-665-2" href="#__codelineno-665-2"></a><span class="w"> </span><span class="k">from</span><span class="w"> </span><span class="n">n1</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">names</span>
</span><span id="__span-665-3"><a id="__codelineno-665-3" name="__codelineno-665-3" href="#__codelineno-665-3"></a><span class="w"> </span><span class="k">select</span><span class="w"> </span><span class="n">n1</span><span class="p">.</span><span class="n">ToUpper</span><span class="p">()</span>
</span><span id="__span-665-4"><a id="__codelineno-665-4" name="__codelineno-665-4" href="#__codelineno-665-4"></a><span class="w"> </span><span class="k">into</span><span class="w"> </span><span class="n">n2</span><span class="w"> </span><span class="c1">// Only n2 is visible from here on.</span>
</span><span id="__span-665-5"><a id="__codelineno-665-5" name="__codelineno-665-5" href="#__codelineno-665-5"></a><span class="w"> </span><span class="k">where</span><span class="w"> </span><span class="n">n1</span><span class="p">.</span><span class="n">Contains</span><span class="w"> </span><span class="p">(</span><span class="s">&quot;x&quot;</span><span class="p">)</span><span class="w"> </span><span class="c1">// Illegal: n1 is not in scope.</span>
</span><span id="__span-665-6"><a id="__codelineno-665-6" name="__codelineno-665-6" href="#__codelineno-665-6"></a><span class="w"> </span><span class="k">select</span><span class="w"> </span><span class="n">n2</span><span class="p">;</span>
</span></code></pre></div>
<h3 id="wrapping-queries">Wrapping Queries</h3>
<p>A query built progressively can be formulated into a single statement by wrapping one query around another. In general terms</p>
<div class="language-csharp highlight"><pre><span></span><code><span id="__span-666-1"><a id="__codelineno-666-1" name="__codelineno-666-1" href="#__codelineno-666-1"></a><span class="kt">var</span><span class="w"> </span><span class="n">tempQuery</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">tempQueryExpr</span>
</span><span id="__span-666-2"><a id="__codelineno-666-2" name="__codelineno-666-2" href="#__codelineno-666-2"></a><span class="kt">var</span><span class="w"> </span><span class="n">finalQuery</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">from</span><span class="w"> </span><span class="p">...</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">tempQuery</span><span class="w"> </span><span class="p">...</span>
</span><span id="__span-666-3"><a id="__codelineno-666-3" name="__codelineno-666-3" href="#__codelineno-666-3"></a><span class="c1">//can be reformulated as:</span>
</span><span id="__span-666-4"><a id="__codelineno-666-4" name="__codelineno-666-4" href="#__codelineno-666-4"></a><span class="kt">var</span><span class="w"> </span><span class="n">finalQuery</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">from</span><span class="w"> </span><span class="p">...</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="p">(</span><span class="n">tempQueryExpr</span><span class="p">)</span>
</span></code></pre></div>
<div class="language-csharp highlight"><pre><span></span><code><span id="__span-667-1"><a id="__codelineno-667-1" name="__codelineno-667-1" href="#__codelineno-667-1"></a><span class="kt">var</span><span class="w"> </span><span class="n">names</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="p">[]</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="s">&quot;Tom&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Dick&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Harry&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Mary&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Jay&quot;</span><span class="w"> </span><span class="p">}.</span><span class="n">AsQueryable</span><span class="p">();</span>
</span><span id="__span-667-2"><a id="__codelineno-667-2" name="__codelineno-667-2" href="#__codelineno-667-2"></a>
</span><span id="__span-667-3"><a id="__codelineno-667-3" name="__codelineno-667-3" href="#__codelineno-667-3"></a><span class="n">IEnumerable</span><span class="o">&lt;</span><span class="kt">string</span><span class="o">&gt;</span><span class="w"> </span><span class="n">query</span><span class="w"> </span><span class="o">=</span>
</span><span id="__span-667-4"><a id="__codelineno-667-4" name="__codelineno-667-4" href="#__codelineno-667-4"></a><span class="w">    </span><span class="k">from</span><span class="w"> </span><span class="n">n1</span><span class="w"> </span><span class="nf">in</span><span class="w"> </span>
</span><span id="__span-667-5"><a id="__codelineno-667-5" name="__codelineno-667-5" href="#__codelineno-667-5"></a><span class="w">    </span><span class="p">(</span>
</span><span id="__span-667-6"><a id="__codelineno-667-6" name="__codelineno-667-6" href="#__codelineno-667-6"></a><span class="w">        </span><span class="k">from</span><span class="w">   </span><span class="n">n2</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">names</span>
</span><span id="__span-667-7"><a id="__codelineno-667-7" name="__codelineno-667-7" href="#__codelineno-667-7"></a><span class="w">        </span><span class="k">select</span><span class="w"> </span><span class="n">n2</span><span class="p">.</span><span class="n">Replace</span><span class="w"> </span><span class="p">(</span><span class="s">&quot;a&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;&quot;</span><span class="p">).</span><span class="n">Replace</span><span class="w"> </span><span class="p">(</span><span class="s">&quot;e&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;&quot;</span><span class="p">).</span><span class="n">Replace</span><span class="w"> </span><span class="p">(</span><span class="s">&quot;i&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;&quot;</span><span class="p">).</span><span class="n">Replace</span><span class="w"> </span><span class="p">(</span><span class="s">&quot;o&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;&quot;</span><span class="p">).</span><span class="n">Replace</span><span class="w"> </span><span class="p">(</span><span class="s">&quot;u&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;&quot;</span><span class="p">)</span>
</span><span id="__span-667-8"><a id="__codelineno-667-8" name="__codelineno-667-8" href="#__codelineno-667-8"></a><span class="w">    </span><span class="p">)</span>
</span><span id="__span-667-9"><a id="__codelineno-667-9" name="__codelineno-667-9" href="#__codelineno-667-9"></a><span class="w">    </span><span class="k">where</span><span class="w"> </span><span class="n">n1</span><span class="p">.</span><span class="n">Length</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">2</span><span class="w"> </span><span class="k">orderby</span><span class="w"> </span><span class="n">n1</span><span class="w"> </span><span class="k">select</span><span class="w"> </span><span class="n">n1</span><span class="p">;</span>
</span></code></pre></div>
<h1 id="projection-strategies">Projection Strategies</h1>
<h3 id="object-initializers">Object Initializers</h3>
<div class="language-csharp highlight"><pre><span></span><code><span id="__span-668-1"><a id="__codelineno-668-1" name="__codelineno-668-1" href="#__codelineno-668-1"></a><span class="k">void</span><span class="w"> </span><span class="nf">Main</span><span class="p">()</span>
</span><span id="__span-668-2"><a id="__codelineno-668-2" name="__codelineno-668-2" href="#__codelineno-668-2"></a><span class="p">{</span>
</span><span id="__span-668-3"><a id="__codelineno-668-3" name="__codelineno-668-3" href="#__codelineno-668-3"></a><span class="w">    </span><span class="kt">var</span><span class="w"> </span><span class="n">names</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="p">[]</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="s">&quot;Tom&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Dick&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Harry&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Mary&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Jay&quot;</span><span class="w"> </span><span class="p">}.</span><span class="n">AsQueryable</span><span class="p">();</span>
</span><span id="__span-668-4"><a id="__codelineno-668-4" name="__codelineno-668-4" href="#__codelineno-668-4"></a>
</span><span id="__span-668-5"><a id="__codelineno-668-5" name="__codelineno-668-5" href="#__codelineno-668-5"></a><span class="w">    </span><span class="n">IEnumerable</span><span class="o">&lt;</span><span class="n">TempProjectionItem</span><span class="o">&gt;</span><span class="w"> </span><span class="n">temp</span><span class="w"> </span><span class="o">=</span>
</span><span id="__span-668-6"><a id="__codelineno-668-6" name="__codelineno-668-6" href="#__codelineno-668-6"></a><span class="w">        </span><span class="k">from</span><span class="w"> </span><span class="n">n</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">names</span>
</span><span id="__span-668-7"><a id="__codelineno-668-7" name="__codelineno-668-7" href="#__codelineno-668-7"></a><span class="w">        </span><span class="k">select</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">TempProjectionItem</span>
</span><span id="__span-668-8"><a id="__codelineno-668-8" name="__codelineno-668-8" href="#__codelineno-668-8"></a><span class="w">        </span><span class="p">{</span>
</span><span id="__span-668-9"><a id="__codelineno-668-9" name="__codelineno-668-9" href="#__codelineno-668-9"></a><span class="w">            </span><span class="n">Original</span><span class="w">  </span><span class="o">=</span><span class="w"> </span><span class="n">n</span><span class="p">,</span>
</span><span id="__span-668-10"><a id="__codelineno-668-10" name="__codelineno-668-10" href="#__codelineno-668-10"></a><span class="w">            </span><span class="n">Vowelless</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">n</span><span class="p">.</span><span class="n">Replace</span><span class="w"> </span><span class="p">(</span><span class="s">&quot;a&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;&quot;</span><span class="p">).</span><span class="n">Replace</span><span class="w"> </span><span class="p">(</span><span class="s">&quot;e&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;&quot;</span><span class="p">).</span><span class="n">Replace</span><span class="w"> </span><span class="p">(</span><span class="s">&quot;i&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;&quot;</span><span class="p">).</span><span class="n">Replace</span><span class="w"> </span><span class="p">(</span><span class="s">&quot;o&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;&quot;</span><span class="p">).</span><span class="n">Replace</span><span class="w"> </span><span class="p">(</span><span class="s">&quot;u&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;&quot;</span><span class="p">)</span>
</span><span id="__span-668-11"><a id="__codelineno-668-11" name="__codelineno-668-11" href="#__codelineno-668-11"></a><span class="w">        </span><span class="p">};</span>
</span><span id="__span-668-12"><a id="__codelineno-668-12" name="__codelineno-668-12" href="#__codelineno-668-12"></a>
</span><span id="__span-668-13"><a id="__codelineno-668-13" name="__codelineno-668-13" href="#__codelineno-668-13"></a><span class="w">    </span><span class="n">temp</span><span class="p">.</span><span class="n">Dump</span><span class="p">();</span>
</span><span id="__span-668-14"><a id="__codelineno-668-14" name="__codelineno-668-14" href="#__codelineno-668-14"></a><span class="p">}</span>
</span><span id="__span-668-15"><a id="__codelineno-668-15" name="__codelineno-668-15" href="#__codelineno-668-15"></a>
</span><span id="__span-668-16"><a id="__codelineno-668-16" name="__codelineno-668-16" href="#__codelineno-668-16"></a><span class="k">class</span><span class="w"> </span><span class="nc">TempProjectionItem</span>
</span><span id="__span-668-17"><a id="__codelineno-668-17" name="__codelineno-668-17" href="#__codelineno-668-17"></a><span class="p">{</span>
</span><span id="__span-668-18"><a id="__codelineno-668-18" name="__codelineno-668-18" href="#__codelineno-668-18"></a><span class="w">    </span><span class="k">public</span><span class="w"> </span><span class="kt">string</span><span class="w"> </span><span class="n">Original</span><span class="p">;</span><span class="w">      </span><span class="c1">// Original name</span>
</span><span id="__span-668-19"><a id="__codelineno-668-19" name="__codelineno-668-19" href="#__codelineno-668-19"></a><span class="w">    </span><span class="k">public</span><span class="w"> </span><span class="kt">string</span><span class="w"> </span><span class="n">Vowelless</span><span class="p">;</span><span class="w">     </span><span class="c1">// Vowel-stripped name</span>
</span><span id="__span-668-20"><a id="__codelineno-668-20" name="__codelineno-668-20" href="#__codelineno-668-20"></a><span class="p">}</span>
</span><span id="__span-668-21"><a id="__codelineno-668-21" name="__codelineno-668-21" href="#__codelineno-668-21"></a><span class="c1">// Dick</span>
</span><span id="__span-668-22"><a id="__codelineno-668-22" name="__codelineno-668-22" href="#__codelineno-668-22"></a><span class="c1">// Harry</span>
</span><span id="__span-668-23"><a id="__codelineno-668-23" name="__codelineno-668-23" href="#__codelineno-668-23"></a><span class="c1">// Mary</span>
</span></code></pre></div>
<h3 id="anonymous-types_1">Anonymous Types</h3>
<p>Anonymous types allow you to structure your intermediate results without writing special classes.</p>
<div class="language-csharp highlight"><pre><span></span><code><span id="__span-669-1"><a id="__codelineno-669-1" name="__codelineno-669-1" href="#__codelineno-669-1"></a><span class="kt">var</span><span class="w"> </span><span class="n">names</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="p">[]</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="s">&quot;Tom&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Dick&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Harry&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Mary&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Jay&quot;</span><span class="w"> </span><span class="p">}.</span><span class="n">AsQueryable</span><span class="p">();</span>
</span><span id="__span-669-2"><a id="__codelineno-669-2" name="__codelineno-669-2" href="#__codelineno-669-2"></a>
</span><span id="__span-669-3"><a id="__codelineno-669-3" name="__codelineno-669-3" href="#__codelineno-669-3"></a><span class="kt">var</span><span class="w"> </span><span class="n">intermediate</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">from</span><span class="w"> </span><span class="n">n</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">names</span>
</span><span id="__span-669-4"><a id="__codelineno-669-4" name="__codelineno-669-4" href="#__codelineno-669-4"></a><span class="k">select</span><span class="w"> </span><span class="k">new</span>
</span><span id="__span-669-5"><a id="__codelineno-669-5" name="__codelineno-669-5" href="#__codelineno-669-5"></a><span class="p">{</span>
</span><span id="__span-669-6"><a id="__codelineno-669-6" name="__codelineno-669-6" href="#__codelineno-669-6"></a><span class="w">    </span><span class="n">Original</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">n</span><span class="p">,</span>
</span><span id="__span-669-7"><a id="__codelineno-669-7" name="__codelineno-669-7" href="#__codelineno-669-7"></a><span class="w">    </span><span class="n">Vowelless</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">n</span><span class="p">.</span><span class="n">Replace</span><span class="w"> </span><span class="p">(</span><span class="s">&quot;a&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;&quot;</span><span class="p">).</span><span class="n">Replace</span><span class="w"> </span><span class="p">(</span><span class="s">&quot;e&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;&quot;</span><span class="p">).</span><span class="n">Replace</span><span class="w"> </span><span class="p">(</span><span class="s">&quot;i&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;&quot;</span><span class="p">).</span><span class="n">Replace</span><span class="w"> </span><span class="p">(</span><span class="s">&quot;o&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;&quot;</span><span class="p">).</span><span class="n">Replace</span><span class="w"> </span><span class="p">(</span><span class="s">&quot;u&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;&quot;</span><span class="p">)</span>
</span><span id="__span-669-8"><a id="__codelineno-669-8" name="__codelineno-669-8" href="#__codelineno-669-8"></a><span class="p">};</span>
</span><span id="__span-669-9"><a id="__codelineno-669-9" name="__codelineno-669-9" href="#__codelineno-669-9"></a>
</span><span id="__span-669-10"><a id="__codelineno-669-10" name="__codelineno-669-10" href="#__codelineno-669-10"></a><span class="p">(</span>
</span><span id="__span-669-11"><a id="__codelineno-669-11" name="__codelineno-669-11" href="#__codelineno-669-11"></a><span class="w">    </span><span class="k">from</span><span class="w">    </span><span class="n">item</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">intermediate</span>
</span><span id="__span-669-12"><a id="__codelineno-669-12" name="__codelineno-669-12" href="#__codelineno-669-12"></a><span class="w">    </span><span class="k">where</span><span class="w">   </span><span class="n">item</span><span class="p">.</span><span class="n">Vowelless</span><span class="p">.</span><span class="n">Length</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">2</span>
</span><span id="__span-669-13"><a id="__codelineno-669-13" name="__codelineno-669-13" href="#__codelineno-669-13"></a><span class="w">    </span><span class="k">select</span><span class="w">  </span><span class="n">item</span><span class="p">.</span><span class="n">Original</span>
</span><span id="__span-669-14"><a id="__codelineno-669-14" name="__codelineno-669-14" href="#__codelineno-669-14"></a><span class="p">)</span>
</span><span id="__span-669-15"><a id="__codelineno-669-15" name="__codelineno-669-15" href="#__codelineno-669-15"></a><span class="p">.</span><span class="n">Dump</span><span class="p">();</span>
</span><span id="__span-669-16"><a id="__codelineno-669-16" name="__codelineno-669-16" href="#__codelineno-669-16"></a>
</span><span id="__span-669-17"><a id="__codelineno-669-17" name="__codelineno-669-17" href="#__codelineno-669-17"></a><span class="c1">// With the into keyword we can do this in one step:</span>
</span><span id="__span-669-18"><a id="__codelineno-669-18" name="__codelineno-669-18" href="#__codelineno-669-18"></a>
</span><span id="__span-669-19"><a id="__codelineno-669-19" name="__codelineno-669-19" href="#__codelineno-669-19"></a><span class="p">(</span>
</span><span id="__span-669-20"><a id="__codelineno-669-20" name="__codelineno-669-20" href="#__codelineno-669-20"></a><span class="w">    </span><span class="k">from</span><span class="w"> </span><span class="n">n</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">names</span>
</span><span id="__span-669-21"><a id="__codelineno-669-21" name="__codelineno-669-21" href="#__codelineno-669-21"></a><span class="w">    </span><span class="k">select</span><span class="w"> </span><span class="k">new</span>
</span><span id="__span-669-22"><a id="__codelineno-669-22" name="__codelineno-669-22" href="#__codelineno-669-22"></a><span class="w">    </span><span class="p">{</span>
</span><span id="__span-669-23"><a id="__codelineno-669-23" name="__codelineno-669-23" href="#__codelineno-669-23"></a><span class="w">        </span><span class="n">Original</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">n</span><span class="p">,</span>
</span><span id="__span-669-24"><a id="__codelineno-669-24" name="__codelineno-669-24" href="#__codelineno-669-24"></a><span class="w">        </span><span class="n">Vowelless</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">n</span><span class="p">.</span><span class="n">Replace</span><span class="w"> </span><span class="p">(</span><span class="s">&quot;a&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;&quot;</span><span class="p">).</span><span class="n">Replace</span><span class="w"> </span><span class="p">(</span><span class="s">&quot;e&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;&quot;</span><span class="p">).</span><span class="n">Replace</span><span class="w"> </span><span class="p">(</span><span class="s">&quot;i&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;&quot;</span><span class="p">).</span><span class="n">Replace</span><span class="w"> </span><span class="p">(</span><span class="s">&quot;o&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;&quot;</span><span class="p">).</span><span class="n">Replace</span><span class="w"> </span><span class="p">(</span><span class="s">&quot;u&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;&quot;</span><span class="p">)</span>
</span><span id="__span-669-25"><a id="__codelineno-669-25" name="__codelineno-669-25" href="#__codelineno-669-25"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-669-26"><a id="__codelineno-669-26" name="__codelineno-669-26" href="#__codelineno-669-26"></a><span class="w">    </span><span class="k">into</span><span class="w">   </span><span class="n">temp</span>
</span><span id="__span-669-27"><a id="__codelineno-669-27" name="__codelineno-669-27" href="#__codelineno-669-27"></a><span class="w">    </span><span class="k">where</span><span class="w">  </span><span class="n">temp</span><span class="p">.</span><span class="n">Vowelless</span><span class="p">.</span><span class="n">Length</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">2</span>
</span><span id="__span-669-28"><a id="__codelineno-669-28" name="__codelineno-669-28" href="#__codelineno-669-28"></a><span class="w">    </span><span class="k">select</span><span class="w"> </span><span class="n">temp</span><span class="p">.</span><span class="n">Original</span>
</span><span id="__span-669-29"><a id="__codelineno-669-29" name="__codelineno-669-29" href="#__codelineno-669-29"></a><span class="p">)</span>
</span><span id="__span-669-30"><a id="__codelineno-669-30" name="__codelineno-669-30" href="#__codelineno-669-30"></a><span class="p">.</span><span class="n">Dump</span><span class="w"> </span><span class="p">(</span><span class="s">&quot;With the &#39;into&#39; keyword&quot;</span><span class="p">);</span>
</span></code></pre></div>
<h3 id="the-let-keyword">The let Keyword</h3>
<p>The let keyword introduces a new variable alongside the range variable</p>
<div class="language-csharp highlight"><pre><span></span><code><span id="__span-670-1"><a id="__codelineno-670-1" name="__codelineno-670-1" href="#__codelineno-670-1"></a><span class="kt">string</span><span class="p">[]</span><span class="w"> </span><span class="n">names</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="s">&quot;Tom&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Dick&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Harry&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Mary&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Jay&quot;</span><span class="w"> </span><span class="p">};</span>
</span><span id="__span-670-2"><a id="__codelineno-670-2" name="__codelineno-670-2" href="#__codelineno-670-2"></a><span class="n">IEnumerable</span><span class="o">&lt;</span><span class="kt">string</span><span class="o">&gt;</span><span class="w"> </span><span class="n">query</span><span class="w"> </span><span class="o">=</span>
</span><span id="__span-670-3"><a id="__codelineno-670-3" name="__codelineno-670-3" href="#__codelineno-670-3"></a><span class="w"> </span><span class="k">from</span><span class="w"> </span><span class="n">n</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">names</span>
</span><span id="__span-670-4"><a id="__codelineno-670-4" name="__codelineno-670-4" href="#__codelineno-670-4"></a><span class="w"> </span><span class="k">let</span><span class="w"> </span><span class="n">vowelless</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">n</span><span class="p">.</span><span class="n">Replace</span><span class="w"> </span><span class="p">(</span><span class="s">&quot;a&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;&quot;</span><span class="p">).</span><span class="n">Replace</span><span class="w"> </span><span class="p">(</span><span class="s">&quot;e&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;&quot;</span><span class="p">).</span><span class="n">Replace</span><span class="w"> </span><span class="p">(</span><span class="s">&quot;i&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;&quot;</span><span class="p">)</span>
</span><span id="__span-670-5"><a id="__codelineno-670-5" name="__codelineno-670-5" href="#__codelineno-670-5"></a><span class="w"> </span><span class="p">.</span><span class="n">Replace</span><span class="w"> </span><span class="p">(</span><span class="s">&quot;o&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;&quot;</span><span class="p">).</span><span class="n">Replace</span><span class="w"> </span><span class="p">(</span><span class="s">&quot;u&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;&quot;</span><span class="p">)</span>
</span><span id="__span-670-6"><a id="__codelineno-670-6" name="__codelineno-670-6" href="#__codelineno-670-6"></a><span class="w"> </span><span class="k">where</span><span class="w"> </span><span class="n">vowelless</span><span class="p">.</span><span class="n">Length</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">2</span>
</span><span id="__span-670-7"><a id="__codelineno-670-7" name="__codelineno-670-7" href="#__codelineno-670-7"></a><span class="w"> </span><span class="k">orderby</span><span class="w"> </span><span class="n">vowelless</span>
</span><span id="__span-670-8"><a id="__codelineno-670-8" name="__codelineno-670-8" href="#__codelineno-670-8"></a><span class="w"> </span><span class="k">select</span><span class="w"> </span><span class="n">n</span><span class="p">;</span><span class="w"> </span><span class="c1">// Thanks to let, n is still in scope.</span>
</span></code></pre></div>
<p>let accomplishes two things:</p>
<ul>
<li>It projects new elements alongside existing elements.</li>
<li>It allows an expression to be used repeatedly in a query without being rewritten.# Chapter 9 : LINQ Operators</li>
</ul>
<aside>
ðŸš« This Chapter Currently Not Applicable to Current Work So I am Leaving it for Future Re Read

</aside>

<h1 id="overview_3">Overview</h1>
<p>This chapter describes each of the LINQ query operators. This Chapter cover area such as</p>
<ul>
<li>Projecting object hierarchies</li>
<li>Joining with Select, SelectMany, Join, and GroupJoin</li>
<li>Query expressions with multiple range variables</li>
</ul>
<p>All of the examples in this chapter assume that a names array is defined as follows</p>
<div class="language-csharp highlight"><pre><span></span><code><span id="__span-671-1"><a id="__codelineno-671-1" name="__codelineno-671-1" href="#__codelineno-671-1"></a><span class="kt">string</span><span class="p">[]</span><span class="w"> </span><span class="n">names</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="s">&quot;Tom&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Dick&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Harry&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Mary&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Jay&quot;</span><span class="w"> </span><span class="p">};</span>
</span></code></pre></div>
<p>Examples that query a database assume that a variable called dbContext is instantiâ€
ated as</p>
<div class="language-csharp highlight"><pre><span></span><code><span id="__span-672-1"><a id="__codelineno-672-1" name="__codelineno-672-1" href="#__codelineno-672-1"></a><span class="kt">var</span><span class="w"> </span><span class="n">dbContext</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">NutshellContext</span><span class="p">();</span>
</span></code></pre></div>
<ul>
<li>
<p>where NutshellContext is defined as follows</p>
<div class="language-csharp highlight"><pre><span></span><code><span id="__span-673-1"><a id="__codelineno-673-1" name="__codelineno-673-1" href="#__codelineno-673-1"></a><span class="k">public</span><span class="w"> </span><span class="k">class</span><span class="w"> </span><span class="nc">NutshellContext</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="n">DbContext</span>
</span><span id="__span-673-2"><a id="__codelineno-673-2" name="__codelineno-673-2" href="#__codelineno-673-2"></a><span class="p">{</span>
</span><span id="__span-673-3"><a id="__codelineno-673-3" name="__codelineno-673-3" href="#__codelineno-673-3"></a><span class="w"> </span><span class="k">public</span><span class="w"> </span><span class="n">DbSet</span><span class="o">&lt;</span><span class="n">Customer</span><span class="o">&gt;</span><span class="w"> </span><span class="n">Customers</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">get</span><span class="p">;</span><span class="w"> </span><span class="k">set</span><span class="p">;</span><span class="w"> </span><span class="p">}</span>
</span><span id="__span-673-4"><a id="__codelineno-673-4" name="__codelineno-673-4" href="#__codelineno-673-4"></a><span class="w"> </span><span class="k">public</span><span class="w"> </span><span class="n">DbSet</span><span class="o">&lt;</span><span class="n">Purchase</span><span class="o">&gt;</span><span class="w"> </span><span class="n">Purchases</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">get</span><span class="p">;</span><span class="w"> </span><span class="k">set</span><span class="p">;</span><span class="w"> </span><span class="p">}</span>
</span><span id="__span-673-5"><a id="__codelineno-673-5" name="__codelineno-673-5" href="#__codelineno-673-5"></a><span class="w"> </span><span class="k">protected</span><span class="w"> </span><span class="k">override</span><span class="w"> </span><span class="k">void</span><span class="w"> </span><span class="nf">OnModelCreating</span><span class="p">(</span><span class="n">ModelBuilder</span><span class="w"> </span><span class="n">modelBuilder</span><span class="p">)</span>
</span><span id="__span-673-6"><a id="__codelineno-673-6" name="__codelineno-673-6" href="#__codelineno-673-6"></a><span class="w"> </span><span class="p">{</span>
</span><span id="__span-673-7"><a id="__codelineno-673-7" name="__codelineno-673-7" href="#__codelineno-673-7"></a><span class="w"> </span><span class="n">modelBuilder</span><span class="p">.</span><span class="n">Entity</span><span class="o">&lt;</span><span class="n">Customer</span><span class="o">&gt;</span><span class="p">(</span><span class="n">entity</span><span class="w"> </span><span class="o">=&gt;</span>
</span><span id="__span-673-8"><a id="__codelineno-673-8" name="__codelineno-673-8" href="#__codelineno-673-8"></a><span class="w"> </span><span class="p">{</span>
</span><span id="__span-673-9"><a id="__codelineno-673-9" name="__codelineno-673-9" href="#__codelineno-673-9"></a><span class="w"> </span><span class="n">entity</span><span class="p">.</span><span class="n">ToTable</span><span class="p">(</span><span class="s">&quot;Customer&quot;</span><span class="p">);</span>
</span><span id="__span-673-10"><a id="__codelineno-673-10" name="__codelineno-673-10" href="#__codelineno-673-10"></a><span class="w"> </span><span class="n">entity</span><span class="p">.</span><span class="n">Property</span><span class="p">(</span><span class="n">e</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="n">e</span><span class="p">.</span><span class="n">Name</span><span class="p">).</span><span class="n">IsRequired</span><span class="p">();</span><span class="w"> </span><span class="c1">// Column is not nullable</span>
</span><span id="__span-673-11"><a id="__codelineno-673-11" name="__codelineno-673-11" href="#__codelineno-673-11"></a><span class="w"> </span><span class="p">});</span>
</span><span id="__span-673-12"><a id="__codelineno-673-12" name="__codelineno-673-12" href="#__codelineno-673-12"></a><span class="w"> </span><span class="n">modelBuilder</span><span class="p">.</span><span class="n">Entity</span><span class="o">&lt;</span><span class="n">Purchase</span><span class="o">&gt;</span><span class="p">(</span><span class="n">entity</span><span class="w"> </span><span class="o">=&gt;</span>
</span><span id="__span-673-13"><a id="__codelineno-673-13" name="__codelineno-673-13" href="#__codelineno-673-13"></a><span class="w"> </span><span class="p">{</span>
</span><span id="__span-673-14"><a id="__codelineno-673-14" name="__codelineno-673-14" href="#__codelineno-673-14"></a><span class="w"> </span><span class="n">entity</span><span class="p">.</span><span class="n">ToTable</span><span class="p">(</span><span class="s">&quot;Purchase&quot;</span><span class="p">);</span>
</span><span id="__span-673-15"><a id="__codelineno-673-15" name="__codelineno-673-15" href="#__codelineno-673-15"></a><span class="w"> </span><span class="n">entity</span><span class="p">.</span><span class="n">Property</span><span class="p">(</span><span class="n">e</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="n">e</span><span class="p">.</span><span class="n">Date</span><span class="p">).</span><span class="n">IsRequired</span><span class="p">();</span>
</span><span id="__span-673-16"><a id="__codelineno-673-16" name="__codelineno-673-16" href="#__codelineno-673-16"></a><span class="n">entity</span><span class="p">.</span><span class="n">Property</span><span class="p">(</span><span class="n">e</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="n">e</span><span class="p">.</span><span class="n">Description</span><span class="p">).</span><span class="n">IsRequired</span><span class="p">();</span>
</span><span id="__span-673-17"><a id="__codelineno-673-17" name="__codelineno-673-17" href="#__codelineno-673-17"></a><span class="w"> </span><span class="p">});</span>
</span><span id="__span-673-18"><a id="__codelineno-673-18" name="__codelineno-673-18" href="#__codelineno-673-18"></a><span class="w"> </span><span class="p">}</span>
</span><span id="__span-673-19"><a id="__codelineno-673-19" name="__codelineno-673-19" href="#__codelineno-673-19"></a><span class="p">}</span>
</span><span id="__span-673-20"><a id="__codelineno-673-20" name="__codelineno-673-20" href="#__codelineno-673-20"></a><span class="k">public</span><span class="w"> </span><span class="k">class</span><span class="w"> </span><span class="nc">Customer</span>
</span><span id="__span-673-21"><a id="__codelineno-673-21" name="__codelineno-673-21" href="#__codelineno-673-21"></a><span class="p">{</span>
</span><span id="__span-673-22"><a id="__codelineno-673-22" name="__codelineno-673-22" href="#__codelineno-673-22"></a><span class="w"> </span><span class="k">public</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">ID</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">get</span><span class="p">;</span><span class="w"> </span><span class="k">set</span><span class="p">;</span><span class="w"> </span><span class="p">}</span>
</span><span id="__span-673-23"><a id="__codelineno-673-23" name="__codelineno-673-23" href="#__codelineno-673-23"></a><span class="w"> </span><span class="k">public</span><span class="w"> </span><span class="kt">string</span><span class="w"> </span><span class="n">Name</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">get</span><span class="p">;</span><span class="w"> </span><span class="k">set</span><span class="p">;</span><span class="w"> </span><span class="p">}</span>
</span><span id="__span-673-24"><a id="__codelineno-673-24" name="__codelineno-673-24" href="#__codelineno-673-24"></a><span class="w"> </span><span class="k">public</span><span class="w"> </span><span class="k">virtual</span><span class="w"> </span><span class="n">List</span><span class="o">&lt;</span><span class="n">Purchase</span><span class="o">&gt;</span><span class="w"> </span><span class="n">Purchases</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">get</span><span class="p">;</span><span class="w"> </span><span class="k">set</span><span class="p">;</span><span class="w"> </span><span class="p">}</span>
</span><span id="__span-673-25"><a id="__codelineno-673-25" name="__codelineno-673-25" href="#__codelineno-673-25"></a><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">List</span><span class="o">&lt;</span><span class="n">Purchase</span><span class="o">&gt;</span><span class="p">();</span>
</span><span id="__span-673-26"><a id="__codelineno-673-26" name="__codelineno-673-26" href="#__codelineno-673-26"></a><span class="p">}</span>
</span><span id="__span-673-27"><a id="__codelineno-673-27" name="__codelineno-673-27" href="#__codelineno-673-27"></a><span class="k">public</span><span class="w"> </span><span class="k">class</span><span class="w"> </span><span class="nc">Purchase</span>
</span><span id="__span-673-28"><a id="__codelineno-673-28" name="__codelineno-673-28" href="#__codelineno-673-28"></a><span class="p">{</span>
</span><span id="__span-673-29"><a id="__codelineno-673-29" name="__codelineno-673-29" href="#__codelineno-673-29"></a><span class="w"> </span><span class="k">public</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">ID</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">get</span><span class="p">;</span><span class="w"> </span><span class="k">set</span><span class="p">;</span><span class="w"> </span><span class="p">}</span>
</span><span id="__span-673-30"><a id="__codelineno-673-30" name="__codelineno-673-30" href="#__codelineno-673-30"></a><span class="w"> </span><span class="k">public</span><span class="w"> </span><span class="kt">int?</span><span class="w"> </span><span class="n">CustomerID</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">get</span><span class="p">;</span><span class="w"> </span><span class="k">set</span><span class="p">;</span><span class="w"> </span><span class="p">}</span>
</span><span id="__span-673-31"><a id="__codelineno-673-31" name="__codelineno-673-31" href="#__codelineno-673-31"></a><span class="w"> </span><span class="k">public</span><span class="w"> </span><span class="n">DateTime</span><span class="w"> </span><span class="n">Date</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">get</span><span class="p">;</span><span class="w"> </span><span class="k">set</span><span class="p">;</span><span class="w"> </span><span class="p">}</span>
</span><span id="__span-673-32"><a id="__codelineno-673-32" name="__codelineno-673-32" href="#__codelineno-673-32"></a><span class="w"> </span><span class="k">public</span><span class="w"> </span><span class="kt">string</span><span class="w"> </span><span class="n">Description</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">get</span><span class="p">;</span><span class="w"> </span><span class="k">set</span><span class="p">;</span><span class="w"> </span><span class="p">}</span>
</span><span id="__span-673-33"><a id="__codelineno-673-33" name="__codelineno-673-33" href="#__codelineno-673-33"></a><span class="w"> </span><span class="k">public</span><span class="w"> </span><span class="kt">decimal</span><span class="w"> </span><span class="n">Price</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">get</span><span class="p">;</span><span class="w"> </span><span class="k">set</span><span class="p">;</span><span class="w"> </span><span class="p">}</span>
</span><span id="__span-673-34"><a id="__codelineno-673-34" name="__codelineno-673-34" href="#__codelineno-673-34"></a><span class="w"> </span><span class="k">public</span><span class="w"> </span><span class="k">virtual</span><span class="w"> </span><span class="n">Customer</span><span class="w"> </span><span class="n">Customer</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">get</span><span class="p">;</span><span class="w"> </span><span class="k">set</span><span class="p">;</span><span class="w"> </span><span class="p">}</span>
</span><span id="__span-673-35"><a id="__codelineno-673-35" name="__codelineno-673-35" href="#__codelineno-673-35"></a><span class="p">}</span>
</span></code></pre></div>
</li>
<li>
<p>Here are corresponding SQL Server table definitions</p>
<div class="language-csharp highlight"><pre><span></span><code><span id="__span-674-1"><a id="__codelineno-674-1" name="__codelineno-674-1" href="#__codelineno-674-1"></a><span class="n">CREATE</span><span class="w"> </span><span class="n">TABLE</span><span class="w"> </span><span class="nf">Customer</span><span class="w"> </span><span class="p">(</span>
</span><span id="__span-674-2"><a id="__codelineno-674-2" name="__codelineno-674-2" href="#__codelineno-674-2"></a><span class="w"> </span><span class="n">ID</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">NOT</span><span class="w"> </span><span class="n">NULL</span><span class="w"> </span><span class="n">IDENTITY</span><span class="w"> </span><span class="n">PRIMARY</span><span class="w"> </span><span class="n">KEY</span><span class="p">,</span>
</span><span id="__span-674-3"><a id="__codelineno-674-3" name="__codelineno-674-3" href="#__codelineno-674-3"></a><span class="w"> </span><span class="n">Name</span><span class="w"> </span><span class="nf">nvarchar</span><span class="p">(</span><span class="mi">30</span><span class="p">)</span><span class="w"> </span><span class="n">NOT</span><span class="w"> </span><span class="n">NULL</span>
</span><span id="__span-674-4"><a id="__codelineno-674-4" name="__codelineno-674-4" href="#__codelineno-674-4"></a><span class="p">)</span>
</span><span id="__span-674-5"><a id="__codelineno-674-5" name="__codelineno-674-5" href="#__codelineno-674-5"></a><span class="n">CREATE</span><span class="w"> </span><span class="n">TABLE</span><span class="w"> </span><span class="nf">Purchase</span><span class="w"> </span><span class="p">(</span>
</span><span id="__span-674-6"><a id="__codelineno-674-6" name="__codelineno-674-6" href="#__codelineno-674-6"></a><span class="w"> </span><span class="n">ID</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">NOT</span><span class="w"> </span><span class="n">NULL</span><span class="w"> </span><span class="n">IDENTITY</span><span class="w"> </span><span class="n">PRIMARY</span><span class="w"> </span><span class="n">KEY</span><span class="p">,</span>
</span><span id="__span-674-7"><a id="__codelineno-674-7" name="__codelineno-674-7" href="#__codelineno-674-7"></a><span class="w"> </span><span class="n">CustomerID</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">NOT</span><span class="w"> </span><span class="n">NULL</span><span class="w"> </span><span class="n">REFERENCES</span><span class="w"> </span><span class="nf">Customer</span><span class="p">(</span><span class="n">ID</span><span class="p">),</span>
</span><span id="__span-674-8"><a id="__codelineno-674-8" name="__codelineno-674-8" href="#__codelineno-674-8"></a><span class="w"> </span><span class="n">Date</span><span class="w"> </span><span class="n">datetime</span><span class="w"> </span><span class="n">NOT</span><span class="w"> </span><span class="n">NULL</span><span class="p">,</span>
</span><span id="__span-674-9"><a id="__codelineno-674-9" name="__codelineno-674-9" href="#__codelineno-674-9"></a><span class="w"> </span><span class="n">Description</span><span class="w"> </span><span class="nf">nvarchar</span><span class="p">(</span><span class="mi">30</span><span class="p">)</span><span class="w"> </span><span class="n">NOT</span><span class="w"> </span><span class="n">NULL</span><span class="p">,</span>
</span><span id="__span-674-10"><a id="__codelineno-674-10" name="__codelineno-674-10" href="#__codelineno-674-10"></a><span class="w"> </span><span class="n">Price</span><span class="w"> </span><span class="kt">decimal</span><span class="w"> </span><span class="n">NOT</span><span class="w"> </span><span class="n">NULL</span>
</span><span id="__span-674-11"><a id="__codelineno-674-11" name="__codelineno-674-11" href="#__codelineno-674-11"></a><span class="p">)</span>
</span></code></pre></div>
</li>
</ul>
<p>In this section, we provide an overview of the standard query operators. They fall
into three categories:</p>
<ul>
<li>Sequence in, sequence out (sequenceâ†’sequence)</li>
<li>Sequence in, single element or scalar value out</li>
<li>Nothing in, sequence out (generation methods)</li>
</ul>
<h2 id="sequencesequence">Sequenceâ†’Sequence</h2>
<p>Most query operators fall into this categoryâ€”accepting one or more sequences as
input and emitting a single output sequence</p>
<h3 id="filtering">Filtering</h3>
<p>IEnumerable<TSource>â†’IEnumerable<TSource>
Returns a subset of the original elements.
Where, Take, TakeWhile, Skip, SkipWhile, Distinct</p>
<h3 id="projecting">Projecting</h3>
<p>Transforms each element with a lambda function. SelectMany flattens nested
sequences; Select and SelectMany perform inner joins, left outer joins, cross joins,
and non-equi joins with EF Core.</p>
<p>Select, SelectMany</p>
<h3 id="joining">Joining</h3>
<p>Meshes elements of one sequence with another. Join and GroupJoin operators are
designed to be efficient with local queries and support inner and left outer joins</p>
<p>The Zip operator enumerates two sequences in step, applying a function over each</p>
<p>element pair. Rather than naming the type arguments TOuter and TInner, the Zip
operator names them TFirst and TSecond:</p>
<p>IEnumerable</p>
<p>, IEnumerableâ†’IEnumerable
Join, GroupJoin, Zip</p>







  
  






                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
    <div class="md-copyright__highlight">
      Copyright &copy; 2025 Nodes Automations
    </div>
  
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    
      
      
      <script id="__config" type="application/json">{"annotate": null, "base": "..", "features": ["content.action.edit", "content.action.view", "content.code.copy", "navigation.path", "navigation.tabs", "navigation.indexes"], "search": "../assets/javascripts/workers/search.2c215733.min.js", "tags": null, "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": null}</script>
    
    
      <script src="../assets/javascripts/bundle.79ae519e.min.js"></script>
      
    
  </body>
</html>